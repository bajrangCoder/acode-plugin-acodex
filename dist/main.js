"use strict";(()=>{var vu=Object.create;var So=Object.defineProperty;var mu=Object.getOwnPropertyDescriptor;var yu=Object.getOwnPropertyNames;var bu=Object.getPrototypeOf,Au=Object.prototype.hasOwnProperty;var re=(e,i)=>()=>(i||e((i={exports:{}}).exports,i),i.exports);var wu=(e,i,r,s)=>{if(i&&typeof i=="object"||typeof i=="function")for(let c of yu(i))!Au.call(e,c)&&c!==r&&So(e,c,{get:()=>i[c],enumerable:!(s=mu(i,c))||s.enumerable});return e};var it=(e,i,r)=>(r=e!=null?vu(bu(e)):{},wu(i||!e||!e.__esModule?So(r,"default",{value:e,enumerable:!0}):r,e));var js=re(_r=>{"use strict";Object.defineProperty(_r,"__esModule",{value:!0});_r.toSigned32bit=Wu;_r.toUnsigned32bit=$u;function $u(e){return e>>>0}function Wu(e){return e|0}});var yt=re(Le=>{"use strict";Object.defineProperty(Le,"__esModule",{value:!0});Le.Warn=Le.Info=Le.Error=Le.Debug=void 0;Le.getLogging=ju;Le.initLogging=na;var Gs="warn",ta=Le.Debug=function(){},ia=Le.Info=function(){},ra=Le.Warn=function(){},sa=Le.Error=function(){};function na(e){if(typeof e>"u"?e=Gs:Gs=e,Le.Debug=ta=Le.Info=ia=Le.Warn=ra=Le.Error=sa=function(){},typeof window.console<"u")switch(e){case"debug":Le.Debug=ta=console.debug.bind(window.console);case"info":Le.Info=ia=console.info.bind(window.console);case"warn":Le.Warn=ra=console.warn.bind(window.console);case"error":Le.Error=sa=console.error.bind(window.console);case"none":break;default:throw new window.Error("invalid logging type '"+e+"'")}}function ju(){return Gs}na()});var zs=re(gr=>{"use strict";Object.defineProperty(gr,"__esModule",{value:!0});gr.decodeUTF8=Gu;gr.encodeUTF8=zu;function Gu(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;try{return decodeURIComponent(escape(e))}catch(r){if(r instanceof URIError&&i)return e;throw r}}function zu(e){return unescape(encodeURIComponent(e))}});var xi=re(Ae=>{"use strict";function Js(e){"@babel/helpers - typeof";return Js=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Js(e)}Object.defineProperty(Ae,"__esModule",{value:!0});Ae.hasScrollbarGutter=Ae.dragThreshold=void 0;Ae.isAndroid=ed;Ae.isBlink=cd;Ae.isChrome=sd;Ae.isChromeOS=td;Ae.isChromium=nd;Ae.isEdge=ad;Ae.isFirefox=rd;Ae.isGecko=hd;Ae.isIOS=Zu;Ae.isMac=Ju;Ae.isOpera=od;Ae.isSafari=id;Ae.isTouchDevice=void 0;Ae.isWebKit=ld;Ae.isWindows=Yu;Ae.supportsCursorURIs=void 0;var pr=qu(yt());function aa(e){if(typeof WeakMap!="function")return null;var i=new WeakMap,r=new WeakMap;return(aa=function(c){return c?r:i})(e)}function qu(e,i){if(!i&&e&&e.__esModule)return e;if(e===null||Js(e)!="object"&&typeof e!="function")return{default:e};var r=aa(i);if(r&&r.has(e))return r.get(e);var s={__proto__:null},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var t in e)if(t!=="default"&&{}.hasOwnProperty.call(e,t)){var n=c?Object.getOwnPropertyDescriptor(e,t):null;n&&(n.get||n.set)?Object.defineProperty(s,t,n):s[t]=e[t]}return s.default=e,r&&r.set(e,s),s}var Vu=Ae.isTouchDevice="ontouchstart"in document.documentElement||document.ontouchstart!==void 0||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;window.addEventListener("touchstart",function e(){Ae.isTouchDevice=Vu=!0,window.removeEventListener("touchstart",e,!1)},!1);var Tp=Ae.dragThreshold=10*(window.devicePixelRatio||1),ha=!1;try{qs=document.createElement("canvas"),qs.style.cursor='url("data:image/x-icon;base64,AAACAAEACAgAAAIAAgA4AQAAFgAAACgAAAAIAAAAEAAAAAEAIAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AAAAAAAAAAAAAAAAAAAAAA==") 2 2, default',qs.style.cursor.indexOf("url")===0?(pr.Info("Data URI scheme cursor supported"),ha=!0):pr.Warn("Data URI scheme cursor not supported")}catch(e){pr.Error("Data URI scheme cursor test exception: "+e)}var qs,Fp=Ae.supportsCursorURIs=ha,la=!0;try{Et=document.createElement("div"),Et.style.visibility="hidden",Et.style.overflow="scroll",document.body.appendChild(Et),Vs=document.createElement("div"),Et.appendChild(Vs),oa=Et.offsetWidth-Vs.offsetWidth,Et.parentNode.removeChild(Et),la=oa!=0}catch(e){pr.Error("Scrollbar test exception: "+e)}var Et,Vs,oa,Pp=Ae.hasScrollbarGutter=la;function Ju(){return!!/mac/i.exec(navigator.platform)}function Yu(){return!!/win/i.exec(navigator.platform)}function Zu(){return!!/ipad/i.exec(navigator.platform)||!!/iphone/i.exec(navigator.platform)||!!/ipod/i.exec(navigator.platform)}function ed(){return!!navigator.userAgent.match("Android ")}function td(){return!!navigator.userAgent.match(" CrOS ")}function id(){return!!navigator.userAgent.match("Safari/...")&&!navigator.userAgent.match("Chrome/...")&&!navigator.userAgent.match("Chromium/...")&&!navigator.userAgent.match("Epiphany/...")}function rd(){return!!navigator.userAgent.match("Firefox/...")&&!navigator.userAgent.match("Seamonkey/...")}function sd(){return!!navigator.userAgent.match("Chrome/...")&&!navigator.userAgent.match("Chromium/...")&&!navigator.userAgent.match("Edg/...")&&!navigator.userAgent.match("OPR/...")}function nd(){return!!navigator.userAgent.match("Chromium/...")}function od(){return!!navigator.userAgent.match("OPR/...")}function ad(){return!!navigator.userAgent.match("Edg/...")}function hd(){return!!navigator.userAgent.match("Gecko/...")}function ld(){return!!navigator.userAgent.match("AppleWebKit/...")&&!navigator.userAgent.match("Chrome/...")}function cd(){return!!navigator.userAgent.match("Chrome/...")}});var ca=re(Ys=>{"use strict";Object.defineProperty(Ys,"__esModule",{value:!0});Ys.clientToElement=ud;function ud(e,i,r){var s=r.getBoundingClientRect(),c={x:0,y:0};return e<s.left?c.x=0:e>=s.right?c.x=s.width-1:c.x=e-s.left,i<s.top?c.y=0:i>=s.bottom?c.y=s.height-1:c.y=i-s.top,c}});var tn=re(si=>{"use strict";Object.defineProperty(si,"__esModule",{value:!0});si.getPointerEvent=dd;si.releaseCapture=en;si.setCapture=_d;si.stopEvent=fd;function dd(e){return e.changedTouches?e.changedTouches[0]:e.touches?e.touches[0]:e}function fd(e){e.stopPropagation(),e.preventDefault()}var Zs=!1,ua=null;document.captureElement=null;function Ut(e){if(!Zs){var i=new e.constructor(e.type,e);Zs=!0,document.captureElement?document.captureElement.dispatchEvent(i):ua.dispatchEvent(i),Zs=!1,e.stopPropagation(),i.defaultPrevented&&e.preventDefault(),e.type==="mouseup"&&en()}}function da(){var e=document.getElementById("noVNC_mouse_capture_elem");e.style.cursor=window.getComputedStyle(document.captureElement).cursor}var fa=new MutationObserver(da);function _d(e){if(e.setCapture)e.setCapture(),document.captureElement=e;else{en();var i=document.getElementById("noVNC_mouse_capture_elem");i===null&&(i=document.createElement("div"),i.id="noVNC_mouse_capture_elem",i.style.position="fixed",i.style.top="0px",i.style.left="0px",i.style.width="100%",i.style.height="100%",i.style.zIndex=1e4,i.style.display="none",document.body.appendChild(i),i.addEventListener("contextmenu",Ut),i.addEventListener("mousemove",Ut),i.addEventListener("mouseup",Ut)),document.captureElement=e,fa.observe(e,{attributes:!0}),da(),i.style.display="",window.addEventListener("mousemove",Ut),window.addEventListener("mouseup",Ut)}}function en(){if(document.releaseCapture)document.releaseCapture(),document.captureElement=null;else{if(!document.captureElement)return;ua=document.captureElement,document.captureElement=null,fa.disconnect();var e=document.getElementById("noVNC_mouse_capture_elem");e.style.display="none",window.removeEventListener("mousemove",Ut),window.removeEventListener("mouseup",Ut)}}});var rn=re(vr=>{"use strict";Object.defineProperty(vr,"__esModule",{value:!0});vr.default=void 0;function Si(e){"@babel/helpers - typeof";return Si=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Si(e)}function gd(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function _a(e,i){for(var r=0;r<i.length;r++){var s=i[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,vd(s.key),s)}}function pd(e,i,r){return i&&_a(e.prototype,i),r&&_a(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function vd(e){var i=md(e,"string");return Si(i)=="symbol"?i:i+""}function md(e,i){if(Si(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,i||"default");if(Si(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}var Xp=vr.default=function(){function e(){gd(this,e),this._listeners=new Map}return pd(e,[{key:"addEventListener",value:function(r,s){this._listeners.has(r)||this._listeners.set(r,new Set),this._listeners.get(r).add(s)}},{key:"removeEventListener",value:function(r,s){this._listeners.has(r)&&this._listeners.get(r).delete(s)}},{key:"dispatchEvent",value:function(r){var s=this;return this._listeners.has(r.type)?(this._listeners.get(r.type).forEach(function(c){return c.call(s,r)}),!r.defaultPrevented):!0}}])}()});var nn=re(mr=>{"use strict";function sn(e){"@babel/helpers - typeof";return sn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},sn(e)}Object.defineProperty(mr,"__esModule",{value:!0});mr.default=void 0;var yd=bd(yt());function ga(e){if(typeof WeakMap!="function")return null;var i=new WeakMap,r=new WeakMap;return(ga=function(c){return c?r:i})(e)}function bd(e,i){if(!i&&e&&e.__esModule)return e;if(e===null||sn(e)!="object"&&typeof e!="function")return{default:e};var r=ga(i);if(r&&r.has(e))return r.get(e);var s={__proto__:null},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var t in e)if(t!=="default"&&{}.hasOwnProperty.call(e,t)){var n=c?Object.getOwnPropertyDescriptor(e,t):null;n&&(n.get||n.set)?Object.defineProperty(s,t,n):s[t]=e[t]}return s.default=e,r&&r.set(e,s),s}var Np=mr.default={toBase64Table:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split(""),base64Pad:"=",encode:function(i){"use strict";for(var r="",s=i.length,c=s%3,t=0;t<s-2;t+=3)r+=this.toBase64Table[i[t]>>2],r+=this.toBase64Table[((i[t]&3)<<4)+(i[t+1]>>4)],r+=this.toBase64Table[((i[t+1]&15)<<2)+(i[t+2]>>6)],r+=this.toBase64Table[i[t+2]&63];var n=s-c;return c===2?(r+=this.toBase64Table[i[n]>>2],r+=this.toBase64Table[((i[n]&3)<<4)+(i[n+1]>>4)],r+=this.toBase64Table[(i[n+1]&15)<<2],r+=this.toBase64Table[64]):c===1&&(r+=this.toBase64Table[i[n]>>2],r+=this.toBase64Table[(i[n]&3)<<4],r+=this.toBase64Table[64],r+=this.toBase64Table[64]),r},toBinaryTable:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],decode:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=i.indexOf("=")-r;s<0&&(s=i.length-r);for(var c=(s>>2)*3+Math.floor(s%4/1.5),t=new Array(c),n=0,h=0,g=0,a=r;a<i.length;a++){var l=this.toBinaryTable[i.charCodeAt(a)&127],_=i.charAt(a)===this.base64Pad;if(l===-1){yd.Error("Illegal character code "+i.charCodeAt(a)+" at position "+a);continue}h=h<<6|l,n+=6,n>=8&&(n-=8,_||(t[g++]=h>>n&255),h&=(1<<n)-1)}if(n){var v=new Error("Corrupted base64 string");throw v.name="Base64-Error",v}return t}}});var ya=re(yr=>{"use strict";Object.defineProperty(yr,"__esModule",{value:!0});yr.default=void 0;var ni=Cd(yt()),Ad=wd(nn()),pa=js();function wd(e){return e&&e.__esModule?e:{default:e}}function ma(e){if(typeof WeakMap!="function")return null;var i=new WeakMap,r=new WeakMap;return(ma=function(c){return c?r:i})(e)}function Cd(e,i){if(!i&&e&&e.__esModule)return e;if(e===null||oi(e)!="object"&&typeof e!="function")return{default:e};var r=ma(i);if(r&&r.has(e))return r.get(e);var s={__proto__:null},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var t in e)if(t!=="default"&&{}.hasOwnProperty.call(e,t)){var n=c?Object.getOwnPropertyDescriptor(e,t):null;n&&(n.get||n.set)?Object.defineProperty(s,t,n):s[t]=e[t]}return s.default=e,r&&r.set(e,s),s}function oi(e){"@babel/helpers - typeof";return oi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},oi(e)}function xd(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function va(e,i){for(var r=0;r<i.length;r++){var s=i[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,Ed(s.key),s)}}function Sd(e,i,r){return i&&va(e.prototype,i),r&&va(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ed(e){var i=kd(e,"string");return oi(i)=="symbol"?i:i+""}function kd(e,i){if(oi(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,i||"default");if(oi(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}var $p=yr.default=function(){function e(i){if(xd(this,e),this._drawCtx=null,this._renderQ=[],this._flushPromise=null,this._fbWidth=0,this._fbHeight=0,this._prevDrawStyle="",ni.Debug(">> Display.constructor"),this._target=i,!this._target)throw new Error("Target must be set");if(typeof this._target=="string")throw new Error("target must be a DOM element");if(!this._target.getContext)throw new Error("no getContext method");this._targetCtx=this._target.getContext("2d"),this._viewportLoc={x:0,y:0,w:this._target.width,h:this._target.height},this._backbuffer=document.createElement("canvas"),this._drawCtx=this._backbuffer.getContext("2d"),this._damageBounds={left:0,top:0,right:this._backbuffer.width,bottom:this._backbuffer.height},ni.Debug("User Agent: "+navigator.userAgent),ni.Debug("<< Display.constructor"),this._scale=1,this._clipViewport=!1}return Sd(e,[{key:"scale",get:function(){return this._scale},set:function(r){this._rescale(r)}},{key:"clipViewport",get:function(){return this._clipViewport},set:function(r){this._clipViewport=r;var s=this._viewportLoc;this.viewportChangeSize(s.w,s.h),this.viewportChangePos(0,0)}},{key:"width",get:function(){return this._fbWidth}},{key:"height",get:function(){return this._fbHeight}},{key:"viewportChangePos",value:function(r,s){var c=this._viewportLoc;r=Math.floor(r),s=Math.floor(s),this._clipViewport||(r=-c.w,s=-c.h);var t=c.x+c.w-1,n=c.y+c.h-1;r<0&&c.x+r<0&&(r=-c.x),t+r>=this._fbWidth&&(r-=t+r-this._fbWidth+1),c.y+s<0&&(s=-c.y),n+s>=this._fbHeight&&(s-=n+s-this._fbHeight+1),!(r===0&&s===0)&&(ni.Debug("viewportChange deltaX: "+r+", deltaY: "+s),c.x+=r,c.y+=s,this._damage(c.x,c.y,c.w,c.h),this.flip())}},{key:"viewportChangeSize",value:function(r,s){(!this._clipViewport||typeof r>"u"||typeof s>"u")&&(ni.Debug("Setting viewport to full display region"),r=this._fbWidth,s=this._fbHeight),r=Math.floor(r),s=Math.floor(s),r>this._fbWidth&&(r=this._fbWidth),s>this._fbHeight&&(s=this._fbHeight);var c=this._viewportLoc;if(c.w!==r||c.h!==s){c.w=r,c.h=s;var t=this._target;t.width=r,t.height=s,this.viewportChangePos(0,0),this._damage(c.x,c.y,c.w,c.h),this.flip(),this._rescale(this._scale)}}},{key:"absX",value:function(r){return this._scale===0?0:(0,pa.toSigned32bit)(r/this._scale+this._viewportLoc.x)}},{key:"absY",value:function(r){return this._scale===0?0:(0,pa.toSigned32bit)(r/this._scale+this._viewportLoc.y)}},{key:"resize",value:function(r,s){this._prevDrawStyle="",this._fbWidth=r,this._fbHeight=s;var c=this._backbuffer;if(c.width!==r||c.height!==s){var t=null;c.width>0&&c.height>0&&(t=this._drawCtx.getImageData(0,0,c.width,c.height)),c.width!==r&&(c.width=r),c.height!==s&&(c.height=s),t&&this._drawCtx.putImageData(t,0,0)}var n=this._viewportLoc;this.viewportChangeSize(n.w,n.h),this.viewportChangePos(0,0)}},{key:"getImageData",value:function(){return this._drawCtx.getImageData(0,0,this.width,this.height)}},{key:"toDataURL",value:function(r,s){return this._backbuffer.toDataURL(r,s)}},{key:"toBlob",value:function(r,s,c){return this._backbuffer.toBlob(r,s,c)}},{key:"_damage",value:function(r,s,c,t){r<this._damageBounds.left&&(this._damageBounds.left=r),s<this._damageBounds.top&&(this._damageBounds.top=s),r+c>this._damageBounds.right&&(this._damageBounds.right=r+c),s+t>this._damageBounds.bottom&&(this._damageBounds.bottom=s+t)}},{key:"flip",value:function(r){if(this._renderQ.length!==0&&!r)this._renderQPush({type:"flip"});else{var s=this._damageBounds.left,c=this._damageBounds.top,t=this._damageBounds.right-s,n=this._damageBounds.bottom-c,h=s-this._viewportLoc.x,g=c-this._viewportLoc.y;h<0&&(t+=h,s-=h,h=0),g<0&&(n+=g,c-=g,g=0),h+t>this._viewportLoc.w&&(t=this._viewportLoc.w-h),g+n>this._viewportLoc.h&&(n=this._viewportLoc.h-g),t>0&&n>0&&this._targetCtx.drawImage(this._backbuffer,s,c,t,n,h,g,t,n),this._damageBounds.left=this._damageBounds.top=65535,this._damageBounds.right=this._damageBounds.bottom=0}}},{key:"pending",value:function(){return this._renderQ.length>0}},{key:"flush",value:function(){var r=this;return this._renderQ.length===0?Promise.resolve():(this._flushPromise===null&&(this._flushPromise=new Promise(function(s){r._flushResolve=s})),this._flushPromise)}},{key:"fillRect",value:function(r,s,c,t,n,h){this._renderQ.length!==0&&!h?this._renderQPush({type:"fill",x:r,y:s,width:c,height:t,color:n}):(this._setFillColor(n),this._drawCtx.fillRect(r,s,c,t),this._damage(r,s,c,t))}},{key:"copyImage",value:function(r,s,c,t,n,h,g){this._renderQ.length!==0&&!g?this._renderQPush({type:"copy",oldX:r,oldY:s,x:c,y:t,width:n,height:h}):(this._drawCtx.mozImageSmoothingEnabled=!1,this._drawCtx.webkitImageSmoothingEnabled=!1,this._drawCtx.msImageSmoothingEnabled=!1,this._drawCtx.imageSmoothingEnabled=!1,this._drawCtx.drawImage(this._backbuffer,r,s,n,h,c,t,n,h),this._damage(c,t,n,h))}},{key:"imageRect",value:function(r,s,c,t,n,h){if(!(c===0||t===0)){var g=new Image;g.src="data: "+n+";base64,"+Ad.default.encode(h),this._renderQPush({type:"img",img:g,x:r,y:s,width:c,height:t})}}},{key:"blitImage",value:function(r,s,c,t,n,h,g){if(this._renderQ.length!==0&&!g){var a=new Uint8Array(c*t*4);a.set(new Uint8Array(n.buffer,0,a.length)),this._renderQPush({type:"blit",data:a,x:r,y:s,width:c,height:t})}else{var l=new Uint8ClampedArray(n.buffer,n.byteOffset+h,c*t*4),_=new ImageData(l,c,t);this._drawCtx.putImageData(_,r,s),this._damage(r,s,c,t)}}},{key:"drawImage",value:function(r,s,c){this._drawCtx.drawImage(r,s,c),this._damage(s,c,r.width,r.height)}},{key:"autoscale",value:function(r,s){var c;if(r===0||s===0)c=0;else{var t=this._viewportLoc,n=r/s,h=t.w/t.h;h>=n?c=r/t.w:c=s/t.h}this._rescale(c)}},{key:"_rescale",value:function(r){this._scale=r;var s=this._viewportLoc,c=r*s.w+"px",t=r*s.h+"px";(this._target.style.width!==c||this._target.style.height!==t)&&(this._target.style.width=c,this._target.style.height=t)}},{key:"_setFillColor",value:function(r){var s="rgb("+r[0]+","+r[1]+","+r[2]+")";s!==this._prevDrawStyle&&(this._drawCtx.fillStyle=s,this._prevDrawStyle=s)}},{key:"_renderQPush",value:function(r){this._renderQ.push(r),this._renderQ.length===1&&this._scanRenderQ()}},{key:"_resumeRenderQ",value:function(){this.removeEventListener("load",this._noVNCDisplay._resumeRenderQ),this._noVNCDisplay._scanRenderQ()}},{key:"_scanRenderQ",value:function(){for(var r=!0;r&&this._renderQ.length>0;){var s=this._renderQ[0];switch(s.type){case"flip":this.flip(!0);break;case"copy":this.copyImage(s.oldX,s.oldY,s.x,s.y,s.width,s.height,!0);break;case"fill":this.fillRect(s.x,s.y,s.width,s.height,s.color,!0);break;case"blit":this.blitImage(s.x,s.y,s.width,s.height,s.data,0,!0);break;case"img":if(s.img.complete){if(s.img.width!==s.width||s.img.height!==s.height){ni.Error("Decoded image has incorrect dimensions. Got "+s.img.width+"x"+s.img.height+". Expected "+s.width+"x"+s.height+".");return}this.drawImage(s.img,s.x,s.y)}else s.img._noVNCDisplay=this,s.img.addEventListener("load",this._resumeRenderQ),r=!1;break}r&&this._renderQ.shift()}this._renderQ.length===0&&this._flushPromise!==null&&(this._flushResolve(),this._flushPromise=null,this._flushResolve=null)}}])}()});var Ei=re(rt=>{"use strict";Object.defineProperty(rt,"__esModule",{value:!0});rt.Buf8=rt.Buf32=rt.Buf16=void 0;rt.arraySet=Ld;rt.flattenChunks=Id;rt.shrinkBuf=Bd;function Bd(e,i){return e.length===i?e:e.subarray?e.subarray(0,i):(e.length=i,e)}function Ld(e,i,r,s,c){if(i.subarray&&e.subarray){e.set(i.subarray(r,r+s),c);return}for(var t=0;t<s;t++)e[c+t]=i[r+t]}function Id(e){var i,r,s,c,t,n;for(s=0,i=0,r=e.length;i<r;i++)s+=e[i].length;for(n=new Uint8Array(s),c=0,i=0,r=e.length;i<r;i++)t=e[i],n.set(t,c),c+=t.length;return n}var jp=rt.Buf8=Uint8Array,Gp=rt.Buf16=Uint16Array,zp=rt.Buf32=Int32Array});var an=re(on=>{"use strict";Object.defineProperty(on,"__esModule",{value:!0});on.default=Dd;function Dd(e,i,r,s){for(var c=e&65535|0,t=e>>>16&65535|0,n=0;r!==0;){n=r>2e3?2e3:r,r-=n;do c=c+i[s++]|0,t=t+c|0;while(--n);c%=65521,t%=65521}return c|t<<16|0}});var ln=re(hn=>{"use strict";Object.defineProperty(hn,"__esModule",{value:!0});hn.default=ba;function ba(){for(var e,i=[],r=0;r<256;r++){e=r;for(var s=0;s<8;s++)e=e&1?3988292384^e>>>1:e>>>1;i[r]=e}return i}var Jp=ba()});var Aa=re(cn=>{"use strict";Object.defineProperty(cn,"__esModule",{value:!0});cn.default=Md;var br=30,Rd=12;function Md(e,i){var r,s,c,t,n,h,g,a,l,_,v,u,o,d,f,p,y,w,b,S,A,C,D,L,B;r=e.state,s=e.next_in,L=e.input,c=s+(e.avail_in-5),t=e.next_out,B=e.output,n=t-(i-e.avail_out),h=t+(e.avail_out-257),g=r.dmax,a=r.wsize,l=r.whave,_=r.wnext,v=r.window,u=r.hold,o=r.bits,d=r.lencode,f=r.distcode,p=(1<<r.lenbits)-1,y=(1<<r.distbits)-1;e:do{o<15&&(u+=L[s++]<<o,o+=8,u+=L[s++]<<o,o+=8),w=d[u&p];t:for(;;){if(b=w>>>24,u>>>=b,o-=b,b=w>>>16&255,b===0)B[t++]=w&65535;else if(b&16){S=w&65535,b&=15,b&&(o<b&&(u+=L[s++]<<o,o+=8),S+=u&(1<<b)-1,u>>>=b,o-=b),o<15&&(u+=L[s++]<<o,o+=8,u+=L[s++]<<o,o+=8),w=f[u&y];i:for(;;){if(b=w>>>24,u>>>=b,o-=b,b=w>>>16&255,b&16){if(A=w&65535,b&=15,o<b&&(u+=L[s++]<<o,o+=8,o<b&&(u+=L[s++]<<o,o+=8)),A+=u&(1<<b)-1,A>g){e.msg="invalid distance too far back",r.mode=br;break e}if(u>>>=b,o-=b,b=t-n,A>b){if(b=A-b,b>l&&r.sane){e.msg="invalid distance too far back",r.mode=br;break e}if(C=0,D=v,_===0){if(C+=a-b,b<S){S-=b;do B[t++]=v[C++];while(--b);C=t-A,D=B}}else if(_<b){if(C+=a+_-b,b-=_,b<S){S-=b;do B[t++]=v[C++];while(--b);if(C=0,_<S){b=_,S-=b;do B[t++]=v[C++];while(--b);C=t-A,D=B}}}else if(C+=_-b,b<S){S-=b;do B[t++]=v[C++];while(--b);C=t-A,D=B}for(;S>2;)B[t++]=D[C++],B[t++]=D[C++],B[t++]=D[C++],S-=3;S&&(B[t++]=D[C++],S>1&&(B[t++]=D[C++]))}else{C=t-A;do B[t++]=B[C++],B[t++]=B[C++],B[t++]=B[C++],S-=3;while(S>2);S&&(B[t++]=B[C++],S>1&&(B[t++]=B[C++]))}}else if(b&64){e.msg="invalid distance code",r.mode=br;break e}else{w=f[(w&65535)+(u&(1<<b)-1)];continue i}break}}else if(b&64)if(b&32){r.mode=Rd;break e}else{e.msg="invalid literal/length code",r.mode=br;break e}else{w=d[(w&65535)+(u&(1<<b)-1)];continue t}break}}while(s<c&&t<h);S=o>>3,s-=S,o-=S<<3,u&=(1<<o)-1,e.next_in=s,e.next_out=t,e.avail_in=s<c?5+(c-s):5-(s-c),e.avail_out=t<h?257+(h-t):257-(t-h),r.hold=u,r.bits=o}});var Ba=re(fn=>{"use strict";function dn(e){"@babel/helpers - typeof";return dn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},dn(e)}Object.defineProperty(fn,"__esModule",{value:!0});fn.default=Qd;var wa=Td(Ei());function ka(e){if(typeof WeakMap!="function")return null;var i=new WeakMap,r=new WeakMap;return(ka=function(c){return c?r:i})(e)}function Td(e,i){if(!i&&e&&e.__esModule)return e;if(e===null||dn(e)!="object"&&typeof e!="function")return{default:e};var r=ka(i);if(r&&r.has(e))return r.get(e);var s={__proto__:null},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var t in e)if(t!=="default"&&{}.hasOwnProperty.call(e,t)){var n=c?Object.getOwnPropertyDescriptor(e,t):null;n&&(n.get||n.set)?Object.defineProperty(s,t,n):s[t]=e[t]}return s.default=e,r&&r.set(e,s),s}var ai=15,Ca=852,xa=592,Sa=0,un=1,Ea=2,Fd=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Pd=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],Od=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Kd=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function Qd(e,i,r,s,c,t,n,h){var g=h.bits,a=0,l=0,_=0,v=0,u=0,o=0,d=0,f=0,p=0,y=0,w,b,S,A,C,D=null,L=0,B,R=new wa.Buf16(ai+1),F=new wa.Buf16(ai+1),K=null,Q=0,N,k,m;for(a=0;a<=ai;a++)R[a]=0;for(l=0;l<s;l++)R[i[r+l]]++;for(u=g,v=ai;v>=1&&R[v]===0;v--);if(u>v&&(u=v),v===0)return c[t++]=1<<24|64<<16|0,c[t++]=1<<24|64<<16|0,h.bits=1,0;for(_=1;_<v&&R[_]===0;_++);for(u<_&&(u=_),f=1,a=1;a<=ai;a++)if(f<<=1,f-=R[a],f<0)return-1;if(f>0&&(e===Sa||v!==1))return-1;for(F[1]=0,a=1;a<ai;a++)F[a+1]=F[a]+R[a];for(l=0;l<s;l++)i[r+l]!==0&&(n[F[i[r+l]]++]=l);if(e===Sa?(D=K=n,B=19):e===un?(D=Fd,L-=257,K=Pd,Q-=257,B=256):(D=Od,K=Kd,B=-1),y=0,l=0,a=_,C=t,o=u,d=0,S=-1,p=1<<u,A=p-1,e===un&&p>Ca||e===Ea&&p>xa)return 1;for(;;){N=a-d,n[l]<B?(k=0,m=n[l]):n[l]>B?(k=K[Q+n[l]],m=D[L+n[l]]):(k=96,m=0),w=1<<a-d,b=1<<o,_=b;do b-=w,c[C+(y>>d)+b]=N<<24|k<<16|m|0;while(b!==0);for(w=1<<a-1;y&w;)w>>=1;if(w!==0?(y&=w-1,y+=w):y=0,l++,--R[a]===0){if(a===v)break;a=i[r+n[l]]}if(a>u&&(y&A)!==S){for(d===0&&(d=u),C+=_,o=a-d,f=1<<o;o+d<v&&(f-=R[o+d],!(f<=0));)o++,f<<=1;if(p+=1<<o,e===un&&p>Ca||e===Ea&&p>xa)return 1;S=y&A,c[S]=u<<24|o<<16|C-t|0}}return y!==0&&(c[C+y]=a-d<<24|64<<16|0),h.bits=u,0}});var ch=re(fe=>{"use strict";function yn(e){"@babel/helpers - typeof";return yn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},yn(e)}Object.defineProperty(fe,"__esModule",{value:!0});fe.Z_TREES=fe.Z_STREAM_ERROR=fe.Z_STREAM_END=fe.Z_OK=fe.Z_NEED_DICT=fe.Z_MEM_ERROR=fe.Z_FINISH=fe.Z_DEFLATED=fe.Z_DATA_ERROR=fe.Z_BUF_ERROR=fe.Z_BLOCK=void 0;fe.inflate=tf;fe.inflateEnd=rf;fe.inflateGetHeader=sf;fe.inflateInfo=void 0;fe.inflateInit=Zd;fe.inflateInit2=hh;fe.inflateReset=oh;fe.inflateReset2=ah;fe.inflateResetKeep=nh;fe.inflateSetDictionary=nf;var Ge=Hd(Ei()),bn=Sr(an()),ht=Sr(ln()),Xd=Sr(Aa()),ki=Sr(Ba());function Sr(e){return e&&e.__esModule?e:{default:e}}function eh(e){if(typeof WeakMap!="function")return null;var i=new WeakMap,r=new WeakMap;return(eh=function(c){return c?r:i})(e)}function Hd(e,i){if(!i&&e&&e.__esModule)return e;if(e===null||yn(e)!="object"&&typeof e!="function")return{default:e};var r=eh(i);if(r&&r.has(e))return r.get(e);var s={__proto__:null},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var t in e)if(t!=="default"&&{}.hasOwnProperty.call(e,t)){var n=c?Object.getOwnPropertyDescriptor(e,t):null;n&&(n.get||n.set)?Object.defineProperty(s,t,n):s[t]=e[t]}return s.default=e,r&&r.set(e,s),s}var Nd=0,th=1,ih=2,La=fe.Z_FINISH=4,Ud=fe.Z_BLOCK=5,Ar=fe.Z_TREES=6,$t=fe.Z_OK=0,$d=fe.Z_STREAM_END=1,Wd=fe.Z_NEED_DICT=2,Ve=fe.Z_STREAM_ERROR=-2,rh=fe.Z_DATA_ERROR=-3,An=fe.Z_MEM_ERROR=-4,jd=fe.Z_BUF_ERROR=-5,Ia=fe.Z_DEFLATED=8,sh=1,Da=2,Ra=3,Ma=4,Ta=5,Fa=6,Pa=7,Oa=8,Ka=9,Qa=10,xr=11,bt=12,_n=13,Xa=14,gn=15,Ha=16,Na=17,Ua=18,$a=19,wr=20,Cr=21,Wa=22,ja=23,Ga=24,za=25,qa=26,pn=27,Va=28,Ja=29,Se=30,wn=31,Gd=32,zd=852,qd=592,Vd=15,Jd=Vd;function Ya(e){return(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24)}function Yd(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Ge.Buf16(320),this.work=new Ge.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function nh(e){var i;return!e||!e.state?Ve:(i=e.state,e.total_in=e.total_out=i.total=0,e.msg="",i.wrap&&(e.adler=i.wrap&1),i.mode=sh,i.last=0,i.havedict=0,i.dmax=32768,i.head=null,i.hold=0,i.bits=0,i.lencode=i.lendyn=new Ge.Buf32(zd),i.distcode=i.distdyn=new Ge.Buf32(qd),i.sane=1,i.back=-1,$t)}function oh(e){var i;return!e||!e.state?Ve:(i=e.state,i.wsize=0,i.whave=0,i.wnext=0,nh(e))}function ah(e,i){var r,s;return!e||!e.state||(s=e.state,i<0?(r=0,i=-i):(r=(i>>4)+1,i<48&&(i&=15)),i&&(i<8||i>15))?Ve:(s.window!==null&&s.wbits!==i&&(s.window=null),s.wrap=r,s.wbits=i,oh(e))}function hh(e,i){var r,s;return e?(s=new Yd,e.state=s,s.window=null,r=ah(e,i),r!==$t&&(e.state=null),r):Ve}function Zd(e){return hh(e,Jd)}var Za=!0,vn,mn;function ef(e){if(Za){var i;for(vn=new Ge.Buf32(512),mn=new Ge.Buf32(32),i=0;i<144;)e.lens[i++]=8;for(;i<256;)e.lens[i++]=9;for(;i<280;)e.lens[i++]=7;for(;i<288;)e.lens[i++]=8;for((0,ki.default)(th,e.lens,0,288,vn,0,e.work,{bits:9}),i=0;i<32;)e.lens[i++]=5;(0,ki.default)(ih,e.lens,0,32,mn,0,e.work,{bits:5}),Za=!1}e.lencode=vn,e.lenbits=9,e.distcode=mn,e.distbits=5}function lh(e,i,r,s){var c,t=e.state;return t.window===null&&(t.wsize=1<<t.wbits,t.wnext=0,t.whave=0,t.window=new Ge.Buf8(t.wsize)),s>=t.wsize?(Ge.arraySet(t.window,i,r-t.wsize,t.wsize,0),t.wnext=0,t.whave=t.wsize):(c=t.wsize-t.wnext,c>s&&(c=s),Ge.arraySet(t.window,i,r-s,c,t.wnext),s-=c,s?(Ge.arraySet(t.window,i,r-s,s,0),t.wnext=s,t.whave=t.wsize):(t.wnext+=c,t.wnext===t.wsize&&(t.wnext=0),t.whave<t.wsize&&(t.whave+=c))),0}function tf(e,i){var r,s,c,t,n,h,g,a,l,_,v,u,o,d,f=0,p,y,w,b,S,A,C,D,L=new Ge.Buf8(4),B,R,F=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&e.avail_in!==0)return Ve;r=e.state,r.mode===bt&&(r.mode=_n),n=e.next_out,c=e.output,g=e.avail_out,t=e.next_in,s=e.input,h=e.avail_in,a=r.hold,l=r.bits,_=h,v=g,D=$t;e:for(;;)switch(r.mode){case sh:if(r.wrap===0){r.mode=_n;break}for(;l<16;){if(h===0)break e;h--,a+=s[t++]<<l,l+=8}if(r.wrap&2&&a===35615){r.check=0,L[0]=a&255,L[1]=a>>>8&255,r.check=(0,ht.default)(r.check,L,2,0),a=0,l=0,r.mode=Da;break}if(r.flags=0,r.head&&(r.head.done=!1),!(r.wrap&1)||(((a&255)<<8)+(a>>8))%31){e.msg="incorrect header check",r.mode=Se;break}if((a&15)!==Ia){e.msg="unknown compression method",r.mode=Se;break}if(a>>>=4,l-=4,C=(a&15)+8,r.wbits===0)r.wbits=C;else if(C>r.wbits){e.msg="invalid window size",r.mode=Se;break}r.dmax=1<<C,e.adler=r.check=1,r.mode=a&512?Qa:bt,a=0,l=0;break;case Da:for(;l<16;){if(h===0)break e;h--,a+=s[t++]<<l,l+=8}if(r.flags=a,(r.flags&255)!==Ia){e.msg="unknown compression method",r.mode=Se;break}if(r.flags&57344){e.msg="unknown header flags set",r.mode=Se;break}r.head&&(r.head.text=a>>8&1),r.flags&512&&(L[0]=a&255,L[1]=a>>>8&255,r.check=(0,ht.default)(r.check,L,2,0)),a=0,l=0,r.mode=Ra;case Ra:for(;l<32;){if(h===0)break e;h--,a+=s[t++]<<l,l+=8}r.head&&(r.head.time=a),r.flags&512&&(L[0]=a&255,L[1]=a>>>8&255,L[2]=a>>>16&255,L[3]=a>>>24&255,r.check=(0,ht.default)(r.check,L,4,0)),a=0,l=0,r.mode=Ma;case Ma:for(;l<16;){if(h===0)break e;h--,a+=s[t++]<<l,l+=8}r.head&&(r.head.xflags=a&255,r.head.os=a>>8),r.flags&512&&(L[0]=a&255,L[1]=a>>>8&255,r.check=(0,ht.default)(r.check,L,2,0)),a=0,l=0,r.mode=Ta;case Ta:if(r.flags&1024){for(;l<16;){if(h===0)break e;h--,a+=s[t++]<<l,l+=8}r.length=a,r.head&&(r.head.extra_len=a),r.flags&512&&(L[0]=a&255,L[1]=a>>>8&255,r.check=(0,ht.default)(r.check,L,2,0)),a=0,l=0}else r.head&&(r.head.extra=null);r.mode=Fa;case Fa:if(r.flags&1024&&(u=r.length,u>h&&(u=h),u&&(r.head&&(C=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),Ge.arraySet(r.head.extra,s,t,u,C)),r.flags&512&&(r.check=(0,ht.default)(r.check,s,u,t)),h-=u,t+=u,r.length-=u),r.length))break e;r.length=0,r.mode=Pa;case Pa:if(r.flags&2048){if(h===0)break e;u=0;do C=s[t+u++],r.head&&C&&r.length<65536&&(r.head.name+=String.fromCharCode(C));while(C&&u<h);if(r.flags&512&&(r.check=(0,ht.default)(r.check,s,u,t)),h-=u,t+=u,C)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=Oa;case Oa:if(r.flags&4096){if(h===0)break e;u=0;do C=s[t+u++],r.head&&C&&r.length<65536&&(r.head.comment+=String.fromCharCode(C));while(C&&u<h);if(r.flags&512&&(r.check=(0,ht.default)(r.check,s,u,t)),h-=u,t+=u,C)break e}else r.head&&(r.head.comment=null);r.mode=Ka;case Ka:if(r.flags&512){for(;l<16;){if(h===0)break e;h--,a+=s[t++]<<l,l+=8}if(a!==(r.check&65535)){e.msg="header crc mismatch",r.mode=Se;break}a=0,l=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=bt;break;case Qa:for(;l<32;){if(h===0)break e;h--,a+=s[t++]<<l,l+=8}e.adler=r.check=Ya(a),a=0,l=0,r.mode=xr;case xr:if(r.havedict===0)return e.next_out=n,e.avail_out=g,e.next_in=t,e.avail_in=h,r.hold=a,r.bits=l,Wd;e.adler=r.check=1,r.mode=bt;case bt:if(i===Ud||i===Ar)break e;case _n:if(r.last){a>>>=l&7,l-=l&7,r.mode=pn;break}for(;l<3;){if(h===0)break e;h--,a+=s[t++]<<l,l+=8}switch(r.last=a&1,a>>>=1,l-=1,a&3){case 0:r.mode=Xa;break;case 1:if(ef(r),r.mode=wr,i===Ar){a>>>=2,l-=2;break e}break;case 2:r.mode=Na;break;case 3:e.msg="invalid block type",r.mode=Se}a>>>=2,l-=2;break;case Xa:for(a>>>=l&7,l-=l&7;l<32;){if(h===0)break e;h--,a+=s[t++]<<l,l+=8}if((a&65535)!==(a>>>16^65535)){e.msg="invalid stored block lengths",r.mode=Se;break}if(r.length=a&65535,a=0,l=0,r.mode=gn,i===Ar)break e;case gn:r.mode=Ha;case Ha:if(u=r.length,u){if(u>h&&(u=h),u>g&&(u=g),u===0)break e;Ge.arraySet(c,s,t,u,n),h-=u,t+=u,g-=u,n+=u,r.length-=u;break}r.mode=bt;break;case Na:for(;l<14;){if(h===0)break e;h--,a+=s[t++]<<l,l+=8}if(r.nlen=(a&31)+257,a>>>=5,l-=5,r.ndist=(a&31)+1,a>>>=5,l-=5,r.ncode=(a&15)+4,a>>>=4,l-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=Se;break}r.have=0,r.mode=Ua;case Ua:for(;r.have<r.ncode;){for(;l<3;){if(h===0)break e;h--,a+=s[t++]<<l,l+=8}r.lens[F[r.have++]]=a&7,a>>>=3,l-=3}for(;r.have<19;)r.lens[F[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,B={bits:r.lenbits},D=(0,ki.default)(Nd,r.lens,0,19,r.lencode,0,r.work,B),r.lenbits=B.bits,D){e.msg="invalid code lengths set",r.mode=Se;break}r.have=0,r.mode=$a;case $a:for(;r.have<r.nlen+r.ndist;){for(;f=r.lencode[a&(1<<r.lenbits)-1],p=f>>>24,y=f>>>16&255,w=f&65535,!(p<=l);){if(h===0)break e;h--,a+=s[t++]<<l,l+=8}if(w<16)a>>>=p,l-=p,r.lens[r.have++]=w;else{if(w===16){for(R=p+2;l<R;){if(h===0)break e;h--,a+=s[t++]<<l,l+=8}if(a>>>=p,l-=p,r.have===0){e.msg="invalid bit length repeat",r.mode=Se;break}C=r.lens[r.have-1],u=3+(a&3),a>>>=2,l-=2}else if(w===17){for(R=p+3;l<R;){if(h===0)break e;h--,a+=s[t++]<<l,l+=8}a>>>=p,l-=p,C=0,u=3+(a&7),a>>>=3,l-=3}else{for(R=p+7;l<R;){if(h===0)break e;h--,a+=s[t++]<<l,l+=8}a>>>=p,l-=p,C=0,u=11+(a&127),a>>>=7,l-=7}if(r.have+u>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=Se;break}for(;u--;)r.lens[r.have++]=C}}if(r.mode===Se)break;if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block",r.mode=Se;break}if(r.lenbits=9,B={bits:r.lenbits},D=(0,ki.default)(th,r.lens,0,r.nlen,r.lencode,0,r.work,B),r.lenbits=B.bits,D){e.msg="invalid literal/lengths set",r.mode=Se;break}if(r.distbits=6,r.distcode=r.distdyn,B={bits:r.distbits},D=(0,ki.default)(ih,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,B),r.distbits=B.bits,D){e.msg="invalid distances set",r.mode=Se;break}if(r.mode=wr,i===Ar)break e;case wr:r.mode=Cr;case Cr:if(h>=6&&g>=258){e.next_out=n,e.avail_out=g,e.next_in=t,e.avail_in=h,r.hold=a,r.bits=l,(0,Xd.default)(e,v),n=e.next_out,c=e.output,g=e.avail_out,t=e.next_in,s=e.input,h=e.avail_in,a=r.hold,l=r.bits,r.mode===bt&&(r.back=-1);break}for(r.back=0;f=r.lencode[a&(1<<r.lenbits)-1],p=f>>>24,y=f>>>16&255,w=f&65535,!(p<=l);){if(h===0)break e;h--,a+=s[t++]<<l,l+=8}if(y&&!(y&240)){for(b=p,S=y,A=w;f=r.lencode[A+((a&(1<<b+S)-1)>>b)],p=f>>>24,y=f>>>16&255,w=f&65535,!(b+p<=l);){if(h===0)break e;h--,a+=s[t++]<<l,l+=8}a>>>=b,l-=b,r.back+=b}if(a>>>=p,l-=p,r.back+=p,r.length=w,y===0){r.mode=qa;break}if(y&32){r.back=-1,r.mode=bt;break}if(y&64){e.msg="invalid literal/length code",r.mode=Se;break}r.extra=y&15,r.mode=Wa;case Wa:if(r.extra){for(R=r.extra;l<R;){if(h===0)break e;h--,a+=s[t++]<<l,l+=8}r.length+=a&(1<<r.extra)-1,a>>>=r.extra,l-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=ja;case ja:for(;f=r.distcode[a&(1<<r.distbits)-1],p=f>>>24,y=f>>>16&255,w=f&65535,!(p<=l);){if(h===0)break e;h--,a+=s[t++]<<l,l+=8}if(!(y&240)){for(b=p,S=y,A=w;f=r.distcode[A+((a&(1<<b+S)-1)>>b)],p=f>>>24,y=f>>>16&255,w=f&65535,!(b+p<=l);){if(h===0)break e;h--,a+=s[t++]<<l,l+=8}a>>>=b,l-=b,r.back+=b}if(a>>>=p,l-=p,r.back+=p,y&64){e.msg="invalid distance code",r.mode=Se;break}r.offset=w,r.extra=y&15,r.mode=Ga;case Ga:if(r.extra){for(R=r.extra;l<R;){if(h===0)break e;h--,a+=s[t++]<<l,l+=8}r.offset+=a&(1<<r.extra)-1,a>>>=r.extra,l-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=Se;break}r.mode=za;case za:if(g===0)break e;if(u=v-g,r.offset>u){if(u=r.offset-u,u>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=Se;break}u>r.wnext?(u-=r.wnext,o=r.wsize-u):o=r.wnext-u,u>r.length&&(u=r.length),d=r.window}else d=c,o=n-r.offset,u=r.length;u>g&&(u=g),g-=u,r.length-=u;do c[n++]=d[o++];while(--u);r.length===0&&(r.mode=Cr);break;case qa:if(g===0)break e;c[n++]=r.length,g--,r.mode=Cr;break;case pn:if(r.wrap){for(;l<32;){if(h===0)break e;h--,a|=s[t++]<<l,l+=8}if(v-=g,e.total_out+=v,r.total+=v,v&&(e.adler=r.check=r.flags?(0,ht.default)(r.check,c,v,n-v):(0,bn.default)(r.check,c,v,n-v)),v=g,(r.flags?a:Ya(a))!==r.check){e.msg="incorrect data check",r.mode=Se;break}a=0,l=0}r.mode=Va;case Va:if(r.wrap&&r.flags){for(;l<32;){if(h===0)break e;h--,a+=s[t++]<<l,l+=8}if(a!==(r.total&4294967295)){e.msg="incorrect length check",r.mode=Se;break}a=0,l=0}r.mode=Ja;case Ja:D=$d;break e;case Se:D=rh;break e;case wn:return An;case Gd:default:return Ve}return e.next_out=n,e.avail_out=g,e.next_in=t,e.avail_in=h,r.hold=a,r.bits=l,(r.wsize||v!==e.avail_out&&r.mode<Se&&(r.mode<pn||i!==La))&&lh(e,e.output,e.next_out,v-e.avail_out)?(r.mode=wn,An):(_-=e.avail_in,v-=e.avail_out,e.total_in+=_,e.total_out+=v,r.total+=v,r.wrap&&v&&(e.adler=r.check=r.flags?(0,ht.default)(r.check,c,v,e.next_out-v):(0,bn.default)(r.check,c,v,e.next_out-v)),e.data_type=r.bits+(r.last?64:0)+(r.mode===bt?128:0)+(r.mode===wr||r.mode===gn?256:0),(_===0&&v===0||i===La)&&D===$t&&(D=jd),D)}function rf(e){if(!e||!e.state)return Ve;var i=e.state;return i.window&&(i.window=null),e.state=null,$t}function sf(e,i){var r;return!e||!e.state||(r=e.state,!(r.wrap&2))?Ve:(r.head=i,i.done=!1,$t)}function nf(e,i){var r=i.length,s,c,t;return!e||!e.state||(s=e.state,s.wrap!==0&&s.mode!==xr)?Ve:s.mode===xr&&(c=1,c=(0,bn.default)(c,i,r,0),c!==s.check)?rh:(t=lh(e,i,r,r),t?(s.mode=wn,An):(s.havedict=1,$t))}var tv=fe.inflateInfo="pako inflate (from Nodeca project)"});var xn=re(Cn=>{"use strict";Object.defineProperty(Cn,"__esModule",{value:!0});Cn.default=of;function of(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}});var kr=re(Er=>{"use strict";Object.defineProperty(Er,"__esModule",{value:!0});Er.default=void 0;var Sn=ch(),af=hf(xn());function hf(e){return e&&e.__esModule?e:{default:e}}function Bi(e){"@babel/helpers - typeof";return Bi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Bi(e)}function lf(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function uh(e,i){for(var r=0;r<i.length;r++){var s=i[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,uf(s.key),s)}}function cf(e,i,r){return i&&uh(e.prototype,i),r&&uh(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function uf(e){var i=df(e,"string");return Bi(i)=="symbol"?i:i+""}function df(e,i){if(Bi(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,i||"default");if(Bi(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}var sv=Er.default=function(){function e(){lf(this,e),this.strm=new af.default,this.chunkSize=1024*10*10,this.strm.output=new Uint8Array(this.chunkSize),(0,Sn.inflateInit)(this.strm)}return cf(e,[{key:"setInput",value:function(r){r?(this.strm.input=r,this.strm.avail_in=this.strm.input.length,this.strm.next_in=0):(this.strm.input=null,this.strm.avail_in=0,this.strm.next_in=0)}},{key:"inflate",value:function(r){r>this.chunkSize&&(this.chunkSize=r,this.strm.output=new Uint8Array(this.chunkSize)),this.strm.next_out=0,this.strm.avail_out=r;var s=(0,Sn.inflate)(this.strm,0);if(s<0)throw new Error("zlib inflate failed");if(this.strm.next_out!=r)throw new Error("Incomplete zlib block");return new Uint8Array(this.strm.output.buffer,0,this.strm.next_out)}},{key:"reset",value:function(){(0,Sn.inflateReset)(this.strm)}}])}()});var Fh=re(jt=>{"use strict";function In(e){"@babel/helpers - typeof";return In=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},In(e)}Object.defineProperty(jt,"__esModule",{value:!0});jt._tr_align=Rf;jt._tr_flush_block=Mf;jt._tr_init=Df;jt._tr_stored_block=Th;jt._tr_tally=Tf;var ff=_f(Ei());function yh(e){if(typeof WeakMap!="function")return null;var i=new WeakMap,r=new WeakMap;return(yh=function(c){return c?r:i})(e)}function _f(e,i){if(!i&&e&&e.__esModule)return e;if(e===null||In(e)!="object"&&typeof e!="function")return{default:e};var r=yh(i);if(r&&r.has(e))return r.get(e);var s={__proto__:null},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var t in e)if(t!=="default"&&{}.hasOwnProperty.call(e,t)){var n=c?Object.getOwnPropertyDescriptor(e,t):null;n&&(n.get||n.set)?Object.defineProperty(s,t,n):s[t]=e[t]}return s.default=e,r&&r.set(e,s),s}var gf=4,dh=0,fh=1,pf=2;function li(e){for(var i=e.length;--i>=0;)e[i]=0}var vf=0,bh=1,mf=2,yf=3,bf=258,Mn=29,Ti=256,Ii=Ti+1+Mn,hi=30,Tn=19,Ah=2*Ii+1,Wt=15,En=16,Af=7,Fn=256,wh=16,Ch=17,xh=18,Dn=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Br=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],wf=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Sh=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Cf=512,At=new Array((Ii+2)*2);li(At);var Li=new Array(hi*2);li(Li);var Di=new Array(Cf);li(Di);var Ri=new Array(bf-yf+1);li(Ri);var Pn=new Array(Mn);li(Pn);var Lr=new Array(hi);li(Lr);function kn(e,i,r,s,c){this.static_tree=e,this.extra_bits=i,this.extra_base=r,this.elems=s,this.max_length=c,this.has_stree=e&&e.length}var Eh,kh,Bh;function Bn(e,i){this.dyn_tree=e,this.max_code=0,this.stat_desc=i}function Lh(e){return e<256?Di[e]:Di[256+(e>>>7)]}function Mi(e,i){e.pending_buf[e.pending++]=i&255,e.pending_buf[e.pending++]=i>>>8&255}function We(e,i,r){e.bi_valid>En-r?(e.bi_buf|=i<<e.bi_valid&65535,Mi(e,e.bi_buf),e.bi_buf=i>>En-e.bi_valid,e.bi_valid+=r-En):(e.bi_buf|=i<<e.bi_valid&65535,e.bi_valid+=r)}function lt(e,i,r){We(e,r[i*2],r[i*2+1])}function Ih(e,i){var r=0;do r|=e&1,e>>>=1,r<<=1;while(--i>0);return r>>>1}function xf(e){e.bi_valid===16?(Mi(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)}function Sf(e,i){var r=i.dyn_tree,s=i.max_code,c=i.stat_desc.static_tree,t=i.stat_desc.has_stree,n=i.stat_desc.extra_bits,h=i.stat_desc.extra_base,g=i.stat_desc.max_length,a,l,_,v,u,o,d=0;for(v=0;v<=Wt;v++)e.bl_count[v]=0;for(r[e.heap[e.heap_max]*2+1]=0,a=e.heap_max+1;a<Ah;a++)l=e.heap[a],v=r[r[l*2+1]*2+1]+1,v>g&&(v=g,d++),r[l*2+1]=v,!(l>s)&&(e.bl_count[v]++,u=0,l>=h&&(u=n[l-h]),o=r[l*2],e.opt_len+=o*(v+u),t&&(e.static_len+=o*(c[l*2+1]+u)));if(d!==0){do{for(v=g-1;e.bl_count[v]===0;)v--;e.bl_count[v]--,e.bl_count[v+1]+=2,e.bl_count[g]--,d-=2}while(d>0);for(v=g;v!==0;v--)for(l=e.bl_count[v];l!==0;)_=e.heap[--a],!(_>s)&&(r[_*2+1]!==v&&(e.opt_len+=(v-r[_*2+1])*r[_*2],r[_*2+1]=v),l--)}}function Dh(e,i,r){var s=new Array(Wt+1),c=0,t,n;for(t=1;t<=Wt;t++)s[t]=c=c+r[t-1]<<1;for(n=0;n<=i;n++){var h=e[n*2+1];h!==0&&(e[n*2]=Ih(s[h]++,h))}}function Ef(){var e,i,r,s,c,t=new Array(Wt+1);for(r=0,s=0;s<Mn-1;s++)for(Pn[s]=r,e=0;e<1<<Dn[s];e++)Ri[r++]=s;for(Ri[r-1]=s,c=0,s=0;s<16;s++)for(Lr[s]=c,e=0;e<1<<Br[s];e++)Di[c++]=s;for(c>>=7;s<hi;s++)for(Lr[s]=c<<7,e=0;e<1<<Br[s]-7;e++)Di[256+c++]=s;for(i=0;i<=Wt;i++)t[i]=0;for(e=0;e<=143;)At[e*2+1]=8,e++,t[8]++;for(;e<=255;)At[e*2+1]=9,e++,t[9]++;for(;e<=279;)At[e*2+1]=7,e++,t[7]++;for(;e<=287;)At[e*2+1]=8,e++,t[8]++;for(Dh(At,Ii+1,t),e=0;e<hi;e++)Li[e*2+1]=5,Li[e*2]=Ih(e,5);Eh=new kn(At,Dn,Ti+1,Ii,Wt),kh=new kn(Li,Br,0,hi,Wt),Bh=new kn(new Array(0),wf,0,Tn,Af)}function Rh(e){var i;for(i=0;i<Ii;i++)e.dyn_ltree[i*2]=0;for(i=0;i<hi;i++)e.dyn_dtree[i*2]=0;for(i=0;i<Tn;i++)e.bl_tree[i*2]=0;e.dyn_ltree[Fn*2]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function Mh(e){e.bi_valid>8?Mi(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function kf(e,i,r,s){Mh(e),s&&(Mi(e,r),Mi(e,~r)),ff.arraySet(e.pending_buf,e.window,i,r,e.pending),e.pending+=r}function _h(e,i,r,s){var c=i*2,t=r*2;return e[c]<e[t]||e[c]===e[t]&&s[i]<=s[r]}function Ln(e,i,r){for(var s=e.heap[r],c=r<<1;c<=e.heap_len&&(c<e.heap_len&&_h(i,e.heap[c+1],e.heap[c],e.depth)&&c++,!_h(i,s,e.heap[c],e.depth));)e.heap[r]=e.heap[c],r=c,c<<=1;e.heap[r]=s}function gh(e,i,r){var s,c,t=0,n,h;if(e.last_lit!==0)do s=e.pending_buf[e.d_buf+t*2]<<8|e.pending_buf[e.d_buf+t*2+1],c=e.pending_buf[e.l_buf+t],t++,s===0?lt(e,c,i):(n=Ri[c],lt(e,n+Ti+1,i),h=Dn[n],h!==0&&(c-=Pn[n],We(e,c,h)),s--,n=Lh(s),lt(e,n,r),h=Br[n],h!==0&&(s-=Lr[n],We(e,s,h)));while(t<e.last_lit);lt(e,Fn,i)}function Rn(e,i){var r=i.dyn_tree,s=i.stat_desc.static_tree,c=i.stat_desc.has_stree,t=i.stat_desc.elems,n,h,g=-1,a;for(e.heap_len=0,e.heap_max=Ah,n=0;n<t;n++)r[n*2]!==0?(e.heap[++e.heap_len]=g=n,e.depth[n]=0):r[n*2+1]=0;for(;e.heap_len<2;)a=e.heap[++e.heap_len]=g<2?++g:0,r[a*2]=1,e.depth[a]=0,e.opt_len--,c&&(e.static_len-=s[a*2+1]);for(i.max_code=g,n=e.heap_len>>1;n>=1;n--)Ln(e,r,n);a=t;do n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Ln(e,r,1),h=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=h,r[a*2]=r[n*2]+r[h*2],e.depth[a]=(e.depth[n]>=e.depth[h]?e.depth[n]:e.depth[h])+1,r[n*2+1]=r[h*2+1]=a,e.heap[1]=a++,Ln(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],Sf(e,i),Dh(r,g,e.bl_count)}function ph(e,i,r){var s,c=-1,t,n=i[0*2+1],h=0,g=7,a=4;for(n===0&&(g=138,a=3),i[(r+1)*2+1]=65535,s=0;s<=r;s++)t=n,n=i[(s+1)*2+1],!(++h<g&&t===n)&&(h<a?e.bl_tree[t*2]+=h:t!==0?(t!==c&&e.bl_tree[t*2]++,e.bl_tree[wh*2]++):h<=10?e.bl_tree[Ch*2]++:e.bl_tree[xh*2]++,h=0,c=t,n===0?(g=138,a=3):t===n?(g=6,a=3):(g=7,a=4))}function vh(e,i,r){var s,c=-1,t,n=i[0*2+1],h=0,g=7,a=4;for(n===0&&(g=138,a=3),s=0;s<=r;s++)if(t=n,n=i[(s+1)*2+1],!(++h<g&&t===n)){if(h<a)do lt(e,t,e.bl_tree);while(--h!==0);else t!==0?(t!==c&&(lt(e,t,e.bl_tree),h--),lt(e,wh,e.bl_tree),We(e,h-3,2)):h<=10?(lt(e,Ch,e.bl_tree),We(e,h-3,3)):(lt(e,xh,e.bl_tree),We(e,h-11,7));h=0,c=t,n===0?(g=138,a=3):t===n?(g=6,a=3):(g=7,a=4)}}function Bf(e){var i;for(ph(e,e.dyn_ltree,e.l_desc.max_code),ph(e,e.dyn_dtree,e.d_desc.max_code),Rn(e,e.bl_desc),i=Tn-1;i>=3&&e.bl_tree[Sh[i]*2+1]===0;i--);return e.opt_len+=3*(i+1)+5+5+4,i}function Lf(e,i,r,s){var c;for(We(e,i-257,5),We(e,r-1,5),We(e,s-4,4),c=0;c<s;c++)We(e,e.bl_tree[Sh[c]*2+1],3);vh(e,e.dyn_ltree,i-1),vh(e,e.dyn_dtree,r-1)}function If(e){var i=4093624447,r;for(r=0;r<=31;r++,i>>>=1)if(i&1&&e.dyn_ltree[r*2]!==0)return dh;if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0)return fh;for(r=32;r<Ti;r++)if(e.dyn_ltree[r*2]!==0)return fh;return dh}var mh=!1;function Df(e){mh||(Ef(),mh=!0),e.l_desc=new Bn(e.dyn_ltree,Eh),e.d_desc=new Bn(e.dyn_dtree,kh),e.bl_desc=new Bn(e.bl_tree,Bh),e.bi_buf=0,e.bi_valid=0,Rh(e)}function Th(e,i,r,s){We(e,(vf<<1)+(s?1:0),3),kf(e,i,r,!0)}function Rf(e){We(e,bh<<1,3),lt(e,Fn,At),xf(e)}function Mf(e,i,r,s){var c,t,n=0;e.level>0?(e.strm.data_type===pf&&(e.strm.data_type=If(e)),Rn(e,e.l_desc),Rn(e,e.d_desc),n=Bf(e),c=e.opt_len+3+7>>>3,t=e.static_len+3+7>>>3,t<=c&&(c=t)):c=t=r+5,r+4<=c&&i!==-1?Th(e,i,r,s):e.strategy===gf||t===c?(We(e,(bh<<1)+(s?1:0),3),gh(e,At,Li)):(We(e,(mf<<1)+(s?1:0),3),Lf(e,e.l_desc.max_code+1,e.d_desc.max_code+1,n+1),gh(e,e.dyn_ltree,e.dyn_dtree)),Rh(e),s&&Mh(e)}function Tf(e,i,r){return e.pending_buf[e.d_buf+e.last_lit*2]=i>>>8&255,e.pending_buf[e.d_buf+e.last_lit*2+1]=i&255,e.pending_buf[e.l_buf+e.last_lit]=r&255,e.last_lit++,i===0?e.dyn_ltree[r*2]++:(e.matches++,i--,e.dyn_ltree[(Ri[r]+Ti+1)*2]++,e.dyn_dtree[Lh(i)*2]++),e.last_lit===e.lit_bufsize-1}});var Ph=re(Ir=>{"use strict";Object.defineProperty(Ir,"__esModule",{value:!0});Ir.default=void 0;var av=Ir.default={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}});var Gh=re(oe=>{"use strict";function Qn(e){"@babel/helpers - typeof";return Qn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Qn(e)}Object.defineProperty(oe,"__esModule",{value:!0});oe.Z_UNKNOWN=oe.Z_STREAM_ERROR=oe.Z_STREAM_END=oe.Z_RLE=oe.Z_PARTIAL_FLUSH=oe.Z_OK=oe.Z_NO_FLUSH=oe.Z_HUFFMAN_ONLY=oe.Z_FULL_FLUSH=oe.Z_FIXED=oe.Z_FINISH=oe.Z_FILTERED=oe.Z_DEFLATED=oe.Z_DEFAULT_STRATEGY=oe.Z_DEFAULT_COMPRESSION=oe.Z_DATA_ERROR=oe.Z_BUF_ERROR=oe.Z_BLOCK=void 0;oe.deflate=c_;oe.deflateEnd=u_;oe.deflateInfo=void 0;oe.deflateInit=l_;oe.deflateInit2=jh;oe.deflateReset=Wh;oe.deflateResetKeep=$h;oe.deflateSetDictionary=d_;oe.deflateSetHeader=h_;var Ne=Nh(Ei()),Je=Nh(Fh()),Xh=Nn(an()),kt=Nn(ln()),Ff=Nn(Ph());function Nn(e){return e&&e.__esModule?e:{default:e}}function Hh(e){if(typeof WeakMap!="function")return null;var i=new WeakMap,r=new WeakMap;return(Hh=function(c){return c?r:i})(e)}function Nh(e,i){if(!i&&e&&e.__esModule)return e;if(e===null||Qn(e)!="object"&&typeof e!="function")return{default:e};var r=Hh(i);if(r&&r.has(e))return r.get(e);var s={__proto__:null},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var t in e)if(t!=="default"&&{}.hasOwnProperty.call(e,t)){var n=c?Object.getOwnPropertyDescriptor(e,t):null;n&&(n.get||n.set)?Object.defineProperty(s,t,n):s[t]=e[t]}return s.default=e,r&&r.set(e,s),s}var Vt=oe.Z_NO_FLUSH=0,Pf=oe.Z_PARTIAL_FLUSH=1,Of=oe.Z_FULL_FLUSH=3,Rt=oe.Z_FINISH=4,Oh=oe.Z_BLOCK=5,ut=oe.Z_OK=0,Kh=oe.Z_STREAM_END=1,Ye=oe.Z_STREAM_ERROR=-2,Kf=oe.Z_DATA_ERROR=-3,On=oe.Z_BUF_ERROR=-5,Qf=oe.Z_DEFAULT_COMPRESSION=-1,Xf=oe.Z_FILTERED=1,Dr=oe.Z_HUFFMAN_ONLY=2,Hf=oe.Z_RLE=3,Nf=oe.Z_FIXED=4,Uf=oe.Z_DEFAULT_STRATEGY=0,$f=oe.Z_UNKNOWN=2,Fr=oe.Z_DEFLATED=8,Wf=9,jf=15,Gf=8,zf=29,qf=256,Xn=qf+1+zf,Vf=30,Jf=19,Yf=2*Xn+1,Zf=15,_e=3,It=258,st=It+_e+1,e_=32,Pr=42,Hn=69,Rr=73,Mr=91,Tr=103,Gt=113,Pi=666,Re=1,Oi=2,zt=3,di=4,t_=3;function Dt(e,i){return e.msg=Ff.default[i],i}function Qh(e){return(e<<1)-(e>4?9:0)}function Lt(e){for(var i=e.length;--i>=0;)e[i]=0}function Bt(e){var i=e.state,r=i.pending;r>e.avail_out&&(r=e.avail_out),r!==0&&(Ne.arraySet(e.output,i.pending_buf,i.pending_out,r,e.next_out),e.next_out+=r,i.pending_out+=r,e.total_out+=r,e.avail_out-=r,i.pending-=r,i.pending===0&&(i.pending_out=0))}function Fe(e,i){Je._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,i),e.block_start=e.strstart,Bt(e.strm)}function ve(e,i){e.pending_buf[e.pending++]=i}function Fi(e,i){e.pending_buf[e.pending++]=i>>>8&255,e.pending_buf[e.pending++]=i&255}function i_(e,i,r,s){var c=e.avail_in;return c>s&&(c=s),c===0?0:(e.avail_in-=c,Ne.arraySet(i,e.input,e.next_in,c,r),e.state.wrap===1?e.adler=(0,Xh.default)(e.adler,i,c,r):e.state.wrap===2&&(e.adler=(0,kt.default)(e.adler,i,c,r)),e.next_in+=c,e.total_in+=c,c)}function Uh(e,i){var r=e.max_chain_length,s=e.strstart,c,t,n=e.prev_length,h=e.nice_match,g=e.strstart>e.w_size-st?e.strstart-(e.w_size-st):0,a=e.window,l=e.w_mask,_=e.prev,v=e.strstart+It,u=a[s+n-1],o=a[s+n];e.prev_length>=e.good_match&&(r>>=2),h>e.lookahead&&(h=e.lookahead);do if(c=i,!(a[c+n]!==o||a[c+n-1]!==u||a[c]!==a[s]||a[++c]!==a[s+1])){s+=2,c++;do;while(a[++s]===a[++c]&&a[++s]===a[++c]&&a[++s]===a[++c]&&a[++s]===a[++c]&&a[++s]===a[++c]&&a[++s]===a[++c]&&a[++s]===a[++c]&&a[++s]===a[++c]&&s<v);if(t=It-(v-s),s=v-It,t>n){if(e.match_start=i,n=t,t>=h)break;u=a[s+n-1],o=a[s+n]}}while((i=_[i&l])>g&&--r!==0);return n<=e.lookahead?n:e.lookahead}function qt(e){var i=e.w_size,r,s,c,t,n;do{if(t=e.window_size-e.lookahead-e.strstart,e.strstart>=i+(i-st)){Ne.arraySet(e.window,e.window,i,i,0),e.match_start-=i,e.strstart-=i,e.block_start-=i,s=e.hash_size,r=s;do c=e.head[--r],e.head[r]=c>=i?c-i:0;while(--s);s=i,r=s;do c=e.prev[--r],e.prev[r]=c>=i?c-i:0;while(--s);t+=i}if(e.strm.avail_in===0)break;if(s=i_(e.strm,e.window,e.strstart+e.lookahead,t),e.lookahead+=s,e.lookahead+e.insert>=_e)for(n=e.strstart-e.insert,e.ins_h=e.window[n],e.ins_h=(e.ins_h<<e.hash_shift^e.window[n+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[n+_e-1])&e.hash_mask,e.prev[n&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=n,n++,e.insert--,!(e.lookahead+e.insert<_e)););}while(e.lookahead<st&&e.strm.avail_in!==0)}function r_(e,i){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(qt(e),e.lookahead===0&&i===Vt)return Re;if(e.lookahead===0)break}e.strstart+=e.lookahead,e.lookahead=0;var s=e.block_start+r;if((e.strstart===0||e.strstart>=s)&&(e.lookahead=e.strstart-s,e.strstart=s,Fe(e,!1),e.strm.avail_out===0)||e.strstart-e.block_start>=e.w_size-st&&(Fe(e,!1),e.strm.avail_out===0))return Re}return e.insert=0,i===Rt?(Fe(e,!0),e.strm.avail_out===0?zt:di):(e.strstart>e.block_start&&(Fe(e,!1),e.strm.avail_out===0),Re)}function Kn(e,i){for(var r,s;;){if(e.lookahead<st){if(qt(e),e.lookahead<st&&i===Vt)return Re;if(e.lookahead===0)break}if(r=0,e.lookahead>=_e&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+_e-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),r!==0&&e.strstart-r<=e.w_size-st&&(e.match_length=Uh(e,r)),e.match_length>=_e)if(s=Je._tr_tally(e,e.strstart-e.match_start,e.match_length-_e),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=_e){e.match_length--;do e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+_e-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else s=Je._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(s&&(Fe(e,!1),e.strm.avail_out===0))return Re}return e.insert=e.strstart<_e-1?e.strstart:_e-1,i===Rt?(Fe(e,!0),e.strm.avail_out===0?zt:di):e.last_lit&&(Fe(e,!1),e.strm.avail_out===0)?Re:Oi}function ci(e,i){for(var r,s,c;;){if(e.lookahead<st){if(qt(e),e.lookahead<st&&i===Vt)return Re;if(e.lookahead===0)break}if(r=0,e.lookahead>=_e&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+_e-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=_e-1,r!==0&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-st&&(e.match_length=Uh(e,r),e.match_length<=5&&(e.strategy===Xf||e.match_length===_e&&e.strstart-e.match_start>4096)&&(e.match_length=_e-1)),e.prev_length>=_e&&e.match_length<=e.prev_length){c=e.strstart+e.lookahead-_e,s=Je._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-_e),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=c&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+_e-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=_e-1,e.strstart++,s&&(Fe(e,!1),e.strm.avail_out===0))return Re}else if(e.match_available){if(s=Je._tr_tally(e,0,e.window[e.strstart-1]),s&&Fe(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return Re}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(s=Je._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<_e-1?e.strstart:_e-1,i===Rt?(Fe(e,!0),e.strm.avail_out===0?zt:di):e.last_lit&&(Fe(e,!1),e.strm.avail_out===0)?Re:Oi}function s_(e,i){for(var r,s,c,t,n=e.window;;){if(e.lookahead<=It){if(qt(e),e.lookahead<=It&&i===Vt)return Re;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=_e&&e.strstart>0&&(c=e.strstart-1,s=n[c],s===n[++c]&&s===n[++c]&&s===n[++c])){t=e.strstart+It;do;while(s===n[++c]&&s===n[++c]&&s===n[++c]&&s===n[++c]&&s===n[++c]&&s===n[++c]&&s===n[++c]&&s===n[++c]&&c<t);e.match_length=It-(t-c),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=_e?(r=Je._tr_tally(e,1,e.match_length-_e),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=Je._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(Fe(e,!1),e.strm.avail_out===0))return Re}return e.insert=0,i===Rt?(Fe(e,!0),e.strm.avail_out===0?zt:di):e.last_lit&&(Fe(e,!1),e.strm.avail_out===0)?Re:Oi}function n_(e,i){for(var r;;){if(e.lookahead===0&&(qt(e),e.lookahead===0)){if(i===Vt)return Re;break}if(e.match_length=0,r=Je._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(Fe(e,!1),e.strm.avail_out===0))return Re}return e.insert=0,i===Rt?(Fe(e,!0),e.strm.avail_out===0?zt:di):e.last_lit&&(Fe(e,!1),e.strm.avail_out===0)?Re:Oi}function ct(e,i,r,s,c){this.good_length=e,this.max_lazy=i,this.nice_length=r,this.max_chain=s,this.func=c}var ui;ui=[new ct(0,0,0,0,r_),new ct(4,4,8,4,Kn),new ct(4,5,16,8,Kn),new ct(4,6,32,32,Kn),new ct(4,4,16,16,ci),new ct(8,16,32,32,ci),new ct(8,16,128,128,ci),new ct(8,32,128,256,ci),new ct(32,128,258,1024,ci),new ct(32,258,258,4096,ci)];function o_(e){e.window_size=2*e.w_size,Lt(e.head),e.max_lazy_match=ui[e.level].max_lazy,e.good_match=ui[e.level].good_length,e.nice_match=ui[e.level].nice_length,e.max_chain_length=ui[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=_e-1,e.match_available=0,e.ins_h=0}function a_(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Fr,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Ne.Buf16(Yf*2),this.dyn_dtree=new Ne.Buf16((2*Vf+1)*2),this.bl_tree=new Ne.Buf16((2*Jf+1)*2),Lt(this.dyn_ltree),Lt(this.dyn_dtree),Lt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Ne.Buf16(Zf+1),this.heap=new Ne.Buf16(2*Xn+1),Lt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Ne.Buf16(2*Xn+1),Lt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function $h(e){var i;return!e||!e.state?Dt(e,Ye):(e.total_in=e.total_out=0,e.data_type=$f,i=e.state,i.pending=0,i.pending_out=0,i.wrap<0&&(i.wrap=-i.wrap),i.status=i.wrap?Pr:Gt,e.adler=i.wrap===2?0:1,i.last_flush=Vt,Je._tr_init(i),ut)}function Wh(e){var i=$h(e);return i===ut&&o_(e.state),i}function h_(e,i){return!e||!e.state||e.state.wrap!==2?Ye:(e.state.gzhead=i,ut)}function jh(e,i,r,s,c,t){if(!e)return Ye;var n=1;if(i===Qf&&(i=6),s<0?(n=0,s=-s):s>15&&(n=2,s-=16),c<1||c>Wf||r!==Fr||s<8||s>15||i<0||i>9||t<0||t>Nf)return Dt(e,Ye);s===8&&(s=9);var h=new a_;return e.state=h,h.strm=e,h.wrap=n,h.gzhead=null,h.w_bits=s,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=c+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+_e-1)/_e),h.window=new Ne.Buf8(h.w_size*2),h.head=new Ne.Buf16(h.hash_size),h.prev=new Ne.Buf16(h.w_size),h.lit_bufsize=1<<c+6,h.pending_buf_size=h.lit_bufsize*4,h.pending_buf=new Ne.Buf8(h.pending_buf_size),h.d_buf=1*h.lit_bufsize,h.l_buf=3*h.lit_bufsize,h.level=i,h.strategy=t,h.method=r,Wh(e)}function l_(e,i){return jh(e,i,Fr,jf,Gf,Uf)}function c_(e,i){var r,s,c,t;if(!e||!e.state||i>Oh||i<0)return e?Dt(e,Ye):Ye;if(s=e.state,!e.output||!e.input&&e.avail_in!==0||s.status===Pi&&i!==Rt)return Dt(e,e.avail_out===0?On:Ye);if(s.strm=e,r=s.last_flush,s.last_flush=i,s.status===Pr)if(s.wrap===2)e.adler=0,ve(s,31),ve(s,139),ve(s,8),s.gzhead?(ve(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),ve(s,s.gzhead.time&255),ve(s,s.gzhead.time>>8&255),ve(s,s.gzhead.time>>16&255),ve(s,s.gzhead.time>>24&255),ve(s,s.level===9?2:s.strategy>=Dr||s.level<2?4:0),ve(s,s.gzhead.os&255),s.gzhead.extra&&s.gzhead.extra.length&&(ve(s,s.gzhead.extra.length&255),ve(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=(0,kt.default)(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=Hn):(ve(s,0),ve(s,0),ve(s,0),ve(s,0),ve(s,0),ve(s,s.level===9?2:s.strategy>=Dr||s.level<2?4:0),ve(s,t_),s.status=Gt);else{var n=Fr+(s.w_bits-8<<4)<<8,h=-1;s.strategy>=Dr||s.level<2?h=0:s.level<6?h=1:s.level===6?h=2:h=3,n|=h<<6,s.strstart!==0&&(n|=e_),n+=31-n%31,s.status=Gt,Fi(s,n),s.strstart!==0&&(Fi(s,e.adler>>>16),Fi(s,e.adler&65535)),e.adler=1}if(s.status===Hn)if(s.gzhead.extra){for(c=s.pending;s.gzindex<(s.gzhead.extra.length&65535)&&!(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>c&&(e.adler=(0,kt.default)(e.adler,s.pending_buf,s.pending-c,c)),Bt(e),c=s.pending,s.pending===s.pending_buf_size));)ve(s,s.gzhead.extra[s.gzindex]&255),s.gzindex++;s.gzhead.hcrc&&s.pending>c&&(e.adler=(0,kt.default)(e.adler,s.pending_buf,s.pending-c,c)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=Rr)}else s.status=Rr;if(s.status===Rr)if(s.gzhead.name){c=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>c&&(e.adler=(0,kt.default)(e.adler,s.pending_buf,s.pending-c,c)),Bt(e),c=s.pending,s.pending===s.pending_buf_size)){t=1;break}s.gzindex<s.gzhead.name.length?t=s.gzhead.name.charCodeAt(s.gzindex++)&255:t=0,ve(s,t)}while(t!==0);s.gzhead.hcrc&&s.pending>c&&(e.adler=(0,kt.default)(e.adler,s.pending_buf,s.pending-c,c)),t===0&&(s.gzindex=0,s.status=Mr)}else s.status=Mr;if(s.status===Mr)if(s.gzhead.comment){c=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>c&&(e.adler=(0,kt.default)(e.adler,s.pending_buf,s.pending-c,c)),Bt(e),c=s.pending,s.pending===s.pending_buf_size)){t=1;break}s.gzindex<s.gzhead.comment.length?t=s.gzhead.comment.charCodeAt(s.gzindex++)&255:t=0,ve(s,t)}while(t!==0);s.gzhead.hcrc&&s.pending>c&&(e.adler=(0,kt.default)(e.adler,s.pending_buf,s.pending-c,c)),t===0&&(s.status=Tr)}else s.status=Tr;if(s.status===Tr&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&Bt(e),s.pending+2<=s.pending_buf_size&&(ve(s,e.adler&255),ve(s,e.adler>>8&255),e.adler=0,s.status=Gt)):s.status=Gt),s.pending!==0){if(Bt(e),e.avail_out===0)return s.last_flush=-1,ut}else if(e.avail_in===0&&Qh(i)<=Qh(r)&&i!==Rt)return Dt(e,On);if(s.status===Pi&&e.avail_in!==0)return Dt(e,On);if(e.avail_in!==0||s.lookahead!==0||i!==Vt&&s.status!==Pi){var g=s.strategy===Dr?n_(s,i):s.strategy===Hf?s_(s,i):ui[s.level].func(s,i);if((g===zt||g===di)&&(s.status=Pi),g===Re||g===zt)return e.avail_out===0&&(s.last_flush=-1),ut;if(g===Oi&&(i===Pf?Je._tr_align(s):i!==Oh&&(Je._tr_stored_block(s,0,0,!1),i===Of&&(Lt(s.head),s.lookahead===0&&(s.strstart=0,s.block_start=0,s.insert=0))),Bt(e),e.avail_out===0))return s.last_flush=-1,ut}return i!==Rt?ut:s.wrap<=0?Kh:(s.wrap===2?(ve(s,e.adler&255),ve(s,e.adler>>8&255),ve(s,e.adler>>16&255),ve(s,e.adler>>24&255),ve(s,e.total_in&255),ve(s,e.total_in>>8&255),ve(s,e.total_in>>16&255),ve(s,e.total_in>>24&255)):(Fi(s,e.adler>>>16),Fi(s,e.adler&65535)),Bt(e),s.wrap>0&&(s.wrap=-s.wrap),s.pending!==0?ut:Kh)}function u_(e){var i;return!e||!e.state?Ye:(i=e.state.status,i!==Pr&&i!==Hn&&i!==Rr&&i!==Mr&&i!==Tr&&i!==Gt&&i!==Pi?Dt(e,Ye):(e.state=null,i===Gt?Dt(e,Kf):ut))}function d_(e,i){var r=i.length,s,c,t,n,h,g,a,l;if(!e||!e.state||(s=e.state,n=s.wrap,n===2||n===1&&s.status!==Pr||s.lookahead))return Ye;for(n===1&&(e.adler=(0,Xh.default)(e.adler,i,r,0)),s.wrap=0,r>=s.w_size&&(n===0&&(Lt(s.head),s.strstart=0,s.block_start=0,s.insert=0),l=new Ne.Buf8(s.w_size),Ne.arraySet(l,i,r-s.w_size,s.w_size,0),i=l,r=s.w_size),h=e.avail_in,g=e.next_in,a=e.input,e.avail_in=r,e.next_in=0,e.input=i,qt(s);s.lookahead>=_e;){c=s.strstart,t=s.lookahead-(_e-1);do s.ins_h=(s.ins_h<<s.hash_shift^s.window[c+_e-1])&s.hash_mask,s.prev[c&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=c,c++;while(--t);s.strstart=c,s.lookahead=_e-1,qt(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=_e-1,s.match_available=0,e.next_in=g,e.input=a,e.avail_in=h,s.wrap=n,ut}var lv=oe.deflateInfo="pako deflate (from Nodeca project)"});var qh=re(Or=>{"use strict";Object.defineProperty(Or,"__esModule",{value:!0});Or.default=void 0;var fi=Gh(),f_=__(xn());function __(e){return e&&e.__esModule?e:{default:e}}function Ki(e){"@babel/helpers - typeof";return Ki=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Ki(e)}function g_(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function zh(e,i){for(var r=0;r<i.length;r++){var s=i[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,v_(s.key),s)}}function p_(e,i,r){return i&&zh(e.prototype,i),r&&zh(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function v_(e){var i=m_(e,"string");return Ki(i)=="symbol"?i:i+""}function m_(e,i){if(Ki(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,i||"default");if(Ki(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}var uv=Or.default=function(){function e(){g_(this,e),this.strm=new f_.default,this.chunkSize=1024*10*10,this.outputBuffer=new Uint8Array(this.chunkSize),(0,fi.deflateInit)(this.strm,fi.Z_DEFAULT_COMPRESSION)}return p_(e,[{key:"deflate",value:function(r){this.strm.input=r,this.strm.avail_in=this.strm.input.length,this.strm.next_in=0,this.strm.output=this.outputBuffer,this.strm.avail_out=this.chunkSize,this.strm.next_out=0;var s=(0,fi.deflate)(this.strm,fi.Z_FULL_FLUSH),c=new Uint8Array(this.strm.output.buffer,0,this.strm.next_out);if(s<0)throw new Error("zlib deflate failed");if(this.strm.avail_in>0){var t=[c],n=c.length;do{if(this.strm.output=new Uint8Array(this.chunkSize),this.strm.next_out=0,this.strm.avail_out=this.chunkSize,s=(0,fi.deflate)(this.strm,fi.Z_FULL_FLUSH),s<0)throw new Error("zlib deflate failed");var h=new Uint8Array(this.strm.output.buffer,0,this.strm.next_out);n+=h.length,t.push(h)}while(this.strm.avail_in>0);for(var g=new Uint8Array(n),a=0,l=0;l<t.length;l++)g.set(t[l],a),a+=t[l].length;c=g}return this.strm.input=null,this.strm.avail_in=0,this.strm.next_in=0,c}}])}()});var _i=re(Kr=>{"use strict";Object.defineProperty(Kr,"__esModule",{value:!0});Kr.default=void 0;var fv=Kr.default={XK_VoidSymbol:16777215,XK_BackSpace:65288,XK_Tab:65289,XK_Linefeed:65290,XK_Clear:65291,XK_Return:65293,XK_Pause:65299,XK_Scroll_Lock:65300,XK_Sys_Req:65301,XK_Escape:65307,XK_Delete:65535,XK_Multi_key:65312,XK_Codeinput:65335,XK_SingleCandidate:65340,XK_MultipleCandidate:65341,XK_PreviousCandidate:65342,XK_Kanji:65313,XK_Muhenkan:65314,XK_Henkan_Mode:65315,XK_Henkan:65315,XK_Romaji:65316,XK_Hiragana:65317,XK_Katakana:65318,XK_Hiragana_Katakana:65319,XK_Zenkaku:65320,XK_Hankaku:65321,XK_Zenkaku_Hankaku:65322,XK_Touroku:65323,XK_Massyo:65324,XK_Kana_Lock:65325,XK_Kana_Shift:65326,XK_Eisu_Shift:65327,XK_Eisu_toggle:65328,XK_Kanji_Bangou:65335,XK_Zen_Koho:65341,XK_Mae_Koho:65342,XK_Home:65360,XK_Left:65361,XK_Up:65362,XK_Right:65363,XK_Down:65364,XK_Prior:65365,XK_Page_Up:65365,XK_Next:65366,XK_Page_Down:65366,XK_End:65367,XK_Begin:65368,XK_Select:65376,XK_Print:65377,XK_Execute:65378,XK_Insert:65379,XK_Undo:65381,XK_Redo:65382,XK_Menu:65383,XK_Find:65384,XK_Cancel:65385,XK_Help:65386,XK_Break:65387,XK_Mode_switch:65406,XK_script_switch:65406,XK_Num_Lock:65407,XK_KP_Space:65408,XK_KP_Tab:65417,XK_KP_Enter:65421,XK_KP_F1:65425,XK_KP_F2:65426,XK_KP_F3:65427,XK_KP_F4:65428,XK_KP_Home:65429,XK_KP_Left:65430,XK_KP_Up:65431,XK_KP_Right:65432,XK_KP_Down:65433,XK_KP_Prior:65434,XK_KP_Page_Up:65434,XK_KP_Next:65435,XK_KP_Page_Down:65435,XK_KP_End:65436,XK_KP_Begin:65437,XK_KP_Insert:65438,XK_KP_Delete:65439,XK_KP_Equal:65469,XK_KP_Multiply:65450,XK_KP_Add:65451,XK_KP_Separator:65452,XK_KP_Subtract:65453,XK_KP_Decimal:65454,XK_KP_Divide:65455,XK_KP_0:65456,XK_KP_1:65457,XK_KP_2:65458,XK_KP_3:65459,XK_KP_4:65460,XK_KP_5:65461,XK_KP_6:65462,XK_KP_7:65463,XK_KP_8:65464,XK_KP_9:65465,XK_F1:65470,XK_F2:65471,XK_F3:65472,XK_F4:65473,XK_F5:65474,XK_F6:65475,XK_F7:65476,XK_F8:65477,XK_F9:65478,XK_F10:65479,XK_F11:65480,XK_L1:65480,XK_F12:65481,XK_L2:65481,XK_F13:65482,XK_L3:65482,XK_F14:65483,XK_L4:65483,XK_F15:65484,XK_L5:65484,XK_F16:65485,XK_L6:65485,XK_F17:65486,XK_L7:65486,XK_F18:65487,XK_L8:65487,XK_F19:65488,XK_L9:65488,XK_F20:65489,XK_L10:65489,XK_F21:65490,XK_R1:65490,XK_F22:65491,XK_R2:65491,XK_F23:65492,XK_R3:65492,XK_F24:65493,XK_R4:65493,XK_F25:65494,XK_R5:65494,XK_F26:65495,XK_R6:65495,XK_F27:65496,XK_R7:65496,XK_F28:65497,XK_R8:65497,XK_F29:65498,XK_R9:65498,XK_F30:65499,XK_R10:65499,XK_F31:65500,XK_R11:65500,XK_F32:65501,XK_R12:65501,XK_F33:65502,XK_R13:65502,XK_F34:65503,XK_R14:65503,XK_F35:65504,XK_R15:65504,XK_Shift_L:65505,XK_Shift_R:65506,XK_Control_L:65507,XK_Control_R:65508,XK_Caps_Lock:65509,XK_Shift_Lock:65510,XK_Meta_L:65511,XK_Meta_R:65512,XK_Alt_L:65513,XK_Alt_R:65514,XK_Super_L:65515,XK_Super_R:65516,XK_Hyper_L:65517,XK_Hyper_R:65518,XK_ISO_Level3_Shift:65027,XK_ISO_Next_Group:65032,XK_ISO_Prev_Group:65034,XK_ISO_First_Group:65036,XK_ISO_Last_Group:65038,XK_space:32,XK_exclam:33,XK_quotedbl:34,XK_numbersign:35,XK_dollar:36,XK_percent:37,XK_ampersand:38,XK_apostrophe:39,XK_quoteright:39,XK_parenleft:40,XK_parenright:41,XK_asterisk:42,XK_plus:43,XK_comma:44,XK_minus:45,XK_period:46,XK_slash:47,XK_0:48,XK_1:49,XK_2:50,XK_3:51,XK_4:52,XK_5:53,XK_6:54,XK_7:55,XK_8:56,XK_9:57,XK_colon:58,XK_semicolon:59,XK_less:60,XK_equal:61,XK_greater:62,XK_question:63,XK_at:64,XK_A:65,XK_B:66,XK_C:67,XK_D:68,XK_E:69,XK_F:70,XK_G:71,XK_H:72,XK_I:73,XK_J:74,XK_K:75,XK_L:76,XK_M:77,XK_N:78,XK_O:79,XK_P:80,XK_Q:81,XK_R:82,XK_S:83,XK_T:84,XK_U:85,XK_V:86,XK_W:87,XK_X:88,XK_Y:89,XK_Z:90,XK_bracketleft:91,XK_backslash:92,XK_bracketright:93,XK_asciicircum:94,XK_underscore:95,XK_grave:96,XK_quoteleft:96,XK_a:97,XK_b:98,XK_c:99,XK_d:100,XK_e:101,XK_f:102,XK_g:103,XK_h:104,XK_i:105,XK_j:106,XK_k:107,XK_l:108,XK_m:109,XK_n:110,XK_o:111,XK_p:112,XK_q:113,XK_r:114,XK_s:115,XK_t:116,XK_u:117,XK_v:118,XK_w:119,XK_x:120,XK_y:121,XK_z:122,XK_braceleft:123,XK_bar:124,XK_braceright:125,XK_asciitilde:126,XK_nobreakspace:160,XK_exclamdown:161,XK_cent:162,XK_sterling:163,XK_currency:164,XK_yen:165,XK_brokenbar:166,XK_section:167,XK_diaeresis:168,XK_copyright:169,XK_ordfeminine:170,XK_guillemotleft:171,XK_notsign:172,XK_hyphen:173,XK_registered:174,XK_macron:175,XK_degree:176,XK_plusminus:177,XK_twosuperior:178,XK_threesuperior:179,XK_acute:180,XK_mu:181,XK_paragraph:182,XK_periodcentered:183,XK_cedilla:184,XK_onesuperior:185,XK_masculine:186,XK_guillemotright:187,XK_onequarter:188,XK_onehalf:189,XK_threequarters:190,XK_questiondown:191,XK_Agrave:192,XK_Aacute:193,XK_Acircumflex:194,XK_Atilde:195,XK_Adiaeresis:196,XK_Aring:197,XK_AE:198,XK_Ccedilla:199,XK_Egrave:200,XK_Eacute:201,XK_Ecircumflex:202,XK_Ediaeresis:203,XK_Igrave:204,XK_Iacute:205,XK_Icircumflex:206,XK_Idiaeresis:207,XK_ETH:208,XK_Eth:208,XK_Ntilde:209,XK_Ograve:210,XK_Oacute:211,XK_Ocircumflex:212,XK_Otilde:213,XK_Odiaeresis:214,XK_multiply:215,XK_Oslash:216,XK_Ooblique:216,XK_Ugrave:217,XK_Uacute:218,XK_Ucircumflex:219,XK_Udiaeresis:220,XK_Yacute:221,XK_THORN:222,XK_Thorn:222,XK_ssharp:223,XK_agrave:224,XK_aacute:225,XK_acircumflex:226,XK_atilde:227,XK_adiaeresis:228,XK_aring:229,XK_ae:230,XK_ccedilla:231,XK_egrave:232,XK_eacute:233,XK_ecircumflex:234,XK_ediaeresis:235,XK_igrave:236,XK_iacute:237,XK_icircumflex:238,XK_idiaeresis:239,XK_eth:240,XK_ntilde:241,XK_ograve:242,XK_oacute:243,XK_ocircumflex:244,XK_otilde:245,XK_odiaeresis:246,XK_division:247,XK_oslash:248,XK_ooblique:248,XK_ugrave:249,XK_uacute:250,XK_ucircumflex:251,XK_udiaeresis:252,XK_yacute:253,XK_thorn:254,XK_ydiaeresis:255,XK_Hangul:65329,XK_Hangul_Hanja:65332,XK_Hangul_Jeonja:65336,XF86XK_ModeLock:269025025,XF86XK_MonBrightnessUp:269025026,XF86XK_MonBrightnessDown:269025027,XF86XK_KbdLightOnOff:269025028,XF86XK_KbdBrightnessUp:269025029,XF86XK_KbdBrightnessDown:269025030,XF86XK_Standby:269025040,XF86XK_AudioLowerVolume:269025041,XF86XK_AudioMute:269025042,XF86XK_AudioRaiseVolume:269025043,XF86XK_AudioPlay:269025044,XF86XK_AudioStop:269025045,XF86XK_AudioPrev:269025046,XF86XK_AudioNext:269025047,XF86XK_HomePage:269025048,XF86XK_Mail:269025049,XF86XK_Start:269025050,XF86XK_Search:269025051,XF86XK_AudioRecord:269025052,XF86XK_Calculator:269025053,XF86XK_Memo:269025054,XF86XK_ToDoList:269025055,XF86XK_Calendar:269025056,XF86XK_PowerDown:269025057,XF86XK_ContrastAdjust:269025058,XF86XK_RockerUp:269025059,XF86XK_RockerDown:269025060,XF86XK_RockerEnter:269025061,XF86XK_Back:269025062,XF86XK_Forward:269025063,XF86XK_Stop:269025064,XF86XK_Refresh:269025065,XF86XK_PowerOff:269025066,XF86XK_WakeUp:269025067,XF86XK_Eject:269025068,XF86XK_ScreenSaver:269025069,XF86XK_WWW:269025070,XF86XK_Sleep:269025071,XF86XK_Favorites:269025072,XF86XK_AudioPause:269025073,XF86XK_AudioMedia:269025074,XF86XK_MyComputer:269025075,XF86XK_VendorHome:269025076,XF86XK_LightBulb:269025077,XF86XK_Shop:269025078,XF86XK_History:269025079,XF86XK_OpenURL:269025080,XF86XK_AddFavorite:269025081,XF86XK_HotLinks:269025082,XF86XK_BrightnessAdjust:269025083,XF86XK_Finance:269025084,XF86XK_Community:269025085,XF86XK_AudioRewind:269025086,XF86XK_BackForward:269025087,XF86XK_Launch0:269025088,XF86XK_Launch1:269025089,XF86XK_Launch2:269025090,XF86XK_Launch3:269025091,XF86XK_Launch4:269025092,XF86XK_Launch5:269025093,XF86XK_Launch6:269025094,XF86XK_Launch7:269025095,XF86XK_Launch8:269025096,XF86XK_Launch9:269025097,XF86XK_LaunchA:269025098,XF86XK_LaunchB:269025099,XF86XK_LaunchC:269025100,XF86XK_LaunchD:269025101,XF86XK_LaunchE:269025102,XF86XK_LaunchF:269025103,XF86XK_ApplicationLeft:269025104,XF86XK_ApplicationRight:269025105,XF86XK_Book:269025106,XF86XK_CD:269025107,XF86XK_Calculater:269025108,XF86XK_Clear:269025109,XF86XK_Close:269025110,XF86XK_Copy:269025111,XF86XK_Cut:269025112,XF86XK_Display:269025113,XF86XK_DOS:269025114,XF86XK_Documents:269025115,XF86XK_Excel:269025116,XF86XK_Explorer:269025117,XF86XK_Game:269025118,XF86XK_Go:269025119,XF86XK_iTouch:269025120,XF86XK_LogOff:269025121,XF86XK_Market:269025122,XF86XK_Meeting:269025123,XF86XK_MenuKB:269025125,XF86XK_MenuPB:269025126,XF86XK_MySites:269025127,XF86XK_New:269025128,XF86XK_News:269025129,XF86XK_OfficeHome:269025130,XF86XK_Open:269025131,XF86XK_Option:269025132,XF86XK_Paste:269025133,XF86XK_Phone:269025134,XF86XK_Q:269025136,XF86XK_Reply:269025138,XF86XK_Reload:269025139,XF86XK_RotateWindows:269025140,XF86XK_RotationPB:269025141,XF86XK_RotationKB:269025142,XF86XK_Save:269025143,XF86XK_ScrollUp:269025144,XF86XK_ScrollDown:269025145,XF86XK_ScrollClick:269025146,XF86XK_Send:269025147,XF86XK_Spell:269025148,XF86XK_SplitScreen:269025149,XF86XK_Support:269025150,XF86XK_TaskPane:269025151,XF86XK_Terminal:269025152,XF86XK_Tools:269025153,XF86XK_Travel:269025154,XF86XK_UserPB:269025156,XF86XK_User1KB:269025157,XF86XK_User2KB:269025158,XF86XK_Video:269025159,XF86XK_WheelButton:269025160,XF86XK_Word:269025161,XF86XK_Xfer:269025162,XF86XK_ZoomIn:269025163,XF86XK_ZoomOut:269025164,XF86XK_Away:269025165,XF86XK_Messenger:269025166,XF86XK_WebCam:269025167,XF86XK_MailForward:269025168,XF86XK_Pictures:269025169,XF86XK_Music:269025170,XF86XK_Battery:269025171,XF86XK_Bluetooth:269025172,XF86XK_WLAN:269025173,XF86XK_UWB:269025174,XF86XK_AudioForward:269025175,XF86XK_AudioRepeat:269025176,XF86XK_AudioRandomPlay:269025177,XF86XK_Subtitle:269025178,XF86XK_AudioCycleTrack:269025179,XF86XK_CycleAngle:269025180,XF86XK_FrameBack:269025181,XF86XK_FrameForward:269025182,XF86XK_Time:269025183,XF86XK_Select:269025184,XF86XK_View:269025185,XF86XK_TopMenu:269025186,XF86XK_Red:269025187,XF86XK_Green:269025188,XF86XK_Yellow:269025189,XF86XK_Blue:269025190,XF86XK_Suspend:269025191,XF86XK_Hibernate:269025192,XF86XK_TouchpadToggle:269025193,XF86XK_TouchpadOn:269025200,XF86XK_TouchpadOff:269025201,XF86XK_AudioMicMute:269025202,XF86XK_Switch_VT_1:269024769,XF86XK_Switch_VT_2:269024770,XF86XK_Switch_VT_3:269024771,XF86XK_Switch_VT_4:269024772,XF86XK_Switch_VT_5:269024773,XF86XK_Switch_VT_6:269024774,XF86XK_Switch_VT_7:269024775,XF86XK_Switch_VT_8:269024776,XF86XK_Switch_VT_9:269024777,XF86XK_Switch_VT_10:269024778,XF86XK_Switch_VT_11:269024779,XF86XK_Switch_VT_12:269024780,XF86XK_Ungrab:269024800,XF86XK_ClearGrab:269024801,XF86XK_Next_VMode:269024802,XF86XK_Prev_VMode:269024803,XF86XK_LogWindowTree:269024804,XF86XK_LogGrabInfo:269024805}});var Un=re(Qr=>{"use strict";Object.defineProperty(Qr,"__esModule",{value:!0});Qr.default=void 0;var y_={256:960,257:992,258:451,259:483,260:417,261:433,262:454,263:486,264:710,265:742,266:709,267:741,268:456,269:488,270:463,271:495,272:464,273:496,274:938,275:954,278:972,279:1004,280:458,281:490,282:460,283:492,284:728,285:760,286:683,287:699,288:725,289:757,290:939,291:955,292:678,293:694,294:673,295:689,296:933,297:949,298:975,299:1007,302:967,303:999,304:681,305:697,308:684,309:700,310:979,311:1011,312:930,313:453,314:485,315:934,316:950,317:421,318:437,321:419,322:435,323:465,324:497,325:977,326:1009,327:466,328:498,330:957,331:959,332:978,333:1010,336:469,337:501,338:5052,339:5053,340:448,341:480,342:931,343:947,344:472,345:504,346:422,347:438,348:734,349:766,350:426,351:442,352:425,353:441,354:478,355:510,356:427,357:443,358:940,359:956,360:989,361:1021,362:990,363:1022,364:733,365:765,366:473,367:505,368:475,369:507,370:985,371:1017,376:5054,377:428,378:444,379:431,380:447,381:430,382:446,402:2294,466:16777681,711:439,728:418,729:511,731:434,733:445,901:1966,902:1953,904:1954,905:1955,906:1956,908:1959,910:1960,911:1963,912:1974,913:1985,914:1986,915:1987,916:1988,917:1989,918:1990,919:1991,920:1992,921:1993,922:1994,923:1995,924:1996,925:1997,926:1998,927:1999,928:2e3,929:2001,931:2002,932:2004,933:2005,934:2006,935:2007,936:2008,937:2009,938:1957,939:1961,940:1969,941:1970,942:1971,943:1972,944:1978,945:2017,946:2018,947:2019,948:2020,949:2021,950:2022,951:2023,952:2024,953:2025,954:2026,955:2027,956:2028,957:2029,958:2030,959:2031,960:2032,961:2033,962:2035,963:2034,964:2036,965:2037,966:2038,967:2039,968:2040,969:2041,970:1973,971:1977,972:1975,973:1976,974:1979,1025:1715,1026:1713,1027:1714,1028:1716,1029:1717,1030:1718,1031:1719,1032:1720,1033:1721,1034:1722,1035:1723,1036:1724,1038:1726,1039:1727,1040:1761,1041:1762,1042:1783,1043:1767,1044:1764,1045:1765,1046:1782,1047:1786,1048:1769,1049:1770,1050:1771,1051:1772,1052:1773,1053:1774,1054:1775,1055:1776,1056:1778,1057:1779,1058:1780,1059:1781,1060:1766,1061:1768,1062:1763,1063:1790,1064:1787,1065:1789,1066:1791,1067:1785,1068:1784,1069:1788,1070:1760,1071:1777,1072:1729,1073:1730,1074:1751,1075:1735,1076:1732,1077:1733,1078:1750,1079:1754,1080:1737,1081:1738,1082:1739,1083:1740,1084:1741,1085:1742,1086:1743,1087:1744,1088:1746,1089:1747,1090:1748,1091:1749,1092:1734,1093:1736,1094:1731,1095:1758,1096:1755,1097:1757,1098:1759,1099:1753,1100:1752,1101:1756,1102:1728,1103:1745,1105:1699,1106:1697,1107:1698,1108:1700,1109:1701,1110:1702,1111:1703,1112:1704,1113:1705,1114:1706,1115:1707,1116:1708,1118:1710,1119:1711,1168:1725,1169:1709,1488:3296,1489:3297,1490:3298,1491:3299,1492:3300,1493:3301,1494:3302,1495:3303,1496:3304,1497:3305,1498:3306,1499:3307,1500:3308,1501:3309,1502:3310,1503:3311,1504:3312,1505:3313,1506:3314,1507:3315,1508:3316,1509:3317,1510:3318,1511:3319,1512:3320,1513:3321,1514:3322,1548:1452,1563:1467,1567:1471,1569:1473,1570:1474,1571:1475,1572:1476,1573:1477,1574:1478,1575:1479,1576:1480,1577:1481,1578:1482,1579:1483,1580:1484,1581:1485,1582:1486,1583:1487,1584:1488,1585:1489,1586:1490,1587:1491,1588:1492,1589:1493,1590:1494,1591:1495,1592:1496,1593:1497,1594:1498,1600:1504,1601:1505,1602:1506,1603:1507,1604:1508,1605:1509,1606:1510,1607:1511,1608:1512,1609:1513,1610:1514,1611:1515,1612:1516,1613:1517,1614:1518,1615:1519,1616:1520,1617:1521,1618:1522,3585:3489,3586:3490,3587:3491,3588:3492,3589:3493,3590:3494,3591:3495,3592:3496,3593:3497,3594:3498,3595:3499,3596:3500,3597:3501,3598:3502,3599:3503,3600:3504,3601:3505,3602:3506,3603:3507,3604:3508,3605:3509,3606:3510,3607:3511,3608:3512,3609:3513,3610:3514,3611:3515,3612:3516,3613:3517,3614:3518,3615:3519,3616:3520,3617:3521,3618:3522,3619:3523,3620:3524,3621:3525,3622:3526,3623:3527,3624:3528,3625:3529,3626:3530,3627:3531,3628:3532,3629:3533,3630:3534,3631:3535,3632:3536,3633:3537,3634:3538,3635:3539,3636:3540,3637:3541,3638:3542,3639:3543,3640:3544,3641:3545,3642:3546,3647:3551,3648:3552,3649:3553,3650:3554,3651:3555,3652:3556,3653:3557,3654:3558,3655:3559,3656:3560,3657:3561,3658:3562,3659:3563,3660:3564,3661:3565,3664:3568,3665:3569,3666:3570,3667:3571,3668:3572,3669:3573,3670:3574,3671:3575,3672:3576,3673:3577,8194:2722,8195:2721,8196:2723,8197:2724,8199:2725,8200:2726,8201:2727,8202:2728,8210:2747,8211:2730,8212:2729,8213:1967,8215:3295,8216:2768,8217:2769,8218:2813,8220:2770,8221:2771,8222:2814,8224:2801,8225:2802,8226:2790,8229:2735,8230:2734,8240:2773,8242:2774,8243:2775,8248:2812,8254:1150,8361:3839,8364:8364,8453:2744,8470:1712,8471:2811,8478:2772,8482:2761,8531:2736,8532:2737,8533:2738,8534:2739,8535:2740,8536:2741,8537:2742,8538:2743,8539:2755,8540:2756,8541:2757,8542:2758,8592:2299,8593:2300,8594:2301,8595:2302,8658:2254,8660:2253,8706:2287,8711:2245,8728:3018,8730:2262,8733:2241,8734:2242,8743:2270,8744:2271,8745:2268,8746:2269,8747:2239,8756:2240,8764:2248,8771:2249,8773:16785992,8800:2237,8801:2255,8804:2236,8805:2238,8834:2266,8835:2267,8866:3068,8867:3036,8868:3010,8869:3022,8968:3027,8970:3012,8981:2810,8992:2212,8993:2213,9109:3020,9115:2219,9117:2220,9118:2221,9120:2222,9121:2215,9123:2216,9124:2217,9126:2218,9128:2223,9132:2224,9143:2209,9146:2543,9147:2544,9148:2546,9149:2547,9225:2530,9226:2533,9227:2537,9228:2531,9229:2532,9251:2732,9252:2536,9472:2211,9474:2214,9484:2210,9488:2539,9492:2541,9496:2538,9500:2548,9508:2549,9516:2551,9524:2550,9532:2542,9618:2529,9642:2791,9643:2785,9644:2779,9645:2786,9646:2783,9647:2767,9650:2792,9651:2787,9654:2781,9655:2765,9660:2793,9661:2788,9664:2780,9665:2764,9670:2528,9675:2766,9679:2782,9702:2784,9734:2789,9742:2809,9747:2762,9756:2794,9758:2795,9792:2808,9794:2807,9827:2796,9829:2798,9830:2797,9837:2806,9839:2805,10003:2803,10007:2804,10013:2777,10016:2800,10216:2748,10217:2750,12289:1188,12290:1185,12300:1186,12301:1187,12443:1246,12444:1247,12449:1191,12450:1201,12451:1192,12452:1202,12453:1193,12454:1203,12455:1194,12456:1204,12457:1195,12458:1205,12459:1206,12461:1207,12463:1208,12465:1209,12467:1210,12469:1211,12471:1212,12473:1213,12475:1214,12477:1215,12479:1216,12481:1217,12483:1199,12484:1218,12486:1219,12488:1220,12490:1221,12491:1222,12492:1223,12493:1224,12494:1225,12495:1226,12498:1227,12501:1228,12504:1229,12507:1230,12510:1231,12511:1232,12512:1233,12513:1234,12514:1235,12515:1196,12516:1236,12517:1197,12518:1237,12519:1198,12520:1238,12521:1239,12522:1240,12523:1241,12524:1242,12525:1243,12527:1244,12530:1190,12531:1245,12539:1189,12540:1200},gv=Qr.default={lookup:function(i){if(i>=32&&i<=255)return i;var r=y_[i];return r!==void 0?r:16777216|i}}});var Vh=re(Xr=>{"use strict";Object.defineProperty(Xr,"__esModule",{value:!0});Xr.default=void 0;var vv=Xr.default={8:"Backspace",9:"Tab",10:"NumpadClear",13:"Enter",16:"ShiftLeft",17:"ControlLeft",18:"AltLeft",19:"Pause",20:"CapsLock",21:"Lang1",25:"Lang2",27:"Escape",28:"Convert",29:"NonConvert",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",41:"Select",44:"PrintScreen",45:"Insert",46:"Delete",47:"Help",48:"Digit0",49:"Digit1",50:"Digit2",51:"Digit3",52:"Digit4",53:"Digit5",54:"Digit6",55:"Digit7",56:"Digit8",57:"Digit9",91:"MetaLeft",92:"MetaRight",93:"ContextMenu",95:"Sleep",96:"Numpad0",97:"Numpad1",98:"Numpad2",99:"Numpad3",100:"Numpad4",101:"Numpad5",102:"Numpad6",103:"Numpad7",104:"Numpad8",105:"Numpad9",106:"NumpadMultiply",107:"NumpadAdd",108:"NumpadDecimal",109:"NumpadSubtract",110:"NumpadDecimal",111:"NumpadDivide",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",124:"F13",125:"F14",126:"F15",127:"F16",128:"F17",129:"F18",130:"F19",131:"F20",132:"F21",133:"F22",134:"F23",135:"F24",144:"NumLock",145:"ScrollLock",166:"BrowserBack",167:"BrowserForward",168:"BrowserRefresh",169:"BrowserStop",170:"BrowserSearch",171:"BrowserFavorites",172:"BrowserHome",173:"AudioVolumeMute",174:"AudioVolumeDown",175:"AudioVolumeUp",176:"MediaTrackNext",177:"MediaTrackPrevious",178:"MediaStop",179:"MediaPlayPause",180:"LaunchMail",181:"MediaSelect",182:"LaunchApp1",183:"LaunchApp2",225:"AltRight"}});var Jh=re(Hr=>{"use strict";Object.defineProperty(Hr,"__esModule",{value:!0});Hr.default=void 0;var yv=Hr.default={Backspace:"Backspace",AltLeft:"Alt",AltRight:"Alt",CapsLock:"CapsLock",ContextMenu:"ContextMenu",ControlLeft:"Control",ControlRight:"Control",Enter:"Enter",MetaLeft:"Meta",MetaRight:"Meta",ShiftLeft:"Shift",ShiftRight:"Shift",Tab:"Tab",Delete:"Delete",End:"End",Help:"Help",Home:"Home",Insert:"Insert",PageDown:"PageDown",PageUp:"PageUp",ArrowDown:"ArrowDown",ArrowLeft:"ArrowLeft",ArrowRight:"ArrowRight",ArrowUp:"ArrowUp",NumLock:"NumLock",NumpadBackspace:"Backspace",NumpadClear:"Clear",Escape:"Escape",F1:"F1",F2:"F2",F3:"F3",F4:"F4",F5:"F5",F6:"F6",F7:"F7",F8:"F8",F9:"F9",F10:"F10",F11:"F11",F12:"F12",F13:"F13",F14:"F14",F15:"F15",F16:"F16",F17:"F17",F18:"F18",F19:"F19",F20:"F20",F21:"F21",F22:"F22",F23:"F23",F24:"F24",F25:"F25",F26:"F26",F27:"F27",F28:"F28",F29:"F29",F30:"F30",F31:"F31",F32:"F32",F33:"F33",F34:"F34",F35:"F35",PrintScreen:"PrintScreen",ScrollLock:"ScrollLock",Pause:"Pause",BrowserBack:"BrowserBack",BrowserFavorites:"BrowserFavorites",BrowserForward:"BrowserForward",BrowserHome:"BrowserHome",BrowserRefresh:"BrowserRefresh",BrowserSearch:"BrowserSearch",BrowserStop:"BrowserStop",Eject:"Eject",LaunchApp1:"LaunchMyComputer",LaunchApp2:"LaunchCalendar",LaunchMail:"LaunchMail",MediaPlayPause:"MediaPlay",MediaStop:"MediaStop",MediaTrackNext:"MediaTrackNext",MediaTrackPrevious:"MediaTrackPrevious",Power:"Power",Sleep:"Sleep",AudioVolumeDown:"AudioVolumeDown",AudioVolumeMute:"AudioVolumeMute",AudioVolumeUp:"AudioVolumeUp",WakeUp:"WakeUp"}});var Yh=re(Ur=>{"use strict";Object.defineProperty(Ur,"__esModule",{value:!0});Ur.default=void 0;var H=b_(_i());function b_(e){return e&&e.__esModule?e:{default:e}}var Jt={};function V(e,i){if(i===void 0)throw new Error('Undefined keysym for key "'+e+'"');if(e in Jt)throw new Error('Duplicate entry for key "'+e+'"');Jt[e]=[i,i,i,i]}function Nr(e,i,r){if(i===void 0)throw new Error('Undefined keysym for key "'+e+'"');if(r===void 0)throw new Error('Undefined keysym for key "'+e+'"');if(e in Jt)throw new Error('Duplicate entry for key "'+e+'"');Jt[e]=[i,i,r,i]}function me(e,i,r){if(i===void 0)throw new Error('Undefined keysym for key "'+e+'"');if(r===void 0)throw new Error('Undefined keysym for key "'+e+'"');if(e in Jt)throw new Error('Duplicate entry for key "'+e+'"');Jt[e]=[i,i,i,r]}Nr("Alt",H.default.XK_Alt_L,H.default.XK_Alt_R);V("AltGraph",H.default.XK_ISO_Level3_Shift);V("CapsLock",H.default.XK_Caps_Lock);Nr("Control",H.default.XK_Control_L,H.default.XK_Control_R);Nr("Meta",H.default.XK_Super_L,H.default.XK_Super_R);V("NumLock",H.default.XK_Num_Lock);V("ScrollLock",H.default.XK_Scroll_Lock);Nr("Shift",H.default.XK_Shift_L,H.default.XK_Shift_R);me("Enter",H.default.XK_Return,H.default.XK_KP_Enter);V("Tab",H.default.XK_Tab);me(" ",H.default.XK_space,H.default.XK_KP_Space);me("ArrowDown",H.default.XK_Down,H.default.XK_KP_Down);me("ArrowLeft",H.default.XK_Left,H.default.XK_KP_Left);me("ArrowRight",H.default.XK_Right,H.default.XK_KP_Right);me("ArrowUp",H.default.XK_Up,H.default.XK_KP_Up);me("End",H.default.XK_End,H.default.XK_KP_End);me("Home",H.default.XK_Home,H.default.XK_KP_Home);me("PageDown",H.default.XK_Next,H.default.XK_KP_Next);me("PageUp",H.default.XK_Prior,H.default.XK_KP_Prior);V("Backspace",H.default.XK_BackSpace);me("Clear",H.default.XK_Clear,H.default.XK_KP_Begin);V("Copy",H.default.XF86XK_Copy);V("Cut",H.default.XF86XK_Cut);me("Delete",H.default.XK_Delete,H.default.XK_KP_Delete);me("Insert",H.default.XK_Insert,H.default.XK_KP_Insert);V("Paste",H.default.XF86XK_Paste);V("Redo",H.default.XK_Redo);V("Undo",H.default.XK_Undo);V("Cancel",H.default.XK_Cancel);V("ContextMenu",H.default.XK_Menu);V("Escape",H.default.XK_Escape);V("Execute",H.default.XK_Execute);V("Find",H.default.XK_Find);V("Help",H.default.XK_Help);V("Pause",H.default.XK_Pause);V("Select",H.default.XK_Select);V("ZoomIn",H.default.XF86XK_ZoomIn);V("ZoomOut",H.default.XF86XK_ZoomOut);V("BrightnessDown",H.default.XF86XK_MonBrightnessDown);V("BrightnessUp",H.default.XF86XK_MonBrightnessUp);V("Eject",H.default.XF86XK_Eject);V("LogOff",H.default.XF86XK_LogOff);V("Power",H.default.XF86XK_PowerOff);V("PowerOff",H.default.XF86XK_PowerDown);V("PrintScreen",H.default.XK_Print);V("Hibernate",H.default.XF86XK_Hibernate);V("Standby",H.default.XF86XK_Standby);V("WakeUp",H.default.XF86XK_WakeUp);V("AllCandidates",H.default.XK_MultipleCandidate);V("Alphanumeric",H.default.XK_Eisu_toggle);V("CodeInput",H.default.XK_Codeinput);V("Compose",H.default.XK_Multi_key);V("Convert",H.default.XK_Henkan);V("GroupFirst",H.default.XK_ISO_First_Group);V("GroupLast",H.default.XK_ISO_Last_Group);V("GroupNext",H.default.XK_ISO_Next_Group);V("GroupPrevious",H.default.XK_ISO_Prev_Group);V("NonConvert",H.default.XK_Muhenkan);V("PreviousCandidate",H.default.XK_PreviousCandidate);V("SingleCandidate",H.default.XK_SingleCandidate);V("HangulMode",H.default.XK_Hangul);V("HanjaMode",H.default.XK_Hangul_Hanja);V("JunjaMode",H.default.XK_Hangul_Jeonja);V("Eisu",H.default.XK_Eisu_toggle);V("Hankaku",H.default.XK_Hankaku);V("Hiragana",H.default.XK_Hiragana);V("HiraganaKatakana",H.default.XK_Hiragana_Katakana);V("KanaMode",H.default.XK_Kana_Shift);V("KanjiMode",H.default.XK_Kanji);V("Katakana",H.default.XK_Katakana);V("Romaji",H.default.XK_Romaji);V("Zenkaku",H.default.XK_Zenkaku);V("ZenkakuHankaku",H.default.XK_Zenkaku_Hankaku);V("F1",H.default.XK_F1);V("F2",H.default.XK_F2);V("F3",H.default.XK_F3);V("F4",H.default.XK_F4);V("F5",H.default.XK_F5);V("F6",H.default.XK_F6);V("F7",H.default.XK_F7);V("F8",H.default.XK_F8);V("F9",H.default.XK_F9);V("F10",H.default.XK_F10);V("F11",H.default.XK_F11);V("F12",H.default.XK_F12);V("F13",H.default.XK_F13);V("F14",H.default.XK_F14);V("F15",H.default.XK_F15);V("F16",H.default.XK_F16);V("F17",H.default.XK_F17);V("F18",H.default.XK_F18);V("F19",H.default.XK_F19);V("F20",H.default.XK_F20);V("F21",H.default.XK_F21);V("F22",H.default.XK_F22);V("F23",H.default.XK_F23);V("F24",H.default.XK_F24);V("F25",H.default.XK_F25);V("F26",H.default.XK_F26);V("F27",H.default.XK_F27);V("F28",H.default.XK_F28);V("F29",H.default.XK_F29);V("F30",H.default.XK_F30);V("F31",H.default.XK_F31);V("F32",H.default.XK_F32);V("F33",H.default.XK_F33);V("F34",H.default.XK_F34);V("F35",H.default.XK_F35);V("Close",H.default.XF86XK_Close);V("MailForward",H.default.XF86XK_MailForward);V("MailReply",H.default.XF86XK_Reply);V("MailSend",H.default.XF86XK_Send);V("MediaFastForward",H.default.XF86XK_AudioForward);V("MediaPause",H.default.XF86XK_AudioPause);V("MediaPlay",H.default.XF86XK_AudioPlay);V("MediaRecord",H.default.XF86XK_AudioRecord);V("MediaRewind",H.default.XF86XK_AudioRewind);V("MediaStop",H.default.XF86XK_AudioStop);V("MediaTrackNext",H.default.XF86XK_AudioNext);V("MediaTrackPrevious",H.default.XF86XK_AudioPrev);V("New",H.default.XF86XK_New);V("Open",H.default.XF86XK_Open);V("Print",H.default.XK_Print);V("Save",H.default.XF86XK_Save);V("SpellCheck",H.default.XF86XK_Spell);V("AudioVolumeDown",H.default.XF86XK_AudioLowerVolume);V("AudioVolumeUp",H.default.XF86XK_AudioRaiseVolume);V("AudioVolumeMute",H.default.XF86XK_AudioMute);V("MicrophoneVolumeMute",H.default.XF86XK_AudioMicMute);V("LaunchApplication1",H.default.XF86XK_MyComputer);V("LaunchApplication2",H.default.XF86XK_Calculator);V("LaunchCalendar",H.default.XF86XK_Calendar);V("LaunchMail",H.default.XF86XK_Mail);V("LaunchMediaPlayer",H.default.XF86XK_AudioMedia);V("LaunchMusicPlayer",H.default.XF86XK_Music);V("LaunchPhone",H.default.XF86XK_Phone);V("LaunchScreenSaver",H.default.XF86XK_ScreenSaver);V("LaunchSpreadsheet",H.default.XF86XK_Excel);V("LaunchWebBrowser",H.default.XF86XK_WWW);V("LaunchWebCam",H.default.XF86XK_WebCam);V("LaunchWordProcessor",H.default.XF86XK_Word);V("BrowserBack",H.default.XF86XK_Back);V("BrowserFavorites",H.default.XF86XK_Favorites);V("BrowserForward",H.default.XF86XK_Forward);V("BrowserHome",H.default.XF86XK_HomePage);V("BrowserRefresh",H.default.XF86XK_Refresh);V("BrowserSearch",H.default.XF86XK_Search);V("BrowserStop",H.default.XF86XK_Stop);V("Dimmer",H.default.XF86XK_BrightnessAdjust);V("MediaAudioTrack",H.default.XF86XK_AudioCycleTrack);V("RandomToggle",H.default.XF86XK_AudioRandomPlay);V("SplitScreenToggle",H.default.XF86XK_SplitScreen);V("Subtitle",H.default.XF86XK_Subtitle);V("VideoModeNext",H.default.XF86XK_Next_VMode);me("=",H.default.XK_equal,H.default.XK_KP_Equal);me("+",H.default.XK_plus,H.default.XK_KP_Add);me("-",H.default.XK_minus,H.default.XK_KP_Subtract);me("*",H.default.XK_asterisk,H.default.XK_KP_Multiply);me("/",H.default.XK_slash,H.default.XK_KP_Divide);me(".",H.default.XK_period,H.default.XK_KP_Decimal);me(",",H.default.XK_comma,H.default.XK_KP_Separator);me("0",H.default.XK_0,H.default.XK_KP_0);me("1",H.default.XK_1,H.default.XK_KP_1);me("2",H.default.XK_2,H.default.XK_KP_2);me("3",H.default.XK_3,H.default.XK_KP_3);me("4",H.default.XK_4,H.default.XK_KP_4);me("5",H.default.XK_5,H.default.XK_KP_5);me("6",H.default.XK_6,H.default.XK_KP_6);me("7",H.default.XK_7,H.default.XK_KP_7);me("8",H.default.XK_8,H.default.XK_KP_8);me("9",H.default.XK_9,H.default.XK_KP_9);var Av=Ur.default=Jt});var nl=re(Ni=>{"use strict";function $n(e){"@babel/helpers - typeof";return $n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},$n(e)}Object.defineProperty(Ni,"__esModule",{value:!0});Ni.getKey=sl;Ni.getKeycode=Xi;Ni.getKeysym=C_;var Qi=Hi(_i()),A_=Hi(Un()),Zh=Hi(Vh()),el=Hi(Jh()),tl=Hi(Yh()),il=w_(xi());function rl(e){if(typeof WeakMap!="function")return null;var i=new WeakMap,r=new WeakMap;return(rl=function(c){return c?r:i})(e)}function w_(e,i){if(!i&&e&&e.__esModule)return e;if(e===null||$n(e)!="object"&&typeof e!="function")return{default:e};var r=rl(i);if(r&&r.has(e))return r.get(e);var s={__proto__:null},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var t in e)if(t!=="default"&&{}.hasOwnProperty.call(e,t)){var n=c?Object.getOwnPropertyDescriptor(e,t):null;n&&(n.get||n.set)?Object.defineProperty(s,t,n):s[t]=e[t]}return s.default=e,r&&r.set(e,s),s}function Hi(e){return e&&e.__esModule?e:{default:e}}function Xi(e){if(e.code){switch(e.code){case"OSLeft":return"MetaLeft";case"OSRight":return"MetaRight"}return e.code}if(e.keyCode in Zh.default){var i=Zh.default[e.keyCode];if(il.isMac()&&i==="ContextMenu"&&(i="MetaRight"),e.location===2)switch(i){case"ShiftLeft":return"ShiftRight";case"ControlLeft":return"ControlRight";case"AltLeft":return"AltRight"}if(e.location===3)switch(i){case"Delete":return"NumpadDecimal";case"Insert":return"Numpad0";case"End":return"Numpad1";case"ArrowDown":return"Numpad2";case"PageDown":return"Numpad3";case"ArrowLeft":return"Numpad4";case"ArrowRight":return"Numpad6";case"Home":return"Numpad7";case"ArrowUp":return"Numpad8";case"PageUp":return"Numpad9";case"Enter":return"NumpadEnter"}return i}return"Unidentified"}function sl(e){if(e.key!==void 0&&e.key!=="Unidentified"){switch(e.key){case"OS":return"Meta";case"LaunchMyComputer":return"LaunchApplication1";case"LaunchCalculator":return"LaunchApplication2"}switch(e.key){case"UIKeyInputUpArrow":return"ArrowUp";case"UIKeyInputDownArrow":return"ArrowDown";case"UIKeyInputLeftArrow":return"ArrowLeft";case"UIKeyInputRightArrow":return"ArrowRight";case"UIKeyInputEscape":return"Escape"}return e.key==="\0"&&e.code==="NumpadDecimal"?"Delete":e.key}var i=Xi(e);return i in el.default?el.default[i]:e.charCode?String.fromCharCode(e.charCode):"Unidentified"}function C_(e){var i=sl(e);if(i==="Unidentified")return null;if(i in tl.default){var r=e.location;if(i==="Meta"&&r===0&&(r=2),i==="Clear"&&r===3){var s=Xi(e);s==="NumLock"&&(r=0)}if((r===void 0||r>3)&&(r=0),i==="Meta"){var c=Xi(e);if(c==="AltLeft")return Qi.default.XK_Meta_L;if(c==="AltRight")return Qi.default.XK_Meta_R}if(i==="Clear"){var t=Xi(e);if(t==="NumLock")return Qi.default.XK_Num_Lock}if(il.isWindows())switch(i){case"Zenkaku":case"Hankaku":return Qi.default.XK_Zenkaku_Hankaku;case"Romaji":case"KanaMode":return Qi.default.XK_Romaji}return tl.default[i][r]}if(i.length!==1)return null;var n=i.charCodeAt();return n?A_.default.lookup(n):null}});var ll=re($r=>{"use strict";Object.defineProperty($r,"__esModule",{value:!0});$r.default=void 0;var Wn=jn(yt()),gi=tn(),ol=jn(nl()),Be=x_(_i()),ze=jn(xi());function x_(e){return e&&e.__esModule?e:{default:e}}function hl(e){if(typeof WeakMap!="function")return null;var i=new WeakMap,r=new WeakMap;return(hl=function(c){return c?r:i})(e)}function jn(e,i){if(!i&&e&&e.__esModule)return e;if(e===null||pi(e)!="object"&&typeof e!="function")return{default:e};var r=hl(i);if(r&&r.has(e))return r.get(e);var s={__proto__:null},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var t in e)if(t!=="default"&&{}.hasOwnProperty.call(e,t)){var n=c?Object.getOwnPropertyDescriptor(e,t):null;n&&(n.get||n.set)?Object.defineProperty(s,t,n):s[t]=e[t]}return s.default=e,r&&r.set(e,s),s}function pi(e){"@babel/helpers - typeof";return pi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},pi(e)}function S_(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function al(e,i){for(var r=0;r<i.length;r++){var s=i[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,k_(s.key),s)}}function E_(e,i,r){return i&&al(e.prototype,i),r&&al(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function k_(e){var i=B_(e,"string");return pi(i)=="symbol"?i:i+""}function B_(e,i){if(pi(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,i||"default");if(pi(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}var xv=$r.default=function(){function e(i){S_(this,e),this._target=i||null,this._keyDownList={},this._altGrArmed=!1,this._eventHandlers={keyup:this._handleKeyUp.bind(this),keydown:this._handleKeyDown.bind(this),blur:this._allKeysUp.bind(this)},this.onkeyevent=function(){}}return E_(e,[{key:"_sendKeyEvent",value:function(r,s,c){var t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(c)this._keyDownList[s]=r;else{if(!(s in this._keyDownList))return;delete this._keyDownList[s]}Wn.Debug("onkeyevent "+(c?"down":"up")+", keysym: "+r,", code: "+s+", numlock: "+t+", capslock: "+n),this.onkeyevent(r,s,c,t,n)}},{key:"_getKeyCode",value:function(r){var s=ol.getKeycode(r);if(s!=="Unidentified")return s;if(r.keyCode&&r.keyCode!==229)return"Platform"+r.keyCode;if(r.keyIdentifier){if(r.keyIdentifier.substr(0,2)!=="U+")return r.keyIdentifier;var c=parseInt(r.keyIdentifier.substr(2),16),t=String.fromCharCode(c).toUpperCase();return"Platform"+t.charCodeAt()}return"Unidentified"}},{key:"_handleKeyDown",value:function(r){var s=this._getKeyCode(r),c=ol.getKeysym(r),t=r.getModifierState("NumLock"),n=r.getModifierState("CapsLock");if((ze.isMac()||ze.isIOS())&&(t=null),this._altGrArmed&&(this._altGrArmed=!1,clearTimeout(this._altGrTimeout),s==="AltRight"&&r.timeStamp-this._altGrCtrlTime<50?c=Be.default.XK_ISO_Level3_Shift:this._sendKeyEvent(Be.default.XK_Control_L,"ControlLeft",!0,t,n)),s==="Unidentified"){c&&(this._sendKeyEvent(c,s,!0,t,n),this._sendKeyEvent(c,s,!1,t,n)),(0,gi.stopEvent)(r);return}if(ze.isMac()||ze.isIOS())switch(c){case Be.default.XK_Super_L:c=Be.default.XK_Alt_L;break;case Be.default.XK_Super_R:c=Be.default.XK_Super_L;break;case Be.default.XK_Alt_L:c=Be.default.XK_Mode_switch;break;case Be.default.XK_Alt_R:c=Be.default.XK_ISO_Level3_Shift;break}if(s in this._keyDownList&&(c=this._keyDownList[s]),(ze.isMac()||ze.isIOS())&&r.metaKey&&s!=="MetaLeft"&&s!=="MetaRight"){this._sendKeyEvent(c,s,!0,t,n),this._sendKeyEvent(c,s,!1,t,n),(0,gi.stopEvent)(r);return}if((ze.isMac()||ze.isIOS())&&s==="CapsLock"){this._sendKeyEvent(Be.default.XK_Caps_Lock,"CapsLock",!0,t,n),this._sendKeyEvent(Be.default.XK_Caps_Lock,"CapsLock",!1,t,n),(0,gi.stopEvent)(r);return}var h=[Be.default.XK_Zenkaku_Hankaku,Be.default.XK_Eisu_toggle,Be.default.XK_Katakana,Be.default.XK_Hiragana,Be.default.XK_Romaji];if(ze.isWindows()&&h.includes(c)){this._sendKeyEvent(c,s,!0,t,n),this._sendKeyEvent(c,s,!1,t,n),(0,gi.stopEvent)(r);return}if((0,gi.stopEvent)(r),s==="ControlLeft"&&ze.isWindows()&&!("ControlLeft"in this._keyDownList)){this._altGrArmed=!0,this._altGrTimeout=setTimeout(this._handleAltGrTimeout.bind(this),100),this._altGrCtrlTime=r.timeStamp;return}this._sendKeyEvent(c,s,!0,t,n)}},{key:"_handleKeyUp",value:function(r){(0,gi.stopEvent)(r);var s=this._getKeyCode(r);if(this._altGrArmed&&(this._altGrArmed=!1,clearTimeout(this._altGrTimeout),this._sendKeyEvent(Be.default.XK_Control_L,"ControlLeft",!0)),(ze.isMac()||ze.isIOS())&&s==="CapsLock"){this._sendKeyEvent(Be.default.XK_Caps_Lock,"CapsLock",!0),this._sendKeyEvent(Be.default.XK_Caps_Lock,"CapsLock",!1);return}this._sendKeyEvent(this._keyDownList[s],s,!1),ze.isWindows()&&(s==="ShiftLeft"||s==="ShiftRight")&&("ShiftRight"in this._keyDownList&&this._sendKeyEvent(this._keyDownList.ShiftRight,"ShiftRight",!1),"ShiftLeft"in this._keyDownList&&this._sendKeyEvent(this._keyDownList.ShiftLeft,"ShiftLeft",!1))}},{key:"_handleAltGrTimeout",value:function(){this._altGrArmed=!1,clearTimeout(this._altGrTimeout),this._sendKeyEvent(Be.default.XK_Control_L,"ControlLeft",!0)}},{key:"_allKeysUp",value:function(){Wn.Debug(">> Keyboard.allKeysUp");for(var r in this._keyDownList)this._sendKeyEvent(this._keyDownList[r],r,!1);Wn.Debug("<< Keyboard.allKeysUp")}},{key:"grab",value:function(){this._target.addEventListener("keydown",this._eventHandlers.keydown),this._target.addEventListener("keyup",this._eventHandlers.keyup),window.addEventListener("blur",this._eventHandlers.blur)}},{key:"ungrab",value:function(){this._target.removeEventListener("keydown",this._eventHandlers.keydown),this._target.removeEventListener("keyup",this._eventHandlers.keyup),window.removeEventListener("blur",this._eventHandlers.blur),this._allKeysUp()}}])}()});var fl=re(jr=>{"use strict";Object.defineProperty(jr,"__esModule",{value:!0});jr.default=void 0;function Gi(e){"@babel/helpers - typeof";return Gi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Gi(e)}function L_(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function cl(e,i){for(var r=0;r<i.length;r++){var s=i[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,D_(s.key),s)}}function I_(e,i,r){return i&&cl(e.prototype,i),r&&cl(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function D_(e){var i=R_(e,"string");return Gi(i)=="symbol"?i:i+""}function R_(e,i){if(Gi(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,i||"default");if(Gi(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}var dt=0,Ui=1,$i=2,Wi=4,Wr=8,ji=16,Mt=32,Tt=64,Gn=127,ul=50,M_=90,dl=250,T_=1e3,F_=1e3,P_=50,Ev=jr.default=function(){function e(){L_(this,e),this._target=null,this._state=Gn,this._tracked=[],this._ignored=[],this._waitingRelease=!1,this._releaseStart=0,this._longpressTimeoutId=null,this._twoTouchTimeoutId=null,this._boundEventHandler=this._eventHandler.bind(this)}return I_(e,[{key:"attach",value:function(r){this.detach(),this._target=r,this._target.addEventListener("touchstart",this._boundEventHandler),this._target.addEventListener("touchmove",this._boundEventHandler),this._target.addEventListener("touchend",this._boundEventHandler),this._target.addEventListener("touchcancel",this._boundEventHandler)}},{key:"detach",value:function(){this._target&&(this._stopLongpressTimeout(),this._stopTwoTouchTimeout(),this._target.removeEventListener("touchstart",this._boundEventHandler),this._target.removeEventListener("touchmove",this._boundEventHandler),this._target.removeEventListener("touchend",this._boundEventHandler),this._target.removeEventListener("touchcancel",this._boundEventHandler),this._target=null)}},{key:"_eventHandler",value:function(r){var s;switch(r.stopPropagation(),r.preventDefault(),r.type){case"touchstart":s=this._touchStart;break;case"touchmove":s=this._touchMove;break;case"touchend":case"touchcancel":s=this._touchEnd;break}for(var c=0;c<r.changedTouches.length;c++){var t=r.changedTouches[c];s.call(this,t.identifier,t.clientX,t.clientY)}}},{key:"_touchStart",value:function(r,s,c){if(this._hasDetectedGesture()||this._state===dt){this._ignored.push(r);return}if(this._tracked.length>0&&Date.now()-this._tracked[0].started>dl){this._state=dt,this._ignored.push(r);return}if(this._waitingRelease){this._state=dt,this._ignored.push(r);return}switch(this._tracked.push({id:r,started:Date.now(),active:!0,firstX:s,firstY:c,lastX:s,lastY:c,angle:0}),this._tracked.length){case 1:this._startLongpressTimeout();break;case 2:this._state&=~(Ui|Wr|ji),this._stopLongpressTimeout();break;case 3:this._state&=~($i|Mt|Tt);break;default:this._state=dt}}},{key:"_touchMove",value:function(r,s,c){var t=this._tracked.find(function(_){return _.id===r});if(t!==void 0){t.lastX=s,t.lastY=c;var n=s-t.firstX,h=c-t.firstY;if((t.firstX!==t.lastX||t.firstY!==t.lastY)&&(t.angle=Math.atan2(h,n)*180/Math.PI),!this._hasDetectedGesture()){if(Math.hypot(n,h)<ul)return;if(this._state&=~(Ui|$i|Wi|ji),this._stopLongpressTimeout(),this._tracked.length!==1&&(this._state&=~Wr),this._tracked.length!==2&&(this._state&=~(Mt|Tt)),this._tracked.length===2){var g=this._tracked.find(function(_){return _.id!==r}),a=Math.hypot(g.firstX-g.lastX,g.firstY-g.lastY);if(a>ul){var l=Math.abs(t.angle-g.angle);l=Math.abs((l+180)%360-180),l>M_?this._state&=~Mt:this._state&=~Tt,this._isTwoTouchTimeoutRunning()&&this._stopTwoTouchTimeout()}else this._isTwoTouchTimeoutRunning()||this._startTwoTouchTimeout()}if(!this._hasDetectedGesture())return;this._pushEvent("gesturestart")}this._pushEvent("gesturemove")}}},{key:"_touchEnd",value:function(r,s,c){if(this._ignored.indexOf(r)!==-1){this._ignored.splice(this._ignored.indexOf(r),1),this._ignored.length===0&&this._tracked.length===0&&(this._state=Gn,this._waitingRelease=!1);return}if(!this._hasDetectedGesture()&&this._isTwoTouchTimeoutRunning()&&(this._stopTwoTouchTimeout(),this._state=dt),!this._hasDetectedGesture()&&(this._state&=~(Wr|Mt|Tt),this._state&=~ji,this._stopLongpressTimeout(),!this._waitingRelease))switch(this._releaseStart=Date.now(),this._waitingRelease=!0,this._tracked.length){case 1:this._state&=~($i|Wi);break;case 2:this._state&=~(Ui|Wi);break}if(this._waitingRelease){Date.now()-this._releaseStart>dl&&(this._state=dt),this._tracked.some(function(h){return Date.now()-h.started>T_})&&(this._state=dt);var t=this._tracked.find(function(h){return h.id===r});if(t.active=!1,this._hasDetectedGesture())this._pushEvent("gesturestart");else if(this._state!==dt)return}this._hasDetectedGesture()&&this._pushEvent("gestureend");for(var n=0;n<this._tracked.length;n++)this._tracked[n].active&&this._ignored.push(this._tracked[n].id);this._tracked=[],this._state=dt,this._ignored.indexOf(r)!==-1&&this._ignored.splice(this._ignored.indexOf(r),1),this._ignored.length===0&&(this._state=Gn,this._waitingRelease=!1)}},{key:"_hasDetectedGesture",value:function(){return!(this._state===dt||this._state&this._state-1||this._state&(Ui|$i|Wi)&&this._tracked.some(function(r){return r.active}))}},{key:"_startLongpressTimeout",value:function(){var r=this;this._stopLongpressTimeout(),this._longpressTimeoutId=setTimeout(function(){return r._longpressTimeout()},F_)}},{key:"_stopLongpressTimeout",value:function(){clearTimeout(this._longpressTimeoutId),this._longpressTimeoutId=null}},{key:"_longpressTimeout",value:function(){if(this._hasDetectedGesture())throw new Error("A longpress gesture failed, conflict with a different gesture");this._state=ji,this._pushEvent("gesturestart")}},{key:"_startTwoTouchTimeout",value:function(){var r=this;this._stopTwoTouchTimeout(),this._twoTouchTimeoutId=setTimeout(function(){return r._twoTouchTimeout()},P_)}},{key:"_stopTwoTouchTimeout",value:function(){clearTimeout(this._twoTouchTimeoutId),this._twoTouchTimeoutId=null}},{key:"_isTwoTouchTimeoutRunning",value:function(){return this._twoTouchTimeoutId!==null}},{key:"_twoTouchTimeout",value:function(){if(this._tracked.length===0)throw new Error("A pinch or two drag gesture failed, no tracked touches");var r=this._getAverageMovement(),s=Math.abs(r.x),c=Math.abs(r.y),t=this._getAverageDistance(),n=Math.abs(Math.hypot(t.first.x,t.first.y)-Math.hypot(t.last.x,t.last.y));c<n&&s<n?this._state=Tt:this._state=Mt,this._pushEvent("gesturestart"),this._pushEvent("gesturemove")}},{key:"_pushEvent",value:function(r){var s={type:this._stateToGesture(this._state)},c=this._getPosition(),t=c.last;switch(r==="gesturestart"&&(t=c.first),this._state){case Mt:case Tt:t=c.first;break}if(s.clientX=t.x,s.clientY=t.y,this._state===Tt){var n=this._getAverageDistance();r==="gesturestart"?(s.magnitudeX=n.first.x,s.magnitudeY=n.first.y):(s.magnitudeX=n.last.x,s.magnitudeY=n.last.y)}else if(this._state===Mt)if(r==="gesturestart")s.magnitudeX=0,s.magnitudeY=0;else{var h=this._getAverageMovement();s.magnitudeX=h.x,s.magnitudeY=h.y}var g=new CustomEvent(r,{detail:s});this._target.dispatchEvent(g)}},{key:"_stateToGesture",value:function(r){switch(r){case Ui:return"onetap";case $i:return"twotap";case Wi:return"threetap";case Wr:return"drag";case ji:return"longpress";case Mt:return"twodrag";case Tt:return"pinch"}throw new Error("Unknown gesture state: "+r)}},{key:"_getPosition",value:function(){if(this._tracked.length===0)throw new Error("Failed to get gesture position, no tracked touches");for(var r=this._tracked.length,s=0,c=0,t=0,n=0,h=0;h<this._tracked.length;h++)s+=this._tracked[h].firstX,c+=this._tracked[h].firstY,t+=this._tracked[h].lastX,n+=this._tracked[h].lastY;return{first:{x:s/r,y:c/r},last:{x:t/r,y:n/r}}}},{key:"_getAverageMovement",value:function(){if(this._tracked.length===0)throw new Error("Failed to get gesture movement, no tracked touches");var r,s;r=s=0;for(var c=this._tracked.length,t=0;t<this._tracked.length;t++)r+=this._tracked[t].lastX-this._tracked[t].firstX,s+=this._tracked[t].lastY-this._tracked[t].firstY;return{x:r/c,y:s/c}}},{key:"_getAverageDistance",value:function(){if(this._tracked.length===0)throw new Error("Failed to get gesture distance, no tracked touches");var r=this._tracked[0],s=this._tracked[this._tracked.length-1],c=Math.abs(s.firstX-r.firstX),t=Math.abs(s.firstY-r.firstY),n=Math.abs(s.lastX-r.lastX),h=Math.abs(s.lastY-r.lastY);return{first:{x:c,y:t},last:{x:n,y:h}}}}])}()});var pl=re(Gr=>{"use strict";Object.defineProperty(Gr,"__esModule",{value:!0});Gr.default=void 0;var _l=xi();function qi(e){"@babel/helpers - typeof";return qi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},qi(e)}function O_(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function gl(e,i){for(var r=0;r<i.length;r++){var s=i[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,Q_(s.key),s)}}function K_(e,i,r){return i&&gl(e.prototype,i),r&&gl(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Q_(e){var i=X_(e,"string");return qi(i)=="symbol"?i:i+""}function X_(e,i){if(qi(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,i||"default");if(qi(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}var zi=!_l.supportsCursorURIs||_l.isTouchDevice,Bv=Gr.default=function(){function e(){O_(this,e),this._target=null,this._canvas=document.createElement("canvas"),zi&&(this._canvas.style.position="fixed",this._canvas.style.zIndex="65535",this._canvas.style.pointerEvents="none",this._canvas.style.userSelect="none",this._canvas.style.WebkitUserSelect="none",this._canvas.style.visibility="hidden"),this._position={x:0,y:0},this._hotSpot={x:0,y:0},this._eventHandlers={mouseover:this._handleMouseOver.bind(this),mouseleave:this._handleMouseLeave.bind(this),mousemove:this._handleMouseMove.bind(this),mouseup:this._handleMouseUp.bind(this)}}return K_(e,[{key:"attach",value:function(r){if(this._target&&this.detach(),this._target=r,zi){document.body.appendChild(this._canvas);var s={capture:!0,passive:!0};this._target.addEventListener("mouseover",this._eventHandlers.mouseover,s),this._target.addEventListener("mouseleave",this._eventHandlers.mouseleave,s),this._target.addEventListener("mousemove",this._eventHandlers.mousemove,s),this._target.addEventListener("mouseup",this._eventHandlers.mouseup,s)}this.clear()}},{key:"detach",value:function(){if(this._target){if(zi){var r={capture:!0,passive:!0};this._target.removeEventListener("mouseover",this._eventHandlers.mouseover,r),this._target.removeEventListener("mouseleave",this._eventHandlers.mouseleave,r),this._target.removeEventListener("mousemove",this._eventHandlers.mousemove,r),this._target.removeEventListener("mouseup",this._eventHandlers.mouseup,r),document.contains(this._canvas)&&document.body.removeChild(this._canvas)}this._target=null}}},{key:"change",value:function(r,s,c,t,n){if(t===0||n===0){this.clear();return}this._position.x=this._position.x+this._hotSpot.x-s,this._position.y=this._position.y+this._hotSpot.y-c,this._hotSpot.x=s,this._hotSpot.y=c;var h=this._canvas.getContext("2d");this._canvas.width=t,this._canvas.height=n;var g=new ImageData(new Uint8ClampedArray(r),t,n);if(h.clearRect(0,0,t,n),h.putImageData(g,0,0),zi)this._updatePosition();else{var a=this._canvas.toDataURL();this._target.style.cursor="url("+a+")"+s+" "+c+", default"}}},{key:"clear",value:function(){this._target.style.cursor="none",this._canvas.width=0,this._canvas.height=0,this._position.x=this._position.x+this._hotSpot.x,this._position.y=this._position.y+this._hotSpot.y,this._hotSpot.x=0,this._hotSpot.y=0}},{key:"move",value:function(r,s){if(zi){window.visualViewport?(this._position.x=r+window.visualViewport.offsetLeft,this._position.y=s+window.visualViewport.offsetTop):(this._position.x=r,this._position.y=s),this._updatePosition();var c=document.elementFromPoint(r,s);this._updateVisibility(c)}}},{key:"_handleMouseOver",value:function(r){this._handleMouseMove(r)}},{key:"_handleMouseLeave",value:function(r){this._updateVisibility(r.relatedTarget)}},{key:"_handleMouseMove",value:function(r){this._updateVisibility(r.target),this._position.x=r.clientX-this._hotSpot.x,this._position.y=r.clientY-this._hotSpot.y,this._updatePosition()}},{key:"_handleMouseUp",value:function(r){var s=this,c=document.elementFromPoint(r.clientX,r.clientY);this._updateVisibility(c),this._captureIsActive()&&window.setTimeout(function(){s._target&&(c=document.elementFromPoint(r.clientX,r.clientY),s._updateVisibility(c))},0)}},{key:"_showCursor",value:function(){this._canvas.style.visibility==="hidden"&&(this._canvas.style.visibility="")}},{key:"_hideCursor",value:function(){this._canvas.style.visibility!=="hidden"&&(this._canvas.style.visibility="hidden")}},{key:"_shouldShowCursor",value:function(r){return r?r===this._target?!0:!(!this._target.contains(r)||window.getComputedStyle(r).cursor!=="none"):!1}},{key:"_updateVisibility",value:function(r){this._captureIsActive()&&(r=document.captureElement),this._shouldShowCursor(r)?this._showCursor():this._hideCursor()}},{key:"_updatePosition",value:function(){this._canvas.style.left=this._position.x+"px",this._canvas.style.top=this._position.y+"px"}},{key:"_captureIsActive",value:function(){return document.captureElement&&document.documentElement.contains(document.captureElement)}}])}()});var Al=re(Vr=>{"use strict";Object.defineProperty(Vr,"__esModule",{value:!0});Vr.default=void 0;var wt=H_(yt());function bl(e){if(typeof WeakMap!="function")return null;var i=new WeakMap,r=new WeakMap;return(bl=function(c){return c?r:i})(e)}function H_(e,i){if(!i&&e&&e.__esModule)return e;if(e===null||vi(e)!="object"&&typeof e!="function")return{default:e};var r=bl(i);if(r&&r.has(e))return r.get(e);var s={__proto__:null},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var t in e)if(t!=="default"&&{}.hasOwnProperty.call(e,t)){var n=c?Object.getOwnPropertyDescriptor(e,t):null;n&&(n.get||n.set)?Object.defineProperty(s,t,n):s[t]=e[t]}return s.default=e,r&&r.set(e,s),s}function vi(e){"@babel/helpers - typeof";return vi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},vi(e)}function vl(e){return W_(e)||$_(e)||U_(e)||N_()}function N_(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function U_(e,i){if(e){if(typeof e=="string")return qn(e,i);var r={}.toString.call(e).slice(8,-1);return r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set"?Array.from(e):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?qn(e,i):void 0}}function $_(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function W_(e){if(Array.isArray(e))return qn(e)}function qn(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,s=Array(i);r<i;r++)s[r]=e[r];return s}function j_(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function ml(e,i){for(var r=0;r<i.length;r++){var s=i[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,z_(s.key),s)}}function G_(e,i,r){return i&&ml(e.prototype,i),r&&ml(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function z_(e){var i=q_(e,"string");return vi(i)=="symbol"?i:i+""}function q_(e,i){if(vi(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,i||"default");if(vi(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}var zn=40*1024*1024,zr={CONNECTING:"connecting",OPEN:"open",CLOSING:"closing",CLOSED:"closed"},qr={CONNECTING:[WebSocket.CONNECTING,zr.CONNECTING],OPEN:[WebSocket.OPEN,zr.OPEN],CLOSING:[WebSocket.CLOSING,zr.CLOSING],CLOSED:[WebSocket.CLOSED,zr.CLOSED]},yl=["send","close","binaryType","onerror","onmessage","onopen","protocol","readyState"],Iv=Vr.default=function(){function e(){j_(this,e),this._websocket=null,this._rQi=0,this._rQlen=0,this._rQbufferSize=1024*1024*4,this._rQ=null,this._sQbufferSize=1024*10,this._sQlen=0,this._sQ=null,this._eventHandlers={message:function(){},open:function(){},close:function(){},error:function(){}}}return G_(e,[{key:"readyState",get:function(){var r;return this._websocket===null?"unused":(r=this._websocket.readyState,qr.CONNECTING.includes(r)?"connecting":qr.OPEN.includes(r)?"open":qr.CLOSING.includes(r)?"closing":qr.CLOSED.includes(r)?"closed":"unknown")}},{key:"rQpeek8",value:function(){return this._rQ[this._rQi]}},{key:"rQskipBytes",value:function(r){this._rQi+=r}},{key:"rQshift8",value:function(){return this._rQshift(1)}},{key:"rQshift16",value:function(){return this._rQshift(2)}},{key:"rQshift32",value:function(){return this._rQshift(4)}},{key:"_rQshift",value:function(r){for(var s=0,c=r-1;c>=0;c--)s+=this._rQ[this._rQi++]<<c*8;return s>>>0}},{key:"rQshiftStr",value:function(r){for(var s="",c=0;c<r;c+=4096){var t=this.rQshiftBytes(Math.min(4096,r-c),!1);s+=String.fromCharCode.apply(null,t)}return s}},{key:"rQshiftBytes",value:function(r){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return this._rQi+=r,s?this._rQ.slice(this._rQi-r,this._rQi):this._rQ.subarray(this._rQi-r,this._rQi)}},{key:"rQshiftTo",value:function(r,s){r.set(new Uint8Array(this._rQ.buffer,this._rQi,s)),this._rQi+=s}},{key:"rQpeekBytes",value:function(r){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return s?this._rQ.slice(this._rQi,this._rQi+r):this._rQ.subarray(this._rQi,this._rQi+r)}},{key:"rQwait",value:function(r,s,c){if(this._rQlen-this._rQi<s){if(c){if(this._rQi<c)throw new Error("rQwait cannot backup "+c+" bytes");this._rQi-=c}return!0}return!1}},{key:"sQpush8",value:function(r){this._sQensureSpace(1),this._sQ[this._sQlen++]=r}},{key:"sQpush16",value:function(r){this._sQensureSpace(2),this._sQ[this._sQlen++]=r>>8&255,this._sQ[this._sQlen++]=r>>0&255}},{key:"sQpush32",value:function(r){this._sQensureSpace(4),this._sQ[this._sQlen++]=r>>24&255,this._sQ[this._sQlen++]=r>>16&255,this._sQ[this._sQlen++]=r>>8&255,this._sQ[this._sQlen++]=r>>0&255}},{key:"sQpushString",value:function(r){var s=r.split("").map(function(c){return c.charCodeAt(0)});this.sQpushBytes(new Uint8Array(s))}},{key:"sQpushBytes",value:function(r){for(var s=0;s<r.length;){this._sQensureSpace(1);var c=this._sQbufferSize-this._sQlen;c>r.length-s&&(c=r.length-s),this._sQ.set(r.subarray(s,c),this._sQlen),this._sQlen+=c,s+=c}}},{key:"flush",value:function(){this._sQlen>0&&this.readyState==="open"&&(this._websocket.send(new Uint8Array(this._sQ.buffer,0,this._sQlen)),this._sQlen=0)}},{key:"_sQensureSpace",value:function(r){this._sQbufferSize-this._sQlen<r&&this.flush()}},{key:"off",value:function(r){this._eventHandlers[r]=function(){}}},{key:"on",value:function(r,s){this._eventHandlers[r]=s}},{key:"_allocateBuffers",value:function(){this._rQ=new Uint8Array(this._rQbufferSize),this._sQ=new Uint8Array(this._sQbufferSize)}},{key:"init",value:function(){this._allocateBuffers(),this._rQi=0,this._websocket=null}},{key:"open",value:function(r,s){this.attach(new WebSocket(r,s))}},{key:"attach",value:function(r){var s=this;this.init();for(var c=[].concat(vl(Object.keys(r)),vl(Object.getOwnPropertyNames(Object.getPrototypeOf(r)))),t=0;t<yl.length;t++){var n=yl[t];if(c.indexOf(n)<0)throw new Error("Raw channel missing property: "+n)}this._websocket=r,this._websocket.binaryType="arraybuffer",this._websocket.onmessage=this._recvMessage.bind(this),this._websocket.onopen=function(){wt.Debug(">> WebSock.onopen"),s._websocket.protocol&&wt.Info("Server choose sub-protocol: "+s._websocket.protocol),s._eventHandlers.open(),wt.Debug("<< WebSock.onopen")},this._websocket.onclose=function(h){wt.Debug(">> WebSock.onclose"),s._eventHandlers.close(h),wt.Debug("<< WebSock.onclose")},this._websocket.onerror=function(h){wt.Debug(">> WebSock.onerror: "+h),s._eventHandlers.error(h),wt.Debug("<< WebSock.onerror: "+h)}}},{key:"close",value:function(){this._websocket&&((this.readyState==="connecting"||this.readyState==="open")&&(wt.Info("Closing WebSocket connection"),this._websocket.close()),this._websocket.onmessage=function(){})}},{key:"_expandCompactRQ",value:function(r){var s=(this._rQlen-this._rQi+r)*8,c=this._rQbufferSize<s;if(c&&(this._rQbufferSize=Math.max(this._rQbufferSize*2,s)),this._rQbufferSize>zn&&(this._rQbufferSize=zn,this._rQbufferSize-(this._rQlen-this._rQi)<r))throw new Error("Receive Queue buffer exceeded "+zn+" bytes, and the new message could not fit");if(c){var t=this._rQ.buffer;this._rQ=new Uint8Array(this._rQbufferSize),this._rQ.set(new Uint8Array(t,this._rQi,this._rQlen-this._rQi))}else this._rQ.copyWithin(0,this._rQi,this._rQlen);this._rQlen=this._rQlen-this._rQi,this._rQi=0}},{key:"_recvMessage",value:function(r){this._rQlen==this._rQi&&(this._rQlen=0,this._rQi=0);var s=new Uint8Array(r.data);s.length>this._rQbufferSize-this._rQlen&&this._expandCompactRQ(s.length),this._rQ.set(s,this._rQlen),this._rQlen+=s.length,this._rQlen-this._rQi>0?this._eventHandlers.message():wt.Debug("Ignoring empty message")}}])}()});var wl=re(Jr=>{"use strict";Object.defineProperty(Jr,"__esModule",{value:!0});Jr.default=void 0;var Rv=Jr.default={Again:57349,AltLeft:56,AltRight:57400,ArrowDown:57424,ArrowLeft:57419,ArrowRight:57421,ArrowUp:57416,AudioVolumeDown:57390,AudioVolumeMute:57376,AudioVolumeUp:57392,Backquote:41,Backslash:43,Backspace:14,BracketLeft:26,BracketRight:27,BrowserBack:57450,BrowserFavorites:57446,BrowserForward:57449,BrowserHome:57394,BrowserRefresh:57447,BrowserSearch:57445,BrowserStop:57448,CapsLock:58,Comma:51,ContextMenu:57437,ControlLeft:29,ControlRight:57373,Convert:121,Copy:57464,Cut:57404,Delete:57427,Digit0:11,Digit1:2,Digit2:3,Digit3:4,Digit4:5,Digit5:6,Digit6:7,Digit7:8,Digit8:9,Digit9:10,Eject:57469,End:57423,Enter:28,Equal:13,Escape:1,F1:59,F10:68,F11:87,F12:88,F13:93,F14:94,F15:95,F16:85,F17:57347,F18:57463,F19:57348,F2:60,F20:90,F21:116,F22:57465,F23:109,F24:111,F3:61,F4:62,F5:63,F6:64,F7:65,F8:66,F9:67,Find:57409,Help:57461,Hiragana:119,Home:57415,Insert:57426,IntlBackslash:86,IntlRo:115,IntlYen:125,KanaMode:112,Katakana:120,KeyA:30,KeyB:48,KeyC:46,KeyD:32,KeyE:18,KeyF:33,KeyG:34,KeyH:35,KeyI:23,KeyJ:36,KeyK:37,KeyL:38,KeyM:50,KeyN:49,KeyO:24,KeyP:25,KeyQ:16,KeyR:19,KeyS:31,KeyT:20,KeyU:22,KeyV:47,KeyW:17,KeyX:45,KeyY:21,KeyZ:44,Lang1:114,Lang2:113,Lang3:120,Lang4:119,Lang5:118,LaunchApp1:57451,LaunchApp2:57377,LaunchMail:57452,MediaPlayPause:57378,MediaSelect:57453,MediaStop:57380,MediaTrackNext:57369,MediaTrackPrevious:57360,MetaLeft:57435,MetaRight:57436,Minus:12,NonConvert:123,NumLock:69,Numpad0:82,Numpad1:79,Numpad2:80,Numpad3:81,Numpad4:75,Numpad5:76,Numpad6:77,Numpad7:71,Numpad8:72,Numpad9:73,NumpadAdd:78,NumpadComma:126,NumpadDecimal:83,NumpadDivide:57397,NumpadEnter:57372,NumpadEqual:89,NumpadMultiply:55,NumpadParenLeft:57462,NumpadParenRight:57467,NumpadSubtract:74,Open:100,PageDown:57425,PageUp:57417,Paste:101,Pause:57414,Period:52,Power:57438,PrintScreen:84,Props:57350,Quote:40,ScrollLock:70,Semicolon:39,ShiftLeft:42,ShiftRight:54,Slash:53,Sleep:57439,Space:57,Suspend:57381,Tab:15,Undo:57351,WakeUp:57443}});var Cl=re(Vi=>{"use strict";Object.defineProperty(Vi,"__esModule",{value:!0});Vi.encodingName=V_;Vi.encodings=void 0;var Ft=Vi.encodings={encodingRaw:0,encodingCopyRect:1,encodingRRE:2,encodingHextile:5,encodingTight:7,encodingZRLE:16,encodingTightPNG:-260,encodingJPEG:21,pseudoEncodingQualityLevel9:-23,pseudoEncodingQualityLevel0:-32,pseudoEncodingDesktopSize:-223,pseudoEncodingLastRect:-224,pseudoEncodingCursor:-239,pseudoEncodingQEMUExtendedKeyEvent:-258,pseudoEncodingQEMULedEvent:-261,pseudoEncodingDesktopName:-307,pseudoEncodingExtendedDesktopSize:-308,pseudoEncodingXvp:-309,pseudoEncodingFence:-312,pseudoEncodingContinuousUpdates:-313,pseudoEncodingCompressLevel9:-247,pseudoEncodingCompressLevel0:-256,pseudoEncodingVMwareCursor:1464686180,pseudoEncodingExtendedClipboard:3231835598};function V_(e){switch(e){case Ft.encodingRaw:return"Raw";case Ft.encodingCopyRect:return"CopyRect";case Ft.encodingRRE:return"RRE";case Ft.encodingHextile:return"Hextile";case Ft.encodingTight:return"Tight";case Ft.encodingZRLE:return"ZRLE";case Ft.encodingTightPNG:return"TightPNG";case Ft.encodingJPEG:return"JPEG";default:return"[unknown encoding "+e+"]"}}});var Bl=re(mi=>{"use strict";Object.defineProperty(mi,"__esModule",{value:!0});mi.AESECBCipher=mi.AESEAXCipher=void 0;function Yt(e){"@babel/helpers - typeof";return Yt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Yt(e)}function we(){"use strict";we=function(){return i};var e,i={},r=Object.prototype,s=r.hasOwnProperty,c=Object.defineProperty||function(k,m,x){k[m]=x.value},t=typeof Symbol=="function"?Symbol:{},n=t.iterator||"@@iterator",h=t.asyncIterator||"@@asyncIterator",g=t.toStringTag||"@@toStringTag";function a(k,m,x){return Object.defineProperty(k,m,{value:x,enumerable:!0,configurable:!0,writable:!0}),k[m]}try{a({},"")}catch{a=function(x,E,I){return x[E]=I}}function l(k,m,x,E){var I=m&&m.prototype instanceof p?m:p,M=Object.create(I.prototype),X=new Q(E||[]);return c(M,"_invoke",{value:B(k,x,X)}),M}function _(k,m,x){try{return{type:"normal",arg:k.call(m,x)}}catch(E){return{type:"throw",arg:E}}}i.wrap=l;var v="suspendedStart",u="suspendedYield",o="executing",d="completed",f={};function p(){}function y(){}function w(){}var b={};a(b,n,function(){return this});var S=Object.getPrototypeOf,A=S&&S(S(N([])));A&&A!==r&&s.call(A,n)&&(b=A);var C=w.prototype=p.prototype=Object.create(b);function D(k){["next","throw","return"].forEach(function(m){a(k,m,function(x){return this._invoke(m,x)})})}function L(k,m){function x(I,M,X,$){var W=_(k[I],k,M);if(W.type!=="throw"){var P=W.arg,T=P.value;return T&&Yt(T)=="object"&&s.call(T,"__await")?m.resolve(T.__await).then(function(U){x("next",U,X,$)},function(U){x("throw",U,X,$)}):m.resolve(T).then(function(U){P.value=U,X(P)},function(U){return x("throw",U,X,$)})}$(W.arg)}var E;c(this,"_invoke",{value:function(M,X){function $(){return new m(function(W,P){x(M,X,W,P)})}return E=E?E.then($,$):$()}})}function B(k,m,x){var E=v;return function(I,M){if(E===o)throw Error("Generator is already running");if(E===d){if(I==="throw")throw M;return{value:e,done:!0}}for(x.method=I,x.arg=M;;){var X=x.delegate;if(X){var $=R(X,x);if($){if($===f)continue;return $}}if(x.method==="next")x.sent=x._sent=x.arg;else if(x.method==="throw"){if(E===v)throw E=d,x.arg;x.dispatchException(x.arg)}else x.method==="return"&&x.abrupt("return",x.arg);E=o;var W=_(k,m,x);if(W.type==="normal"){if(E=x.done?d:u,W.arg===f)continue;return{value:W.arg,done:x.done}}W.type==="throw"&&(E=d,x.method="throw",x.arg=W.arg)}}}function R(k,m){var x=m.method,E=k.iterator[x];if(E===e)return m.delegate=null,x==="throw"&&k.iterator.return&&(m.method="return",m.arg=e,R(k,m),m.method==="throw")||x!=="return"&&(m.method="throw",m.arg=new TypeError("The iterator does not provide a '"+x+"' method")),f;var I=_(E,k.iterator,m.arg);if(I.type==="throw")return m.method="throw",m.arg=I.arg,m.delegate=null,f;var M=I.arg;return M?M.done?(m[k.resultName]=M.value,m.next=k.nextLoc,m.method!=="return"&&(m.method="next",m.arg=e),m.delegate=null,f):M:(m.method="throw",m.arg=new TypeError("iterator result is not an object"),m.delegate=null,f)}function F(k){var m={tryLoc:k[0]};1 in k&&(m.catchLoc=k[1]),2 in k&&(m.finallyLoc=k[2],m.afterLoc=k[3]),this.tryEntries.push(m)}function K(k){var m=k.completion||{};m.type="normal",delete m.arg,k.completion=m}function Q(k){this.tryEntries=[{tryLoc:"root"}],k.forEach(F,this),this.reset(!0)}function N(k){if(k||k===""){var m=k[n];if(m)return m.call(k);if(typeof k.next=="function")return k;if(!isNaN(k.length)){var x=-1,E=function I(){for(;++x<k.length;)if(s.call(k,x))return I.value=k[x],I.done=!1,I;return I.value=e,I.done=!0,I};return E.next=E}}throw new TypeError(Yt(k)+" is not iterable")}return y.prototype=w,c(C,"constructor",{value:w,configurable:!0}),c(w,"constructor",{value:y,configurable:!0}),y.displayName=a(w,g,"GeneratorFunction"),i.isGeneratorFunction=function(k){var m=typeof k=="function"&&k.constructor;return!!m&&(m===y||(m.displayName||m.name)==="GeneratorFunction")},i.mark=function(k){return Object.setPrototypeOf?Object.setPrototypeOf(k,w):(k.__proto__=w,a(k,g,"GeneratorFunction")),k.prototype=Object.create(C),k},i.awrap=function(k){return{__await:k}},D(L.prototype),a(L.prototype,h,function(){return this}),i.AsyncIterator=L,i.async=function(k,m,x,E,I){I===void 0&&(I=Promise);var M=new L(l(k,m,x,E),I);return i.isGeneratorFunction(m)?M:M.next().then(function(X){return X.done?X.value:M.next()})},D(C),a(C,g,"Generator"),a(C,n,function(){return this}),a(C,"toString",function(){return"[object Generator]"}),i.keys=function(k){var m=Object(k),x=[];for(var E in m)x.push(E);return x.reverse(),function I(){for(;x.length;){var M=x.pop();if(M in m)return I.value=M,I.done=!1,I}return I.done=!0,I}},i.values=N,Q.prototype={constructor:Q,reset:function(m){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(K),!m)for(var x in this)x.charAt(0)==="t"&&s.call(this,x)&&!isNaN(+x.slice(1))&&(this[x]=e)},stop:function(){this.done=!0;var m=this.tryEntries[0].completion;if(m.type==="throw")throw m.arg;return this.rval},dispatchException:function(m){if(this.done)throw m;var x=this;function E(P,T){return X.type="throw",X.arg=m,x.next=P,T&&(x.method="next",x.arg=e),!!T}for(var I=this.tryEntries.length-1;I>=0;--I){var M=this.tryEntries[I],X=M.completion;if(M.tryLoc==="root")return E("end");if(M.tryLoc<=this.prev){var $=s.call(M,"catchLoc"),W=s.call(M,"finallyLoc");if($&&W){if(this.prev<M.catchLoc)return E(M.catchLoc,!0);if(this.prev<M.finallyLoc)return E(M.finallyLoc)}else if($){if(this.prev<M.catchLoc)return E(M.catchLoc,!0)}else{if(!W)throw Error("try statement without catch or finally");if(this.prev<M.finallyLoc)return E(M.finallyLoc)}}}},abrupt:function(m,x){for(var E=this.tryEntries.length-1;E>=0;--E){var I=this.tryEntries[E];if(I.tryLoc<=this.prev&&s.call(I,"finallyLoc")&&this.prev<I.finallyLoc){var M=I;break}}M&&(m==="break"||m==="continue")&&M.tryLoc<=x&&x<=M.finallyLoc&&(M=null);var X=M?M.completion:{};return X.type=m,X.arg=x,M?(this.method="next",this.next=M.finallyLoc,f):this.complete(X)},complete:function(m,x){if(m.type==="throw")throw m.arg;return m.type==="break"||m.type==="continue"?this.next=m.arg:m.type==="return"?(this.rval=this.arg=m.arg,this.method="return",this.next="end"):m.type==="normal"&&x&&(this.next=x),f},finish:function(m){for(var x=this.tryEntries.length-1;x>=0;--x){var E=this.tryEntries[x];if(E.finallyLoc===m)return this.complete(E.completion,E.afterLoc),K(E),f}},catch:function(m){for(var x=this.tryEntries.length-1;x>=0;--x){var E=this.tryEntries[x];if(E.tryLoc===m){var I=E.completion;if(I.type==="throw"){var M=I.arg;K(E)}return M}}throw Error("illegal catch attempt")},delegateYield:function(m,x,E){return this.delegate={iterator:N(m),resultName:x,nextLoc:E},this.method==="next"&&(this.arg=e),f}},i}function xl(e,i,r,s,c,t,n){try{var h=e[t](n),g=h.value}catch(a){return void r(a)}h.done?i(g):Promise.resolve(g).then(s,c)}function Ze(e){return function(){var i=this,r=arguments;return new Promise(function(s,c){var t=e.apply(i,r);function n(g){xl(t,s,c,n,h,"next",g)}function h(g){xl(t,s,c,n,h,"throw",g)}n(void 0)})}}function El(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function Sl(e,i){for(var r=0;r<i.length;r++){var s=i[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,J_(s.key),s)}}function kl(e,i,r){return i&&Sl(e.prototype,i),r&&Sl(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function J_(e){var i=Y_(e,"string");return Yt(i)=="symbol"?i:i+""}function Y_(e,i){if(Yt(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,i||"default");if(Yt(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}var Fv=mi.AESECBCipher=function(){function e(){El(this,e),this._key=null}return kl(e,[{key:"algorithm",get:function(){return{name:"AES-ECB"}}},{key:"_importKey",value:function(){var i=Ze(we().mark(function s(c,t,n){return we().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,window.crypto.subtle.importKey("raw",c,{name:"AES-CBC"},t,n);case 2:this._key=g.sent;case 3:case"end":return g.stop()}},s,this)}));function r(s,c,t){return i.apply(this,arguments)}return r}()},{key:"encrypt",value:function(){var i=Ze(we().mark(function s(c,t){var n,h,g,a;return we().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(n=new Uint8Array(t),!(n.length%16!==0||this._key===null)){_.next=3;break}return _.abrupt("return",null);case 3:h=n.length/16,g=0;case 5:if(!(g<h)){_.next=15;break}return _.t0=Uint8Array,_.next=9,window.crypto.subtle.encrypt({name:"AES-CBC",iv:new Uint8Array(16)},this._key,n.slice(g*16,g*16+16));case 9:_.t1=_.sent,a=new _.t0(_.t1).slice(0,16),n.set(a,g*16);case 12:g++,_.next=5;break;case 15:return _.abrupt("return",n);case 16:case"end":return _.stop()}},s,this)}));function r(s,c){return i.apply(this,arguments)}return r}()}],[{key:"importKey",value:function(){var i=Ze(we().mark(function s(c,t,n,h){var g;return we().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return g=new e,l.next=3,g._importKey(c,n,h);case 3:return l.abrupt("return",g);case 4:case"end":return l.stop()}},s)}));function r(s,c,t,n){return i.apply(this,arguments)}return r}()}])}(),Pv=mi.AESEAXCipher=function(){function e(){El(this,e),this._rawKey=null,this._ctrKey=null,this._cbcKey=null,this._zeroBlock=new Uint8Array(16),this._prefixBlock0=this._zeroBlock,this._prefixBlock1=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1]),this._prefixBlock2=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2])}return kl(e,[{key:"algorithm",get:function(){return{name:"AES-EAX"}}},{key:"_encryptBlock",value:function(){var i=Ze(we().mark(function s(c){var t;return we().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,window.crypto.subtle.encrypt({name:"AES-CBC",iv:this._zeroBlock},this._cbcKey,c);case 2:return t=h.sent,h.abrupt("return",new Uint8Array(t).slice(0,16));case 4:case"end":return h.stop()}},s,this)}));function r(s){return i.apply(this,arguments)}return r}()},{key:"_initCMAC",value:function(){var i=Ze(we().mark(function s(){var c,t,n,h,g;return we().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this._encryptBlock(this._zeroBlock);case 2:for(c=l.sent,t=new Uint8Array(16),n=c[0]>>>6,h=0;h<15;h++)t[h]=c[h+1]>>6|c[h]<<2,c[h]=c[h+1]>>7|c[h]<<1;g=[0,135,14,137],t[14]^=n>>>1,t[15]=c[15]<<2^g[n],c[15]=c[15]<<1^g[n>>1],this._k1=c,this._k2=t;case 12:case"end":return l.stop()}},s,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"_encryptCTR",value:function(){var i=Ze(we().mark(function s(c,t){var n;return we().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,window.crypto.subtle.encrypt({name:"AES-CTR",counter:t,length:128},this._ctrKey,c);case 2:return n=g.sent,g.abrupt("return",new Uint8Array(n));case 4:case"end":return g.stop()}},s,this)}));function r(s,c){return i.apply(this,arguments)}return r}()},{key:"_decryptCTR",value:function(){var i=Ze(we().mark(function s(c,t){var n;return we().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,window.crypto.subtle.decrypt({name:"AES-CTR",counter:t,length:128},this._ctrKey,c);case 2:return n=g.sent,g.abrupt("return",new Uint8Array(n));case 4:case"end":return g.stop()}},s,this)}));function r(s,c){return i.apply(this,arguments)}return r}()},{key:"_computeCMAC",value:function(){var i=Ze(we().mark(function s(c,t){var n,h,g,a,l,_,v,u;return we().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(t.length===16){d.next=2;break}return d.abrupt("return",null);case 2:if(n=Math.floor(c.length/16),h=Math.ceil(c.length/16),g=c.length-n*16,a=new Uint8Array((h+1)*16),a.set(t),a.set(c,16),g===0)for(l=0;l<16;l++)a[n*16+l]^=this._k1[l];else for(a[(n+1)*16+g]=128,_=0;_<16;_++)a[(n+1)*16+_]^=this._k2[_];return d.next=11,window.crypto.subtle.encrypt({name:"AES-CBC",iv:this._zeroBlock},this._cbcKey,a);case 11:return v=d.sent,v=new Uint8Array(v),u=v.slice(v.length-32,v.length-16),d.abrupt("return",u);case 15:case"end":return d.stop()}},s,this)}));function r(s,c){return i.apply(this,arguments)}return r}()},{key:"_importKey",value:function(){var i=Ze(we().mark(function s(c){return we().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return this._rawKey=c,n.next=3,window.crypto.subtle.importKey("raw",c,{name:"AES-CTR"},!1,["encrypt","decrypt"]);case 3:return this._ctrKey=n.sent,n.next=6,window.crypto.subtle.importKey("raw",c,{name:"AES-CBC"},!1,["encrypt"]);case 6:return this._cbcKey=n.sent,n.next=9,this._initCMAC();case 9:case"end":return n.stop()}},s,this)}));function r(s){return i.apply(this,arguments)}return r}()},{key:"encrypt",value:function(){var i=Ze(we().mark(function s(c,t){var n,h,g,a,l,_,v,u;return we().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return n=c.additionalData,h=c.iv,d.next=4,this._computeCMAC(h,this._prefixBlock0);case 4:return g=d.sent,d.next=7,this._encryptCTR(t,g);case 7:return a=d.sent,d.next=10,this._computeCMAC(n,this._prefixBlock1);case 10:return l=d.sent,d.next=13,this._computeCMAC(a,this._prefixBlock2);case 13:for(_=d.sent,v=0;v<16;v++)_[v]^=g[v]^l[v];return u=new Uint8Array(16+a.length),u.set(a),u.set(_,a.length),d.abrupt("return",u);case 19:case"end":return d.stop()}},s,this)}));function r(s,c){return i.apply(this,arguments)}return r}()},{key:"decrypt",value:function(){var i=Ze(we().mark(function s(c,t){var n,h,g,a,l,_,v,u,o,d;return we().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return n=t.slice(0,t.length-16),h=c.additionalData,g=c.iv,a=t.slice(t.length-16),p.next=6,this._computeCMAC(g,this._prefixBlock0);case 6:return l=p.sent,p.next=9,this._computeCMAC(h,this._prefixBlock1);case 9:return _=p.sent,p.next=12,this._computeCMAC(n,this._prefixBlock2);case 12:for(v=p.sent,u=0;u<16;u++)v[u]^=l[u]^_[u];if(v.length===a.length){p.next=16;break}return p.abrupt("return",null);case 16:o=0;case 17:if(!(o<a.length)){p.next=23;break}if(v[o]===a[o]){p.next=20;break}return p.abrupt("return",null);case 20:o++,p.next=17;break;case 23:return p.next=25,this._decryptCTR(n,l);case 25:return d=p.sent,p.abrupt("return",d);case 27:case"end":return p.stop()}},s,this)}));function r(s,c){return i.apply(this,arguments)}return r}()}],[{key:"importKey",value:function(){var i=Ze(we().mark(function s(c,t,n,h){var g;return we().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return g=new e,l.next=3,g._importKey(c);case 3:return l.abrupt("return",g);case 4:case"end":return l.stop()}},s)}));function r(s,c,t,n){return i.apply(this,arguments)}return r}()}])}()});var Xl=re(yi=>{"use strict";Object.defineProperty(yi,"__esModule",{value:!0});yi.DESECBCipher=yi.DESCBCCipher=void 0;function Ji(e){"@babel/helpers - typeof";return Ji=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Ji(e)}function Vn(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function Ll(e,i){for(var r=0;r<i.length;r++){var s=i[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,Z_(s.key),s)}}function Jn(e,i,r){return i&&Ll(e.prototype,i),r&&Ll(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Z_(e){var i=e0(e,"string");return Ji(i)=="symbol"?i:i+""}function e0(e,i){if(Ji(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,i||"default");if(Ji(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}var Il=[13,16,10,23,0,4,2,27,14,5,20,9,22,18,11,3,25,7,15,6,26,19,12,1,40,51,30,36,46,54,29,39,50,44,32,47,43,48,38,55,33,52,45,41,49,35,28,31],t0=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],O=0,j,G,J,z,q,Y;j=65536;G=1<<24;J=j|G;z=4;q=1024;Y=z|q;var Dl=[J|q,O|O,j|O,J|Y,J|z,j|Y,O|z,j|O,O|q,J|q,J|Y,O|q,G|Y,J|z,G|O,O|z,O|Y,G|q,G|q,j|q,j|q,J|O,J|O,G|Y,j|z,G|z,G|z,j|z,O|O,O|Y,j|Y,G|O,j|O,J|Y,O|z,J|O,J|q,G|O,G|O,O|q,J|z,j|O,j|q,G|z,O|q,O|z,G|Y,j|Y,J|Y,j|z,J|O,G|Y,G|z,O|Y,j|Y,J|q,O|Y,G|q,G|q,O|O,j|z,j|q,O|O,J|z];j=1<<20;G=1<<31;J=j|G;z=32;q=32768;Y=z|q;var Rl=[J|Y,G|q,O|q,j|Y,j|O,O|z,J|z,G|Y,G|z,J|Y,J|q,G|O,G|q,j|O,O|z,J|z,j|q,j|z,G|Y,O|O,G|O,O|q,j|Y,J|O,j|z,G|z,O|O,j|q,O|Y,J|q,J|O,O|Y,O|O,j|Y,J|z,j|O,G|Y,J|O,J|q,O|q,J|O,G|q,O|z,J|Y,j|Y,O|z,O|q,G|O,O|Y,J|q,j|O,G|z,j|z,G|Y,G|z,j|z,j|q,O|O,G|q,O|Y,G|O,J|z,J|Y,j|q];j=1<<17;G=1<<27;J=j|G;z=8;q=512;Y=z|q;var Ml=[O|Y,J|q,O|O,J|z,G|q,O|O,j|Y,G|q,j|z,G|z,G|z,j|O,J|Y,j|z,J|O,O|Y,G|O,O|z,J|q,O|q,j|q,J|O,J|z,j|Y,G|Y,j|q,j|O,G|Y,O|z,J|Y,O|q,G|O,J|q,G|O,j|z,O|Y,j|O,J|q,G|q,O|O,O|q,j|z,J|Y,G|q,G|z,O|q,O|O,J|z,G|Y,j|O,G|O,J|Y,O|z,j|Y,j|q,G|z,J|O,G|Y,O|Y,J|O,j|Y,O|z,J|z,j|q];j=8192;G=1<<23;J=j|G;z=1;q=128;Y=z|q;var Tl=[J|z,j|Y,j|Y,O|q,J|q,G|Y,G|z,j|z,O|O,J|O,J|O,J|Y,O|Y,O|O,G|q,G|z,O|z,j|O,G|O,J|z,O|q,G|O,j|z,j|q,G|Y,O|z,j|q,G|q,j|O,J|q,J|Y,O|Y,G|q,G|z,J|O,J|Y,O|Y,O|O,O|O,J|O,j|q,G|q,G|Y,O|z,J|z,j|Y,j|Y,O|q,J|Y,O|Y,O|z,j|O,G|z,j|z,J|q,G|Y,j|z,j|q,G|O,J|z,O|q,G|O,j|O,J|q];j=1<<25;G=1<<30;J=j|G;z=256;q=1<<19;Y=z|q;var Fl=[O|z,j|Y,j|q,J|z,O|q,O|z,G|O,j|q,G|Y,O|q,j|z,G|Y,J|z,J|q,O|Y,G|O,j|O,G|q,G|q,O|O,G|z,J|Y,J|Y,j|z,J|q,G|z,O|O,J|O,j|Y,j|O,J|O,O|Y,O|q,J|z,O|z,j|O,G|O,j|q,J|z,G|Y,j|z,G|O,J|q,j|Y,G|Y,O|z,j|O,J|q,J|Y,O|Y,J|O,J|Y,j|q,O|O,G|q,J|O,O|Y,j|z,G|z,O|q,O|O,G|q,j|Y,G|z];j=1<<22;G=1<<29;J=j|G;z=16;q=16384;Y=z|q;var Pl=[G|z,J|O,O|q,J|Y,J|O,O|z,J|Y,j|O,G|q,j|Y,j|O,G|z,j|z,G|q,G|O,O|Y,O|O,j|z,G|Y,O|q,j|q,G|Y,O|z,J|z,J|z,O|O,j|Y,J|q,O|Y,j|q,J|q,G|O,G|q,O|z,J|z,j|q,J|Y,j|O,O|Y,G|z,j|O,G|q,G|O,O|Y,G|z,J|Y,j|q,J|O,j|Y,J|q,O|O,J|z,O|z,O|q,J|O,j|Y,O|q,j|z,G|Y,O|O,J|q,G|O,j|z,G|Y];j=1<<21;G=1<<26;J=j|G;z=2;q=2048;Y=z|q;var Ol=[j|O,J|z,G|Y,O|O,O|q,G|Y,j|Y,J|q,J|Y,j|O,O|O,G|z,O|z,G|O,J|z,O|Y,G|q,j|Y,j|z,G|q,G|z,J|O,J|q,j|z,J|O,O|q,O|Y,J|Y,j|q,O|z,G|O,j|q,G|O,j|q,j|O,G|Y,G|Y,J|z,J|z,O|z,j|z,G|O,G|q,j|O,J|q,O|Y,j|Y,J|q,O|Y,G|z,J|Y,J|O,j|q,O|O,O|z,J|Y,O|O,j|Y,J|O,O|q,G|z,G|q,O|q,j|z];j=1<<18;G=1<<28;J=j|G;z=64;q=4096;Y=z|q;var Kl=[G|Y,O|q,j|O,J|Y,G|O,G|Y,O|z,G|O,j|z,J|O,J|Y,j|q,J|q,j|Y,O|q,O|z,J|O,G|z,G|q,O|Y,j|q,j|z,J|z,J|q,O|Y,O|O,O|O,J|z,G|z,G|q,j|Y,j|O,j|Y,j|O,J|q,O|q,O|z,J|z,O|q,j|Y,G|q,O|z,G|z,J|O,J|z,G|O,j|O,G|Y,O|O,J|Y,j|z,G|z,J|O,G|q,G|Y,O|O,J|Y,j|q,j|q,O|Y,O|Y,j|z,G|O,J|q],Ql=function(){function e(i){Vn(this,e),this.keys=[];for(var r=[],s=[],c=[],t=0,n=56;t<56;++t,n-=8){n+=n<-5?65:n<-3?31:n<-1?63:n===27?35:0;var h=n&7;r[t]=i[n>>>3]&1<<h?1:0}for(var g=0;g<16;++g){var a=g<<1,l=a+1;c[a]=c[l]=0;for(var _=28;_<59;_+=28)for(var v=_-28;v<_;++v){var u=v+t0[g];s[v]=u<_?r[u]:r[u-28]}for(var o=0;o<24;++o)s[Il[o]]!==0&&(c[a]|=1<<23-o),s[Il[o+24]]!==0&&(c[l]|=1<<23-o)}for(var d=0,f=0,p=0;d<16;++d){var y=c[f++],w=c[f++];this.keys[p]=(y&16515072)<<6,this.keys[p]|=(y&4032)<<10,this.keys[p]|=(w&16515072)>>>10,this.keys[p]|=(w&4032)>>>6,++p,this.keys[p]=(y&258048)<<12,this.keys[p]|=(y&63)<<16,this.keys[p]|=(w&258048)>>>4,this.keys[p]|=w&63,++p}}return Jn(e,[{key:"enc8",value:function(r){var s=r.slice(),c=0,t,n,h;t=s[c++]<<24|s[c++]<<16|s[c++]<<8|s[c++],n=s[c++]<<24|s[c++]<<16|s[c++]<<8|s[c++],h=(t>>>4^n)&252645135,n^=h,t^=h<<4,h=(t>>>16^n)&65535,n^=h,t^=h<<16,h=(n>>>2^t)&858993459,t^=h,n^=h<<2,h=(n>>>8^t)&16711935,t^=h,n^=h<<8,n=n<<1|n>>>31&1,h=(t^n)&2863311530,t^=h,n^=h,t=t<<1|t>>>31&1;for(var g=0,a=0;g<8;++g){h=n<<28|n>>>4,h^=this.keys[a++];var l=Ol[h&63];l|=Fl[h>>>8&63],l|=Ml[h>>>16&63],l|=Dl[h>>>24&63],h=n^this.keys[a++],l|=Kl[h&63],l|=Pl[h>>>8&63],l|=Tl[h>>>16&63],l|=Rl[h>>>24&63],t^=l,h=t<<28|t>>>4,h^=this.keys[a++],l=Ol[h&63],l|=Fl[h>>>8&63],l|=Ml[h>>>16&63],l|=Dl[h>>>24&63],h=t^this.keys[a++],l|=Kl[h&63],l|=Pl[h>>>8&63],l|=Tl[h>>>16&63],l|=Rl[h>>>24&63],n^=l}for(n=n<<31|n>>>1,h=(t^n)&2863311530,t^=h,n^=h,t=t<<31|t>>>1,h=(t>>>8^n)&16711935,n^=h,t^=h<<8,h=(t>>>2^n)&858993459,n^=h,t^=h<<2,h=(n>>>16^t)&65535,t^=h,n^=h<<16,h=(n>>>4^t)&252645135,t^=h,n^=h<<4,h=[n,t],c=0;c<8;c++)s[c]=(h[c>>>2]>>>8*(3-c%4))%256,s[c]<0&&(s[c]+=256);return s}}])}(),Kv=yi.DESECBCipher=function(){function e(){Vn(this,e),this._cipher=null}return Jn(e,[{key:"algorithm",get:function(){return{name:"DES-ECB"}}},{key:"_importKey",value:function(r,s,c){this._cipher=new Ql(r)}},{key:"encrypt",value:function(r,s){var c=new Uint8Array(s);if(c.length%8!==0||this._cipher===null)return null;for(var t=c.length/8,n=0;n<t;n++)c.set(this._cipher.enc8(c.slice(n*8,n*8+8)),n*8);return c}}],[{key:"importKey",value:function(r,s,c,t){var n=new e;return n._importKey(r),n}}])}(),Qv=yi.DESCBCCipher=function(){function e(){Vn(this,e),this._cipher=null}return Jn(e,[{key:"algorithm",get:function(){return{name:"DES-CBC"}}},{key:"_importKey",value:function(r){this._cipher=new Ql(r)}},{key:"encrypt",value:function(r,s){var c=new Uint8Array(s),t=new Uint8Array(r.iv);if(c.length%8!==0||this._cipher===null)return null;for(var n=c.length/8,h=0;h<n;h++){for(var g=0;g<8;g++)t[g]^=s[h*8+g];t=this._cipher.enc8(t),c.set(t,h*8)}return c}}],[{key:"importKey",value:function(r,s,c,t){var n=new e;return n._importKey(r),n}}])}()});var Yn=re(Yi=>{"use strict";Object.defineProperty(Yi,"__esModule",{value:!0});Yi.bigIntToU8Array=r0;Yi.modPow=i0;Yi.u8ArrayToBigInt=s0;function i0(e,i,r){var s=1n;for(e=e%r;i>0n;)(i&1n)===1n&&(s=s*e%r),i=i>>1n,e=e*e%r;return s}function r0(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=e.toString(16);i===0&&(i=Math.ceil(r.length/2)),r=r.padStart(i*2,"0");for(var s=r.length/2,c=new Uint8Array(s),t=0;t<s;t++)c[t]=parseInt(r.slice(t*2,t*2+2),16);return c}function s0(e){for(var i="0x",r=0;r<e.length;r++)i+=e[r].toString(16).padStart(2,"0");return BigInt(i)}});var Ul=re(Yr=>{"use strict";Object.defineProperty(Yr,"__esModule",{value:!0});Yr.RSACipher=void 0;var n0=o0(nn()),nt=Yn();function o0(e){return e&&e.__esModule?e:{default:e}}function ei(e){"@babel/helpers - typeof";return ei=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},ei(e)}function Ue(){"use strict";Ue=function(){return i};var e,i={},r=Object.prototype,s=r.hasOwnProperty,c=Object.defineProperty||function(k,m,x){k[m]=x.value},t=typeof Symbol=="function"?Symbol:{},n=t.iterator||"@@iterator",h=t.asyncIterator||"@@asyncIterator",g=t.toStringTag||"@@toStringTag";function a(k,m,x){return Object.defineProperty(k,m,{value:x,enumerable:!0,configurable:!0,writable:!0}),k[m]}try{a({},"")}catch{a=function(x,E,I){return x[E]=I}}function l(k,m,x,E){var I=m&&m.prototype instanceof p?m:p,M=Object.create(I.prototype),X=new Q(E||[]);return c(M,"_invoke",{value:B(k,x,X)}),M}function _(k,m,x){try{return{type:"normal",arg:k.call(m,x)}}catch(E){return{type:"throw",arg:E}}}i.wrap=l;var v="suspendedStart",u="suspendedYield",o="executing",d="completed",f={};function p(){}function y(){}function w(){}var b={};a(b,n,function(){return this});var S=Object.getPrototypeOf,A=S&&S(S(N([])));A&&A!==r&&s.call(A,n)&&(b=A);var C=w.prototype=p.prototype=Object.create(b);function D(k){["next","throw","return"].forEach(function(m){a(k,m,function(x){return this._invoke(m,x)})})}function L(k,m){function x(I,M,X,$){var W=_(k[I],k,M);if(W.type!=="throw"){var P=W.arg,T=P.value;return T&&ei(T)=="object"&&s.call(T,"__await")?m.resolve(T.__await).then(function(U){x("next",U,X,$)},function(U){x("throw",U,X,$)}):m.resolve(T).then(function(U){P.value=U,X(P)},function(U){return x("throw",U,X,$)})}$(W.arg)}var E;c(this,"_invoke",{value:function(M,X){function $(){return new m(function(W,P){x(M,X,W,P)})}return E=E?E.then($,$):$()}})}function B(k,m,x){var E=v;return function(I,M){if(E===o)throw Error("Generator is already running");if(E===d){if(I==="throw")throw M;return{value:e,done:!0}}for(x.method=I,x.arg=M;;){var X=x.delegate;if(X){var $=R(X,x);if($){if($===f)continue;return $}}if(x.method==="next")x.sent=x._sent=x.arg;else if(x.method==="throw"){if(E===v)throw E=d,x.arg;x.dispatchException(x.arg)}else x.method==="return"&&x.abrupt("return",x.arg);E=o;var W=_(k,m,x);if(W.type==="normal"){if(E=x.done?d:u,W.arg===f)continue;return{value:W.arg,done:x.done}}W.type==="throw"&&(E=d,x.method="throw",x.arg=W.arg)}}}function R(k,m){var x=m.method,E=k.iterator[x];if(E===e)return m.delegate=null,x==="throw"&&k.iterator.return&&(m.method="return",m.arg=e,R(k,m),m.method==="throw")||x!=="return"&&(m.method="throw",m.arg=new TypeError("The iterator does not provide a '"+x+"' method")),f;var I=_(E,k.iterator,m.arg);if(I.type==="throw")return m.method="throw",m.arg=I.arg,m.delegate=null,f;var M=I.arg;return M?M.done?(m[k.resultName]=M.value,m.next=k.nextLoc,m.method!=="return"&&(m.method="next",m.arg=e),m.delegate=null,f):M:(m.method="throw",m.arg=new TypeError("iterator result is not an object"),m.delegate=null,f)}function F(k){var m={tryLoc:k[0]};1 in k&&(m.catchLoc=k[1]),2 in k&&(m.finallyLoc=k[2],m.afterLoc=k[3]),this.tryEntries.push(m)}function K(k){var m=k.completion||{};m.type="normal",delete m.arg,k.completion=m}function Q(k){this.tryEntries=[{tryLoc:"root"}],k.forEach(F,this),this.reset(!0)}function N(k){if(k||k===""){var m=k[n];if(m)return m.call(k);if(typeof k.next=="function")return k;if(!isNaN(k.length)){var x=-1,E=function I(){for(;++x<k.length;)if(s.call(k,x))return I.value=k[x],I.done=!1,I;return I.value=e,I.done=!0,I};return E.next=E}}throw new TypeError(ei(k)+" is not iterable")}return y.prototype=w,c(C,"constructor",{value:w,configurable:!0}),c(w,"constructor",{value:y,configurable:!0}),y.displayName=a(w,g,"GeneratorFunction"),i.isGeneratorFunction=function(k){var m=typeof k=="function"&&k.constructor;return!!m&&(m===y||(m.displayName||m.name)==="GeneratorFunction")},i.mark=function(k){return Object.setPrototypeOf?Object.setPrototypeOf(k,w):(k.__proto__=w,a(k,g,"GeneratorFunction")),k.prototype=Object.create(C),k},i.awrap=function(k){return{__await:k}},D(L.prototype),a(L.prototype,h,function(){return this}),i.AsyncIterator=L,i.async=function(k,m,x,E,I){I===void 0&&(I=Promise);var M=new L(l(k,m,x,E),I);return i.isGeneratorFunction(m)?M:M.next().then(function(X){return X.done?X.value:M.next()})},D(C),a(C,g,"Generator"),a(C,n,function(){return this}),a(C,"toString",function(){return"[object Generator]"}),i.keys=function(k){var m=Object(k),x=[];for(var E in m)x.push(E);return x.reverse(),function I(){for(;x.length;){var M=x.pop();if(M in m)return I.value=M,I.done=!1,I}return I.done=!0,I}},i.values=N,Q.prototype={constructor:Q,reset:function(m){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(K),!m)for(var x in this)x.charAt(0)==="t"&&s.call(this,x)&&!isNaN(+x.slice(1))&&(this[x]=e)},stop:function(){this.done=!0;var m=this.tryEntries[0].completion;if(m.type==="throw")throw m.arg;return this.rval},dispatchException:function(m){if(this.done)throw m;var x=this;function E(P,T){return X.type="throw",X.arg=m,x.next=P,T&&(x.method="next",x.arg=e),!!T}for(var I=this.tryEntries.length-1;I>=0;--I){var M=this.tryEntries[I],X=M.completion;if(M.tryLoc==="root")return E("end");if(M.tryLoc<=this.prev){var $=s.call(M,"catchLoc"),W=s.call(M,"finallyLoc");if($&&W){if(this.prev<M.catchLoc)return E(M.catchLoc,!0);if(this.prev<M.finallyLoc)return E(M.finallyLoc)}else if($){if(this.prev<M.catchLoc)return E(M.catchLoc,!0)}else{if(!W)throw Error("try statement without catch or finally");if(this.prev<M.finallyLoc)return E(M.finallyLoc)}}}},abrupt:function(m,x){for(var E=this.tryEntries.length-1;E>=0;--E){var I=this.tryEntries[E];if(I.tryLoc<=this.prev&&s.call(I,"finallyLoc")&&this.prev<I.finallyLoc){var M=I;break}}M&&(m==="break"||m==="continue")&&M.tryLoc<=x&&x<=M.finallyLoc&&(M=null);var X=M?M.completion:{};return X.type=m,X.arg=x,M?(this.method="next",this.next=M.finallyLoc,f):this.complete(X)},complete:function(m,x){if(m.type==="throw")throw m.arg;return m.type==="break"||m.type==="continue"?this.next=m.arg:m.type==="return"?(this.rval=this.arg=m.arg,this.method="return",this.next="end"):m.type==="normal"&&x&&(this.next=x),f},finish:function(m){for(var x=this.tryEntries.length-1;x>=0;--x){var E=this.tryEntries[x];if(E.finallyLoc===m)return this.complete(E.completion,E.afterLoc),K(E),f}},catch:function(m){for(var x=this.tryEntries.length-1;x>=0;--x){var E=this.tryEntries[x];if(E.tryLoc===m){var I=E.completion;if(I.type==="throw"){var M=I.arg;K(E)}return M}}throw Error("illegal catch attempt")},delegateYield:function(m,x,E){return this.delegate={iterator:N(m),resultName:x,nextLoc:E},this.method==="next"&&(this.arg=e),f}},i}function Hl(e,i,r,s,c,t,n){try{var h=e[t](n),g=h.value}catch(a){return void r(a)}h.done?i(g):Promise.resolve(g).then(s,c)}function Zt(e){return function(){var i=this,r=arguments;return new Promise(function(s,c){var t=e.apply(i,r);function n(g){Hl(t,s,c,n,h,"next",g)}function h(g){Hl(t,s,c,n,h,"throw",g)}n(void 0)})}}function a0(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function Nl(e,i){for(var r=0;r<i.length;r++){var s=i[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,l0(s.key),s)}}function h0(e,i,r){return i&&Nl(e.prototype,i),r&&Nl(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function l0(e){var i=c0(e,"string");return ei(i)=="symbol"?i:i+""}function c0(e,i){if(ei(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,i||"default");if(ei(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}var Nv=Yr.RSACipher=function(){function e(){a0(this,e),this._keyLength=0,this._keyBytes=0,this._n=null,this._e=null,this._d=null,this._nBigInt=null,this._eBigInt=null,this._dBigInt=null,this._extractable=!1}return h0(e,[{key:"algorithm",get:function(){return{name:"RSA-PKCS1-v1_5"}}},{key:"_base64urlDecode",value:function(r){return r=r.replace(/-/g,"+").replace(/_/g,"/"),r=r.padEnd(Math.ceil(r.length/4)*4,"="),n0.default.decode(r)}},{key:"_padArray",value:function(r,s){var c=new Uint8Array(s);return c.set(r,s-r.length),c}},{key:"_generateKey",value:function(){var i=Zt(Ue().mark(function s(c,t){var n,h;return Ue().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return this._keyLength=c.modulusLength,this._keyBytes=Math.ceil(this._keyLength/8),a.next=4,window.crypto.subtle.generateKey({name:"RSA-OAEP",modulusLength:c.modulusLength,publicExponent:c.publicExponent,hash:{name:"SHA-256"}},!0,["encrypt","decrypt"]);case 4:return n=a.sent,a.next=7,window.crypto.subtle.exportKey("jwk",n.privateKey);case 7:h=a.sent,this._n=this._padArray(this._base64urlDecode(h.n),this._keyBytes),this._nBigInt=(0,nt.u8ArrayToBigInt)(this._n),this._e=this._padArray(this._base64urlDecode(h.e),this._keyBytes),this._eBigInt=(0,nt.u8ArrayToBigInt)(this._e),this._d=this._padArray(this._base64urlDecode(h.d),this._keyBytes),this._dBigInt=(0,nt.u8ArrayToBigInt)(this._d),this._extractable=t;case 15:case"end":return a.stop()}},s,this)}));function r(s,c){return i.apply(this,arguments)}return r}()},{key:"_importKey",value:function(){var i=Zt(Ue().mark(function s(c,t){var n,h;return Ue().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(n=c.n,h=c.e,n.length===h.length){a.next=4;break}throw new Error("the sizes of modulus and public exponent do not match");case 4:this._keyBytes=n.length,this._keyLength=this._keyBytes*8,this._n=new Uint8Array(this._keyBytes),this._e=new Uint8Array(this._keyBytes),this._n.set(n),this._e.set(h),this._nBigInt=(0,nt.u8ArrayToBigInt)(this._n),this._eBigInt=(0,nt.u8ArrayToBigInt)(this._e),this._extractable=t;case 13:case"end":return a.stop()}},s,this)}));function r(s,c){return i.apply(this,arguments)}return r}()},{key:"encrypt",value:function(){var i=Zt(Ue().mark(function s(c,t){var n,h,g,a,l;return Ue().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(t.length>this._keyBytes-11)){v.next=2;break}return v.abrupt("return",null);case 2:for(n=new Uint8Array(this._keyBytes-t.length-3),window.crypto.getRandomValues(n),h=0;h<n.length;h++)n[h]=Math.floor(n[h]*254/255+1);return g=new Uint8Array(this._keyBytes),g[1]=2,g.set(n,2),g.set(t,n.length+3),a=(0,nt.u8ArrayToBigInt)(g),l=(0,nt.modPow)(a,this._eBigInt,this._nBigInt),v.abrupt("return",(0,nt.bigIntToU8Array)(l,this._keyBytes));case 12:case"end":return v.stop()}},s,this)}));function r(s,c){return i.apply(this,arguments)}return r}()},{key:"decrypt",value:function(){var i=Zt(Ue().mark(function s(c,t){var n,h,g,a;return Ue().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(t.length===this._keyBytes){_.next=2;break}return _.abrupt("return",null);case 2:if(n=(0,nt.u8ArrayToBigInt)(t),h=(0,nt.modPow)(n,this._dBigInt,this._nBigInt),g=(0,nt.bigIntToU8Array)(h,this._keyBytes),!(g[0]!==0||g[1]!==2)){_.next=7;break}return _.abrupt("return",null);case 7:a=2;case 8:if(!(a<g.length)){_.next=14;break}if(g[a]!==0){_.next=11;break}return _.abrupt("break",14);case 11:a++,_.next=8;break;case 14:if(a!==g.length){_.next=16;break}return _.abrupt("return",null);case 16:return _.abrupt("return",g.slice(a+1,g.length));case 17:case"end":return _.stop()}},s,this)}));function r(s,c){return i.apply(this,arguments)}return r}()},{key:"exportKey",value:function(){var i=Zt(Ue().mark(function s(){return Ue().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this._extractable){t.next=2;break}throw new Error("key is not extractable");case 2:return t.abrupt("return",{n:this._n,e:this._e,d:this._d});case 3:case"end":return t.stop()}},s,this)}));function r(){return i.apply(this,arguments)}return r}()}],[{key:"generateKey",value:function(){var i=Zt(Ue().mark(function s(c,t,n){var h;return Ue().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return h=new e,a.next=3,h._generateKey(c,t);case 3:return a.abrupt("return",{privateKey:h});case 4:case"end":return a.stop()}},s)}));function r(s,c,t){return i.apply(this,arguments)}return r}()},{key:"importKey",value:function(){var i=Zt(Ue().mark(function s(c,t,n,h){var g;return Ue().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(h.length!==1||h[0]!=="encrypt")){l.next=2;break}throw new Error("only support importing RSA public key");case 2:return g=new e,l.next=5,g._importKey(c,n);case 5:return l.abrupt("return",g);case 6:case"end":return l.stop()}},s)}));function r(s,c,t,n){return i.apply(this,arguments)}return r}()}])}()});var Gl=re(Zr=>{"use strict";Object.defineProperty(Zr,"__esModule",{value:!0});Zr.DHCipher=void 0;var Pt=Yn();function Zi(e){"@babel/helpers - typeof";return Zi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Zi(e)}function Wl(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function $l(e,i){for(var r=0;r<i.length;r++){var s=i[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,u0(s.key),s)}}function jl(e,i,r){return i&&$l(e.prototype,i),r&&$l(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function u0(e){var i=d0(e,"string");return Zi(i)=="symbol"?i:i+""}function d0(e,i){if(Zi(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,i||"default");if(Zi(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}var f0=function(){function e(i){Wl(this,e),this._key=i}return jl(e,[{key:"algorithm",get:function(){return{name:"DH"}}},{key:"exportKey",value:function(){return this._key}}])}(),$v=Zr.DHCipher=function(){function e(){Wl(this,e),this._g=null,this._p=null,this._gBigInt=null,this._pBigInt=null,this._privateKey=null}return jl(e,[{key:"algorithm",get:function(){return{name:"DH"}}},{key:"_generateKey",value:function(r){var s=r.g,c=r.p;this._keyBytes=c.length,this._gBigInt=(0,Pt.u8ArrayToBigInt)(s),this._pBigInt=(0,Pt.u8ArrayToBigInt)(c),this._privateKey=window.crypto.getRandomValues(new Uint8Array(this._keyBytes)),this._privateKeyBigInt=(0,Pt.u8ArrayToBigInt)(this._privateKey),this._publicKey=(0,Pt.bigIntToU8Array)((0,Pt.modPow)(this._gBigInt,this._privateKeyBigInt,this._pBigInt),this._keyBytes)}},{key:"deriveBits",value:function(r,s){var c=Math.ceil(s/8),t=new Uint8Array(r.public),n=c>this._keyBytes?c:this._keyBytes,h=(0,Pt.modPow)((0,Pt.u8ArrayToBigInt)(t),this._privateKeyBigInt,this._pBigInt);return(0,Pt.bigIntToU8Array)(h,n).slice(0,n)}}],[{key:"generateKey",value:function(r,s){var c=new e;return c._generateKey(r),{privateKey:c,publicKey:new f0(c._publicKey)}}}])}()});var ql=re(to=>{"use strict";Object.defineProperty(to,"__esModule",{value:!0});to.MD5=g0;function es(e){"@babel/helpers - typeof";return es=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},es(e)}function Zn(){"use strict";Zn=function(){return i};var e,i={},r=Object.prototype,s=r.hasOwnProperty,c=Object.defineProperty||function(k,m,x){k[m]=x.value},t=typeof Symbol=="function"?Symbol:{},n=t.iterator||"@@iterator",h=t.asyncIterator||"@@asyncIterator",g=t.toStringTag||"@@toStringTag";function a(k,m,x){return Object.defineProperty(k,m,{value:x,enumerable:!0,configurable:!0,writable:!0}),k[m]}try{a({},"")}catch{a=function(x,E,I){return x[E]=I}}function l(k,m,x,E){var I=m&&m.prototype instanceof p?m:p,M=Object.create(I.prototype),X=new Q(E||[]);return c(M,"_invoke",{value:B(k,x,X)}),M}function _(k,m,x){try{return{type:"normal",arg:k.call(m,x)}}catch(E){return{type:"throw",arg:E}}}i.wrap=l;var v="suspendedStart",u="suspendedYield",o="executing",d="completed",f={};function p(){}function y(){}function w(){}var b={};a(b,n,function(){return this});var S=Object.getPrototypeOf,A=S&&S(S(N([])));A&&A!==r&&s.call(A,n)&&(b=A);var C=w.prototype=p.prototype=Object.create(b);function D(k){["next","throw","return"].forEach(function(m){a(k,m,function(x){return this._invoke(m,x)})})}function L(k,m){function x(I,M,X,$){var W=_(k[I],k,M);if(W.type!=="throw"){var P=W.arg,T=P.value;return T&&es(T)=="object"&&s.call(T,"__await")?m.resolve(T.__await).then(function(U){x("next",U,X,$)},function(U){x("throw",U,X,$)}):m.resolve(T).then(function(U){P.value=U,X(P)},function(U){return x("throw",U,X,$)})}$(W.arg)}var E;c(this,"_invoke",{value:function(M,X){function $(){return new m(function(W,P){x(M,X,W,P)})}return E=E?E.then($,$):$()}})}function B(k,m,x){var E=v;return function(I,M){if(E===o)throw Error("Generator is already running");if(E===d){if(I==="throw")throw M;return{value:e,done:!0}}for(x.method=I,x.arg=M;;){var X=x.delegate;if(X){var $=R(X,x);if($){if($===f)continue;return $}}if(x.method==="next")x.sent=x._sent=x.arg;else if(x.method==="throw"){if(E===v)throw E=d,x.arg;x.dispatchException(x.arg)}else x.method==="return"&&x.abrupt("return",x.arg);E=o;var W=_(k,m,x);if(W.type==="normal"){if(E=x.done?d:u,W.arg===f)continue;return{value:W.arg,done:x.done}}W.type==="throw"&&(E=d,x.method="throw",x.arg=W.arg)}}}function R(k,m){var x=m.method,E=k.iterator[x];if(E===e)return m.delegate=null,x==="throw"&&k.iterator.return&&(m.method="return",m.arg=e,R(k,m),m.method==="throw")||x!=="return"&&(m.method="throw",m.arg=new TypeError("The iterator does not provide a '"+x+"' method")),f;var I=_(E,k.iterator,m.arg);if(I.type==="throw")return m.method="throw",m.arg=I.arg,m.delegate=null,f;var M=I.arg;return M?M.done?(m[k.resultName]=M.value,m.next=k.nextLoc,m.method!=="return"&&(m.method="next",m.arg=e),m.delegate=null,f):M:(m.method="throw",m.arg=new TypeError("iterator result is not an object"),m.delegate=null,f)}function F(k){var m={tryLoc:k[0]};1 in k&&(m.catchLoc=k[1]),2 in k&&(m.finallyLoc=k[2],m.afterLoc=k[3]),this.tryEntries.push(m)}function K(k){var m=k.completion||{};m.type="normal",delete m.arg,k.completion=m}function Q(k){this.tryEntries=[{tryLoc:"root"}],k.forEach(F,this),this.reset(!0)}function N(k){if(k||k===""){var m=k[n];if(m)return m.call(k);if(typeof k.next=="function")return k;if(!isNaN(k.length)){var x=-1,E=function I(){for(;++x<k.length;)if(s.call(k,x))return I.value=k[x],I.done=!1,I;return I.value=e,I.done=!0,I};return E.next=E}}throw new TypeError(es(k)+" is not iterable")}return y.prototype=w,c(C,"constructor",{value:w,configurable:!0}),c(w,"constructor",{value:y,configurable:!0}),y.displayName=a(w,g,"GeneratorFunction"),i.isGeneratorFunction=function(k){var m=typeof k=="function"&&k.constructor;return!!m&&(m===y||(m.displayName||m.name)==="GeneratorFunction")},i.mark=function(k){return Object.setPrototypeOf?Object.setPrototypeOf(k,w):(k.__proto__=w,a(k,g,"GeneratorFunction")),k.prototype=Object.create(C),k},i.awrap=function(k){return{__await:k}},D(L.prototype),a(L.prototype,h,function(){return this}),i.AsyncIterator=L,i.async=function(k,m,x,E,I){I===void 0&&(I=Promise);var M=new L(l(k,m,x,E),I);return i.isGeneratorFunction(m)?M:M.next().then(function(X){return X.done?X.value:M.next()})},D(C),a(C,g,"Generator"),a(C,n,function(){return this}),a(C,"toString",function(){return"[object Generator]"}),i.keys=function(k){var m=Object(k),x=[];for(var E in m)x.push(E);return x.reverse(),function I(){for(;x.length;){var M=x.pop();if(M in m)return I.value=M,I.done=!1,I}return I.done=!0,I}},i.values=N,Q.prototype={constructor:Q,reset:function(m){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(K),!m)for(var x in this)x.charAt(0)==="t"&&s.call(this,x)&&!isNaN(+x.slice(1))&&(this[x]=e)},stop:function(){this.done=!0;var m=this.tryEntries[0].completion;if(m.type==="throw")throw m.arg;return this.rval},dispatchException:function(m){if(this.done)throw m;var x=this;function E(P,T){return X.type="throw",X.arg=m,x.next=P,T&&(x.method="next",x.arg=e),!!T}for(var I=this.tryEntries.length-1;I>=0;--I){var M=this.tryEntries[I],X=M.completion;if(M.tryLoc==="root")return E("end");if(M.tryLoc<=this.prev){var $=s.call(M,"catchLoc"),W=s.call(M,"finallyLoc");if($&&W){if(this.prev<M.catchLoc)return E(M.catchLoc,!0);if(this.prev<M.finallyLoc)return E(M.finallyLoc)}else if($){if(this.prev<M.catchLoc)return E(M.catchLoc,!0)}else{if(!W)throw Error("try statement without catch or finally");if(this.prev<M.finallyLoc)return E(M.finallyLoc)}}}},abrupt:function(m,x){for(var E=this.tryEntries.length-1;E>=0;--E){var I=this.tryEntries[E];if(I.tryLoc<=this.prev&&s.call(I,"finallyLoc")&&this.prev<I.finallyLoc){var M=I;break}}M&&(m==="break"||m==="continue")&&M.tryLoc<=x&&x<=M.finallyLoc&&(M=null);var X=M?M.completion:{};return X.type=m,X.arg=x,M?(this.method="next",this.next=M.finallyLoc,f):this.complete(X)},complete:function(m,x){if(m.type==="throw")throw m.arg;return m.type==="break"||m.type==="continue"?this.next=m.arg:m.type==="return"?(this.rval=this.arg=m.arg,this.method="return",this.next="end"):m.type==="normal"&&x&&(this.next=x),f},finish:function(m){for(var x=this.tryEntries.length-1;x>=0;--x){var E=this.tryEntries[x];if(E.finallyLoc===m)return this.complete(E.completion,E.afterLoc),K(E),f}},catch:function(m){for(var x=this.tryEntries.length-1;x>=0;--x){var E=this.tryEntries[x];if(E.tryLoc===m){var I=E.completion;if(I.type==="throw"){var M=I.arg;K(E)}return M}}throw Error("illegal catch attempt")},delegateYield:function(m,x,E){return this.delegate={iterator:N(m),resultName:x,nextLoc:E},this.method==="next"&&(this.arg=e),f}},i}function zl(e,i,r,s,c,t,n){try{var h=e[t](n),g=h.value}catch(a){return void r(a)}h.done?i(g):Promise.resolve(g).then(s,c)}function _0(e){return function(){var i=this,r=arguments;return new Promise(function(s,c){var t=e.apply(i,r);function n(g){zl(t,s,c,n,h,"next",g)}function h(g){zl(t,s,c,n,h,"throw",g)}n(void 0)})}}function g0(e){return eo.apply(this,arguments)}function eo(){return eo=_0(Zn().mark(function e(i){var r,s;return Zn().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(r="",s=0;s<i.length;s++)r+=String.fromCharCode(i[s]);return t.abrupt("return",p0(m0(y0(v0(r),8*r.length))));case 3:case"end":return t.stop()}},e)})),eo.apply(this,arguments)}function p0(e){for(var i=new Uint8Array(e.length),r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return i}function v0(e){for(var i=Array(e.length>>2),r=0;r<i.length;r++)i[r]=0;for(var s=0;s<8*e.length;s+=8)i[s>>5]|=(255&e.charCodeAt(s/8))<<s%32;return i}function m0(e){for(var i="",r=0;r<32*e.length;r+=8)i+=String.fromCharCode(e[r>>5]>>>r%32&255);return i}function y0(e,i){e[i>>5]|=128<<i%32,e[14+(i+64>>>9<<4)]=i;for(var r=1732584193,s=-271733879,c=-1732584194,t=271733878,n=0;n<e.length;n+=16){var h=r,g=s,a=c,l=t;s=Qe(s=Qe(s=Qe(s=Qe(s=Ke(s=Ke(s=Ke(s=Ke(s=Oe(s=Oe(s=Oe(s=Oe(s=Pe(s=Pe(s=Pe(s=Pe(s,c=Pe(c,t=Pe(t,r=Pe(r,s,c,t,e[n+0],7,-680876936),s,c,e[n+1],12,-389564586),r,s,e[n+2],17,606105819),t,r,e[n+3],22,-1044525330),c=Pe(c,t=Pe(t,r=Pe(r,s,c,t,e[n+4],7,-176418897),s,c,e[n+5],12,1200080426),r,s,e[n+6],17,-1473231341),t,r,e[n+7],22,-45705983),c=Pe(c,t=Pe(t,r=Pe(r,s,c,t,e[n+8],7,1770035416),s,c,e[n+9],12,-1958414417),r,s,e[n+10],17,-42063),t,r,e[n+11],22,-1990404162),c=Pe(c,t=Pe(t,r=Pe(r,s,c,t,e[n+12],7,1804603682),s,c,e[n+13],12,-40341101),r,s,e[n+14],17,-1502002290),t,r,e[n+15],22,1236535329),c=Oe(c,t=Oe(t,r=Oe(r,s,c,t,e[n+1],5,-165796510),s,c,e[n+6],9,-1069501632),r,s,e[n+11],14,643717713),t,r,e[n+0],20,-373897302),c=Oe(c,t=Oe(t,r=Oe(r,s,c,t,e[n+5],5,-701558691),s,c,e[n+10],9,38016083),r,s,e[n+15],14,-660478335),t,r,e[n+4],20,-405537848),c=Oe(c,t=Oe(t,r=Oe(r,s,c,t,e[n+9],5,568446438),s,c,e[n+14],9,-1019803690),r,s,e[n+3],14,-187363961),t,r,e[n+8],20,1163531501),c=Oe(c,t=Oe(t,r=Oe(r,s,c,t,e[n+13],5,-1444681467),s,c,e[n+2],9,-51403784),r,s,e[n+7],14,1735328473),t,r,e[n+12],20,-1926607734),c=Ke(c,t=Ke(t,r=Ke(r,s,c,t,e[n+5],4,-378558),s,c,e[n+8],11,-2022574463),r,s,e[n+11],16,1839030562),t,r,e[n+14],23,-35309556),c=Ke(c,t=Ke(t,r=Ke(r,s,c,t,e[n+1],4,-1530992060),s,c,e[n+4],11,1272893353),r,s,e[n+7],16,-155497632),t,r,e[n+10],23,-1094730640),c=Ke(c,t=Ke(t,r=Ke(r,s,c,t,e[n+13],4,681279174),s,c,e[n+0],11,-358537222),r,s,e[n+3],16,-722521979),t,r,e[n+6],23,76029189),c=Ke(c,t=Ke(t,r=Ke(r,s,c,t,e[n+9],4,-640364487),s,c,e[n+12],11,-421815835),r,s,e[n+15],16,530742520),t,r,e[n+2],23,-995338651),c=Qe(c,t=Qe(t,r=Qe(r,s,c,t,e[n+0],6,-198630844),s,c,e[n+7],10,1126891415),r,s,e[n+14],15,-1416354905),t,r,e[n+5],21,-57434055),c=Qe(c,t=Qe(t,r=Qe(r,s,c,t,e[n+12],6,1700485571),s,c,e[n+3],10,-1894986606),r,s,e[n+10],15,-1051523),t,r,e[n+1],21,-2054922799),c=Qe(c,t=Qe(t,r=Qe(r,s,c,t,e[n+8],6,1873313359),s,c,e[n+15],10,-30611744),r,s,e[n+6],15,-1560198380),t,r,e[n+13],21,1309151649),c=Qe(c,t=Qe(t,r=Qe(r,s,c,t,e[n+4],6,-145523070),s,c,e[n+11],10,-1120210379),r,s,e[n+2],15,718787259),t,r,e[n+9],21,-343485551),r=Ot(r,h),s=Ot(s,g),c=Ot(c,a),t=Ot(t,l)}return Array(r,s,c,t)}function ts(e,i,r,s,c,t){return Ot(b0(Ot(Ot(i,e),Ot(s,t)),c),r)}function Pe(e,i,r,s,c,t,n){return ts(i&r|~i&s,e,i,c,t,n)}function Oe(e,i,r,s,c,t,n){return ts(i&s|r&~s,e,i,c,t,n)}function Ke(e,i,r,s,c,t,n){return ts(i^r^s,e,i,c,t,n)}function Qe(e,i,r,s,c,t,n){return ts(r^(i|~s),e,i,c,t,n)}function Ot(e,i){var r=(65535&e)+(65535&i);return(e>>16)+(i>>16)+(r>>16)<<16|65535&r}function b0(e,i){return e<<i|e>>>32-i}});var io=re(is=>{"use strict";Object.defineProperty(is,"__esModule",{value:!0});is.default=void 0;var Vl=Bl(),Jl=Xl(),A0=Ul(),w0=Gl(),C0=ql();function er(e){"@babel/helpers - typeof";return er=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},er(e)}function x0(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function Yl(e,i){for(var r=0;r<i.length;r++){var s=i[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,E0(s.key),s)}}function S0(e,i,r){return i&&Yl(e.prototype,i),r&&Yl(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function E0(e){var i=k0(e,"string");return er(i)=="symbol"?i:i+""}function k0(e,i){if(er(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,i||"default");if(er(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}var B0=function(){function e(){x0(this,e),this._algorithms={"AES-ECB":Vl.AESECBCipher,"AES-EAX":Vl.AESEAXCipher,"DES-ECB":Jl.DESECBCipher,"DES-CBC":Jl.DESCBCCipher,"RSA-PKCS1-v1_5":A0.RSACipher,DH:w0.DHCipher,MD5:C0.MD5}}return S0(e,[{key:"encrypt",value:function(r,s,c){if(s.algorithm.name!==r.name)throw new Error("algorithm does not match");if(typeof s.encrypt!="function")throw new Error("key does not support encryption");return s.encrypt(r,c)}},{key:"decrypt",value:function(r,s,c){if(s.algorithm.name!==r.name)throw new Error("algorithm does not match");if(typeof s.decrypt!="function")throw new Error("key does not support encryption");return s.decrypt(r,c)}},{key:"importKey",value:function(r,s,c,t,n){if(r!=="raw")throw new Error("key format is not supported");var h=this._algorithms[c.name];if(typeof h>"u"||typeof h.importKey!="function")throw new Error("algorithm is not supported");return h.importKey(s,c,t,n)}},{key:"generateKey",value:function(r,s,c){var t=this._algorithms[r.name];if(typeof t>"u"||typeof t.generateKey!="function")throw new Error("algorithm is not supported");return t.generateKey(r,s,c)}},{key:"exportKey",value:function(r,s){if(r!=="raw")throw new Error("key format is not supported");if(typeof s.exportKey!="function")throw new Error("key does not support exportKey");return s.exportKey()}},{key:"digest",value:function(r,s){var c=this._algorithms[r];if(typeof c!="function")throw new Error("algorithm is not supported");return c(s)}},{key:"deriveBits",value:function(r,s,c){if(s.algorithm.name!==r.name)throw new Error("algorithm does not match");if(typeof s.deriveBits!="function")throw new Error("key does not support deriveBits");return s.deriveBits(r,c)}}])}(),Gv=is.default=new B0});var ac=re(ns=>{"use strict";Object.defineProperty(ns,"__esModule",{value:!0});ns.default=void 0;var Zl=zs(),L0=rc(rn()),Kt=rc(io());function rc(e){return e&&e.__esModule?e:{default:e}}function I0(e,i,r){return i=ss(i),D0(e,sc()?Reflect.construct(i,r||[],ss(e).constructor):i.apply(e,r))}function D0(e,i){if(i&&(Qt(i)=="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return R0(e)}function R0(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function sc(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(sc=function(){return!!e})()}function ss(e){return ss=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},ss(e)}function M0(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&ro(e,i)}function ro(e,i){return ro=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},ro(e,i)}function Qt(e){"@babel/helpers - typeof";return Qt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Qt(e)}function Ct(){"use strict";Ct=function(){return i};var e,i={},r=Object.prototype,s=r.hasOwnProperty,c=Object.defineProperty||function(k,m,x){k[m]=x.value},t=typeof Symbol=="function"?Symbol:{},n=t.iterator||"@@iterator",h=t.asyncIterator||"@@asyncIterator",g=t.toStringTag||"@@toStringTag";function a(k,m,x){return Object.defineProperty(k,m,{value:x,enumerable:!0,configurable:!0,writable:!0}),k[m]}try{a({},"")}catch{a=function(x,E,I){return x[E]=I}}function l(k,m,x,E){var I=m&&m.prototype instanceof p?m:p,M=Object.create(I.prototype),X=new Q(E||[]);return c(M,"_invoke",{value:B(k,x,X)}),M}function _(k,m,x){try{return{type:"normal",arg:k.call(m,x)}}catch(E){return{type:"throw",arg:E}}}i.wrap=l;var v="suspendedStart",u="suspendedYield",o="executing",d="completed",f={};function p(){}function y(){}function w(){}var b={};a(b,n,function(){return this});var S=Object.getPrototypeOf,A=S&&S(S(N([])));A&&A!==r&&s.call(A,n)&&(b=A);var C=w.prototype=p.prototype=Object.create(b);function D(k){["next","throw","return"].forEach(function(m){a(k,m,function(x){return this._invoke(m,x)})})}function L(k,m){function x(I,M,X,$){var W=_(k[I],k,M);if(W.type!=="throw"){var P=W.arg,T=P.value;return T&&Qt(T)=="object"&&s.call(T,"__await")?m.resolve(T.__await).then(function(U){x("next",U,X,$)},function(U){x("throw",U,X,$)}):m.resolve(T).then(function(U){P.value=U,X(P)},function(U){return x("throw",U,X,$)})}$(W.arg)}var E;c(this,"_invoke",{value:function(M,X){function $(){return new m(function(W,P){x(M,X,W,P)})}return E=E?E.then($,$):$()}})}function B(k,m,x){var E=v;return function(I,M){if(E===o)throw Error("Generator is already running");if(E===d){if(I==="throw")throw M;return{value:e,done:!0}}for(x.method=I,x.arg=M;;){var X=x.delegate;if(X){var $=R(X,x);if($){if($===f)continue;return $}}if(x.method==="next")x.sent=x._sent=x.arg;else if(x.method==="throw"){if(E===v)throw E=d,x.arg;x.dispatchException(x.arg)}else x.method==="return"&&x.abrupt("return",x.arg);E=o;var W=_(k,m,x);if(W.type==="normal"){if(E=x.done?d:u,W.arg===f)continue;return{value:W.arg,done:x.done}}W.type==="throw"&&(E=d,x.method="throw",x.arg=W.arg)}}}function R(k,m){var x=m.method,E=k.iterator[x];if(E===e)return m.delegate=null,x==="throw"&&k.iterator.return&&(m.method="return",m.arg=e,R(k,m),m.method==="throw")||x!=="return"&&(m.method="throw",m.arg=new TypeError("The iterator does not provide a '"+x+"' method")),f;var I=_(E,k.iterator,m.arg);if(I.type==="throw")return m.method="throw",m.arg=I.arg,m.delegate=null,f;var M=I.arg;return M?M.done?(m[k.resultName]=M.value,m.next=k.nextLoc,m.method!=="return"&&(m.method="next",m.arg=e),m.delegate=null,f):M:(m.method="throw",m.arg=new TypeError("iterator result is not an object"),m.delegate=null,f)}function F(k){var m={tryLoc:k[0]};1 in k&&(m.catchLoc=k[1]),2 in k&&(m.finallyLoc=k[2],m.afterLoc=k[3]),this.tryEntries.push(m)}function K(k){var m=k.completion||{};m.type="normal",delete m.arg,k.completion=m}function Q(k){this.tryEntries=[{tryLoc:"root"}],k.forEach(F,this),this.reset(!0)}function N(k){if(k||k===""){var m=k[n];if(m)return m.call(k);if(typeof k.next=="function")return k;if(!isNaN(k.length)){var x=-1,E=function I(){for(;++x<k.length;)if(s.call(k,x))return I.value=k[x],I.done=!1,I;return I.value=e,I.done=!0,I};return E.next=E}}throw new TypeError(Qt(k)+" is not iterable")}return y.prototype=w,c(C,"constructor",{value:w,configurable:!0}),c(w,"constructor",{value:y,configurable:!0}),y.displayName=a(w,g,"GeneratorFunction"),i.isGeneratorFunction=function(k){var m=typeof k=="function"&&k.constructor;return!!m&&(m===y||(m.displayName||m.name)==="GeneratorFunction")},i.mark=function(k){return Object.setPrototypeOf?Object.setPrototypeOf(k,w):(k.__proto__=w,a(k,g,"GeneratorFunction")),k.prototype=Object.create(C),k},i.awrap=function(k){return{__await:k}},D(L.prototype),a(L.prototype,h,function(){return this}),i.AsyncIterator=L,i.async=function(k,m,x,E,I){I===void 0&&(I=Promise);var M=new L(l(k,m,x,E),I);return i.isGeneratorFunction(m)?M:M.next().then(function(X){return X.done?X.value:M.next()})},D(C),a(C,g,"Generator"),a(C,n,function(){return this}),a(C,"toString",function(){return"[object Generator]"}),i.keys=function(k){var m=Object(k),x=[];for(var E in m)x.push(E);return x.reverse(),function I(){for(;x.length;){var M=x.pop();if(M in m)return I.value=M,I.done=!1,I}return I.done=!0,I}},i.values=N,Q.prototype={constructor:Q,reset:function(m){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(K),!m)for(var x in this)x.charAt(0)==="t"&&s.call(this,x)&&!isNaN(+x.slice(1))&&(this[x]=e)},stop:function(){this.done=!0;var m=this.tryEntries[0].completion;if(m.type==="throw")throw m.arg;return this.rval},dispatchException:function(m){if(this.done)throw m;var x=this;function E(P,T){return X.type="throw",X.arg=m,x.next=P,T&&(x.method="next",x.arg=e),!!T}for(var I=this.tryEntries.length-1;I>=0;--I){var M=this.tryEntries[I],X=M.completion;if(M.tryLoc==="root")return E("end");if(M.tryLoc<=this.prev){var $=s.call(M,"catchLoc"),W=s.call(M,"finallyLoc");if($&&W){if(this.prev<M.catchLoc)return E(M.catchLoc,!0);if(this.prev<M.finallyLoc)return E(M.finallyLoc)}else if($){if(this.prev<M.catchLoc)return E(M.catchLoc,!0)}else{if(!W)throw Error("try statement without catch or finally");if(this.prev<M.finallyLoc)return E(M.finallyLoc)}}}},abrupt:function(m,x){for(var E=this.tryEntries.length-1;E>=0;--E){var I=this.tryEntries[E];if(I.tryLoc<=this.prev&&s.call(I,"finallyLoc")&&this.prev<I.finallyLoc){var M=I;break}}M&&(m==="break"||m==="continue")&&M.tryLoc<=x&&x<=M.finallyLoc&&(M=null);var X=M?M.completion:{};return X.type=m,X.arg=x,M?(this.method="next",this.next=M.finallyLoc,f):this.complete(X)},complete:function(m,x){if(m.type==="throw")throw m.arg;return m.type==="break"||m.type==="continue"?this.next=m.arg:m.type==="return"?(this.rval=this.arg=m.arg,this.method="return",this.next="end"):m.type==="normal"&&x&&(this.next=x),f},finish:function(m){for(var x=this.tryEntries.length-1;x>=0;--x){var E=this.tryEntries[x];if(E.finallyLoc===m)return this.complete(E.completion,E.afterLoc),K(E),f}},catch:function(m){for(var x=this.tryEntries.length-1;x>=0;--x){var E=this.tryEntries[x];if(E.tryLoc===m){var I=E.completion;if(I.type==="throw"){var M=I.arg;K(E)}return M}}throw Error("illegal catch attempt")},delegateYield:function(m,x,E){return this.delegate={iterator:N(m),resultName:x,nextLoc:E},this.method==="next"&&(this.arg=e),f}},i}function ec(e,i,r,s,c,t,n){try{var h=e[t](n),g=h.value}catch(a){return void r(a)}h.done?i(g):Promise.resolve(g).then(s,c)}function rs(e){return function(){var i=this,r=arguments;return new Promise(function(s,c){var t=e.apply(i,r);function n(g){ec(t,s,c,n,h,"next",g)}function h(g){ec(t,s,c,n,h,"throw",g)}n(void 0)})}}function nc(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function tc(e,i){for(var r=0;r<i.length;r++){var s=i[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,T0(s.key),s)}}function oc(e,i,r){return i&&tc(e.prototype,i),r&&tc(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function T0(e){var i=F0(e,"string");return Qt(i)=="symbol"?i:i+""}function F0(e,i){if(Qt(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,i||"default");if(Qt(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}var ic=function(){function e(){nc(this,e),this._cipher=null,this._counter=new Uint8Array(16)}return oc(e,[{key:"setKey",value:function(){var i=rs(Ct().mark(function s(c){return Ct().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Kt.default.importKey("raw",c,{name:"AES-EAX"},!1,["encrypt, decrypt"]);case 2:this._cipher=n.sent;case 3:case"end":return n.stop()}},s,this)}));function r(s){return i.apply(this,arguments)}return r}()},{key:"makeMessage",value:function(){var i=rs(Ct().mark(function s(c){var t,n,h,g;return Ct().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return t=new Uint8Array([(c.length&65280)>>>8,c.length&255]),l.next=3,Kt.default.encrypt({name:"AES-EAX",iv:this._counter,additionalData:t},this._cipher,c);case 3:for(n=l.sent,h=0;h<16&&this._counter[h]++===255;h++);return g=new Uint8Array(c.length+2+16),g.set(t),g.set(n,2),l.abrupt("return",g);case 9:case"end":return l.stop()}},s,this)}));function r(s){return i.apply(this,arguments)}return r}()},{key:"receiveMessage",value:function(){var i=rs(Ct().mark(function s(c,t){var n,h,g;return Ct().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return n=new Uint8Array([(c&65280)>>>8,c&255]),l.next=3,Kt.default.decrypt({name:"AES-EAX",iv:this._counter,additionalData:n},this._cipher,t);case 3:for(h=l.sent,g=0;g<16&&this._counter[g]++===255;g++);return l.abrupt("return",h);case 6:case"end":return l.stop()}},s,this)}));function r(s,c){return i.apply(this,arguments)}return r}()}])}(),qv=ns.default=function(e){function i(r,s){var c;return nc(this,i),c=I0(this,i),c._hasStarted=!1,c._checkSock=null,c._checkCredentials=null,c._approveServerResolve=null,c._sockReject=null,c._credentialsReject=null,c._approveServerReject=null,c._sock=r,c._getCredentials=s,c}return M0(i,e),oc(i,[{key:"_waitSockAsync",value:function(s){var c=this;return new Promise(function(t,n){var h=function(){return!c._sock.rQwait("RA2",s)};h()?t():(c._checkSock=function(){h()&&(t(),c._checkSock=null,c._sockReject=null)},c._sockReject=n)})}},{key:"_waitApproveKeyAsync",value:function(){var s=this;return new Promise(function(c,t){s._approveServerResolve=c,s._approveServerReject=t})}},{key:"_waitCredentialsAsync",value:function(s){var c=this,t=function(){return s===1&&c._getCredentials().username!==void 0&&c._getCredentials().password!==void 0?!0:s===2&&c._getCredentials().password!==void 0};return new Promise(function(n,h){t()?n():(c._checkCredentials=function(){t()&&(n(),c._checkCredentials=null,c._credentialsReject=null)},c._credentialsReject=h)})}},{key:"checkInternalEvents",value:function(){this._checkSock!==null&&this._checkSock(),this._checkCredentials!==null&&this._checkCredentials()}},{key:"approveServer",value:function(){this._approveServerResolve!==null&&(this._approveServerResolve(),this._approveServerResolve=null)}},{key:"disconnect",value:function(){this._sockReject!==null&&(this._sockReject(new Error("disconnect normally")),this._sockReject=null),this._credentialsReject!==null&&(this._credentialsReject(new Error("disconnect normally")),this._credentialsReject=null),this._approveServerReject!==null&&(this._approveServerReject(new Error("disconnect normally")),this._approveServerReject=null)}},{key:"negotiateRA2neAuthAsync",value:function(){var r=rs(Ct().mark(function c(){var t,n,h,g,a,l,_,v,u,o,d,f,p,y,w,b,S,A,C,D,L,B,R,F,K,Q,N,k,m,x,E,I,M,X,$;return Ct().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return this._hasStarted=!0,P.next=3,this._waitSockAsync(4);case 3:if(t=this._sock.rQpeekBytes(4),n=this._sock.rQshift32(),!(n<1024)){P.next=9;break}throw new Error("RA2: server public key is too short: "+n);case 9:if(!(n>8192)){P.next=11;break}throw new Error("RA2: server public key is too long: "+n);case 11:return h=Math.ceil(n/8),P.next=14,this._waitSockAsync(h*2);case 14:return g=this._sock.rQshiftBytes(h),a=this._sock.rQshiftBytes(h),P.next=18,Kt.default.importKey("raw",{n:g,e:a},{name:"RSA-PKCS1-v1_5"},!1,["encrypt"]);case 18:return l=P.sent,_=new Uint8Array(4+h*2),_.set(t),_.set(g,4),_.set(a,4+h),v=this._waitApproveKeyAsync(),this.dispatchEvent(new CustomEvent("serververification",{detail:{type:"RSA",publickey:_}})),P.next=27,v;case 27:return u=2048,o=Math.ceil(u/8),P.next=31,Kt.default.generateKey({name:"RSA-PKCS1-v1_5",modulusLength:u,publicExponent:new Uint8Array([1,0,1])},!0,["encrypt"]);case 31:return d=P.sent.privateKey,P.next=34,Kt.default.exportKey("raw",d);case 34:return f=P.sent,p=f.n,y=f.e,w=new Uint8Array(4+o*2),w[0]=(u&4278190080)>>>24,w[1]=(u&16711680)>>>16,w[2]=(u&65280)>>>8,w[3]=u&255,w.set(p,4),w.set(y,4+o),this._sock.sQpushBytes(w),this._sock.flush(),b=new Uint8Array(16),window.crypto.getRandomValues(b),P.next=50,Kt.default.encrypt({name:"RSA-PKCS1-v1_5"},l,b);case 50:return S=P.sent,A=new Uint8Array(2+h),A[0]=(h&65280)>>>8,A[1]=h&255,A.set(S,2),this._sock.sQpushBytes(A),this._sock.flush(),P.next=59,this._waitSockAsync(2);case 59:if(this._sock.rQshift16()===o){P.next=61;break}throw new Error("RA2: wrong encrypted message length");case 61:return C=this._sock.rQshiftBytes(o),P.next=64,Kt.default.decrypt({name:"RSA-PKCS1-v1_5"},d,C);case 64:if(D=P.sent,!(D===null||D.length!==16)){P.next=67;break}throw new Error("RA2: corrupted server encrypted random");case 67:return L=new Uint8Array(32),B=new Uint8Array(32),L.set(D),L.set(b,16),B.set(b),B.set(D,16),P.next=75,window.crypto.subtle.digest("SHA-1",L);case 75:return L=P.sent,L=new Uint8Array(L).slice(0,16),P.next=79,window.crypto.subtle.digest("SHA-1",B);case 79:return B=P.sent,B=new Uint8Array(B).slice(0,16),R=new ic,P.next=84,R.setKey(L);case 84:return F=new ic,P.next=87,F.setKey(B);case 87:return K=new Uint8Array(8+h*2+o*2),Q=new Uint8Array(8+h*2+o*2),K.set(_),K.set(w,4+h*2),Q.set(w),Q.set(_,4+o*2),P.next=95,window.crypto.subtle.digest("SHA-1",K);case 95:return K=P.sent,P.next=98,window.crypto.subtle.digest("SHA-1",Q);case 98:return Q=P.sent,K=new Uint8Array(K),Q=new Uint8Array(Q),P.t0=this._sock,P.next=104,R.makeMessage(Q);case 104:return P.t1=P.sent,P.t0.sQpushBytes.call(P.t0,P.t1),this._sock.flush(),P.next=109,this._waitSockAsync(38);case 109:if(this._sock.rQshift16()===20){P.next=111;break}throw new Error("RA2: wrong server hash");case 111:return P.next=113,F.receiveMessage(20,this._sock.rQshiftBytes(36));case 113:if(N=P.sent,N!==null){P.next=116;break}throw new Error("RA2: failed to authenticate the message");case 116:k=0;case 117:if(!(k<20)){P.next=123;break}if(N[k]===K[k]){P.next=120;break}throw new Error("RA2: wrong server hash");case 120:k++,P.next=117;break;case 123:return P.next=125,this._waitSockAsync(19);case 125:if(this._sock.rQshift16()===1){P.next=127;break}throw new Error("RA2: wrong subtype");case 127:return P.next=129,F.receiveMessage(1,this._sock.rQshiftBytes(17));case 129:if(m=P.sent,m!==null){P.next=132;break}throw new Error("RA2: failed to authenticate the message");case 132:if(m=m[0],x=this._waitCredentialsAsync(m),m!==1){P.next=138;break}(this._getCredentials().username===void 0||this._getCredentials().password===void 0)&&this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["username","password"]}})),P.next=143;break;case 138:if(m!==2){P.next=142;break}this._getCredentials().password===void 0&&this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["password"]}})),P.next=143;break;case 142:throw new Error("RA2: wrong subtype");case 143:return P.next=145,x;case 145:for(m===1?E=(0,Zl.encodeUTF8)(this._getCredentials().username).slice(0,255):E="",I=(0,Zl.encodeUTF8)(this._getCredentials().password).slice(0,255),M=new Uint8Array(E.length+I.length+2),M[0]=E.length,M[E.length+1]=I.length,X=0;X<E.length;X++)M[X+1]=E.charCodeAt(X);for($=0;$<I.length;$++)M[E.length+2+$]=I.charCodeAt($);return P.t2=this._sock,P.next=155,R.makeMessage(M);case 155:P.t3=P.sent,P.t2.sQpushBytes.call(P.t2,P.t3),this._sock.flush();case 158:case"end":return P.stop()}},c,this)}));function s(){return r.apply(this,arguments)}return s}()},{key:"hasStarted",get:function(){return this._hasStarted},set:function(s){this._hasStarted=s}}])}(L0.default)});var lc=re(os=>{"use strict";Object.defineProperty(os,"__esModule",{value:!0});os.default=void 0;function tr(e){"@babel/helpers - typeof";return tr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},tr(e)}function P0(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function hc(e,i){for(var r=0;r<i.length;r++){var s=i[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,K0(s.key),s)}}function O0(e,i,r){return i&&hc(e.prototype,i),r&&hc(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function K0(e){var i=Q0(e,"string");return tr(i)=="symbol"?i:i+""}function Q0(e,i){if(tr(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,i||"default");if(tr(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}var Jv=os.default=function(){function e(){P0(this,e),this._lines=0}return O0(e,[{key:"decodeRect",value:function(r,s,c,t,n,h,g){if(c===0||t===0)return!0;this._lines===0&&(this._lines=t);for(var a=g==8?1:4,l=c*a;this._lines>0;){if(n.rQwait("RAW",l))return!1;var _=s+(t-this._lines),v=n.rQshiftBytes(l,!1);if(g==8){for(var u=new Uint8Array(c*4),o=0;o<c;o++)u[o*4+0]=(v[o]>>0&3)*255/3,u[o*4+1]=(v[o]>>2&3)*255/3,u[o*4+2]=(v[o]>>4&3)*255/3,u[o*4+3]=255;v=u}for(var d=0;d<c;d++)v[d*4+3]=255;h.blitImage(r,_,c,1,v,0),this._lines--}return!0}}])}()});var uc=re(as=>{"use strict";Object.defineProperty(as,"__esModule",{value:!0});as.default=void 0;function ir(e){"@babel/helpers - typeof";return ir=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},ir(e)}function X0(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function cc(e,i){for(var r=0;r<i.length;r++){var s=i[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,N0(s.key),s)}}function H0(e,i,r){return i&&cc(e.prototype,i),r&&cc(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function N0(e){var i=U0(e,"string");return ir(i)=="symbol"?i:i+""}function U0(e,i){if(ir(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,i||"default");if(ir(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}var Zv=as.default=function(){function e(){X0(this,e)}return H0(e,[{key:"decodeRect",value:function(r,s,c,t,n,h,g){if(n.rQwait("COPYRECT",4))return!1;var a=n.rQshift16(),l=n.rQshift16();return c===0||t===0||h.copyImage(a,l,r,s,c,t),!0}}])}()});var fc=re(hs=>{"use strict";Object.defineProperty(hs,"__esModule",{value:!0});hs.default=void 0;function rr(e){"@babel/helpers - typeof";return rr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},rr(e)}function $0(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function dc(e,i){for(var r=0;r<i.length;r++){var s=i[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,j0(s.key),s)}}function W0(e,i,r){return i&&dc(e.prototype,i),r&&dc(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function j0(e){var i=G0(e,"string");return rr(i)=="symbol"?i:i+""}function G0(e,i){if(rr(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,i||"default");if(rr(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}var tm=hs.default=function(){function e(){$0(this,e),this._subrects=0}return W0(e,[{key:"decodeRect",value:function(r,s,c,t,n,h,g){if(this._subrects===0){if(n.rQwait("RRE",8))return!1;this._subrects=n.rQshift32();var a=n.rQshiftBytes(4);h.fillRect(r,s,c,t,a)}for(;this._subrects>0;){if(n.rQwait("RRE",12))return!1;var l=n.rQshiftBytes(4),_=n.rQshift16(),v=n.rQshift16(),u=n.rQshift16(),o=n.rQshift16();h.fillRect(r+_,s+v,u,o,l),this._subrects--}return!0}}])}()});var pc=re(ls=>{"use strict";Object.defineProperty(ls,"__esModule",{value:!0});ls.default=void 0;var z0=q0(yt());function gc(e){if(typeof WeakMap!="function")return null;var i=new WeakMap,r=new WeakMap;return(gc=function(c){return c?r:i})(e)}function q0(e,i){if(!i&&e&&e.__esModule)return e;if(e===null||bi(e)!="object"&&typeof e!="function")return{default:e};var r=gc(i);if(r&&r.has(e))return r.get(e);var s={__proto__:null},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var t in e)if(t!=="default"&&{}.hasOwnProperty.call(e,t)){var n=c?Object.getOwnPropertyDescriptor(e,t):null;n&&(n.get||n.set)?Object.defineProperty(s,t,n):s[t]=e[t]}return s.default=e,r&&r.set(e,s),s}function bi(e){"@babel/helpers - typeof";return bi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},bi(e)}function V0(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function _c(e,i){for(var r=0;r<i.length;r++){var s=i[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,Y0(s.key),s)}}function J0(e,i,r){return i&&_c(e.prototype,i),r&&_c(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Y0(e){var i=Z0(e,"string");return bi(i)=="symbol"?i:i+""}function Z0(e,i){if(bi(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,i||"default");if(bi(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}var rm=ls.default=function(){function e(){V0(this,e),this._tiles=0,this._lastsubencoding=0,this._tileBuffer=new Uint8Array(16*16*4)}return J0(e,[{key:"decodeRect",value:function(r,s,c,t,n,h,g){for(this._tiles===0&&(this._tilesX=Math.ceil(c/16),this._tilesY=Math.ceil(t/16),this._totalTiles=this._tilesX*this._tilesY,this._tiles=this._totalTiles);this._tiles>0;){var a=1;if(n.rQwait("HEXTILE",a))return!1;var l=n.rQpeek8();if(l>30)throw new Error("Illegal hextile subencoding (subencoding: "+l+")");var _=this._totalTiles-this._tiles,v=_%this._tilesX,u=Math.floor(_/this._tilesX),o=r+v*16,d=s+u*16,f=Math.min(16,r+c-o),p=Math.min(16,s+t-d);if(l&1)a+=f*p*4;else if(l&2&&(a+=4),l&4&&(a+=4),l&8){if(a++,n.rQwait("HEXTILE",a))return!1;var y=n.rQpeekBytes(a).at(-1);l&16?a+=y*6:a+=y*2}if(n.rQwait("HEXTILE",a))return!1;if(n.rQshift8(),l===0)this._lastsubencoding&1?z0.Debug("     Ignoring blank after RAW"):h.fillRect(o,d,f,p,this._background);else if(l&1){for(var w=f*p,b=n.rQshiftBytes(w*4,!1),S=0;S<w;S++)b[S*4+3]=255;h.blitImage(o,d,f,p,b,0)}else{if(l&2&&(this._background=new Uint8Array(n.rQshiftBytes(4))),l&4&&(this._foreground=new Uint8Array(n.rQshiftBytes(4))),this._startTile(o,d,f,p,this._background),l&8)for(var A=n.rQshift8(),C=0;C<A;C++){var D=void 0;l&16?D=n.rQshiftBytes(4):D=this._foreground;var L=n.rQshift8(),B=L>>4,R=L&15,F=n.rQshift8(),K=(F>>4)+1,Q=(F&15)+1;this._subTile(B,R,K,Q,D)}this._finishTile(h)}this._lastsubencoding=l,this._tiles--}return!0}},{key:"_startTile",value:function(r,s,c,t,n){this._tileX=r,this._tileY=s,this._tileW=c,this._tileH=t;for(var h=n[0],g=n[1],a=n[2],l=this._tileBuffer,_=0;_<c*t*4;_+=4)l[_]=h,l[_+1]=g,l[_+2]=a,l[_+3]=255}},{key:"_subTile",value:function(r,s,c,t,n){for(var h=n[0],g=n[1],a=n[2],l=r+c,_=s+t,v=this._tileBuffer,u=this._tileW,o=s;o<_;o++)for(var d=r;d<l;d++){var f=(d+o*u)*4;v[f]=h,v[f+1]=g,v[f+2]=a,v[f+3]=255}}},{key:"_finishTile",value:function(r){r.blitImage(this._tileX,this._tileY,this._tileW,this._tileH,this._tileBuffer,0)}}])}()});var so=re(cs=>{"use strict";Object.defineProperty(cs,"__esModule",{value:!0});cs.default=void 0;var eg=rg(yt()),tg=ig(kr());function ig(e){return e&&e.__esModule?e:{default:e}}function mc(e){if(typeof WeakMap!="function")return null;var i=new WeakMap,r=new WeakMap;return(mc=function(c){return c?r:i})(e)}function rg(e,i){if(!i&&e&&e.__esModule)return e;if(e===null||Ai(e)!="object"&&typeof e!="function")return{default:e};var r=mc(i);if(r&&r.has(e))return r.get(e);var s={__proto__:null},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var t in e)if(t!=="default"&&{}.hasOwnProperty.call(e,t)){var n=c?Object.getOwnPropertyDescriptor(e,t):null;n&&(n.get||n.set)?Object.defineProperty(s,t,n):s[t]=e[t]}return s.default=e,r&&r.set(e,s),s}function Ai(e){"@babel/helpers - typeof";return Ai=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Ai(e)}function sg(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function vc(e,i){for(var r=0;r<i.length;r++){var s=i[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,og(s.key),s)}}function ng(e,i,r){return i&&vc(e.prototype,i),r&&vc(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function og(e){var i=ag(e,"string");return Ai(i)=="symbol"?i:i+""}function ag(e,i){if(Ai(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,i||"default");if(Ai(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}var nm=cs.default=function(){function e(){sg(this,e),this._ctl=null,this._filter=null,this._numColors=0,this._palette=new Uint8Array(1024),this._len=0,this._zlibs=[];for(var i=0;i<4;i++)this._zlibs[i]=new tg.default}return ng(e,[{key:"decodeRect",value:function(r,s,c,t,n,h,g){if(this._ctl===null){if(n.rQwait("TIGHT compression-control",1))return!1;this._ctl=n.rQshift8();for(var a=0;a<4;a++)this._ctl>>a&1&&(this._zlibs[a].reset(),eg.Info("Reset zlib stream "+a));this._ctl=this._ctl>>4}var l;if(this._ctl===8)l=this._fillRect(r,s,c,t,n,h,g);else if(this._ctl===9)l=this._jpegRect(r,s,c,t,n,h,g);else if(this._ctl===10)l=this._pngRect(r,s,c,t,n,h,g);else if(!(this._ctl&8))l=this._basicRect(this._ctl,r,s,c,t,n,h,g);else throw new Error("Illegal tight compression received (ctl: "+this._ctl+")");return l&&(this._ctl=null),l}},{key:"_fillRect",value:function(r,s,c,t,n,h,g){if(n.rQwait("TIGHT",3))return!1;var a=n.rQshiftBytes(3);return h.fillRect(r,s,c,t,a,!1),!0}},{key:"_jpegRect",value:function(r,s,c,t,n,h,g){var a=this._readData(n);return a===null?!1:(h.imageRect(r,s,c,t,"image/jpeg",a),!0)}},{key:"_pngRect",value:function(r,s,c,t,n,h,g){throw new Error("PNG received in standard Tight rect")}},{key:"_basicRect",value:function(r,s,c,t,n,h,g,a){if(this._filter===null)if(r&4){if(h.rQwait("TIGHT",1))return!1;this._filter=h.rQshift8()}else this._filter=0;var l=r&3,_;switch(this._filter){case 0:_=this._copyFilter(l,s,c,t,n,h,g,a);break;case 1:_=this._paletteFilter(l,s,c,t,n,h,g,a);break;case 2:_=this._gradientFilter(l,s,c,t,n,h,g,a);break;default:throw new Error("Illegal tight filter received (ctl: "+this._filter+")")}return _&&(this._filter=null),_}},{key:"_copyFilter",value:function(r,s,c,t,n,h,g,a){var l=t*n*3,_;if(l===0)return!0;if(l<12){if(h.rQwait("TIGHT",l))return!1;_=h.rQshiftBytes(l)}else{if(_=this._readData(h),_===null)return!1;this._zlibs[r].setInput(_),_=this._zlibs[r].inflate(l),this._zlibs[r].setInput(null)}for(var v=new Uint8Array(t*n*4),u=0,o=0;u<t*n*4;u+=4,o+=3)v[u]=_[o],v[u+1]=_[o+1],v[u+2]=_[o+2],v[u+3]=255;return g.blitImage(s,c,t,n,v,0,!1),!0}},{key:"_paletteFilter",value:function(r,s,c,t,n,h,g,a){if(this._numColors===0){if(h.rQwait("TIGHT palette",1))return!1;var l=h.rQpeek8()+1,_=l*3;if(h.rQwait("TIGHT palette",1+_))return!1;this._numColors=l,h.rQskipBytes(1),h.rQshiftTo(this._palette,_)}var v=this._numColors<=2?1:8,u=Math.floor((t*v+7)/8),o=u*n,d;if(o===0)return!0;if(o<12){if(h.rQwait("TIGHT",o))return!1;d=h.rQshiftBytes(o)}else{if(d=this._readData(h),d===null)return!1;this._zlibs[r].setInput(d),d=this._zlibs[r].inflate(o),this._zlibs[r].setInput(null)}return this._numColors==2?this._monoRect(s,c,t,n,d,this._palette,g):this._paletteRect(s,c,t,n,d,this._palette,g),this._numColors=0,!0}},{key:"_monoRect",value:function(r,s,c,t,n,h,g){for(var a=this._getScratchBuffer(c*t*4),l=Math.floor((c+7)/8),_=Math.floor(c/8),v=0;v<t;v++){var u=void 0,o=void 0,d=void 0;for(d=0;d<_;d++)for(var f=7;f>=0;f--)u=(v*c+d*8+7-f)*4,o=(n[v*l+d]>>f&1)*3,a[u]=h[o],a[u+1]=h[o+1],a[u+2]=h[o+2],a[u+3]=255;for(var p=7;p>=8-c%8;p--)u=(v*c+d*8+7-p)*4,o=(n[v*l+d]>>p&1)*3,a[u]=h[o],a[u+1]=h[o+1],a[u+2]=h[o+2],a[u+3]=255}g.blitImage(r,s,c,t,a,0,!1)}},{key:"_paletteRect",value:function(r,s,c,t,n,h,g){for(var a=this._getScratchBuffer(c*t*4),l=c*t*4,_=0,v=0;_<l;_+=4,v++){var u=n[v]*3;a[_]=h[u],a[_+1]=h[u+1],a[_+2]=h[u+2],a[_+3]=255}g.blitImage(r,s,c,t,a,0,!1)}},{key:"_gradientFilter",value:function(r,s,c,t,n,h,g,a){var l=t*n*3,_;if(l===0)return!0;if(l<12){if(h.rQwait("TIGHT",l))return!1;_=h.rQshiftBytes(l)}else{if(_=this._readData(h),_===null)return!1;this._zlibs[r].setInput(_),_=this._zlibs[r].inflate(l),this._zlibs[r].setInput(null)}for(var v=new Uint8Array(4*t*n),u=0,o=0,d=new Uint8Array(3),f=0;f<t;f++){for(var p=0;p<3;p++){var y=d[p],w=_[o++]+y;v[u++]=w,d[p]=w}v[u++]=255}for(var b=0,S=new Uint8Array(3),A=new Uint8Array(3),C=1;C<n;C++){d.fill(0),A.fill(0);for(var D=0;D<t;D++){for(var L=0;L<3;L++){S[L]=v[b++];var B=d[L]+S[L]-A[L];B<0?B=0:B>255&&(B=255);var R=_[o++]+B;v[u++]=R,A[L]=S[L],d[L]=R}v[u++]=255,b++}}return g.blitImage(s,c,t,n,v,0,!1),!0}},{key:"_readData",value:function(r){if(this._len===0){if(r.rQwait("TIGHT",3))return null;var s;s=r.rQshift8(),this._len=s&127,s&128&&(s=r.rQshift8(),this._len|=(s&127)<<7,s&128&&(s=r.rQshift8(),this._len|=s<<14))}if(r.rQwait("TIGHT",this._len))return null;var c=r.rQshiftBytes(this._len,!1);return this._len=0,c}},{key:"_getScratchBuffer",value:function(r){return(!this._scratchBuffer||this._scratchBuffer.length<r)&&(this._scratchBuffer=new Uint8Array(r)),this._scratchBuffer}}])}()});var Ac=re(ds=>{"use strict";function wi(e){"@babel/helpers - typeof";return wi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},wi(e)}Object.defineProperty(ds,"__esModule",{value:!0});ds.default=void 0;var hg=lg(so());function lg(e){return e&&e.__esModule?e:{default:e}}function cg(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function yc(e,i){for(var r=0;r<i.length;r++){var s=i[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,dg(s.key),s)}}function ug(e,i,r){return i&&yc(e.prototype,i),r&&yc(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function dg(e){var i=fg(e,"string");return wi(i)=="symbol"?i:i+""}function fg(e,i){if(wi(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,i||"default");if(wi(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function _g(e,i,r){return i=us(i),gg(e,bc()?Reflect.construct(i,r||[],us(e).constructor):i.apply(e,r))}function gg(e,i){if(i&&(wi(i)=="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return pg(e)}function pg(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function bc(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(bc=function(){return!!e})()}function us(e){return us=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},us(e)}function vg(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&no(e,i)}function no(e,i){return no=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},no(e,i)}var am=ds.default=function(e){function i(){return cg(this,i),_g(this,i,arguments)}return vg(i,e),ug(i,[{key:"_pngRect",value:function(s,c,t,n,h,g,a){var l=this._readData(h);return l===null?!1:(g.imageRect(s,c,t,n,"image/png",l),!0)}},{key:"_basicRect",value:function(s,c,t,n,h,g,a,l){throw new Error("BasicCompression received in TightPNG rect")}}])}(hg.default)});var Cc=re(gs=>{"use strict";Object.defineProperty(gs,"__esModule",{value:!0});gs.default=void 0;var mg=yg(kr());function yg(e){return e&&e.__esModule?e:{default:e}}function sr(e){"@babel/helpers - typeof";return sr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},sr(e)}function bg(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function wc(e,i){for(var r=0;r<i.length;r++){var s=i[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,wg(s.key),s)}}function Ag(e,i,r){return i&&wc(e.prototype,i),r&&wc(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function wg(e){var i=Cg(e,"string");return sr(i)=="symbol"?i:i+""}function Cg(e,i){if(sr(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,i||"default");if(sr(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}var fs=64,_s=64,lm=gs.default=function(){function e(){bg(this,e),this._length=0,this._inflator=new mg.default,this._pixelBuffer=new Uint8Array(fs*_s*4),this._tileBuffer=new Uint8Array(fs*_s*4)}return Ag(e,[{key:"decodeRect",value:function(r,s,c,t,n,h,g){if(this._length===0){if(n.rQwait("ZLib data length",4))return!1;this._length=n.rQshift32()}if(n.rQwait("Zlib data",this._length))return!1;var a=n.rQshiftBytes(this._length,!1);this._inflator.setInput(a);for(var l=s;l<s+t;l+=_s)for(var _=Math.min(_s,s+t-l),v=r;v<r+c;v+=fs){var u=Math.min(fs,r+c-v),o=u*_,d=this._inflator.inflate(1)[0];if(d===0){var f=this._readPixels(o);h.blitImage(v,l,u,_,f,0,!1)}else if(d===1){var p=this._readPixels(1);h.fillRect(v,l,u,_,[p[0],p[1],p[2]])}else if(d>=2&&d<=16){var y=this._decodePaletteTile(d,o,u,_);h.blitImage(v,l,u,_,y,0,!1)}else if(d===128){var w=this._decodeRLETile(o);h.blitImage(v,l,u,_,w,0,!1)}else if(d>=130&&d<=255){var b=this._decodeRLEPaletteTile(d-128,o);h.blitImage(v,l,u,_,b,0,!1)}else throw new Error("Unknown subencoding: "+d)}return this._length=0,!0}},{key:"_getBitsPerPixelInPalette",value:function(r){if(r<=2)return 1;if(r<=4)return 2;if(r<=16)return 4}},{key:"_readPixels",value:function(r){for(var s=this._pixelBuffer,c=this._inflator.inflate(3*r),t=0,n=0;t<r*4;t+=4,n+=3)s[t]=c[n],s[t+1]=c[n+1],s[t+2]=c[n+2],s[t+3]=255;return s}},{key:"_decodePaletteTile",value:function(r,s,c,t){for(var n=this._tileBuffer,h=this._readPixels(r),g=this._getBitsPerPixelInPalette(r),a=(1<<g)-1,l=0,_=this._inflator.inflate(1)[0],v=0;v<t;v++){for(var u=8-g,o=0;o<c;o++){u<0&&(u=8-g,_=this._inflator.inflate(1)[0]);var d=_>>u&a;n[l]=h[d*4],n[l+1]=h[d*4+1],n[l+2]=h[d*4+2],n[l+3]=h[d*4+3],l+=4,u-=g}u<8-g&&v<t-1&&(_=this._inflator.inflate(1)[0])}return n}},{key:"_decodeRLETile",value:function(r){for(var s=this._tileBuffer,c=0;c<r;)for(var t=this._readPixels(1),n=this._readRLELength(),h=0;h<n;h++)s[c*4]=t[0],s[c*4+1]=t[1],s[c*4+2]=t[2],s[c*4+3]=t[3],c++;return s}},{key:"_decodeRLEPaletteTile",value:function(r,s){for(var c=this._tileBuffer,t=this._readPixels(r),n=0;n<s;){var h=this._inflator.inflate(1)[0],g=1;if(h>=128&&(h-=128,g=this._readRLELength()),h>r)throw new Error("Too big index in palette: "+h+", palette size: "+r);if(n+g>s)throw new Error("Too big rle length in palette mode: "+g+", allowed length is: "+(s-n));for(var a=0;a<g;a++)c[n*4]=t[h*4],c[n*4+1]=t[h*4+1],c[n*4+2]=t[h*4+2],c[n*4+3]=t[h*4+3],n++}return c}},{key:"_readRLELength",value:function(){var r=0,s=0;do s=this._inflator.inflate(1)[0],r+=s;while(s===255);return r+1}}])}()});var kc=re(ps=>{"use strict";Object.defineProperty(ps,"__esModule",{value:!0});ps.default=void 0;function nr(e){"@babel/helpers - typeof";return nr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},nr(e)}function xc(e){return Eg(e)||Sg(e)||Ec(e)||xg()}function xg(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Sg(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Eg(e){if(Array.isArray(e))return ao(e)}function oo(e,i){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Ec(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var s=0,c=function(){};return{s:c,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(a){throw a},f:c}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var t,n=!0,h=!1;return{s:function(){r=r.call(e)},n:function(){var a=r.next();return n=a.done,a},e:function(a){h=!0,t=a},f:function(){try{n||r.return==null||r.return()}finally{if(h)throw t}}}}function Ec(e,i){if(e){if(typeof e=="string")return ao(e,i);var r={}.toString.call(e).slice(8,-1);return r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set"?Array.from(e):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ao(e,i):void 0}}function ao(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,s=Array(i);r<i;r++)s[r]=e[r];return s}function kg(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function Sc(e,i){for(var r=0;r<i.length;r++){var s=i[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,Lg(s.key),s)}}function Bg(e,i,r){return i&&Sc(e.prototype,i),r&&Sc(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Lg(e){var i=Ig(e,"string");return nr(i)=="symbol"?i:i+""}function Ig(e,i){if(nr(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,i||"default");if(nr(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}var um=ps.default=function(){function e(){kg(this,e),this._cachedQuantTables=[],this._cachedHuffmanTables=[],this._segments=[]}return Bg(e,[{key:"decodeRect",value:function(r,s,c,t,n,h,g){for(;;){var a=this._readSegment(n);if(a===null)return!1;if(this._segments.push(a),a[1]===217)break}var l=[],_=[],v=oo(this._segments),u;try{for(v.s();!(u=v.n()).done;){var o=u.value,d=o[1];d===196?l.push(o):d===219&&_.push(o)}}catch(R){v.e(R)}finally{v.f()}var f=this._segments.findIndex(function(R){return R[1]==192||R[1]==194});if(f==-1)throw new Error("Illegal JPEG image without SOF");if(_.length===0){var p;(p=this._segments).splice.apply(p,[f+1,0].concat(xc(this._cachedQuantTables)))}if(l.length===0){var y;(y=this._segments).splice.apply(y,[f+1,0].concat(xc(this._cachedHuffmanTables)))}var w=0,b=oo(this._segments),S;try{for(b.s();!(S=b.n()).done;){var A=S.value;w+=A.length}}catch(R){b.e(R)}finally{b.f()}var C=new Uint8Array(w);w=0;var D=oo(this._segments),L;try{for(D.s();!(L=D.n()).done;){var B=L.value;C.set(B,w),w+=B.length}}catch(R){D.e(R)}finally{D.f()}return h.imageRect(r,s,c,t,"image/jpeg",C),l.length!==0&&(this._cachedHuffmanTables=l),_.length!==0&&(this._cachedQuantTables=_),this._segments=[],!0}},{key:"_readSegment",value:function(r){if(r.rQwait("JPEG",2))return null;var s=r.rQshift8();if(s!=255)throw new Error("Illegal JPEG marker received (byte: "+s+")");var c=r.rQshift8();if(c>=208&&c<=217||c==1)return new Uint8Array([s,c]);if(r.rQwait("JPEG",2,2))return null;var t=r.rQshift16();if(t<2)throw new Error("Illegal JPEG length received (length: "+t+")");if(r.rQwait("JPEG",t-2,4))return null;var n=0;if(c===218)for(n+=2;;){if(r.rQwait("JPEG",t-2+n,4))return null;var h=r.rQpeekBytes(t-2+n,!1);if(h.at(-2)===255&&h.at(-1)!==0&&!(h.at(-1)>=208&&h.at(-1)<=215)){n-=2;break}n++}var g=new Uint8Array(2+t+n);return g[0]=s,g[1]=c,g[2]=t>>8,g[3]=t,g.set(r.rQshiftBytes(t-2+n,!1),4),g}}])}()});var qc=re(As=>{"use strict";function xt(e){"@babel/helpers - typeof";return xt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},xt(e)}Object.defineProperty(As,"__esModule",{value:!0});As.default=void 0;var Wc=js(),ie=Vg(yt()),ft=zs(),Bc=xi(),or=ca(),Dg=tn(),Rg=Ie(rn()),Mg=Ie(ya()),Tg=Ie(kr()),Fg=Ie(qh()),Pg=Ie(ll()),Og=Ie(fl()),Kg=Ie(pl()),Qg=Ie(Al()),et=Ie(_i()),Xg=Ie(wl()),ue=Cl(),Hg=Ie(ac()),je=Ie(io()),Ng=Ie(lc()),Ug=Ie(uc()),$g=Ie(fc()),Wg=Ie(pc()),jg=Ie(so()),Gg=Ie(Ac()),zg=Ie(Cc()),qg=Ie(kc());function Ie(e){return e&&e.__esModule?e:{default:e}}function jc(e){if(typeof WeakMap!="function")return null;var i=new WeakMap,r=new WeakMap;return(jc=function(c){return c?r:i})(e)}function Vg(e,i){if(!i&&e&&e.__esModule)return e;if(e===null||xt(e)!="object"&&typeof e!="function")return{default:e};var r=jc(i);if(r&&r.has(e))return r.get(e);var s={__proto__:null},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var t in e)if(t!=="default"&&{}.hasOwnProperty.call(e,t)){var n=c?Object.getOwnPropertyDescriptor(e,t):null;n&&(n.get||n.set)?Object.defineProperty(s,t,n):s[t]=e[t]}return s.default=e,r&&r.set(e,s),s}function co(){"use strict";co=function(){return i};var e,i={},r=Object.prototype,s=r.hasOwnProperty,c=Object.defineProperty||function(k,m,x){k[m]=x.value},t=typeof Symbol=="function"?Symbol:{},n=t.iterator||"@@iterator",h=t.asyncIterator||"@@asyncIterator",g=t.toStringTag||"@@toStringTag";function a(k,m,x){return Object.defineProperty(k,m,{value:x,enumerable:!0,configurable:!0,writable:!0}),k[m]}try{a({},"")}catch{a=function(x,E,I){return x[E]=I}}function l(k,m,x,E){var I=m&&m.prototype instanceof p?m:p,M=Object.create(I.prototype),X=new Q(E||[]);return c(M,"_invoke",{value:B(k,x,X)}),M}function _(k,m,x){try{return{type:"normal",arg:k.call(m,x)}}catch(E){return{type:"throw",arg:E}}}i.wrap=l;var v="suspendedStart",u="suspendedYield",o="executing",d="completed",f={};function p(){}function y(){}function w(){}var b={};a(b,n,function(){return this});var S=Object.getPrototypeOf,A=S&&S(S(N([])));A&&A!==r&&s.call(A,n)&&(b=A);var C=w.prototype=p.prototype=Object.create(b);function D(k){["next","throw","return"].forEach(function(m){a(k,m,function(x){return this._invoke(m,x)})})}function L(k,m){function x(I,M,X,$){var W=_(k[I],k,M);if(W.type!=="throw"){var P=W.arg,T=P.value;return T&&xt(T)=="object"&&s.call(T,"__await")?m.resolve(T.__await).then(function(U){x("next",U,X,$)},function(U){x("throw",U,X,$)}):m.resolve(T).then(function(U){P.value=U,X(P)},function(U){return x("throw",U,X,$)})}$(W.arg)}var E;c(this,"_invoke",{value:function(M,X){function $(){return new m(function(W,P){x(M,X,W,P)})}return E=E?E.then($,$):$()}})}function B(k,m,x){var E=v;return function(I,M){if(E===o)throw Error("Generator is already running");if(E===d){if(I==="throw")throw M;return{value:e,done:!0}}for(x.method=I,x.arg=M;;){var X=x.delegate;if(X){var $=R(X,x);if($){if($===f)continue;return $}}if(x.method==="next")x.sent=x._sent=x.arg;else if(x.method==="throw"){if(E===v)throw E=d,x.arg;x.dispatchException(x.arg)}else x.method==="return"&&x.abrupt("return",x.arg);E=o;var W=_(k,m,x);if(W.type==="normal"){if(E=x.done?d:u,W.arg===f)continue;return{value:W.arg,done:x.done}}W.type==="throw"&&(E=d,x.method="throw",x.arg=W.arg)}}}function R(k,m){var x=m.method,E=k.iterator[x];if(E===e)return m.delegate=null,x==="throw"&&k.iterator.return&&(m.method="return",m.arg=e,R(k,m),m.method==="throw")||x!=="return"&&(m.method="throw",m.arg=new TypeError("The iterator does not provide a '"+x+"' method")),f;var I=_(E,k.iterator,m.arg);if(I.type==="throw")return m.method="throw",m.arg=I.arg,m.delegate=null,f;var M=I.arg;return M?M.done?(m[k.resultName]=M.value,m.next=k.nextLoc,m.method!=="return"&&(m.method="next",m.arg=e),m.delegate=null,f):M:(m.method="throw",m.arg=new TypeError("iterator result is not an object"),m.delegate=null,f)}function F(k){var m={tryLoc:k[0]};1 in k&&(m.catchLoc=k[1]),2 in k&&(m.finallyLoc=k[2],m.afterLoc=k[3]),this.tryEntries.push(m)}function K(k){var m=k.completion||{};m.type="normal",delete m.arg,k.completion=m}function Q(k){this.tryEntries=[{tryLoc:"root"}],k.forEach(F,this),this.reset(!0)}function N(k){if(k||k===""){var m=k[n];if(m)return m.call(k);if(typeof k.next=="function")return k;if(!isNaN(k.length)){var x=-1,E=function I(){for(;++x<k.length;)if(s.call(k,x))return I.value=k[x],I.done=!1,I;return I.value=e,I.done=!0,I};return E.next=E}}throw new TypeError(xt(k)+" is not iterable")}return y.prototype=w,c(C,"constructor",{value:w,configurable:!0}),c(w,"constructor",{value:y,configurable:!0}),y.displayName=a(w,g,"GeneratorFunction"),i.isGeneratorFunction=function(k){var m=typeof k=="function"&&k.constructor;return!!m&&(m===y||(m.displayName||m.name)==="GeneratorFunction")},i.mark=function(k){return Object.setPrototypeOf?Object.setPrototypeOf(k,w):(k.__proto__=w,a(k,g,"GeneratorFunction")),k.prototype=Object.create(C),k},i.awrap=function(k){return{__await:k}},D(L.prototype),a(L.prototype,h,function(){return this}),i.AsyncIterator=L,i.async=function(k,m,x,E,I){I===void 0&&(I=Promise);var M=new L(l(k,m,x,E),I);return i.isGeneratorFunction(m)?M:M.next().then(function(X){return X.done?X.value:M.next()})},D(C),a(C,g,"Generator"),a(C,n,function(){return this}),a(C,"toString",function(){return"[object Generator]"}),i.keys=function(k){var m=Object(k),x=[];for(var E in m)x.push(E);return x.reverse(),function I(){for(;x.length;){var M=x.pop();if(M in m)return I.value=M,I.done=!1,I}return I.done=!0,I}},i.values=N,Q.prototype={constructor:Q,reset:function(m){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(K),!m)for(var x in this)x.charAt(0)==="t"&&s.call(this,x)&&!isNaN(+x.slice(1))&&(this[x]=e)},stop:function(){this.done=!0;var m=this.tryEntries[0].completion;if(m.type==="throw")throw m.arg;return this.rval},dispatchException:function(m){if(this.done)throw m;var x=this;function E(P,T){return X.type="throw",X.arg=m,x.next=P,T&&(x.method="next",x.arg=e),!!T}for(var I=this.tryEntries.length-1;I>=0;--I){var M=this.tryEntries[I],X=M.completion;if(M.tryLoc==="root")return E("end");if(M.tryLoc<=this.prev){var $=s.call(M,"catchLoc"),W=s.call(M,"finallyLoc");if($&&W){if(this.prev<M.catchLoc)return E(M.catchLoc,!0);if(this.prev<M.finallyLoc)return E(M.finallyLoc)}else if($){if(this.prev<M.catchLoc)return E(M.catchLoc,!0)}else{if(!W)throw Error("try statement without catch or finally");if(this.prev<M.finallyLoc)return E(M.finallyLoc)}}}},abrupt:function(m,x){for(var E=this.tryEntries.length-1;E>=0;--E){var I=this.tryEntries[E];if(I.tryLoc<=this.prev&&s.call(I,"finallyLoc")&&this.prev<I.finallyLoc){var M=I;break}}M&&(m==="break"||m==="continue")&&M.tryLoc<=x&&x<=M.finallyLoc&&(M=null);var X=M?M.completion:{};return X.type=m,X.arg=x,M?(this.method="next",this.next=M.finallyLoc,f):this.complete(X)},complete:function(m,x){if(m.type==="throw")throw m.arg;return m.type==="break"||m.type==="continue"?this.next=m.arg:m.type==="return"?(this.rval=this.arg=m.arg,this.method="return",this.next="end"):m.type==="normal"&&x&&(this.next=x),f},finish:function(m){for(var x=this.tryEntries.length-1;x>=0;--x){var E=this.tryEntries[x];if(E.finallyLoc===m)return this.complete(E.completion,E.afterLoc),K(E),f}},catch:function(m){for(var x=this.tryEntries.length-1;x>=0;--x){var E=this.tryEntries[x];if(E.tryLoc===m){var I=E.completion;if(I.type==="throw"){var M=I.arg;K(E)}return M}}throw Error("illegal catch attempt")},delegateYield:function(m,x,E){return this.delegate={iterator:N(m),resultName:x,nextLoc:E},this.method==="next"&&(this.arg=e),f}},i}function Lc(e,i,r,s,c,t,n){try{var h=e[t](n),g=h.value}catch(a){return void r(a)}h.done?i(g):Promise.resolve(g).then(s,c)}function Jg(e){return function(){var i=this,r=arguments;return new Promise(function(s,c){var t=e.apply(i,r);function n(g){Lc(t,s,c,n,h,"next",g)}function h(g){Lc(t,s,c,n,h,"throw",g)}n(void 0)})}}function Yg(e,i){return tp(e)||ep(e,i)||Gc(e,i)||Zg()}function Zg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ep(e,i){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var s,c,t,n,h=[],g=!0,a=!1;try{if(t=(r=r.call(e)).next,i===0){if(Object(r)!==r)return;g=!1}else for(;!(g=(s=t.call(r)).done)&&(h.push(s.value),h.length!==i);g=!0);}catch(l){a=!0,c=l}finally{try{if(!g&&r.return!=null&&(n=r.return(),Object(n)!==n))return}finally{if(a)throw c}}return h}}function tp(e){if(Array.isArray(e))return e}function ho(e,i){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Gc(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var s=0,c=function(){};return{s:c,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(a){throw a},f:c}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var t,n=!0,h=!1;return{s:function(){r=r.call(e)},n:function(){var a=r.next();return n=a.done,a},e:function(a){h=!0,t=a},f:function(){try{n||r.return==null||r.return()}finally{if(h)throw t}}}}function Gc(e,i){if(e){if(typeof e=="string")return Ic(e,i);var r={}.toString.call(e).slice(8,-1);return r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set"?Array.from(e):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ic(e,i):void 0}}function Ic(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,s=Array(i);r<i;r++)s[r]=e[r];return s}function ip(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function Dc(e,i){for(var r=0;r<i.length;r++){var s=i[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,sp(s.key),s)}}function rp(e,i,r){return i&&Dc(e.prototype,i),r&&Dc(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function sp(e){var i=np(e,"string");return xt(i)=="symbol"?i:i+""}function np(e,i){if(xt(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,i||"default");if(xt(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function op(e,i,r){return i=bs(i),ap(e,zc()?Reflect.construct(i,r||[],bs(e).constructor):i.apply(e,r))}function ap(e,i){if(i&&(xt(i)=="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return hp(e)}function hp(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function zc(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(zc=function(){return!!e})()}function bs(e){return bs=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},bs(e)}function lp(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&uo(e,i)}function uo(e,i){return uo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},uo(e,i)}var cp=3,up="rgb(40, 40, 40)",Rc=17,Mc=50,Tc=19,ar=75,Xt=50,dp=1e3,fp=50,Fc=1,vs=2,Pc=6,Oc=16,lo=19,Kc=22,Qc=30,Xc=113,Hc=129,Nc=256,_t=1,Uc=1<<24,ms=1<<25,$c=1<<26,hr=1<<27,ys=1<<28,gt=As.default=function(e){function i(r,s,c){var t;if(ip(this,i),!r)throw new Error("Must specify target");if(!s)throw new Error("Must specify URL, WebSocket or RTCDataChannel");window.isSecureContext||ie.Error("noVNC requires a secure context (TLS). Expect crashes!"),t=op(this,i),t._target=r,typeof s=="string"?t._url=s:(t._url=null,t._rawChannel=s),c=c||{},t._rfbCredentials=c.credentials||{},t._shared="shared"in c?!!c.shared:!0,t._repeaterID=c.repeaterID||"",t._wsProtocols=c.wsProtocols||[],t._rfbConnectionState="",t._rfbInitState="",t._rfbAuthScheme=-1,t._rfbCleanDisconnect=!0,t._rfbRSAAESAuthenticationState=null,t._rfbVersion=0,t._rfbMaxVersion=3.8,t._rfbTightVNC=!1,t._rfbVeNCryptState=0,t._rfbXvpVer=0,t._fbWidth=0,t._fbHeight=0,t._fbName="",t._capabilities={power:!1},t._supportsFence=!1,t._supportsContinuousUpdates=!1,t._enabledContinuousUpdates=!1,t._supportsSetDesktopSize=!1,t._screenID=0,t._screenFlags=0,t._qemuExtKeyEventSupported=!1,t._clipboardText=null,t._clipboardServerCapabilitiesActions={},t._clipboardServerCapabilitiesFormats={},t._sock=null,t._display=null,t._flushing=!1,t._keyboard=null,t._gestures=null,t._resizeObserver=null,t._disconnTimer=null,t._resizeTimeout=null,t._mouseMoveTimer=null,t._decoders={},t._FBU={rects:0,x:0,y:0,width:0,height:0,encoding:null},t._mousePos={},t._mouseButtonMask=0,t._mouseLastMoveTime=0,t._viewportDragging=!1,t._viewportDragPos={},t._viewportHasMoved=!1,t._accumulatedWheelDeltaX=0,t._accumulatedWheelDeltaY=0,t._gestureLastTapTime=null,t._gestureFirstDoubleTapEv=null,t._gestureLastMagnitudeX=0,t._gestureLastMagnitudeY=0,t._eventHandlers={focusCanvas:t._focusCanvas.bind(t),handleResize:t._handleResize.bind(t),handleMouse:t._handleMouse.bind(t),handleWheel:t._handleWheel.bind(t),handleGesture:t._handleGesture.bind(t),handleRSAAESCredentialsRequired:t._handleRSAAESCredentialsRequired.bind(t),handleRSAAESServerVerification:t._handleRSAAESServerVerification.bind(t)},ie.Debug(">> RFB.constructor"),t._screen=document.createElement("div"),t._screen.style.display="flex",t._screen.style.width="100%",t._screen.style.height="100%",t._screen.style.overflow="auto",t._screen.style.background=up,t._canvas=document.createElement("canvas"),t._canvas.style.margin="auto",t._canvas.style.outline="none",t._canvas.width=0,t._canvas.height=0,t._canvas.tabIndex=-1,t._screen.appendChild(t._canvas),t._cursor=new Kg.default,t._cursorImage=i.cursors.none,t._decoders[ue.encodings.encodingRaw]=new Ng.default,t._decoders[ue.encodings.encodingCopyRect]=new Ug.default,t._decoders[ue.encodings.encodingRRE]=new $g.default,t._decoders[ue.encodings.encodingHextile]=new Wg.default,t._decoders[ue.encodings.encodingTight]=new jg.default,t._decoders[ue.encodings.encodingTightPNG]=new Gg.default,t._decoders[ue.encodings.encodingZRLE]=new zg.default,t._decoders[ue.encodings.encodingJPEG]=new qg.default;try{t._display=new Mg.default(t._canvas)}catch(n){throw ie.Error("Display exception: "+n),n}return t._keyboard=new Pg.default(t._canvas),t._keyboard.onkeyevent=t._handleKeyEvent.bind(t),t._remoteCapsLock=null,t._remoteNumLock=null,t._gestures=new Og.default,t._sock=new Qg.default,t._sock.on("open",t._socketOpen.bind(t)),t._sock.on("close",t._socketClose.bind(t)),t._sock.on("message",t._handleMessage.bind(t)),t._sock.on("error",t._socketError.bind(t)),t._expectedClientWidth=null,t._expectedClientHeight=null,t._resizeObserver=new ResizeObserver(t._eventHandlers.handleResize),t._updateConnectionState("connecting"),ie.Debug("<< RFB.constructor"),t.dragViewport=!1,t.focusOnClick=!0,t._viewOnly=!1,t._clipViewport=!1,t._clippingViewport=!1,t._scaleViewport=!1,t._resizeSession=!1,t._showDotCursor=!1,c.showDotCursor!==void 0&&(ie.Warn("Specifying showDotCursor as a RFB constructor argument is deprecated"),t._showDotCursor=c.showDotCursor),t._qualityLevel=6,t._compressionLevel=2,t}return lp(i,e),rp(i,[{key:"viewOnly",get:function(){return this._viewOnly},set:function(s){this._viewOnly=s,(this._rfbConnectionState==="connecting"||this._rfbConnectionState==="connected")&&(s?this._keyboard.ungrab():this._keyboard.grab())}},{key:"capabilities",get:function(){return this._capabilities}},{key:"clippingViewport",get:function(){return this._clippingViewport}},{key:"_setClippingViewport",value:function(s){s!==this._clippingViewport&&(this._clippingViewport=s,this.dispatchEvent(new CustomEvent("clippingviewport",{detail:this._clippingViewport})))}},{key:"touchButton",get:function(){return 0},set:function(s){ie.Warn("Using old API!")}},{key:"clipViewport",get:function(){return this._clipViewport},set:function(s){this._clipViewport=s,this._updateClip()}},{key:"scaleViewport",get:function(){return this._scaleViewport},set:function(s){this._scaleViewport=s,s&&this._clipViewport&&this._updateClip(),this._updateScale(),!s&&this._clipViewport&&this._updateClip()}},{key:"resizeSession",get:function(){return this._resizeSession},set:function(s){this._resizeSession=s,s&&this._requestRemoteResize()}},{key:"showDotCursor",get:function(){return this._showDotCursor},set:function(s){this._showDotCursor=s,this._refreshCursor()}},{key:"background",get:function(){return this._screen.style.background},set:function(s){this._screen.style.background=s}},{key:"qualityLevel",get:function(){return this._qualityLevel},set:function(s){if(!Number.isInteger(s)||s<0||s>9){ie.Error("qualityLevel must be an integer between 0 and 9");return}this._qualityLevel!==s&&(this._qualityLevel=s,this._rfbConnectionState==="connected"&&this._sendEncodings())}},{key:"compressionLevel",get:function(){return this._compressionLevel},set:function(s){if(!Number.isInteger(s)||s<0||s>9){ie.Error("compressionLevel must be an integer between 0 and 9");return}this._compressionLevel!==s&&(this._compressionLevel=s,this._rfbConnectionState==="connected"&&this._sendEncodings())}},{key:"disconnect",value:function(){this._updateConnectionState("disconnecting"),this._sock.off("error"),this._sock.off("message"),this._sock.off("open"),this._rfbRSAAESAuthenticationState!==null&&this._rfbRSAAESAuthenticationState.disconnect()}},{key:"approveServer",value:function(){this._rfbRSAAESAuthenticationState!==null&&this._rfbRSAAESAuthenticationState.approveServer()}},{key:"sendCredentials",value:function(s){this._rfbCredentials=s,this._resumeAuthentication()}},{key:"sendCtrlAltDel",value:function(){this._rfbConnectionState!=="connected"||this._viewOnly||(ie.Info("Sending Ctrl-Alt-Del"),this.sendKey(et.default.XK_Control_L,"ControlLeft",!0),this.sendKey(et.default.XK_Alt_L,"AltLeft",!0),this.sendKey(et.default.XK_Delete,"Delete",!0),this.sendKey(et.default.XK_Delete,"Delete",!1),this.sendKey(et.default.XK_Alt_L,"AltLeft",!1),this.sendKey(et.default.XK_Control_L,"ControlLeft",!1))}},{key:"machineShutdown",value:function(){this._xvpOp(1,2)}},{key:"machineReboot",value:function(){this._xvpOp(1,3)}},{key:"machineReset",value:function(){this._xvpOp(1,4)}},{key:"sendKey",value:function(s,c,t){if(!(this._rfbConnectionState!=="connected"||this._viewOnly)){if(t===void 0){this.sendKey(s,c,!0),this.sendKey(s,c,!1);return}var n=Xg.default[c];if(this._qemuExtKeyEventSupported&&n)s=s||0,ie.Info("Sending key ("+(t?"down":"up")+"): keysym "+s+", scancode "+n),i.messages.QEMUExtendedKeyEvent(this._sock,s,t,n);else{if(!s)return;ie.Info("Sending keysym ("+(t?"down":"up")+"): "+s),i.messages.keyEvent(this._sock,s,t?1:0)}}}},{key:"focus",value:function(s){this._canvas.focus(s)}},{key:"blur",value:function(){this._canvas.blur()}},{key:"clipboardPasteFrom",value:function(s){if(!(this._rfbConnectionState!=="connected"||this._viewOnly))if(this._clipboardServerCapabilitiesFormats[_t]&&this._clipboardServerCapabilitiesActions[hr])this._clipboardText=s,i.messages.extendedClipboardNotify(this._sock,[_t]);else{var c,t,n;c=0;var h=ho(s),g;try{for(h.s();!(g=h.n()).done;){var a=g.value;c++}}catch(o){h.e(o)}finally{h.f()}n=new Uint8Array(c),t=0;var l=ho(s),_;try{for(l.s();!(_=l.n()).done;){var v=_.value,u=v.codePointAt(0);u>255&&(u=63),n[t++]=u}}catch(o){l.e(o)}finally{l.f()}i.messages.clientCutText(this._sock,n)}}},{key:"getImageData",value:function(){return this._display.getImageData()}},{key:"toDataURL",value:function(s,c){return this._display.toDataURL(s,c)}},{key:"toBlob",value:function(s,c,t){return this._display.toBlob(s,c,t)}},{key:"_connect",value:function(){if(ie.Debug(">> RFB.connect"),this._url)ie.Info("connecting to ".concat(this._url)),this._sock.open(this._url,this._wsProtocols);else{if(ie.Info("attaching ".concat(this._rawChannel," to Websock")),this._sock.attach(this._rawChannel),this._sock.readyState==="closed")throw Error("Cannot use already closed WebSocket/RTCDataChannel");this._sock.readyState==="open"&&this._socketOpen()}this._target.appendChild(this._screen),this._gestures.attach(this._canvas),this._cursor.attach(this._canvas),this._refreshCursor(),this._resizeObserver.observe(this._screen),this._canvas.addEventListener("mousedown",this._eventHandlers.focusCanvas),this._canvas.addEventListener("touchstart",this._eventHandlers.focusCanvas),this._canvas.addEventListener("mousedown",this._eventHandlers.handleMouse),this._canvas.addEventListener("mouseup",this._eventHandlers.handleMouse),this._canvas.addEventListener("mousemove",this._eventHandlers.handleMouse),this._canvas.addEventListener("click",this._eventHandlers.handleMouse),this._canvas.addEventListener("contextmenu",this._eventHandlers.handleMouse),this._canvas.addEventListener("wheel",this._eventHandlers.handleWheel),this._canvas.addEventListener("gesturestart",this._eventHandlers.handleGesture),this._canvas.addEventListener("gesturemove",this._eventHandlers.handleGesture),this._canvas.addEventListener("gestureend",this._eventHandlers.handleGesture),ie.Debug("<< RFB.connect")}},{key:"_disconnect",value:function(){ie.Debug(">> RFB.disconnect"),this._cursor.detach(),this._canvas.removeEventListener("gesturestart",this._eventHandlers.handleGesture),this._canvas.removeEventListener("gesturemove",this._eventHandlers.handleGesture),this._canvas.removeEventListener("gestureend",this._eventHandlers.handleGesture),this._canvas.removeEventListener("wheel",this._eventHandlers.handleWheel),this._canvas.removeEventListener("mousedown",this._eventHandlers.handleMouse),this._canvas.removeEventListener("mouseup",this._eventHandlers.handleMouse),this._canvas.removeEventListener("mousemove",this._eventHandlers.handleMouse),this._canvas.removeEventListener("click",this._eventHandlers.handleMouse),this._canvas.removeEventListener("contextmenu",this._eventHandlers.handleMouse),this._canvas.removeEventListener("mousedown",this._eventHandlers.focusCanvas),this._canvas.removeEventListener("touchstart",this._eventHandlers.focusCanvas),this._resizeObserver.disconnect(),this._keyboard.ungrab(),this._gestures.detach(),this._sock.close();try{this._target.removeChild(this._screen)}catch(s){if(s.name!=="NotFoundError")throw s}clearTimeout(this._resizeTimeout),clearTimeout(this._mouseMoveTimer),ie.Debug("<< RFB.disconnect")}},{key:"_socketOpen",value:function(){this._rfbConnectionState==="connecting"&&this._rfbInitState===""?(this._rfbInitState="ProtocolVersion",ie.Debug("Starting VNC handshake")):this._fail("Unexpected server connection while "+this._rfbConnectionState)}},{key:"_socketClose",value:function(s){ie.Debug("WebSocket on-close event");var c="";switch(s.code&&(c="(code: "+s.code,s.reason&&(c+=", reason: "+s.reason),c+=")"),this._rfbConnectionState){case"connecting":this._fail("Connection closed "+c);break;case"connected":this._updateConnectionState("disconnecting"),this._updateConnectionState("disconnected");break;case"disconnecting":this._updateConnectionState("disconnected");break;case"disconnected":this._fail("Unexpected server disconnect when already disconnected "+c);break;default:this._fail("Unexpected server disconnect before connecting "+c);break}this._sock.off("close"),this._rawChannel=null}},{key:"_socketError",value:function(s){ie.Warn("WebSocket on-error event")}},{key:"_focusCanvas",value:function(s){this.focusOnClick&&this.focus({preventScroll:!0})}},{key:"_setDesktopName",value:function(s){this._fbName=s,this.dispatchEvent(new CustomEvent("desktopname",{detail:{name:this._fbName}}))}},{key:"_saveExpectedClientSize",value:function(){this._expectedClientWidth=this._screen.clientWidth,this._expectedClientHeight=this._screen.clientHeight}},{key:"_currentClientSize",value:function(){return[this._screen.clientWidth,this._screen.clientHeight]}},{key:"_clientHasExpectedSize",value:function(){var s=this._currentClientSize(),c=Yg(s,2),t=c[0],n=c[1];return t==this._expectedClientWidth&&n==this._expectedClientHeight}},{key:"_handleResize",value:function(){var s=this;this._clientHasExpectedSize()||(window.requestAnimationFrame(function(){s._updateClip(),s._updateScale()}),this._resizeSession&&(clearTimeout(this._resizeTimeout),this._resizeTimeout=setTimeout(this._requestRemoteResize.bind(this),500)))}},{key:"_updateClip",value:function(){var s=this._display.clipViewport,c=this._clipViewport;if(this._scaleViewport&&(c=!1),s!==c&&(this._display.clipViewport=c),c){var t=this._screenSize();this._display.viewportChangeSize(t.w,t.h),this._fixScrollbars(),this._setClippingViewport(t.w<this._display.width||t.h<this._display.height)}else this._setClippingViewport(!1);s!==c&&this._saveExpectedClientSize()}},{key:"_updateScale",value:function(){if(!this._scaleViewport)this._display.scale=1;else{var s=this._screenSize();this._display.autoscale(s.w,s.h)}this._fixScrollbars()}},{key:"_requestRemoteResize",value:function(){if(clearTimeout(this._resizeTimeout),this._resizeTimeout=null,!(!this._resizeSession||this._viewOnly||!this._supportsSetDesktopSize)){var s=this._screenSize();i.messages.setDesktopSize(this._sock,Math.floor(s.w),Math.floor(s.h),this._screenID,this._screenFlags),ie.Debug("Requested new desktop size: "+s.w+"x"+s.h)}}},{key:"_screenSize",value:function(){var s=this._screen.getBoundingClientRect();return{w:s.width,h:s.height}}},{key:"_fixScrollbars",value:function(){var s=this._screen.style.overflow;this._screen.style.overflow="hidden",this._screen.getBoundingClientRect(),this._screen.style.overflow=s}},{key:"_updateConnectionState",value:function(s){var c=this,t=this._rfbConnectionState;if(s===t){ie.Debug("Already in state '"+s+"', ignoring");return}if(t==="disconnected"){ie.Error("Tried changing state of a disconnected RFB object");return}switch(s){case"connected":if(t!=="connecting"){ie.Error("Bad transition to connected state, previous connection state: "+t);return}break;case"disconnected":if(t!=="disconnecting"){ie.Error("Bad transition to disconnected state, previous connection state: "+t);return}break;case"connecting":if(t!==""){ie.Error("Bad transition to connecting state, previous connection state: "+t);return}break;case"disconnecting":if(t!=="connected"&&t!=="connecting"){ie.Error("Bad transition to disconnecting state, previous connection state: "+t);return}break;default:ie.Error("Unknown connection state: "+s);return}switch(this._rfbConnectionState=s,ie.Debug("New state '"+s+"', was '"+t+"'."),this._disconnTimer&&s!=="disconnecting"&&(ie.Debug("Clearing disconnect timer"),clearTimeout(this._disconnTimer),this._disconnTimer=null,this._sock.off("close")),s){case"connecting":this._connect();break;case"connected":this.dispatchEvent(new CustomEvent("connect",{detail:{}}));break;case"disconnecting":this._disconnect(),this._disconnTimer=setTimeout(function(){ie.Error("Disconnection timed out."),c._updateConnectionState("disconnected")},cp*1e3);break;case"disconnected":this.dispatchEvent(new CustomEvent("disconnect",{detail:{clean:this._rfbCleanDisconnect}}));break}}},{key:"_fail",value:function(s){switch(this._rfbConnectionState){case"disconnecting":ie.Error("Failed when disconnecting: "+s);break;case"connected":ie.Error("Failed while connected: "+s);break;case"connecting":ie.Error("Failed when connecting: "+s);break;default:ie.Error("RFB failure: "+s);break}return this._rfbCleanDisconnect=!1,this._updateConnectionState("disconnecting"),this._updateConnectionState("disconnected"),!1}},{key:"_setCapability",value:function(s,c){this._capabilities[s]=c,this.dispatchEvent(new CustomEvent("capabilities",{detail:{capabilities:this._capabilities}}))}},{key:"_handleMessage",value:function(){if(this._sock.rQwait("message",1)){ie.Warn("handleMessage called on an empty receive queue");return}switch(this._rfbConnectionState){case"disconnected":ie.Error("Got data while disconnected");break;case"connected":for(;!(this._flushing||!this._normalMsg()||this._sock.rQwait("message",1)););break;case"connecting":for(;this._rfbConnectionState==="connecting"&&this._initMsg(););break;default:ie.Error("Got data while in an invalid state");break}}},{key:"_handleKeyEvent",value:function(s,c,t,n,h){c=="CapsLock"&&t&&(this._remoteCapsLock=null),this._remoteCapsLock!==null&&h!==null&&this._remoteCapsLock!==h&&t&&(ie.Debug("Fixing remote caps lock"),this.sendKey(et.default.XK_Caps_Lock,"CapsLock",!0),this.sendKey(et.default.XK_Caps_Lock,"CapsLock",!1),this._remoteCapsLock=null),c=="NumLock"&&t&&(this._remoteNumLock=null),this._remoteNumLock!==null&&n!==null&&this._remoteNumLock!==n&&t&&(ie.Debug("Fixing remote num lock"),this.sendKey(et.default.XK_Num_Lock,"NumLock",!0),this.sendKey(et.default.XK_Num_Lock,"NumLock",!1),this._remoteNumLock=null),this.sendKey(s,c,t)}},{key:"_handleMouse",value:function(s){if(!(s.type==="click"&&s.target!==this._canvas)&&(s.stopPropagation(),s.preventDefault(),!(s.type==="click"||s.type==="contextmenu"))){var c=(0,or.clientToElement)(s.clientX,s.clientY,this._canvas);switch(s.type){case"mousedown":(0,Dg.setCapture)(this._canvas),this._handleMouseButton(c.x,c.y,!0,1<<s.button);break;case"mouseup":this._handleMouseButton(c.x,c.y,!1,1<<s.button);break;case"mousemove":this._handleMouseMove(c.x,c.y);break}}}},{key:"_handleMouseButton",value:function(s,c,t,n){if(this.dragViewport)if(t&&!this._viewportDragging){this._viewportDragging=!0,this._viewportDragPos={x:s,y:c},this._viewportHasMoved=!1;return}else{if(this._viewportDragging=!1,this._viewportHasMoved)return;this._sendMouse(s,c,n)}this._mouseMoveTimer!==null&&(clearTimeout(this._mouseMoveTimer),this._mouseMoveTimer=null,this._sendMouse(s,c,this._mouseButtonMask)),t?this._mouseButtonMask|=n:this._mouseButtonMask&=~n,this._sendMouse(s,c,this._mouseButtonMask)}},{key:"_handleMouseMove",value:function(s,c){var t=this;if(this._viewportDragging){var n=this._viewportDragPos.x-s,h=this._viewportDragPos.y-c;(this._viewportHasMoved||Math.abs(n)>Bc.dragThreshold||Math.abs(h)>Bc.dragThreshold)&&(this._viewportHasMoved=!0,this._viewportDragPos={x:s,y:c},this._display.viewportChangePos(n,h));return}if(this._mousePos={x:s,y:c},this._mouseMoveTimer==null){var g=Date.now()-this._mouseLastMoveTime;g>Rc?(this._sendMouse(s,c,this._mouseButtonMask),this._mouseLastMoveTime=Date.now()):this._mouseMoveTimer=setTimeout(function(){t._handleDelayedMouseMove()},Rc-g)}}},{key:"_handleDelayedMouseMove",value:function(){this._mouseMoveTimer=null,this._sendMouse(this._mousePos.x,this._mousePos.y,this._mouseButtonMask),this._mouseLastMoveTime=Date.now()}},{key:"_sendMouse",value:function(s,c,t){this._rfbConnectionState==="connected"&&(this._viewOnly||i.messages.pointerEvent(this._sock,this._display.absX(s),this._display.absY(c),t))}},{key:"_handleWheel",value:function(s){if(this._rfbConnectionState==="connected"&&!this._viewOnly){s.stopPropagation(),s.preventDefault();var c=(0,or.clientToElement)(s.clientX,s.clientY,this._canvas),t=s.deltaX,n=s.deltaY;s.deltaMode!==0&&(t*=Tc,n*=Tc),this._accumulatedWheelDeltaX+=t,this._accumulatedWheelDeltaY+=n,Math.abs(this._accumulatedWheelDeltaX)>=Mc&&(this._accumulatedWheelDeltaX<0?(this._handleMouseButton(c.x,c.y,!0,32),this._handleMouseButton(c.x,c.y,!1,32)):this._accumulatedWheelDeltaX>0&&(this._handleMouseButton(c.x,c.y,!0,64),this._handleMouseButton(c.x,c.y,!1,64)),this._accumulatedWheelDeltaX=0),Math.abs(this._accumulatedWheelDeltaY)>=Mc&&(this._accumulatedWheelDeltaY<0?(this._handleMouseButton(c.x,c.y,!0,8),this._handleMouseButton(c.x,c.y,!1,8)):this._accumulatedWheelDeltaY>0&&(this._handleMouseButton(c.x,c.y,!0,16),this._handleMouseButton(c.x,c.y,!1,16)),this._accumulatedWheelDeltaY=0)}}},{key:"_fakeMouseMove",value:function(s,c,t){this._handleMouseMove(c,t),this._cursor.move(s.detail.clientX,s.detail.clientY)}},{key:"_handleTapEvent",value:function(s,c){var t=(0,or.clientToElement)(s.detail.clientX,s.detail.clientY,this._canvas);if(this._gestureLastTapTime!==null&&Date.now()-this._gestureLastTapTime<dp&&this._gestureFirstDoubleTapEv.detail.type===s.detail.type){var n=this._gestureFirstDoubleTapEv.detail.clientX-s.detail.clientX,h=this._gestureFirstDoubleTapEv.detail.clientY-s.detail.clientY,g=Math.hypot(n,h);g<fp?t=(0,or.clientToElement)(this._gestureFirstDoubleTapEv.detail.clientX,this._gestureFirstDoubleTapEv.detail.clientY,this._canvas):this._gestureFirstDoubleTapEv=s}else this._gestureFirstDoubleTapEv=s;this._gestureLastTapTime=Date.now(),this._fakeMouseMove(this._gestureFirstDoubleTapEv,t.x,t.y),this._handleMouseButton(t.x,t.y,!0,c),this._handleMouseButton(t.x,t.y,!1,c)}},{key:"_handleGesture",value:function(s){var c,t=(0,or.clientToElement)(s.detail.clientX,s.detail.clientY,this._canvas);switch(s.type){case"gesturestart":switch(s.detail.type){case"onetap":this._handleTapEvent(s,1);break;case"twotap":this._handleTapEvent(s,4);break;case"threetap":this._handleTapEvent(s,2);break;case"drag":this._fakeMouseMove(s,t.x,t.y),this._handleMouseButton(t.x,t.y,!0,1);break;case"longpress":this._fakeMouseMove(s,t.x,t.y),this._handleMouseButton(t.x,t.y,!0,4);break;case"twodrag":this._gestureLastMagnitudeX=s.detail.magnitudeX,this._gestureLastMagnitudeY=s.detail.magnitudeY,this._fakeMouseMove(s,t.x,t.y);break;case"pinch":this._gestureLastMagnitudeX=Math.hypot(s.detail.magnitudeX,s.detail.magnitudeY),this._fakeMouseMove(s,t.x,t.y);break}break;case"gesturemove":switch(s.detail.type){case"onetap":case"twotap":case"threetap":break;case"drag":case"longpress":this._fakeMouseMove(s,t.x,t.y);break;case"twodrag":for(this._fakeMouseMove(s,t.x,t.y);s.detail.magnitudeY-this._gestureLastMagnitudeY>Xt;)this._handleMouseButton(t.x,t.y,!0,8),this._handleMouseButton(t.x,t.y,!1,8),this._gestureLastMagnitudeY+=Xt;for(;s.detail.magnitudeY-this._gestureLastMagnitudeY<-Xt;)this._handleMouseButton(t.x,t.y,!0,16),this._handleMouseButton(t.x,t.y,!1,16),this._gestureLastMagnitudeY-=Xt;for(;s.detail.magnitudeX-this._gestureLastMagnitudeX>Xt;)this._handleMouseButton(t.x,t.y,!0,32),this._handleMouseButton(t.x,t.y,!1,32),this._gestureLastMagnitudeX+=Xt;for(;s.detail.magnitudeX-this._gestureLastMagnitudeX<-Xt;)this._handleMouseButton(t.x,t.y,!0,64),this._handleMouseButton(t.x,t.y,!1,64),this._gestureLastMagnitudeX-=Xt;break;case"pinch":if(this._fakeMouseMove(s,t.x,t.y),c=Math.hypot(s.detail.magnitudeX,s.detail.magnitudeY),Math.abs(c-this._gestureLastMagnitudeX)>ar){for(this._handleKeyEvent(et.default.XK_Control_L,"ControlLeft",!0);c-this._gestureLastMagnitudeX>ar;)this._handleMouseButton(t.x,t.y,!0,8),this._handleMouseButton(t.x,t.y,!1,8),this._gestureLastMagnitudeX+=ar;for(;c-this._gestureLastMagnitudeX<-ar;)this._handleMouseButton(t.x,t.y,!0,16),this._handleMouseButton(t.x,t.y,!1,16),this._gestureLastMagnitudeX-=ar}this._handleKeyEvent(et.default.XK_Control_L,"ControlLeft",!1);break}break;case"gestureend":switch(s.detail.type){case"onetap":case"twotap":case"threetap":case"pinch":case"twodrag":break;case"drag":this._fakeMouseMove(s,t.x,t.y),this._handleMouseButton(t.x,t.y,!1,1);break;case"longpress":this._fakeMouseMove(s,t.x,t.y),this._handleMouseButton(t.x,t.y,!1,4);break}break}}},{key:"_negotiateProtocolVersion",value:function(){if(this._sock.rQwait("version",12))return!1;var s=this._sock.rQshiftStr(12).substr(4,7);ie.Info("Server ProtocolVersion: "+s);var c=0;switch(s){case"000.000":c=1;break;case"003.003":case"003.006":this._rfbVersion=3.3;break;case"003.007":this._rfbVersion=3.7;break;case"003.008":case"003.889":case"004.000":case"004.001":case"005.000":this._rfbVersion=3.8;break;default:return this._fail("Invalid server version "+s)}if(c){for(var t="ID:"+this._repeaterID;t.length<250;)t+="\0";return this._sock.sQpushString(t),this._sock.flush(),!0}this._rfbVersion>this._rfbMaxVersion&&(this._rfbVersion=this._rfbMaxVersion);var n="00"+parseInt(this._rfbVersion,10)+".00"+this._rfbVersion*10%10;this._sock.sQpushString("RFB "+n+`
`),this._sock.flush(),ie.Debug("Sent ProtocolVersion: "+n),this._rfbInitState="Security"}},{key:"_isSupportedSecurityType",value:function(s){var c=[Fc,vs,Pc,Oc,lo,Kc,Qc,Xc,Nc];return c.includes(s)}},{key:"_negotiateSecurity",value:function(){if(this._rfbVersion>=3.7){var s=this._sock.rQshift8();if(this._sock.rQwait("security type",s,1))return!1;if(s===0)return this._rfbInitState="SecurityReason",this._securityContext="no security types",this._securityStatus=1,!0;var c=this._sock.rQshiftBytes(s);ie.Debug("Server security types: "+c),this._rfbAuthScheme=-1;var t=ho(c),n;try{for(t.s();!(n=t.n()).done;){var h=n.value;if(this._isSupportedSecurityType(h)){this._rfbAuthScheme=h;break}}}catch(g){t.e(g)}finally{t.f()}if(this._rfbAuthScheme===-1)return this._fail("Unsupported security types (types: "+c+")");this._sock.sQpush8(this._rfbAuthScheme),this._sock.flush()}else{if(this._sock.rQwait("security scheme",4))return!1;if(this._rfbAuthScheme=this._sock.rQshift32(),this._rfbAuthScheme==0)return this._rfbInitState="SecurityReason",this._securityContext="authentication scheme",this._securityStatus=1,!0}return this._rfbInitState="Authentication",ie.Debug("Authenticating using scheme: "+this._rfbAuthScheme),!0}},{key:"_handleSecurityReason",value:function(){if(this._sock.rQwait("reason length",4))return!1;var s=this._sock.rQshift32(),c="";if(s>0){if(this._sock.rQwait("reason",s,4))return!1;c=this._sock.rQshiftStr(s)}return c!==""?(this.dispatchEvent(new CustomEvent("securityfailure",{detail:{status:this._securityStatus,reason:c}})),this._fail("Security negotiation failed on "+this._securityContext+" (reason: "+c+")")):(this.dispatchEvent(new CustomEvent("securityfailure",{detail:{status:this._securityStatus}})),this._fail("Security negotiation failed on "+this._securityContext))}},{key:"_negotiateXvpAuth",value:function(){return this._rfbCredentials.username===void 0||this._rfbCredentials.password===void 0||this._rfbCredentials.target===void 0?(this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["username","password","target"]}})),!1):(this._sock.sQpush8(this._rfbCredentials.username.length),this._sock.sQpush8(this._rfbCredentials.target.length),this._sock.sQpushString(this._rfbCredentials.username),this._sock.sQpushString(this._rfbCredentials.target),this._sock.flush(),this._rfbAuthScheme=vs,this._negotiateAuthentication())}},{key:"_negotiateVeNCryptAuth",value:function(){if(this._rfbVeNCryptState==0){if(this._sock.rQwait("vencrypt version",2))return!1;var s=this._sock.rQshift8(),c=this._sock.rQshift8();if(!(s==0&&c==2))return this._fail("Unsupported VeNCrypt version "+s+"."+c);this._sock.sQpush8(0),this._sock.sQpush8(2),this._sock.flush(),this._rfbVeNCryptState=1}if(this._rfbVeNCryptState==1){if(this._sock.rQwait("vencrypt ack",1))return!1;var t=this._sock.rQshift8();if(t!=0)return this._fail("VeNCrypt failure "+t);this._rfbVeNCryptState=2}if(this._rfbVeNCryptState==2){if(this._sock.rQwait("vencrypt subtypes length",1))return!1;var n=this._sock.rQshift8();if(n<1)return this._fail("VeNCrypt subtypes empty");this._rfbVeNCryptSubtypesLength=n,this._rfbVeNCryptState=3}if(this._rfbVeNCryptState==3){if(this._sock.rQwait("vencrypt subtypes",4*this._rfbVeNCryptSubtypesLength))return!1;for(var h=[],g=0;g<this._rfbVeNCryptSubtypesLength;g++)h.push(this._sock.rQshift32());this._rfbAuthScheme=-1;for(var a=0,l=h;a<l.length;a++){var _=l[a];if(_!==lo&&this._isSupportedSecurityType(_)){this._rfbAuthScheme=_;break}}return this._rfbAuthScheme===-1?this._fail("Unsupported security types (types: "+h+")"):(this._sock.sQpush32(this._rfbAuthScheme),this._sock.flush(),this._rfbVeNCryptState=4,!0)}}},{key:"_negotiatePlainAuth",value:function(){if(this._rfbCredentials.username===void 0||this._rfbCredentials.password===void 0)return this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["username","password"]}})),!1;var s=(0,ft.encodeUTF8)(this._rfbCredentials.username),c=(0,ft.encodeUTF8)(this._rfbCredentials.password);return this._sock.sQpush32(s.length),this._sock.sQpush32(c.length),this._sock.sQpushString(s),this._sock.sQpushString(c),this._sock.flush(),this._rfbInitState="SecurityResult",!0}},{key:"_negotiateStdVNCAuth",value:function(){if(this._sock.rQwait("auth challenge",16))return!1;if(this._rfbCredentials.password===void 0)return this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["password"]}})),!1;var s=Array.prototype.slice.call(this._sock.rQshiftBytes(16)),c=i.genDES(this._rfbCredentials.password,s);return this._sock.sQpushBytes(c),this._sock.flush(),this._rfbInitState="SecurityResult",!0}},{key:"_negotiateARDAuth",value:function(){if(this._rfbCredentials.username===void 0||this._rfbCredentials.password===void 0)return this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["username","password"]}})),!1;if(this._rfbCredentials.ardPublicKey!=null&&this._rfbCredentials.ardCredentials!=null)return this._sock.sQpushBytes(this._rfbCredentials.ardCredentials),this._sock.sQpushBytes(this._rfbCredentials.ardPublicKey),this._sock.flush(),this._rfbCredentials.ardCredentials=null,this._rfbCredentials.ardPublicKey=null,this._rfbInitState="SecurityResult",!0;if(this._sock.rQwait("read ard",4))return!1;var s=this._sock.rQshiftBytes(2),c=this._sock.rQshift16();if(this._sock.rQwait("read ard keylength",c*2,4))return!1;var t=this._sock.rQshiftBytes(c),n=this._sock.rQshiftBytes(c),h=je.default.generateKey({name:"DH",g:s,p:t},!1,["deriveBits"]);return this._negotiateARDAuthAsync(c,n,h),!1}},{key:"_negotiateARDAuthAsync",value:function(){var r=Jg(co().mark(function c(t,n,h){var g,a,l,_,v,u,o,d,f,p;return co().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:for(g=je.default.exportKey("raw",h.publicKey),a=je.default.deriveBits({name:"DH",public:n},h.privateKey,t*8),l=(0,ft.encodeUTF8)(this._rfbCredentials.username).substring(0,63),_=(0,ft.encodeUTF8)(this._rfbCredentials.password).substring(0,63),v=window.crypto.getRandomValues(new Uint8Array(128)),u=0;u<l.length;u++)v[u]=l.charCodeAt(u);for(v[l.length]=0,o=0;o<_.length;o++)v[64+o]=_.charCodeAt(o);return v[64+_.length]=0,w.next=11,je.default.digest("MD5",a);case 11:return d=w.sent,w.next=14,je.default.importKey("raw",d,{name:"AES-ECB"},!1,["encrypt"]);case 14:return f=w.sent,w.next=17,je.default.encrypt({name:"AES-ECB"},f,v);case 17:p=w.sent,this._rfbCredentials.ardCredentials=p,this._rfbCredentials.ardPublicKey=g,this._resumeAuthentication();case 21:case"end":return w.stop()}},c,this)}));function s(c,t,n){return r.apply(this,arguments)}return s}()},{key:"_negotiateTightUnixAuth",value:function(){return this._rfbCredentials.username===void 0||this._rfbCredentials.password===void 0?(this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["username","password"]}})),!1):(this._sock.sQpush32(this._rfbCredentials.username.length),this._sock.sQpush32(this._rfbCredentials.password.length),this._sock.sQpushString(this._rfbCredentials.username),this._sock.sQpushString(this._rfbCredentials.password),this._sock.flush(),this._rfbInitState="SecurityResult",!0)}},{key:"_negotiateTightTunnels",value:function(s){for(var c={0:{vendor:"TGHT",signature:"NOTUNNEL"}},t={},n=0;n<s;n++){var h=this._sock.rQshift32(),g=this._sock.rQshiftStr(4),a=this._sock.rQshiftStr(8);t[h]={vendor:g,signature:a}}return ie.Debug("Server Tight tunnel types: "+t),t[1]&&t[1].vendor==="SICR"&&t[1].signature==="SCHANNEL"&&(ie.Debug("Detected Siemens server. Assuming NOTUNNEL support."),t[0]={vendor:"TGHT",signature:"NOTUNNEL"}),t[0]?t[0].vendor!=c[0].vendor||t[0].signature!=c[0].signature?this._fail("Client's tunnel type had the incorrect vendor or signature"):(ie.Debug("Selected tunnel type: "+c[0]),this._sock.sQpush32(0),this._sock.flush(),!1):this._fail("Server wanted tunnels, but doesn't support the notunnel type")}},{key:"_negotiateTightAuth",value:function(){if(!this._rfbTightVNC){if(this._sock.rQwait("num tunnels",4))return!1;var s=this._sock.rQshift32();if(s>0&&this._sock.rQwait("tunnel capabilities",16*s,4))return!1;if(this._rfbTightVNC=!0,s>0)return this._negotiateTightTunnels(s),!1}if(this._sock.rQwait("sub auth count",4))return!1;var c=this._sock.rQshift32();if(c===0)return this._rfbInitState="SecurityResult",!0;if(this._sock.rQwait("sub auth capabilities",16*c,4))return!1;for(var t={STDVNOAUTH__:1,STDVVNCAUTH_:2,TGHTULGNAUTH:129},n=[],h=0;h<c;h++){this._sock.rQshift32();var g=this._sock.rQshiftStr(12);n.push(g)}ie.Debug("Server Tight authentication types: "+n);for(var a in t)if(n.indexOf(a)!=-1)switch(this._sock.sQpush32(t[a]),this._sock.flush(),ie.Debug("Selected authentication type: "+a),a){case"STDVNOAUTH__":return this._rfbInitState="SecurityResult",!0;case"STDVVNCAUTH_":return this._rfbAuthScheme=vs,!0;case"TGHTULGNAUTH":return this._rfbAuthScheme=Hc,!0;default:return this._fail("Unsupported tiny auth scheme (scheme: "+a+")")}return this._fail("No supported sub-auth types!")}},{key:"_handleRSAAESCredentialsRequired",value:function(s){this.dispatchEvent(s)}},{key:"_handleRSAAESServerVerification",value:function(s){this.dispatchEvent(s)}},{key:"_negotiateRA2neAuth",value:function(){var s=this;return this._rfbRSAAESAuthenticationState===null&&(this._rfbRSAAESAuthenticationState=new Hg.default(this._sock,function(){return s._rfbCredentials}),this._rfbRSAAESAuthenticationState.addEventListener("serververification",this._eventHandlers.handleRSAAESServerVerification),this._rfbRSAAESAuthenticationState.addEventListener("credentialsrequired",this._eventHandlers.handleRSAAESCredentialsRequired)),this._rfbRSAAESAuthenticationState.checkInternalEvents(),this._rfbRSAAESAuthenticationState.hasStarted||this._rfbRSAAESAuthenticationState.negotiateRA2neAuthAsync().catch(function(c){c.message!=="disconnect normally"&&s._fail(c.message)}).then(function(){return s._rfbInitState="SecurityResult",!0}).finally(function(){s._rfbRSAAESAuthenticationState.removeEventListener("serververification",s._eventHandlers.handleRSAAESServerVerification),s._rfbRSAAESAuthenticationState.removeEventListener("credentialsrequired",s._eventHandlers.handleRSAAESCredentialsRequired),s._rfbRSAAESAuthenticationState=null}),!1}},{key:"_negotiateMSLogonIIAuth",value:function(){if(this._sock.rQwait("mslogonii dh param",24))return!1;if(this._rfbCredentials.username===void 0||this._rfbCredentials.password===void 0)return this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["username","password"]}})),!1;var s=this._sock.rQshiftBytes(8),c=this._sock.rQshiftBytes(8),t=this._sock.rQshiftBytes(8),n=je.default.generateKey({name:"DH",g:s,p:c},!0,["deriveBits"]),h=je.default.exportKey("raw",n.publicKey),g=je.default.deriveBits({name:"DH",public:t},n.privateKey,64),a=je.default.importKey("raw",g,{name:"DES-CBC"},!1,["encrypt"]),l=(0,ft.encodeUTF8)(this._rfbCredentials.username).substring(0,255),_=(0,ft.encodeUTF8)(this._rfbCredentials.password).substring(0,63),v=new Uint8Array(256),u=new Uint8Array(64);window.crypto.getRandomValues(v),window.crypto.getRandomValues(u);for(var o=0;o<l.length;o++)v[o]=l.charCodeAt(o);v[l.length]=0;for(var d=0;d<_.length;d++)u[d]=_.charCodeAt(d);return u[_.length]=0,v=je.default.encrypt({name:"DES-CBC",iv:g},a,v),u=je.default.encrypt({name:"DES-CBC",iv:g},a,u),this._sock.sQpushBytes(h),this._sock.sQpushBytes(v),this._sock.sQpushBytes(u),this._sock.flush(),this._rfbInitState="SecurityResult",!0}},{key:"_negotiateAuthentication",value:function(){switch(this._rfbAuthScheme){case Fc:return this._rfbVersion>=3.8?this._rfbInitState="SecurityResult":this._rfbInitState="ClientInitialisation",!0;case Kc:return this._negotiateXvpAuth();case Qc:return this._negotiateARDAuth();case vs:return this._negotiateStdVNCAuth();case Oc:return this._negotiateTightAuth();case lo:return this._negotiateVeNCryptAuth();case Nc:return this._negotiatePlainAuth();case Hc:return this._negotiateTightUnixAuth();case Pc:return this._negotiateRA2neAuth();case Xc:return this._negotiateMSLogonIIAuth();default:return this._fail("Unsupported auth scheme (scheme: "+this._rfbAuthScheme+")")}}},{key:"_handleSecurityResult",value:function(){if(this._sock.rQwait("VNC auth response ",4))return!1;var s=this._sock.rQshift32();return s===0?(this._rfbInitState="ClientInitialisation",ie.Debug("Authentication OK"),!0):this._rfbVersion>=3.8?(this._rfbInitState="SecurityReason",this._securityContext="security result",this._securityStatus=s,!0):(this.dispatchEvent(new CustomEvent("securityfailure",{detail:{status:s}})),this._fail("Security handshake failed"))}},{key:"_negotiateServerInit",value:function(){if(this._sock.rQwait("server initialization",24))return!1;var s=this._sock.rQshift16(),c=this._sock.rQshift16(),t=this._sock.rQshift8(),n=this._sock.rQshift8(),h=this._sock.rQshift8(),g=this._sock.rQshift8(),a=this._sock.rQshift16(),l=this._sock.rQshift16(),_=this._sock.rQshift16(),v=this._sock.rQshift8(),u=this._sock.rQshift8(),o=this._sock.rQshift8();this._sock.rQskipBytes(3);var d=this._sock.rQshift32();if(this._sock.rQwait("server init name",d,24))return!1;var f=this._sock.rQshiftStr(d);if(f=(0,ft.decodeUTF8)(f,!0),this._rfbTightVNC){if(this._sock.rQwait("TightVNC extended server init header",8,24+d))return!1;var p=this._sock.rQshift16(),y=this._sock.rQshift16(),w=this._sock.rQshift16();this._sock.rQskipBytes(2);var b=(p+y+w)*16;if(this._sock.rQwait("TightVNC extended server init header",b,32+d))return!1;this._sock.rQskipBytes(16*p),this._sock.rQskipBytes(16*y),this._sock.rQskipBytes(16*w)}return ie.Info("Screen: "+s+"x"+c+", bpp: "+t+", depth: "+n+", bigEndian: "+h+", trueColor: "+g+", redMax: "+a+", greenMax: "+l+", blueMax: "+_+", redShift: "+v+", greenShift: "+u+", blueShift: "+o),this._setDesktopName(f),this._resize(s,c),this._viewOnly||this._keyboard.grab(),this._fbDepth=24,this._fbName==="Intel(r) AMT KVM"&&(ie.Warn("Intel AMT KVM only supports 8/16 bit depths. Using low color mode."),this._fbDepth=8),i.messages.pixelFormat(this._sock,this._fbDepth,!0),this._sendEncodings(),i.messages.fbUpdateRequest(this._sock,!1,0,0,this._fbWidth,this._fbHeight),this._updateConnectionState("connected"),!0}},{key:"_sendEncodings",value:function(){var s=[];s.push(ue.encodings.encodingCopyRect),this._fbDepth==24&&(s.push(ue.encodings.encodingTight),s.push(ue.encodings.encodingTightPNG),s.push(ue.encodings.encodingZRLE),s.push(ue.encodings.encodingJPEG),s.push(ue.encodings.encodingHextile),s.push(ue.encodings.encodingRRE)),s.push(ue.encodings.encodingRaw),s.push(ue.encodings.pseudoEncodingQualityLevel0+this._qualityLevel),s.push(ue.encodings.pseudoEncodingCompressLevel0+this._compressionLevel),s.push(ue.encodings.pseudoEncodingDesktopSize),s.push(ue.encodings.pseudoEncodingLastRect),s.push(ue.encodings.pseudoEncodingQEMUExtendedKeyEvent),s.push(ue.encodings.pseudoEncodingQEMULedEvent),s.push(ue.encodings.pseudoEncodingExtendedDesktopSize),s.push(ue.encodings.pseudoEncodingXvp),s.push(ue.encodings.pseudoEncodingFence),s.push(ue.encodings.pseudoEncodingContinuousUpdates),s.push(ue.encodings.pseudoEncodingDesktopName),s.push(ue.encodings.pseudoEncodingExtendedClipboard),this._fbDepth==24&&(s.push(ue.encodings.pseudoEncodingVMwareCursor),s.push(ue.encodings.pseudoEncodingCursor)),i.messages.clientEncodings(this._sock,s)}},{key:"_initMsg",value:function(){switch(this._rfbInitState){case"ProtocolVersion":return this._negotiateProtocolVersion();case"Security":return this._negotiateSecurity();case"Authentication":return this._negotiateAuthentication();case"SecurityResult":return this._handleSecurityResult();case"SecurityReason":return this._handleSecurityReason();case"ClientInitialisation":return this._sock.sQpush8(this._shared?1:0),this._sock.flush(),this._rfbInitState="ServerInitialisation",!0;case"ServerInitialisation":return this._negotiateServerInit();default:return this._fail("Unknown init state (state: "+this._rfbInitState+")")}}},{key:"_resumeAuthentication",value:function(){setTimeout(this._initMsg.bind(this),0)}},{key:"_handleSetColourMapMsg",value:function(){return ie.Debug("SetColorMapEntries"),this._fail("Unexpected SetColorMapEntries message")}},{key:"_handleServerCutText",value:function(){if(ie.Debug("ServerCutText"),this._sock.rQwait("ServerCutText header",7,1))return!1;this._sock.rQskipBytes(3);var s=this._sock.rQshift32();if(s=(0,Wc.toSigned32bit)(s),this._sock.rQwait("ServerCutText content",Math.abs(s),8))return!1;if(s>=0){var c=this._sock.rQshiftStr(s);if(this._viewOnly)return!0;this.dispatchEvent(new CustomEvent("clipboard",{detail:{text:c}}))}else{s=Math.abs(s);var t=this._sock.rQshift32(),n=t&65535,h=t&4278190080,g=!!(h&Uc);if(g){this._clipboardServerCapabilitiesFormats={},this._clipboardServerCapabilitiesActions={};for(var a=0;a<=15;a++){var l=1<<a;n&l&&(this._clipboardServerCapabilitiesFormats[l]=!0,this._sock.rQshift32())}for(var _=24;_<=31;_++){var v=1<<_;this._clipboardServerCapabilitiesActions[v]=!!(h&v)}var u=[Uc,ms,$c,hr,ys];i.messages.extendedClipboardCaps(this._sock,u,{extendedClipboardFormatText:0})}else if(h===ms){if(this._viewOnly)return!0;this._clipboardText!=null&&this._clipboardServerCapabilitiesActions[ys]&&n&_t&&i.messages.extendedClipboardProvide(this._sock,[_t],[this._clipboardText])}else if(h===$c){if(this._viewOnly)return!0;this._clipboardServerCapabilitiesActions[hr]&&(this._clipboardText!=null?i.messages.extendedClipboardNotify(this._sock,[_t]):i.messages.extendedClipboardNotify(this._sock,[]))}else if(h===hr){if(this._viewOnly)return!0;this._clipboardServerCapabilitiesActions[ms]&&n&_t&&i.messages.extendedClipboardRequest(this._sock,[_t])}else if(h===ys){if(this._viewOnly||!(n&_t))return!0;this._clipboardText=null;var o=this._sock.rQshiftBytes(s-4),d=new Tg.default,f=null;d.setInput(o);for(var p=0;p<=15;p++){var y=1<<p;if(n&y){var w=0,b=d.inflate(4);w|=b[0]<<24,w|=b[1]<<16,w|=b[2]<<8,w|=b[3];var S=d.inflate(w);y===_t&&(f=S)}}if(d.setInput(null),f!==null){for(var A="",C=0;C<f.length;C++)A+=String.fromCharCode(f[C]);f=A,f=(0,ft.decodeUTF8)(f),f.length>0&&f.charAt(f.length-1)==="\0"&&(f=f.slice(0,-1)),f=f.replaceAll(`\r
`,`
`),this.dispatchEvent(new CustomEvent("clipboard",{detail:{text:f}}))}}else return this._fail("Unexpected action in extended clipboard message: "+h)}return!0}},{key:"_handleServerFenceMsg",value:function(){if(this._sock.rQwait("ServerFence header",8,1))return!1;this._sock.rQskipBytes(3);var s=this._sock.rQshift32(),c=this._sock.rQshift8();if(this._sock.rQwait("ServerFence payload",c,9))return!1;c>64&&(ie.Warn("Bad payload length ("+c+") in fence response"),c=64);var t=this._sock.rQshiftStr(c);return this._supportsFence=!0,s&1<<31?(s&=3,i.messages.clientFence(this._sock,s,t),!0):this._fail("Unexpected fence response")}},{key:"_handleXvpMsg",value:function(){if(this._sock.rQwait("XVP version and message",3,1))return!1;this._sock.rQskipBytes(1);var s=this._sock.rQshift8(),c=this._sock.rQshift8();switch(c){case 0:ie.Error("XVP Operation Failed");break;case 1:this._rfbXvpVer=s,ie.Info("XVP extensions enabled (version "+this._rfbXvpVer+")"),this._setCapability("power",!0);break;default:this._fail("Illegal server XVP message (msg: "+c+")");break}return!0}},{key:"_normalMsg",value:function(){var s;this._FBU.rects>0?s=0:s=this._sock.rQshift8();var c,t;switch(s){case 0:return t=this._framebufferUpdate(),t&&!this._enabledContinuousUpdates&&i.messages.fbUpdateRequest(this._sock,!0,0,0,this._fbWidth,this._fbHeight),t;case 1:return this._handleSetColourMapMsg();case 2:return ie.Debug("Bell"),this.dispatchEvent(new CustomEvent("bell",{detail:{}})),!0;case 3:return this._handleServerCutText();case 150:return c=!this._supportsContinuousUpdates,this._supportsContinuousUpdates=!0,this._enabledContinuousUpdates=!1,c&&(this._enabledContinuousUpdates=!0,this._updateContinuousUpdates(),ie.Info("Enabling continuous updates.")),!0;case 248:return this._handleServerFenceMsg();case 250:return this._handleXvpMsg();default:return this._fail("Unexpected server message (type "+s+")"),ie.Debug("sock.rQpeekBytes(30): "+this._sock.rQpeekBytes(30)),!0}}},{key:"_framebufferUpdate",value:function(){var s=this;if(this._FBU.rects===0){if(this._sock.rQwait("FBU header",3,1))return!1;if(this._sock.rQskipBytes(1),this._FBU.rects=this._sock.rQshift16(),this._display.pending())return this._flushing=!0,this._display.flush().then(function(){s._flushing=!1,s._sock.rQwait("message",1)||s._handleMessage()}),!1}for(;this._FBU.rects>0;){if(this._FBU.encoding===null){if(this._sock.rQwait("rect header",12))return!1;this._FBU.x=this._sock.rQshift16(),this._FBU.y=this._sock.rQshift16(),this._FBU.width=this._sock.rQshift16(),this._FBU.height=this._sock.rQshift16(),this._FBU.encoding=this._sock.rQshift32(),this._FBU.encoding>>=0}if(!this._handleRect())return!1;this._FBU.rects--,this._FBU.encoding=null}return this._display.flip(),!0}},{key:"_handleRect",value:function(){switch(this._FBU.encoding){case ue.encodings.pseudoEncodingLastRect:return this._FBU.rects=1,!0;case ue.encodings.pseudoEncodingVMwareCursor:return this._handleVMwareCursor();case ue.encodings.pseudoEncodingCursor:return this._handleCursor();case ue.encodings.pseudoEncodingQEMUExtendedKeyEvent:return this._qemuExtKeyEventSupported=!0,!0;case ue.encodings.pseudoEncodingDesktopName:return this._handleDesktopName();case ue.encodings.pseudoEncodingDesktopSize:return this._resize(this._FBU.width,this._FBU.height),!0;case ue.encodings.pseudoEncodingExtendedDesktopSize:return this._handleExtendedDesktopSize();case ue.encodings.pseudoEncodingQEMULedEvent:return this._handleLedEvent();default:return this._handleDataRect()}}},{key:"_handleVMwareCursor",value:function(){var s=this._FBU.x,c=this._FBU.y,t=this._FBU.width,n=this._FBU.height;if(this._sock.rQwait("VMware cursor encoding",1))return!1;var h=this._sock.rQshift8();this._sock.rQshift8();var g,a=4;if(h==0){var l=-256;if(g=new Array(t*n*a),this._sock.rQwait("VMware cursor classic encoding",t*n*a*2,2))return!1;for(var _=new Array(t*n),v=0;v<t*n;v++)_[v]=this._sock.rQshift32();for(var u=new Array(t*n),o=0;o<t*n;o++)u[o]=this._sock.rQshift32();for(var d=0;d<t*n;d++)if(_[d]==0){var f=u[d],p=f>>8&255,y=f>>16&255,w=f>>24&255;g[d*a]=p,g[d*a+1]=y,g[d*a+2]=w,g[d*a+3]=255}else(_[d]&l)==l?u[d]==0?(g[d*a]=0,g[d*a+1]=0,g[d*a+2]=0,g[d*a+3]=0):((u[d]&l)==l,g[d*a]=0,g[d*a+1]=0,g[d*a+2]=0,g[d*a+3]=255):(g[d*a]=0,g[d*a+1]=0,g[d*a+2]=0,g[d*a+3]=255)}else if(h==1){if(this._sock.rQwait("VMware cursor alpha encoding",t*n*4,2))return!1;g=new Array(t*n*a);for(var b=0;b<t*n;b++){var S=this._sock.rQshift32();g[b*4]=S>>24&255,g[b*4+1]=S>>16&255,g[b*4+2]=S>>8&255,g[b*4+3]=S&255}}else return ie.Warn("The given cursor type is not supported: "+h+" given."),!1;return this._updateCursor(g,s,c,t,n),!0}},{key:"_handleCursor",value:function(){var s=this._FBU.x,c=this._FBU.y,t=this._FBU.width,n=this._FBU.height,h=t*n*4,g=Math.ceil(t/8)*n,a=h+g;if(this._sock.rQwait("cursor encoding",a))return!1;for(var l=this._sock.rQshiftBytes(h),_=this._sock.rQshiftBytes(g),v=new Uint8Array(t*n*4),u=0,o=0;o<n;o++)for(var d=0;d<t;d++){var f=o*Math.ceil(t/8)+Math.floor(d/8),p=_[f]<<d%8&128?255:0;v[u]=l[u+2],v[u+1]=l[u+1],v[u+2]=l[u],v[u+3]=p,u+=4}return this._updateCursor(v,s,c,t,n),!0}},{key:"_handleDesktopName",value:function(){if(this._sock.rQwait("DesktopName",4))return!1;var s=this._sock.rQshift32();if(this._sock.rQwait("DesktopName",s,4))return!1;var c=this._sock.rQshiftStr(s);return c=(0,ft.decodeUTF8)(c,!0),this._setDesktopName(c),!0}},{key:"_handleLedEvent",value:function(){if(this._sock.rQwait("LED Status",1))return!1;var s=this._sock.rQshift8(),c=!!(s&2),t=!!(s&4);return this._remoteCapsLock=t,this._remoteNumLock=c,!0}},{key:"_handleExtendedDesktopSize",value:function(){if(this._sock.rQwait("ExtendedDesktopSize",4))return!1;var s=this._sock.rQpeek8(),c=4+s*16;if(this._sock.rQwait("ExtendedDesktopSize",c))return!1;var t=!this._supportsSetDesktopSize;this._supportsSetDesktopSize=!0,this._sock.rQskipBytes(1),this._sock.rQskipBytes(3);for(var n=0;n<s;n+=1)n===0?(this._screenID=this._sock.rQshift32(),this._sock.rQskipBytes(2),this._sock.rQskipBytes(2),this._sock.rQskipBytes(2),this._sock.rQskipBytes(2),this._screenFlags=this._sock.rQshift32()):this._sock.rQskipBytes(16);if(this._FBU.x===1&&this._FBU.y!==0){var h="";switch(this._FBU.y){case 1:h="Resize is administratively prohibited";break;case 2:h="Out of resources";break;case 3:h="Invalid screen layout";break;default:h="Unknown reason";break}ie.Warn("Server did not accept the resize request: "+h)}else this._resize(this._FBU.width,this._FBU.height);return t&&this._requestRemoteResize(),!0}},{key:"_handleDataRect",value:function(){var s=this._decoders[this._FBU.encoding];if(!s)return this._fail("Unsupported encoding (encoding: "+this._FBU.encoding+")"),!1;try{return s.decodeRect(this._FBU.x,this._FBU.y,this._FBU.width,this._FBU.height,this._sock,this._display,this._fbDepth)}catch(c){return this._fail("Error decoding rect: "+c),!1}}},{key:"_updateContinuousUpdates",value:function(){this._enabledContinuousUpdates&&i.messages.enableContinuousUpdates(this._sock,!0,0,0,this._fbWidth,this._fbHeight)}},{key:"_resize",value:function(s,c){this._fbWidth=s,this._fbHeight=c,this._display.resize(this._fbWidth,this._fbHeight),this._updateClip(),this._updateScale(),this._updateContinuousUpdates(),this._saveExpectedClientSize()}},{key:"_xvpOp",value:function(s,c){this._rfbXvpVer<s||(ie.Info("Sending XVP operation "+c+" (version "+s+")"),i.messages.xvpOp(this._sock,s,c))}},{key:"_updateCursor",value:function(s,c,t,n,h){this._cursorImage={rgbaPixels:s,hotx:c,hoty:t,w:n,h},this._refreshCursor()}},{key:"_shouldShowDotCursor",value:function(){if(!this._showDotCursor)return!1;for(var s=3;s<this._cursorImage.rgbaPixels.length;s+=4)if(this._cursorImage.rgbaPixels[s])return!1;return!0}},{key:"_refreshCursor",value:function(){if(!(this._rfbConnectionState!=="connecting"&&this._rfbConnectionState!=="connected")){var s=this._shouldShowDotCursor()?i.cursors.dot:this._cursorImage;this._cursor.change(s.rgbaPixels,s.hotx,s.hoty,s.w,s.h)}}}],[{key:"genDES",value:function(s,c){var t=s.split("").map(function(h){return h.charCodeAt(0)}),n=je.default.importKey("raw",t,{name:"DES-ECB"},!1,["encrypt"]);return je.default.encrypt({name:"DES-ECB"},n,c)}}])}(Rg.default);gt.messages={keyEvent:function(i,r,s){i.sQpush8(4),i.sQpush8(s),i.sQpush16(0),i.sQpush32(r),i.flush()},QEMUExtendedKeyEvent:function(i,r,s,c){function t(h){var g=c>>8,a=c&255;return g===224&&a<127?a|128:h}i.sQpush8(255),i.sQpush8(0),i.sQpush16(s),i.sQpush32(r);var n=t(c);i.sQpush32(n),i.flush()},pointerEvent:function(i,r,s,c){i.sQpush8(5),i.sQpush8(c),i.sQpush16(r),i.sQpush16(s),i.flush()},_buildExtendedClipboardFlags:function(i,r){for(var s=new Uint8Array(4),c=0,t=0,n=0;n<i.length;n++)t|=i[n];for(var h=0;h<r.length;h++)c|=r[h];return s[0]=t>>24,s[1]=0,s[2]=0,s[3]=c,s},extendedClipboardProvide:function(i,r,s){for(var c=new Fg.default,t=[],n=0;n<r.length;n++){if(r[n]!=_t)throw new Error("Unsupported extended clipboard format for Provide message.");s[n]=s[n].replace(/\r\n|\r|\n/gm,`\r
`);var h=(0,ft.encodeUTF8)(s[n]+"\0");t.push(h.length>>24&255,h.length>>16&255,h.length>>8&255,h.length&255);for(var g=0;g<h.length;g++)t.push(h.charCodeAt(g))}var a=c.deflate(new Uint8Array(t)),l=new Uint8Array(4+a.length);l.set(gt.messages._buildExtendedClipboardFlags([ys],r)),l.set(a,4),gt.messages.clientCutText(i,l,!0)},extendedClipboardNotify:function(i,r){var s=gt.messages._buildExtendedClipboardFlags([hr],r);gt.messages.clientCutText(i,s,!0)},extendedClipboardRequest:function(i,r){var s=gt.messages._buildExtendedClipboardFlags([ms],r);gt.messages.clientCutText(i,s,!0)},extendedClipboardCaps:function(i,r,s){var c=Object.keys(s),t=new Uint8Array(4+4*c.length);c.map(function(g){return parseInt(g)}),c.sort(function(g,a){return g-a}),t.set(gt.messages._buildExtendedClipboardFlags(r,[]));for(var n=4,h=0;h<c.length;h++)t[n]=s[c[h]]>>24,t[n+1]=s[c[h]]>>16,t[n+2]=s[c[h]]>>8,t[n+3]=s[c[h]]>>0,n+=4,t[3]|=1<<c[h];gt.messages.clientCutText(i,t,!0)},clientCutText:function(i,r){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;i.sQpush8(6),i.sQpush8(0),i.sQpush8(0),i.sQpush8(0);var c;s?c=(0,Wc.toUnsigned32bit)(-r.length):c=r.length,i.sQpush32(c),i.sQpushBytes(r),i.flush()},setDesktopSize:function(i,r,s,c,t){i.sQpush8(251),i.sQpush8(0),i.sQpush16(r),i.sQpush16(s),i.sQpush8(1),i.sQpush8(0),i.sQpush32(c),i.sQpush16(0),i.sQpush16(0),i.sQpush16(r),i.sQpush16(s),i.sQpush32(t),i.flush()},clientFence:function(i,r,s){i.sQpush8(248),i.sQpush8(0),i.sQpush8(0),i.sQpush8(0),i.sQpush32(r),i.sQpush8(s.length),i.sQpushString(s),i.flush()},enableContinuousUpdates:function(i,r,s,c,t,n){i.sQpush8(150),i.sQpush8(r),i.sQpush16(s),i.sQpush16(c),i.sQpush16(t),i.sQpush16(n),i.flush()},pixelFormat:function(i,r,s){var c;r>16?c=32:r>8?c=16:c=8;var t=Math.floor(r/3);i.sQpush8(0),i.sQpush8(0),i.sQpush8(0),i.sQpush8(0),i.sQpush8(c),i.sQpush8(r),i.sQpush8(0),i.sQpush8(s?1:0),i.sQpush16((1<<t)-1),i.sQpush16((1<<t)-1),i.sQpush16((1<<t)-1),i.sQpush8(t*0),i.sQpush8(t*1),i.sQpush8(t*2),i.sQpush8(0),i.sQpush8(0),i.sQpush8(0),i.flush()},clientEncodings:function(i,r){i.sQpush8(2),i.sQpush8(0),i.sQpush16(r.length);for(var s=0;s<r.length;s++)i.sQpush32(r[s]);i.flush()},fbUpdateRequest:function(i,r,s,c,t,n){typeof s>"u"&&(s=0),typeof c>"u"&&(c=0),i.sQpush8(3),i.sQpush8(r?1:0),i.sQpush16(s),i.sQpush16(c),i.sQpush16(t),i.sQpush16(n),i.flush()},xvpOp:function(i,r,s){i.sQpush8(250),i.sQpush8(0),i.sQpush8(r),i.sQpush8(s),i.flush()}};gt.cursors={none:{rgbaPixels:new Uint8Array,w:0,h:0,hotx:0,hoty:0},dot:{rgbaPixels:new Uint8Array([255,255,255,255,0,0,0,255,255,255,255,255,0,0,0,255,0,0,0,0,0,0,0,255,255,255,255,255,0,0,0,255,255,255,255,255]),w:3,h:3,hotx:1,hoty:1}}});var Jc=re((ws,fo)=>{(function(e,i){if(typeof ws=="object"&&typeof fo=="object")fo.exports=i();else if(typeof define=="function"&&define.amd)define([],i);else{var r=i();for(var s in r)(typeof ws=="object"?ws:e)[s]=r[s]}})(globalThis,()=>(()=>{"use strict";var e={4567:function(c,t,n){var h=this&&this.__decorate||function(f,p,y,w){var b,S=arguments.length,A=S<3?p:w===null?w=Object.getOwnPropertyDescriptor(p,y):w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")A=Reflect.decorate(f,p,y,w);else for(var C=f.length-1;C>=0;C--)(b=f[C])&&(A=(S<3?b(A):S>3?b(p,y,A):b(p,y))||A);return S>3&&A&&Object.defineProperty(p,y,A),A},g=this&&this.__param||function(f,p){return function(y,w){p(y,w,f)}};Object.defineProperty(t,"__esModule",{value:!0}),t.AccessibilityManager=void 0;let a=n(9042),l=n(9924),_=n(844),v=n(4725),u=n(2585),o=n(3656),d=t.AccessibilityManager=class extends _.Disposable{constructor(f,p,y,w){super(),this._terminal=f,this._coreBrowserService=y,this._renderService=w,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityContainer=this._coreBrowserService.mainDocument.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=this._coreBrowserService.mainDocument.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let b=0;b<this._terminal.rows;b++)this._rowElements[b]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[b]);if(this._topBoundaryFocusListener=b=>this._handleBoundaryFocus(b,0),this._bottomBoundaryFocusListener=b=>this._handleBoundaryFocus(b,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=this._coreBrowserService.mainDocument.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this.register(new l.TimeBasedDebouncer(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this.register(this._terminal.onResize(b=>this._handleResize(b.rows))),this.register(this._terminal.onRender(b=>this._refreshRows(b.start,b.end))),this.register(this._terminal.onScroll(()=>this._refreshRows())),this.register(this._terminal.onA11yChar(b=>this._handleChar(b))),this.register(this._terminal.onLineFeed(()=>this._handleChar(`
`))),this.register(this._terminal.onA11yTab(b=>this._handleTab(b))),this.register(this._terminal.onKey(b=>this._handleKey(b.key))),this.register(this._terminal.onBlur(()=>this._clearLiveRegion())),this.register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this.register((0,o.addDisposableDomListener)(document,"selectionchange",()=>this._handleSelectionChange())),this.register(this._coreBrowserService.onDprChange(()=>this._refreshRowsDimensions())),this._refreshRows(),this.register((0,_.toDisposable)(()=>{this._accessibilityContainer.remove(),this._rowElements.length=0}))}_handleTab(f){for(let p=0;p<f;p++)this._handleChar(" ")}_handleChar(f){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==f&&(this._charsToAnnounce+=f):this._charsToAnnounce+=f,f===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===21&&(this._liveRegion.textContent+=a.tooMuchOutput)))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey(f){this._clearLiveRegion(),/\p{Control}/u.test(f)||this._charsToConsume.push(f)}_refreshRows(f,p){this._liveRegionDebouncer.refresh(f,p,this._terminal.rows)}_renderRows(f,p){let y=this._terminal.buffer,w=y.lines.length.toString();for(let b=f;b<=p;b++){let S=y.lines.get(y.ydisp+b),A=[],C=S?.translateToString(!0,void 0,void 0,A)||"",D=(y.ydisp+b+1).toString(),L=this._rowElements[b];L&&(C.length===0?(L.innerText="\xA0",this._rowColumns.set(L,[0,1])):(L.textContent=C,this._rowColumns.set(L,A)),L.setAttribute("aria-posinset",D),L.setAttribute("aria-setsize",w))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(f,p){let y=f.target,w=this._rowElements[p===0?1:this._rowElements.length-2];if(y.getAttribute("aria-posinset")===(p===0?"1":`${this._terminal.buffer.lines.length}`)||f.relatedTarget!==w)return;let b,S;if(p===0?(b=y,S=this._rowElements.pop(),this._rowContainer.removeChild(S)):(b=this._rowElements.shift(),S=y,this._rowContainer.removeChild(b)),b.removeEventListener("focus",this._topBoundaryFocusListener),S.removeEventListener("focus",this._bottomBoundaryFocusListener),p===0){let A=this._createAccessibilityTreeNode();this._rowElements.unshift(A),this._rowContainer.insertAdjacentElement("afterbegin",A)}else{let A=this._createAccessibilityTreeNode();this._rowElements.push(A),this._rowContainer.appendChild(A)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(p===0?-1:1),this._rowElements[p===0?1:this._rowElements.length-2].focus(),f.preventDefault(),f.stopImmediatePropagation()}_handleSelectionChange(){if(this._rowElements.length===0)return;let f=document.getSelection();if(!f)return;if(f.isCollapsed)return void(this._rowContainer.contains(f.anchorNode)&&this._terminal.clearSelection());if(!f.anchorNode||!f.focusNode)return void console.error("anchorNode and/or focusNode are null");let p={node:f.anchorNode,offset:f.anchorOffset},y={node:f.focusNode,offset:f.focusOffset};if((p.node.compareDocumentPosition(y.node)&Node.DOCUMENT_POSITION_PRECEDING||p.node===y.node&&p.offset>y.offset)&&([p,y]=[y,p]),p.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(p={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(p.node))return;let w=this._rowElements.slice(-1)[0];if(y.node.compareDocumentPosition(w)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(y={node:w,offset:w.textContent?.length??0}),!this._rowContainer.contains(y.node))return;let b=({node:C,offset:D})=>{let L=C instanceof Text?C.parentNode:C,B=parseInt(L?.getAttribute("aria-posinset"),10)-1;if(isNaN(B))return console.warn("row is invalid. Race condition?"),null;let R=this._rowColumns.get(L);if(!R)return console.warn("columns is null. Race condition?"),null;let F=D<R.length?R[D]:R.slice(-1)[0]+1;return F>=this._terminal.cols&&(++B,F=0),{row:B,column:F}},S=b(p),A=b(y);if(S&&A){if(S.row>A.row||S.row===A.row&&S.column>=A.column)throw new Error("invalid range");this._terminal.select(S.column,S.row,(A.row-S.row)*this._terminal.cols-S.column+A.column)}}_handleResize(f){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let p=this._rowContainer.children.length;p<this._terminal.rows;p++)this._rowElements[p]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[p]);for(;this._rowElements.length>f;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){let f=this._coreBrowserService.mainDocument.createElement("div");return f.setAttribute("role","listitem"),f.tabIndex=-1,this._refreshRowDimensions(f),f}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityContainer.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let f=0;f<this._terminal.rows;f++)this._refreshRowDimensions(this._rowElements[f])}}_refreshRowDimensions(f){f.style.height=`${this._renderService.dimensions.css.cell.height}px`}};t.AccessibilityManager=d=h([g(1,u.IInstantiationService),g(2,v.ICoreBrowserService),g(3,v.IRenderService)],d)},3614:(c,t)=>{function n(l){return l.replace(/\r?\n/g,"\r")}function h(l,_){return _?"\x1B[200~"+l+"\x1B[201~":l}function g(l,_,v,u){l=h(l=n(l),v.decPrivateModes.bracketedPasteMode&&u.rawOptions.ignoreBracketedPasteMode!==!0),v.triggerDataEvent(l,!0),_.value=""}function a(l,_,v){let u=v.getBoundingClientRect(),o=l.clientX-u.left-10,d=l.clientY-u.top-10;_.style.width="20px",_.style.height="20px",_.style.left=`${o}px`,_.style.top=`${d}px`,_.style.zIndex="1000",_.focus()}Object.defineProperty(t,"__esModule",{value:!0}),t.rightClickHandler=t.moveTextAreaUnderMouseCursor=t.paste=t.handlePasteEvent=t.copyHandler=t.bracketTextForPaste=t.prepareTextForTerminal=void 0,t.prepareTextForTerminal=n,t.bracketTextForPaste=h,t.copyHandler=function(l,_){l.clipboardData&&l.clipboardData.setData("text/plain",_.selectionText),l.preventDefault()},t.handlePasteEvent=function(l,_,v,u){l.stopPropagation(),l.clipboardData&&g(l.clipboardData.getData("text/plain"),_,v,u)},t.paste=g,t.moveTextAreaUnderMouseCursor=a,t.rightClickHandler=function(l,_,v,u,o){a(l,_,v),o&&u.rightClickSelect(l),_.value=u.selectionText,_.select()}},7239:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ColorContrastCache=void 0;let h=n(1505);t.ColorContrastCache=class{constructor(){this._color=new h.TwoKeyMap,this._css=new h.TwoKeyMap}setCss(g,a,l){this._css.set(g,a,l)}getCss(g,a){return this._css.get(g,a)}setColor(g,a,l){this._color.set(g,a,l)}getColor(g,a){return this._color.get(g,a)}clear(){this._color.clear(),this._css.clear()}}},3656:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addDisposableDomListener=void 0,t.addDisposableDomListener=function(n,h,g,a){n.addEventListener(h,g,a);let l=!1;return{dispose:()=>{l||(l=!0,n.removeEventListener(h,g,a))}}}},3551:function(c,t,n){var h=this&&this.__decorate||function(d,f,p,y){var w,b=arguments.length,S=b<3?f:y===null?y=Object.getOwnPropertyDescriptor(f,p):y;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(d,f,p,y);else for(var A=d.length-1;A>=0;A--)(w=d[A])&&(S=(b<3?w(S):b>3?w(f,p,S):w(f,p))||S);return b>3&&S&&Object.defineProperty(f,p,S),S},g=this&&this.__param||function(d,f){return function(p,y){f(p,y,d)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Linkifier=void 0;let a=n(3656),l=n(8460),_=n(844),v=n(2585),u=n(4725),o=t.Linkifier=class extends _.Disposable{get currentLink(){return this._currentLink}constructor(d,f,p,y,w){super(),this._element=d,this._mouseService=f,this._renderService=p,this._bufferService=y,this._linkProviderService=w,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this.register(new l.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new l.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,_.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,_.toDisposable)(()=>{this._lastMouseEvent=void 0,this._activeProviderReplies?.clear()})),this.register(this._bufferService.onResize(()=>{this._clearCurrentLink(),this._wasResized=!0})),this.register((0,a.addDisposableDomListener)(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this.register((0,a.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,a.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,a.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(d){this._lastMouseEvent=d;let f=this._positionFromMouseEvent(d,this._element,this._mouseService);if(!f)return;this._isMouseOut=!1;let p=d.composedPath();for(let y=0;y<p.length;y++){let w=p[y];if(w.classList.contains("xterm"))break;if(w.classList.contains("xterm-hover"))return}this._lastBufferCell&&f.x===this._lastBufferCell.x&&f.y===this._lastBufferCell.y||(this._handleHover(f),this._lastBufferCell=f)}_handleHover(d){if(this._activeLine!==d.y||this._wasResized)return this._clearCurrentLink(),this._askForLink(d,!1),void(this._wasResized=!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,d)||(this._clearCurrentLink(),this._askForLink(d,!0))}_askForLink(d,f){this._activeProviderReplies&&f||(this._activeProviderReplies?.forEach(y=>{y?.forEach(w=>{w.link.dispose&&w.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=d.y);let p=!1;for(let[y,w]of this._linkProviderService.linkProviders.entries())f?this._activeProviderReplies?.get(y)&&(p=this._checkLinkProviderResult(y,d,p)):w.provideLinks(d.y,b=>{if(this._isMouseOut)return;let S=b?.map(A=>({link:A}));this._activeProviderReplies?.set(y,S),p=this._checkLinkProviderResult(y,d,p),this._activeProviderReplies?.size===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks(d.y,this._activeProviderReplies)})}_removeIntersectingLinks(d,f){let p=new Set;for(let y=0;y<f.size;y++){let w=f.get(y);if(w)for(let b=0;b<w.length;b++){let S=w[b],A=S.link.range.start.y<d?0:S.link.range.start.x,C=S.link.range.end.y>d?this._bufferService.cols:S.link.range.end.x;for(let D=A;D<=C;D++){if(p.has(D)){w.splice(b--,1);break}p.add(D)}}}}_checkLinkProviderResult(d,f,p){if(!this._activeProviderReplies)return p;let y=this._activeProviderReplies.get(d),w=!1;for(let b=0;b<d;b++)this._activeProviderReplies.has(b)&&!this._activeProviderReplies.get(b)||(w=!0);if(!w&&y){let b=y.find(S=>this._linkAtPosition(S.link,f));b&&(p=!0,this._handleNewLink(b))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!p)for(let b=0;b<this._activeProviderReplies.size;b++){let S=this._activeProviderReplies.get(b)?.find(A=>this._linkAtPosition(A.link,f));if(S){p=!0,this._handleNewLink(S);break}}return p}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(d){if(!this._currentLink)return;let f=this._positionFromMouseEvent(d,this._element,this._mouseService);f&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,f)&&this._currentLink.link.activate(d,this._currentLink.link.text)}_clearCurrentLink(d,f){this._currentLink&&this._lastMouseEvent&&(!d||!f||this._currentLink.link.range.start.y>=d&&this._currentLink.link.range.end.y<=f)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,_.disposeArray)(this._linkCacheDisposables))}_handleNewLink(d){if(!this._lastMouseEvent)return;let f=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);f&&this._linkAtPosition(d.link,f)&&(this._currentLink=d,this._currentLink.state={decorations:{underline:d.link.decorations===void 0||d.link.decorations.underline,pointerCursor:d.link.decorations===void 0||d.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,d.link,this._lastMouseEvent),d.link.decorations={},Object.defineProperties(d.link.decorations,{pointerCursor:{get:()=>this._currentLink?.state?.decorations.pointerCursor,set:p=>{this._currentLink?.state&&this._currentLink.state.decorations.pointerCursor!==p&&(this._currentLink.state.decorations.pointerCursor=p,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",p))}},underline:{get:()=>this._currentLink?.state?.decorations.underline,set:p=>{this._currentLink?.state&&this._currentLink?.state?.decorations.underline!==p&&(this._currentLink.state.decorations.underline=p,this._currentLink.state.isHovered&&this._fireUnderlineEvent(d.link,p))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange(p=>{if(!this._currentLink)return;let y=p.start===0?0:p.start+1+this._bufferService.buffer.ydisp,w=this._bufferService.buffer.ydisp+1+p.end;if(this._currentLink.link.range.start.y>=y&&this._currentLink.link.range.end.y<=w&&(this._clearCurrentLink(y,w),this._lastMouseEvent)){let b=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);b&&this._askForLink(b,!1)}})))}_linkHover(d,f,p){this._currentLink?.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(f,!0),this._currentLink.state.decorations.pointerCursor&&d.classList.add("xterm-cursor-pointer")),f.hover&&f.hover(p,f.text)}_fireUnderlineEvent(d,f){let p=d.range,y=this._bufferService.buffer.ydisp,w=this._createLinkUnderlineEvent(p.start.x-1,p.start.y-y-1,p.end.x,p.end.y-y-1,void 0);(f?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(w)}_linkLeave(d,f,p){this._currentLink?.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(f,!1),this._currentLink.state.decorations.pointerCursor&&d.classList.remove("xterm-cursor-pointer")),f.leave&&f.leave(p,f.text)}_linkAtPosition(d,f){let p=d.range.start.y*this._bufferService.cols+d.range.start.x,y=d.range.end.y*this._bufferService.cols+d.range.end.x,w=f.y*this._bufferService.cols+f.x;return p<=w&&w<=y}_positionFromMouseEvent(d,f,p){let y=p.getCoords(d,f,this._bufferService.cols,this._bufferService.rows);if(y)return{x:y[0],y:y[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(d,f,p,y,w){return{x1:d,y1:f,x2:p,y2:y,cols:this._bufferService.cols,fg:w}}};t.Linkifier=o=h([g(1,u.IMouseService),g(2,u.IRenderService),g(3,v.IBufferService),g(4,u.ILinkProviderService)],o)},9042:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.tooMuchOutput=t.promptLabel=void 0,t.promptLabel="Terminal input",t.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(c,t,n){var h=this&&this.__decorate||function(u,o,d,f){var p,y=arguments.length,w=y<3?o:f===null?f=Object.getOwnPropertyDescriptor(o,d):f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(u,o,d,f);else for(var b=u.length-1;b>=0;b--)(p=u[b])&&(w=(y<3?p(w):y>3?p(o,d,w):p(o,d))||w);return y>3&&w&&Object.defineProperty(o,d,w),w},g=this&&this.__param||function(u,o){return function(d,f){o(d,f,u)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OscLinkProvider=void 0;let a=n(511),l=n(2585),_=t.OscLinkProvider=class{constructor(u,o,d){this._bufferService=u,this._optionsService=o,this._oscLinkService=d}provideLinks(u,o){let d=this._bufferService.buffer.lines.get(u-1);if(!d)return void o(void 0);let f=[],p=this._optionsService.rawOptions.linkHandler,y=new a.CellData,w=d.getTrimmedLength(),b=-1,S=-1,A=!1;for(let C=0;C<w;C++)if(S!==-1||d.hasContent(C)){if(d.loadCell(C,y),y.hasExtendedAttrs()&&y.extended.urlId){if(S===-1){S=C,b=y.extended.urlId;continue}A=y.extended.urlId!==b}else S!==-1&&(A=!0);if(A||S!==-1&&C===w-1){let D=this._oscLinkService.getLinkData(b)?.uri;if(D){let L={start:{x:S+1,y:u},end:{x:C+(A||C!==w-1?0:1),y:u}},B=!1;if(!p?.allowNonHttpProtocols)try{let R=new URL(D);["http:","https:"].includes(R.protocol)||(B=!0)}catch{B=!0}B||f.push({text:D,range:L,activate:(R,F)=>p?p.activate(R,F,L):v(0,F),hover:(R,F)=>p?.hover?.(R,F,L),leave:(R,F)=>p?.leave?.(R,F,L)})}A=!1,y.hasExtendedAttrs()&&y.extended.urlId?(S=C,b=y.extended.urlId):(S=-1,b=-1)}}o(f)}};function v(u,o){if(confirm(`Do you want to navigate to ${o}?

WARNING: This link could potentially be dangerous`)){let d=window.open();if(d){try{d.opener=null}catch{}d.location.href=o}else console.warn("Opening link blocked as opener could not be cleared")}}t.OscLinkProvider=_=h([g(0,l.IBufferService),g(1,l.IOptionsService),g(2,l.IOscLinkService)],_)},6193:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RenderDebouncer=void 0,t.RenderDebouncer=class{constructor(n,h){this._renderCallback=n,this._coreBrowserService=h,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(n){return this._refreshCallbacks.push(n),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(n,h,g){this._rowCount=g,n=n!==void 0?n:0,h=h!==void 0?h:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,n):n,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,h):h,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return void this._runRefreshCallbacks();let n=Math.max(this._rowStart,0),h=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(n,h),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(let n of this._refreshCallbacks)n(0);this._refreshCallbacks=[]}}},3236:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Terminal=void 0;let h=n(3614),g=n(3656),a=n(3551),l=n(9042),_=n(3730),v=n(1680),u=n(3107),o=n(5744),d=n(2950),f=n(1296),p=n(428),y=n(4269),w=n(5114),b=n(8934),S=n(3230),A=n(9312),C=n(4725),D=n(6731),L=n(8055),B=n(8969),R=n(8460),F=n(844),K=n(6114),Q=n(8437),N=n(2584),k=n(7399),m=n(5941),x=n(9074),E=n(2585),I=n(5435),M=n(4567),X=n(779);class $ extends B.CoreTerminal{get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}constructor(P={}){super(P),this.browser=K,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this.register(new F.MutableDisposable),this._onCursorMove=this.register(new R.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new R.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new R.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new R.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new R.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new R.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new R.EventEmitter),this._onBlur=this.register(new R.EventEmitter),this._onA11yCharEmitter=this.register(new R.EventEmitter),this._onA11yTabEmitter=this.register(new R.EventEmitter),this._onWillOpen=this.register(new R.EventEmitter),this._setup(),this._decorationService=this._instantiationService.createInstance(x.DecorationService),this._instantiationService.setService(E.IDecorationService,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(X.LinkProviderService),this._instantiationService.setService(C.ILinkProviderService,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(_.OscLinkProvider)),this.register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this.register(this._inputHandler.onRequestRefreshRows((T,U)=>this.refresh(T,U))),this.register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this.register(this._inputHandler.onRequestReset(()=>this.reset())),this.register(this._inputHandler.onRequestWindowsOptionsReport(T=>this._reportWindowsOptions(T))),this.register(this._inputHandler.onColor(T=>this._handleColorEvent(T))),this.register((0,R.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,R.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,R.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,R.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize(T=>this._afterResize(T.cols,T.rows))),this.register((0,F.toDisposable)(()=>{this._customKeyEventHandler=void 0,this.element?.parentNode?.removeChild(this.element)}))}_handleColorEvent(P){if(this._themeService)for(let T of P){let U,Z="";switch(T.index){case 256:U="foreground",Z="10";break;case 257:U="background",Z="11";break;case 258:U="cursor",Z="12";break;default:U="ansi",Z="4;"+T.index}switch(T.type){case 0:let te=L.color.toColorRGB(U==="ansi"?this._themeService.colors.ansi[T.index]:this._themeService.colors[U]);this.coreService.triggerDataEvent(`${N.C0.ESC}]${Z};${(0,m.toRgbString)(te)}${N.C1_ESCAPED.ST}`);break;case 1:if(U==="ansi")this._themeService.modifyColors(ee=>ee.ansi[T.index]=L.channels.toColor(...T.color));else{let ee=U;this._themeService.modifyColors(le=>le[ee]=L.channels.toColor(...T.color))}break;case 2:this._themeService.restoreColor(T.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(P){P?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(M.AccessibilityManager,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(P){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(N.C0.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){return this.textarea?.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(N.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;let P=this.buffer.ybase+this.buffer.y,T=this.buffer.lines.get(P);if(!T)return;let U=Math.min(this.buffer.x,this.cols-1),Z=this._renderService.dimensions.css.cell.height,te=T.getWidth(U),ee=this._renderService.dimensions.css.cell.width*te,le=this.buffer.y*this._renderService.dimensions.css.cell.height,be=U*this._renderService.dimensions.css.cell.width;this.textarea.style.left=be+"px",this.textarea.style.top=le+"px",this.textarea.style.width=ee+"px",this.textarea.style.height=Z+"px",this.textarea.style.lineHeight=Z+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,g.addDisposableDomListener)(this.element,"copy",T=>{this.hasSelection()&&(0,h.copyHandler)(T,this._selectionService)}));let P=T=>(0,h.handlePasteEvent)(T,this.textarea,this.coreService,this.optionsService);this.register((0,g.addDisposableDomListener)(this.textarea,"paste",P)),this.register((0,g.addDisposableDomListener)(this.element,"paste",P)),K.isFirefox?this.register((0,g.addDisposableDomListener)(this.element,"mousedown",T=>{T.button===2&&(0,h.rightClickHandler)(T,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this.register((0,g.addDisposableDomListener)(this.element,"contextmenu",T=>{(0,h.rightClickHandler)(T,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),K.isLinux&&this.register((0,g.addDisposableDomListener)(this.element,"auxclick",T=>{T.button===1&&(0,h.moveTextAreaUnderMouseCursor)(T,this.textarea,this.screenElement)}))}_bindKeys(){this.register((0,g.addDisposableDomListener)(this.textarea,"keyup",P=>this._keyUp(P),!0)),this.register((0,g.addDisposableDomListener)(this.textarea,"keydown",P=>this._keyDown(P),!0)),this.register((0,g.addDisposableDomListener)(this.textarea,"keypress",P=>this._keyPress(P),!0)),this.register((0,g.addDisposableDomListener)(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this.register((0,g.addDisposableDomListener)(this.textarea,"compositionupdate",P=>this._compositionHelper.compositionupdate(P))),this.register((0,g.addDisposableDomListener)(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this.register((0,g.addDisposableDomListener)(this.textarea,"input",P=>this._inputEvent(P),!0)),this.register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(P){if(!P)throw new Error("Terminal requires a parent element.");if(P.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this.element?.ownerDocument.defaultView&&this._coreBrowserService)return void(this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView));this._document=P.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),P.appendChild(this.element);let T=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),T.appendChild(this._viewportElement),this._viewportScrollArea=this._document.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this.register((0,g.addDisposableDomListener)(this.screenElement,"mousemove",U=>this.updateCursorStyle(U))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),T.appendChild(this.screenElement),this.textarea=this._document.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",l.promptLabel),K.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this.register(this._instantiationService.createInstance(w.CoreBrowserService,this.textarea,P.ownerDocument.defaultView??window,this._document??typeof window<"u"?window.document:null)),this._instantiationService.setService(C.ICoreBrowserService,this._coreBrowserService),this.register((0,g.addDisposableDomListener)(this.textarea,"focus",U=>this._handleTextAreaFocus(U))),this.register((0,g.addDisposableDomListener)(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(p.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(C.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(D.ThemeService),this._instantiationService.setService(C.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(y.CharacterJoinerService),this._instantiationService.setService(C.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(S.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(C.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange(U=>this._onRender.fire(U))),this.onResize(U=>this._renderService.resize(U.cols,U.rows)),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(d.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(b.MouseService),this._instantiationService.setService(C.IMouseService,this._mouseService),this.linkifier=this.register(this._instantiationService.createInstance(a.Linkifier,this.screenElement)),this.element.appendChild(T);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this.viewport=this._instantiationService.createInstance(v.Viewport,this._viewportElement,this._viewportScrollArea),this.viewport.onRequestScrollLines(U=>this.scrollLines(U.amount,U.suppressScrollEvent,1)),this.register(this._inputHandler.onRequestSyncScrollBar(()=>this.viewport.syncScrollArea())),this.register(this.viewport),this.register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this.register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this.register(this.onBlur(()=>this._renderService.handleBlur())),this.register(this.onFocus(()=>this._renderService.handleFocus())),this.register(this._renderService.onDimensionsChange(()=>this.viewport.syncScrollArea())),this._selectionService=this.register(this._instantiationService.createInstance(A.SelectionService,this.element,this.screenElement,this.linkifier)),this._instantiationService.setService(C.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines(U=>this.scrollLines(U.amount,U.suppressScrollEvent))),this.register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this.register(this._selectionService.onRequestRedraw(U=>this._renderService.handleSelectionChanged(U.start,U.end,U.columnSelectMode))),this.register(this._selectionService.onLinuxMouseSelection(U=>{this.textarea.value=U,this.textarea.focus(),this.textarea.select()})),this.register(this._onScroll.event(U=>{this.viewport.syncScrollArea(),this._selectionService.refresh()})),this.register((0,g.addDisposableDomListener)(this._viewportElement,"scroll",()=>this._selectionService.refresh())),this.register(this._instantiationService.createInstance(u.BufferDecorationRenderer,this.screenElement)),this.register((0,g.addDisposableDomListener)(this.element,"mousedown",U=>this._selectionService.handleMouseDown(U))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(M.AccessibilityManager,this)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",U=>this._handleScreenReaderModeOptionChange(U))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(o.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",U=>{!this._overviewRulerRenderer&&U&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(o.OverviewRulerRenderer,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(f.DomRenderer,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){let P=this,T=this.element;function U(ee){let le=P._mouseService.getMouseReportCoords(ee,P.screenElement);if(!le)return!1;let be,ye;switch(ee.overrideType||ee.type){case"mousemove":ye=32,ee.buttons===void 0?(be=3,ee.button!==void 0&&(be=ee.button<3?ee.button:3)):be=1&ee.buttons?0:4&ee.buttons?1:2&ee.buttons?2:3;break;case"mouseup":ye=0,be=ee.button<3?ee.button:3;break;case"mousedown":ye=1,be=ee.button<3?ee.button:3;break;case"wheel":if(P._customWheelEventHandler&&P._customWheelEventHandler(ee)===!1||P.viewport.getLinesScrolled(ee)===0)return!1;ye=ee.deltaY<0?0:1,be=4;break;default:return!1}return!(ye===void 0||be===void 0||be>4)&&P.coreMouseService.triggerMouseEvent({col:le.col,row:le.row,x:le.x,y:le.y,button:be,action:ye,ctrl:ee.ctrlKey,alt:ee.altKey,shift:ee.shiftKey})}let Z={mouseup:null,wheel:null,mousedrag:null,mousemove:null},te={mouseup:ee=>(U(ee),ee.buttons||(this._document.removeEventListener("mouseup",Z.mouseup),Z.mousedrag&&this._document.removeEventListener("mousemove",Z.mousedrag)),this.cancel(ee)),wheel:ee=>(U(ee),this.cancel(ee,!0)),mousedrag:ee=>{ee.buttons&&U(ee)},mousemove:ee=>{ee.buttons||U(ee)}};this.register(this.coreMouseService.onProtocolChange(ee=>{ee?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(ee)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&ee?Z.mousemove||(T.addEventListener("mousemove",te.mousemove),Z.mousemove=te.mousemove):(T.removeEventListener("mousemove",Z.mousemove),Z.mousemove=null),16&ee?Z.wheel||(T.addEventListener("wheel",te.wheel,{passive:!1}),Z.wheel=te.wheel):(T.removeEventListener("wheel",Z.wheel),Z.wheel=null),2&ee?Z.mouseup||(Z.mouseup=te.mouseup):(this._document.removeEventListener("mouseup",Z.mouseup),Z.mouseup=null),4&ee?Z.mousedrag||(Z.mousedrag=te.mousedrag):(this._document.removeEventListener("mousemove",Z.mousedrag),Z.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,g.addDisposableDomListener)(T,"mousedown",ee=>{if(ee.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(ee))return U(ee),Z.mouseup&&this._document.addEventListener("mouseup",Z.mouseup),Z.mousedrag&&this._document.addEventListener("mousemove",Z.mousedrag),this.cancel(ee)})),this.register((0,g.addDisposableDomListener)(T,"wheel",ee=>{if(!Z.wheel){if(this._customWheelEventHandler&&this._customWheelEventHandler(ee)===!1)return!1;if(!this.buffer.hasScrollback){let le=this.viewport.getLinesScrolled(ee);if(le===0)return;let be=N.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(ee.deltaY<0?"A":"B"),ye="";for(let he=0;he<Math.abs(le);he++)ye+=be;return this.coreService.triggerDataEvent(ye,!0),this.cancel(ee,!0)}return this.viewport.handleWheel(ee)?this.cancel(ee):void 0}},{passive:!1})),this.register((0,g.addDisposableDomListener)(T,"touchstart",ee=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(ee),this.cancel(ee)},{passive:!0})),this.register((0,g.addDisposableDomListener)(T,"touchmove",ee=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(ee)?void 0:this.cancel(ee)},{passive:!1}))}refresh(P,T){this._renderService?.refreshRows(P,T)}updateCursorStyle(P){this._selectionService?.shouldColumnSelect(P)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(P,T,U=0){U===1?(super.scrollLines(P,T,U),this.refresh(0,this.rows-1)):this.viewport?.scrollLines(P)}paste(P){(0,h.paste)(P,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(P){this._customKeyEventHandler=P}attachCustomWheelEventHandler(P){this._customWheelEventHandler=P}registerLinkProvider(P){return this._linkProviderService.registerLinkProvider(P)}registerCharacterJoiner(P){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");let T=this._characterJoinerService.register(P);return this.refresh(0,this.rows-1),T}deregisterCharacterJoiner(P){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(P)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(P){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+P)}registerDecoration(P){return this._decorationService.registerDecoration(P)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(P,T,U){this._selectionService.setSelection(P,T,U)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){this._selectionService?.clearSelection()}selectAll(){this._selectionService?.selectAll()}selectLines(P,T){this._selectionService?.selectLines(P,T)}_keyDown(P){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(P)===!1)return!1;let T=this.browser.isMac&&this.options.macOptionIsMeta&&P.altKey;if(!T&&!this._compositionHelper.keydown(P))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(),!1;T||P.key!=="Dead"&&P.key!=="AltGraph"||(this._unprocessedDeadKey=!0);let U=(0,k.evaluateKeyboardEvent)(P,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(P),U.type===3||U.type===2){let Z=this.rows-1;return this.scrollLines(U.type===2?-Z:Z),this.cancel(P,!0)}return U.type===1&&this.selectAll(),!!this._isThirdLevelShift(this.browser,P)||(U.cancel&&this.cancel(P,!0),!U.key||!!(P.key&&!P.ctrlKey&&!P.altKey&&!P.metaKey&&P.key.length===1&&P.key.charCodeAt(0)>=65&&P.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(U.key!==N.C0.ETX&&U.key!==N.C0.CR||(this.textarea.value=""),this._onKey.fire({key:U.key,domEvent:P}),this._showCursor(),this.coreService.triggerDataEvent(U.key,!0),!this.optionsService.rawOptions.screenReaderMode||P.altKey||P.ctrlKey?this.cancel(P,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(P,T){let U=P.isMac&&!this.options.macOptionIsMeta&&T.altKey&&!T.ctrlKey&&!T.metaKey||P.isWindows&&T.altKey&&T.ctrlKey&&!T.metaKey||P.isWindows&&T.getModifierState("AltGraph");return T.type==="keypress"?U:U&&(!T.keyCode||T.keyCode>47)}_keyUp(P){this._keyDownSeen=!1,this._customKeyEventHandler&&this._customKeyEventHandler(P)===!1||(function(T){return T.keyCode===16||T.keyCode===17||T.keyCode===18}(P)||this.focus(),this.updateCursorStyle(P),this._keyPressHandled=!1)}_keyPress(P){let T;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(P)===!1)return!1;if(this.cancel(P),P.charCode)T=P.charCode;else if(P.which===null||P.which===void 0)T=P.keyCode;else{if(P.which===0||P.charCode===0)return!1;T=P.which}return!(!T||(P.altKey||P.ctrlKey||P.metaKey)&&!this._isThirdLevelShift(this.browser,P)||(T=String.fromCharCode(T),this._onKey.fire({key:T,domEvent:P}),this._showCursor(),this.coreService.triggerDataEvent(T,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(P){if(P.data&&P.inputType==="insertText"&&(!P.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;let T=P.data;return this.coreService.triggerDataEvent(T,!0),this.cancel(P),!0}return!1}resize(P,T){P!==this.cols||T!==this.rows?super.resize(P,T):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(P,T){this._charSizeService?.measure(),this.viewport?.syncScrollArea(!0)}clear(){if(this.buffer.ybase!==0||this.buffer.y!==0){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let P=1;P<this.rows;P++)this.buffer.lines.push(this.buffer.getBlankLine(Q.DEFAULT_ATTR_DATA));this._onScroll.fire({position:this.buffer.ydisp,source:0}),this.viewport?.reset(),this.refresh(0,this.rows-1)}}reset(){this.options.rows=this.rows,this.options.cols=this.cols;let P=this._customKeyEventHandler;this._setup(),super.reset(),this._selectionService?.reset(),this._decorationService.reset(),this.viewport?.reset(),this._customKeyEventHandler=P,this.refresh(0,this.rows-1)}clearTextureAtlas(){this._renderService?.clearTextureAtlas()}_reportFocus(){this.element?.classList.contains("focus")?this.coreService.triggerDataEvent(N.C0.ESC+"[I"):this.coreService.triggerDataEvent(N.C0.ESC+"[O")}_reportWindowsOptions(P){if(this._renderService)switch(P){case I.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:let T=this._renderService.dimensions.css.canvas.width.toFixed(0),U=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${N.C0.ESC}[4;${U};${T}t`);break;case I.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:let Z=this._renderService.dimensions.css.cell.width.toFixed(0),te=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${N.C0.ESC}[6;${te};${Z}t`)}}cancel(P,T){if(this.options.cancelEvents||T)return P.preventDefault(),P.stopPropagation(),!1}}t.Terminal=$},9924:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TimeBasedDebouncer=void 0,t.TimeBasedDebouncer=class{constructor(n,h=1e3){this._renderCallback=n,this._debounceThresholdMS=h,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(n,h,g){this._rowCount=g,n=n!==void 0?n:0,h=h!==void 0?h:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,n):n,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,h):h;let a=Date.now();if(a-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=a,this._innerRefresh();else if(!this._additionalRefreshRequested){let l=a-this._lastRefreshMs,_=this._debounceThresholdMS-l;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},_)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;let n=Math.max(this._rowStart,0),h=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(n,h)}}},1680:function(c,t,n){var h=this&&this.__decorate||function(d,f,p,y){var w,b=arguments.length,S=b<3?f:y===null?y=Object.getOwnPropertyDescriptor(f,p):y;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(d,f,p,y);else for(var A=d.length-1;A>=0;A--)(w=d[A])&&(S=(b<3?w(S):b>3?w(f,p,S):w(f,p))||S);return b>3&&S&&Object.defineProperty(f,p,S),S},g=this&&this.__param||function(d,f){return function(p,y){f(p,y,d)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Viewport=void 0;let a=n(3656),l=n(4725),_=n(8460),v=n(844),u=n(2585),o=t.Viewport=class extends v.Disposable{constructor(d,f,p,y,w,b,S,A){super(),this._viewportElement=d,this._scrollArea=f,this._bufferService=p,this._optionsService=y,this._charSizeService=w,this._renderService=b,this._coreBrowserService=S,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this._onRequestScrollLines=this.register(new _.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,a.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(C=>this._activeBuffer=C.activeBuffer)),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange(C=>this._renderDimensions=C)),this._handleThemeChange(A.colors),this.register(A.onChangeColors(C=>this._handleThemeChange(C))),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.syncScrollArea())),setTimeout(()=>this.syncScrollArea())}_handleThemeChange(d){this._viewportElement.style.backgroundColor=d.background.css}reset(){this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._coreBrowserService.window.requestAnimationFrame(()=>this.syncScrollArea())}_refresh(d){if(d)return this._innerRefresh(),void(this._refreshAnimationFrame!==null&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));this._refreshAnimationFrame===null&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderDimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderDimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;let f=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderDimensions.css.canvas.height);this._lastRecordedBufferHeight!==f&&(this._lastRecordedBufferHeight=f,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}let d=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==d&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=d),this._refreshAnimationFrame=null}syncScrollArea(d=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(d);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(d)}_handleScroll(d){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._onRequestScrollLines.fire({amount:0,suppressScrollEvent:!0});let f=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._onRequestScrollLines.fire({amount:f,suppressScrollEvent:!0})}_smoothScroll(){if(this._isDisposed||this._smoothScrollState.origin===-1||this._smoothScrollState.target===-1)return;let d=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(d*(this._smoothScrollState.target-this._smoothScrollState.origin)),d<1?this._coreBrowserService.window.requestAnimationFrame(()=>this._smoothScroll()):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(d,f){let p=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(f<0&&this._viewportElement.scrollTop!==0||f>0&&p<this._lastRecordedBufferHeight)||(d.cancelable&&d.preventDefault(),!1)}handleWheel(d){let f=this._getPixelsScrolled(d);return f!==0&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target===-1?this._smoothScrollState.target=this._viewportElement.scrollTop+f:this._smoothScrollState.target+=f,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=f,this._bubbleScroll(d,f))}scrollLines(d){if(d!==0)if(this._optionsService.rawOptions.smoothScrollDuration){let f=d*this._currentRowHeight;this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target=this._smoothScrollState.origin+f,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()}else this._onRequestScrollLines.fire({amount:d,suppressScrollEvent:!1})}_getPixelsScrolled(d){if(d.deltaY===0||d.shiftKey)return 0;let f=this._applyScrollModifier(d.deltaY,d);return d.deltaMode===WheelEvent.DOM_DELTA_LINE?f*=this._currentRowHeight:d.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(f*=this._currentRowHeight*this._bufferService.rows),f}getBufferElements(d,f){let p,y="",w=[],b=f??this._bufferService.buffer.lines.length,S=this._bufferService.buffer.lines;for(let A=d;A<b;A++){let C=S.get(A);if(!C)continue;let D=S.get(A+1)?.isWrapped;if(y+=C.translateToString(!D),!D||A===S.length-1){let L=document.createElement("div");L.textContent=y,w.push(L),y.length>0&&(p=L),y=""}}return{bufferElements:w,cursorElement:p}}getLinesScrolled(d){if(d.deltaY===0||d.shiftKey)return 0;let f=this._applyScrollModifier(d.deltaY,d);return d.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(f/=this._currentRowHeight+0,this._wheelPartialScroll+=f,f=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):d.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(f*=this._bufferService.rows),f}_applyScrollModifier(d,f){let p=this._optionsService.rawOptions.fastScrollModifier;return p==="alt"&&f.altKey||p==="ctrl"&&f.ctrlKey||p==="shift"&&f.shiftKey?d*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:d*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(d){this._lastTouchY=d.touches[0].pageY}handleTouchMove(d){let f=this._lastTouchY-d.touches[0].pageY;return this._lastTouchY=d.touches[0].pageY,f!==0&&(this._viewportElement.scrollTop+=f,this._bubbleScroll(d,f))}};t.Viewport=o=h([g(2,u.IBufferService),g(3,u.IOptionsService),g(4,l.ICharSizeService),g(5,l.IRenderService),g(6,l.ICoreBrowserService),g(7,l.IThemeService)],o)},3107:function(c,t,n){var h=this&&this.__decorate||function(u,o,d,f){var p,y=arguments.length,w=y<3?o:f===null?f=Object.getOwnPropertyDescriptor(o,d):f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(u,o,d,f);else for(var b=u.length-1;b>=0;b--)(p=u[b])&&(w=(y<3?p(w):y>3?p(o,d,w):p(o,d))||w);return y>3&&w&&Object.defineProperty(o,d,w),w},g=this&&this.__param||function(u,o){return function(d,f){o(d,f,u)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferDecorationRenderer=void 0;let a=n(4725),l=n(844),_=n(2585),v=t.BufferDecorationRenderer=class extends l.Disposable{constructor(u,o,d,f,p){super(),this._screenElement=u,this._bufferService=o,this._coreBrowserService=d,this._decorationService=f,this._renderService=p,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this.register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this.register(this._coreBrowserService.onDprChange(()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this.register(this._decorationService.onDecorationRemoved(y=>this._removeDecoration(y))),this.register((0,l.toDisposable)(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(let u of this._decorationService.decorations)this._renderDecoration(u);this._dimensionsChanged=!1}_renderDecoration(u){this._refreshStyle(u),this._dimensionsChanged&&this._refreshXPosition(u)}_createElement(u){let o=this._coreBrowserService.mainDocument.createElement("div");o.classList.add("xterm-decoration"),o.classList.toggle("xterm-decoration-top-layer",u?.options?.layer==="top"),o.style.width=`${Math.round((u.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,o.style.height=(u.options.height||1)*this._renderService.dimensions.css.cell.height+"px",o.style.top=(u.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",o.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;let d=u.options.x??0;return d&&d>this._bufferService.cols&&(o.style.display="none"),this._refreshXPosition(u,o),o}_refreshStyle(u){let o=u.marker.line-this._bufferService.buffers.active.ydisp;if(o<0||o>=this._bufferService.rows)u.element&&(u.element.style.display="none",u.onRenderEmitter.fire(u.element));else{let d=this._decorationElements.get(u);d||(d=this._createElement(u),u.element=d,this._decorationElements.set(u,d),this._container.appendChild(d),u.onDispose(()=>{this._decorationElements.delete(u),d.remove()})),d.style.top=o*this._renderService.dimensions.css.cell.height+"px",d.style.display=this._altBufferIsActive?"none":"block",u.onRenderEmitter.fire(d)}}_refreshXPosition(u,o=u.element){if(!o)return;let d=u.options.x??0;(u.options.anchor||"left")==="right"?o.style.right=d?d*this._renderService.dimensions.css.cell.width+"px":"":o.style.left=d?d*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(u){this._decorationElements.get(u)?.remove(),this._decorationElements.delete(u),u.dispose()}};t.BufferDecorationRenderer=v=h([g(1,_.IBufferService),g(2,a.ICoreBrowserService),g(3,_.IDecorationService),g(4,a.IRenderService)],v)},5871:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ColorZoneStore=void 0,t.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(n){if(n.options.overviewRulerOptions){for(let h of this._zones)if(h.color===n.options.overviewRulerOptions.color&&h.position===n.options.overviewRulerOptions.position){if(this._lineIntersectsZone(h,n.marker.line))return;if(this._lineAdjacentToZone(h,n.marker.line,n.options.overviewRulerOptions.position))return void this._addLineToZone(h,n.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=n.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=n.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=n.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=n.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:n.options.overviewRulerOptions.color,position:n.options.overviewRulerOptions.position,startBufferLine:n.marker.line,endBufferLine:n.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(n){this._linePadding=n}_lineIntersectsZone(n,h){return h>=n.startBufferLine&&h<=n.endBufferLine}_lineAdjacentToZone(n,h,g){return h>=n.startBufferLine-this._linePadding[g||"full"]&&h<=n.endBufferLine+this._linePadding[g||"full"]}_addLineToZone(n,h){n.startBufferLine=Math.min(n.startBufferLine,h),n.endBufferLine=Math.max(n.endBufferLine,h)}}},5744:function(c,t,n){var h=this&&this.__decorate||function(p,y,w,b){var S,A=arguments.length,C=A<3?y:b===null?b=Object.getOwnPropertyDescriptor(y,w):b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(p,y,w,b);else for(var D=p.length-1;D>=0;D--)(S=p[D])&&(C=(A<3?S(C):A>3?S(y,w,C):S(y,w))||C);return A>3&&C&&Object.defineProperty(y,w,C),C},g=this&&this.__param||function(p,y){return function(w,b){y(w,b,p)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OverviewRulerRenderer=void 0;let a=n(5871),l=n(4725),_=n(844),v=n(2585),u={full:0,left:0,center:0,right:0},o={full:0,left:0,center:0,right:0},d={full:0,left:0,center:0,right:0},f=t.OverviewRulerRenderer=class extends _.Disposable{get _width(){return this._optionsService.options.overviewRulerWidth||0}constructor(p,y,w,b,S,A,C){super(),this._viewportElement=p,this._screenElement=y,this._bufferService=w,this._decorationService=b,this._renderService=S,this._optionsService=A,this._coreBrowserService=C,this._colorZoneStore=new a.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),this._viewportElement.parentElement?.insertBefore(this._canvas,this._viewportElement);let D=this._canvas.getContext("2d");if(!D)throw new Error("Ctx cannot be null");this._ctx=D,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,_.toDisposable)(()=>{this._canvas?.remove()}))}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this.register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0)))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this.register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())}))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender(()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",()=>this._queueRefresh(!0))),this.register(this._coreBrowserService.onDprChange(()=>this._queueRefresh(!0))),this._queueRefresh(!0)}_refreshDrawConstants(){let p=Math.floor(this._canvas.width/3),y=Math.ceil(this._canvas.width/3);o.full=this._canvas.width,o.left=p,o.center=y,o.right=p,this._refreshDrawHeightConstants(),d.full=0,d.left=0,d.center=o.left,d.right=o.left+o.center}_refreshDrawHeightConstants(){u.full=Math.round(2*this._coreBrowserService.dpr);let p=this._canvas.height/this._bufferService.buffer.lines.length,y=Math.round(Math.max(Math.min(p,12),6)*this._coreBrowserService.dpr);u.left=y,u.center=y,u.right=y}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*u.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*u.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*u.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*u.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(let y of this._decorationService.decorations)this._colorZoneStore.addDecoration(y);this._ctx.lineWidth=1;let p=this._colorZoneStore.zones;for(let y of p)y.position!=="full"&&this._renderColorZone(y);for(let y of p)y.position==="full"&&this._renderColorZone(y);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(p){this._ctx.fillStyle=p.color,this._ctx.fillRect(d[p.position||"full"],Math.round((this._canvas.height-1)*(p.startBufferLine/this._bufferService.buffers.active.lines.length)-u[p.position||"full"]/2),o[p.position||"full"],Math.round((this._canvas.height-1)*((p.endBufferLine-p.startBufferLine)/this._bufferService.buffers.active.lines.length)+u[p.position||"full"]))}_queueRefresh(p,y){this._shouldUpdateDimensions=p||this._shouldUpdateDimensions,this._shouldUpdateAnchor=y||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};t.OverviewRulerRenderer=f=h([g(2,v.IBufferService),g(3,v.IDecorationService),g(4,l.IRenderService),g(5,v.IOptionsService),g(6,l.ICoreBrowserService)],f)},2950:function(c,t,n){var h=this&&this.__decorate||function(u,o,d,f){var p,y=arguments.length,w=y<3?o:f===null?f=Object.getOwnPropertyDescriptor(o,d):f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(u,o,d,f);else for(var b=u.length-1;b>=0;b--)(p=u[b])&&(w=(y<3?p(w):y>3?p(o,d,w):p(o,d))||w);return y>3&&w&&Object.defineProperty(o,d,w),w},g=this&&this.__param||function(u,o){return function(d,f){o(d,f,u)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CompositionHelper=void 0;let a=n(4725),l=n(2585),_=n(2584),v=t.CompositionHelper=class{get isComposing(){return this._isComposing}constructor(u,o,d,f,p,y){this._textarea=u,this._compositionView=o,this._bufferService=d,this._optionsService=f,this._coreService=p,this._renderService=y,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(u){this._compositionView.textContent=u.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown(u){if(this._isComposing||this._isSendingComposition){if(u.keyCode===229||u.keyCode===16||u.keyCode===17||u.keyCode===18)return!1;this._finalizeComposition(!1)}return u.keyCode!==229||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(u){if(this._compositionView.classList.remove("active"),this._isComposing=!1,u){let o={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){let d;this._isSendingComposition=!1,o.start+=this._dataAlreadySent.length,d=this._isComposing?this._textarea.value.substring(o.start,o.end):this._textarea.value.substring(o.start),d.length>0&&this._coreService.triggerDataEvent(d,!0)}},0)}else{this._isSendingComposition=!1;let o=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(o,!0)}}_handleAnyTextareaChanges(){let u=this._textarea.value;setTimeout(()=>{if(!this._isComposing){let o=this._textarea.value,d=o.replace(u,"");this._dataAlreadySent=d,o.length>u.length?this._coreService.triggerDataEvent(d,!0):o.length<u.length?this._coreService.triggerDataEvent(`${_.C0.DEL}`,!0):o.length===u.length&&o!==u&&this._coreService.triggerDataEvent(o,!0)}},0)}updateCompositionElements(u){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){let o=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),d=this._renderService.dimensions.css.cell.height,f=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,p=o*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=p+"px",this._compositionView.style.top=f+"px",this._compositionView.style.height=d+"px",this._compositionView.style.lineHeight=d+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";let y=this._compositionView.getBoundingClientRect();this._textarea.style.left=p+"px",this._textarea.style.top=f+"px",this._textarea.style.width=Math.max(y.width,1)+"px",this._textarea.style.height=Math.max(y.height,1)+"px",this._textarea.style.lineHeight=y.height+"px"}u||setTimeout(()=>this.updateCompositionElements(!0),0)}}};t.CompositionHelper=v=h([g(2,l.IBufferService),g(3,l.IOptionsService),g(4,l.ICoreService),g(5,a.IRenderService)],v)},9806:(c,t)=>{function n(h,g,a){let l=a.getBoundingClientRect(),_=h.getComputedStyle(a),v=parseInt(_.getPropertyValue("padding-left")),u=parseInt(_.getPropertyValue("padding-top"));return[g.clientX-l.left-v,g.clientY-l.top-u]}Object.defineProperty(t,"__esModule",{value:!0}),t.getCoords=t.getCoordsRelativeToElement=void 0,t.getCoordsRelativeToElement=n,t.getCoords=function(h,g,a,l,_,v,u,o,d){if(!v)return;let f=n(h,g,a);return f?(f[0]=Math.ceil((f[0]+(d?u/2:0))/u),f[1]=Math.ceil(f[1]/o),f[0]=Math.min(Math.max(f[0],1),l+(d?1:0)),f[1]=Math.min(Math.max(f[1],1),_),f):void 0}},9504:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.moveToCellSequence=void 0;let h=n(2584);function g(o,d,f,p){let y=o-a(o,f),w=d-a(d,f),b=Math.abs(y-w)-function(S,A,C){let D=0,L=S-a(S,C),B=A-a(A,C);for(let R=0;R<Math.abs(L-B);R++){let F=l(S,A)==="A"?-1:1;C.buffer.lines.get(L+F*R)?.isWrapped&&D++}return D}(o,d,f);return u(b,v(l(o,d),p))}function a(o,d){let f=0,p=d.buffer.lines.get(o),y=p?.isWrapped;for(;y&&o>=0&&o<d.rows;)f++,p=d.buffer.lines.get(--o),y=p?.isWrapped;return f}function l(o,d){return o>d?"A":"B"}function _(o,d,f,p,y,w){let b=o,S=d,A="";for(;b!==f||S!==p;)b+=y?1:-1,y&&b>w.cols-1?(A+=w.buffer.translateBufferLineToString(S,!1,o,b),b=0,o=0,S++):!y&&b<0&&(A+=w.buffer.translateBufferLineToString(S,!1,0,o+1),b=w.cols-1,o=b,S--);return A+w.buffer.translateBufferLineToString(S,!1,o,b)}function v(o,d){let f=d?"O":"[";return h.C0.ESC+f+o}function u(o,d){o=Math.floor(o);let f="";for(let p=0;p<o;p++)f+=d;return f}t.moveToCellSequence=function(o,d,f,p){let y=f.buffer.x,w=f.buffer.y;if(!f.buffer.hasScrollback)return function(A,C,D,L,B,R){return g(C,L,B,R).length===0?"":u(_(A,C,A,C-a(C,B),!1,B).length,v("D",R))}(y,w,0,d,f,p)+g(w,d,f,p)+function(A,C,D,L,B,R){let F;F=g(C,L,B,R).length>0?L-a(L,B):C;let K=L,Q=function(N,k,m,x,E,I){let M;return M=g(m,x,E,I).length>0?x-a(x,E):k,N<m&&M<=x||N>=m&&M<x?"C":"D"}(A,C,D,L,B,R);return u(_(A,F,D,K,Q==="C",B).length,v(Q,R))}(y,w,o,d,f,p);let b;if(w===d)return b=y>o?"D":"C",u(Math.abs(y-o),v(b,p));b=w>d?"D":"C";let S=Math.abs(w-d);return u(function(A,C){return C.cols-A}(w>d?o:y,f)+(S-1)*f.cols+1+((w>d?y:o)-1),v(b,p))}},1296:function(c,t,n){var h=this&&this.__decorate||function(R,F,K,Q){var N,k=arguments.length,m=k<3?F:Q===null?Q=Object.getOwnPropertyDescriptor(F,K):Q;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(R,F,K,Q);else for(var x=R.length-1;x>=0;x--)(N=R[x])&&(m=(k<3?N(m):k>3?N(F,K,m):N(F,K))||m);return k>3&&m&&Object.defineProperty(F,K,m),m},g=this&&this.__param||function(R,F){return function(K,Q){F(K,Q,R)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DomRenderer=void 0;let a=n(3787),l=n(2550),_=n(2223),v=n(6171),u=n(6052),o=n(4725),d=n(8055),f=n(8460),p=n(844),y=n(2585),w="xterm-dom-renderer-owner-",b="xterm-rows",S="xterm-fg-",A="xterm-bg-",C="xterm-focus",D="xterm-selection",L=1,B=t.DomRenderer=class extends p.Disposable{constructor(R,F,K,Q,N,k,m,x,E,I,M,X,$){super(),this._terminal=R,this._document=F,this._element=K,this._screenElement=Q,this._viewportElement=N,this._helperContainer=k,this._linkifier2=m,this._charSizeService=E,this._optionsService=I,this._bufferService=M,this._coreBrowserService=X,this._themeService=$,this._terminalClass=L++,this._rowElements=[],this._selectionRenderModel=(0,u.createSelectionRenderModel)(),this.onRequestRedraw=this.register(new f.EventEmitter).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(b),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add(D),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,v.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._themeService.onChangeColors(W=>this._injectCss(W))),this._injectCss(this._themeService.colors),this._rowFactory=x.createInstance(a.DomRendererRowFactory,document),this._element.classList.add(w+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline(W=>this._handleLinkHover(W))),this.register(this._linkifier2.onHideLinkUnderline(W=>this._handleLinkLeave(W))),this.register((0,p.toDisposable)(()=>{this._element.classList.remove(w+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()})),this._widthCache=new l.WidthCache(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){let R=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*R,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*R),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/R),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/R),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(let K of this._rowElements)K.style.width=`${this.dimensions.css.canvas.width}px`,K.style.height=`${this.dimensions.css.cell.height}px`,K.style.lineHeight=`${this.dimensions.css.cell.height}px`,K.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));let F=`${this._terminalSelector} .${b} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=F,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(R){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let F=`${this._terminalSelector} .${b} { color: ${R.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;F+=`${this._terminalSelector} .${b} .xterm-dim { color: ${d.color.multiplyOpacity(R.foreground,.5).css};}`,F+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;let K=`blink_underline_${this._terminalClass}`,Q=`blink_bar_${this._terminalClass}`,N=`blink_block_${this._terminalClass}`;F+=`@keyframes ${K} { 50% {  border-bottom-style: hidden; }}`,F+=`@keyframes ${Q} { 50% {  box-shadow: none; }}`,F+=`@keyframes ${N} { 0% {  background-color: ${R.cursor.css};  color: ${R.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${R.cursor.css}; }}`,F+=`${this._terminalSelector} .${b}.${C} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${K} 1s step-end infinite;}${this._terminalSelector} .${b}.${C} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${Q} 1s step-end infinite;}${this._terminalSelector} .${b}.${C} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${N} 1s step-end infinite;}${this._terminalSelector} .${b} .xterm-cursor.xterm-cursor-block { background-color: ${R.cursor.css}; color: ${R.cursorAccent.css};}${this._terminalSelector} .${b} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${R.cursor.css} !important; color: ${R.cursorAccent.css} !important;}${this._terminalSelector} .${b} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${R.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${b} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${R.cursor.css} inset;}${this._terminalSelector} .${b} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${R.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,F+=`${this._terminalSelector} .${D} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${D} div { position: absolute; background-color: ${R.selectionBackgroundOpaque.css};}${this._terminalSelector} .${D} div { position: absolute; background-color: ${R.selectionInactiveBackgroundOpaque.css};}`;for(let[k,m]of R.ansi.entries())F+=`${this._terminalSelector} .${S}${k} { color: ${m.css}; }${this._terminalSelector} .${S}${k}.xterm-dim { color: ${d.color.multiplyOpacity(m,.5).css}; }${this._terminalSelector} .${A}${k} { background-color: ${m.css}; }`;F+=`${this._terminalSelector} .${S}${_.INVERTED_DEFAULT_COLOR} { color: ${d.color.opaque(R.background).css}; }${this._terminalSelector} .${S}${_.INVERTED_DEFAULT_COLOR}.xterm-dim { color: ${d.color.multiplyOpacity(d.color.opaque(R.background),.5).css}; }${this._terminalSelector} .${A}${_.INVERTED_DEFAULT_COLOR} { background-color: ${R.foreground.css}; }`,this._themeStyleElement.textContent=F}_setDefaultSpacing(){let R=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${R}px`,this._rowFactory.defaultSpacing=R}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(R,F){for(let K=this._rowElements.length;K<=F;K++){let Q=this._document.createElement("div");this._rowContainer.appendChild(Q),this._rowElements.push(Q)}for(;this._rowElements.length>F;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(R,F){this._refreshRowElements(R,F),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(C),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(C),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(R,F,K){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(R,F,K),this.renderRows(0,this._bufferService.rows-1),!R||!F)return;this._selectionRenderModel.update(this._terminal,R,F,K);let Q=this._selectionRenderModel.viewportStartRow,N=this._selectionRenderModel.viewportEndRow,k=this._selectionRenderModel.viewportCappedStartRow,m=this._selectionRenderModel.viewportCappedEndRow;if(k>=this._bufferService.rows||m<0)return;let x=this._document.createDocumentFragment();if(K){let E=R[0]>F[0];x.appendChild(this._createSelectionElement(k,E?F[0]:R[0],E?R[0]:F[0],m-k+1))}else{let E=Q===k?R[0]:0,I=k===N?F[0]:this._bufferService.cols;x.appendChild(this._createSelectionElement(k,E,I));let M=m-k-1;if(x.appendChild(this._createSelectionElement(k+1,0,this._bufferService.cols,M)),k!==m){let X=N===m?F[0]:this._bufferService.cols;x.appendChild(this._createSelectionElement(m,0,X))}}this._selectionContainer.appendChild(x)}_createSelectionElement(R,F,K,Q=1){let N=this._document.createElement("div"),k=F*this.dimensions.css.cell.width,m=this.dimensions.css.cell.width*(K-F);return k+m>this.dimensions.css.canvas.width&&(m=this.dimensions.css.canvas.width-k),N.style.height=Q*this.dimensions.css.cell.height+"px",N.style.top=R*this.dimensions.css.cell.height+"px",N.style.left=`${k}px`,N.style.width=`${m}px`,N}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(let R of this._rowElements)R.replaceChildren()}renderRows(R,F){let K=this._bufferService.buffer,Q=K.ybase+K.y,N=Math.min(K.x,this._bufferService.cols-1),k=this._optionsService.rawOptions.cursorBlink,m=this._optionsService.rawOptions.cursorStyle,x=this._optionsService.rawOptions.cursorInactiveStyle;for(let E=R;E<=F;E++){let I=E+K.ydisp,M=this._rowElements[E],X=K.lines.get(I);if(!M||!X)break;M.replaceChildren(...this._rowFactory.createRow(X,I,I===Q,m,x,N,k,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${w}${this._terminalClass}`}_handleLinkHover(R){this._setCellUnderline(R.x1,R.x2,R.y1,R.y2,R.cols,!0)}_handleLinkLeave(R){this._setCellUnderline(R.x1,R.x2,R.y1,R.y2,R.cols,!1)}_setCellUnderline(R,F,K,Q,N,k){K<0&&(R=0),Q<0&&(F=0);let m=this._bufferService.rows-1;K=Math.max(Math.min(K,m),0),Q=Math.max(Math.min(Q,m),0),N=Math.min(N,this._bufferService.cols);let x=this._bufferService.buffer,E=x.ybase+x.y,I=Math.min(x.x,N-1),M=this._optionsService.rawOptions.cursorBlink,X=this._optionsService.rawOptions.cursorStyle,$=this._optionsService.rawOptions.cursorInactiveStyle;for(let W=K;W<=Q;++W){let P=W+x.ydisp,T=this._rowElements[W],U=x.lines.get(P);if(!T||!U)break;T.replaceChildren(...this._rowFactory.createRow(U,P,P===E,X,$,I,M,this.dimensions.css.cell.width,this._widthCache,k?W===K?R:0:-1,k?(W===Q?F:N)-1:-1))}}};t.DomRenderer=B=h([g(7,y.IInstantiationService),g(8,o.ICharSizeService),g(9,y.IOptionsService),g(10,y.IBufferService),g(11,o.ICoreBrowserService),g(12,o.IThemeService)],B)},3787:function(c,t,n){var h=this&&this.__decorate||function(b,S,A,C){var D,L=arguments.length,B=L<3?S:C===null?C=Object.getOwnPropertyDescriptor(S,A):C;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(b,S,A,C);else for(var R=b.length-1;R>=0;R--)(D=b[R])&&(B=(L<3?D(B):L>3?D(S,A,B):D(S,A))||B);return L>3&&B&&Object.defineProperty(S,A,B),B},g=this&&this.__param||function(b,S){return function(A,C){S(A,C,b)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DomRendererRowFactory=void 0;let a=n(2223),l=n(643),_=n(511),v=n(2585),u=n(8055),o=n(4725),d=n(4269),f=n(6171),p=n(3734),y=t.DomRendererRowFactory=class{constructor(b,S,A,C,D,L,B){this._document=b,this._characterJoinerService=S,this._optionsService=A,this._coreBrowserService=C,this._coreService=D,this._decorationService=L,this._themeService=B,this._workCell=new _.CellData,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(b,S,A){this._selectionStart=b,this._selectionEnd=S,this._columnSelectMode=A}createRow(b,S,A,C,D,L,B,R,F,K,Q){let N=[],k=this._characterJoinerService.getJoinedCharacters(S),m=this._themeService.colors,x,E=b.getNoBgTrimmedLength();A&&E<L+1&&(E=L+1);let I=0,M="",X=0,$=0,W=0,P=!1,T=0,U=!1,Z=0,te=[],ee=K!==-1&&Q!==-1;for(let le=0;le<E;le++){b.loadCell(le,this._workCell);let be=this._workCell.getWidth();if(be===0)continue;let ye=!1,he=le,ne=this._workCell;if(k.length>0&&le===k[0][0]){ye=!0;let ce=k.shift();ne=new d.JoinedCellData(this._workCell,b.translateToString(!0,ce[0],ce[1]),ce[1]-ce[0]),he=ce[1]-1,be=ne.getWidth()}let tt=this._isCellInSelection(le,S),vt=A&&le===L,St=ee&&le>=K&&le<=Q,ti=!1;this._decorationService.forEachDecorationAtCell(le,S,void 0,ce=>{ti=!0});let ge=ne.getChars()||l.WHITESPACE_CELL_CHAR;if(ge===" "&&(ne.isUnderline()||ne.isOverline())&&(ge="\xA0"),Z=be*R-F.get(ge,ne.isBold(),ne.isItalic()),x){if(I&&(tt&&U||!tt&&!U&&ne.bg===X)&&(tt&&U&&m.selectionForeground||ne.fg===$)&&ne.extended.ext===W&&St===P&&Z===T&&!vt&&!ye&&!ti){ne.isInvisible()?M+=l.WHITESPACE_CELL_CHAR:M+=ge,I++;continue}I&&(x.textContent=M),x=this._document.createElement("span"),I=0,M=""}else x=this._document.createElement("span");if(X=ne.bg,$=ne.fg,W=ne.extended.ext,P=St,T=Z,U=tt,ye&&L>=le&&L<=he&&(L=le),!this._coreService.isCursorHidden&&vt&&this._coreService.isCursorInitialized){if(te.push("xterm-cursor"),this._coreBrowserService.isFocused)B&&te.push("xterm-cursor-blink"),te.push(C==="bar"?"xterm-cursor-bar":C==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(D)switch(D){case"outline":te.push("xterm-cursor-outline");break;case"block":te.push("xterm-cursor-block");break;case"bar":te.push("xterm-cursor-bar");break;case"underline":te.push("xterm-cursor-underline")}}if(ne.isBold()&&te.push("xterm-bold"),ne.isItalic()&&te.push("xterm-italic"),ne.isDim()&&te.push("xterm-dim"),M=ne.isInvisible()?l.WHITESPACE_CELL_CHAR:ne.getChars()||l.WHITESPACE_CELL_CHAR,ne.isUnderline()&&(te.push(`xterm-underline-${ne.extended.underlineStyle}`),M===" "&&(M="\xA0"),!ne.isUnderlineColorDefault()))if(ne.isUnderlineColorRGB())x.style.textDecorationColor=`rgb(${p.AttributeData.toColorRGB(ne.getUnderlineColor()).join(",")})`;else{let ce=ne.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&ne.isBold()&&ce<8&&(ce+=8),x.style.textDecorationColor=m.ansi[ce].css}ne.isOverline()&&(te.push("xterm-overline"),M===" "&&(M="\xA0")),ne.isStrikethrough()&&te.push("xterm-strikethrough"),St&&(x.style.textDecoration="underline");let ae=ne.getFgColor(),de=ne.getFgColorMode(),se=ne.getBgColor(),pe=ne.getBgColorMode(),Xe=!!ne.isInverse();if(Xe){let ce=ae;ae=se,se=ce;let qe=de;de=pe,pe=qe}let Ce,ot,$e,Me=!1;switch(this._decorationService.forEachDecorationAtCell(le,S,void 0,ce=>{ce.options.layer!=="top"&&Me||(ce.backgroundColorRGB&&(pe=50331648,se=ce.backgroundColorRGB.rgba>>8&16777215,Ce=ce.backgroundColorRGB),ce.foregroundColorRGB&&(de=50331648,ae=ce.foregroundColorRGB.rgba>>8&16777215,ot=ce.foregroundColorRGB),Me=ce.options.layer==="top")}),!Me&&tt&&(Ce=this._coreBrowserService.isFocused?m.selectionBackgroundOpaque:m.selectionInactiveBackgroundOpaque,se=Ce.rgba>>8&16777215,pe=50331648,Me=!0,m.selectionForeground&&(de=50331648,ae=m.selectionForeground.rgba>>8&16777215,ot=m.selectionForeground)),Me&&te.push("xterm-decoration-top"),pe){case 16777216:case 33554432:$e=m.ansi[se],te.push(`xterm-bg-${se}`);break;case 50331648:$e=u.channels.toColor(se>>16,se>>8&255,255&se),this._addStyle(x,`background-color:#${w((se>>>0).toString(16),"0",6)}`);break;default:Xe?($e=m.foreground,te.push(`xterm-bg-${a.INVERTED_DEFAULT_COLOR}`)):$e=m.background}switch(Ce||ne.isDim()&&(Ce=u.color.multiplyOpacity($e,.5)),de){case 16777216:case 33554432:ne.isBold()&&ae<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(ae+=8),this._applyMinimumContrast(x,$e,m.ansi[ae],ne,Ce,void 0)||te.push(`xterm-fg-${ae}`);break;case 50331648:let ce=u.channels.toColor(ae>>16&255,ae>>8&255,255&ae);this._applyMinimumContrast(x,$e,ce,ne,Ce,ot)||this._addStyle(x,`color:#${w(ae.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(x,$e,m.foreground,ne,Ce,ot)||Xe&&te.push(`xterm-fg-${a.INVERTED_DEFAULT_COLOR}`)}te.length&&(x.className=te.join(" "),te.length=0),vt||ye||ti?x.textContent=M:I++,Z!==this.defaultSpacing&&(x.style.letterSpacing=`${Z}px`),N.push(x),le=he}return x&&I&&(x.textContent=M),N}_applyMinimumContrast(b,S,A,C,D,L){if(this._optionsService.rawOptions.minimumContrastRatio===1||(0,f.treatGlyphAsBackgroundColor)(C.getCode()))return!1;let B=this._getContrastCache(C),R;if(D||L||(R=B.getColor(S.rgba,A.rgba)),R===void 0){let F=this._optionsService.rawOptions.minimumContrastRatio/(C.isDim()?2:1);R=u.color.ensureContrastRatio(D||S,L||A,F),B.setColor((D||S).rgba,(L||A).rgba,R??null)}return!!R&&(this._addStyle(b,`color:${R.css}`),!0)}_getContrastCache(b){return b.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(b,S){b.setAttribute("style",`${b.getAttribute("style")||""}${S};`)}_isCellInSelection(b,S){let A=this._selectionStart,C=this._selectionEnd;return!(!A||!C)&&(this._columnSelectMode?A[0]<=C[0]?b>=A[0]&&S>=A[1]&&b<C[0]&&S<=C[1]:b<A[0]&&S>=A[1]&&b>=C[0]&&S<=C[1]:S>A[1]&&S<C[1]||A[1]===C[1]&&S===A[1]&&b>=A[0]&&b<C[0]||A[1]<C[1]&&S===C[1]&&b<C[0]||A[1]<C[1]&&S===A[1]&&b>=A[0])}};function w(b,S,A){for(;b.length<A;)b=S+b;return b}t.DomRendererRowFactory=y=h([g(1,o.ICharacterJoinerService),g(2,v.IOptionsService),g(3,o.ICoreBrowserService),g(4,v.ICoreService),g(5,v.IDecorationService),g(6,o.IThemeService)],y)},2550:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WidthCache=void 0,t.WidthCache=class{constructor(n,h){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=n.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";let g=n.createElement("span");g.classList.add("xterm-char-measure-element");let a=n.createElement("span");a.classList.add("xterm-char-measure-element"),a.style.fontWeight="bold";let l=n.createElement("span");l.classList.add("xterm-char-measure-element"),l.style.fontStyle="italic";let _=n.createElement("span");_.classList.add("xterm-char-measure-element"),_.style.fontWeight="bold",_.style.fontStyle="italic",this._measureElements=[g,a,l,_],this._container.appendChild(g),this._container.appendChild(a),this._container.appendChild(l),this._container.appendChild(_),h.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(n,h,g,a){n===this._font&&h===this._fontSize&&g===this._weight&&a===this._weightBold||(this._font=n,this._fontSize=h,this._weight=g,this._weightBold=a,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${g}`,this._measureElements[1].style.fontWeight=`${a}`,this._measureElements[2].style.fontWeight=`${g}`,this._measureElements[3].style.fontWeight=`${a}`,this.clear())}get(n,h,g){let a=0;if(!h&&!g&&n.length===1&&(a=n.charCodeAt(0))<256){if(this._flat[a]!==-9999)return this._flat[a];let v=this._measure(n,0);return v>0&&(this._flat[a]=v),v}let l=n;h&&(l+="B"),g&&(l+="I");let _=this._holey.get(l);if(_===void 0){let v=0;h&&(v|=1),g&&(v|=2),_=this._measure(n,v),_>0&&this._holey.set(l,_)}return _}_measure(n,h){let g=this._measureElements[h];return g.textContent=n.repeat(32),g.offsetWidth/32}}},2223:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TEXT_BASELINE=t.DIM_OPACITY=t.INVERTED_DEFAULT_COLOR=void 0;let h=n(6114);t.INVERTED_DEFAULT_COLOR=257,t.DIM_OPACITY=.5,t.TEXT_BASELINE=h.isFirefox||h.isLegacyEdge?"bottom":"ideographic"},6171:(c,t)=>{function n(g){return 57508<=g&&g<=57558}function h(g){return g>=128512&&g<=128591||g>=127744&&g<=128511||g>=128640&&g<=128767||g>=9728&&g<=9983||g>=9984&&g<=10175||g>=65024&&g<=65039||g>=129280&&g<=129535||g>=127462&&g<=127487}Object.defineProperty(t,"__esModule",{value:!0}),t.computeNextVariantOffset=t.createRenderDimensions=t.treatGlyphAsBackgroundColor=t.allowRescaling=t.isEmoji=t.isRestrictedPowerlineGlyph=t.isPowerlineGlyph=t.throwIfFalsy=void 0,t.throwIfFalsy=function(g){if(!g)throw new Error("value must not be falsy");return g},t.isPowerlineGlyph=n,t.isRestrictedPowerlineGlyph=function(g){return 57520<=g&&g<=57527},t.isEmoji=h,t.allowRescaling=function(g,a,l,_){return a===1&&l>Math.ceil(1.5*_)&&g!==void 0&&g>255&&!h(g)&&!n(g)&&!function(v){return 57344<=v&&v<=63743}(g)},t.treatGlyphAsBackgroundColor=function(g){return n(g)||function(a){return 9472<=a&&a<=9631}(g)},t.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}},t.computeNextVariantOffset=function(g,a,l=0){return(g-(2*Math.round(a)-l))%(2*Math.round(a))}},6052:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createSelectionRenderModel=void 0;class n{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(g,a,l,_=!1){if(this.selectionStart=a,this.selectionEnd=l,!a||!l||a[0]===l[0]&&a[1]===l[1])return void this.clear();let v=g.buffers.active.ydisp,u=a[1]-v,o=l[1]-v,d=Math.max(u,0),f=Math.min(o,g.rows-1);d>=g.rows||f<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=_,this.viewportStartRow=u,this.viewportEndRow=o,this.viewportCappedStartRow=d,this.viewportCappedEndRow=f,this.startCol=a[0],this.endCol=l[0])}isCellSelected(g,a,l){return!!this.hasSelection&&(l-=g.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?a>=this.startCol&&l>=this.viewportCappedStartRow&&a<this.endCol&&l<=this.viewportCappedEndRow:a<this.startCol&&l>=this.viewportCappedStartRow&&a>=this.endCol&&l<=this.viewportCappedEndRow:l>this.viewportStartRow&&l<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&l===this.viewportStartRow&&a>=this.startCol&&a<this.endCol||this.viewportStartRow<this.viewportEndRow&&l===this.viewportEndRow&&a<this.endCol||this.viewportStartRow<this.viewportEndRow&&l===this.viewportStartRow&&a>=this.startCol)}}t.createSelectionRenderModel=function(){return new n}},456:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionModel=void 0,t.SelectionModel=class{constructor(n){this._bufferService=n,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){let n=this.selectionStart[0]+this.selectionStartLength;return n>this._bufferService.cols?n%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(n/this._bufferService.cols)-1]:[n%this._bufferService.cols,this.selectionStart[1]+Math.floor(n/this._bufferService.cols)]:[n,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){let n=this.selectionStart[0]+this.selectionStartLength;return n>this._bufferService.cols?[n%this._bufferService.cols,this.selectionStart[1]+Math.floor(n/this._bufferService.cols)]:[Math.max(n,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){let n=this.selectionStart,h=this.selectionEnd;return!(!n||!h)&&(n[1]>h[1]||n[1]===h[1]&&n[0]>h[0])}handleTrim(n){return this.selectionStart&&(this.selectionStart[1]-=n),this.selectionEnd&&(this.selectionEnd[1]-=n),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(c,t,n){var h=this&&this.__decorate||function(f,p,y,w){var b,S=arguments.length,A=S<3?p:w===null?w=Object.getOwnPropertyDescriptor(p,y):w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")A=Reflect.decorate(f,p,y,w);else for(var C=f.length-1;C>=0;C--)(b=f[C])&&(A=(S<3?b(A):S>3?b(p,y,A):b(p,y))||A);return S>3&&A&&Object.defineProperty(p,y,A),A},g=this&&this.__param||function(f,p){return function(y,w){p(y,w,f)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CharSizeService=void 0;let a=n(2585),l=n(8460),_=n(844),v=t.CharSizeService=class extends _.Disposable{get hasValidSize(){return this.width>0&&this.height>0}constructor(f,p,y){super(),this._optionsService=y,this.width=0,this.height=0,this._onCharSizeChange=this.register(new l.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this.register(new d(this._optionsService))}catch{this._measureStrategy=this.register(new o(f,p,this._optionsService))}this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}measure(){let f=this._measureStrategy.measure();f.width===this.width&&f.height===this.height||(this.width=f.width,this.height=f.height,this._onCharSizeChange.fire())}};t.CharSizeService=v=h([g(2,a.IOptionsService)],v);class u extends _.Disposable{constructor(){super(...arguments),this._result={width:0,height:0}}_validateAndSet(p,y){p!==void 0&&p>0&&y!==void 0&&y>0&&(this._result.width=p,this._result.height=y)}}class o extends u{constructor(p,y,w){super(),this._document=p,this._parentElement=y,this._optionsService=w,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}}class d extends u{constructor(p){super(),this._optionsService=p,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");let y=this._ctx.measureText("W");if(!("width"in y&&"fontBoundingBoxAscent"in y&&"fontBoundingBoxDescent"in y))throw new Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;let p=this._ctx.measureText("W");return this._validateAndSet(p.width,p.fontBoundingBoxAscent+p.fontBoundingBoxDescent),this._result}}},4269:function(c,t,n){var h=this&&this.__decorate||function(d,f,p,y){var w,b=arguments.length,S=b<3?f:y===null?y=Object.getOwnPropertyDescriptor(f,p):y;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(d,f,p,y);else for(var A=d.length-1;A>=0;A--)(w=d[A])&&(S=(b<3?w(S):b>3?w(f,p,S):w(f,p))||S);return b>3&&S&&Object.defineProperty(f,p,S),S},g=this&&this.__param||function(d,f){return function(p,y){f(p,y,d)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CharacterJoinerService=t.JoinedCellData=void 0;let a=n(3734),l=n(643),_=n(511),v=n(2585);class u extends a.AttributeData{constructor(f,p,y){super(),this.content=0,this.combinedData="",this.fg=f.fg,this.bg=f.bg,this.combinedData=p,this._width=y}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(f){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}t.JoinedCellData=u;let o=t.CharacterJoinerService=class Vc{constructor(f){this._bufferService=f,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new _.CellData}register(f){let p={id:this._nextCharacterJoinerId++,handler:f};return this._characterJoiners.push(p),p.id}deregister(f){for(let p=0;p<this._characterJoiners.length;p++)if(this._characterJoiners[p].id===f)return this._characterJoiners.splice(p,1),!0;return!1}getJoinedCharacters(f){if(this._characterJoiners.length===0)return[];let p=this._bufferService.buffer.lines.get(f);if(!p||p.length===0)return[];let y=[],w=p.translateToString(!0),b=0,S=0,A=0,C=p.getFg(0),D=p.getBg(0);for(let L=0;L<p.getTrimmedLength();L++)if(p.loadCell(L,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==C||this._workCell.bg!==D){if(L-b>1){let B=this._getJoinedRanges(w,A,S,p,b);for(let R=0;R<B.length;R++)y.push(B[R])}b=L,A=S,C=this._workCell.fg,D=this._workCell.bg}S+=this._workCell.getChars().length||l.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-b>1){let L=this._getJoinedRanges(w,A,S,p,b);for(let B=0;B<L.length;B++)y.push(L[B])}return y}_getJoinedRanges(f,p,y,w,b){let S=f.substring(p,y),A=[];try{A=this._characterJoiners[0].handler(S)}catch(C){console.error(C)}for(let C=1;C<this._characterJoiners.length;C++)try{let D=this._characterJoiners[C].handler(S);for(let L=0;L<D.length;L++)Vc._mergeRanges(A,D[L])}catch(D){console.error(D)}return this._stringRangesToCellRanges(A,w,b),A}_stringRangesToCellRanges(f,p,y){let w=0,b=!1,S=0,A=f[w];if(A){for(let C=y;C<this._bufferService.cols;C++){let D=p.getWidth(C),L=p.getString(C).length||l.WHITESPACE_CELL_CHAR.length;if(D!==0){if(!b&&A[0]<=S&&(A[0]=C,b=!0),A[1]<=S){if(A[1]=C,A=f[++w],!A)break;A[0]<=S?(A[0]=C,b=!0):b=!1}S+=L}}A&&(A[1]=this._bufferService.cols)}}static _mergeRanges(f,p){let y=!1;for(let w=0;w<f.length;w++){let b=f[w];if(y){if(p[1]<=b[0])return f[w-1][1]=p[1],f;if(p[1]<=b[1])return f[w-1][1]=Math.max(p[1],b[1]),f.splice(w,1),f;f.splice(w,1),w--}else{if(p[1]<=b[0])return f.splice(w,0,p),f;if(p[1]<=b[1])return b[0]=Math.min(p[0],b[0]),f;p[0]<b[1]&&(b[0]=Math.min(p[0],b[0]),y=!0)}}return y?f[f.length-1][1]=p[1]:f.push(p),f}};t.CharacterJoinerService=o=h([g(0,v.IBufferService)],o)},5114:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CoreBrowserService=void 0;let h=n(844),g=n(8460),a=n(3656);class l extends h.Disposable{constructor(u,o,d){super(),this._textarea=u,this._window=o,this.mainDocument=d,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=new _(this._window),this._onDprChange=this.register(new g.EventEmitter),this.onDprChange=this._onDprChange.event,this._onWindowChange=this.register(new g.EventEmitter),this.onWindowChange=this._onWindowChange.event,this.register(this.onWindowChange(f=>this._screenDprMonitor.setWindow(f))),this.register((0,g.forwardEvent)(this._screenDprMonitor.onDprChange,this._onDprChange)),this._textarea.addEventListener("focus",()=>this._isFocused=!0),this._textarea.addEventListener("blur",()=>this._isFocused=!1)}get window(){return this._window}set window(u){this._window!==u&&(this._window=u,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}}t.CoreBrowserService=l;class _ extends h.Disposable{constructor(u){super(),this._parentWindow=u,this._windowResizeListener=this.register(new h.MutableDisposable),this._onDprChange=this.register(new g.EventEmitter),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this.register((0,h.toDisposable)(()=>this.clearListener()))}setWindow(u){this._parentWindow=u,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=(0,a.addDisposableDomListener)(this._parentWindow,"resize",()=>this._setDprAndFireIfDiffers())}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){this._outerListener&&(this._resolutionMediaMatchList?.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}}},779:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LinkProviderService=void 0;let h=n(844);class g extends h.Disposable{constructor(){super(),this.linkProviders=[],this.register((0,h.toDisposable)(()=>this.linkProviders.length=0))}registerLinkProvider(l){return this.linkProviders.push(l),{dispose:()=>{let _=this.linkProviders.indexOf(l);_!==-1&&this.linkProviders.splice(_,1)}}}}t.LinkProviderService=g},8934:function(c,t,n){var h=this&&this.__decorate||function(v,u,o,d){var f,p=arguments.length,y=p<3?u:d===null?d=Object.getOwnPropertyDescriptor(u,o):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(v,u,o,d);else for(var w=v.length-1;w>=0;w--)(f=v[w])&&(y=(p<3?f(y):p>3?f(u,o,y):f(u,o))||y);return p>3&&y&&Object.defineProperty(u,o,y),y},g=this&&this.__param||function(v,u){return function(o,d){u(o,d,v)}};Object.defineProperty(t,"__esModule",{value:!0}),t.MouseService=void 0;let a=n(4725),l=n(9806),_=t.MouseService=class{constructor(v,u){this._renderService=v,this._charSizeService=u}getCoords(v,u,o,d,f){return(0,l.getCoords)(window,v,u,o,d,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,f)}getMouseReportCoords(v,u){let o=(0,l.getCoordsRelativeToElement)(window,v,u);if(this._charSizeService.hasValidSize)return o[0]=Math.min(Math.max(o[0],0),this._renderService.dimensions.css.canvas.width-1),o[1]=Math.min(Math.max(o[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(o[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(o[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(o[0]),y:Math.floor(o[1])}}};t.MouseService=_=h([g(0,a.IRenderService),g(1,a.ICharSizeService)],_)},3230:function(c,t,n){var h=this&&this.__decorate||function(f,p,y,w){var b,S=arguments.length,A=S<3?p:w===null?w=Object.getOwnPropertyDescriptor(p,y):w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")A=Reflect.decorate(f,p,y,w);else for(var C=f.length-1;C>=0;C--)(b=f[C])&&(A=(S<3?b(A):S>3?b(p,y,A):b(p,y))||A);return S>3&&A&&Object.defineProperty(p,y,A),A},g=this&&this.__param||function(f,p){return function(y,w){p(y,w,f)}};Object.defineProperty(t,"__esModule",{value:!0}),t.RenderService=void 0;let a=n(6193),l=n(4725),_=n(8460),v=n(844),u=n(7226),o=n(2585),d=t.RenderService=class extends v.Disposable{get dimensions(){return this._renderer.value.dimensions}constructor(f,p,y,w,b,S,A,C){super(),this._rowCount=f,this._charSizeService=w,this._renderer=this.register(new v.MutableDisposable),this._pausedResizeTask=new u.DebouncedIdleTask,this._observerDisposable=this.register(new v.MutableDisposable),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new _.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new _.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new _.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new _.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new a.RenderDebouncer((D,L)=>this._renderRows(D,L),A),this.register(this._renderDebouncer),this.register(A.onDprChange(()=>this.handleDevicePixelRatioChange())),this.register(S.onResize(()=>this._fullRefresh())),this.register(S.buffers.onBufferActivate(()=>this._renderer.value?.clear())),this.register(y.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this.register(b.onDecorationRegistered(()=>this._fullRefresh())),this.register(b.onDecorationRemoved(()=>this._fullRefresh())),this.register(y.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],()=>{this.clear(),this.handleResize(S.cols,S.rows),this._fullRefresh()})),this.register(y.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(S.buffer.y,S.buffer.y,!0))),this.register(C.onChangeColors(()=>this._fullRefresh())),this._registerIntersectionObserver(A.window,p),this.register(A.onWindowChange(D=>this._registerIntersectionObserver(D,p)))}_registerIntersectionObserver(f,p){if("IntersectionObserver"in f){let y=new f.IntersectionObserver(w=>this._handleIntersectionChange(w[w.length-1]),{threshold:0});y.observe(p),this._observerDisposable.value=(0,v.toDisposable)(()=>y.disconnect())}}_handleIntersectionChange(f){this._isPaused=f.isIntersecting===void 0?f.intersectionRatio===0:!f.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(f,p,y=!1){this._isPaused?this._needsFullRefresh=!0:(y||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(f,p,this._rowCount))}_renderRows(f,p){this._renderer.value&&(f=Math.min(f,this._rowCount-1),p=Math.min(p,this._rowCount-1),this._renderer.value.renderRows(f,p),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:f,end:p}),this._onRender.fire({start:f,end:p}),this._isNextRenderRedrawOnly=!0)}resize(f,p){this._rowCount=p,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(f){this._renderer.value=f,this._renderer.value&&(this._renderer.value.onRequestRedraw(p=>this.refreshRows(p.start,p.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback(f){return this._renderDebouncer.addRefreshCallback(f)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){this._renderer.value&&(this._renderer.value.clearTextureAtlas?.(),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(f,p){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(()=>this._renderer.value?.handleResize(f,p)):this._renderer.value.handleResize(f,p),this._fullRefresh())}handleCharSizeChanged(){this._renderer.value?.handleCharSizeChanged()}handleBlur(){this._renderer.value?.handleBlur()}handleFocus(){this._renderer.value?.handleFocus()}handleSelectionChanged(f,p,y){this._selectionState.start=f,this._selectionState.end=p,this._selectionState.columnSelectMode=y,this._renderer.value?.handleSelectionChanged(f,p,y)}handleCursorMove(){this._renderer.value?.handleCursorMove()}clear(){this._renderer.value?.clear()}};t.RenderService=d=h([g(2,o.IOptionsService),g(3,l.ICharSizeService),g(4,o.IDecorationService),g(5,o.IBufferService),g(6,l.ICoreBrowserService),g(7,l.IThemeService)],d)},9312:function(c,t,n){var h=this&&this.__decorate||function(A,C,D,L){var B,R=arguments.length,F=R<3?C:L===null?L=Object.getOwnPropertyDescriptor(C,D):L;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")F=Reflect.decorate(A,C,D,L);else for(var K=A.length-1;K>=0;K--)(B=A[K])&&(F=(R<3?B(F):R>3?B(C,D,F):B(C,D))||F);return R>3&&F&&Object.defineProperty(C,D,F),F},g=this&&this.__param||function(A,C){return function(D,L){C(D,L,A)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionService=void 0;let a=n(9806),l=n(9504),_=n(456),v=n(4725),u=n(8460),o=n(844),d=n(6114),f=n(4841),p=n(511),y=n(2585),w="\xA0",b=new RegExp(w,"g"),S=t.SelectionService=class extends o.Disposable{constructor(A,C,D,L,B,R,F,K,Q){super(),this._element=A,this._screenElement=C,this._linkifier=D,this._bufferService=L,this._coreService=B,this._mouseService=R,this._optionsService=F,this._renderService=K,this._coreBrowserService=Q,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new p.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new u.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new u.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new u.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new u.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=N=>this._handleMouseMove(N),this._mouseUpListener=N=>this._handleMouseUp(N),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim(N=>this._handleTrim(N)),this.register(this._bufferService.buffers.onBufferActivate(N=>this._handleBufferActivate(N))),this.enable(),this._model=new _.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,o.toDisposable)(()=>{this._removeMouseDownListeners()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){let A=this._model.finalSelectionStart,C=this._model.finalSelectionEnd;return!(!A||!C||A[0]===C[0]&&A[1]===C[1])}get selectionText(){let A=this._model.finalSelectionStart,C=this._model.finalSelectionEnd;if(!A||!C)return"";let D=this._bufferService.buffer,L=[];if(this._activeSelectionMode===3){if(A[0]===C[0])return"";let B=A[0]<C[0]?A[0]:C[0],R=A[0]<C[0]?C[0]:A[0];for(let F=A[1];F<=C[1];F++){let K=D.translateBufferLineToString(F,!0,B,R);L.push(K)}}else{let B=A[1]===C[1]?C[0]:void 0;L.push(D.translateBufferLineToString(A[1],!0,A[0],B));for(let R=A[1]+1;R<=C[1]-1;R++){let F=D.lines.get(R),K=D.translateBufferLineToString(R,!0);F?.isWrapped?L[L.length-1]+=K:L.push(K)}if(A[1]!==C[1]){let R=D.lines.get(C[1]),F=D.translateBufferLineToString(C[1],!0,0,C[0]);R&&R.isWrapped?L[L.length-1]+=F:L.push(F)}}return L.map(B=>B.replace(b," ")).join(d.isWindows?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(A){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),d.isLinux&&A&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(A){let C=this._getMouseBufferCoords(A),D=this._model.finalSelectionStart,L=this._model.finalSelectionEnd;return!!(D&&L&&C)&&this._areCoordsInSelection(C,D,L)}isCellInSelection(A,C){let D=this._model.finalSelectionStart,L=this._model.finalSelectionEnd;return!(!D||!L)&&this._areCoordsInSelection([A,C],D,L)}_areCoordsInSelection(A,C,D){return A[1]>C[1]&&A[1]<D[1]||C[1]===D[1]&&A[1]===C[1]&&A[0]>=C[0]&&A[0]<D[0]||C[1]<D[1]&&A[1]===D[1]&&A[0]<D[0]||C[1]<D[1]&&A[1]===C[1]&&A[0]>=C[0]}_selectWordAtCursor(A,C){let D=this._linkifier.currentLink?.link?.range;if(D)return this._model.selectionStart=[D.start.x-1,D.start.y-1],this._model.selectionStartLength=(0,f.getRangeLength)(D,this._bufferService.cols),this._model.selectionEnd=void 0,!0;let L=this._getMouseBufferCoords(A);return!!L&&(this._selectWordAt(L,C),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(A,C){this._model.clearSelection(),A=Math.max(A,0),C=Math.min(C,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,A],this._model.selectionEnd=[this._bufferService.cols,C],this.refresh(),this._onSelectionChange.fire()}_handleTrim(A){this._model.handleTrim(A)&&this.refresh()}_getMouseBufferCoords(A){let C=this._mouseService.getCoords(A,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(C)return C[0]--,C[1]--,C[1]+=this._bufferService.buffer.ydisp,C}_getMouseEventScrollAmount(A){let C=(0,a.getCoordsRelativeToElement)(this._coreBrowserService.window,A,this._screenElement)[1],D=this._renderService.dimensions.css.canvas.height;return C>=0&&C<=D?0:(C>D&&(C-=D),C=Math.min(Math.max(C,-50),50),C/=50,C/Math.abs(C)+Math.round(14*C))}shouldForceSelection(A){return d.isMac?A.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:A.shiftKey}handleMouseDown(A){if(this._mouseDownTimeStamp=A.timeStamp,(A.button!==2||!this.hasSelection)&&A.button===0){if(!this._enabled){if(!this.shouldForceSelection(A))return;A.stopPropagation()}A.preventDefault(),this._dragScrollAmount=0,this._enabled&&A.shiftKey?this._handleIncrementalClick(A):A.detail===1?this._handleSingleClick(A):A.detail===2?this._handleDoubleClick(A):A.detail===3&&this._handleTripleClick(A),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(A){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(A))}_handleSingleClick(A){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(A)?3:0,this._model.selectionStart=this._getMouseBufferCoords(A),!this._model.selectionStart)return;this._model.selectionEnd=void 0;let C=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);C&&C.length!==this._model.selectionStart[0]&&C.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(A){this._selectWordAtCursor(A,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(A){let C=this._getMouseBufferCoords(A);C&&(this._activeSelectionMode=2,this._selectLineAt(C[1]))}shouldColumnSelect(A){return A.altKey&&!(d.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(A){if(A.stopImmediatePropagation(),!this._model.selectionStart)return;let C=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(A),!this._model.selectionEnd)return void this.refresh(!0);this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(A),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));let D=this._bufferService.buffer;if(this._model.selectionEnd[1]<D.lines.length){let L=D.lines.get(this._model.selectionEnd[1]);L&&L.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}C&&C[0]===this._model.selectionEnd[0]&&C[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});let A=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(A.ydisp+this._bufferService.rows,A.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=A.ydisp),this.refresh()}}_handleMouseUp(A){let C=A.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&C<500&&A.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){let D=this._mouseService.getCoords(A,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(D&&D[0]!==void 0&&D[1]!==void 0){let L=(0,l.moveToCellSequence)(D[0]-1,D[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(L,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){let A=this._model.finalSelectionStart,C=this._model.finalSelectionEnd,D=!(!A||!C||A[0]===C[0]&&A[1]===C[1]);D?A&&C&&(this._oldSelectionStart&&this._oldSelectionEnd&&A[0]===this._oldSelectionStart[0]&&A[1]===this._oldSelectionStart[1]&&C[0]===this._oldSelectionEnd[0]&&C[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(A,C,D)):this._oldHasSelection&&this._fireOnSelectionChange(A,C,D)}_fireOnSelectionChange(A,C,D){this._oldSelectionStart=A,this._oldSelectionEnd=C,this._oldHasSelection=D,this._onSelectionChange.fire()}_handleBufferActivate(A){this.clearSelection(),this._trimListener.dispose(),this._trimListener=A.activeBuffer.lines.onTrim(C=>this._handleTrim(C))}_convertViewportColToCharacterIndex(A,C){let D=C;for(let L=0;C>=L;L++){let B=A.loadCell(L,this._workCell).getChars().length;this._workCell.getWidth()===0?D--:B>1&&C!==L&&(D+=B-1)}return D}setSelection(A,C,D){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[A,C],this._model.selectionStartLength=D,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(A){this._isClickInSelection(A)||(this._selectWordAtCursor(A,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(A,C,D=!0,L=!0){if(A[0]>=this._bufferService.cols)return;let B=this._bufferService.buffer,R=B.lines.get(A[1]);if(!R)return;let F=B.translateBufferLineToString(A[1],!1),K=this._convertViewportColToCharacterIndex(R,A[0]),Q=K,N=A[0]-K,k=0,m=0,x=0,E=0;if(F.charAt(K)===" "){for(;K>0&&F.charAt(K-1)===" ";)K--;for(;Q<F.length&&F.charAt(Q+1)===" ";)Q++}else{let X=A[0],$=A[0];R.getWidth(X)===0&&(k++,X--),R.getWidth($)===2&&(m++,$++);let W=R.getString($).length;for(W>1&&(E+=W-1,Q+=W-1);X>0&&K>0&&!this._isCharWordSeparator(R.loadCell(X-1,this._workCell));){R.loadCell(X-1,this._workCell);let P=this._workCell.getChars().length;this._workCell.getWidth()===0?(k++,X--):P>1&&(x+=P-1,K-=P-1),K--,X--}for(;$<R.length&&Q+1<F.length&&!this._isCharWordSeparator(R.loadCell($+1,this._workCell));){R.loadCell($+1,this._workCell);let P=this._workCell.getChars().length;this._workCell.getWidth()===2?(m++,$++):P>1&&(E+=P-1,Q+=P-1),Q++,$++}}Q++;let I=K+N-k+x,M=Math.min(this._bufferService.cols,Q-K+k+m-x-E);if(C||F.slice(K,Q).trim()!==""){if(D&&I===0&&R.getCodePoint(0)!==32){let X=B.lines.get(A[1]-1);if(X&&R.isWrapped&&X.getCodePoint(this._bufferService.cols-1)!==32){let $=this._getWordAt([this._bufferService.cols-1,A[1]-1],!1,!0,!1);if($){let W=this._bufferService.cols-$.start;I-=W,M+=W}}}if(L&&I+M===this._bufferService.cols&&R.getCodePoint(this._bufferService.cols-1)!==32){let X=B.lines.get(A[1]+1);if(X?.isWrapped&&X.getCodePoint(0)!==32){let $=this._getWordAt([0,A[1]+1],!1,!1,!0);$&&(M+=$.length)}}return{start:I,length:M}}}_selectWordAt(A,C){let D=this._getWordAt(A,C);if(D){for(;D.start<0;)D.start+=this._bufferService.cols,A[1]--;this._model.selectionStart=[D.start,A[1]],this._model.selectionStartLength=D.length}}_selectToWordAt(A){let C=this._getWordAt(A,!0);if(C){let D=A[1];for(;C.start<0;)C.start+=this._bufferService.cols,D--;if(!this._model.areSelectionValuesReversed())for(;C.start+C.length>this._bufferService.cols;)C.length-=this._bufferService.cols,D++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?C.start:C.start+C.length,D]}}_isCharWordSeparator(A){return A.getWidth()!==0&&this._optionsService.rawOptions.wordSeparator.indexOf(A.getChars())>=0}_selectLineAt(A){let C=this._bufferService.buffer.getWrappedRangeForLine(A),D={start:{x:0,y:C.first},end:{x:this._bufferService.cols-1,y:C.last}};this._model.selectionStart=[0,C.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,f.getRangeLength)(D,this._bufferService.cols)}};t.SelectionService=S=h([g(3,y.IBufferService),g(4,y.ICoreService),g(5,v.IMouseService),g(6,y.IOptionsService),g(7,v.IRenderService),g(8,v.ICoreBrowserService)],S)},4725:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ILinkProviderService=t.IThemeService=t.ICharacterJoinerService=t.ISelectionService=t.IRenderService=t.IMouseService=t.ICoreBrowserService=t.ICharSizeService=void 0;let h=n(8343);t.ICharSizeService=(0,h.createDecorator)("CharSizeService"),t.ICoreBrowserService=(0,h.createDecorator)("CoreBrowserService"),t.IMouseService=(0,h.createDecorator)("MouseService"),t.IRenderService=(0,h.createDecorator)("RenderService"),t.ISelectionService=(0,h.createDecorator)("SelectionService"),t.ICharacterJoinerService=(0,h.createDecorator)("CharacterJoinerService"),t.IThemeService=(0,h.createDecorator)("ThemeService"),t.ILinkProviderService=(0,h.createDecorator)("LinkProviderService")},6731:function(c,t,n){var h=this&&this.__decorate||function(S,A,C,D){var L,B=arguments.length,R=B<3?A:D===null?D=Object.getOwnPropertyDescriptor(A,C):D;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")R=Reflect.decorate(S,A,C,D);else for(var F=S.length-1;F>=0;F--)(L=S[F])&&(R=(B<3?L(R):B>3?L(A,C,R):L(A,C))||R);return B>3&&R&&Object.defineProperty(A,C,R),R},g=this&&this.__param||function(S,A){return function(C,D){A(C,D,S)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ThemeService=t.DEFAULT_ANSI_COLORS=void 0;let a=n(7239),l=n(8055),_=n(8460),v=n(844),u=n(2585),o=l.css.toColor("#ffffff"),d=l.css.toColor("#000000"),f=l.css.toColor("#ffffff"),p=l.css.toColor("#000000"),y={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};t.DEFAULT_ANSI_COLORS=Object.freeze((()=>{let S=[l.css.toColor("#2e3436"),l.css.toColor("#cc0000"),l.css.toColor("#4e9a06"),l.css.toColor("#c4a000"),l.css.toColor("#3465a4"),l.css.toColor("#75507b"),l.css.toColor("#06989a"),l.css.toColor("#d3d7cf"),l.css.toColor("#555753"),l.css.toColor("#ef2929"),l.css.toColor("#8ae234"),l.css.toColor("#fce94f"),l.css.toColor("#729fcf"),l.css.toColor("#ad7fa8"),l.css.toColor("#34e2e2"),l.css.toColor("#eeeeec")],A=[0,95,135,175,215,255];for(let C=0;C<216;C++){let D=A[C/36%6|0],L=A[C/6%6|0],B=A[C%6];S.push({css:l.channels.toCss(D,L,B),rgba:l.channels.toRgba(D,L,B)})}for(let C=0;C<24;C++){let D=8+10*C;S.push({css:l.channels.toCss(D,D,D),rgba:l.channels.toRgba(D,D,D)})}return S})());let w=t.ThemeService=class extends v.Disposable{get colors(){return this._colors}constructor(S){super(),this._optionsService=S,this._contrastCache=new a.ColorContrastCache,this._halfContrastCache=new a.ColorContrastCache,this._onChangeColors=this.register(new _.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:o,background:d,cursor:f,cursorAccent:p,selectionForeground:void 0,selectionBackgroundTransparent:y,selectionBackgroundOpaque:l.color.blend(d,y),selectionInactiveBackgroundTransparent:y,selectionInactiveBackgroundOpaque:l.color.blend(d,y),ansi:t.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this.register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}_setTheme(S={}){let A=this._colors;if(A.foreground=b(S.foreground,o),A.background=b(S.background,d),A.cursor=b(S.cursor,f),A.cursorAccent=b(S.cursorAccent,p),A.selectionBackgroundTransparent=b(S.selectionBackground,y),A.selectionBackgroundOpaque=l.color.blend(A.background,A.selectionBackgroundTransparent),A.selectionInactiveBackgroundTransparent=b(S.selectionInactiveBackground,A.selectionBackgroundTransparent),A.selectionInactiveBackgroundOpaque=l.color.blend(A.background,A.selectionInactiveBackgroundTransparent),A.selectionForeground=S.selectionForeground?b(S.selectionForeground,l.NULL_COLOR):void 0,A.selectionForeground===l.NULL_COLOR&&(A.selectionForeground=void 0),l.color.isOpaque(A.selectionBackgroundTransparent)&&(A.selectionBackgroundTransparent=l.color.opacity(A.selectionBackgroundTransparent,.3)),l.color.isOpaque(A.selectionInactiveBackgroundTransparent)&&(A.selectionInactiveBackgroundTransparent=l.color.opacity(A.selectionInactiveBackgroundTransparent,.3)),A.ansi=t.DEFAULT_ANSI_COLORS.slice(),A.ansi[0]=b(S.black,t.DEFAULT_ANSI_COLORS[0]),A.ansi[1]=b(S.red,t.DEFAULT_ANSI_COLORS[1]),A.ansi[2]=b(S.green,t.DEFAULT_ANSI_COLORS[2]),A.ansi[3]=b(S.yellow,t.DEFAULT_ANSI_COLORS[3]),A.ansi[4]=b(S.blue,t.DEFAULT_ANSI_COLORS[4]),A.ansi[5]=b(S.magenta,t.DEFAULT_ANSI_COLORS[5]),A.ansi[6]=b(S.cyan,t.DEFAULT_ANSI_COLORS[6]),A.ansi[7]=b(S.white,t.DEFAULT_ANSI_COLORS[7]),A.ansi[8]=b(S.brightBlack,t.DEFAULT_ANSI_COLORS[8]),A.ansi[9]=b(S.brightRed,t.DEFAULT_ANSI_COLORS[9]),A.ansi[10]=b(S.brightGreen,t.DEFAULT_ANSI_COLORS[10]),A.ansi[11]=b(S.brightYellow,t.DEFAULT_ANSI_COLORS[11]),A.ansi[12]=b(S.brightBlue,t.DEFAULT_ANSI_COLORS[12]),A.ansi[13]=b(S.brightMagenta,t.DEFAULT_ANSI_COLORS[13]),A.ansi[14]=b(S.brightCyan,t.DEFAULT_ANSI_COLORS[14]),A.ansi[15]=b(S.brightWhite,t.DEFAULT_ANSI_COLORS[15]),S.extendedAnsi){let C=Math.min(A.ansi.length-16,S.extendedAnsi.length);for(let D=0;D<C;D++)A.ansi[D+16]=b(S.extendedAnsi[D],t.DEFAULT_ANSI_COLORS[D+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(S){this._restoreColor(S),this._onChangeColors.fire(this.colors)}_restoreColor(S){if(S!==void 0)switch(S){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[S]=this._restoreColors.ansi[S]}else for(let A=0;A<this._restoreColors.ansi.length;++A)this._colors.ansi[A]=this._restoreColors.ansi[A]}modifyColors(S){S(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function b(S,A){if(S!==void 0)try{return l.css.toColor(S)}catch{}return A}t.ThemeService=w=h([g(0,u.IOptionsService)],w)},6349:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CircularList=void 0;let h=n(8460),g=n(844);class a extends g.Disposable{constructor(_){super(),this._maxLength=_,this.onDeleteEmitter=this.register(new h.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new h.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new h.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(_){if(this._maxLength===_)return;let v=new Array(_);for(let u=0;u<Math.min(_,this.length);u++)v[u]=this._array[this._getCyclicIndex(u)];this._array=v,this._maxLength=_,this._startIndex=0}get length(){return this._length}set length(_){if(_>this._length)for(let v=this._length;v<_;v++)this._array[v]=void 0;this._length=_}get(_){return this._array[this._getCyclicIndex(_)]}set(_,v){this._array[this._getCyclicIndex(_)]=v}push(_){this._array[this._getCyclicIndex(this._length)]=_,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(_,v,...u){if(v){for(let o=_;o<this._length-v;o++)this._array[this._getCyclicIndex(o)]=this._array[this._getCyclicIndex(o+v)];this._length-=v,this.onDeleteEmitter.fire({index:_,amount:v})}for(let o=this._length-1;o>=_;o--)this._array[this._getCyclicIndex(o+u.length)]=this._array[this._getCyclicIndex(o)];for(let o=0;o<u.length;o++)this._array[this._getCyclicIndex(_+o)]=u[o];if(u.length&&this.onInsertEmitter.fire({index:_,amount:u.length}),this._length+u.length>this._maxLength){let o=this._length+u.length-this._maxLength;this._startIndex+=o,this._length=this._maxLength,this.onTrimEmitter.fire(o)}else this._length+=u.length}trimStart(_){_>this._length&&(_=this._length),this._startIndex+=_,this._length-=_,this.onTrimEmitter.fire(_)}shiftElements(_,v,u){if(!(v<=0)){if(_<0||_>=this._length)throw new Error("start argument out of range");if(_+u<0)throw new Error("Cannot shift elements in list beyond index 0");if(u>0){for(let d=v-1;d>=0;d--)this.set(_+d+u,this.get(_+d));let o=_+v+u-this._length;if(o>0)for(this._length+=o;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let o=0;o<v;o++)this.set(_+o+u,this.get(_+o))}}_getCyclicIndex(_){return(this._startIndex+_)%this._maxLength}}t.CircularList=a},1439:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clone=void 0,t.clone=function n(h,g=5){if(typeof h!="object")return h;let a=Array.isArray(h)?[]:{};for(let l in h)a[l]=g<=1?h[l]:h[l]&&n(h[l],g-1);return a}},8055:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.contrastRatio=t.toPaddedHex=t.rgba=t.rgb=t.css=t.color=t.channels=t.NULL_COLOR=void 0;let n=0,h=0,g=0,a=0;var l,_,v,u,o;function d(p){let y=p.toString(16);return y.length<2?"0"+y:y}function f(p,y){return p<y?(y+.05)/(p+.05):(p+.05)/(y+.05)}t.NULL_COLOR={css:"#00000000",rgba:0},function(p){p.toCss=function(y,w,b,S){return S!==void 0?`#${d(y)}${d(w)}${d(b)}${d(S)}`:`#${d(y)}${d(w)}${d(b)}`},p.toRgba=function(y,w,b,S=255){return(y<<24|w<<16|b<<8|S)>>>0},p.toColor=function(y,w,b,S){return{css:p.toCss(y,w,b,S),rgba:p.toRgba(y,w,b,S)}}}(l||(t.channels=l={})),function(p){function y(w,b){return a=Math.round(255*b),[n,h,g]=o.toChannels(w.rgba),{css:l.toCss(n,h,g,a),rgba:l.toRgba(n,h,g,a)}}p.blend=function(w,b){if(a=(255&b.rgba)/255,a===1)return{css:b.css,rgba:b.rgba};let S=b.rgba>>24&255,A=b.rgba>>16&255,C=b.rgba>>8&255,D=w.rgba>>24&255,L=w.rgba>>16&255,B=w.rgba>>8&255;return n=D+Math.round((S-D)*a),h=L+Math.round((A-L)*a),g=B+Math.round((C-B)*a),{css:l.toCss(n,h,g),rgba:l.toRgba(n,h,g)}},p.isOpaque=function(w){return(255&w.rgba)==255},p.ensureContrastRatio=function(w,b,S){let A=o.ensureContrastRatio(w.rgba,b.rgba,S);if(A)return l.toColor(A>>24&255,A>>16&255,A>>8&255)},p.opaque=function(w){let b=(255|w.rgba)>>>0;return[n,h,g]=o.toChannels(b),{css:l.toCss(n,h,g),rgba:b}},p.opacity=y,p.multiplyOpacity=function(w,b){return a=255&w.rgba,y(w,a*b/255)},p.toColorRGB=function(w){return[w.rgba>>24&255,w.rgba>>16&255,w.rgba>>8&255]}}(_||(t.color=_={})),function(p){let y,w;try{let b=document.createElement("canvas");b.width=1,b.height=1;let S=b.getContext("2d",{willReadFrequently:!0});S&&(y=S,y.globalCompositeOperation="copy",w=y.createLinearGradient(0,0,1,1))}catch{}p.toColor=function(b){if(b.match(/#[\da-f]{3,8}/i))switch(b.length){case 4:return n=parseInt(b.slice(1,2).repeat(2),16),h=parseInt(b.slice(2,3).repeat(2),16),g=parseInt(b.slice(3,4).repeat(2),16),l.toColor(n,h,g);case 5:return n=parseInt(b.slice(1,2).repeat(2),16),h=parseInt(b.slice(2,3).repeat(2),16),g=parseInt(b.slice(3,4).repeat(2),16),a=parseInt(b.slice(4,5).repeat(2),16),l.toColor(n,h,g,a);case 7:return{css:b,rgba:(parseInt(b.slice(1),16)<<8|255)>>>0};case 9:return{css:b,rgba:parseInt(b.slice(1),16)>>>0}}let S=b.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(S)return n=parseInt(S[1]),h=parseInt(S[2]),g=parseInt(S[3]),a=Math.round(255*(S[5]===void 0?1:parseFloat(S[5]))),l.toColor(n,h,g,a);if(!y||!w)throw new Error("css.toColor: Unsupported css format");if(y.fillStyle=w,y.fillStyle=b,typeof y.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(y.fillRect(0,0,1,1),[n,h,g,a]=y.getImageData(0,0,1,1).data,a!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:l.toRgba(n,h,g,a),css:b}}}(v||(t.css=v={})),function(p){function y(w,b,S){let A=w/255,C=b/255,D=S/255;return .2126*(A<=.03928?A/12.92:Math.pow((A+.055)/1.055,2.4))+.7152*(C<=.03928?C/12.92:Math.pow((C+.055)/1.055,2.4))+.0722*(D<=.03928?D/12.92:Math.pow((D+.055)/1.055,2.4))}p.relativeLuminance=function(w){return y(w>>16&255,w>>8&255,255&w)},p.relativeLuminance2=y}(u||(t.rgb=u={})),function(p){function y(b,S,A){let C=b>>24&255,D=b>>16&255,L=b>>8&255,B=S>>24&255,R=S>>16&255,F=S>>8&255,K=f(u.relativeLuminance2(B,R,F),u.relativeLuminance2(C,D,L));for(;K<A&&(B>0||R>0||F>0);)B-=Math.max(0,Math.ceil(.1*B)),R-=Math.max(0,Math.ceil(.1*R)),F-=Math.max(0,Math.ceil(.1*F)),K=f(u.relativeLuminance2(B,R,F),u.relativeLuminance2(C,D,L));return(B<<24|R<<16|F<<8|255)>>>0}function w(b,S,A){let C=b>>24&255,D=b>>16&255,L=b>>8&255,B=S>>24&255,R=S>>16&255,F=S>>8&255,K=f(u.relativeLuminance2(B,R,F),u.relativeLuminance2(C,D,L));for(;K<A&&(B<255||R<255||F<255);)B=Math.min(255,B+Math.ceil(.1*(255-B))),R=Math.min(255,R+Math.ceil(.1*(255-R))),F=Math.min(255,F+Math.ceil(.1*(255-F))),K=f(u.relativeLuminance2(B,R,F),u.relativeLuminance2(C,D,L));return(B<<24|R<<16|F<<8|255)>>>0}p.blend=function(b,S){if(a=(255&S)/255,a===1)return S;let A=S>>24&255,C=S>>16&255,D=S>>8&255,L=b>>24&255,B=b>>16&255,R=b>>8&255;return n=L+Math.round((A-L)*a),h=B+Math.round((C-B)*a),g=R+Math.round((D-R)*a),l.toRgba(n,h,g)},p.ensureContrastRatio=function(b,S,A){let C=u.relativeLuminance(b>>8),D=u.relativeLuminance(S>>8);if(f(C,D)<A){if(D<C){let R=y(b,S,A),F=f(C,u.relativeLuminance(R>>8));if(F<A){let K=w(b,S,A);return F>f(C,u.relativeLuminance(K>>8))?R:K}return R}let L=w(b,S,A),B=f(C,u.relativeLuminance(L>>8));if(B<A){let R=y(b,S,A);return B>f(C,u.relativeLuminance(R>>8))?L:R}return L}},p.reduceLuminance=y,p.increaseLuminance=w,p.toChannels=function(b){return[b>>24&255,b>>16&255,b>>8&255,255&b]}}(o||(t.rgba=o={})),t.toPaddedHex=d,t.contrastRatio=f},8969:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CoreTerminal=void 0;let h=n(844),g=n(2585),a=n(4348),l=n(7866),_=n(744),v=n(7302),u=n(6975),o=n(8460),d=n(1753),f=n(1480),p=n(7994),y=n(9282),w=n(5435),b=n(5981),S=n(2660),A=!1;class C extends h.Disposable{get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new o.EventEmitter),this._onScroll.event(L=>{this._onScrollApi?.fire(L.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(L){for(let B in L)this.optionsService.options[B]=L[B]}constructor(L){super(),this._windowsWrappingHeuristics=this.register(new h.MutableDisposable),this._onBinary=this.register(new o.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new o.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new o.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new o.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new o.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new o.EventEmitter),this._instantiationService=new a.InstantiationService,this.optionsService=this.register(new v.OptionsService(L)),this._instantiationService.setService(g.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(_.BufferService)),this._instantiationService.setService(g.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(l.LogService)),this._instantiationService.setService(g.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(u.CoreService)),this._instantiationService.setService(g.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(d.CoreMouseService)),this._instantiationService.setService(g.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(f.UnicodeService)),this._instantiationService.setService(g.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(p.CharsetService),this._instantiationService.setService(g.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(S.OscLinkService),this._instantiationService.setService(g.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new w.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,o.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,o.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,o.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,o.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom())),this.register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this.register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this.register(this._bufferService.onScroll(B=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this.register(this._inputHandler.onScroll(B=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this.register(new b.WriteBuffer((B,R)=>this._inputHandler.parse(B,R))),this.register((0,o.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed))}write(L,B){this._writeBuffer.write(L,B)}writeSync(L,B){this._logService.logLevel<=g.LogLevelEnum.WARN&&!A&&(this._logService.warn("writeSync is unreliable and will be removed soon."),A=!0),this._writeBuffer.writeSync(L,B)}input(L,B=!0){this.coreService.triggerDataEvent(L,B)}resize(L,B){isNaN(L)||isNaN(B)||(L=Math.max(L,_.MINIMUM_COLS),B=Math.max(B,_.MINIMUM_ROWS),this._bufferService.resize(L,B))}scroll(L,B=!1){this._bufferService.scroll(L,B)}scrollLines(L,B,R){this._bufferService.scrollLines(L,B,R)}scrollPages(L){this.scrollLines(L*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(L){let B=L-this._bufferService.buffer.ydisp;B!==0&&this.scrollLines(B)}registerEscHandler(L,B){return this._inputHandler.registerEscHandler(L,B)}registerDcsHandler(L,B){return this._inputHandler.registerDcsHandler(L,B)}registerCsiHandler(L,B){return this._inputHandler.registerCsiHandler(L,B)}registerOscHandler(L,B){return this._inputHandler.registerOscHandler(L,B)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let L=!1,B=this.optionsService.rawOptions.windowsPty;B&&B.buildNumber!==void 0&&B.buildNumber!==void 0?L=B.backend==="conpty"&&B.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(L=!0),L?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){let L=[];L.push(this.onLineFeed(y.updateWindowsModeWrappedState.bind(null,this._bufferService))),L.push(this.registerCsiHandler({final:"H"},()=>((0,y.updateWindowsModeWrappedState)(this._bufferService),!1))),this._windowsWrappingHeuristics.value=(0,h.toDisposable)(()=>{for(let B of L)B.dispose()})}}}t.CoreTerminal=C},8460:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.runAndSubscribe=t.forwardEvent=t.EventEmitter=void 0,t.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=n=>(this._listeners.push(n),{dispose:()=>{if(!this._disposed){for(let h=0;h<this._listeners.length;h++)if(this._listeners[h]===n)return void this._listeners.splice(h,1)}}})),this._event}fire(n,h){let g=[];for(let a=0;a<this._listeners.length;a++)g.push(this._listeners[a]);for(let a=0;a<g.length;a++)g[a].call(void 0,n,h)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},t.forwardEvent=function(n,h){return n(g=>h.fire(g))},t.runAndSubscribe=function(n,h){return h(void 0),n(g=>h(g))}},5435:function(c,t,n){var h=this&&this.__decorate||function(k,m,x,E){var I,M=arguments.length,X=M<3?m:E===null?E=Object.getOwnPropertyDescriptor(m,x):E;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")X=Reflect.decorate(k,m,x,E);else for(var $=k.length-1;$>=0;$--)(I=k[$])&&(X=(M<3?I(X):M>3?I(m,x,X):I(m,x))||X);return M>3&&X&&Object.defineProperty(m,x,X),X},g=this&&this.__param||function(k,m){return function(x,E){m(x,E,k)}};Object.defineProperty(t,"__esModule",{value:!0}),t.InputHandler=t.WindowsOptionsReportType=void 0;let a=n(2584),l=n(7116),_=n(2015),v=n(844),u=n(482),o=n(8437),d=n(8460),f=n(643),p=n(511),y=n(3734),w=n(2585),b=n(1480),S=n(6242),A=n(6351),C=n(5941),D={"(":0,")":1,"*":2,"+":3,"-":1,".":2},L=131072;function B(k,m){if(k>24)return m.setWinLines||!1;switch(k){case 1:return!!m.restoreWin;case 2:return!!m.minimizeWin;case 3:return!!m.setWinPosition;case 4:return!!m.setWinSizePixels;case 5:return!!m.raiseWin;case 6:return!!m.lowerWin;case 7:return!!m.refreshWin;case 8:return!!m.setWinSizeChars;case 9:return!!m.maximizeWin;case 10:return!!m.fullscreenWin;case 11:return!!m.getWinState;case 13:return!!m.getWinPosition;case 14:return!!m.getWinSizePixels;case 15:return!!m.getScreenSizePixels;case 16:return!!m.getCellSizePixels;case 18:return!!m.getWinSizeChars;case 19:return!!m.getScreenSizeChars;case 20:return!!m.getIconTitle;case 21:return!!m.getWinTitle;case 22:return!!m.pushTitle;case 23:return!!m.popTitle;case 24:return!!m.setWinLines}return!1}var R;(function(k){k[k.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",k[k.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"})(R||(t.WindowsOptionsReportType=R={}));let F=0;class K extends v.Disposable{getAttrData(){return this._curAttrData}constructor(m,x,E,I,M,X,$,W,P=new _.EscapeSequenceParser){super(),this._bufferService=m,this._charsetService=x,this._coreService=E,this._logService=I,this._optionsService=M,this._oscLinkService=X,this._coreMouseService=$,this._unicodeService=W,this._parser=P,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new u.StringToUtf32,this._utf8Decoder=new u.Utf8ToUtf32,this._workCell=new p.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=o.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=o.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new d.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new d.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new d.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new d.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new d.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new d.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new d.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new d.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new d.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new d.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new d.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new d.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new d.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new Q(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(T=>this._activeBuffer=T.activeBuffer)),this._parser.setCsiHandlerFallback((T,U)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(T),params:U.toArray()})}),this._parser.setEscHandlerFallback(T=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(T)})}),this._parser.setExecuteHandlerFallback(T=>{this._logService.debug("Unknown EXECUTE code: ",{code:T})}),this._parser.setOscHandlerFallback((T,U,Z)=>{this._logService.debug("Unknown OSC code: ",{identifier:T,action:U,data:Z})}),this._parser.setDcsHandlerFallback((T,U,Z)=>{U==="HOOK"&&(Z=Z.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(T),action:U,payload:Z})}),this._parser.setPrintHandler((T,U,Z)=>this.print(T,U,Z)),this._parser.registerCsiHandler({final:"@"},T=>this.insertChars(T)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},T=>this.scrollLeft(T)),this._parser.registerCsiHandler({final:"A"},T=>this.cursorUp(T)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},T=>this.scrollRight(T)),this._parser.registerCsiHandler({final:"B"},T=>this.cursorDown(T)),this._parser.registerCsiHandler({final:"C"},T=>this.cursorForward(T)),this._parser.registerCsiHandler({final:"D"},T=>this.cursorBackward(T)),this._parser.registerCsiHandler({final:"E"},T=>this.cursorNextLine(T)),this._parser.registerCsiHandler({final:"F"},T=>this.cursorPrecedingLine(T)),this._parser.registerCsiHandler({final:"G"},T=>this.cursorCharAbsolute(T)),this._parser.registerCsiHandler({final:"H"},T=>this.cursorPosition(T)),this._parser.registerCsiHandler({final:"I"},T=>this.cursorForwardTab(T)),this._parser.registerCsiHandler({final:"J"},T=>this.eraseInDisplay(T,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},T=>this.eraseInDisplay(T,!0)),this._parser.registerCsiHandler({final:"K"},T=>this.eraseInLine(T,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},T=>this.eraseInLine(T,!0)),this._parser.registerCsiHandler({final:"L"},T=>this.insertLines(T)),this._parser.registerCsiHandler({final:"M"},T=>this.deleteLines(T)),this._parser.registerCsiHandler({final:"P"},T=>this.deleteChars(T)),this._parser.registerCsiHandler({final:"S"},T=>this.scrollUp(T)),this._parser.registerCsiHandler({final:"T"},T=>this.scrollDown(T)),this._parser.registerCsiHandler({final:"X"},T=>this.eraseChars(T)),this._parser.registerCsiHandler({final:"Z"},T=>this.cursorBackwardTab(T)),this._parser.registerCsiHandler({final:"`"},T=>this.charPosAbsolute(T)),this._parser.registerCsiHandler({final:"a"},T=>this.hPositionRelative(T)),this._parser.registerCsiHandler({final:"b"},T=>this.repeatPrecedingCharacter(T)),this._parser.registerCsiHandler({final:"c"},T=>this.sendDeviceAttributesPrimary(T)),this._parser.registerCsiHandler({prefix:">",final:"c"},T=>this.sendDeviceAttributesSecondary(T)),this._parser.registerCsiHandler({final:"d"},T=>this.linePosAbsolute(T)),this._parser.registerCsiHandler({final:"e"},T=>this.vPositionRelative(T)),this._parser.registerCsiHandler({final:"f"},T=>this.hVPosition(T)),this._parser.registerCsiHandler({final:"g"},T=>this.tabClear(T)),this._parser.registerCsiHandler({final:"h"},T=>this.setMode(T)),this._parser.registerCsiHandler({prefix:"?",final:"h"},T=>this.setModePrivate(T)),this._parser.registerCsiHandler({final:"l"},T=>this.resetMode(T)),this._parser.registerCsiHandler({prefix:"?",final:"l"},T=>this.resetModePrivate(T)),this._parser.registerCsiHandler({final:"m"},T=>this.charAttributes(T)),this._parser.registerCsiHandler({final:"n"},T=>this.deviceStatus(T)),this._parser.registerCsiHandler({prefix:"?",final:"n"},T=>this.deviceStatusPrivate(T)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},T=>this.softReset(T)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},T=>this.setCursorStyle(T)),this._parser.registerCsiHandler({final:"r"},T=>this.setScrollRegion(T)),this._parser.registerCsiHandler({final:"s"},T=>this.saveCursor(T)),this._parser.registerCsiHandler({final:"t"},T=>this.windowOptions(T)),this._parser.registerCsiHandler({final:"u"},T=>this.restoreCursor(T)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},T=>this.insertColumns(T)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},T=>this.deleteColumns(T)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},T=>this.selectProtected(T)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},T=>this.requestMode(T,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},T=>this.requestMode(T,!1)),this._parser.setExecuteHandler(a.C0.BEL,()=>this.bell()),this._parser.setExecuteHandler(a.C0.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(a.C0.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(a.C0.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(a.C0.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(a.C0.BS,()=>this.backspace()),this._parser.setExecuteHandler(a.C0.HT,()=>this.tab()),this._parser.setExecuteHandler(a.C0.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(a.C0.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(a.C1.IND,()=>this.index()),this._parser.setExecuteHandler(a.C1.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(a.C1.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new S.OscHandler(T=>(this.setTitle(T),this.setIconName(T),!0))),this._parser.registerOscHandler(1,new S.OscHandler(T=>this.setIconName(T))),this._parser.registerOscHandler(2,new S.OscHandler(T=>this.setTitle(T))),this._parser.registerOscHandler(4,new S.OscHandler(T=>this.setOrReportIndexedColor(T))),this._parser.registerOscHandler(8,new S.OscHandler(T=>this.setHyperlink(T))),this._parser.registerOscHandler(10,new S.OscHandler(T=>this.setOrReportFgColor(T))),this._parser.registerOscHandler(11,new S.OscHandler(T=>this.setOrReportBgColor(T))),this._parser.registerOscHandler(12,new S.OscHandler(T=>this.setOrReportCursorColor(T))),this._parser.registerOscHandler(104,new S.OscHandler(T=>this.restoreIndexedColor(T))),this._parser.registerOscHandler(110,new S.OscHandler(T=>this.restoreFgColor(T))),this._parser.registerOscHandler(111,new S.OscHandler(T=>this.restoreBgColor(T))),this._parser.registerOscHandler(112,new S.OscHandler(T=>this.restoreCursorColor(T))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(let T in l.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:T},()=>this.selectCharset("("+T)),this._parser.registerEscHandler({intermediates:")",final:T},()=>this.selectCharset(")"+T)),this._parser.registerEscHandler({intermediates:"*",final:T},()=>this.selectCharset("*"+T)),this._parser.registerEscHandler({intermediates:"+",final:T},()=>this.selectCharset("+"+T)),this._parser.registerEscHandler({intermediates:"-",final:T},()=>this.selectCharset("-"+T)),this._parser.registerEscHandler({intermediates:".",final:T},()=>this.selectCharset("."+T)),this._parser.registerEscHandler({intermediates:"/",final:T},()=>this.selectCharset("/"+T));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler(T=>(this._logService.error("Parsing error: ",T),T)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new A.DcsHandler((T,U)=>this.requestStatusString(T,U)))}_preserveStack(m,x,E,I){this._parseStack.paused=!0,this._parseStack.cursorStartX=m,this._parseStack.cursorStartY=x,this._parseStack.decodedLength=E,this._parseStack.position=I}_logSlowResolvingAsync(m){this._logService.logLevel<=w.LogLevelEnum.WARN&&Promise.race([m,new Promise((x,E)=>setTimeout(()=>E("#SLOW_TIMEOUT"),5e3))]).catch(x=>{if(x!=="#SLOW_TIMEOUT")throw x;console.warn("async parser handler taking longer than 5000 ms")})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(m,x){let E,I=this._activeBuffer.x,M=this._activeBuffer.y,X=0,$=this._parseStack.paused;if($){if(E=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,x))return this._logSlowResolvingAsync(E),E;I=this._parseStack.cursorStartX,M=this._parseStack.cursorStartY,this._parseStack.paused=!1,m.length>L&&(X=this._parseStack.position+L)}if(this._logService.logLevel<=w.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+(typeof m=="string"?` "${m}"`:` "${Array.prototype.map.call(m,T=>String.fromCharCode(T)).join("")}"`),typeof m=="string"?m.split("").map(T=>T.charCodeAt(0)):m),this._parseBuffer.length<m.length&&this._parseBuffer.length<L&&(this._parseBuffer=new Uint32Array(Math.min(m.length,L))),$||this._dirtyRowTracker.clearRange(),m.length>L)for(let T=X;T<m.length;T+=L){let U=T+L<m.length?T+L:m.length,Z=typeof m=="string"?this._stringDecoder.decode(m.substring(T,U),this._parseBuffer):this._utf8Decoder.decode(m.subarray(T,U),this._parseBuffer);if(E=this._parser.parse(this._parseBuffer,Z))return this._preserveStack(I,M,Z,T),this._logSlowResolvingAsync(E),E}else if(!$){let T=typeof m=="string"?this._stringDecoder.decode(m,this._parseBuffer):this._utf8Decoder.decode(m,this._parseBuffer);if(E=this._parser.parse(this._parseBuffer,T))return this._preserveStack(I,M,T,0),this._logSlowResolvingAsync(E),E}this._activeBuffer.x===I&&this._activeBuffer.y===M||this._onCursorMove.fire();let W=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),P=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);P<this._bufferService.rows&&this._onRequestRefreshRows.fire(Math.min(P,this._bufferService.rows-1),Math.min(W,this._bufferService.rows-1))}print(m,x,E){let I,M,X=this._charsetService.charset,$=this._optionsService.rawOptions.screenReaderMode,W=this._bufferService.cols,P=this._coreService.decPrivateModes.wraparound,T=this._coreService.modes.insertMode,U=this._curAttrData,Z=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&E-x>0&&Z.getWidth(this._activeBuffer.x-1)===2&&Z.setCellFromCodepoint(this._activeBuffer.x-1,0,1,U);let te=this._parser.precedingJoinState;for(let ee=x;ee<E;++ee){if(I=m[ee],I<127&&X){let he=X[String.fromCharCode(I)];he&&(I=he.charCodeAt(0))}let le=this._unicodeService.charProperties(I,te);M=b.UnicodeService.extractWidth(le);let be=b.UnicodeService.extractShouldJoin(le),ye=be?b.UnicodeService.extractWidth(te):0;if(te=le,$&&this._onA11yChar.fire((0,u.stringFromCodePoint)(I)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+M-ye>W){if(P){let he=Z,ne=this._activeBuffer.x-ye;for(this._activeBuffer.x=ye,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),Z=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),ye>0&&Z instanceof o.BufferLine&&Z.copyCellsFrom(he,ne,0,ye,!1);ne<W;)he.setCellFromCodepoint(ne++,0,1,U)}else if(this._activeBuffer.x=W-1,M===2)continue}if(be&&this._activeBuffer.x){let he=Z.getWidth(this._activeBuffer.x-1)?1:2;Z.addCodepointToCell(this._activeBuffer.x-he,I,M);for(let ne=M-ye;--ne>=0;)Z.setCellFromCodepoint(this._activeBuffer.x++,0,0,U)}else if(T&&(Z.insertCells(this._activeBuffer.x,M-ye,this._activeBuffer.getNullCell(U)),Z.getWidth(W-1)===2&&Z.setCellFromCodepoint(W-1,f.NULL_CELL_CODE,f.NULL_CELL_WIDTH,U)),Z.setCellFromCodepoint(this._activeBuffer.x++,I,M,U),M>0)for(;--M;)Z.setCellFromCodepoint(this._activeBuffer.x++,0,0,U)}this._parser.precedingJoinState=te,this._activeBuffer.x<W&&E-x>0&&Z.getWidth(this._activeBuffer.x)===0&&!Z.hasContent(this._activeBuffer.x)&&Z.setCellFromCodepoint(this._activeBuffer.x,0,1,U),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(m,x){return m.final!=="t"||m.prefix||m.intermediates?this._parser.registerCsiHandler(m,x):this._parser.registerCsiHandler(m,E=>!B(E.params[0],this._optionsService.rawOptions.windowOptions)||x(E))}registerDcsHandler(m,x){return this._parser.registerDcsHandler(m,new A.DcsHandler(x))}registerEscHandler(m,x){return this._parser.registerEscHandler(m,x)}registerOscHandler(m,x){return this._parser.registerOscHandler(m,new S.OscHandler(x))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)?.isWrapped){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;let m=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);m.hasWidth(this._activeBuffer.x)&&!m.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let m=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-m),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(m=this._bufferService.cols-1){this._activeBuffer.x=Math.min(m,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(m,x){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=m,this._activeBuffer.y=this._activeBuffer.scrollTop+x):(this._activeBuffer.x=m,this._activeBuffer.y=x),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(m,x){this._restrictCursor(),this._setCursor(this._activeBuffer.x+m,this._activeBuffer.y+x)}cursorUp(m){let x=this._activeBuffer.y-this._activeBuffer.scrollTop;return x>=0?this._moveCursor(0,-Math.min(x,m.params[0]||1)):this._moveCursor(0,-(m.params[0]||1)),!0}cursorDown(m){let x=this._activeBuffer.scrollBottom-this._activeBuffer.y;return x>=0?this._moveCursor(0,Math.min(x,m.params[0]||1)):this._moveCursor(0,m.params[0]||1),!0}cursorForward(m){return this._moveCursor(m.params[0]||1,0),!0}cursorBackward(m){return this._moveCursor(-(m.params[0]||1),0),!0}cursorNextLine(m){return this.cursorDown(m),this._activeBuffer.x=0,!0}cursorPrecedingLine(m){return this.cursorUp(m),this._activeBuffer.x=0,!0}cursorCharAbsolute(m){return this._setCursor((m.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(m){return this._setCursor(m.length>=2?(m.params[1]||1)-1:0,(m.params[0]||1)-1),!0}charPosAbsolute(m){return this._setCursor((m.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(m){return this._moveCursor(m.params[0]||1,0),!0}linePosAbsolute(m){return this._setCursor(this._activeBuffer.x,(m.params[0]||1)-1),!0}vPositionRelative(m){return this._moveCursor(0,m.params[0]||1),!0}hVPosition(m){return this.cursorPosition(m),!0}tabClear(m){let x=m.params[0];return x===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:x===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(m){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let x=m.params[0]||1;for(;x--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(m){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let x=m.params[0]||1;for(;x--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(m){let x=m.params[0];return x===1&&(this._curAttrData.bg|=536870912),x!==2&&x!==0||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(m,x,E,I=!1,M=!1){let X=this._activeBuffer.lines.get(this._activeBuffer.ybase+m);X.replaceCells(x,E,this._activeBuffer.getNullCell(this._eraseAttrData()),M),I&&(X.isWrapped=!1)}_resetBufferLine(m,x=!1){let E=this._activeBuffer.lines.get(this._activeBuffer.ybase+m);E&&(E.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),x),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+m),E.isWrapped=!1)}eraseInDisplay(m,x=!1){let E;switch(this._restrictCursor(this._bufferService.cols),m.params[0]){case 0:for(E=this._activeBuffer.y,this._dirtyRowTracker.markDirty(E),this._eraseInBufferLine(E++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,x);E<this._bufferService.rows;E++)this._resetBufferLine(E,x);this._dirtyRowTracker.markDirty(E);break;case 1:for(E=this._activeBuffer.y,this._dirtyRowTracker.markDirty(E),this._eraseInBufferLine(E,0,this._activeBuffer.x+1,!0,x),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(E+1).isWrapped=!1);E--;)this._resetBufferLine(E,x);this._dirtyRowTracker.markDirty(0);break;case 2:for(E=this._bufferService.rows,this._dirtyRowTracker.markDirty(E-1);E--;)this._resetBufferLine(E,x);this._dirtyRowTracker.markDirty(0);break;case 3:let I=this._activeBuffer.lines.length-this._bufferService.rows;I>0&&(this._activeBuffer.lines.trimStart(I),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-I,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-I,0),this._onScroll.fire(0))}return!0}eraseInLine(m,x=!1){switch(this._restrictCursor(this._bufferService.cols),m.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,x);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,x);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,x)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(m){this._restrictCursor();let x=m.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let E=this._activeBuffer.ybase+this._activeBuffer.y,I=this._bufferService.rows-1-this._activeBuffer.scrollBottom,M=this._bufferService.rows-1+this._activeBuffer.ybase-I+1;for(;x--;)this._activeBuffer.lines.splice(M-1,1),this._activeBuffer.lines.splice(E,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(m){this._restrictCursor();let x=m.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let E=this._activeBuffer.ybase+this._activeBuffer.y,I;for(I=this._bufferService.rows-1-this._activeBuffer.scrollBottom,I=this._bufferService.rows-1+this._activeBuffer.ybase-I;x--;)this._activeBuffer.lines.splice(E,1),this._activeBuffer.lines.splice(I,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(m){this._restrictCursor();let x=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return x&&(x.insertCells(this._activeBuffer.x,m.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(m){this._restrictCursor();let x=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return x&&(x.deleteCells(this._activeBuffer.x,m.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(m){let x=m.params[0]||1;for(;x--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(m){let x=m.params[0]||1;for(;x--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(o.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(m){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let x=m.params[0]||1;for(let E=this._activeBuffer.scrollTop;E<=this._activeBuffer.scrollBottom;++E){let I=this._activeBuffer.lines.get(this._activeBuffer.ybase+E);I.deleteCells(0,x,this._activeBuffer.getNullCell(this._eraseAttrData())),I.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(m){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let x=m.params[0]||1;for(let E=this._activeBuffer.scrollTop;E<=this._activeBuffer.scrollBottom;++E){let I=this._activeBuffer.lines.get(this._activeBuffer.ybase+E);I.insertCells(0,x,this._activeBuffer.getNullCell(this._eraseAttrData())),I.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(m){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let x=m.params[0]||1;for(let E=this._activeBuffer.scrollTop;E<=this._activeBuffer.scrollBottom;++E){let I=this._activeBuffer.lines.get(this._activeBuffer.ybase+E);I.insertCells(this._activeBuffer.x,x,this._activeBuffer.getNullCell(this._eraseAttrData())),I.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(m){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let x=m.params[0]||1;for(let E=this._activeBuffer.scrollTop;E<=this._activeBuffer.scrollBottom;++E){let I=this._activeBuffer.lines.get(this._activeBuffer.ybase+E);I.deleteCells(this._activeBuffer.x,x,this._activeBuffer.getNullCell(this._eraseAttrData())),I.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(m){this._restrictCursor();let x=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return x&&(x.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(m.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(m){let x=this._parser.precedingJoinState;if(!x)return!0;let E=m.params[0]||1,I=b.UnicodeService.extractWidth(x),M=this._activeBuffer.x-I,X=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(M),$=new Uint32Array(X.length*E),W=0;for(let T=0;T<X.length;){let U=X.codePointAt(T)||0;$[W++]=U,T+=U>65535?2:1}let P=W;for(let T=1;T<E;++T)$.copyWithin(P,0,W),P+=W;return this.print($,0,P),!0}sendDeviceAttributesPrimary(m){return m.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(a.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(a.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(m){return m.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(a.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(a.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(m.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(a.C0.ESC+"[>83;40003;0c")),!0}_is(m){return(this._optionsService.rawOptions.termName+"").indexOf(m)===0}setMode(m){for(let x=0;x<m.length;x++)switch(m.params[x]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(m){for(let x=0;x<m.length;x++)switch(m.params[x]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,l.DEFAULT_CHARSET),this._charsetService.setgCharset(1,l.DEFAULT_CHARSET),this._charsetService.setgCharset(2,l.DEFAULT_CHARSET),this._charsetService.setgCharset(3,l.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(m){for(let x=0;x<m.length;x++)switch(m.params[x]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(m){for(let x=0;x<m.length;x++)switch(m.params[x]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),m.params[x]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(m,x){let E=this._coreService.decPrivateModes,{activeProtocol:I,activeEncoding:M}=this._coreMouseService,X=this._coreService,{buffers:$,cols:W}=this._bufferService,{active:P,alt:T}=$,U=this._optionsService.rawOptions,Z=be=>be?1:2,te=m.params[0];return ee=te,le=x?te===2?4:te===4?Z(X.modes.insertMode):te===12?3:te===20?Z(U.convertEol):0:te===1?Z(E.applicationCursorKeys):te===3?U.windowOptions.setWinLines?W===80?2:W===132?1:0:0:te===6?Z(E.origin):te===7?Z(E.wraparound):te===8?3:te===9?Z(I==="X10"):te===12?Z(U.cursorBlink):te===25?Z(!X.isCursorHidden):te===45?Z(E.reverseWraparound):te===66?Z(E.applicationKeypad):te===67?4:te===1e3?Z(I==="VT200"):te===1002?Z(I==="DRAG"):te===1003?Z(I==="ANY"):te===1004?Z(E.sendFocus):te===1005?4:te===1006?Z(M==="SGR"):te===1015?4:te===1016?Z(M==="SGR_PIXELS"):te===1048?1:te===47||te===1047||te===1049?Z(P===T):te===2004?Z(E.bracketedPasteMode):0,X.triggerDataEvent(`${a.C0.ESC}[${x?"":"?"}${ee};${le}$y`),!0;var ee,le}_updateAttrColor(m,x,E,I,M){return x===2?(m|=50331648,m&=-16777216,m|=y.AttributeData.fromColorRGB([E,I,M])):x===5&&(m&=-50331904,m|=33554432|255&E),m}_extractColor(m,x,E){let I=[0,0,-1,0,0,0],M=0,X=0;do{if(I[X+M]=m.params[x+X],m.hasSubParams(x+X)){let $=m.getSubParams(x+X),W=0;do I[1]===5&&(M=1),I[X+W+1+M]=$[W];while(++W<$.length&&W+X+1+M<I.length);break}if(I[1]===5&&X+M>=2||I[1]===2&&X+M>=5)break;I[1]&&(M=1)}while(++X+x<m.length&&X+M<I.length);for(let $=2;$<I.length;++$)I[$]===-1&&(I[$]=0);switch(I[0]){case 38:E.fg=this._updateAttrColor(E.fg,I[1],I[3],I[4],I[5]);break;case 48:E.bg=this._updateAttrColor(E.bg,I[1],I[3],I[4],I[5]);break;case 58:E.extended=E.extended.clone(),E.extended.underlineColor=this._updateAttrColor(E.extended.underlineColor,I[1],I[3],I[4],I[5])}return X}_processUnderline(m,x){x.extended=x.extended.clone(),(!~m||m>5)&&(m=1),x.extended.underlineStyle=m,x.fg|=268435456,m===0&&(x.fg&=-268435457),x.updateExtended()}_processSGR0(m){m.fg=o.DEFAULT_ATTR_DATA.fg,m.bg=o.DEFAULT_ATTR_DATA.bg,m.extended=m.extended.clone(),m.extended.underlineStyle=0,m.extended.underlineColor&=-67108864,m.updateExtended()}charAttributes(m){if(m.length===1&&m.params[0]===0)return this._processSGR0(this._curAttrData),!0;let x=m.length,E,I=this._curAttrData;for(let M=0;M<x;M++)E=m.params[M],E>=30&&E<=37?(I.fg&=-50331904,I.fg|=16777216|E-30):E>=40&&E<=47?(I.bg&=-50331904,I.bg|=16777216|E-40):E>=90&&E<=97?(I.fg&=-50331904,I.fg|=16777224|E-90):E>=100&&E<=107?(I.bg&=-50331904,I.bg|=16777224|E-100):E===0?this._processSGR0(I):E===1?I.fg|=134217728:E===3?I.bg|=67108864:E===4?(I.fg|=268435456,this._processUnderline(m.hasSubParams(M)?m.getSubParams(M)[0]:1,I)):E===5?I.fg|=536870912:E===7?I.fg|=67108864:E===8?I.fg|=1073741824:E===9?I.fg|=2147483648:E===2?I.bg|=134217728:E===21?this._processUnderline(2,I):E===22?(I.fg&=-134217729,I.bg&=-134217729):E===23?I.bg&=-67108865:E===24?(I.fg&=-268435457,this._processUnderline(0,I)):E===25?I.fg&=-536870913:E===27?I.fg&=-67108865:E===28?I.fg&=-1073741825:E===29?I.fg&=2147483647:E===39?(I.fg&=-67108864,I.fg|=16777215&o.DEFAULT_ATTR_DATA.fg):E===49?(I.bg&=-67108864,I.bg|=16777215&o.DEFAULT_ATTR_DATA.bg):E===38||E===48||E===58?M+=this._extractColor(m,M,I):E===53?I.bg|=1073741824:E===55?I.bg&=-1073741825:E===59?(I.extended=I.extended.clone(),I.extended.underlineColor=-1,I.updateExtended()):E===100?(I.fg&=-67108864,I.fg|=16777215&o.DEFAULT_ATTR_DATA.fg,I.bg&=-67108864,I.bg|=16777215&o.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",E);return!0}deviceStatus(m){switch(m.params[0]){case 5:this._coreService.triggerDataEvent(`${a.C0.ESC}[0n`);break;case 6:let x=this._activeBuffer.y+1,E=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${a.C0.ESC}[${x};${E}R`)}return!0}deviceStatusPrivate(m){if(m.params[0]===6){let x=this._activeBuffer.y+1,E=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${a.C0.ESC}[?${x};${E}R`)}return!0}softReset(m){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=o.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(m){let x=m.params[0]||1;switch(x){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}let E=x%2==1;return this._optionsService.options.cursorBlink=E,!0}setScrollRegion(m){let x=m.params[0]||1,E;return(m.length<2||(E=m.params[1])>this._bufferService.rows||E===0)&&(E=this._bufferService.rows),E>x&&(this._activeBuffer.scrollTop=x-1,this._activeBuffer.scrollBottom=E-1,this._setCursor(0,0)),!0}windowOptions(m){if(!B(m.params[0],this._optionsService.rawOptions.windowOptions))return!0;let x=m.length>1?m.params[1]:0;switch(m.params[0]){case 14:x!==2&&this._onRequestWindowsOptionsReport.fire(R.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(R.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${a.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:x!==0&&x!==2||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),x!==0&&x!==1||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:x!==0&&x!==2||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),x!==0&&x!==1||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(m){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(m){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(m){return this._windowTitle=m,this._onTitleChange.fire(m),!0}setIconName(m){return this._iconName=m,!0}setOrReportIndexedColor(m){let x=[],E=m.split(";");for(;E.length>1;){let I=E.shift(),M=E.shift();if(/^\d+$/.exec(I)){let X=parseInt(I);if(N(X))if(M==="?")x.push({type:0,index:X});else{let $=(0,C.parseColor)(M);$&&x.push({type:1,index:X,color:$})}}}return x.length&&this._onColor.fire(x),!0}setHyperlink(m){let x=m.split(";");return!(x.length<2)&&(x[1]?this._createHyperlink(x[0],x[1]):!x[0]&&this._finishHyperlink())}_createHyperlink(m,x){this._getCurrentLinkId()&&this._finishHyperlink();let E=m.split(":"),I,M=E.findIndex(X=>X.startsWith("id="));return M!==-1&&(I=E[M].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:I,uri:x}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(m,x){let E=m.split(";");for(let I=0;I<E.length&&!(x>=this._specialColors.length);++I,++x)if(E[I]==="?")this._onColor.fire([{type:0,index:this._specialColors[x]}]);else{let M=(0,C.parseColor)(E[I]);M&&this._onColor.fire([{type:1,index:this._specialColors[x],color:M}])}return!0}setOrReportFgColor(m){return this._setOrReportSpecialColor(m,0)}setOrReportBgColor(m){return this._setOrReportSpecialColor(m,1)}setOrReportCursorColor(m){return this._setOrReportSpecialColor(m,2)}restoreIndexedColor(m){if(!m)return this._onColor.fire([{type:2}]),!0;let x=[],E=m.split(";");for(let I=0;I<E.length;++I)if(/^\d+$/.exec(E[I])){let M=parseInt(E[I]);N(M)&&x.push({type:2,index:M})}return x.length&&this._onColor.fire(x),!0}restoreFgColor(m){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(m){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(m){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,l.DEFAULT_CHARSET),!0}selectCharset(m){return m.length!==2?(this.selectDefaultCharset(),!0):(m[0]==="/"||this._charsetService.setgCharset(D[m[0]],l.CHARSETS[m[1]]||l.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){let m=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,m,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=o.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=o.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(m){return this._charsetService.setgLevel(m),!0}screenAlignmentPattern(){let m=new p.CellData;m.content=4194373,m.fg=this._curAttrData.fg,m.bg=this._curAttrData.bg,this._setCursor(0,0);for(let x=0;x<this._bufferService.rows;++x){let E=this._activeBuffer.ybase+this._activeBuffer.y+x,I=this._activeBuffer.lines.get(E);I&&(I.fill(m),I.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(m,x){let E=this._bufferService.buffer,I=this._optionsService.rawOptions;return(M=>(this._coreService.triggerDataEvent(`${a.C0.ESC}${M}${a.C0.ESC}\\`),!0))(m==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:m==='"p'?'P1$r61;1"p':m==="r"?`P1$r${E.scrollTop+1};${E.scrollBottom+1}r`:m==="m"?"P1$r0m":m===" q"?`P1$r${{block:2,underline:4,bar:6}[I.cursorStyle]-(I.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(m,x){this._dirtyRowTracker.markRangeDirty(m,x)}}t.InputHandler=K;let Q=class{constructor(k){this._bufferService=k,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(k){k<this.start?this.start=k:k>this.end&&(this.end=k)}markRangeDirty(k,m){k>m&&(F=k,k=m,m=F),k<this.start&&(this.start=k),m>this.end&&(this.end=m)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function N(k){return 0<=k&&k<256}Q=h([g(0,w.IBufferService)],Q)},844:(c,t)=>{function n(h){for(let g of h)g.dispose();h.length=0}Object.defineProperty(t,"__esModule",{value:!0}),t.getDisposeArrayDisposable=t.disposeArray=t.toDisposable=t.MutableDisposable=t.Disposable=void 0,t.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(let h of this._disposables)h.dispose();this._disposables.length=0}register(h){return this._disposables.push(h),h}unregister(h){let g=this._disposables.indexOf(h);g!==-1&&this._disposables.splice(g,1)}},t.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(h){this._isDisposed||h===this._value||(this._value?.dispose(),this._value=h)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,this._value?.dispose(),this._value=void 0}},t.toDisposable=function(h){return{dispose:h}},t.disposeArray=n,t.getDisposeArrayDisposable=function(h){return{dispose:()=>n(h)}}},1505:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FourKeyMap=t.TwoKeyMap=void 0;class n{constructor(){this._data={}}set(g,a,l){this._data[g]||(this._data[g]={}),this._data[g][a]=l}get(g,a){return this._data[g]?this._data[g][a]:void 0}clear(){this._data={}}}t.TwoKeyMap=n,t.FourKeyMap=class{constructor(){this._data=new n}set(h,g,a,l,_){this._data.get(h,g)||this._data.set(h,g,new n),this._data.get(h,g).set(a,l,_)}get(h,g,a,l){return this._data.get(h,g)?.get(a,l)}clear(){this._data.clear()}}},6114:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isChromeOS=t.isLinux=t.isWindows=t.isIphone=t.isIpad=t.isMac=t.getSafariVersion=t.isSafari=t.isLegacyEdge=t.isFirefox=t.isNode=void 0,t.isNode=typeof process<"u"&&"title"in process;let n=t.isNode?"node":navigator.userAgent,h=t.isNode?"node":navigator.platform;t.isFirefox=n.includes("Firefox"),t.isLegacyEdge=n.includes("Edge"),t.isSafari=/^((?!chrome|android).)*safari/i.test(n),t.getSafariVersion=function(){if(!t.isSafari)return 0;let g=n.match(/Version\/(\d+)/);return g===null||g.length<2?0:parseInt(g[1])},t.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(h),t.isIpad=h==="iPad",t.isIphone=h==="iPhone",t.isWindows=["Windows","Win16","Win32","WinCE"].includes(h),t.isLinux=h.indexOf("Linux")>=0,t.isChromeOS=/\bCrOS\b/.test(n)},6106:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SortedList=void 0;let n=0;t.SortedList=class{constructor(h){this._getKey=h,this._array=[]}clear(){this._array.length=0}insert(h){this._array.length!==0?(n=this._search(this._getKey(h)),this._array.splice(n,0,h)):this._array.push(h)}delete(h){if(this._array.length===0)return!1;let g=this._getKey(h);if(g===void 0||(n=this._search(g),n===-1)||this._getKey(this._array[n])!==g)return!1;do if(this._array[n]===h)return this._array.splice(n,1),!0;while(++n<this._array.length&&this._getKey(this._array[n])===g);return!1}*getKeyIterator(h){if(this._array.length!==0&&(n=this._search(h),!(n<0||n>=this._array.length)&&this._getKey(this._array[n])===h))do yield this._array[n];while(++n<this._array.length&&this._getKey(this._array[n])===h)}forEachByKey(h,g){if(this._array.length!==0&&(n=this._search(h),!(n<0||n>=this._array.length)&&this._getKey(this._array[n])===h))do g(this._array[n]);while(++n<this._array.length&&this._getKey(this._array[n])===h)}values(){return[...this._array].values()}_search(h){let g=0,a=this._array.length-1;for(;a>=g;){let l=g+a>>1,_=this._getKey(this._array[l]);if(_>h)a=l-1;else{if(!(_<h)){for(;l>0&&this._getKey(this._array[l-1])===h;)l--;return l}g=l+1}}return g}}},7226:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DebouncedIdleTask=t.IdleTaskQueue=t.PriorityTaskQueue=void 0;let h=n(6114);class g{constructor(){this._tasks=[],this._i=0}enqueue(_){this._tasks.push(_),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(_){this._idleCallback=void 0;let v=0,u=0,o=_.timeRemaining(),d=0;for(;this._i<this._tasks.length;){if(v=Date.now(),this._tasks[this._i]()||this._i++,v=Math.max(1,Date.now()-v),u=Math.max(v,u),d=_.timeRemaining(),1.5*u>d)return o-v<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(o-v))}ms`),void this._start();o=d}this.clear()}}class a extends g{_requestCallback(_){return setTimeout(()=>_(this._createDeadline(16)))}_cancelCallback(_){clearTimeout(_)}_createDeadline(_){let v=Date.now()+_;return{timeRemaining:()=>Math.max(0,v-Date.now())}}}t.PriorityTaskQueue=a,t.IdleTaskQueue=!h.isNode&&"requestIdleCallback"in window?class extends g{_requestCallback(l){return requestIdleCallback(l)}_cancelCallback(l){cancelIdleCallback(l)}}:a,t.DebouncedIdleTask=class{constructor(){this._queue=new t.IdleTaskQueue}set(l){this._queue.clear(),this._queue.enqueue(l)}flush(){this._queue.flush()}}},9282:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.updateWindowsModeWrappedState=void 0;let h=n(643);t.updateWindowsModeWrappedState=function(g){let a=g.buffer.lines.get(g.buffer.ybase+g.buffer.y-1),l=a?.get(g.cols-1),_=g.buffer.lines.get(g.buffer.ybase+g.buffer.y);_&&l&&(_.isWrapped=l[h.CHAR_DATA_CODE_INDEX]!==h.NULL_CELL_CODE&&l[h.CHAR_DATA_CODE_INDEX]!==h.WHITESPACE_CELL_CODE)}},3734:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExtendedAttrs=t.AttributeData=void 0;class n{constructor(){this.fg=0,this.bg=0,this.extended=new h}static toColorRGB(a){return[a>>>16&255,a>>>8&255,255&a]}static fromColorRGB(a){return(255&a[0])<<16|(255&a[1])<<8|255&a[2]}clone(){let a=new n;return a.fg=this.fg,a.bg=this.bg,a.extended=this.extended.clone(),a}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}}t.AttributeData=n;class h{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(a){this._ext=a}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(a){this._ext&=-469762049,this._ext|=a<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(a){this._ext&=-67108864,this._ext|=67108863&a}get urlId(){return this._urlId}set urlId(a){this._urlId=a}get underlineVariantOffset(){let a=(3758096384&this._ext)>>29;return a<0?4294967288^a:a}set underlineVariantOffset(a){this._ext&=536870911,this._ext|=a<<29&3758096384}constructor(a=0,l=0){this._ext=0,this._urlId=0,this._ext=a,this._urlId=l}clone(){return new h(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}t.ExtendedAttrs=h},9092:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Buffer=t.MAX_BUFFER_SIZE=void 0;let h=n(6349),g=n(7226),a=n(3734),l=n(8437),_=n(4634),v=n(511),u=n(643),o=n(4863),d=n(7116);t.MAX_BUFFER_SIZE=4294967295,t.Buffer=class{constructor(f,p,y){this._hasScrollback=f,this._optionsService=p,this._bufferService=y,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=l.DEFAULT_ATTR_DATA.clone(),this.savedCharset=d.DEFAULT_CHARSET,this.markers=[],this._nullCell=v.CellData.fromCharData([0,u.NULL_CELL_CHAR,u.NULL_CELL_WIDTH,u.NULL_CELL_CODE]),this._whitespaceCell=v.CellData.fromCharData([0,u.WHITESPACE_CELL_CHAR,u.WHITESPACE_CELL_WIDTH,u.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new g.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new h.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(f){return f?(this._nullCell.fg=f.fg,this._nullCell.bg=f.bg,this._nullCell.extended=f.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new a.ExtendedAttrs),this._nullCell}getWhitespaceCell(f){return f?(this._whitespaceCell.fg=f.fg,this._whitespaceCell.bg=f.bg,this._whitespaceCell.extended=f.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new a.ExtendedAttrs),this._whitespaceCell}getBlankLine(f,p){return new l.BufferLine(this._bufferService.cols,this.getNullCell(f),p)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){let f=this.ybase+this.y-this.ydisp;return f>=0&&f<this._rows}_getCorrectBufferLength(f){if(!this._hasScrollback)return f;let p=f+this._optionsService.rawOptions.scrollback;return p>t.MAX_BUFFER_SIZE?t.MAX_BUFFER_SIZE:p}fillViewportRows(f){if(this.lines.length===0){f===void 0&&(f=l.DEFAULT_ATTR_DATA);let p=this._rows;for(;p--;)this.lines.push(this.getBlankLine(f))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new h.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(f,p){let y=this.getNullCell(l.DEFAULT_ATTR_DATA),w=0,b=this._getCorrectBufferLength(p);if(b>this.lines.maxLength&&(this.lines.maxLength=b),this.lines.length>0){if(this._cols<f)for(let A=0;A<this.lines.length;A++)w+=+this.lines.get(A).resize(f,y);let S=0;if(this._rows<p)for(let A=this._rows;A<p;A++)this.lines.length<p+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new l.BufferLine(f,y)):this.ybase>0&&this.lines.length<=this.ybase+this.y+S+1?(this.ybase--,S++,this.ydisp>0&&this.ydisp--):this.lines.push(new l.BufferLine(f,y)));else for(let A=this._rows;A>p;A--)this.lines.length>p+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(b<this.lines.maxLength){let A=this.lines.length-b;A>0&&(this.lines.trimStart(A),this.ybase=Math.max(this.ybase-A,0),this.ydisp=Math.max(this.ydisp-A,0),this.savedY=Math.max(this.savedY-A,0)),this.lines.maxLength=b}this.x=Math.min(this.x,f-1),this.y=Math.min(this.y,p-1),S&&(this.y+=S),this.savedX=Math.min(this.savedX,f-1),this.scrollTop=0}if(this.scrollBottom=p-1,this._isReflowEnabled&&(this._reflow(f,p),this._cols>f))for(let S=0;S<this.lines.length;S++)w+=+this.lines.get(S).resize(f,y);this._cols=f,this._rows=p,this._memoryCleanupQueue.clear(),w>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let f=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,f=!1);let p=0;for(;this._memoryCleanupPosition<this.lines.length;)if(p+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),p>100)return!0;return f}get _isReflowEnabled(){let f=this._optionsService.rawOptions.windowsPty;return f&&f.buildNumber?this._hasScrollback&&f.backend==="conpty"&&f.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(f,p){this._cols!==f&&(f>this._cols?this._reflowLarger(f,p):this._reflowSmaller(f,p))}_reflowLarger(f,p){let y=(0,_.reflowLargerGetLinesToRemove)(this.lines,this._cols,f,this.ybase+this.y,this.getNullCell(l.DEFAULT_ATTR_DATA));if(y.length>0){let w=(0,_.reflowLargerCreateNewLayout)(this.lines,y);(0,_.reflowLargerApplyNewLayout)(this.lines,w.layout),this._reflowLargerAdjustViewport(f,p,w.countRemoved)}}_reflowLargerAdjustViewport(f,p,y){let w=this.getNullCell(l.DEFAULT_ATTR_DATA),b=y;for(;b-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<p&&this.lines.push(new l.BufferLine(f,w))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-y,0)}_reflowSmaller(f,p){let y=this.getNullCell(l.DEFAULT_ATTR_DATA),w=[],b=0;for(let S=this.lines.length-1;S>=0;S--){let A=this.lines.get(S);if(!A||!A.isWrapped&&A.getTrimmedLength()<=f)continue;let C=[A];for(;A.isWrapped&&S>0;)A=this.lines.get(--S),C.unshift(A);let D=this.ybase+this.y;if(D>=S&&D<S+C.length)continue;let L=C[C.length-1].getTrimmedLength(),B=(0,_.reflowSmallerGetNewLineLengths)(C,this._cols,f),R=B.length-C.length,F;F=this.ybase===0&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+R):Math.max(0,this.lines.length-this.lines.maxLength+R);let K=[];for(let E=0;E<R;E++){let I=this.getBlankLine(l.DEFAULT_ATTR_DATA,!0);K.push(I)}K.length>0&&(w.push({start:S+C.length+b,newLines:K}),b+=K.length),C.push(...K);let Q=B.length-1,N=B[Q];N===0&&(Q--,N=B[Q]);let k=C.length-R-1,m=L;for(;k>=0;){let E=Math.min(m,N);if(C[Q]===void 0)break;if(C[Q].copyCellsFrom(C[k],m-E,N-E,E,!0),N-=E,N===0&&(Q--,N=B[Q]),m-=E,m===0){k--;let I=Math.max(k,0);m=(0,_.getWrappedLineTrimmedLength)(C,I,this._cols)}}for(let E=0;E<C.length;E++)B[E]<f&&C[E].setCell(B[E],y);let x=R-F;for(;x-- >0;)this.ybase===0?this.y<p-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+b)-p&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+R,this.ybase+p-1)}if(w.length>0){let S=[],A=[];for(let Q=0;Q<this.lines.length;Q++)A.push(this.lines.get(Q));let C=this.lines.length,D=C-1,L=0,B=w[L];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+b);let R=0;for(let Q=Math.min(this.lines.maxLength-1,C+b-1);Q>=0;Q--)if(B&&B.start>D+R){for(let N=B.newLines.length-1;N>=0;N--)this.lines.set(Q--,B.newLines[N]);Q++,S.push({index:D+1,amount:B.newLines.length}),R+=B.newLines.length,B=w[++L]}else this.lines.set(Q,A[D--]);let F=0;for(let Q=S.length-1;Q>=0;Q--)S[Q].index+=F,this.lines.onInsertEmitter.fire(S[Q]),F+=S[Q].amount;let K=Math.max(0,C+b-this.lines.maxLength);K>0&&this.lines.onTrimEmitter.fire(K)}}translateBufferLineToString(f,p,y=0,w){let b=this.lines.get(f);return b?b.translateToString(p,y,w):""}getWrappedRangeForLine(f){let p=f,y=f;for(;p>0&&this.lines.get(p).isWrapped;)p--;for(;y+1<this.lines.length&&this.lines.get(y+1).isWrapped;)y++;return{first:p,last:y}}setupTabStops(f){for(f!=null?this.tabs[f]||(f=this.prevStop(f)):(this.tabs={},f=0);f<this._cols;f+=this._optionsService.rawOptions.tabStopWidth)this.tabs[f]=!0}prevStop(f){for(f==null&&(f=this.x);!this.tabs[--f]&&f>0;);return f>=this._cols?this._cols-1:f<0?0:f}nextStop(f){for(f==null&&(f=this.x);!this.tabs[++f]&&f<this._cols;);return f>=this._cols?this._cols-1:f<0?0:f}clearMarkers(f){this._isClearing=!0;for(let p=0;p<this.markers.length;p++)this.markers[p].line===f&&(this.markers[p].dispose(),this.markers.splice(p--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let f=0;f<this.markers.length;f++)this.markers[f].dispose(),this.markers.splice(f--,1);this._isClearing=!1}addMarker(f){let p=new o.Marker(f);return this.markers.push(p),p.register(this.lines.onTrim(y=>{p.line-=y,p.line<0&&p.dispose()})),p.register(this.lines.onInsert(y=>{p.line>=y.index&&(p.line+=y.amount)})),p.register(this.lines.onDelete(y=>{p.line>=y.index&&p.line<y.index+y.amount&&p.dispose(),p.line>y.index&&(p.line-=y.amount)})),p.register(p.onDispose(()=>this._removeMarker(p))),p}_removeMarker(f){this._isClearing||this.markers.splice(this.markers.indexOf(f),1)}}},8437:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferLine=t.DEFAULT_ATTR_DATA=void 0;let h=n(3734),g=n(511),a=n(643),l=n(482);t.DEFAULT_ATTR_DATA=Object.freeze(new h.AttributeData);let _=0;class v{constructor(o,d,f=!1){this.isWrapped=f,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*o);let p=d||g.CellData.fromCharData([0,a.NULL_CELL_CHAR,a.NULL_CELL_WIDTH,a.NULL_CELL_CODE]);for(let y=0;y<o;++y)this.setCell(y,p);this.length=o}get(o){let d=this._data[3*o+0],f=2097151&d;return[this._data[3*o+1],2097152&d?this._combined[o]:f?(0,l.stringFromCodePoint)(f):"",d>>22,2097152&d?this._combined[o].charCodeAt(this._combined[o].length-1):f]}set(o,d){this._data[3*o+1]=d[a.CHAR_DATA_ATTR_INDEX],d[a.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[o]=d[1],this._data[3*o+0]=2097152|o|d[a.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*o+0]=d[a.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|d[a.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(o){return this._data[3*o+0]>>22}hasWidth(o){return 12582912&this._data[3*o+0]}getFg(o){return this._data[3*o+1]}getBg(o){return this._data[3*o+2]}hasContent(o){return 4194303&this._data[3*o+0]}getCodePoint(o){let d=this._data[3*o+0];return 2097152&d?this._combined[o].charCodeAt(this._combined[o].length-1):2097151&d}isCombined(o){return 2097152&this._data[3*o+0]}getString(o){let d=this._data[3*o+0];return 2097152&d?this._combined[o]:2097151&d?(0,l.stringFromCodePoint)(2097151&d):""}isProtected(o){return 536870912&this._data[3*o+2]}loadCell(o,d){return _=3*o,d.content=this._data[_+0],d.fg=this._data[_+1],d.bg=this._data[_+2],2097152&d.content&&(d.combinedData=this._combined[o]),268435456&d.bg&&(d.extended=this._extendedAttrs[o]),d}setCell(o,d){2097152&d.content&&(this._combined[o]=d.combinedData),268435456&d.bg&&(this._extendedAttrs[o]=d.extended),this._data[3*o+0]=d.content,this._data[3*o+1]=d.fg,this._data[3*o+2]=d.bg}setCellFromCodepoint(o,d,f,p){268435456&p.bg&&(this._extendedAttrs[o]=p.extended),this._data[3*o+0]=d|f<<22,this._data[3*o+1]=p.fg,this._data[3*o+2]=p.bg}addCodepointToCell(o,d,f){let p=this._data[3*o+0];2097152&p?this._combined[o]+=(0,l.stringFromCodePoint)(d):2097151&p?(this._combined[o]=(0,l.stringFromCodePoint)(2097151&p)+(0,l.stringFromCodePoint)(d),p&=-2097152,p|=2097152):p=d|4194304,f&&(p&=-12582913,p|=f<<22),this._data[3*o+0]=p}insertCells(o,d,f){if((o%=this.length)&&this.getWidth(o-1)===2&&this.setCellFromCodepoint(o-1,0,1,f),d<this.length-o){let p=new g.CellData;for(let y=this.length-o-d-1;y>=0;--y)this.setCell(o+d+y,this.loadCell(o+y,p));for(let y=0;y<d;++y)this.setCell(o+y,f)}else for(let p=o;p<this.length;++p)this.setCell(p,f);this.getWidth(this.length-1)===2&&this.setCellFromCodepoint(this.length-1,0,1,f)}deleteCells(o,d,f){if(o%=this.length,d<this.length-o){let p=new g.CellData;for(let y=0;y<this.length-o-d;++y)this.setCell(o+y,this.loadCell(o+d+y,p));for(let y=this.length-d;y<this.length;++y)this.setCell(y,f)}else for(let p=o;p<this.length;++p)this.setCell(p,f);o&&this.getWidth(o-1)===2&&this.setCellFromCodepoint(o-1,0,1,f),this.getWidth(o)!==0||this.hasContent(o)||this.setCellFromCodepoint(o,0,1,f)}replaceCells(o,d,f,p=!1){if(p)for(o&&this.getWidth(o-1)===2&&!this.isProtected(o-1)&&this.setCellFromCodepoint(o-1,0,1,f),d<this.length&&this.getWidth(d-1)===2&&!this.isProtected(d)&&this.setCellFromCodepoint(d,0,1,f);o<d&&o<this.length;)this.isProtected(o)||this.setCell(o,f),o++;else for(o&&this.getWidth(o-1)===2&&this.setCellFromCodepoint(o-1,0,1,f),d<this.length&&this.getWidth(d-1)===2&&this.setCellFromCodepoint(d,0,1,f);o<d&&o<this.length;)this.setCell(o++,f)}resize(o,d){if(o===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;let f=3*o;if(o>this.length){if(this._data.buffer.byteLength>=4*f)this._data=new Uint32Array(this._data.buffer,0,f);else{let p=new Uint32Array(f);p.set(this._data),this._data=p}for(let p=this.length;p<o;++p)this.setCell(p,d)}else{this._data=this._data.subarray(0,f);let p=Object.keys(this._combined);for(let w=0;w<p.length;w++){let b=parseInt(p[w],10);b>=o&&delete this._combined[b]}let y=Object.keys(this._extendedAttrs);for(let w=0;w<y.length;w++){let b=parseInt(y[w],10);b>=o&&delete this._extendedAttrs[b]}}return this.length=o,4*f*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){let o=new Uint32Array(this._data.length);return o.set(this._data),this._data=o,1}return 0}fill(o,d=!1){if(d)for(let f=0;f<this.length;++f)this.isProtected(f)||this.setCell(f,o);else{this._combined={},this._extendedAttrs={};for(let f=0;f<this.length;++f)this.setCell(f,o)}}copyFrom(o){this.length!==o.length?this._data=new Uint32Array(o._data):this._data.set(o._data),this.length=o.length,this._combined={};for(let d in o._combined)this._combined[d]=o._combined[d];this._extendedAttrs={};for(let d in o._extendedAttrs)this._extendedAttrs[d]=o._extendedAttrs[d];this.isWrapped=o.isWrapped}clone(){let o=new v(0);o._data=new Uint32Array(this._data),o.length=this.length;for(let d in this._combined)o._combined[d]=this._combined[d];for(let d in this._extendedAttrs)o._extendedAttrs[d]=this._extendedAttrs[d];return o.isWrapped=this.isWrapped,o}getTrimmedLength(){for(let o=this.length-1;o>=0;--o)if(4194303&this._data[3*o+0])return o+(this._data[3*o+0]>>22);return 0}getNoBgTrimmedLength(){for(let o=this.length-1;o>=0;--o)if(4194303&this._data[3*o+0]||50331648&this._data[3*o+2])return o+(this._data[3*o+0]>>22);return 0}copyCellsFrom(o,d,f,p,y){let w=o._data;if(y)for(let S=p-1;S>=0;S--){for(let A=0;A<3;A++)this._data[3*(f+S)+A]=w[3*(d+S)+A];268435456&w[3*(d+S)+2]&&(this._extendedAttrs[f+S]=o._extendedAttrs[d+S])}else for(let S=0;S<p;S++){for(let A=0;A<3;A++)this._data[3*(f+S)+A]=w[3*(d+S)+A];268435456&w[3*(d+S)+2]&&(this._extendedAttrs[f+S]=o._extendedAttrs[d+S])}let b=Object.keys(o._combined);for(let S=0;S<b.length;S++){let A=parseInt(b[S],10);A>=d&&(this._combined[A-d+f]=o._combined[A])}}translateToString(o,d,f,p){d=d??0,f=f??this.length,o&&(f=Math.min(f,this.getTrimmedLength())),p&&(p.length=0);let y="";for(;d<f;){let w=this._data[3*d+0],b=2097151&w,S=2097152&w?this._combined[d]:b?(0,l.stringFromCodePoint)(b):a.WHITESPACE_CELL_CHAR;if(y+=S,p)for(let A=0;A<S.length;++A)p.push(d);d+=w>>22||1}return p&&p.push(d),y}}t.BufferLine=v},4841:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getRangeLength=void 0,t.getRangeLength=function(n,h){if(n.start.y>n.end.y)throw new Error(`Buffer range end (${n.end.x}, ${n.end.y}) cannot be before start (${n.start.x}, ${n.start.y})`);return h*(n.end.y-n.start.y)+(n.end.x-n.start.x+1)}},4634:(c,t)=>{function n(h,g,a){if(g===h.length-1)return h[g].getTrimmedLength();let l=!h[g].hasContent(a-1)&&h[g].getWidth(a-1)===1,_=h[g+1].getWidth(0)===2;return l&&_?a-1:a}Object.defineProperty(t,"__esModule",{value:!0}),t.getWrappedLineTrimmedLength=t.reflowSmallerGetNewLineLengths=t.reflowLargerApplyNewLayout=t.reflowLargerCreateNewLayout=t.reflowLargerGetLinesToRemove=void 0,t.reflowLargerGetLinesToRemove=function(h,g,a,l,_){let v=[];for(let u=0;u<h.length-1;u++){let o=u,d=h.get(++o);if(!d.isWrapped)continue;let f=[h.get(u)];for(;o<h.length&&d.isWrapped;)f.push(d),d=h.get(++o);if(l>=u&&l<o){u+=f.length-1;continue}let p=0,y=n(f,p,g),w=1,b=0;for(;w<f.length;){let A=n(f,w,g),C=A-b,D=a-y,L=Math.min(C,D);f[p].copyCellsFrom(f[w],b,y,L,!1),y+=L,y===a&&(p++,y=0),b+=L,b===A&&(w++,b=0),y===0&&p!==0&&f[p-1].getWidth(a-1)===2&&(f[p].copyCellsFrom(f[p-1],a-1,y++,1,!1),f[p-1].setCell(a-1,_))}f[p].replaceCells(y,a,_);let S=0;for(let A=f.length-1;A>0&&(A>p||f[A].getTrimmedLength()===0);A--)S++;S>0&&(v.push(u+f.length-S),v.push(S)),u+=f.length-1}return v},t.reflowLargerCreateNewLayout=function(h,g){let a=[],l=0,_=g[l],v=0;for(let u=0;u<h.length;u++)if(_===u){let o=g[++l];h.onDeleteEmitter.fire({index:u-v,amount:o}),u+=o-1,v+=o,_=g[++l]}else a.push(u);return{layout:a,countRemoved:v}},t.reflowLargerApplyNewLayout=function(h,g){let a=[];for(let l=0;l<g.length;l++)a.push(h.get(g[l]));for(let l=0;l<a.length;l++)h.set(l,a[l]);h.length=g.length},t.reflowSmallerGetNewLineLengths=function(h,g,a){let l=[],_=h.map((d,f)=>n(h,f,g)).reduce((d,f)=>d+f),v=0,u=0,o=0;for(;o<_;){if(_-o<a){l.push(_-o);break}v+=a;let d=n(h,u,g);v>d&&(v-=d,u++);let f=h[u].getWidth(v-1)===2;f&&v--;let p=f?a-1:a;l.push(p),o+=p}return l},t.getWrappedLineTrimmedLength=n},5295:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferSet=void 0;let h=n(8460),g=n(844),a=n(9092);class l extends g.Disposable{constructor(v,u){super(),this._optionsService=v,this._bufferService=u,this._onBufferActivate=this.register(new h.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new a.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new a.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(v){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(v),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(v,u){this._normal.resize(v,u),this._alt.resize(v,u),this.setupTabStops(v)}setupTabStops(v){this._normal.setupTabStops(v),this._alt.setupTabStops(v)}}t.BufferSet=l},511:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CellData=void 0;let h=n(482),g=n(643),a=n(3734);class l extends a.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new a.ExtendedAttrs,this.combinedData=""}static fromCharData(v){let u=new l;return u.setFromCharData(v),u}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,h.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(v){this.fg=v[g.CHAR_DATA_ATTR_INDEX],this.bg=0;let u=!1;if(v[g.CHAR_DATA_CHAR_INDEX].length>2)u=!0;else if(v[g.CHAR_DATA_CHAR_INDEX].length===2){let o=v[g.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=o&&o<=56319){let d=v[g.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=d&&d<=57343?this.content=1024*(o-55296)+d-56320+65536|v[g.CHAR_DATA_WIDTH_INDEX]<<22:u=!0}else u=!0}else this.content=v[g.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|v[g.CHAR_DATA_WIDTH_INDEX]<<22;u&&(this.combinedData=v[g.CHAR_DATA_CHAR_INDEX],this.content=2097152|v[g.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}t.CellData=l},643:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WHITESPACE_CELL_CODE=t.WHITESPACE_CELL_WIDTH=t.WHITESPACE_CELL_CHAR=t.NULL_CELL_CODE=t.NULL_CELL_WIDTH=t.NULL_CELL_CHAR=t.CHAR_DATA_CODE_INDEX=t.CHAR_DATA_WIDTH_INDEX=t.CHAR_DATA_CHAR_INDEX=t.CHAR_DATA_ATTR_INDEX=t.DEFAULT_EXT=t.DEFAULT_ATTR=t.DEFAULT_COLOR=void 0,t.DEFAULT_COLOR=0,t.DEFAULT_ATTR=256|t.DEFAULT_COLOR<<9,t.DEFAULT_EXT=0,t.CHAR_DATA_ATTR_INDEX=0,t.CHAR_DATA_CHAR_INDEX=1,t.CHAR_DATA_WIDTH_INDEX=2,t.CHAR_DATA_CODE_INDEX=3,t.NULL_CELL_CHAR="",t.NULL_CELL_WIDTH=1,t.NULL_CELL_CODE=0,t.WHITESPACE_CELL_CHAR=" ",t.WHITESPACE_CELL_WIDTH=1,t.WHITESPACE_CELL_CODE=32},4863:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Marker=void 0;let h=n(8460),g=n(844);class a{get id(){return this._id}constructor(_){this.line=_,this.isDisposed=!1,this._disposables=[],this._id=a._nextId++,this._onDispose=this.register(new h.EventEmitter),this.onDispose=this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,g.disposeArray)(this._disposables),this._disposables.length=0)}register(_){return this._disposables.push(_),_}}t.Marker=a,a._nextId=1},7116:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_CHARSET=t.CHARSETS=void 0,t.CHARSETS={},t.DEFAULT_CHARSET=t.CHARSETS.B,t.CHARSETS[0]={"`":"\u25C6",a:"\u2592",b:"\u2409",c:"\u240C",d:"\u240D",e:"\u240A",f:"\xB0",g:"\xB1",h:"\u2424",i:"\u240B",j:"\u2518",k:"\u2510",l:"\u250C",m:"\u2514",n:"\u253C",o:"\u23BA",p:"\u23BB",q:"\u2500",r:"\u23BC",s:"\u23BD",t:"\u251C",u:"\u2524",v:"\u2534",w:"\u252C",x:"\u2502",y:"\u2264",z:"\u2265","{":"\u03C0","|":"\u2260","}":"\xA3","~":"\xB7"},t.CHARSETS.A={"#":"\xA3"},t.CHARSETS.B=void 0,t.CHARSETS[4]={"#":"\xA3","@":"\xBE","[":"ij","\\":"\xBD","]":"|","{":"\xA8","|":"f","}":"\xBC","~":"\xB4"},t.CHARSETS.C=t.CHARSETS[5]={"[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},t.CHARSETS.R={"#":"\xA3","@":"\xE0","[":"\xB0","\\":"\xE7","]":"\xA7","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xA8"},t.CHARSETS.Q={"@":"\xE0","[":"\xE2","\\":"\xE7","]":"\xEA","^":"\xEE","`":"\xF4","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xFB"},t.CHARSETS.K={"@":"\xA7","[":"\xC4","\\":"\xD6","]":"\xDC","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xDF"},t.CHARSETS.Y={"#":"\xA3","@":"\xA7","[":"\xB0","\\":"\xE7","]":"\xE9","`":"\xF9","{":"\xE0","|":"\xF2","}":"\xE8","~":"\xEC"},t.CHARSETS.E=t.CHARSETS[6]={"@":"\xC4","[":"\xC6","\\":"\xD8","]":"\xC5","^":"\xDC","`":"\xE4","{":"\xE6","|":"\xF8","}":"\xE5","~":"\xFC"},t.CHARSETS.Z={"#":"\xA3","@":"\xA7","[":"\xA1","\\":"\xD1","]":"\xBF","{":"\xB0","|":"\xF1","}":"\xE7"},t.CHARSETS.H=t.CHARSETS[7]={"@":"\xC9","[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},t.CHARSETS["="]={"#":"\xF9","@":"\xE0","[":"\xE9","\\":"\xE7","]":"\xEA","^":"\xEE",_:"\xE8","`":"\xF4","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xFB"}},2584:(c,t)=>{var n,h,g;Object.defineProperty(t,"__esModule",{value:!0}),t.C1_ESCAPED=t.C1=t.C0=void 0,function(a){a.NUL="\0",a.SOH="",a.STX="",a.ETX="",a.EOT="",a.ENQ="",a.ACK="",a.BEL="\x07",a.BS="\b",a.HT="	",a.LF=`
`,a.VT="\v",a.FF="\f",a.CR="\r",a.SO="",a.SI="",a.DLE="",a.DC1="",a.DC2="",a.DC3="",a.DC4="",a.NAK="",a.SYN="",a.ETB="",a.CAN="",a.EM="",a.SUB="",a.ESC="\x1B",a.FS="",a.GS="",a.RS="",a.US="",a.SP=" ",a.DEL="\x7F"}(n||(t.C0=n={})),function(a){a.PAD="\x80",a.HOP="\x81",a.BPH="\x82",a.NBH="\x83",a.IND="\x84",a.NEL="\x85",a.SSA="\x86",a.ESA="\x87",a.HTS="\x88",a.HTJ="\x89",a.VTS="\x8A",a.PLD="\x8B",a.PLU="\x8C",a.RI="\x8D",a.SS2="\x8E",a.SS3="\x8F",a.DCS="\x90",a.PU1="\x91",a.PU2="\x92",a.STS="\x93",a.CCH="\x94",a.MW="\x95",a.SPA="\x96",a.EPA="\x97",a.SOS="\x98",a.SGCI="\x99",a.SCI="\x9A",a.CSI="\x9B",a.ST="\x9C",a.OSC="\x9D",a.PM="\x9E",a.APC="\x9F"}(h||(t.C1=h={})),function(a){a.ST=`${n.ESC}\\`}(g||(t.C1_ESCAPED=g={}))},7399:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateKeyboardEvent=void 0;let h=n(2584),g={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};t.evaluateKeyboardEvent=function(a,l,_,v){let u={type:0,cancel:!1,key:void 0},o=(a.shiftKey?1:0)|(a.altKey?2:0)|(a.ctrlKey?4:0)|(a.metaKey?8:0);switch(a.keyCode){case 0:a.key==="UIKeyInputUpArrow"?u.key=l?h.C0.ESC+"OA":h.C0.ESC+"[A":a.key==="UIKeyInputLeftArrow"?u.key=l?h.C0.ESC+"OD":h.C0.ESC+"[D":a.key==="UIKeyInputRightArrow"?u.key=l?h.C0.ESC+"OC":h.C0.ESC+"[C":a.key==="UIKeyInputDownArrow"&&(u.key=l?h.C0.ESC+"OB":h.C0.ESC+"[B");break;case 8:u.key=a.ctrlKey?"\b":h.C0.DEL,a.altKey&&(u.key=h.C0.ESC+u.key);break;case 9:if(a.shiftKey){u.key=h.C0.ESC+"[Z";break}u.key=h.C0.HT,u.cancel=!0;break;case 13:u.key=a.altKey?h.C0.ESC+h.C0.CR:h.C0.CR,u.cancel=!0;break;case 27:u.key=h.C0.ESC,a.altKey&&(u.key=h.C0.ESC+h.C0.ESC),u.cancel=!0;break;case 37:if(a.metaKey)break;o?(u.key=h.C0.ESC+"[1;"+(o+1)+"D",u.key===h.C0.ESC+"[1;3D"&&(u.key=h.C0.ESC+(_?"b":"[1;5D"))):u.key=l?h.C0.ESC+"OD":h.C0.ESC+"[D";break;case 39:if(a.metaKey)break;o?(u.key=h.C0.ESC+"[1;"+(o+1)+"C",u.key===h.C0.ESC+"[1;3C"&&(u.key=h.C0.ESC+(_?"f":"[1;5C"))):u.key=l?h.C0.ESC+"OC":h.C0.ESC+"[C";break;case 38:if(a.metaKey)break;o?(u.key=h.C0.ESC+"[1;"+(o+1)+"A",_||u.key!==h.C0.ESC+"[1;3A"||(u.key=h.C0.ESC+"[1;5A")):u.key=l?h.C0.ESC+"OA":h.C0.ESC+"[A";break;case 40:if(a.metaKey)break;o?(u.key=h.C0.ESC+"[1;"+(o+1)+"B",_||u.key!==h.C0.ESC+"[1;3B"||(u.key=h.C0.ESC+"[1;5B")):u.key=l?h.C0.ESC+"OB":h.C0.ESC+"[B";break;case 45:a.shiftKey||a.ctrlKey||(u.key=h.C0.ESC+"[2~");break;case 46:u.key=o?h.C0.ESC+"[3;"+(o+1)+"~":h.C0.ESC+"[3~";break;case 36:u.key=o?h.C0.ESC+"[1;"+(o+1)+"H":l?h.C0.ESC+"OH":h.C0.ESC+"[H";break;case 35:u.key=o?h.C0.ESC+"[1;"+(o+1)+"F":l?h.C0.ESC+"OF":h.C0.ESC+"[F";break;case 33:a.shiftKey?u.type=2:a.ctrlKey?u.key=h.C0.ESC+"[5;"+(o+1)+"~":u.key=h.C0.ESC+"[5~";break;case 34:a.shiftKey?u.type=3:a.ctrlKey?u.key=h.C0.ESC+"[6;"+(o+1)+"~":u.key=h.C0.ESC+"[6~";break;case 112:u.key=o?h.C0.ESC+"[1;"+(o+1)+"P":h.C0.ESC+"OP";break;case 113:u.key=o?h.C0.ESC+"[1;"+(o+1)+"Q":h.C0.ESC+"OQ";break;case 114:u.key=o?h.C0.ESC+"[1;"+(o+1)+"R":h.C0.ESC+"OR";break;case 115:u.key=o?h.C0.ESC+"[1;"+(o+1)+"S":h.C0.ESC+"OS";break;case 116:u.key=o?h.C0.ESC+"[15;"+(o+1)+"~":h.C0.ESC+"[15~";break;case 117:u.key=o?h.C0.ESC+"[17;"+(o+1)+"~":h.C0.ESC+"[17~";break;case 118:u.key=o?h.C0.ESC+"[18;"+(o+1)+"~":h.C0.ESC+"[18~";break;case 119:u.key=o?h.C0.ESC+"[19;"+(o+1)+"~":h.C0.ESC+"[19~";break;case 120:u.key=o?h.C0.ESC+"[20;"+(o+1)+"~":h.C0.ESC+"[20~";break;case 121:u.key=o?h.C0.ESC+"[21;"+(o+1)+"~":h.C0.ESC+"[21~";break;case 122:u.key=o?h.C0.ESC+"[23;"+(o+1)+"~":h.C0.ESC+"[23~";break;case 123:u.key=o?h.C0.ESC+"[24;"+(o+1)+"~":h.C0.ESC+"[24~";break;default:if(!a.ctrlKey||a.shiftKey||a.altKey||a.metaKey)if(_&&!v||!a.altKey||a.metaKey)!_||a.altKey||a.ctrlKey||a.shiftKey||!a.metaKey?a.key&&!a.ctrlKey&&!a.altKey&&!a.metaKey&&a.keyCode>=48&&a.key.length===1?u.key=a.key:a.key&&a.ctrlKey&&(a.key==="_"&&(u.key=h.C0.US),a.key==="@"&&(u.key=h.C0.NUL)):a.keyCode===65&&(u.type=1);else{let d=g[a.keyCode],f=d?.[a.shiftKey?1:0];if(f)u.key=h.C0.ESC+f;else if(a.keyCode>=65&&a.keyCode<=90){let p=a.ctrlKey?a.keyCode-64:a.keyCode+32,y=String.fromCharCode(p);a.shiftKey&&(y=y.toUpperCase()),u.key=h.C0.ESC+y}else if(a.keyCode===32)u.key=h.C0.ESC+(a.ctrlKey?h.C0.NUL:" ");else if(a.key==="Dead"&&a.code.startsWith("Key")){let p=a.code.slice(3,4);a.shiftKey||(p=p.toLowerCase()),u.key=h.C0.ESC+p,u.cancel=!0}}else a.keyCode>=65&&a.keyCode<=90?u.key=String.fromCharCode(a.keyCode-64):a.keyCode===32?u.key=h.C0.NUL:a.keyCode>=51&&a.keyCode<=55?u.key=String.fromCharCode(a.keyCode-51+27):a.keyCode===56?u.key=h.C0.DEL:a.keyCode===219?u.key=h.C0.ESC:a.keyCode===220?u.key=h.C0.FS:a.keyCode===221&&(u.key=h.C0.GS)}return u}},482:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Utf8ToUtf32=t.StringToUtf32=t.utf32ToString=t.stringFromCodePoint=void 0,t.stringFromCodePoint=function(n){return n>65535?(n-=65536,String.fromCharCode(55296+(n>>10))+String.fromCharCode(n%1024+56320)):String.fromCharCode(n)},t.utf32ToString=function(n,h=0,g=n.length){let a="";for(let l=h;l<g;++l){let _=n[l];_>65535?(_-=65536,a+=String.fromCharCode(55296+(_>>10))+String.fromCharCode(_%1024+56320)):a+=String.fromCharCode(_)}return a},t.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(n,h){let g=n.length;if(!g)return 0;let a=0,l=0;if(this._interim){let _=n.charCodeAt(l++);56320<=_&&_<=57343?h[a++]=1024*(this._interim-55296)+_-56320+65536:(h[a++]=this._interim,h[a++]=_),this._interim=0}for(let _=l;_<g;++_){let v=n.charCodeAt(_);if(55296<=v&&v<=56319){if(++_>=g)return this._interim=v,a;let u=n.charCodeAt(_);56320<=u&&u<=57343?h[a++]=1024*(v-55296)+u-56320+65536:(h[a++]=v,h[a++]=u)}else v!==65279&&(h[a++]=v)}return a}},t.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(n,h){let g=n.length;if(!g)return 0;let a,l,_,v,u=0,o=0,d=0;if(this.interim[0]){let y=!1,w=this.interim[0];w&=(224&w)==192?31:(240&w)==224?15:7;let b,S=0;for(;(b=63&this.interim[++S])&&S<4;)w<<=6,w|=b;let A=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,C=A-S;for(;d<C;){if(d>=g)return 0;if(b=n[d++],(192&b)!=128){d--,y=!0;break}this.interim[S++]=b,w<<=6,w|=63&b}y||(A===2?w<128?d--:h[u++]=w:A===3?w<2048||w>=55296&&w<=57343||w===65279||(h[u++]=w):w<65536||w>1114111||(h[u++]=w)),this.interim.fill(0)}let f=g-4,p=d;for(;p<g;){for(;!(!(p<f)||128&(a=n[p])||128&(l=n[p+1])||128&(_=n[p+2])||128&(v=n[p+3]));)h[u++]=a,h[u++]=l,h[u++]=_,h[u++]=v,p+=4;if(a=n[p++],a<128)h[u++]=a;else if((224&a)==192){if(p>=g)return this.interim[0]=a,u;if(l=n[p++],(192&l)!=128){p--;continue}if(o=(31&a)<<6|63&l,o<128){p--;continue}h[u++]=o}else if((240&a)==224){if(p>=g)return this.interim[0]=a,u;if(l=n[p++],(192&l)!=128){p--;continue}if(p>=g)return this.interim[0]=a,this.interim[1]=l,u;if(_=n[p++],(192&_)!=128){p--;continue}if(o=(15&a)<<12|(63&l)<<6|63&_,o<2048||o>=55296&&o<=57343||o===65279)continue;h[u++]=o}else if((248&a)==240){if(p>=g)return this.interim[0]=a,u;if(l=n[p++],(192&l)!=128){p--;continue}if(p>=g)return this.interim[0]=a,this.interim[1]=l,u;if(_=n[p++],(192&_)!=128){p--;continue}if(p>=g)return this.interim[0]=a,this.interim[1]=l,this.interim[2]=_,u;if(v=n[p++],(192&v)!=128){p--;continue}if(o=(7&a)<<18|(63&l)<<12|(63&_)<<6|63&v,o<65536||o>1114111)continue;h[u++]=o}}return u}}},225:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeV6=void 0;let h=n(1480),g=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],a=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],l;t.UnicodeV6=class{constructor(){if(this.version="6",!l){l=new Uint8Array(65536),l.fill(1),l[0]=0,l.fill(0,1,32),l.fill(0,127,160),l.fill(2,4352,4448),l[9001]=2,l[9002]=2,l.fill(2,11904,42192),l[12351]=1,l.fill(2,44032,55204),l.fill(2,63744,64256),l.fill(2,65040,65050),l.fill(2,65072,65136),l.fill(2,65280,65377),l.fill(2,65504,65511);for(let _=0;_<g.length;++_)l.fill(0,g[_][0],g[_][1]+1)}}wcwidth(_){return _<32?0:_<127?1:_<65536?l[_]:function(v,u){let o,d=0,f=u.length-1;if(v<u[0][0]||v>u[f][1])return!1;for(;f>=d;)if(o=d+f>>1,v>u[o][1])d=o+1;else{if(!(v<u[o][0]))return!0;f=o-1}return!1}(_,a)?0:_>=131072&&_<=196605||_>=196608&&_<=262141?2:1}charProperties(_,v){let u=this.wcwidth(_),o=u===0&&v!==0;if(o){let d=h.UnicodeService.extractWidth(v);d===0?o=!1:d>u&&(u=d)}return h.UnicodeService.createPropertyValue(0,u,o)}}},5981:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WriteBuffer=void 0;let h=n(8460),g=n(844);class a extends g.Disposable{constructor(_){super(),this._action=_,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new h.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(_,v){if(v!==void 0&&this._syncCalls>v)return void(this._syncCalls=0);if(this._pendingData+=_.length,this._writeBuffer.push(_),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let u;for(this._isSyncWriting=!0;u=this._writeBuffer.shift();){this._action(u);let o=this._callbacks.shift();o&&o()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(_,v){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=_.length,this._writeBuffer.push(_),this._callbacks.push(v),void this._innerWrite();setTimeout(()=>this._innerWrite())}this._pendingData+=_.length,this._writeBuffer.push(_),this._callbacks.push(v)}_innerWrite(_=0,v=!0){let u=_||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){let o=this._writeBuffer[this._bufferOffset],d=this._action(o,v);if(d){let p=y=>Date.now()-u>=12?setTimeout(()=>this._innerWrite(0,y)):this._innerWrite(u,y);return void d.catch(y=>(queueMicrotask(()=>{throw y}),Promise.resolve(!1))).then(p)}let f=this._callbacks[this._bufferOffset];if(f&&f(),this._bufferOffset++,this._pendingData-=o.length,Date.now()-u>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}t.WriteBuffer=a},5941:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toRgbString=t.parseColor=void 0;let n=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,h=/^[\da-f]+$/;function g(a,l){let _=a.toString(16),v=_.length<2?"0"+_:_;switch(l){case 4:return _[0];case 8:return v;case 12:return(v+v).slice(0,3);default:return v+v}}t.parseColor=function(a){if(!a)return;let l=a.toLowerCase();if(l.indexOf("rgb:")===0){l=l.slice(4);let _=n.exec(l);if(_){let v=_[1]?15:_[4]?255:_[7]?4095:65535;return[Math.round(parseInt(_[1]||_[4]||_[7]||_[10],16)/v*255),Math.round(parseInt(_[2]||_[5]||_[8]||_[11],16)/v*255),Math.round(parseInt(_[3]||_[6]||_[9]||_[12],16)/v*255)]}}else if(l.indexOf("#")===0&&(l=l.slice(1),h.exec(l)&&[3,6,9,12].includes(l.length))){let _=l.length/3,v=[0,0,0];for(let u=0;u<3;++u){let o=parseInt(l.slice(_*u,_*u+_),16);v[u]=_===1?o<<4:_===2?o:_===3?o>>4:o>>8}return v}},t.toRgbString=function(a,l=16){let[_,v,u]=a;return`rgb:${g(_,l)}/${g(v,l)}/${g(u,l)}`}},5770:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PAYLOAD_LIMIT=void 0,t.PAYLOAD_LIMIT=1e7},6351:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DcsHandler=t.DcsParser=void 0;let h=n(482),g=n(8742),a=n(5770),l=[];t.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=l,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=l}registerHandler(v,u){this._handlers[v]===void 0&&(this._handlers[v]=[]);let o=this._handlers[v];return o.push(u),{dispose:()=>{let d=o.indexOf(u);d!==-1&&o.splice(d,1)}}}clearHandler(v){this._handlers[v]&&delete this._handlers[v]}setHandlerFallback(v){this._handlerFb=v}reset(){if(this._active.length)for(let v=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;v>=0;--v)this._active[v].unhook(!1);this._stack.paused=!1,this._active=l,this._ident=0}hook(v,u){if(this.reset(),this._ident=v,this._active=this._handlers[v]||l,this._active.length)for(let o=this._active.length-1;o>=0;o--)this._active[o].hook(u);else this._handlerFb(this._ident,"HOOK",u)}put(v,u,o){if(this._active.length)for(let d=this._active.length-1;d>=0;d--)this._active[d].put(v,u,o);else this._handlerFb(this._ident,"PUT",(0,h.utf32ToString)(v,u,o))}unhook(v,u=!0){if(this._active.length){let o=!1,d=this._active.length-1,f=!1;if(this._stack.paused&&(d=this._stack.loopPosition-1,o=u,f=this._stack.fallThrough,this._stack.paused=!1),!f&&o===!1){for(;d>=0&&(o=this._active[d].unhook(v),o!==!0);d--)if(o instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=d,this._stack.fallThrough=!1,o;d--}for(;d>=0;d--)if(o=this._active[d].unhook(!1),o instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=d,this._stack.fallThrough=!0,o}else this._handlerFb(this._ident,"UNHOOK",v);this._active=l,this._ident=0}};let _=new g.Params;_.addParam(0),t.DcsHandler=class{constructor(v){this._handler=v,this._data="",this._params=_,this._hitLimit=!1}hook(v){this._params=v.length>1||v.params[0]?v.clone():_,this._data="",this._hitLimit=!1}put(v,u,o){this._hitLimit||(this._data+=(0,h.utf32ToString)(v,u,o),this._data.length>a.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(v){let u=!1;if(this._hitLimit)u=!1;else if(v&&(u=this._handler(this._data,this._params),u instanceof Promise))return u.then(o=>(this._params=_,this._data="",this._hitLimit=!1,o));return this._params=_,this._data="",this._hitLimit=!1,u}}},2015:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EscapeSequenceParser=t.VT500_TRANSITION_TABLE=t.TransitionTable=void 0;let h=n(844),g=n(8742),a=n(6242),l=n(6351);class _{constructor(d){this.table=new Uint8Array(d)}setDefault(d,f){this.table.fill(d<<4|f)}add(d,f,p,y){this.table[f<<8|d]=p<<4|y}addMany(d,f,p,y){for(let w=0;w<d.length;w++)this.table[f<<8|d[w]]=p<<4|y}}t.TransitionTable=_;let v=160;t.VT500_TRANSITION_TABLE=function(){let o=new _(4095),d=Array.apply(null,Array(256)).map((S,A)=>A),f=(S,A)=>d.slice(S,A),p=f(32,127),y=f(0,24);y.push(25),y.push.apply(y,f(28,32));let w=f(0,14),b;for(b in o.setDefault(1,0),o.addMany(p,0,2,0),w)o.addMany([24,26,153,154],b,3,0),o.addMany(f(128,144),b,3,0),o.addMany(f(144,152),b,3,0),o.add(156,b,0,0),o.add(27,b,11,1),o.add(157,b,4,8),o.addMany([152,158,159],b,0,7),o.add(155,b,11,3),o.add(144,b,11,9);return o.addMany(y,0,3,0),o.addMany(y,1,3,1),o.add(127,1,0,1),o.addMany(y,8,0,8),o.addMany(y,3,3,3),o.add(127,3,0,3),o.addMany(y,4,3,4),o.add(127,4,0,4),o.addMany(y,6,3,6),o.addMany(y,5,3,5),o.add(127,5,0,5),o.addMany(y,2,3,2),o.add(127,2,0,2),o.add(93,1,4,8),o.addMany(p,8,5,8),o.add(127,8,5,8),o.addMany([156,27,24,26,7],8,6,0),o.addMany(f(28,32),8,0,8),o.addMany([88,94,95],1,0,7),o.addMany(p,7,0,7),o.addMany(y,7,0,7),o.add(156,7,0,0),o.add(127,7,0,7),o.add(91,1,11,3),o.addMany(f(64,127),3,7,0),o.addMany(f(48,60),3,8,4),o.addMany([60,61,62,63],3,9,4),o.addMany(f(48,60),4,8,4),o.addMany(f(64,127),4,7,0),o.addMany([60,61,62,63],4,0,6),o.addMany(f(32,64),6,0,6),o.add(127,6,0,6),o.addMany(f(64,127),6,0,0),o.addMany(f(32,48),3,9,5),o.addMany(f(32,48),5,9,5),o.addMany(f(48,64),5,0,6),o.addMany(f(64,127),5,7,0),o.addMany(f(32,48),4,9,5),o.addMany(f(32,48),1,9,2),o.addMany(f(32,48),2,9,2),o.addMany(f(48,127),2,10,0),o.addMany(f(48,80),1,10,0),o.addMany(f(81,88),1,10,0),o.addMany([89,90,92],1,10,0),o.addMany(f(96,127),1,10,0),o.add(80,1,11,9),o.addMany(y,9,0,9),o.add(127,9,0,9),o.addMany(f(28,32),9,0,9),o.addMany(f(32,48),9,9,12),o.addMany(f(48,60),9,8,10),o.addMany([60,61,62,63],9,9,10),o.addMany(y,11,0,11),o.addMany(f(32,128),11,0,11),o.addMany(f(28,32),11,0,11),o.addMany(y,10,0,10),o.add(127,10,0,10),o.addMany(f(28,32),10,0,10),o.addMany(f(48,60),10,8,10),o.addMany([60,61,62,63],10,0,11),o.addMany(f(32,48),10,9,12),o.addMany(y,12,0,12),o.add(127,12,0,12),o.addMany(f(28,32),12,0,12),o.addMany(f(32,48),12,9,12),o.addMany(f(48,64),12,0,11),o.addMany(f(64,127),12,12,13),o.addMany(f(64,127),10,12,13),o.addMany(f(64,127),9,12,13),o.addMany(y,13,13,13),o.addMany(p,13,13,13),o.add(127,13,0,13),o.addMany([27,156,24,26],13,14,0),o.add(v,0,2,0),o.add(v,8,5,8),o.add(v,6,0,6),o.add(v,11,0,11),o.add(v,13,13,13),o}();class u extends h.Disposable{constructor(d=t.VT500_TRANSITION_TABLE){super(),this._transitions=d,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new g.Params,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(f,p,y)=>{},this._executeHandlerFb=f=>{},this._csiHandlerFb=(f,p)=>{},this._escHandlerFb=f=>{},this._errorHandlerFb=f=>f,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,h.toDisposable)(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this.register(new a.OscParser),this._dcsParser=this.register(new l.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(d,f=[64,126]){let p=0;if(d.prefix){if(d.prefix.length>1)throw new Error("only one byte as prefix supported");if(p=d.prefix.charCodeAt(0),p&&60>p||p>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(d.intermediates){if(d.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let w=0;w<d.intermediates.length;++w){let b=d.intermediates.charCodeAt(w);if(32>b||b>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");p<<=8,p|=b}}if(d.final.length!==1)throw new Error("final must be a single byte");let y=d.final.charCodeAt(0);if(f[0]>y||y>f[1])throw new Error(`final must be in range ${f[0]} .. ${f[1]}`);return p<<=8,p|=y,p}identToString(d){let f=[];for(;d;)f.push(String.fromCharCode(255&d)),d>>=8;return f.reverse().join("")}setPrintHandler(d){this._printHandler=d}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(d,f){let p=this._identifier(d,[48,126]);this._escHandlers[p]===void 0&&(this._escHandlers[p]=[]);let y=this._escHandlers[p];return y.push(f),{dispose:()=>{let w=y.indexOf(f);w!==-1&&y.splice(w,1)}}}clearEscHandler(d){this._escHandlers[this._identifier(d,[48,126])]&&delete this._escHandlers[this._identifier(d,[48,126])]}setEscHandlerFallback(d){this._escHandlerFb=d}setExecuteHandler(d,f){this._executeHandlers[d.charCodeAt(0)]=f}clearExecuteHandler(d){this._executeHandlers[d.charCodeAt(0)]&&delete this._executeHandlers[d.charCodeAt(0)]}setExecuteHandlerFallback(d){this._executeHandlerFb=d}registerCsiHandler(d,f){let p=this._identifier(d);this._csiHandlers[p]===void 0&&(this._csiHandlers[p]=[]);let y=this._csiHandlers[p];return y.push(f),{dispose:()=>{let w=y.indexOf(f);w!==-1&&y.splice(w,1)}}}clearCsiHandler(d){this._csiHandlers[this._identifier(d)]&&delete this._csiHandlers[this._identifier(d)]}setCsiHandlerFallback(d){this._csiHandlerFb=d}registerDcsHandler(d,f){return this._dcsParser.registerHandler(this._identifier(d),f)}clearDcsHandler(d){this._dcsParser.clearHandler(this._identifier(d))}setDcsHandlerFallback(d){this._dcsParser.setHandlerFallback(d)}registerOscHandler(d,f){return this._oscParser.registerHandler(d,f)}clearOscHandler(d){this._oscParser.clearHandler(d)}setOscHandlerFallback(d){this._oscParser.setHandlerFallback(d)}setErrorHandler(d){this._errorHandler=d}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(d,f,p,y,w){this._parseStack.state=d,this._parseStack.handlers=f,this._parseStack.handlerPos=p,this._parseStack.transition=y,this._parseStack.chunkPos=w}parse(d,f,p){let y,w=0,b=0,S=0;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,S=this._parseStack.chunkPos+1;else{if(p===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");let A=this._parseStack.handlers,C=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(p===!1&&C>-1){for(;C>=0&&(y=A[C](this._params),y!==!0);C--)if(y instanceof Promise)return this._parseStack.handlerPos=C,y}this._parseStack.handlers=[];break;case 4:if(p===!1&&C>-1){for(;C>=0&&(y=A[C](),y!==!0);C--)if(y instanceof Promise)return this._parseStack.handlerPos=C,y}this._parseStack.handlers=[];break;case 6:if(w=d[this._parseStack.chunkPos],y=this._dcsParser.unhook(w!==24&&w!==26,p),y)return y;w===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(w=d[this._parseStack.chunkPos],y=this._oscParser.end(w!==24&&w!==26,p),y)return y;w===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,S=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=15&this._parseStack.transition}for(let A=S;A<f;++A){switch(w=d[A],b=this._transitions.table[this.currentState<<8|(w<160?w:v)],b>>4){case 2:for(let R=A+1;;++R){if(R>=f||(w=d[R])<32||w>126&&w<v){this._printHandler(d,A,R),A=R-1;break}if(++R>=f||(w=d[R])<32||w>126&&w<v){this._printHandler(d,A,R),A=R-1;break}if(++R>=f||(w=d[R])<32||w>126&&w<v){this._printHandler(d,A,R),A=R-1;break}if(++R>=f||(w=d[R])<32||w>126&&w<v){this._printHandler(d,A,R),A=R-1;break}}break;case 3:this._executeHandlers[w]?this._executeHandlers[w]():this._executeHandlerFb(w),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:A,code:w,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:let C=this._csiHandlers[this._collect<<8|w],D=C?C.length-1:-1;for(;D>=0&&(y=C[D](this._params),y!==!0);D--)if(y instanceof Promise)return this._preserveStack(3,C,D,b,A),y;D<0&&this._csiHandlerFb(this._collect<<8|w,this._params),this.precedingJoinState=0;break;case 8:do switch(w){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(w-48)}while(++A<f&&(w=d[A])>47&&w<60);A--;break;case 9:this._collect<<=8,this._collect|=w;break;case 10:let L=this._escHandlers[this._collect<<8|w],B=L?L.length-1:-1;for(;B>=0&&(y=L[B](),y!==!0);B--)if(y instanceof Promise)return this._preserveStack(4,L,B,b,A),y;B<0&&this._escHandlerFb(this._collect<<8|w),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|w,this._params);break;case 13:for(let R=A+1;;++R)if(R>=f||(w=d[R])===24||w===26||w===27||w>127&&w<v){this._dcsParser.put(d,A,R),A=R-1;break}break;case 14:if(y=this._dcsParser.unhook(w!==24&&w!==26),y)return this._preserveStack(6,[],0,b,A),y;w===27&&(b|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let R=A+1;;R++)if(R>=f||(w=d[R])<32||w>127&&w<v){this._oscParser.put(d,A,R),A=R-1;break}break;case 6:if(y=this._oscParser.end(w!==24&&w!==26),y)return this._preserveStack(5,[],0,b,A),y;w===27&&(b|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0}this.currentState=15&b}}}t.EscapeSequenceParser=u},6242:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OscHandler=t.OscParser=void 0;let h=n(5770),g=n(482),a=[];t.OscParser=class{constructor(){this._state=0,this._active=a,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(l,_){this._handlers[l]===void 0&&(this._handlers[l]=[]);let v=this._handlers[l];return v.push(_),{dispose:()=>{let u=v.indexOf(_);u!==-1&&v.splice(u,1)}}}clearHandler(l){this._handlers[l]&&delete this._handlers[l]}setHandlerFallback(l){this._handlerFb=l}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=a}reset(){if(this._state===2)for(let l=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;l>=0;--l)this._active[l].end(!1);this._stack.paused=!1,this._active=a,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||a,this._active.length)for(let l=this._active.length-1;l>=0;l--)this._active[l].start();else this._handlerFb(this._id,"START")}_put(l,_,v){if(this._active.length)for(let u=this._active.length-1;u>=0;u--)this._active[u].put(l,_,v);else this._handlerFb(this._id,"PUT",(0,g.utf32ToString)(l,_,v))}start(){this.reset(),this._state=1}put(l,_,v){if(this._state!==3){if(this._state===1)for(;_<v;){let u=l[_++];if(u===59){this._state=2,this._start();break}if(u<48||57<u)return void(this._state=3);this._id===-1&&(this._id=0),this._id=10*this._id+u-48}this._state===2&&v-_>0&&this._put(l,_,v)}}end(l,_=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),this._active.length){let v=!1,u=this._active.length-1,o=!1;if(this._stack.paused&&(u=this._stack.loopPosition-1,v=_,o=this._stack.fallThrough,this._stack.paused=!1),!o&&v===!1){for(;u>=0&&(v=this._active[u].end(l),v!==!0);u--)if(v instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=u,this._stack.fallThrough=!1,v;u--}for(;u>=0;u--)if(v=this._active[u].end(!1),v instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=u,this._stack.fallThrough=!0,v}else this._handlerFb(this._id,"END",l);this._active=a,this._id=-1,this._state=0}}},t.OscHandler=class{constructor(l){this._handler=l,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(l,_,v){this._hitLimit||(this._data+=(0,g.utf32ToString)(l,_,v),this._data.length>h.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(l){let _=!1;if(this._hitLimit)_=!1;else if(l&&(_=this._handler(this._data),_ instanceof Promise))return _.then(v=>(this._data="",this._hitLimit=!1,v));return this._data="",this._hitLimit=!1,_}}},8742:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Params=void 0;let n=2147483647;class h{static fromArray(a){let l=new h;if(!a.length)return l;for(let _=Array.isArray(a[0])?1:0;_<a.length;++_){let v=a[_];if(Array.isArray(v))for(let u=0;u<v.length;++u)l.addSubParam(v[u]);else l.addParam(v)}return l}constructor(a=32,l=32){if(this.maxLength=a,this.maxSubParamsLength=l,l>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(a),this.length=0,this._subParams=new Int32Array(l),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(a),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}clone(){let a=new h(this.maxLength,this.maxSubParamsLength);return a.params.set(this.params),a.length=this.length,a._subParams.set(this._subParams),a._subParamsLength=this._subParamsLength,a._subParamsIdx.set(this._subParamsIdx),a._rejectDigits=this._rejectDigits,a._rejectSubDigits=this._rejectSubDigits,a._digitIsSub=this._digitIsSub,a}toArray(){let a=[];for(let l=0;l<this.length;++l){a.push(this.params[l]);let _=this._subParamsIdx[l]>>8,v=255&this._subParamsIdx[l];v-_>0&&a.push(Array.prototype.slice.call(this._subParams,_,v))}return a}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(a){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(a<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=a>n?n:a}}addSubParam(a){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(a<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=a>n?n:a,this._subParamsIdx[this.length-1]++}}hasSubParams(a){return(255&this._subParamsIdx[a])-(this._subParamsIdx[a]>>8)>0}getSubParams(a){let l=this._subParamsIdx[a]>>8,_=255&this._subParamsIdx[a];return _-l>0?this._subParams.subarray(l,_):null}getSubParamsAll(){let a={};for(let l=0;l<this.length;++l){let _=this._subParamsIdx[l]>>8,v=255&this._subParamsIdx[l];v-_>0&&(a[l]=this._subParams.slice(_,v))}return a}addDigit(a){let l;if(this._rejectDigits||!(l=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;let _=this._digitIsSub?this._subParams:this.params,v=_[l-1];_[l-1]=~v?Math.min(10*v+a,n):a}}t.Params=h},5741:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AddonManager=void 0,t.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let n=this._addons.length-1;n>=0;n--)this._addons[n].instance.dispose()}loadAddon(n,h){let g={instance:h,dispose:h.dispose,isDisposed:!1};this._addons.push(g),h.dispose=()=>this._wrappedAddonDispose(g),h.activate(n)}_wrappedAddonDispose(n){if(n.isDisposed)return;let h=-1;for(let g=0;g<this._addons.length;g++)if(this._addons[g]===n){h=g;break}if(h===-1)throw new Error("Could not dispose an addon that has not been loaded");n.isDisposed=!0,n.dispose.apply(n.instance),this._addons.splice(h,1)}}},8771:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferApiView=void 0;let h=n(3785),g=n(511);t.BufferApiView=class{constructor(a,l){this._buffer=a,this.type=l}init(a){return this._buffer=a,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(a){let l=this._buffer.lines.get(a);if(l)return new h.BufferLineApiView(l)}getNullCell(){return new g.CellData}}},3785:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferLineApiView=void 0;let h=n(511);t.BufferLineApiView=class{constructor(g){this._line=g}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(g,a){if(!(g<0||g>=this._line.length))return a?(this._line.loadCell(g,a),a):this._line.loadCell(g,new h.CellData)}translateToString(g,a,l){return this._line.translateToString(g,a,l)}}},8285:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferNamespaceApi=void 0;let h=n(8771),g=n(8460),a=n(844);class l extends a.Disposable{constructor(v){super(),this._core=v,this._onBufferChange=this.register(new g.EventEmitter),this.onBufferChange=this._onBufferChange.event,this._normal=new h.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new h.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}t.BufferNamespaceApi=l},7975:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ParserApi=void 0,t.ParserApi=class{constructor(n){this._core=n}registerCsiHandler(n,h){return this._core.registerCsiHandler(n,g=>h(g.toArray()))}addCsiHandler(n,h){return this.registerCsiHandler(n,h)}registerDcsHandler(n,h){return this._core.registerDcsHandler(n,(g,a)=>h(g,a.toArray()))}addDcsHandler(n,h){return this.registerDcsHandler(n,h)}registerEscHandler(n,h){return this._core.registerEscHandler(n,h)}addEscHandler(n,h){return this.registerEscHandler(n,h)}registerOscHandler(n,h){return this._core.registerOscHandler(n,h)}addOscHandler(n,h){return this.registerOscHandler(n,h)}}},7090:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeApi=void 0,t.UnicodeApi=class{constructor(n){this._core=n}register(n){this._core.unicodeService.register(n)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(n){this._core.unicodeService.activeVersion=n}}},744:function(c,t,n){var h=this&&this.__decorate||function(o,d,f,p){var y,w=arguments.length,b=w<3?d:p===null?p=Object.getOwnPropertyDescriptor(d,f):p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(o,d,f,p);else for(var S=o.length-1;S>=0;S--)(y=o[S])&&(b=(w<3?y(b):w>3?y(d,f,b):y(d,f))||b);return w>3&&b&&Object.defineProperty(d,f,b),b},g=this&&this.__param||function(o,d){return function(f,p){d(f,p,o)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferService=t.MINIMUM_ROWS=t.MINIMUM_COLS=void 0;let a=n(8460),l=n(844),_=n(5295),v=n(2585);t.MINIMUM_COLS=2,t.MINIMUM_ROWS=1;let u=t.BufferService=class extends l.Disposable{get buffer(){return this.buffers.active}constructor(o){super(),this.isUserScrolling=!1,this._onResize=this.register(new a.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new a.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(o.rawOptions.cols||0,t.MINIMUM_COLS),this.rows=Math.max(o.rawOptions.rows||0,t.MINIMUM_ROWS),this.buffers=this.register(new _.BufferSet(o,this))}resize(o,d){this.cols=o,this.rows=d,this.buffers.resize(o,d),this._onResize.fire({cols:o,rows:d})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(o,d=!1){let f=this.buffer,p;p=this._cachedBlankLine,p&&p.length===this.cols&&p.getFg(0)===o.fg&&p.getBg(0)===o.bg||(p=f.getBlankLine(o,d),this._cachedBlankLine=p),p.isWrapped=d;let y=f.ybase+f.scrollTop,w=f.ybase+f.scrollBottom;if(f.scrollTop===0){let b=f.lines.isFull;w===f.lines.length-1?b?f.lines.recycle().copyFrom(p):f.lines.push(p.clone()):f.lines.splice(w+1,0,p.clone()),b?this.isUserScrolling&&(f.ydisp=Math.max(f.ydisp-1,0)):(f.ybase++,this.isUserScrolling||f.ydisp++)}else{let b=w-y+1;f.lines.shiftElements(y+1,b-1,-1),f.lines.set(w,p.clone())}this.isUserScrolling||(f.ydisp=f.ybase),this._onScroll.fire(f.ydisp)}scrollLines(o,d,f){let p=this.buffer;if(o<0){if(p.ydisp===0)return;this.isUserScrolling=!0}else o+p.ydisp>=p.ybase&&(this.isUserScrolling=!1);let y=p.ydisp;p.ydisp=Math.max(Math.min(p.ydisp+o,p.ybase),0),y!==p.ydisp&&(d||this._onScroll.fire(p.ydisp))}};t.BufferService=u=h([g(0,v.IOptionsService)],u)},7994:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CharsetService=void 0,t.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(n){this.glevel=n,this.charset=this._charsets[n]}setgCharset(n,h){this._charsets[n]=h,this.glevel===n&&(this.charset=h)}}},1753:function(c,t,n){var h=this&&this.__decorate||function(p,y,w,b){var S,A=arguments.length,C=A<3?y:b===null?b=Object.getOwnPropertyDescriptor(y,w):b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(p,y,w,b);else for(var D=p.length-1;D>=0;D--)(S=p[D])&&(C=(A<3?S(C):A>3?S(y,w,C):S(y,w))||C);return A>3&&C&&Object.defineProperty(y,w,C),C},g=this&&this.__param||function(p,y){return function(w,b){y(w,b,p)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CoreMouseService=void 0;let a=n(2585),l=n(8460),_=n(844),v={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:p=>p.button!==4&&p.action===1&&(p.ctrl=!1,p.alt=!1,p.shift=!1,!0)},VT200:{events:19,restrict:p=>p.action!==32},DRAG:{events:23,restrict:p=>p.action!==32||p.button!==3},ANY:{events:31,restrict:p=>!0}};function u(p,y){let w=(p.ctrl?16:0)|(p.shift?4:0)|(p.alt?8:0);return p.button===4?(w|=64,w|=p.action):(w|=3&p.button,4&p.button&&(w|=64),8&p.button&&(w|=128),p.action===32?w|=32:p.action!==0||y||(w|=3)),w}let o=String.fromCharCode,d={DEFAULT:p=>{let y=[u(p,!1)+32,p.col+32,p.row+32];return y[0]>255||y[1]>255||y[2]>255?"":`\x1B[M${o(y[0])}${o(y[1])}${o(y[2])}`},SGR:p=>{let y=p.action===0&&p.button!==4?"m":"M";return`\x1B[<${u(p,!0)};${p.col};${p.row}${y}`},SGR_PIXELS:p=>{let y=p.action===0&&p.button!==4?"m":"M";return`\x1B[<${u(p,!0)};${p.x};${p.y}${y}`}},f=t.CoreMouseService=class extends _.Disposable{constructor(p,y){super(),this._bufferService=p,this._coreService=y,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new l.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(let w of Object.keys(v))this.addProtocol(w,v[w]);for(let w of Object.keys(d))this.addEncoding(w,d[w]);this.reset()}addProtocol(p,y){this._protocols[p]=y}addEncoding(p,y){this._encodings[p]=y}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(p){if(!this._protocols[p])throw new Error(`unknown protocol "${p}"`);this._activeProtocol=p,this._onProtocolChange.fire(this._protocols[p].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(p){if(!this._encodings[p])throw new Error(`unknown encoding "${p}"`);this._activeEncoding=p}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(p){if(p.col<0||p.col>=this._bufferService.cols||p.row<0||p.row>=this._bufferService.rows||p.button===4&&p.action===32||p.button===3&&p.action!==32||p.button!==4&&(p.action===2||p.action===3)||(p.col++,p.row++,p.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,p,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(p))return!1;let y=this._encodings[this._activeEncoding](p);return y&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(y):this._coreService.triggerDataEvent(y,!0)),this._lastEvent=p,!0}explainEvents(p){return{down:!!(1&p),up:!!(2&p),drag:!!(4&p),move:!!(8&p),wheel:!!(16&p)}}_equalEvents(p,y,w){if(w){if(p.x!==y.x||p.y!==y.y)return!1}else if(p.col!==y.col||p.row!==y.row)return!1;return p.button===y.button&&p.action===y.action&&p.ctrl===y.ctrl&&p.alt===y.alt&&p.shift===y.shift}};t.CoreMouseService=f=h([g(0,a.IBufferService),g(1,a.ICoreService)],f)},6975:function(c,t,n){var h=this&&this.__decorate||function(f,p,y,w){var b,S=arguments.length,A=S<3?p:w===null?w=Object.getOwnPropertyDescriptor(p,y):w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")A=Reflect.decorate(f,p,y,w);else for(var C=f.length-1;C>=0;C--)(b=f[C])&&(A=(S<3?b(A):S>3?b(p,y,A):b(p,y))||A);return S>3&&A&&Object.defineProperty(p,y,A),A},g=this&&this.__param||function(f,p){return function(y,w){p(y,w,f)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CoreService=void 0;let a=n(1439),l=n(8460),_=n(844),v=n(2585),u=Object.freeze({insertMode:!1}),o=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0}),d=t.CoreService=class extends _.Disposable{constructor(f,p,y){super(),this._bufferService=f,this._logService=p,this._optionsService=y,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new l.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new l.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new l.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new l.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,a.clone)(u),this.decPrivateModes=(0,a.clone)(o)}reset(){this.modes=(0,a.clone)(u),this.decPrivateModes=(0,a.clone)(o)}triggerDataEvent(f,p=!1){if(this._optionsService.rawOptions.disableStdin)return;let y=this._bufferService.buffer;p&&this._optionsService.rawOptions.scrollOnUserInput&&y.ybase!==y.ydisp&&this._onRequestScrollToBottom.fire(),p&&this._onUserInput.fire(),this._logService.debug(`sending data "${f}"`,()=>f.split("").map(w=>w.charCodeAt(0))),this._onData.fire(f)}triggerBinaryEvent(f){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${f}"`,()=>f.split("").map(p=>p.charCodeAt(0))),this._onBinary.fire(f))}};t.CoreService=d=h([g(0,v.IBufferService),g(1,v.ILogService),g(2,v.IOptionsService)],d)},9074:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DecorationService=void 0;let h=n(8055),g=n(8460),a=n(844),l=n(6106),_=0,v=0;class u extends a.Disposable{get decorations(){return this._decorations.values()}constructor(){super(),this._decorations=new l.SortedList(f=>f?.marker.line),this._onDecorationRegistered=this.register(new g.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new g.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,a.toDisposable)(()=>this.reset()))}registerDecoration(f){if(f.marker.isDisposed)return;let p=new o(f);if(p){let y=p.marker.onDispose(()=>p.dispose());p.onDispose(()=>{p&&(this._decorations.delete(p)&&this._onDecorationRemoved.fire(p),y.dispose())}),this._decorations.insert(p),this._onDecorationRegistered.fire(p)}return p}reset(){for(let f of this._decorations.values())f.dispose();this._decorations.clear()}*getDecorationsAtCell(f,p,y){let w=0,b=0;for(let S of this._decorations.getKeyIterator(p))w=S.options.x??0,b=w+(S.options.width??1),f>=w&&f<b&&(!y||(S.options.layer??"bottom")===y)&&(yield S)}forEachDecorationAtCell(f,p,y,w){this._decorations.forEachByKey(p,b=>{_=b.options.x??0,v=_+(b.options.width??1),f>=_&&f<v&&(!y||(b.options.layer??"bottom")===y)&&w(b)})}}t.DecorationService=u;class o extends a.Disposable{get isDisposed(){return this._isDisposed}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=h.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=h.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}constructor(f){super(),this.options=f,this.onRenderEmitter=this.register(new g.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new g.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=f.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InstantiationService=t.ServiceCollection=void 0;let h=n(2585),g=n(8343);class a{constructor(..._){this._entries=new Map;for(let[v,u]of _)this.set(v,u)}set(_,v){let u=this._entries.get(_);return this._entries.set(_,v),u}forEach(_){for(let[v,u]of this._entries.entries())_(v,u)}has(_){return this._entries.has(_)}get(_){return this._entries.get(_)}}t.ServiceCollection=a,t.InstantiationService=class{constructor(){this._services=new a,this._services.set(h.IInstantiationService,this)}setService(l,_){this._services.set(l,_)}getService(l){return this._services.get(l)}createInstance(l,..._){let v=(0,g.getServiceDependencies)(l).sort((d,f)=>d.index-f.index),u=[];for(let d of v){let f=this._services.get(d.id);if(!f)throw new Error(`[createInstance] ${l.name} depends on UNKNOWN service ${d.id}.`);u.push(f)}let o=v.length>0?v[0].index:_.length;if(_.length!==o)throw new Error(`[createInstance] First service dependency of ${l.name} at position ${o+1} conflicts with ${_.length} static arguments`);return new l(..._,...u)}}},7866:function(c,t,n){var h=this&&this.__decorate||function(o,d,f,p){var y,w=arguments.length,b=w<3?d:p===null?p=Object.getOwnPropertyDescriptor(d,f):p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(o,d,f,p);else for(var S=o.length-1;S>=0;S--)(y=o[S])&&(b=(w<3?y(b):w>3?y(d,f,b):y(d,f))||b);return w>3&&b&&Object.defineProperty(d,f,b),b},g=this&&this.__param||function(o,d){return function(f,p){d(f,p,o)}};Object.defineProperty(t,"__esModule",{value:!0}),t.traceCall=t.setTraceLogger=t.LogService=void 0;let a=n(844),l=n(2585),_={trace:l.LogLevelEnum.TRACE,debug:l.LogLevelEnum.DEBUG,info:l.LogLevelEnum.INFO,warn:l.LogLevelEnum.WARN,error:l.LogLevelEnum.ERROR,off:l.LogLevelEnum.OFF},v,u=t.LogService=class extends a.Disposable{get logLevel(){return this._logLevel}constructor(o){super(),this._optionsService=o,this._logLevel=l.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),v=this}_updateLogLevel(){this._logLevel=_[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(o){for(let d=0;d<o.length;d++)typeof o[d]=="function"&&(o[d]=o[d]())}_log(o,d,f){this._evalLazyOptionalParams(f),o.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+d,...f)}trace(o,...d){this._logLevel<=l.LogLevelEnum.TRACE&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,o,d)}debug(o,...d){this._logLevel<=l.LogLevelEnum.DEBUG&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,o,d)}info(o,...d){this._logLevel<=l.LogLevelEnum.INFO&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,o,d)}warn(o,...d){this._logLevel<=l.LogLevelEnum.WARN&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,o,d)}error(o,...d){this._logLevel<=l.LogLevelEnum.ERROR&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,o,d)}};t.LogService=u=h([g(0,l.IOptionsService)],u),t.setTraceLogger=function(o){v=o},t.traceCall=function(o,d,f){if(typeof f.value!="function")throw new Error("not supported");let p=f.value;f.value=function(...y){if(v.logLevel!==l.LogLevelEnum.TRACE)return p.apply(this,y);v.trace(`GlyphRenderer#${p.name}(${y.map(b=>JSON.stringify(b)).join(", ")})`);let w=p.apply(this,y);return v.trace(`GlyphRenderer#${p.name} return`,w),w}}},7302:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OptionsService=t.DEFAULT_OPTIONS=void 0;let h=n(8460),g=n(844),a=n(6114);t.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rescaleOverlappingGlyphs:!1,rightClickSelectsWord:a.isMac,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};let l=["normal","bold","100","200","300","400","500","600","700","800","900"];class _ extends g.Disposable{constructor(u){super(),this._onOptionChange=this.register(new h.EventEmitter),this.onOptionChange=this._onOptionChange.event;let o={...t.DEFAULT_OPTIONS};for(let d in u)if(d in o)try{let f=u[d];o[d]=this._sanitizeAndValidateOption(d,f)}catch(f){console.error(f)}this.rawOptions=o,this.options={...o},this._setupOptions(),this.register((0,g.toDisposable)(()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null}))}onSpecificOptionChange(u,o){return this.onOptionChange(d=>{d===u&&o(this.rawOptions[u])})}onMultipleOptionChange(u,o){return this.onOptionChange(d=>{u.indexOf(d)!==-1&&o()})}_setupOptions(){let u=d=>{if(!(d in t.DEFAULT_OPTIONS))throw new Error(`No option with key "${d}"`);return this.rawOptions[d]},o=(d,f)=>{if(!(d in t.DEFAULT_OPTIONS))throw new Error(`No option with key "${d}"`);f=this._sanitizeAndValidateOption(d,f),this.rawOptions[d]!==f&&(this.rawOptions[d]=f,this._onOptionChange.fire(d))};for(let d in this.rawOptions){let f={get:u.bind(this,d),set:o.bind(this,d)};Object.defineProperty(this.options,d,f)}}_sanitizeAndValidateOption(u,o){switch(u){case"cursorStyle":if(o||(o=t.DEFAULT_OPTIONS[u]),!function(d){return d==="block"||d==="underline"||d==="bar"}(o))throw new Error(`"${o}" is not a valid value for ${u}`);break;case"wordSeparator":o||(o=t.DEFAULT_OPTIONS[u]);break;case"fontWeight":case"fontWeightBold":if(typeof o=="number"&&1<=o&&o<=1e3)break;o=l.includes(o)?o:t.DEFAULT_OPTIONS[u];break;case"cursorWidth":o=Math.floor(o);case"lineHeight":case"tabStopWidth":if(o<1)throw new Error(`${u} cannot be less than 1, value: ${o}`);break;case"minimumContrastRatio":o=Math.max(1,Math.min(21,Math.round(10*o)/10));break;case"scrollback":if((o=Math.min(o,4294967295))<0)throw new Error(`${u} cannot be less than 0, value: ${o}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(o<=0)throw new Error(`${u} cannot be less than or equal to 0, value: ${o}`);break;case"rows":case"cols":if(!o&&o!==0)throw new Error(`${u} must be numeric, value: ${o}`);break;case"windowsPty":o=o??{}}return o}}t.OptionsService=_},2660:function(c,t,n){var h=this&&this.__decorate||function(_,v,u,o){var d,f=arguments.length,p=f<3?v:o===null?o=Object.getOwnPropertyDescriptor(v,u):o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(_,v,u,o);else for(var y=_.length-1;y>=0;y--)(d=_[y])&&(p=(f<3?d(p):f>3?d(v,u,p):d(v,u))||p);return f>3&&p&&Object.defineProperty(v,u,p),p},g=this&&this.__param||function(_,v){return function(u,o){v(u,o,_)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OscLinkService=void 0;let a=n(2585),l=t.OscLinkService=class{constructor(_){this._bufferService=_,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(_){let v=this._bufferService.buffer;if(_.id===void 0){let y=v.addMarker(v.ybase+v.y),w={data:_,id:this._nextId++,lines:[y]};return y.onDispose(()=>this._removeMarkerFromLink(w,y)),this._dataByLinkId.set(w.id,w),w.id}let u=_,o=this._getEntryIdKey(u),d=this._entriesWithId.get(o);if(d)return this.addLineToLink(d.id,v.ybase+v.y),d.id;let f=v.addMarker(v.ybase+v.y),p={id:this._nextId++,key:this._getEntryIdKey(u),data:u,lines:[f]};return f.onDispose(()=>this._removeMarkerFromLink(p,f)),this._entriesWithId.set(p.key,p),this._dataByLinkId.set(p.id,p),p.id}addLineToLink(_,v){let u=this._dataByLinkId.get(_);if(u&&u.lines.every(o=>o.line!==v)){let o=this._bufferService.buffer.addMarker(v);u.lines.push(o),o.onDispose(()=>this._removeMarkerFromLink(u,o))}}getLinkData(_){return this._dataByLinkId.get(_)?.data}_getEntryIdKey(_){return`${_.id};;${_.uri}`}_removeMarkerFromLink(_,v){let u=_.lines.indexOf(v);u!==-1&&(_.lines.splice(u,1),_.lines.length===0&&(_.data.id!==void 0&&this._entriesWithId.delete(_.key),this._dataByLinkId.delete(_.id)))}};t.OscLinkService=l=h([g(0,a.IBufferService)],l)},8343:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createDecorator=t.getServiceDependencies=t.serviceRegistry=void 0;let n="di$target",h="di$dependencies";t.serviceRegistry=new Map,t.getServiceDependencies=function(g){return g[h]||[]},t.createDecorator=function(g){if(t.serviceRegistry.has(g))return t.serviceRegistry.get(g);let a=function(l,_,v){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(u,o,d){o[n]===o?o[h].push({id:u,index:d}):(o[h]=[{id:u,index:d}],o[n]=o)})(a,l,v)};return a.toString=()=>g,t.serviceRegistry.set(g,a),a}},2585:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IDecorationService=t.IUnicodeService=t.IOscLinkService=t.IOptionsService=t.ILogService=t.LogLevelEnum=t.IInstantiationService=t.ICharsetService=t.ICoreService=t.ICoreMouseService=t.IBufferService=void 0;let h=n(8343);var g;t.IBufferService=(0,h.createDecorator)("BufferService"),t.ICoreMouseService=(0,h.createDecorator)("CoreMouseService"),t.ICoreService=(0,h.createDecorator)("CoreService"),t.ICharsetService=(0,h.createDecorator)("CharsetService"),t.IInstantiationService=(0,h.createDecorator)("InstantiationService"),function(a){a[a.TRACE=0]="TRACE",a[a.DEBUG=1]="DEBUG",a[a.INFO=2]="INFO",a[a.WARN=3]="WARN",a[a.ERROR=4]="ERROR",a[a.OFF=5]="OFF"}(g||(t.LogLevelEnum=g={})),t.ILogService=(0,h.createDecorator)("LogService"),t.IOptionsService=(0,h.createDecorator)("OptionsService"),t.IOscLinkService=(0,h.createDecorator)("OscLinkService"),t.IUnicodeService=(0,h.createDecorator)("UnicodeService"),t.IDecorationService=(0,h.createDecorator)("DecorationService")},1480:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeService=void 0;let h=n(8460),g=n(225);class a{static extractShouldJoin(_){return(1&_)!=0}static extractWidth(_){return _>>1&3}static extractCharKind(_){return _>>3}static createPropertyValue(_,v,u=!1){return(16777215&_)<<3|(3&v)<<1|(u?1:0)}constructor(){this._providers=Object.create(null),this._active="",this._onChange=new h.EventEmitter,this.onChange=this._onChange.event;let _=new g.UnicodeV6;this.register(_),this._active=_.version,this._activeProvider=_}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(_){if(!this._providers[_])throw new Error(`unknown Unicode version "${_}"`);this._active=_,this._activeProvider=this._providers[_],this._onChange.fire(_)}register(_){this._providers[_.version]=_}wcwidth(_){return this._activeProvider.wcwidth(_)}getStringCellWidth(_){let v=0,u=0,o=_.length;for(let d=0;d<o;++d){let f=_.charCodeAt(d);if(55296<=f&&f<=56319){if(++d>=o)return v+this.wcwidth(f);let w=_.charCodeAt(d);56320<=w&&w<=57343?f=1024*(f-55296)+w-56320+65536:v+=this.wcwidth(w)}let p=this.charProperties(f,u),y=a.extractWidth(p);a.extractShouldJoin(p)&&(y-=a.extractWidth(u)),v+=y,u=p}return v}charProperties(_,v){return this._activeProvider.charProperties(_,v)}}t.UnicodeService=a}},i={};function r(c){var t=i[c];if(t!==void 0)return t.exports;var n=i[c]={exports:{}};return e[c].call(n.exports,n,n.exports,r),n.exports}var s={};return(()=>{var c=s;Object.defineProperty(c,"__esModule",{value:!0}),c.Terminal=void 0;let t=r(9042),n=r(3236),h=r(844),g=r(5741),a=r(8285),l=r(7975),_=r(7090),v=["cols","rows"];class u extends h.Disposable{constructor(d){super(),this._core=this.register(new n.Terminal(d)),this._addonManager=this.register(new g.AddonManager),this._publicOptions={...this._core.options};let f=y=>this._core.options[y],p=(y,w)=>{this._checkReadonlyOptions(y),this._core.options[y]=w};for(let y in this._core.options){let w={get:f.bind(this,y),set:p.bind(this,y)};Object.defineProperty(this._publicOptions,y,w)}}_checkReadonlyOptions(d){if(v.includes(d))throw new Error(`Option "${d}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new l.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new _.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this.register(new a.BufferNamespaceApi(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){let d=this._core.coreService.decPrivateModes,f="none";switch(this._core.coreMouseService.activeProtocol){case"X10":f="x10";break;case"VT200":f="vt200";break;case"DRAG":f="drag";break;case"ANY":f="any"}return{applicationCursorKeysMode:d.applicationCursorKeys,applicationKeypadMode:d.applicationKeypad,bracketedPasteMode:d.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:f,originMode:d.origin,reverseWraparoundMode:d.reverseWraparound,sendFocusMode:d.sendFocus,wraparoundMode:d.wraparound}}get options(){return this._publicOptions}set options(d){for(let f in d)this._publicOptions[f]=d[f]}blur(){this._core.blur()}focus(){this._core.focus()}input(d,f=!0){this._core.input(d,f)}resize(d,f){this._verifyIntegers(d,f),this._core.resize(d,f)}open(d){this._core.open(d)}attachCustomKeyEventHandler(d){this._core.attachCustomKeyEventHandler(d)}attachCustomWheelEventHandler(d){this._core.attachCustomWheelEventHandler(d)}registerLinkProvider(d){return this._core.registerLinkProvider(d)}registerCharacterJoiner(d){return this._checkProposedApi(),this._core.registerCharacterJoiner(d)}deregisterCharacterJoiner(d){this._checkProposedApi(),this._core.deregisterCharacterJoiner(d)}registerMarker(d=0){return this._verifyIntegers(d),this._core.registerMarker(d)}registerDecoration(d){return this._checkProposedApi(),this._verifyPositiveIntegers(d.x??0,d.width??0,d.height??0),this._core.registerDecoration(d)}hasSelection(){return this._core.hasSelection()}select(d,f,p){this._verifyIntegers(d,f,p),this._core.select(d,f,p)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(d,f){this._verifyIntegers(d,f),this._core.selectLines(d,f)}dispose(){super.dispose()}scrollLines(d){this._verifyIntegers(d),this._core.scrollLines(d)}scrollPages(d){this._verifyIntegers(d),this._core.scrollPages(d)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(d){this._verifyIntegers(d),this._core.scrollToLine(d)}clear(){this._core.clear()}write(d,f){this._core.write(d,f)}writeln(d,f){this._core.write(d),this._core.write(`\r
`,f)}paste(d){this._core.paste(d)}refresh(d,f){this._verifyIntegers(d,f),this._core.refresh(d,f)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(d){this._addonManager.loadAddon(this,d)}static get strings(){return t}_verifyIntegers(...d){for(let f of d)if(f===1/0||isNaN(f)||f%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...d){for(let f of d)if(f&&(f===1/0||isNaN(f)||f%1!=0||f<0))throw new Error("This API only accepts positive integers")}}c.Terminal=u})(),s})())});var Yc=re((Cs,_o)=>{(function(e,i){typeof Cs=="object"&&typeof _o=="object"?_o.exports=i():typeof define=="function"&&define.amd?define([],i):typeof Cs=="object"?Cs.FitAddon=i():e.FitAddon=i()})(self,()=>(()=>{"use strict";var e={};return(()=>{var i=e;Object.defineProperty(i,"__esModule",{value:!0}),i.FitAddon=void 0,i.FitAddon=class{activate(r){this._terminal=r}dispose(){}fit(){let r=this.proposeDimensions();if(!r||!this._terminal||isNaN(r.cols)||isNaN(r.rows))return;let s=this._terminal._core;this._terminal.rows===r.rows&&this._terminal.cols===r.cols||(s._renderService.clear(),this._terminal.resize(r.cols,r.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;let r=this._terminal._core,s=r._renderService.dimensions;if(s.css.cell.width===0||s.css.cell.height===0)return;let c=this._terminal.options.scrollback===0?0:r.viewport.scrollBarWidth,t=window.getComputedStyle(this._terminal.element.parentElement),n=parseInt(t.getPropertyValue("height")),h=Math.max(0,parseInt(t.getPropertyValue("width"))),g=window.getComputedStyle(this._terminal.element),a=n-(parseInt(g.getPropertyValue("padding-top"))+parseInt(g.getPropertyValue("padding-bottom"))),l=h-(parseInt(g.getPropertyValue("padding-right"))+parseInt(g.getPropertyValue("padding-left")))-c;return{cols:Math.max(2,Math.floor(l/s.css.cell.width)),rows:Math.max(1,Math.floor(a/s.css.cell.height))}}}})(),e})())});var Zc=re((xs,go)=>{(function(e,i){typeof xs=="object"&&typeof go=="object"?go.exports=i():typeof define=="function"&&define.amd?define([],i):typeof xs=="object"?xs.WebglAddon=i():e.WebglAddon=i()})(self,()=>(()=>{"use strict";var e={965:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GlyphRenderer=void 0;let h=n(374),g=n(509),a=n(855),l=n(859),_=n(381),v=11,u=v*Float32Array.BYTES_PER_ELEMENT,o,d=0,f=0,p=0;class y extends l.Disposable{constructor(b,S,A){super(),this._terminal=b,this._gl=S,this._dimensions=A,this._activeBuffer=0,this._vertices={count:0,attributes:new Float32Array(0),attributesBuffers:[new Float32Array(0),new Float32Array(0)]};let C=this._gl;g.TextureAtlas.maxAtlasPages===void 0&&(g.TextureAtlas.maxAtlasPages=Math.min(32,(0,h.throwIfFalsy)(C.getParameter(C.MAX_TEXTURE_IMAGE_UNITS))),g.TextureAtlas.maxTextureSize=(0,h.throwIfFalsy)(C.getParameter(C.MAX_TEXTURE_SIZE))),this._program=(0,h.throwIfFalsy)((0,_.createProgram)(C,`#version 300 es
layout (location = 0) in vec2 a_unitquad;
layout (location = 1) in vec2 a_cellpos;
layout (location = 2) in vec2 a_offset;
layout (location = 3) in vec2 a_size;
layout (location = 4) in float a_texpage;
layout (location = 5) in vec2 a_texcoord;
layout (location = 6) in vec2 a_texsize;

uniform mat4 u_projection;
uniform vec2 u_resolution;

out vec2 v_texcoord;
flat out int v_texpage;

void main() {
  vec2 zeroToOne = (a_offset / u_resolution) + a_cellpos + (a_unitquad * a_size);
  gl_Position = u_projection * vec4(zeroToOne, 0.0, 1.0);
  v_texpage = int(a_texpage);
  v_texcoord = a_texcoord + a_unitquad * a_texsize;
}`,function(K){let Q="";for(let N=1;N<K;N++)Q+=` else if (v_texpage == ${N}) { outColor = texture(u_texture[${N}], v_texcoord); }`;return`#version 300 es
precision lowp float;

in vec2 v_texcoord;
flat in int v_texpage;

uniform sampler2D u_texture[${K}];

out vec4 outColor;

void main() {
  if (v_texpage == 0) {
    outColor = texture(u_texture[0], v_texcoord);
  } ${Q}
}`}(g.TextureAtlas.maxAtlasPages))),this.register((0,l.toDisposable)(()=>C.deleteProgram(this._program))),this._projectionLocation=(0,h.throwIfFalsy)(C.getUniformLocation(this._program,"u_projection")),this._resolutionLocation=(0,h.throwIfFalsy)(C.getUniformLocation(this._program,"u_resolution")),this._textureLocation=(0,h.throwIfFalsy)(C.getUniformLocation(this._program,"u_texture")),this._vertexArrayObject=C.createVertexArray(),C.bindVertexArray(this._vertexArrayObject);let D=new Float32Array([0,0,1,0,0,1,1,1]),L=C.createBuffer();this.register((0,l.toDisposable)(()=>C.deleteBuffer(L))),C.bindBuffer(C.ARRAY_BUFFER,L),C.bufferData(C.ARRAY_BUFFER,D,C.STATIC_DRAW),C.enableVertexAttribArray(0),C.vertexAttribPointer(0,2,this._gl.FLOAT,!1,0,0);let B=new Uint8Array([0,1,2,3]),R=C.createBuffer();this.register((0,l.toDisposable)(()=>C.deleteBuffer(R))),C.bindBuffer(C.ELEMENT_ARRAY_BUFFER,R),C.bufferData(C.ELEMENT_ARRAY_BUFFER,B,C.STATIC_DRAW),this._attributesBuffer=(0,h.throwIfFalsy)(C.createBuffer()),this.register((0,l.toDisposable)(()=>C.deleteBuffer(this._attributesBuffer))),C.bindBuffer(C.ARRAY_BUFFER,this._attributesBuffer),C.enableVertexAttribArray(2),C.vertexAttribPointer(2,2,C.FLOAT,!1,u,0),C.vertexAttribDivisor(2,1),C.enableVertexAttribArray(3),C.vertexAttribPointer(3,2,C.FLOAT,!1,u,2*Float32Array.BYTES_PER_ELEMENT),C.vertexAttribDivisor(3,1),C.enableVertexAttribArray(4),C.vertexAttribPointer(4,1,C.FLOAT,!1,u,4*Float32Array.BYTES_PER_ELEMENT),C.vertexAttribDivisor(4,1),C.enableVertexAttribArray(5),C.vertexAttribPointer(5,2,C.FLOAT,!1,u,5*Float32Array.BYTES_PER_ELEMENT),C.vertexAttribDivisor(5,1),C.enableVertexAttribArray(6),C.vertexAttribPointer(6,2,C.FLOAT,!1,u,7*Float32Array.BYTES_PER_ELEMENT),C.vertexAttribDivisor(6,1),C.enableVertexAttribArray(1),C.vertexAttribPointer(1,2,C.FLOAT,!1,u,9*Float32Array.BYTES_PER_ELEMENT),C.vertexAttribDivisor(1,1),C.useProgram(this._program);let F=new Int32Array(g.TextureAtlas.maxAtlasPages);for(let K=0;K<g.TextureAtlas.maxAtlasPages;K++)F[K]=K;C.uniform1iv(this._textureLocation,F),C.uniformMatrix4fv(this._projectionLocation,!1,_.PROJECTION_MATRIX),this._atlasTextures=[];for(let K=0;K<g.TextureAtlas.maxAtlasPages;K++){let Q=new _.GLTexture((0,h.throwIfFalsy)(C.createTexture()));this.register((0,l.toDisposable)(()=>C.deleteTexture(Q.texture))),C.activeTexture(C.TEXTURE0+K),C.bindTexture(C.TEXTURE_2D,Q.texture),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_S,C.CLAMP_TO_EDGE),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_T,C.CLAMP_TO_EDGE),C.texImage2D(C.TEXTURE_2D,0,C.RGBA,1,1,0,C.RGBA,C.UNSIGNED_BYTE,new Uint8Array([255,0,0,255])),this._atlasTextures[K]=Q}C.enable(C.BLEND),C.blendFunc(C.SRC_ALPHA,C.ONE_MINUS_SRC_ALPHA),this.handleResize()}beginFrame(){return!this._atlas||this._atlas.beginFrame()}updateCell(b,S,A,C,D,L,B,R){this._updateCell(this._vertices.attributes,b,S,A,C,D,L,B,R)}_updateCell(b,S,A,C,D,L,B,R,F){d=(A*this._terminal.cols+S)*v,C!==a.NULL_CELL_CODE&&C!==void 0?this._atlas&&(o=R&&R.length>1?this._atlas.getRasterizedGlyphCombinedChar(R,D,L,B,!1):this._atlas.getRasterizedGlyph(C,D,L,B,!1),f=Math.floor((this._dimensions.device.cell.width-this._dimensions.device.char.width)/2),D!==F&&o.offset.x>f?(p=o.offset.x-f,b[d]=-(o.offset.x-p)+this._dimensions.device.char.left,b[d+1]=-o.offset.y+this._dimensions.device.char.top,b[d+2]=(o.size.x-p)/this._dimensions.device.canvas.width,b[d+3]=o.size.y/this._dimensions.device.canvas.height,b[d+4]=o.texturePage,b[d+5]=o.texturePositionClipSpace.x+p/this._atlas.pages[o.texturePage].canvas.width,b[d+6]=o.texturePositionClipSpace.y,b[d+7]=o.sizeClipSpace.x-p/this._atlas.pages[o.texturePage].canvas.width,b[d+8]=o.sizeClipSpace.y):(b[d]=-o.offset.x+this._dimensions.device.char.left,b[d+1]=-o.offset.y+this._dimensions.device.char.top,b[d+2]=o.size.x/this._dimensions.device.canvas.width,b[d+3]=o.size.y/this._dimensions.device.canvas.height,b[d+4]=o.texturePage,b[d+5]=o.texturePositionClipSpace.x,b[d+6]=o.texturePositionClipSpace.y,b[d+7]=o.sizeClipSpace.x,b[d+8]=o.sizeClipSpace.y)):b.fill(0,d,d+v-1-2)}clear(){let b=this._terminal,S=b.cols*b.rows*v;this._vertices.count!==S?this._vertices.attributes=new Float32Array(S):this._vertices.attributes.fill(0);let A=0;for(;A<this._vertices.attributesBuffers.length;A++)this._vertices.count!==S?this._vertices.attributesBuffers[A]=new Float32Array(S):this._vertices.attributesBuffers[A].fill(0);this._vertices.count=S,A=0;for(let C=0;C<b.rows;C++)for(let D=0;D<b.cols;D++)this._vertices.attributes[A+9]=D/b.cols,this._vertices.attributes[A+10]=C/b.rows,A+=v}handleResize(){let b=this._gl;b.useProgram(this._program),b.viewport(0,0,b.canvas.width,b.canvas.height),b.uniform2f(this._resolutionLocation,b.canvas.width,b.canvas.height),this.clear()}render(b){if(!this._atlas)return;let S=this._gl;S.useProgram(this._program),S.bindVertexArray(this._vertexArrayObject),this._activeBuffer=(this._activeBuffer+1)%2;let A=this._vertices.attributesBuffers[this._activeBuffer],C=0;for(let D=0;D<b.lineLengths.length;D++){let L=D*this._terminal.cols*v,B=this._vertices.attributes.subarray(L,L+b.lineLengths[D]*v);A.set(B,C),C+=B.length}S.bindBuffer(S.ARRAY_BUFFER,this._attributesBuffer),S.bufferData(S.ARRAY_BUFFER,A.subarray(0,C),S.STREAM_DRAW);for(let D=0;D<this._atlas.pages.length;D++)this._atlas.pages[D].version!==this._atlasTextures[D].version&&this._bindAtlasPageTexture(S,this._atlas,D);S.drawElementsInstanced(S.TRIANGLE_STRIP,4,S.UNSIGNED_BYTE,0,C/v)}setAtlas(b){this._atlas=b;for(let S of this._atlasTextures)S.version=-1}_bindAtlasPageTexture(b,S,A){b.activeTexture(b.TEXTURE0+A),b.bindTexture(b.TEXTURE_2D,this._atlasTextures[A].texture),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,S.pages[A].canvas),b.generateMipmap(b.TEXTURE_2D),this._atlasTextures[A].version=S.pages[A].version}setDimensions(b){this._dimensions=b}}t.GlyphRenderer=y},742:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RectangleRenderer=void 0;let h=n(374),g=n(859),a=n(310),l=n(381),_=8*Float32Array.BYTES_PER_ELEMENT;class v{constructor(){this.attributes=new Float32Array(160),this.count=0}}let u=0,o=0,d=0,f=0,p=0,y=0,w=0;class b extends g.Disposable{constructor(A,C,D,L){super(),this._terminal=A,this._gl=C,this._dimensions=D,this._themeService=L,this._vertices=new v,this._verticesCursor=new v;let B=this._gl;this._program=(0,h.throwIfFalsy)((0,l.createProgram)(B,`#version 300 es
layout (location = 0) in vec2 a_position;
layout (location = 1) in vec2 a_size;
layout (location = 2) in vec4 a_color;
layout (location = 3) in vec2 a_unitquad;

uniform mat4 u_projection;

out vec4 v_color;

void main() {
  vec2 zeroToOne = a_position + (a_unitquad * a_size);
  gl_Position = u_projection * vec4(zeroToOne, 0.0, 1.0);
  v_color = a_color;
}`,`#version 300 es
precision lowp float;

in vec4 v_color;

out vec4 outColor;

void main() {
  outColor = v_color;
}`)),this.register((0,g.toDisposable)(()=>B.deleteProgram(this._program))),this._projectionLocation=(0,h.throwIfFalsy)(B.getUniformLocation(this._program,"u_projection")),this._vertexArrayObject=B.createVertexArray(),B.bindVertexArray(this._vertexArrayObject);let R=new Float32Array([0,0,1,0,0,1,1,1]),F=B.createBuffer();this.register((0,g.toDisposable)(()=>B.deleteBuffer(F))),B.bindBuffer(B.ARRAY_BUFFER,F),B.bufferData(B.ARRAY_BUFFER,R,B.STATIC_DRAW),B.enableVertexAttribArray(3),B.vertexAttribPointer(3,2,this._gl.FLOAT,!1,0,0);let K=new Uint8Array([0,1,2,3]),Q=B.createBuffer();this.register((0,g.toDisposable)(()=>B.deleteBuffer(Q))),B.bindBuffer(B.ELEMENT_ARRAY_BUFFER,Q),B.bufferData(B.ELEMENT_ARRAY_BUFFER,K,B.STATIC_DRAW),this._attributesBuffer=(0,h.throwIfFalsy)(B.createBuffer()),this.register((0,g.toDisposable)(()=>B.deleteBuffer(this._attributesBuffer))),B.bindBuffer(B.ARRAY_BUFFER,this._attributesBuffer),B.enableVertexAttribArray(0),B.vertexAttribPointer(0,2,B.FLOAT,!1,_,0),B.vertexAttribDivisor(0,1),B.enableVertexAttribArray(1),B.vertexAttribPointer(1,2,B.FLOAT,!1,_,2*Float32Array.BYTES_PER_ELEMENT),B.vertexAttribDivisor(1,1),B.enableVertexAttribArray(2),B.vertexAttribPointer(2,4,B.FLOAT,!1,_,4*Float32Array.BYTES_PER_ELEMENT),B.vertexAttribDivisor(2,1),this._updateCachedColors(L.colors),this.register(this._themeService.onChangeColors(N=>{this._updateCachedColors(N),this._updateViewportRectangle()}))}renderBackgrounds(){this._renderVertices(this._vertices)}renderCursor(){this._renderVertices(this._verticesCursor)}_renderVertices(A){let C=this._gl;C.useProgram(this._program),C.bindVertexArray(this._vertexArrayObject),C.uniformMatrix4fv(this._projectionLocation,!1,l.PROJECTION_MATRIX),C.bindBuffer(C.ARRAY_BUFFER,this._attributesBuffer),C.bufferData(C.ARRAY_BUFFER,A.attributes,C.DYNAMIC_DRAW),C.drawElementsInstanced(this._gl.TRIANGLE_STRIP,4,C.UNSIGNED_BYTE,0,A.count)}handleResize(){this._updateViewportRectangle()}setDimensions(A){this._dimensions=A}_updateCachedColors(A){this._bgFloat=this._colorToFloat32Array(A.background),this._cursorFloat=this._colorToFloat32Array(A.cursor)}_updateViewportRectangle(){this._addRectangleFloat(this._vertices.attributes,0,0,0,this._terminal.cols*this._dimensions.device.cell.width,this._terminal.rows*this._dimensions.device.cell.height,this._bgFloat)}updateBackgrounds(A){let C=this._terminal,D=this._vertices,L,B,R,F,K,Q,N,k,m,x,E,I=1;for(L=0;L<C.rows;L++){for(R=-1,F=0,K=0,Q=!1,B=0;B<C.cols;B++)N=(L*C.cols+B)*a.RENDER_MODEL_INDICIES_PER_CELL,k=A.cells[N+a.RENDER_MODEL_BG_OFFSET],m=A.cells[N+a.RENDER_MODEL_FG_OFFSET],x=!!(67108864&m),(k!==F||m!==K&&(Q||x))&&((F!==0||Q&&K!==0)&&(E=8*I++,this._updateRectangle(D,E,K,F,R,B,L)),R=B,F=k,K=m,Q=x);(F!==0||Q&&K!==0)&&(E=8*I++,this._updateRectangle(D,E,K,F,R,C.cols,L))}D.count=I}updateCursor(A){let C=this._verticesCursor,D=A.cursor;if(!D||D.style==="block")return void(C.count=0);let L,B=0;D.style!=="bar"&&D.style!=="outline"||(L=8*B++,this._addRectangleFloat(C.attributes,L,D.x*this._dimensions.device.cell.width,D.y*this._dimensions.device.cell.height,D.style==="bar"?D.dpr*D.cursorWidth:D.dpr,this._dimensions.device.cell.height,this._cursorFloat)),D.style!=="underline"&&D.style!=="outline"||(L=8*B++,this._addRectangleFloat(C.attributes,L,D.x*this._dimensions.device.cell.width,(D.y+1)*this._dimensions.device.cell.height-D.dpr,D.width*this._dimensions.device.cell.width,D.dpr,this._cursorFloat)),D.style==="outline"&&(L=8*B++,this._addRectangleFloat(C.attributes,L,D.x*this._dimensions.device.cell.width,D.y*this._dimensions.device.cell.height,D.width*this._dimensions.device.cell.width,D.dpr,this._cursorFloat),L=8*B++,this._addRectangleFloat(C.attributes,L,(D.x+D.width)*this._dimensions.device.cell.width-D.dpr,D.y*this._dimensions.device.cell.height,D.dpr,this._dimensions.device.cell.height,this._cursorFloat)),C.count=B}_updateRectangle(A,C,D,L,B,R,F){if(67108864&D)switch(50331648&D){case 16777216:case 33554432:u=this._themeService.colors.ansi[255&D].rgba;break;case 50331648:u=(16777215&D)<<8;break;default:u=this._themeService.colors.foreground.rgba}else switch(50331648&L){case 16777216:case 33554432:u=this._themeService.colors.ansi[255&L].rgba;break;case 50331648:u=(16777215&L)<<8;break;default:u=this._themeService.colors.background.rgba}A.attributes.length<C+4&&(A.attributes=(0,l.expandFloat32Array)(A.attributes,this._terminal.rows*this._terminal.cols*8)),o=B*this._dimensions.device.cell.width,d=F*this._dimensions.device.cell.height,f=(u>>24&255)/255,p=(u>>16&255)/255,y=(u>>8&255)/255,w=1,this._addRectangle(A.attributes,C,o,d,(R-B)*this._dimensions.device.cell.width,this._dimensions.device.cell.height,f,p,y,w)}_addRectangle(A,C,D,L,B,R,F,K,Q,N){A[C]=D/this._dimensions.device.canvas.width,A[C+1]=L/this._dimensions.device.canvas.height,A[C+2]=B/this._dimensions.device.canvas.width,A[C+3]=R/this._dimensions.device.canvas.height,A[C+4]=F,A[C+5]=K,A[C+6]=Q,A[C+7]=N}_addRectangleFloat(A,C,D,L,B,R,F){A[C]=D/this._dimensions.device.canvas.width,A[C+1]=L/this._dimensions.device.canvas.height,A[C+2]=B/this._dimensions.device.canvas.width,A[C+3]=R/this._dimensions.device.canvas.height,A[C+4]=F[0],A[C+5]=F[1],A[C+6]=F[2],A[C+7]=F[3]}_colorToFloat32Array(A){return new Float32Array([(A.rgba>>24&255)/255,(A.rgba>>16&255)/255,(A.rgba>>8&255)/255,(255&A.rgba)/255])}}t.RectangleRenderer=b},310:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RenderModel=t.COMBINED_CHAR_BIT_MASK=t.RENDER_MODEL_EXT_OFFSET=t.RENDER_MODEL_FG_OFFSET=t.RENDER_MODEL_BG_OFFSET=t.RENDER_MODEL_INDICIES_PER_CELL=void 0;let h=n(296);t.RENDER_MODEL_INDICIES_PER_CELL=4,t.RENDER_MODEL_BG_OFFSET=1,t.RENDER_MODEL_FG_OFFSET=2,t.RENDER_MODEL_EXT_OFFSET=3,t.COMBINED_CHAR_BIT_MASK=2147483648,t.RenderModel=class{constructor(){this.cells=new Uint32Array(0),this.lineLengths=new Uint32Array(0),this.selection=(0,h.createSelectionRenderModel)()}resize(g,a){let l=g*a*t.RENDER_MODEL_INDICIES_PER_CELL;l!==this.cells.length&&(this.cells=new Uint32Array(l),this.lineLengths=new Uint32Array(a))}clear(){this.cells.fill(0,0),this.lineLengths.fill(0,0)}}},666:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.JoinedCellData=t.WebglRenderer=void 0;let h=n(820),g=n(274),a=n(627),l=n(457),_=n(56),v=n(374),u=n(345),o=n(859),d=n(147),f=n(782),p=n(855),y=n(965),w=n(742),b=n(310),S=n(733);class A extends o.Disposable{constructor(B,R,F,K,Q,N,k,m,x){super(),this._terminal=B,this._characterJoinerService=R,this._charSizeService=F,this._coreBrowserService=K,this._coreService=Q,this._decorationService=N,this._optionsService=k,this._themeService=m,this._cursorBlinkStateManager=new o.MutableDisposable,this._charAtlasDisposable=this.register(new o.MutableDisposable),this._model=new b.RenderModel,this._workCell=new f.CellData,this._rectangleRenderer=this.register(new o.MutableDisposable),this._glyphRenderer=this.register(new o.MutableDisposable),this._onChangeTextureAtlas=this.register(new u.EventEmitter),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this.register(new u.EventEmitter),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=this.register(new u.EventEmitter),this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._onRequestRedraw=this.register(new u.EventEmitter),this.onRequestRedraw=this._onRequestRedraw.event,this._onContextLoss=this.register(new u.EventEmitter),this.onContextLoss=this._onContextLoss.event,this.register(this._themeService.onChangeColors(()=>this._handleColorChange())),this._cellColorResolver=new g.CellColorResolver(this._terminal,this._model.selection,this._decorationService,this._coreBrowserService,this._themeService),this._core=this._terminal._core,this._renderLayers=[new S.LinkRenderLayer(this._core.screenElement,2,this._terminal,this._core.linkifier2,this._coreBrowserService,k,this._themeService)],this.dimensions=(0,v.createRenderDimensions)(),this._devicePixelRatio=this._coreBrowserService.dpr,this._updateDimensions(),this._updateCursorBlink(),this.register(k.onOptionChange(()=>this._handleOptionsChanged())),this._canvas=this._coreBrowserService.mainDocument.createElement("canvas");let E={antialias:!1,depth:!1,preserveDrawingBuffer:x};if(this._gl=this._canvas.getContext("webgl2",E),!this._gl)throw new Error("WebGL2 not supported "+this._gl);this.register((0,h.addDisposableDomListener)(this._canvas,"webglcontextlost",I=>{console.log("webglcontextlost event received"),I.preventDefault(),this._contextRestorationTimeout=setTimeout(()=>{this._contextRestorationTimeout=void 0,console.warn("webgl context not restored; firing onContextLoss"),this._onContextLoss.fire(I)},3e3)})),this.register((0,h.addDisposableDomListener)(this._canvas,"webglcontextrestored",I=>{console.warn("webglcontextrestored event received"),clearTimeout(this._contextRestorationTimeout),this._contextRestorationTimeout=void 0,(0,a.removeTerminalFromCache)(this._terminal),this._initializeWebGLState(),this._requestRedrawViewport()})),this.register((0,_.observeDevicePixelDimensions)(this._canvas,this._coreBrowserService.window,(I,M)=>this._setCanvasDevicePixelDimensions(I,M))),this._core.screenElement.appendChild(this._canvas),[this._rectangleRenderer.value,this._glyphRenderer.value]=this._initializeWebGLState(),this._isAttached=this._coreBrowserService.window.document.body.contains(this._core.screenElement),this.register((0,o.toDisposable)(()=>{for(let I of this._renderLayers)I.dispose();this._canvas.parentElement?.removeChild(this._canvas),(0,a.removeTerminalFromCache)(this._terminal)}))}get textureAtlas(){return this._charAtlas?.pages[0].canvas}_handleColorChange(){this._refreshCharAtlas(),this._clearModel(!0)}handleDevicePixelRatioChange(){this._devicePixelRatio!==this._coreBrowserService.dpr&&(this._devicePixelRatio=this._coreBrowserService.dpr,this.handleResize(this._terminal.cols,this._terminal.rows))}handleResize(B,R){this._updateDimensions(),this._model.resize(this._terminal.cols,this._terminal.rows);for(let F of this._renderLayers)F.resize(this._terminal,this.dimensions);this._canvas.width=this.dimensions.device.canvas.width,this._canvas.height=this.dimensions.device.canvas.height,this._canvas.style.width=`${this.dimensions.css.canvas.width}px`,this._canvas.style.height=`${this.dimensions.css.canvas.height}px`,this._core.screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._core.screenElement.style.height=`${this.dimensions.css.canvas.height}px`,this._rectangleRenderer.value?.setDimensions(this.dimensions),this._rectangleRenderer.value?.handleResize(),this._glyphRenderer.value?.setDimensions(this.dimensions),this._glyphRenderer.value?.handleResize(),this._refreshCharAtlas(),this._clearModel(!1)}handleCharSizeChanged(){this.handleResize(this._terminal.cols,this._terminal.rows)}handleBlur(){for(let B of this._renderLayers)B.handleBlur(this._terminal);this._cursorBlinkStateManager.value?.pause(),this._requestRedrawViewport()}handleFocus(){for(let B of this._renderLayers)B.handleFocus(this._terminal);this._cursorBlinkStateManager.value?.resume(),this._requestRedrawViewport()}handleSelectionChanged(B,R,F){for(let K of this._renderLayers)K.handleSelectionChanged(this._terminal,B,R,F);this._model.selection.update(this._terminal,B,R,F),this._requestRedrawViewport()}handleCursorMove(){for(let B of this._renderLayers)B.handleCursorMove(this._terminal);this._cursorBlinkStateManager.value?.restartBlinkAnimation()}_handleOptionsChanged(){this._updateDimensions(),this._refreshCharAtlas(),this._updateCursorBlink()}_initializeWebGLState(){return this._rectangleRenderer.value=new w.RectangleRenderer(this._terminal,this._gl,this.dimensions,this._themeService),this._glyphRenderer.value=new y.GlyphRenderer(this._terminal,this._gl,this.dimensions),this.handleCharSizeChanged(),[this._rectangleRenderer.value,this._glyphRenderer.value]}_refreshCharAtlas(){if(this.dimensions.device.char.width<=0&&this.dimensions.device.char.height<=0)return void(this._isAttached=!1);let B=(0,a.acquireTextureAtlas)(this._terminal,this._optionsService.rawOptions,this._themeService.colors,this.dimensions.device.cell.width,this.dimensions.device.cell.height,this.dimensions.device.char.width,this.dimensions.device.char.height,this._coreBrowserService.dpr);this._charAtlas!==B&&(this._onChangeTextureAtlas.fire(B.pages[0].canvas),this._charAtlasDisposable.value=(0,o.getDisposeArrayDisposable)([(0,u.forwardEvent)(B.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas),(0,u.forwardEvent)(B.onRemoveTextureAtlasCanvas,this._onRemoveTextureAtlasCanvas)])),this._charAtlas=B,this._charAtlas.warmUp(),this._glyphRenderer.value?.setAtlas(this._charAtlas)}_clearModel(B){this._model.clear(),B&&this._glyphRenderer.value?.clear()}clearTextureAtlas(){this._charAtlas?.clearTexture(),this._clearModel(!0),this._requestRedrawViewport()}clear(){this._clearModel(!0);for(let B of this._renderLayers)B.reset(this._terminal);this._cursorBlinkStateManager.value?.restartBlinkAnimation(),this._updateCursorBlink()}registerCharacterJoiner(B){return-1}deregisterCharacterJoiner(B){return!1}renderRows(B,R){if(!this._isAttached){if(!(this._coreBrowserService.window.document.body.contains(this._core.screenElement)&&this._charSizeService.width&&this._charSizeService.height))return;this._updateDimensions(),this._refreshCharAtlas(),this._isAttached=!0}for(let F of this._renderLayers)F.handleGridChanged(this._terminal,B,R);this._glyphRenderer.value&&this._rectangleRenderer.value&&(this._glyphRenderer.value.beginFrame()?(this._clearModel(!0),this._updateModel(0,this._terminal.rows-1)):this._updateModel(B,R),this._rectangleRenderer.value.renderBackgrounds(),this._glyphRenderer.value.render(this._model),this._cursorBlinkStateManager.value&&!this._cursorBlinkStateManager.value.isCursorVisible||this._rectangleRenderer.value.renderCursor())}_updateCursorBlink(){this._terminal.options.cursorBlink?this._cursorBlinkStateManager.value=new l.CursorBlinkStateManager(()=>{this._requestRedrawCursor()},this._coreBrowserService):this._cursorBlinkStateManager.clear(),this._requestRedrawCursor()}_updateModel(B,R){let F=this._core,K,Q,N,k,m,x,E,I,M,X,$,W,P,T=this._workCell;B=D(B,F.rows-1,0),R=D(R,F.rows-1,0);let U=this._terminal.buffer.active.baseY+this._terminal.buffer.active.cursorY,Z=Math.min(this._terminal.buffer.active.cursorX,F.cols-1),te=-1,ee=this._coreService.isCursorInitialized&&!this._coreService.isCursorHidden&&(!this._cursorBlinkStateManager.value||this._cursorBlinkStateManager.value.isCursorVisible);this._model.cursor=void 0;let le=!1;for(Q=B;Q<=R;Q++)for(N=Q+F.buffer.ydisp,k=F.buffer.lines.get(N),this._model.lineLengths[Q]=0,m=this._characterJoinerService.getJoinedCharacters(N),W=0;W<F.cols;W++)if(K=this._cellColorResolver.result.bg,k.loadCell(W,T),W===0&&(K=this._cellColorResolver.result.bg),x=!1,E=W,m.length>0&&W===m[0][0]&&(x=!0,I=m.shift(),T=new C(T,k.translateToString(!0,I[0],I[1]),I[1]-I[0]),E=I[1]-1),M=T.getChars(),X=T.getCode(),$=(Q*F.cols+W)*b.RENDER_MODEL_INDICIES_PER_CELL,this._cellColorResolver.resolve(T,W,N),ee&&N===U&&(W===Z&&(this._model.cursor={x:Z,y:this._terminal.buffer.active.cursorY,width:T.getWidth(),style:this._coreBrowserService.isFocused?F.options.cursorStyle||"block":F.options.cursorInactiveStyle,cursorWidth:F.options.cursorWidth,dpr:this._devicePixelRatio},te=Z+T.getWidth()-1),W>=Z&&W<=te&&(this._coreBrowserService.isFocused&&(F.options.cursorStyle||"block")==="block"||this._coreBrowserService.isFocused===!1&&F.options.cursorInactiveStyle==="block")&&(this._cellColorResolver.result.fg=50331648|this._themeService.colors.cursorAccent.rgba>>8&16777215,this._cellColorResolver.result.bg=50331648|this._themeService.colors.cursor.rgba>>8&16777215)),X!==p.NULL_CELL_CODE&&(this._model.lineLengths[Q]=W+1),(this._model.cells[$]!==X||this._model.cells[$+b.RENDER_MODEL_BG_OFFSET]!==this._cellColorResolver.result.bg||this._model.cells[$+b.RENDER_MODEL_FG_OFFSET]!==this._cellColorResolver.result.fg||this._model.cells[$+b.RENDER_MODEL_EXT_OFFSET]!==this._cellColorResolver.result.ext)&&(le=!0,M.length>1&&(X|=b.COMBINED_CHAR_BIT_MASK),this._model.cells[$]=X,this._model.cells[$+b.RENDER_MODEL_BG_OFFSET]=this._cellColorResolver.result.bg,this._model.cells[$+b.RENDER_MODEL_FG_OFFSET]=this._cellColorResolver.result.fg,this._model.cells[$+b.RENDER_MODEL_EXT_OFFSET]=this._cellColorResolver.result.ext,this._glyphRenderer.value.updateCell(W,Q,X,this._cellColorResolver.result.bg,this._cellColorResolver.result.fg,this._cellColorResolver.result.ext,M,K),x))for(T=this._workCell,W++;W<E;W++)P=(Q*F.cols+W)*b.RENDER_MODEL_INDICIES_PER_CELL,this._glyphRenderer.value.updateCell(W,Q,p.NULL_CELL_CODE,0,0,0,p.NULL_CELL_CHAR,0),this._model.cells[P]=p.NULL_CELL_CODE,this._model.cells[P+b.RENDER_MODEL_BG_OFFSET]=this._cellColorResolver.result.bg,this._model.cells[P+b.RENDER_MODEL_FG_OFFSET]=this._cellColorResolver.result.fg,this._model.cells[P+b.RENDER_MODEL_EXT_OFFSET]=this._cellColorResolver.result.ext;le&&this._rectangleRenderer.value.updateBackgrounds(this._model),this._rectangleRenderer.value.updateCursor(this._model)}_updateDimensions(){this._charSizeService.width&&this._charSizeService.height&&(this.dimensions.device.char.width=Math.floor(this._charSizeService.width*this._devicePixelRatio),this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*this._devicePixelRatio),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.top=this._optionsService.rawOptions.lineHeight===1?0:Math.round((this.dimensions.device.cell.height-this.dimensions.device.char.height)/2),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.char.left=Math.floor(this._optionsService.rawOptions.letterSpacing/2),this.dimensions.device.canvas.height=this._terminal.rows*this.dimensions.device.cell.height,this.dimensions.device.canvas.width=this._terminal.cols*this.dimensions.device.cell.width,this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/this._devicePixelRatio),this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/this._devicePixelRatio),this.dimensions.css.cell.height=this.dimensions.device.cell.height/this._devicePixelRatio,this.dimensions.css.cell.width=this.dimensions.device.cell.width/this._devicePixelRatio)}_setCanvasDevicePixelDimensions(B,R){this._canvas.width===B&&this._canvas.height===R||(this._canvas.width=B,this._canvas.height=R,this._requestRedrawViewport())}_requestRedrawViewport(){this._onRequestRedraw.fire({start:0,end:this._terminal.rows-1})}_requestRedrawCursor(){let B=this._terminal.buffer.active.cursorY;this._onRequestRedraw.fire({start:B,end:B})}}t.WebglRenderer=A;class C extends d.AttributeData{constructor(B,R,F){super(),this.content=0,this.combinedData="",this.fg=B.fg,this.bg=B.bg,this.combinedData=R,this._width=F}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(B){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}function D(L,B,R=0){return Math.max(Math.min(L,B),R)}t.JoinedCellData=C},381:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GLTexture=t.expandFloat32Array=t.createShader=t.createProgram=t.PROJECTION_MATRIX=void 0;let h=n(374);function g(a,l,_){let v=(0,h.throwIfFalsy)(a.createShader(l));if(a.shaderSource(v,_),a.compileShader(v),a.getShaderParameter(v,a.COMPILE_STATUS))return v;console.error(a.getShaderInfoLog(v)),a.deleteShader(v)}t.PROJECTION_MATRIX=new Float32Array([2,0,0,0,0,-2,0,0,0,0,1,0,-1,1,0,1]),t.createProgram=function(a,l,_){let v=(0,h.throwIfFalsy)(a.createProgram());if(a.attachShader(v,(0,h.throwIfFalsy)(g(a,a.VERTEX_SHADER,l))),a.attachShader(v,(0,h.throwIfFalsy)(g(a,a.FRAGMENT_SHADER,_))),a.linkProgram(v),a.getProgramParameter(v,a.LINK_STATUS))return v;console.error(a.getProgramInfoLog(v)),a.deleteProgram(v)},t.createShader=g,t.expandFloat32Array=function(a,l){let _=Math.min(2*a.length,l),v=new Float32Array(_);for(let u=0;u<a.length;u++)v[u]=a[u];return v},t.GLTexture=class{constructor(a){this.texture=a,this.version=-1}}},592:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaseRenderLayer=void 0;let h=n(627),g=n(237),a=n(374),l=n(859);class _ extends l.Disposable{constructor(u,o,d,f,p,y,w,b){super(),this._container=o,this._alpha=p,this._coreBrowserService=y,this._optionsService=w,this._themeService=b,this._deviceCharWidth=0,this._deviceCharHeight=0,this._deviceCellWidth=0,this._deviceCellHeight=0,this._deviceCharLeft=0,this._deviceCharTop=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add(`xterm-${d}-layer`),this._canvas.style.zIndex=f.toString(),this._initCanvas(),this._container.appendChild(this._canvas),this.register(this._themeService.onChangeColors(S=>{this._refreshCharAtlas(u,S),this.reset(u)})),this.register((0,l.toDisposable)(()=>{this._canvas.remove()}))}_initCanvas(){this._ctx=(0,a.throwIfFalsy)(this._canvas.getContext("2d",{alpha:this._alpha})),this._alpha||this._clearAll()}handleBlur(u){}handleFocus(u){}handleCursorMove(u){}handleGridChanged(u,o,d){}handleSelectionChanged(u,o,d,f=!1){}_setTransparency(u,o){if(o===this._alpha)return;let d=this._canvas;this._alpha=o,this._canvas=this._canvas.cloneNode(),this._initCanvas(),this._container.replaceChild(this._canvas,d),this._refreshCharAtlas(u,this._themeService.colors),this.handleGridChanged(u,0,u.rows-1)}_refreshCharAtlas(u,o){this._deviceCharWidth<=0&&this._deviceCharHeight<=0||(this._charAtlas=(0,h.acquireTextureAtlas)(u,this._optionsService.rawOptions,o,this._deviceCellWidth,this._deviceCellHeight,this._deviceCharWidth,this._deviceCharHeight,this._coreBrowserService.dpr),this._charAtlas.warmUp())}resize(u,o){this._deviceCellWidth=o.device.cell.width,this._deviceCellHeight=o.device.cell.height,this._deviceCharWidth=o.device.char.width,this._deviceCharHeight=o.device.char.height,this._deviceCharLeft=o.device.char.left,this._deviceCharTop=o.device.char.top,this._canvas.width=o.device.canvas.width,this._canvas.height=o.device.canvas.height,this._canvas.style.width=`${o.css.canvas.width}px`,this._canvas.style.height=`${o.css.canvas.height}px`,this._alpha||this._clearAll(),this._refreshCharAtlas(u,this._themeService.colors)}_fillBottomLineAtCells(u,o,d=1){this._ctx.fillRect(u*this._deviceCellWidth,(o+1)*this._deviceCellHeight-this._coreBrowserService.dpr-1,d*this._deviceCellWidth,this._coreBrowserService.dpr)}_clearAll(){this._alpha?this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height))}_clearCells(u,o,d,f){this._alpha?this._ctx.clearRect(u*this._deviceCellWidth,o*this._deviceCellHeight,d*this._deviceCellWidth,f*this._deviceCellHeight):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(u*this._deviceCellWidth,o*this._deviceCellHeight,d*this._deviceCellWidth,f*this._deviceCellHeight))}_fillCharTrueColor(u,o,d,f){this._ctx.font=this._getFont(u,!1,!1),this._ctx.textBaseline=g.TEXT_BASELINE,this._clipCell(d,f,o.getWidth()),this._ctx.fillText(o.getChars(),d*this._deviceCellWidth+this._deviceCharLeft,f*this._deviceCellHeight+this._deviceCharTop+this._deviceCharHeight)}_clipCell(u,o,d){this._ctx.beginPath(),this._ctx.rect(u*this._deviceCellWidth,o*this._deviceCellHeight,d*this._deviceCellWidth,this._deviceCellHeight),this._ctx.clip()}_getFont(u,o,d){return`${d?"italic":""} ${o?u.options.fontWeightBold:u.options.fontWeight} ${u.options.fontSize*this._coreBrowserService.dpr}px ${u.options.fontFamily}`}}t.BaseRenderLayer=_},733:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LinkRenderLayer=void 0;let h=n(197),g=n(237),a=n(592);class l extends a.BaseRenderLayer{constructor(v,u,o,d,f,p,y){super(o,v,"link",u,!0,f,p,y),this.register(d.onShowLinkUnderline(w=>this._handleShowLinkUnderline(w))),this.register(d.onHideLinkUnderline(w=>this._handleHideLinkUnderline(w)))}resize(v,u){super.resize(v,u),this._state=void 0}reset(v){this._clearCurrentLink()}_clearCurrentLink(){if(this._state){this._clearCells(this._state.x1,this._state.y1,this._state.cols-this._state.x1,1);let v=this._state.y2-this._state.y1-1;v>0&&this._clearCells(0,this._state.y1+1,this._state.cols,v),this._clearCells(0,this._state.y2,this._state.x2,1),this._state=void 0}}_handleShowLinkUnderline(v){if(v.fg===g.INVERTED_DEFAULT_COLOR?this._ctx.fillStyle=this._themeService.colors.background.css:v.fg!==void 0&&(0,h.is256Color)(v.fg)?this._ctx.fillStyle=this._themeService.colors.ansi[v.fg].css:this._ctx.fillStyle=this._themeService.colors.foreground.css,v.y1===v.y2)this._fillBottomLineAtCells(v.x1,v.y1,v.x2-v.x1);else{this._fillBottomLineAtCells(v.x1,v.y1,v.cols-v.x1);for(let u=v.y1+1;u<v.y2;u++)this._fillBottomLineAtCells(0,u,v.cols);this._fillBottomLineAtCells(0,v.y2,v.x2)}this._state=v}_handleHideLinkUnderline(v){this._clearCurrentLink()}}t.LinkRenderLayer=l},820:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addDisposableDomListener=void 0,t.addDisposableDomListener=function(n,h,g,a){n.addEventListener(h,g,a);let l=!1;return{dispose:()=>{l||(l=!0,n.removeEventListener(h,g,a))}}}},274:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CellColorResolver=void 0;let n,h=0,g=0,a=!1,l=!1,_=!1;t.CellColorResolver=class{constructor(v,u,o,d,f){this._terminal=v,this._selectionRenderModel=u,this._decorationService=o,this._coreBrowserService=d,this._themeService=f,this.result={fg:0,bg:0,ext:0}}resolve(v,u,o){this.result.bg=v.bg,this.result.fg=v.fg,this.result.ext=268435456&v.bg?v.extended.ext:0,g=0,h=0,l=!1,a=!1,_=!1,n=this._themeService.colors,this._decorationService.forEachDecorationAtCell(u,o,"bottom",d=>{d.backgroundColorRGB&&(g=d.backgroundColorRGB.rgba>>8&16777215,l=!0),d.foregroundColorRGB&&(h=d.foregroundColorRGB.rgba>>8&16777215,a=!0)}),_=this._selectionRenderModel.isCellSelected(this._terminal,u,o),_&&(g=(this._coreBrowserService.isFocused?n.selectionBackgroundOpaque:n.selectionInactiveBackgroundOpaque).rgba>>8&16777215,l=!0,n.selectionForeground&&(h=n.selectionForeground.rgba>>8&16777215,a=!0)),this._decorationService.forEachDecorationAtCell(u,o,"top",d=>{d.backgroundColorRGB&&(g=d.backgroundColorRGB.rgba>>8&16777215,l=!0),d.foregroundColorRGB&&(h=d.foregroundColorRGB.rgba>>8&16777215,a=!0)}),l&&(g=_?-16777216&v.bg&-134217729|g|50331648:-16777216&v.bg|g|50331648),a&&(h=-16777216&v.fg&-67108865|h|50331648),67108864&this.result.fg&&(l&&!a&&(h=50331648&this.result.bg?-134217728&this.result.fg|67108863&this.result.bg:-134217728&this.result.fg|16777215&n.background.rgba>>8|50331648,a=!0),!l&&a&&(g=50331648&this.result.fg?-67108864&this.result.bg|67108863&this.result.fg:-67108864&this.result.bg|16777215&n.foreground.rgba>>8|50331648,l=!0)),n=void 0,this.result.bg=l?g:this.result.bg,this.result.fg=a?h:this.result.fg}}},627:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.removeTerminalFromCache=t.acquireTextureAtlas=void 0;let h=n(509),g=n(197),a=[];t.acquireTextureAtlas=function(l,_,v,u,o,d,f,p){let y=(0,g.generateConfig)(u,o,d,f,_,v,p);for(let S=0;S<a.length;S++){let A=a[S],C=A.ownedBy.indexOf(l);if(C>=0){if((0,g.configEquals)(A.config,y))return A.atlas;A.ownedBy.length===1?(A.atlas.dispose(),a.splice(S,1)):A.ownedBy.splice(C,1);break}}for(let S=0;S<a.length;S++){let A=a[S];if((0,g.configEquals)(A.config,y))return A.ownedBy.push(l),A.atlas}let w=l._core,b={atlas:new h.TextureAtlas(document,y,w.unicodeService),config:y,ownedBy:[l]};return a.push(b),b.atlas},t.removeTerminalFromCache=function(l){for(let _=0;_<a.length;_++){let v=a[_].ownedBy.indexOf(l);if(v!==-1){a[_].ownedBy.length===1?(a[_].atlas.dispose(),a.splice(_,1)):a[_].ownedBy.splice(v,1);break}}}},197:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.is256Color=t.configEquals=t.generateConfig=void 0;let h=n(160);t.generateConfig=function(g,a,l,_,v,u,o){let d={foreground:u.foreground,background:u.background,cursor:h.NULL_COLOR,cursorAccent:h.NULL_COLOR,selectionForeground:h.NULL_COLOR,selectionBackgroundTransparent:h.NULL_COLOR,selectionBackgroundOpaque:h.NULL_COLOR,selectionInactiveBackgroundTransparent:h.NULL_COLOR,selectionInactiveBackgroundOpaque:h.NULL_COLOR,ansi:u.ansi.slice(),contrastCache:u.contrastCache,halfContrastCache:u.halfContrastCache};return{customGlyphs:v.customGlyphs,devicePixelRatio:o,letterSpacing:v.letterSpacing,lineHeight:v.lineHeight,deviceCellWidth:g,deviceCellHeight:a,deviceCharWidth:l,deviceCharHeight:_,fontFamily:v.fontFamily,fontSize:v.fontSize,fontWeight:v.fontWeight,fontWeightBold:v.fontWeightBold,allowTransparency:v.allowTransparency,drawBoldTextInBrightColors:v.drawBoldTextInBrightColors,minimumContrastRatio:v.minimumContrastRatio,colors:d}},t.configEquals=function(g,a){for(let l=0;l<g.colors.ansi.length;l++)if(g.colors.ansi[l].rgba!==a.colors.ansi[l].rgba)return!1;return g.devicePixelRatio===a.devicePixelRatio&&g.customGlyphs===a.customGlyphs&&g.lineHeight===a.lineHeight&&g.letterSpacing===a.letterSpacing&&g.fontFamily===a.fontFamily&&g.fontSize===a.fontSize&&g.fontWeight===a.fontWeight&&g.fontWeightBold===a.fontWeightBold&&g.allowTransparency===a.allowTransparency&&g.deviceCharWidth===a.deviceCharWidth&&g.deviceCharHeight===a.deviceCharHeight&&g.drawBoldTextInBrightColors===a.drawBoldTextInBrightColors&&g.minimumContrastRatio===a.minimumContrastRatio&&g.colors.foreground.rgba===a.colors.foreground.rgba&&g.colors.background.rgba===a.colors.background.rgba},t.is256Color=function(g){return(50331648&g)==16777216||(50331648&g)==33554432}},237:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TEXT_BASELINE=t.DIM_OPACITY=t.INVERTED_DEFAULT_COLOR=void 0;let h=n(399);t.INVERTED_DEFAULT_COLOR=257,t.DIM_OPACITY=.5,t.TEXT_BASELINE=h.isFirefox||h.isLegacyEdge?"bottom":"ideographic"},457:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CursorBlinkStateManager=void 0,t.CursorBlinkStateManager=class{constructor(n,h){this._renderCallback=n,this._coreBrowserService=h,this.isCursorVisible=!0,this._coreBrowserService.isFocused&&this._restartInterval()}get isPaused(){return!(this._blinkStartTimeout||this._blinkInterval)}dispose(){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}restartBlinkAnimation(){this.isPaused||(this._animationTimeRestarted=Date.now(),this.isCursorVisible=!0,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})))}_restartInterval(n=600){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout=this._coreBrowserService.window.setTimeout(()=>{if(this._animationTimeRestarted){let h=600-(Date.now()-this._animationTimeRestarted);if(this._animationTimeRestarted=void 0,h>0)return void this._restartInterval(h)}this.isCursorVisible=!1,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0}),this._blinkInterval=this._coreBrowserService.window.setInterval(()=>{if(this._animationTimeRestarted){let h=600-(Date.now()-this._animationTimeRestarted);return this._animationTimeRestarted=void 0,void this._restartInterval(h)}this.isCursorVisible=!this.isCursorVisible,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})},600)},n)}pause(){this.isCursorVisible=!0,this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}resume(){this.pause(),this._animationTimeRestarted=void 0,this._restartInterval(),this.restartBlinkAnimation()}}},860:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.tryDrawCustomChar=t.powerlineDefinitions=t.boxDrawingDefinitions=t.blockElementDefinitions=void 0;let h=n(374);t.blockElementDefinitions={"\u2580":[{x:0,y:0,w:8,h:4}],"\u2581":[{x:0,y:7,w:8,h:1}],"\u2582":[{x:0,y:6,w:8,h:2}],"\u2583":[{x:0,y:5,w:8,h:3}],"\u2584":[{x:0,y:4,w:8,h:4}],"\u2585":[{x:0,y:3,w:8,h:5}],"\u2586":[{x:0,y:2,w:8,h:6}],"\u2587":[{x:0,y:1,w:8,h:7}],"\u2588":[{x:0,y:0,w:8,h:8}],"\u2589":[{x:0,y:0,w:7,h:8}],"\u258A":[{x:0,y:0,w:6,h:8}],"\u258B":[{x:0,y:0,w:5,h:8}],"\u258C":[{x:0,y:0,w:4,h:8}],"\u258D":[{x:0,y:0,w:3,h:8}],"\u258E":[{x:0,y:0,w:2,h:8}],"\u258F":[{x:0,y:0,w:1,h:8}],"\u2590":[{x:4,y:0,w:4,h:8}],"\u2594":[{x:0,y:0,w:8,h:1}],"\u2595":[{x:7,y:0,w:1,h:8}],"\u2596":[{x:0,y:4,w:4,h:4}],"\u2597":[{x:4,y:4,w:4,h:4}],"\u2598":[{x:0,y:0,w:4,h:4}],"\u2599":[{x:0,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"\u259A":[{x:0,y:0,w:4,h:4},{x:4,y:4,w:4,h:4}],"\u259B":[{x:0,y:0,w:4,h:8},{x:4,y:0,w:4,h:4}],"\u259C":[{x:0,y:0,w:8,h:4},{x:4,y:0,w:4,h:8}],"\u259D":[{x:4,y:0,w:4,h:4}],"\u259E":[{x:4,y:0,w:4,h:4},{x:0,y:4,w:4,h:4}],"\u259F":[{x:4,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"\u{1FB70}":[{x:1,y:0,w:1,h:8}],"\u{1FB71}":[{x:2,y:0,w:1,h:8}],"\u{1FB72}":[{x:3,y:0,w:1,h:8}],"\u{1FB73}":[{x:4,y:0,w:1,h:8}],"\u{1FB74}":[{x:5,y:0,w:1,h:8}],"\u{1FB75}":[{x:6,y:0,w:1,h:8}],"\u{1FB76}":[{x:0,y:1,w:8,h:1}],"\u{1FB77}":[{x:0,y:2,w:8,h:1}],"\u{1FB78}":[{x:0,y:3,w:8,h:1}],"\u{1FB79}":[{x:0,y:4,w:8,h:1}],"\u{1FB7A}":[{x:0,y:5,w:8,h:1}],"\u{1FB7B}":[{x:0,y:6,w:8,h:1}],"\u{1FB7C}":[{x:0,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"\u{1FB7D}":[{x:0,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"\u{1FB7E}":[{x:7,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"\u{1FB7F}":[{x:7,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"\u{1FB80}":[{x:0,y:0,w:8,h:1},{x:0,y:7,w:8,h:1}],"\u{1FB81}":[{x:0,y:0,w:8,h:1},{x:0,y:2,w:8,h:1},{x:0,y:4,w:8,h:1},{x:0,y:7,w:8,h:1}],"\u{1FB82}":[{x:0,y:0,w:8,h:2}],"\u{1FB83}":[{x:0,y:0,w:8,h:3}],"\u{1FB84}":[{x:0,y:0,w:8,h:5}],"\u{1FB85}":[{x:0,y:0,w:8,h:6}],"\u{1FB86}":[{x:0,y:0,w:8,h:7}],"\u{1FB87}":[{x:6,y:0,w:2,h:8}],"\u{1FB88}":[{x:5,y:0,w:3,h:8}],"\u{1FB89}":[{x:3,y:0,w:5,h:8}],"\u{1FB8A}":[{x:2,y:0,w:6,h:8}],"\u{1FB8B}":[{x:1,y:0,w:7,h:8}],"\u{1FB95}":[{x:0,y:0,w:2,h:2},{x:4,y:0,w:2,h:2},{x:2,y:2,w:2,h:2},{x:6,y:2,w:2,h:2},{x:0,y:4,w:2,h:2},{x:4,y:4,w:2,h:2},{x:2,y:6,w:2,h:2},{x:6,y:6,w:2,h:2}],"\u{1FB96}":[{x:2,y:0,w:2,h:2},{x:6,y:0,w:2,h:2},{x:0,y:2,w:2,h:2},{x:4,y:2,w:2,h:2},{x:2,y:4,w:2,h:2},{x:6,y:4,w:2,h:2},{x:0,y:6,w:2,h:2},{x:4,y:6,w:2,h:2}],"\u{1FB97}":[{x:0,y:2,w:8,h:2},{x:0,y:6,w:8,h:2}]};let g={"\u2591":[[1,0,0,0],[0,0,0,0],[0,0,1,0],[0,0,0,0]],"\u2592":[[1,0],[0,0],[0,1],[0,0]],"\u2593":[[0,1],[1,1],[1,0],[1,1]]};t.boxDrawingDefinitions={"\u2500":{1:"M0,.5 L1,.5"},"\u2501":{3:"M0,.5 L1,.5"},"\u2502":{1:"M.5,0 L.5,1"},"\u2503":{3:"M.5,0 L.5,1"},"\u250C":{1:"M0.5,1 L.5,.5 L1,.5"},"\u250F":{3:"M0.5,1 L.5,.5 L1,.5"},"\u2510":{1:"M0,.5 L.5,.5 L.5,1"},"\u2513":{3:"M0,.5 L.5,.5 L.5,1"},"\u2514":{1:"M.5,0 L.5,.5 L1,.5"},"\u2517":{3:"M.5,0 L.5,.5 L1,.5"},"\u2518":{1:"M.5,0 L.5,.5 L0,.5"},"\u251B":{3:"M.5,0 L.5,.5 L0,.5"},"\u251C":{1:"M.5,0 L.5,1 M.5,.5 L1,.5"},"\u2523":{3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"\u2524":{1:"M.5,0 L.5,1 M.5,.5 L0,.5"},"\u252B":{3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"\u252C":{1:"M0,.5 L1,.5 M.5,.5 L.5,1"},"\u2533":{3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"\u2534":{1:"M0,.5 L1,.5 M.5,.5 L.5,0"},"\u253B":{3:"M0,.5 L1,.5 M.5,.5 L.5,0"},"\u253C":{1:"M0,.5 L1,.5 M.5,0 L.5,1"},"\u254B":{3:"M0,.5 L1,.5 M.5,0 L.5,1"},"\u2574":{1:"M.5,.5 L0,.5"},"\u2578":{3:"M.5,.5 L0,.5"},"\u2575":{1:"M.5,.5 L.5,0"},"\u2579":{3:"M.5,.5 L.5,0"},"\u2576":{1:"M.5,.5 L1,.5"},"\u257A":{3:"M.5,.5 L1,.5"},"\u2577":{1:"M.5,.5 L.5,1"},"\u257B":{3:"M.5,.5 L.5,1"},"\u2550":{1:(u,o)=>`M0,${.5-o} L1,${.5-o} M0,${.5+o} L1,${.5+o}`},"\u2551":{1:(u,o)=>`M${.5-u},0 L${.5-u},1 M${.5+u},0 L${.5+u},1`},"\u2552":{1:(u,o)=>`M.5,1 L.5,${.5-o} L1,${.5-o} M.5,${.5+o} L1,${.5+o}`},"\u2553":{1:(u,o)=>`M${.5-u},1 L${.5-u},.5 L1,.5 M${.5+u},.5 L${.5+u},1`},"\u2554":{1:(u,o)=>`M1,${.5-o} L${.5-u},${.5-o} L${.5-u},1 M1,${.5+o} L${.5+u},${.5+o} L${.5+u},1`},"\u2555":{1:(u,o)=>`M0,${.5-o} L.5,${.5-o} L.5,1 M0,${.5+o} L.5,${.5+o}`},"\u2556":{1:(u,o)=>`M${.5+u},1 L${.5+u},.5 L0,.5 M${.5-u},.5 L${.5-u},1`},"\u2557":{1:(u,o)=>`M0,${.5+o} L${.5-u},${.5+o} L${.5-u},1 M0,${.5-o} L${.5+u},${.5-o} L${.5+u},1`},"\u2558":{1:(u,o)=>`M.5,0 L.5,${.5+o} L1,${.5+o} M.5,${.5-o} L1,${.5-o}`},"\u2559":{1:(u,o)=>`M1,.5 L${.5-u},.5 L${.5-u},0 M${.5+u},.5 L${.5+u},0`},"\u255A":{1:(u,o)=>`M1,${.5-o} L${.5+u},${.5-o} L${.5+u},0 M1,${.5+o} L${.5-u},${.5+o} L${.5-u},0`},"\u255B":{1:(u,o)=>`M0,${.5+o} L.5,${.5+o} L.5,0 M0,${.5-o} L.5,${.5-o}`},"\u255C":{1:(u,o)=>`M0,.5 L${.5+u},.5 L${.5+u},0 M${.5-u},.5 L${.5-u},0`},"\u255D":{1:(u,o)=>`M0,${.5-o} L${.5-u},${.5-o} L${.5-u},0 M0,${.5+o} L${.5+u},${.5+o} L${.5+u},0`},"\u255E":{1:(u,o)=>`M.5,0 L.5,1 M.5,${.5-o} L1,${.5-o} M.5,${.5+o} L1,${.5+o}`},"\u255F":{1:(u,o)=>`M${.5-u},0 L${.5-u},1 M${.5+u},0 L${.5+u},1 M${.5+u},.5 L1,.5`},"\u2560":{1:(u,o)=>`M${.5-u},0 L${.5-u},1 M1,${.5+o} L${.5+u},${.5+o} L${.5+u},1 M1,${.5-o} L${.5+u},${.5-o} L${.5+u},0`},"\u2561":{1:(u,o)=>`M.5,0 L.5,1 M0,${.5-o} L.5,${.5-o} M0,${.5+o} L.5,${.5+o}`},"\u2562":{1:(u,o)=>`M0,.5 L${.5-u},.5 M${.5-u},0 L${.5-u},1 M${.5+u},0 L${.5+u},1`},"\u2563":{1:(u,o)=>`M${.5+u},0 L${.5+u},1 M0,${.5+o} L${.5-u},${.5+o} L${.5-u},1 M0,${.5-o} L${.5-u},${.5-o} L${.5-u},0`},"\u2564":{1:(u,o)=>`M0,${.5-o} L1,${.5-o} M0,${.5+o} L1,${.5+o} M.5,${.5+o} L.5,1`},"\u2565":{1:(u,o)=>`M0,.5 L1,.5 M${.5-u},.5 L${.5-u},1 M${.5+u},.5 L${.5+u},1`},"\u2566":{1:(u,o)=>`M0,${.5-o} L1,${.5-o} M0,${.5+o} L${.5-u},${.5+o} L${.5-u},1 M1,${.5+o} L${.5+u},${.5+o} L${.5+u},1`},"\u2567":{1:(u,o)=>`M.5,0 L.5,${.5-o} M0,${.5-o} L1,${.5-o} M0,${.5+o} L1,${.5+o}`},"\u2568":{1:(u,o)=>`M0,.5 L1,.5 M${.5-u},.5 L${.5-u},0 M${.5+u},.5 L${.5+u},0`},"\u2569":{1:(u,o)=>`M0,${.5+o} L1,${.5+o} M0,${.5-o} L${.5-u},${.5-o} L${.5-u},0 M1,${.5-o} L${.5+u},${.5-o} L${.5+u},0`},"\u256A":{1:(u,o)=>`M.5,0 L.5,1 M0,${.5-o} L1,${.5-o} M0,${.5+o} L1,${.5+o}`},"\u256B":{1:(u,o)=>`M0,.5 L1,.5 M${.5-u},0 L${.5-u},1 M${.5+u},0 L${.5+u},1`},"\u256C":{1:(u,o)=>`M0,${.5+o} L${.5-u},${.5+o} L${.5-u},1 M1,${.5+o} L${.5+u},${.5+o} L${.5+u},1 M0,${.5-o} L${.5-u},${.5-o} L${.5-u},0 M1,${.5-o} L${.5+u},${.5-o} L${.5+u},0`},"\u2571":{1:"M1,0 L0,1"},"\u2572":{1:"M0,0 L1,1"},"\u2573":{1:"M1,0 L0,1 M0,0 L1,1"},"\u257C":{1:"M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"\u257D":{1:"M.5,.5 L.5,0",3:"M.5,.5 L.5,1"},"\u257E":{1:"M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u257F":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"\u250D":{1:"M.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"\u250E":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2511":{1:"M.5,.5 L.5,1",3:"M.5,.5 L0,.5"},"\u2512":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"\u2515":{1:"M.5,.5 L.5,0",3:"M.5,.5 L1,.5"},"\u2516":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"\u2519":{1:"M.5,.5 L.5,0",3:"M.5,.5 L0,.5"},"\u251A":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,0"},"\u251D":{1:"M.5,0 L.5,1",3:"M.5,.5 L1,.5"},"\u251E":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"\u251F":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2520":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1"},"\u2521":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"\u2522":{1:"M.5,.5 L.5,0",3:"M0.5,1 L.5,.5 L1,.5"},"\u2525":{1:"M.5,0 L.5,1",3:"M.5,.5 L0,.5"},"\u2526":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"\u2527":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"\u2528":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1"},"\u2529":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L0,.5"},"\u252A":{1:"M.5,.5 L.5,0",3:"M0,.5 L.5,.5 L.5,1"},"\u252D":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u252E":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"\u252F":{1:"M.5,.5 L.5,1",3:"M0,.5 L1,.5"},"\u2530":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2531":{1:"M.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"\u2532":{1:"M.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"\u2535":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u2536":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"\u2537":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5"},"\u2538":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,0"},"\u2539":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"\u253A":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,.5 L1,.5"},"\u253D":{1:"M.5,0 L.5,1 M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u253E":{1:"M.5,0 L.5,1 M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"\u253F":{1:"M.5,0 L.5,1",3:"M0,.5 L1,.5"},"\u2540":{1:"M0,.5 L1,.5 M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"\u2541":{1:"M.5,.5 L.5,0 M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2542":{1:"M0,.5 L1,.5",3:"M.5,0 L.5,1"},"\u2543":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"\u2544":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"\u2545":{1:"M.5,0 L.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"\u2546":{1:"M.5,0 L.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"\u2547":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0 M0,.5 L1,.5"},"\u2548":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"\u2549":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"\u254A":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"\u254C":{1:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"\u254D":{3:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"\u2504":{1:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"\u2505":{3:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"\u2508":{1:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"\u2509":{3:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"\u254E":{1:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"\u254F":{3:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"\u2506":{1:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"\u2507":{3:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"\u250A":{1:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"\u250B":{3:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"\u256D":{1:(u,o)=>`M.5,1 L.5,${.5+o/.15*.5} C.5,${.5+o/.15*.5},.5,.5,1,.5`},"\u256E":{1:(u,o)=>`M.5,1 L.5,${.5+o/.15*.5} C.5,${.5+o/.15*.5},.5,.5,0,.5`},"\u256F":{1:(u,o)=>`M.5,0 L.5,${.5-o/.15*.5} C.5,${.5-o/.15*.5},.5,.5,0,.5`},"\u2570":{1:(u,o)=>`M.5,0 L.5,${.5-o/.15*.5} C.5,${.5-o/.15*.5},.5,.5,1,.5`}},t.powerlineDefinitions={"\uE0B0":{d:"M0,0 L1,.5 L0,1",type:0,rightPadding:2},"\uE0B1":{d:"M-1,-.5 L1,.5 L-1,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0B2":{d:"M1,0 L0,.5 L1,1",type:0,leftPadding:2},"\uE0B3":{d:"M2,-.5 L0,.5 L2,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0B4":{d:"M0,0 L0,1 C0.552,1,1,0.776,1,.5 C1,0.224,0.552,0,0,0",type:0,rightPadding:1},"\uE0B5":{d:"M.2,1 C.422,1,.8,.826,.78,.5 C.8,.174,0.422,0,.2,0",type:1,rightPadding:1},"\uE0B6":{d:"M1,0 L1,1 C0.448,1,0,0.776,0,.5 C0,0.224,0.448,0,1,0",type:0,leftPadding:1},"\uE0B7":{d:"M.8,1 C0.578,1,0.2,.826,.22,.5 C0.2,0.174,0.578,0,0.8,0",type:1,leftPadding:1},"\uE0B8":{d:"M-.5,-.5 L1.5,1.5 L-.5,1.5",type:0},"\uE0B9":{d:"M-.5,-.5 L1.5,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0BA":{d:"M1.5,-.5 L-.5,1.5 L1.5,1.5",type:0},"\uE0BC":{d:"M1.5,-.5 L-.5,1.5 L-.5,-.5",type:0},"\uE0BD":{d:"M1.5,-.5 L-.5,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0BE":{d:"M-.5,-.5 L1.5,1.5 L1.5,-.5",type:0}},t.powerlineDefinitions["\uE0BB"]=t.powerlineDefinitions["\uE0BD"],t.powerlineDefinitions["\uE0BF"]=t.powerlineDefinitions["\uE0B9"],t.tryDrawCustomChar=function(u,o,d,f,p,y,w,b){let S=t.blockElementDefinitions[o];if(S)return function(L,B,R,F,K,Q){for(let N=0;N<B.length;N++){let k=B[N],m=K/8,x=Q/8;L.fillRect(R+k.x*m,F+k.y*x,k.w*m,k.h*x)}}(u,S,d,f,p,y),!0;let A=g[o];if(A)return function(L,B,R,F,K,Q){let N=a.get(B);N||(N=new Map,a.set(B,N));let k=L.fillStyle;if(typeof k!="string")throw new Error(`Unexpected fillStyle type "${k}"`);let m=N.get(k);if(!m){let x=B[0].length,E=B.length,I=L.canvas.ownerDocument.createElement("canvas");I.width=x,I.height=E;let M=(0,h.throwIfFalsy)(I.getContext("2d")),X=new ImageData(x,E),$,W,P,T;if(k.startsWith("#"))$=parseInt(k.slice(1,3),16),W=parseInt(k.slice(3,5),16),P=parseInt(k.slice(5,7),16),T=k.length>7&&parseInt(k.slice(7,9),16)||1;else{if(!k.startsWith("rgba"))throw new Error(`Unexpected fillStyle color format "${k}" when drawing pattern glyph`);[$,W,P,T]=k.substring(5,k.length-1).split(",").map(U=>parseFloat(U))}for(let U=0;U<E;U++)for(let Z=0;Z<x;Z++)X.data[4*(U*x+Z)]=$,X.data[4*(U*x+Z)+1]=W,X.data[4*(U*x+Z)+2]=P,X.data[4*(U*x+Z)+3]=B[U][Z]*(255*T);M.putImageData(X,0,0),m=(0,h.throwIfFalsy)(L.createPattern(I,null)),N.set(k,m)}L.fillStyle=m,L.fillRect(R,F,K,Q)}(u,A,d,f,p,y),!0;let C=t.boxDrawingDefinitions[o];if(C)return function(L,B,R,F,K,Q,N){L.strokeStyle=L.fillStyle;for(let[k,m]of Object.entries(B)){let x;L.beginPath(),L.lineWidth=N*Number.parseInt(k),x=typeof m=="function"?m(.15,.15/Q*K):m;for(let E of x.split(" ")){let I=E[0],M=_[I];if(!M){console.error(`Could not find drawing instructions for "${I}"`);continue}let X=E.substring(1).split(",");X[0]&&X[1]&&M(L,v(X,K,Q,R,F,!0,N))}L.stroke(),L.closePath()}}(u,C,d,f,p,y,b),!0;let D=t.powerlineDefinitions[o];return!!D&&(function(L,B,R,F,K,Q,N,k){let m=new Path2D;m.rect(R,F,K,Q),L.clip(m),L.beginPath();let x=N/12;L.lineWidth=k*x;for(let E of B.d.split(" ")){let I=E[0],M=_[I];if(!M){console.error(`Could not find drawing instructions for "${I}"`);continue}let X=E.substring(1).split(",");X[0]&&X[1]&&M(L,v(X,K,Q,R,F,!1,k,(B.leftPadding??0)*(x/2),(B.rightPadding??0)*(x/2)))}B.type===1?(L.strokeStyle=L.fillStyle,L.stroke()):L.fill(),L.closePath()}(u,D,d,f,p,y,w,b),!0)};let a=new Map;function l(u,o,d=0){return Math.max(Math.min(u,o),d)}let _={C:(u,o)=>u.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5]),L:(u,o)=>u.lineTo(o[0],o[1]),M:(u,o)=>u.moveTo(o[0],o[1])};function v(u,o,d,f,p,y,w,b=0,S=0){let A=u.map(C=>parseFloat(C)||parseInt(C));if(A.length<2)throw new Error("Too few arguments for instruction");for(let C=0;C<A.length;C+=2)A[C]*=o-b*w-S*w,y&&A[C]!==0&&(A[C]=l(Math.round(A[C]+.5)-.5,o,0)),A[C]+=f+b*w;for(let C=1;C<A.length;C+=2)A[C]*=d,y&&A[C]!==0&&(A[C]=l(Math.round(A[C]+.5)-.5,d,0)),A[C]+=p;return A}},56:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.observeDevicePixelDimensions=void 0;let h=n(859);t.observeDevicePixelDimensions=function(g,a,l){let _=new a.ResizeObserver(v=>{let u=v.find(f=>f.target===g);if(!u)return;if(!("devicePixelContentBoxSize"in u))return _?.disconnect(),void(_=void 0);let o=u.devicePixelContentBoxSize[0].inlineSize,d=u.devicePixelContentBoxSize[0].blockSize;o>0&&d>0&&l(o,d)});try{_.observe(g,{box:["device-pixel-content-box"]})}catch{_.disconnect(),_=void 0}return(0,h.toDisposable)(()=>_?.disconnect())}},374:(c,t)=>{function n(h){return 57508<=h&&h<=57558}Object.defineProperty(t,"__esModule",{value:!0}),t.createRenderDimensions=t.excludeFromContrastRatioDemands=t.isRestrictedPowerlineGlyph=t.isPowerlineGlyph=t.throwIfFalsy=void 0,t.throwIfFalsy=function(h){if(!h)throw new Error("value must not be falsy");return h},t.isPowerlineGlyph=n,t.isRestrictedPowerlineGlyph=function(h){return 57520<=h&&h<=57527},t.excludeFromContrastRatioDemands=function(h){return n(h)||function(g){return 9472<=g&&g<=9631}(h)},t.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}}},296:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createSelectionRenderModel=void 0;class n{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(g,a,l,_=!1){if(this.selectionStart=a,this.selectionEnd=l,!a||!l||a[0]===l[0]&&a[1]===l[1])return void this.clear();let v=a[1]-g.buffer.active.viewportY,u=l[1]-g.buffer.active.viewportY,o=Math.max(v,0),d=Math.min(u,g.rows-1);o>=g.rows||d<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=_,this.viewportStartRow=v,this.viewportEndRow=u,this.viewportCappedStartRow=o,this.viewportCappedEndRow=d,this.startCol=a[0],this.endCol=l[0])}isCellSelected(g,a,l){return!!this.hasSelection&&(l-=g.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?a>=this.startCol&&l>=this.viewportCappedStartRow&&a<this.endCol&&l<=this.viewportCappedEndRow:a<this.startCol&&l>=this.viewportCappedStartRow&&a>=this.endCol&&l<=this.viewportCappedEndRow:l>this.viewportStartRow&&l<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&l===this.viewportStartRow&&a>=this.startCol&&a<this.endCol||this.viewportStartRow<this.viewportEndRow&&l===this.viewportEndRow&&a<this.endCol||this.viewportStartRow<this.viewportEndRow&&l===this.viewportStartRow&&a>=this.startCol)}}t.createSelectionRenderModel=function(){return new n}},509:function(c,t,n){var h=this&&this.__decorate||function(D,L,B,R){var F,K=arguments.length,Q=K<3?L:R===null?R=Object.getOwnPropertyDescriptor(L,B):R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Q=Reflect.decorate(D,L,B,R);else for(var N=D.length-1;N>=0;N--)(F=D[N])&&(Q=(K<3?F(Q):K>3?F(L,B,Q):F(L,B))||Q);return K>3&&Q&&Object.defineProperty(L,B,Q),Q};Object.defineProperty(t,"__esModule",{value:!0}),t.TextureAtlas=void 0;let g=n(237),a=n(860),l=n(374),_=n(160),v=n(345),u=n(485),o=n(385),d=n(147),f=n(855),p=n(776),y={texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},offset:{x:0,y:0},size:{x:0,y:0},sizeClipSpace:{x:0,y:0}},w;class b{get pages(){return this._pages}constructor(L,B,R){this._document=L,this._config=B,this._unicodeService=R,this._didWarmUp=!1,this._cacheMap=new u.FourKeyMap,this._cacheMapCombined=new u.FourKeyMap,this._pages=[],this._activePages=[],this._workBoundingBox={top:0,left:0,bottom:0,right:0},this._workAttributeData=new d.AttributeData,this._textureSize=512,this._onAddTextureAtlasCanvas=new v.EventEmitter,this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=new v.EventEmitter,this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._requestClearModel=!1,this._createNewPage(),this._tmpCanvas=C(L,4*this._config.deviceCellWidth+4,this._config.deviceCellHeight+4),this._tmpCtx=(0,l.throwIfFalsy)(this._tmpCanvas.getContext("2d",{alpha:this._config.allowTransparency,willReadFrequently:!0}))}dispose(){for(let L of this.pages)L.canvas.remove();this._onAddTextureAtlasCanvas.dispose()}warmUp(){this._didWarmUp||(this._doWarmUp(),this._didWarmUp=!0)}_doWarmUp(){let L=new o.IdleTaskQueue;for(let B=33;B<126;B++)L.enqueue(()=>{if(!this._cacheMap.get(B,f.DEFAULT_COLOR,f.DEFAULT_COLOR,f.DEFAULT_EXT)){let R=this._drawToCache(B,f.DEFAULT_COLOR,f.DEFAULT_COLOR,f.DEFAULT_EXT);this._cacheMap.set(B,f.DEFAULT_COLOR,f.DEFAULT_COLOR,f.DEFAULT_EXT,R)}})}beginFrame(){return this._requestClearModel}clearTexture(){if(this._pages[0].currentRow.x!==0||this._pages[0].currentRow.y!==0){for(let L of this._pages)L.clear();this._cacheMap.clear(),this._cacheMapCombined.clear(),this._didWarmUp=!1}}_createNewPage(){if(b.maxAtlasPages&&this._pages.length>=Math.max(4,b.maxAtlasPages)){let B=this._pages.filter(m=>2*m.canvas.width<=(b.maxTextureSize||4096)).sort((m,x)=>x.canvas.width!==m.canvas.width?x.canvas.width-m.canvas.width:x.percentageUsed-m.percentageUsed),R=-1,F=0;for(let m=0;m<B.length;m++)if(B[m].canvas.width!==F)R=m,F=B[m].canvas.width;else if(m-R==3)break;let K=B.slice(R,R+4),Q=K.map(m=>m.glyphs[0].texturePage).sort((m,x)=>m>x?1:-1),N=this.pages.length-K.length,k=this._mergePages(K,N);k.version++;for(let m=Q.length-1;m>=0;m--)this._deletePage(Q[m]);this.pages.push(k),this._requestClearModel=!0,this._onAddTextureAtlasCanvas.fire(k.canvas)}let L=new S(this._document,this._textureSize);return this._pages.push(L),this._activePages.push(L),this._onAddTextureAtlasCanvas.fire(L.canvas),L}_mergePages(L,B){let R=2*L[0].canvas.width,F=new S(this._document,R,L);for(let[K,Q]of L.entries()){let N=K*Q.canvas.width%R,k=Math.floor(K/2)*Q.canvas.height;F.ctx.drawImage(Q.canvas,N,k);for(let x of Q.glyphs)x.texturePage=B,x.sizeClipSpace.x=x.size.x/R,x.sizeClipSpace.y=x.size.y/R,x.texturePosition.x+=N,x.texturePosition.y+=k,x.texturePositionClipSpace.x=x.texturePosition.x/R,x.texturePositionClipSpace.y=x.texturePosition.y/R;this._onRemoveTextureAtlasCanvas.fire(Q.canvas);let m=this._activePages.indexOf(Q);m!==-1&&this._activePages.splice(m,1)}return F}_deletePage(L){this._pages.splice(L,1);for(let B=L;B<this._pages.length;B++){let R=this._pages[B];for(let F of R.glyphs)F.texturePage--;R.version++}}getRasterizedGlyphCombinedChar(L,B,R,F,K){return this._getFromCacheMap(this._cacheMapCombined,L,B,R,F,K)}getRasterizedGlyph(L,B,R,F,K){return this._getFromCacheMap(this._cacheMap,L,B,R,F,K)}_getFromCacheMap(L,B,R,F,K,Q=!1){return w=L.get(B,R,F,K),w||(w=this._drawToCache(B,R,F,K,Q),L.set(B,R,F,K,w)),w}_getColorFromAnsiIndex(L){if(L>=this._config.colors.ansi.length)throw new Error("No color found for idx "+L);return this._config.colors.ansi[L]}_getBackgroundColor(L,B,R,F){if(this._config.allowTransparency)return _.NULL_COLOR;let K;switch(L){case 16777216:case 33554432:K=this._getColorFromAnsiIndex(B);break;case 50331648:let Q=d.AttributeData.toColorRGB(B);K=_.rgba.toColor(Q[0],Q[1],Q[2]);break;default:K=R?_.color.opaque(this._config.colors.foreground):this._config.colors.background}return K}_getForegroundColor(L,B,R,F,K,Q,N,k,m,x){let E=this._getMinimumContrastColor(L,B,R,F,K,Q,N,m,k,x);if(E)return E;let I;switch(K){case 16777216:case 33554432:this._config.drawBoldTextInBrightColors&&m&&Q<8&&(Q+=8),I=this._getColorFromAnsiIndex(Q);break;case 50331648:let M=d.AttributeData.toColorRGB(Q);I=_.rgba.toColor(M[0],M[1],M[2]);break;default:I=N?this._config.colors.background:this._config.colors.foreground}return this._config.allowTransparency&&(I=_.color.opaque(I)),k&&(I=_.color.multiplyOpacity(I,g.DIM_OPACITY)),I}_resolveBackgroundRgba(L,B,R){switch(L){case 16777216:case 33554432:return this._getColorFromAnsiIndex(B).rgba;case 50331648:return B<<8;default:return R?this._config.colors.foreground.rgba:this._config.colors.background.rgba}}_resolveForegroundRgba(L,B,R,F){switch(L){case 16777216:case 33554432:return this._config.drawBoldTextInBrightColors&&F&&B<8&&(B+=8),this._getColorFromAnsiIndex(B).rgba;case 50331648:return B<<8;default:return R?this._config.colors.background.rgba:this._config.colors.foreground.rgba}}_getMinimumContrastColor(L,B,R,F,K,Q,N,k,m,x){if(this._config.minimumContrastRatio===1||x)return;let E=this._getContrastCache(m),I=E.getColor(L,F);if(I!==void 0)return I||void 0;let M=this._resolveBackgroundRgba(B,R,N),X=this._resolveForegroundRgba(K,Q,N,k),$=_.rgba.ensureContrastRatio(M,X,this._config.minimumContrastRatio/(m?2:1));if(!$)return void E.setColor(L,F,null);let W=_.rgba.toColor($>>24&255,$>>16&255,$>>8&255);return E.setColor(L,F,W),W}_getContrastCache(L){return L?this._config.colors.halfContrastCache:this._config.colors.contrastCache}_drawToCache(L,B,R,F,K=!1){let Q=typeof L=="number"?String.fromCharCode(L):L,N=Math.min(this._config.deviceCellWidth*Math.max(Q.length,2)+4,this._textureSize);this._tmpCanvas.width<N&&(this._tmpCanvas.width=N);let k=Math.min(this._config.deviceCellHeight+8,this._textureSize);if(this._tmpCanvas.height<k&&(this._tmpCanvas.height=k),this._tmpCtx.save(),this._workAttributeData.fg=R,this._workAttributeData.bg=B,this._workAttributeData.extended.ext=F,this._workAttributeData.isInvisible())return y;let m=!!this._workAttributeData.isBold(),x=!!this._workAttributeData.isInverse(),E=!!this._workAttributeData.isDim(),I=!!this._workAttributeData.isItalic(),M=!!this._workAttributeData.isUnderline(),X=!!this._workAttributeData.isStrikethrough(),$=!!this._workAttributeData.isOverline(),W=this._workAttributeData.getFgColor(),P=this._workAttributeData.getFgColorMode(),T=this._workAttributeData.getBgColor(),U=this._workAttributeData.getBgColorMode();if(x){let se=W;W=T,T=se;let pe=P;P=U,U=pe}let Z=this._getBackgroundColor(U,T,x,E);this._tmpCtx.globalCompositeOperation="copy",this._tmpCtx.fillStyle=Z.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.globalCompositeOperation="source-over";let te=m?this._config.fontWeightBold:this._config.fontWeight,ee=I?"italic":"";this._tmpCtx.font=`${ee} ${te} ${this._config.fontSize*this._config.devicePixelRatio}px ${this._config.fontFamily}`,this._tmpCtx.textBaseline=g.TEXT_BASELINE;let le=Q.length===1&&(0,l.isPowerlineGlyph)(Q.charCodeAt(0)),be=Q.length===1&&(0,l.isRestrictedPowerlineGlyph)(Q.charCodeAt(0)),ye=this._getForegroundColor(B,U,T,R,P,W,x,E,m,(0,l.excludeFromContrastRatioDemands)(Q.charCodeAt(0)));this._tmpCtx.fillStyle=ye.css;let he=be?0:4,ne=!1;this._config.customGlyphs!==!1&&(ne=(0,a.tryDrawCustomChar)(this._tmpCtx,Q,he,he,this._config.deviceCellWidth,this._config.deviceCellHeight,this._config.fontSize,this._config.devicePixelRatio));let tt,vt=!le;if(tt=typeof L=="number"?this._unicodeService.wcwidth(L):this._unicodeService.getStringCellWidth(L),M){this._tmpCtx.save();let se=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),pe=se%2==1?.5:0;if(this._tmpCtx.lineWidth=se,this._workAttributeData.isUnderlineColorDefault())this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle;else if(this._workAttributeData.isUnderlineColorRGB())vt=!1,this._tmpCtx.strokeStyle=`rgb(${d.AttributeData.toColorRGB(this._workAttributeData.getUnderlineColor()).join(",")})`;else{vt=!1;let Me=this._workAttributeData.getUnderlineColor();this._config.drawBoldTextInBrightColors&&this._workAttributeData.isBold()&&Me<8&&(Me+=8),this._tmpCtx.strokeStyle=this._getColorFromAnsiIndex(Me).css}this._tmpCtx.beginPath();let Xe=he,Ce=Math.ceil(he+this._config.deviceCharHeight)-pe-(K?2*se:0),ot=Ce+se,$e=Ce+2*se;for(let Me=0;Me<tt;Me++){this._tmpCtx.save();let ce=Xe+Me*this._config.deviceCellWidth,qe=Xe+(Me+1)*this._config.deviceCellWidth,Ls=ce+this._config.deviceCellWidth/2;switch(this._workAttributeData.extended.underlineStyle){case 2:this._tmpCtx.moveTo(ce,Ce),this._tmpCtx.lineTo(qe,Ce),this._tmpCtx.moveTo(ce,$e),this._tmpCtx.lineTo(qe,$e);break;case 3:let ur=se<=1?$e:Math.ceil(he+this._config.deviceCharHeight-se/2)-pe,dr=se<=1?Ce:Math.ceil(he+this._config.deviceCharHeight+se/2)-pe,xo=new Path2D;xo.rect(ce,Ce,this._config.deviceCellWidth,$e-Ce),this._tmpCtx.clip(xo),this._tmpCtx.moveTo(ce-this._config.deviceCellWidth/2,ot),this._tmpCtx.bezierCurveTo(ce-this._config.deviceCellWidth/2,dr,ce,dr,ce,ot),this._tmpCtx.bezierCurveTo(ce,ur,Ls,ur,Ls,ot),this._tmpCtx.bezierCurveTo(Ls,dr,qe,dr,qe,ot),this._tmpCtx.bezierCurveTo(qe,ur,qe+this._config.deviceCellWidth/2,ur,qe+this._config.deviceCellWidth/2,ot);break;case 4:this._tmpCtx.setLineDash([Math.round(se),Math.round(se)]),this._tmpCtx.moveTo(ce,Ce),this._tmpCtx.lineTo(qe,Ce);break;case 5:this._tmpCtx.setLineDash([4*this._config.devicePixelRatio,3*this._config.devicePixelRatio]),this._tmpCtx.moveTo(ce,Ce),this._tmpCtx.lineTo(qe,Ce);break;default:this._tmpCtx.moveTo(ce,Ce),this._tmpCtx.lineTo(qe,Ce)}this._tmpCtx.stroke(),this._tmpCtx.restore()}if(this._tmpCtx.restore(),!ne&&this._config.fontSize>=12&&!this._config.allowTransparency&&Q!==" "){this._tmpCtx.save(),this._tmpCtx.textBaseline="alphabetic";let Me=this._tmpCtx.measureText(Q);if(this._tmpCtx.restore(),"actualBoundingBoxDescent"in Me&&Me.actualBoundingBoxDescent>0){this._tmpCtx.save();let ce=new Path2D;ce.rect(Xe,Ce-Math.ceil(se/2),this._config.deviceCellWidth*tt,$e-Ce+Math.ceil(se/2)),this._tmpCtx.clip(ce),this._tmpCtx.lineWidth=3*this._config.devicePixelRatio,this._tmpCtx.strokeStyle=Z.css,this._tmpCtx.strokeText(Q,he,he+this._config.deviceCharHeight),this._tmpCtx.restore()}}}if($){let se=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),pe=se%2==1?.5:0;this._tmpCtx.lineWidth=se,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(he,he+pe),this._tmpCtx.lineTo(he+this._config.deviceCharWidth*tt,he+pe),this._tmpCtx.stroke()}if(ne||this._tmpCtx.fillText(Q,he,he+this._config.deviceCharHeight),Q==="_"&&!this._config.allowTransparency){let se=A(this._tmpCtx.getImageData(he,he,this._config.deviceCellWidth,this._config.deviceCellHeight),Z,ye,vt);if(se)for(let pe=1;pe<=5&&(this._tmpCtx.save(),this._tmpCtx.fillStyle=Z.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.restore(),this._tmpCtx.fillText(Q,he,he+this._config.deviceCharHeight-pe),se=A(this._tmpCtx.getImageData(he,he,this._config.deviceCellWidth,this._config.deviceCellHeight),Z,ye,vt),se);pe++);}if(X){let se=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/10)),pe=this._tmpCtx.lineWidth%2==1?.5:0;this._tmpCtx.lineWidth=se,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(he,he+Math.floor(this._config.deviceCharHeight/2)-pe),this._tmpCtx.lineTo(he+this._config.deviceCharWidth*tt,he+Math.floor(this._config.deviceCharHeight/2)-pe),this._tmpCtx.stroke()}this._tmpCtx.restore();let St=this._tmpCtx.getImageData(0,0,this._tmpCanvas.width,this._tmpCanvas.height),ti;if(ti=this._config.allowTransparency?function(se){for(let pe=0;pe<se.data.length;pe+=4)if(se.data[pe+3]>0)return!1;return!0}(St):A(St,Z,ye,vt),ti)return y;let ge=this._findGlyphBoundingBox(St,this._workBoundingBox,N,be,ne,he),ae,de;for(;;){if(this._activePages.length===0){let se=this._createNewPage();ae=se,de=se.currentRow,de.height=ge.size.y;break}ae=this._activePages[this._activePages.length-1],de=ae.currentRow;for(let se of this._activePages)ge.size.y<=se.currentRow.height&&(ae=se,de=se.currentRow);for(let se=this._activePages.length-1;se>=0;se--)for(let pe of this._activePages[se].fixedRows)pe.height<=de.height&&ge.size.y<=pe.height&&(ae=this._activePages[se],de=pe);if(de.y+ge.size.y>=ae.canvas.height||de.height>ge.size.y+2){let se=!1;if(ae.currentRow.y+ae.currentRow.height+ge.size.y>=ae.canvas.height){let pe;for(let Xe of this._activePages)if(Xe.currentRow.y+Xe.currentRow.height+ge.size.y<Xe.canvas.height){pe=Xe;break}if(pe)ae=pe;else if(b.maxAtlasPages&&this._pages.length>=b.maxAtlasPages&&de.y+ge.size.y<=ae.canvas.height&&de.height>=ge.size.y&&de.x+ge.size.x<=ae.canvas.width)se=!0;else{let Xe=this._createNewPage();ae=Xe,de=Xe.currentRow,de.height=ge.size.y,se=!0}}se||(ae.currentRow.height>0&&ae.fixedRows.push(ae.currentRow),de={x:0,y:ae.currentRow.y+ae.currentRow.height,height:ge.size.y},ae.fixedRows.push(de),ae.currentRow={x:0,y:de.y+de.height,height:0})}if(de.x+ge.size.x<=ae.canvas.width)break;de===ae.currentRow?(de.x=0,de.y+=de.height,de.height=0):ae.fixedRows.splice(ae.fixedRows.indexOf(de),1)}return ge.texturePage=this._pages.indexOf(ae),ge.texturePosition.x=de.x,ge.texturePosition.y=de.y,ge.texturePositionClipSpace.x=de.x/ae.canvas.width,ge.texturePositionClipSpace.y=de.y/ae.canvas.height,ge.sizeClipSpace.x/=ae.canvas.width,ge.sizeClipSpace.y/=ae.canvas.height,de.height=Math.max(de.height,ge.size.y),de.x+=ge.size.x,ae.ctx.putImageData(St,ge.texturePosition.x-this._workBoundingBox.left,ge.texturePosition.y-this._workBoundingBox.top,this._workBoundingBox.left,this._workBoundingBox.top,ge.size.x,ge.size.y),ae.addGlyph(ge),ae.version++,ge}_findGlyphBoundingBox(L,B,R,F,K,Q){B.top=0;let N=F?this._config.deviceCellHeight:this._tmpCanvas.height,k=F?this._config.deviceCellWidth:R,m=!1;for(let x=0;x<N;x++){for(let E=0;E<k;E++){let I=x*this._tmpCanvas.width*4+4*E+3;if(L.data[I]!==0){B.top=x,m=!0;break}}if(m)break}B.left=0,m=!1;for(let x=0;x<Q+k;x++){for(let E=0;E<N;E++){let I=E*this._tmpCanvas.width*4+4*x+3;if(L.data[I]!==0){B.left=x,m=!0;break}}if(m)break}B.right=k,m=!1;for(let x=Q+k-1;x>=Q;x--){for(let E=0;E<N;E++){let I=E*this._tmpCanvas.width*4+4*x+3;if(L.data[I]!==0){B.right=x,m=!0;break}}if(m)break}B.bottom=N,m=!1;for(let x=N-1;x>=0;x--){for(let E=0;E<k;E++){let I=x*this._tmpCanvas.width*4+4*E+3;if(L.data[I]!==0){B.bottom=x,m=!0;break}}if(m)break}return{texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},size:{x:B.right-B.left+1,y:B.bottom-B.top+1},sizeClipSpace:{x:B.right-B.left+1,y:B.bottom-B.top+1},offset:{x:-B.left+Q+(F||K?Math.floor((this._config.deviceCellWidth-this._config.deviceCharWidth)/2):0),y:-B.top+Q+(F||K?this._config.lineHeight===1?0:Math.round((this._config.deviceCellHeight-this._config.deviceCharHeight)/2):0)}}}}t.TextureAtlas=b,h([p.traceCall],b.prototype,"_drawToCache",null);class S{get percentageUsed(){return this._usedPixels/(this.canvas.width*this.canvas.height)}get glyphs(){return this._glyphs}addGlyph(L){this._glyphs.push(L),this._usedPixels+=L.size.x*L.size.y}constructor(L,B,R){if(this._usedPixels=0,this._glyphs=[],this.version=0,this.currentRow={x:0,y:0,height:0},this.fixedRows=[],R)for(let F of R)this._glyphs.push(...F.glyphs),this._usedPixels+=F._usedPixels;this.canvas=C(L,B,B),this.ctx=(0,l.throwIfFalsy)(this.canvas.getContext("2d",{alpha:!0}))}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.currentRow.x=0,this.currentRow.y=0,this.currentRow.height=0,this.fixedRows.length=0,this.version++}}function A(D,L,B,R){let F=L.rgba>>>24,K=L.rgba>>>16&255,Q=L.rgba>>>8&255,N=B.rgba>>>24,k=B.rgba>>>16&255,m=B.rgba>>>8&255,x=Math.floor((Math.abs(F-N)+Math.abs(K-k)+Math.abs(Q-m))/12),E=!0;for(let I=0;I<D.data.length;I+=4)D.data[I]===F&&D.data[I+1]===K&&D.data[I+2]===Q||R&&Math.abs(D.data[I]-F)+Math.abs(D.data[I+1]-K)+Math.abs(D.data[I+2]-Q)<x?D.data[I+3]=0:E=!1;return E}function C(D,L,B){let R=D.createElement("canvas");return R.width=L,R.height=B,R}},160:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.contrastRatio=t.toPaddedHex=t.rgba=t.rgb=t.css=t.color=t.channels=t.NULL_COLOR=void 0;let h=n(399),g=0,a=0,l=0,_=0;var v,u,o,d,f;function p(w){let b=w.toString(16);return b.length<2?"0"+b:b}function y(w,b){return w<b?(b+.05)/(w+.05):(w+.05)/(b+.05)}t.NULL_COLOR={css:"#00000000",rgba:0},function(w){w.toCss=function(b,S,A,C){return C!==void 0?`#${p(b)}${p(S)}${p(A)}${p(C)}`:`#${p(b)}${p(S)}${p(A)}`},w.toRgba=function(b,S,A,C=255){return(b<<24|S<<16|A<<8|C)>>>0}}(v||(t.channels=v={})),function(w){function b(S,A){return _=Math.round(255*A),[g,a,l]=f.toChannels(S.rgba),{css:v.toCss(g,a,l,_),rgba:v.toRgba(g,a,l,_)}}w.blend=function(S,A){if(_=(255&A.rgba)/255,_===1)return{css:A.css,rgba:A.rgba};let C=A.rgba>>24&255,D=A.rgba>>16&255,L=A.rgba>>8&255,B=S.rgba>>24&255,R=S.rgba>>16&255,F=S.rgba>>8&255;return g=B+Math.round((C-B)*_),a=R+Math.round((D-R)*_),l=F+Math.round((L-F)*_),{css:v.toCss(g,a,l),rgba:v.toRgba(g,a,l)}},w.isOpaque=function(S){return(255&S.rgba)==255},w.ensureContrastRatio=function(S,A,C){let D=f.ensureContrastRatio(S.rgba,A.rgba,C);if(D)return f.toColor(D>>24&255,D>>16&255,D>>8&255)},w.opaque=function(S){let A=(255|S.rgba)>>>0;return[g,a,l]=f.toChannels(A),{css:v.toCss(g,a,l),rgba:A}},w.opacity=b,w.multiplyOpacity=function(S,A){return _=255&S.rgba,b(S,_*A/255)},w.toColorRGB=function(S){return[S.rgba>>24&255,S.rgba>>16&255,S.rgba>>8&255]}}(u||(t.color=u={})),function(w){let b,S;if(!h.isNode){let A=document.createElement("canvas");A.width=1,A.height=1;let C=A.getContext("2d",{willReadFrequently:!0});C&&(b=C,b.globalCompositeOperation="copy",S=b.createLinearGradient(0,0,1,1))}w.toColor=function(A){if(A.match(/#[\da-f]{3,8}/i))switch(A.length){case 4:return g=parseInt(A.slice(1,2).repeat(2),16),a=parseInt(A.slice(2,3).repeat(2),16),l=parseInt(A.slice(3,4).repeat(2),16),f.toColor(g,a,l);case 5:return g=parseInt(A.slice(1,2).repeat(2),16),a=parseInt(A.slice(2,3).repeat(2),16),l=parseInt(A.slice(3,4).repeat(2),16),_=parseInt(A.slice(4,5).repeat(2),16),f.toColor(g,a,l,_);case 7:return{css:A,rgba:(parseInt(A.slice(1),16)<<8|255)>>>0};case 9:return{css:A,rgba:parseInt(A.slice(1),16)>>>0}}let C=A.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(C)return g=parseInt(C[1]),a=parseInt(C[2]),l=parseInt(C[3]),_=Math.round(255*(C[5]===void 0?1:parseFloat(C[5]))),f.toColor(g,a,l,_);if(!b||!S)throw new Error("css.toColor: Unsupported css format");if(b.fillStyle=S,b.fillStyle=A,typeof b.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(b.fillRect(0,0,1,1),[g,a,l,_]=b.getImageData(0,0,1,1).data,_!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:v.toRgba(g,a,l,_),css:A}}}(o||(t.css=o={})),function(w){function b(S,A,C){let D=S/255,L=A/255,B=C/255;return .2126*(D<=.03928?D/12.92:Math.pow((D+.055)/1.055,2.4))+.7152*(L<=.03928?L/12.92:Math.pow((L+.055)/1.055,2.4))+.0722*(B<=.03928?B/12.92:Math.pow((B+.055)/1.055,2.4))}w.relativeLuminance=function(S){return b(S>>16&255,S>>8&255,255&S)},w.relativeLuminance2=b}(d||(t.rgb=d={})),function(w){function b(A,C,D){let L=A>>24&255,B=A>>16&255,R=A>>8&255,F=C>>24&255,K=C>>16&255,Q=C>>8&255,N=y(d.relativeLuminance2(F,K,Q),d.relativeLuminance2(L,B,R));for(;N<D&&(F>0||K>0||Q>0);)F-=Math.max(0,Math.ceil(.1*F)),K-=Math.max(0,Math.ceil(.1*K)),Q-=Math.max(0,Math.ceil(.1*Q)),N=y(d.relativeLuminance2(F,K,Q),d.relativeLuminance2(L,B,R));return(F<<24|K<<16|Q<<8|255)>>>0}function S(A,C,D){let L=A>>24&255,B=A>>16&255,R=A>>8&255,F=C>>24&255,K=C>>16&255,Q=C>>8&255,N=y(d.relativeLuminance2(F,K,Q),d.relativeLuminance2(L,B,R));for(;N<D&&(F<255||K<255||Q<255);)F=Math.min(255,F+Math.ceil(.1*(255-F))),K=Math.min(255,K+Math.ceil(.1*(255-K))),Q=Math.min(255,Q+Math.ceil(.1*(255-Q))),N=y(d.relativeLuminance2(F,K,Q),d.relativeLuminance2(L,B,R));return(F<<24|K<<16|Q<<8|255)>>>0}w.ensureContrastRatio=function(A,C,D){let L=d.relativeLuminance(A>>8),B=d.relativeLuminance(C>>8);if(y(L,B)<D){if(B<L){let K=b(A,C,D),Q=y(L,d.relativeLuminance(K>>8));if(Q<D){let N=S(A,C,D);return Q>y(L,d.relativeLuminance(N>>8))?K:N}return K}let R=S(A,C,D),F=y(L,d.relativeLuminance(R>>8));if(F<D){let K=b(A,C,D);return F>y(L,d.relativeLuminance(K>>8))?R:K}return R}},w.reduceLuminance=b,w.increaseLuminance=S,w.toChannels=function(A){return[A>>24&255,A>>16&255,A>>8&255,255&A]},w.toColor=function(A,C,D,L){return{css:v.toCss(A,C,D,L),rgba:v.toRgba(A,C,D,L)}}}(f||(t.rgba=f={})),t.toPaddedHex=p,t.contrastRatio=y},345:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.runAndSubscribe=t.forwardEvent=t.EventEmitter=void 0,t.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=n=>(this._listeners.push(n),{dispose:()=>{if(!this._disposed){for(let h=0;h<this._listeners.length;h++)if(this._listeners[h]===n)return void this._listeners.splice(h,1)}}})),this._event}fire(n,h){let g=[];for(let a=0;a<this._listeners.length;a++)g.push(this._listeners[a]);for(let a=0;a<g.length;a++)g[a].call(void 0,n,h)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},t.forwardEvent=function(n,h){return n(g=>h.fire(g))},t.runAndSubscribe=function(n,h){return h(void 0),n(g=>h(g))}},859:(c,t)=>{function n(h){for(let g of h)g.dispose();h.length=0}Object.defineProperty(t,"__esModule",{value:!0}),t.getDisposeArrayDisposable=t.disposeArray=t.toDisposable=t.MutableDisposable=t.Disposable=void 0,t.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(let h of this._disposables)h.dispose();this._disposables.length=0}register(h){return this._disposables.push(h),h}unregister(h){let g=this._disposables.indexOf(h);g!==-1&&this._disposables.splice(g,1)}},t.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(h){this._isDisposed||h===this._value||(this._value?.dispose(),this._value=h)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,this._value?.dispose(),this._value=void 0}},t.toDisposable=function(h){return{dispose:h}},t.disposeArray=n,t.getDisposeArrayDisposable=function(h){return{dispose:()=>n(h)}}},485:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FourKeyMap=t.TwoKeyMap=void 0;class n{constructor(){this._data={}}set(g,a,l){this._data[g]||(this._data[g]={}),this._data[g][a]=l}get(g,a){return this._data[g]?this._data[g][a]:void 0}clear(){this._data={}}}t.TwoKeyMap=n,t.FourKeyMap=class{constructor(){this._data=new n}set(h,g,a,l,_){this._data.get(h,g)||this._data.set(h,g,new n),this._data.get(h,g).set(a,l,_)}get(h,g,a,l){return this._data.get(h,g)?.get(a,l)}clear(){this._data.clear()}}},399:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isChromeOS=t.isLinux=t.isWindows=t.isIphone=t.isIpad=t.isMac=t.getSafariVersion=t.isSafari=t.isLegacyEdge=t.isFirefox=t.isNode=void 0,t.isNode=typeof process<"u";let n=t.isNode?"node":navigator.userAgent,h=t.isNode?"node":navigator.platform;t.isFirefox=n.includes("Firefox"),t.isLegacyEdge=n.includes("Edge"),t.isSafari=/^((?!chrome|android).)*safari/i.test(n),t.getSafariVersion=function(){if(!t.isSafari)return 0;let g=n.match(/Version\/(\d+)/);return g===null||g.length<2?0:parseInt(g[1])},t.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(h),t.isIpad=h==="iPad",t.isIphone=h==="iPhone",t.isWindows=["Windows","Win16","Win32","WinCE"].includes(h),t.isLinux=h.indexOf("Linux")>=0,t.isChromeOS=/\bCrOS\b/.test(n)},385:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DebouncedIdleTask=t.IdleTaskQueue=t.PriorityTaskQueue=void 0;let h=n(399);class g{constructor(){this._tasks=[],this._i=0}enqueue(_){this._tasks.push(_),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(_){this._idleCallback=void 0;let v=0,u=0,o=_.timeRemaining(),d=0;for(;this._i<this._tasks.length;){if(v=Date.now(),this._tasks[this._i]()||this._i++,v=Math.max(1,Date.now()-v),u=Math.max(v,u),d=_.timeRemaining(),1.5*u>d)return o-v<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(o-v))}ms`),void this._start();o=d}this.clear()}}class a extends g{_requestCallback(_){return setTimeout(()=>_(this._createDeadline(16)))}_cancelCallback(_){clearTimeout(_)}_createDeadline(_){let v=Date.now()+_;return{timeRemaining:()=>Math.max(0,v-Date.now())}}}t.PriorityTaskQueue=a,t.IdleTaskQueue=!h.isNode&&"requestIdleCallback"in window?class extends g{_requestCallback(l){return requestIdleCallback(l)}_cancelCallback(l){cancelIdleCallback(l)}}:a,t.DebouncedIdleTask=class{constructor(){this._queue=new t.IdleTaskQueue}set(l){this._queue.clear(),this._queue.enqueue(l)}flush(){this._queue.flush()}}},147:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExtendedAttrs=t.AttributeData=void 0;class n{constructor(){this.fg=0,this.bg=0,this.extended=new h}static toColorRGB(a){return[a>>>16&255,a>>>8&255,255&a]}static fromColorRGB(a){return(255&a[0])<<16|(255&a[1])<<8|255&a[2]}clone(){let a=new n;return a.fg=this.fg,a.bg=this.bg,a.extended=this.extended.clone(),a}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}}t.AttributeData=n;class h{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(a){this._ext=a}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(a){this._ext&=-469762049,this._ext|=a<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(a){this._ext&=-67108864,this._ext|=67108863&a}get urlId(){return this._urlId}set urlId(a){this._urlId=a}constructor(a=0,l=0){this._ext=0,this._urlId=0,this._ext=a,this._urlId=l}clone(){return new h(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}t.ExtendedAttrs=h},782:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CellData=void 0;let h=n(133),g=n(855),a=n(147);class l extends a.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new a.ExtendedAttrs,this.combinedData=""}static fromCharData(v){let u=new l;return u.setFromCharData(v),u}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,h.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(v){this.fg=v[g.CHAR_DATA_ATTR_INDEX],this.bg=0;let u=!1;if(v[g.CHAR_DATA_CHAR_INDEX].length>2)u=!0;else if(v[g.CHAR_DATA_CHAR_INDEX].length===2){let o=v[g.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=o&&o<=56319){let d=v[g.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=d&&d<=57343?this.content=1024*(o-55296)+d-56320+65536|v[g.CHAR_DATA_WIDTH_INDEX]<<22:u=!0}else u=!0}else this.content=v[g.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|v[g.CHAR_DATA_WIDTH_INDEX]<<22;u&&(this.combinedData=v[g.CHAR_DATA_CHAR_INDEX],this.content=2097152|v[g.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}t.CellData=l},855:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WHITESPACE_CELL_CODE=t.WHITESPACE_CELL_WIDTH=t.WHITESPACE_CELL_CHAR=t.NULL_CELL_CODE=t.NULL_CELL_WIDTH=t.NULL_CELL_CHAR=t.CHAR_DATA_CODE_INDEX=t.CHAR_DATA_WIDTH_INDEX=t.CHAR_DATA_CHAR_INDEX=t.CHAR_DATA_ATTR_INDEX=t.DEFAULT_EXT=t.DEFAULT_ATTR=t.DEFAULT_COLOR=void 0,t.DEFAULT_COLOR=0,t.DEFAULT_ATTR=256|t.DEFAULT_COLOR<<9,t.DEFAULT_EXT=0,t.CHAR_DATA_ATTR_INDEX=0,t.CHAR_DATA_CHAR_INDEX=1,t.CHAR_DATA_WIDTH_INDEX=2,t.CHAR_DATA_CODE_INDEX=3,t.NULL_CELL_CHAR="",t.NULL_CELL_WIDTH=1,t.NULL_CELL_CODE=0,t.WHITESPACE_CELL_CHAR=" ",t.WHITESPACE_CELL_WIDTH=1,t.WHITESPACE_CELL_CODE=32},133:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Utf8ToUtf32=t.StringToUtf32=t.utf32ToString=t.stringFromCodePoint=void 0,t.stringFromCodePoint=function(n){return n>65535?(n-=65536,String.fromCharCode(55296+(n>>10))+String.fromCharCode(n%1024+56320)):String.fromCharCode(n)},t.utf32ToString=function(n,h=0,g=n.length){let a="";for(let l=h;l<g;++l){let _=n[l];_>65535?(_-=65536,a+=String.fromCharCode(55296+(_>>10))+String.fromCharCode(_%1024+56320)):a+=String.fromCharCode(_)}return a},t.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(n,h){let g=n.length;if(!g)return 0;let a=0,l=0;if(this._interim){let _=n.charCodeAt(l++);56320<=_&&_<=57343?h[a++]=1024*(this._interim-55296)+_-56320+65536:(h[a++]=this._interim,h[a++]=_),this._interim=0}for(let _=l;_<g;++_){let v=n.charCodeAt(_);if(55296<=v&&v<=56319){if(++_>=g)return this._interim=v,a;let u=n.charCodeAt(_);56320<=u&&u<=57343?h[a++]=1024*(v-55296)+u-56320+65536:(h[a++]=v,h[a++]=u)}else v!==65279&&(h[a++]=v)}return a}},t.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(n,h){let g=n.length;if(!g)return 0;let a,l,_,v,u=0,o=0,d=0;if(this.interim[0]){let y=!1,w=this.interim[0];w&=(224&w)==192?31:(240&w)==224?15:7;let b,S=0;for(;(b=63&this.interim[++S])&&S<4;)w<<=6,w|=b;let A=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,C=A-S;for(;d<C;){if(d>=g)return 0;if(b=n[d++],(192&b)!=128){d--,y=!0;break}this.interim[S++]=b,w<<=6,w|=63&b}y||(A===2?w<128?d--:h[u++]=w:A===3?w<2048||w>=55296&&w<=57343||w===65279||(h[u++]=w):w<65536||w>1114111||(h[u++]=w)),this.interim.fill(0)}let f=g-4,p=d;for(;p<g;){for(;!(!(p<f)||128&(a=n[p])||128&(l=n[p+1])||128&(_=n[p+2])||128&(v=n[p+3]));)h[u++]=a,h[u++]=l,h[u++]=_,h[u++]=v,p+=4;if(a=n[p++],a<128)h[u++]=a;else if((224&a)==192){if(p>=g)return this.interim[0]=a,u;if(l=n[p++],(192&l)!=128){p--;continue}if(o=(31&a)<<6|63&l,o<128){p--;continue}h[u++]=o}else if((240&a)==224){if(p>=g)return this.interim[0]=a,u;if(l=n[p++],(192&l)!=128){p--;continue}if(p>=g)return this.interim[0]=a,this.interim[1]=l,u;if(_=n[p++],(192&_)!=128){p--;continue}if(o=(15&a)<<12|(63&l)<<6|63&_,o<2048||o>=55296&&o<=57343||o===65279)continue;h[u++]=o}else if((248&a)==240){if(p>=g)return this.interim[0]=a,u;if(l=n[p++],(192&l)!=128){p--;continue}if(p>=g)return this.interim[0]=a,this.interim[1]=l,u;if(_=n[p++],(192&_)!=128){p--;continue}if(p>=g)return this.interim[0]=a,this.interim[1]=l,this.interim[2]=_,u;if(v=n[p++],(192&v)!=128){p--;continue}if(o=(7&a)<<18|(63&l)<<12|(63&_)<<6|63&v,o<65536||o>1114111)continue;h[u++]=o}}return u}}},776:function(c,t,n){var h=this&&this.__decorate||function(o,d,f,p){var y,w=arguments.length,b=w<3?d:p===null?p=Object.getOwnPropertyDescriptor(d,f):p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(o,d,f,p);else for(var S=o.length-1;S>=0;S--)(y=o[S])&&(b=(w<3?y(b):w>3?y(d,f,b):y(d,f))||b);return w>3&&b&&Object.defineProperty(d,f,b),b},g=this&&this.__param||function(o,d){return function(f,p){d(f,p,o)}};Object.defineProperty(t,"__esModule",{value:!0}),t.traceCall=t.setTraceLogger=t.LogService=void 0;let a=n(859),l=n(97),_={trace:l.LogLevelEnum.TRACE,debug:l.LogLevelEnum.DEBUG,info:l.LogLevelEnum.INFO,warn:l.LogLevelEnum.WARN,error:l.LogLevelEnum.ERROR,off:l.LogLevelEnum.OFF},v,u=t.LogService=class extends a.Disposable{get logLevel(){return this._logLevel}constructor(o){super(),this._optionsService=o,this._logLevel=l.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),v=this}_updateLogLevel(){this._logLevel=_[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(o){for(let d=0;d<o.length;d++)typeof o[d]=="function"&&(o[d]=o[d]())}_log(o,d,f){this._evalLazyOptionalParams(f),o.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+d,...f)}trace(o,...d){this._logLevel<=l.LogLevelEnum.TRACE&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,o,d)}debug(o,...d){this._logLevel<=l.LogLevelEnum.DEBUG&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,o,d)}info(o,...d){this._logLevel<=l.LogLevelEnum.INFO&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,o,d)}warn(o,...d){this._logLevel<=l.LogLevelEnum.WARN&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,o,d)}error(o,...d){this._logLevel<=l.LogLevelEnum.ERROR&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,o,d)}};t.LogService=u=h([g(0,l.IOptionsService)],u),t.setTraceLogger=function(o){v=o},t.traceCall=function(o,d,f){if(typeof f.value!="function")throw new Error("not supported");let p=f.value;f.value=function(...y){if(v.logLevel!==l.LogLevelEnum.TRACE)return p.apply(this,y);v.trace(`GlyphRenderer#${p.name}(${y.map(b=>JSON.stringify(b)).join(", ")})`);let w=p.apply(this,y);return v.trace(`GlyphRenderer#${p.name} return`,w),w}}},726:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createDecorator=t.getServiceDependencies=t.serviceRegistry=void 0;let n="di$target",h="di$dependencies";t.serviceRegistry=new Map,t.getServiceDependencies=function(g){return g[h]||[]},t.createDecorator=function(g){if(t.serviceRegistry.has(g))return t.serviceRegistry.get(g);let a=function(l,_,v){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(u,o,d){o[n]===o?o[h].push({id:u,index:d}):(o[h]=[{id:u,index:d}],o[n]=o)})(a,l,v)};return a.toString=()=>g,t.serviceRegistry.set(g,a),a}},97:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IDecorationService=t.IUnicodeService=t.IOscLinkService=t.IOptionsService=t.ILogService=t.LogLevelEnum=t.IInstantiationService=t.ICharsetService=t.ICoreService=t.ICoreMouseService=t.IBufferService=void 0;let h=n(726);var g;t.IBufferService=(0,h.createDecorator)("BufferService"),t.ICoreMouseService=(0,h.createDecorator)("CoreMouseService"),t.ICoreService=(0,h.createDecorator)("CoreService"),t.ICharsetService=(0,h.createDecorator)("CharsetService"),t.IInstantiationService=(0,h.createDecorator)("InstantiationService"),function(a){a[a.TRACE=0]="TRACE",a[a.DEBUG=1]="DEBUG",a[a.INFO=2]="INFO",a[a.WARN=3]="WARN",a[a.ERROR=4]="ERROR",a[a.OFF=5]="OFF"}(g||(t.LogLevelEnum=g={})),t.ILogService=(0,h.createDecorator)("LogService"),t.IOptionsService=(0,h.createDecorator)("OptionsService"),t.IOscLinkService=(0,h.createDecorator)("OscLinkService"),t.IUnicodeService=(0,h.createDecorator)("UnicodeService"),t.IDecorationService=(0,h.createDecorator)("DecorationService")}},i={};function r(c){var t=i[c];if(t!==void 0)return t.exports;var n=i[c]={exports:{}};return e[c].call(n.exports,n,n.exports,r),n.exports}var s={};return(()=>{var c=s;Object.defineProperty(c,"__esModule",{value:!0}),c.WebglAddon=void 0;let t=r(345),n=r(859),h=r(399),g=r(666),a=r(776);class l extends n.Disposable{constructor(v){if(h.isSafari&&(0,h.getSafariVersion)()<16)throw new Error("Webgl2 is only supported on Safari 16 and above");super(),this._preserveDrawingBuffer=v,this._onChangeTextureAtlas=this.register(new t.EventEmitter),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this.register(new t.EventEmitter),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=this.register(new t.EventEmitter),this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._onContextLoss=this.register(new t.EventEmitter),this.onContextLoss=this._onContextLoss.event}activate(v){let u=v._core;if(!v.element)return void this.register(u.onWillOpen(()=>this.activate(v)));this._terminal=v;let o=u.coreService,d=u.optionsService,f=u,p=f._renderService,y=f._characterJoinerService,w=f._charSizeService,b=f._coreBrowserService,S=f._decorationService,A=f._logService,C=f._themeService;(0,a.setTraceLogger)(A),this._renderer=this.register(new g.WebglRenderer(v,y,w,b,o,S,d,C,this._preserveDrawingBuffer)),this.register((0,t.forwardEvent)(this._renderer.onContextLoss,this._onContextLoss)),this.register((0,t.forwardEvent)(this._renderer.onChangeTextureAtlas,this._onChangeTextureAtlas)),this.register((0,t.forwardEvent)(this._renderer.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas)),this.register((0,t.forwardEvent)(this._renderer.onRemoveTextureAtlasCanvas,this._onRemoveTextureAtlasCanvas)),p.setRenderer(this._renderer),this.register((0,n.toDisposable)(()=>{let D=this._terminal._core._renderService;D.setRenderer(this._terminal._core._createRenderer()),D.handleResize(v.cols,v.rows)}))}get textureAtlas(){return this._renderer?.textureAtlas}clearTextureAtlas(){this._renderer?.clearTextureAtlas()}}c.WebglAddon=l})(),s})())});var eu=re((Ss,po)=>{(function(e,i){typeof Ss=="object"&&typeof po=="object"?po.exports=i():typeof define=="function"&&define.amd?define([],i):typeof Ss=="object"?Ss.WebLinksAddon=i():e.WebLinksAddon=i()})(self,()=>(()=>{"use strict";var e={6:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LinkComputer=t.WebLinkProvider=void 0,t.WebLinkProvider=class{constructor(h,g,a,l={}){this._terminal=h,this._regex=g,this._handler=a,this._options=l}provideLinks(h,g){let a=n.computeLink(h,this._regex,this._terminal,this._handler);g(this._addCallbacks(a))}_addCallbacks(h){return h.map(g=>(g.leave=this._options.leave,g.hover=(a,l)=>{if(this._options.hover){let{range:_}=g;this._options.hover(a,l,_)}},g))}};class n{static computeLink(g,a,l,_){let v=new RegExp(a.source,(a.flags||"")+"g"),[u,o]=n._getWindowedLineStrings(g-1,l),d=u.join(""),f,p=[];for(;f=v.exec(d);){let y=f[0];try{let D=new URL(y),L=decodeURI(D.toString());if(y!==L&&y+"/"!==L)continue}catch{continue}let[w,b]=n._mapStrIdx(l,o,0,f.index),[S,A]=n._mapStrIdx(l,w,b,y.length);if(w===-1||b===-1||S===-1||A===-1)continue;let C={start:{x:b+1,y:w+1},end:{x:A,y:S+1}};p.push({range:C,text:y,activate:_})}return p}static _getWindowedLineStrings(g,a){let l,_=g,v=g,u=0,o="",d=[];if(l=a.buffer.active.getLine(g)){let f=l.translateToString(!0);if(l.isWrapped&&f[0]!==" "){for(u=0;(l=a.buffer.active.getLine(--_))&&u<2048&&(o=l.translateToString(!0),u+=o.length,d.push(o),l.isWrapped&&o.indexOf(" ")===-1););d.reverse()}for(d.push(f),u=0;(l=a.buffer.active.getLine(++v))&&l.isWrapped&&u<2048&&(o=l.translateToString(!0),u+=o.length,d.push(o),o.indexOf(" ")===-1););}return[d,_]}static _mapStrIdx(g,a,l,_){let v=g.buffer.active,u=v.getNullCell(),o=l;for(;_;){let d=v.getLine(a);if(!d)return[-1,-1];for(let f=o;f<d.length;++f){d.getCell(f,u);let p=u.getChars();if(u.getWidth()&&(_-=p.length||1,f===d.length-1&&p==="")){let y=v.getLine(a+1);y&&y.isWrapped&&(y.getCell(0,u),u.getWidth()===2&&(_+=1))}if(_<0)return[a,f]}a++,o=0}return[a,o]}}t.LinkComputer=n}},i={};function r(c){var t=i[c];if(t!==void 0)return t.exports;var n=i[c]={exports:{}};return e[c](n,n.exports,r),n.exports}var s={};return(()=>{var c=s;Object.defineProperty(c,"__esModule",{value:!0}),c.WebLinksAddon=void 0;let t=r(6),n=/https?:[/]{2}[^\s"'!*(){}|\\\^<>`]*[^\s"':,.!?{}|\\\^~\[\]`()<>]/;function h(g,a){let l=window.open();if(l){try{l.opener=null}catch{}l.location.href=a}else console.warn("Opening link blocked as opener could not be cleared")}c.WebLinksAddon=class{constructor(g=h,a={}){this._handler=g,this._options=a}activate(g){this._terminal=g;let a=this._options,l=a.urlRegex||n;this._linkProvider=this._terminal.registerLinkProvider(new t.WebLinkProvider(this._terminal,l,this._handler,a))}dispose(){this._linkProvider?.dispose()}}})(),s})())});var tu=re((lr,vo)=>{(function(e,i){typeof lr=="object"&&typeof vo=="object"?vo.exports=i():typeof define=="function"&&define.amd?define([],i):typeof lr=="object"?lr.Unicode11Addon=i():e.Unicode11Addon=i()})(lr,()=>(()=>{"use strict";var e={433:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeV11=void 0;let h=n(938),g=[[768,879],[1155,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1541],[1552,1562],[1564,1564],[1611,1631],[1648,1648],[1750,1757],[1759,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2045,2045],[2070,2073],[2075,2083],[2085,2087],[2089,2093],[2137,2139],[2259,2306],[2362,2362],[2364,2364],[2369,2376],[2381,2381],[2385,2391],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2558,2558],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2641,2641],[2672,2673],[2677,2677],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2810,2815],[2817,2817],[2876,2876],[2879,2879],[2881,2884],[2893,2893],[2902,2902],[2914,2915],[2946,2946],[3008,3008],[3021,3021],[3072,3072],[3076,3076],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3170,3171],[3201,3201],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3328,3329],[3387,3388],[3393,3396],[3405,3405],[3426,3427],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3981,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4151],[4153,4154],[4157,4158],[4184,4185],[4190,4192],[4209,4212],[4226,4226],[4229,4230],[4237,4237],[4253,4253],[4448,4607],[4957,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6158],[6277,6278],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6683,6683],[6742,6742],[6744,6750],[6752,6752],[6754,6754],[6757,6764],[6771,6780],[6783,6783],[6832,6846],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7040,7041],[7074,7077],[7080,7081],[7083,7085],[7142,7142],[7144,7145],[7149,7149],[7151,7153],[7212,7219],[7222,7223],[7376,7378],[7380,7392],[7394,7400],[7405,7405],[7412,7412],[7416,7417],[7616,7673],[7675,7679],[8203,8207],[8234,8238],[8288,8292],[8294,8303],[8400,8432],[11503,11505],[11647,11647],[11744,11775],[12330,12333],[12441,12442],[42607,42610],[42612,42621],[42654,42655],[42736,42737],[43010,43010],[43014,43014],[43019,43019],[43045,43046],[43204,43205],[43232,43249],[43263,43263],[43302,43309],[43335,43345],[43392,43394],[43443,43443],[43446,43449],[43452,43453],[43493,43493],[43561,43566],[43569,43570],[43573,43574],[43587,43587],[43596,43596],[43644,43644],[43696,43696],[43698,43700],[43703,43704],[43710,43711],[43713,43713],[43756,43757],[43766,43766],[44005,44005],[44008,44008],[44013,44013],[64286,64286],[65024,65039],[65056,65071],[65279,65279],[65529,65531]],a=[[66045,66045],[66272,66272],[66422,66426],[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[68325,68326],[68900,68903],[69446,69456],[69633,69633],[69688,69702],[69759,69761],[69811,69814],[69817,69818],[69821,69821],[69837,69837],[69888,69890],[69927,69931],[69933,69940],[70003,70003],[70016,70017],[70070,70078],[70089,70092],[70191,70193],[70196,70196],[70198,70199],[70206,70206],[70367,70367],[70371,70378],[70400,70401],[70459,70460],[70464,70464],[70502,70508],[70512,70516],[70712,70719],[70722,70724],[70726,70726],[70750,70750],[70835,70840],[70842,70842],[70847,70848],[70850,70851],[71090,71093],[71100,71101],[71103,71104],[71132,71133],[71219,71226],[71229,71229],[71231,71232],[71339,71339],[71341,71341],[71344,71349],[71351,71351],[71453,71455],[71458,71461],[71463,71467],[71727,71735],[71737,71738],[72148,72151],[72154,72155],[72160,72160],[72193,72202],[72243,72248],[72251,72254],[72263,72263],[72273,72278],[72281,72283],[72330,72342],[72344,72345],[72752,72758],[72760,72765],[72767,72767],[72850,72871],[72874,72880],[72882,72883],[72885,72886],[73009,73014],[73018,73018],[73020,73021],[73023,73029],[73031,73031],[73104,73105],[73109,73109],[73111,73111],[73459,73460],[78896,78904],[92912,92916],[92976,92982],[94031,94031],[94095,94098],[113821,113822],[113824,113827],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[121344,121398],[121403,121452],[121461,121461],[121476,121476],[121499,121503],[121505,121519],[122880,122886],[122888,122904],[122907,122913],[122915,122916],[122918,122922],[123184,123190],[123628,123631],[125136,125142],[125252,125258],[917505,917505],[917536,917631],[917760,917999]],l=[[4352,4447],[8986,8987],[9001,9002],[9193,9196],[9200,9200],[9203,9203],[9725,9726],[9748,9749],[9800,9811],[9855,9855],[9875,9875],[9889,9889],[9898,9899],[9917,9918],[9924,9925],[9934,9934],[9940,9940],[9962,9962],[9970,9971],[9973,9973],[9978,9978],[9981,9981],[9989,9989],[9994,9995],[10024,10024],[10060,10060],[10062,10062],[10067,10069],[10071,10071],[10133,10135],[10160,10160],[10175,10175],[11035,11036],[11088,11088],[11093,11093],[11904,11929],[11931,12019],[12032,12245],[12272,12283],[12288,12329],[12334,12350],[12353,12438],[12443,12543],[12549,12591],[12593,12686],[12688,12730],[12736,12771],[12784,12830],[12832,12871],[12880,19903],[19968,42124],[42128,42182],[43360,43388],[44032,55203],[63744,64255],[65040,65049],[65072,65106],[65108,65126],[65128,65131],[65281,65376],[65504,65510]],_=[[94176,94179],[94208,100343],[100352,101106],[110592,110878],[110928,110930],[110948,110951],[110960,111355],[126980,126980],[127183,127183],[127374,127374],[127377,127386],[127488,127490],[127504,127547],[127552,127560],[127568,127569],[127584,127589],[127744,127776],[127789,127797],[127799,127868],[127870,127891],[127904,127946],[127951,127955],[127968,127984],[127988,127988],[127992,128062],[128064,128064],[128066,128252],[128255,128317],[128331,128334],[128336,128359],[128378,128378],[128405,128406],[128420,128420],[128507,128591],[128640,128709],[128716,128716],[128720,128722],[128725,128725],[128747,128748],[128756,128762],[128992,129003],[129293,129393],[129395,129398],[129402,129442],[129445,129450],[129454,129482],[129485,129535],[129648,129651],[129656,129658],[129664,129666],[129680,129685],[131072,196605],[196608,262141]],v;function u(o,d){let f,p=0,y=d.length-1;if(o<d[0][0]||o>d[y][1])return!1;for(;y>=p;)if(f=p+y>>1,o>d[f][1])p=f+1;else{if(!(o<d[f][0]))return!0;y=f-1}return!1}t.UnicodeV11=class{constructor(){if(this.version="11",!v){v=new Uint8Array(65536),v.fill(1),v[0]=0,v.fill(0,1,32),v.fill(0,127,160);for(let o=0;o<g.length;++o)v.fill(0,g[o][0],g[o][1]+1);for(let o=0;o<l.length;++o)v.fill(2,l[o][0],l[o][1]+1)}}wcwidth(o){return o<32?0:o<127?1:o<65536?v[o]:u(o,a)?0:u(o,_)?2:1}charProperties(o,d){let f=this.wcwidth(o),p=f===0&&d!==0;if(p){let y=h.UnicodeService.extractWidth(d);y===0?p=!1:y>f&&(f=y)}return h.UnicodeService.createPropertyValue(0,f,p)}}},345:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.runAndSubscribe=t.forwardEvent=t.EventEmitter=void 0,t.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=n=>(this._listeners.push(n),{dispose:()=>{if(!this._disposed){for(let h=0;h<this._listeners.length;h++)if(this._listeners[h]===n)return void this._listeners.splice(h,1)}}})),this._event}fire(n,h){let g=[];for(let a=0;a<this._listeners.length;a++)g.push(this._listeners[a]);for(let a=0;a<g.length;a++)g[a].call(void 0,n,h)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},t.forwardEvent=function(n,h){return n(g=>h.fire(g))},t.runAndSubscribe=function(n,h){return h(void 0),n(g=>h(g))}},490:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeV6=void 0;let h=n(938),g=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],a=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],l;t.UnicodeV6=class{constructor(){if(this.version="6",!l){l=new Uint8Array(65536),l.fill(1),l[0]=0,l.fill(0,1,32),l.fill(0,127,160),l.fill(2,4352,4448),l[9001]=2,l[9002]=2,l.fill(2,11904,42192),l[12351]=1,l.fill(2,44032,55204),l.fill(2,63744,64256),l.fill(2,65040,65050),l.fill(2,65072,65136),l.fill(2,65280,65377),l.fill(2,65504,65511);for(let _=0;_<g.length;++_)l.fill(0,g[_][0],g[_][1]+1)}}wcwidth(_){return _<32?0:_<127?1:_<65536?l[_]:function(v,u){let o,d=0,f=u.length-1;if(v<u[0][0]||v>u[f][1])return!1;for(;f>=d;)if(o=d+f>>1,v>u[o][1])d=o+1;else{if(!(v<u[o][0]))return!0;f=o-1}return!1}(_,a)?0:_>=131072&&_<=196605||_>=196608&&_<=262141?2:1}charProperties(_,v){let u=this.wcwidth(_),o=u===0&&v!==0;if(o){let d=h.UnicodeService.extractWidth(v);d===0?o=!1:d>u&&(u=d)}return h.UnicodeService.createPropertyValue(0,u,o)}}},938:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeService=void 0;let h=n(345),g=n(490);class a{static extractShouldJoin(_){return(1&_)!=0}static extractWidth(_){return _>>1&3}static extractCharKind(_){return _>>3}static createPropertyValue(_,v,u=!1){return(16777215&_)<<3|(3&v)<<1|(u?1:0)}constructor(){this._providers=Object.create(null),this._active="",this._onChange=new h.EventEmitter,this.onChange=this._onChange.event;let _=new g.UnicodeV6;this.register(_),this._active=_.version,this._activeProvider=_}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(_){if(!this._providers[_])throw new Error(`unknown Unicode version "${_}"`);this._active=_,this._activeProvider=this._providers[_],this._onChange.fire(_)}register(_){this._providers[_.version]=_}wcwidth(_){return this._activeProvider.wcwidth(_)}getStringCellWidth(_){let v=0,u=0,o=_.length;for(let d=0;d<o;++d){let f=_.charCodeAt(d);if(55296<=f&&f<=56319){if(++d>=o)return v+this.wcwidth(f);let w=_.charCodeAt(d);56320<=w&&w<=57343?f=1024*(f-55296)+w-56320+65536:v+=this.wcwidth(w)}let p=this.charProperties(f,u),y=a.extractWidth(p);a.extractShouldJoin(p)&&(y-=a.extractWidth(u)),v+=y,u=p}return v}charProperties(_,v){return this._activeProvider.charProperties(_,v)}}t.UnicodeService=a}},i={};function r(c){var t=i[c];if(t!==void 0)return t.exports;var n=i[c]={exports:{}};return e[c](n,n.exports,r),n.exports}var s={};return(()=>{var c=s;Object.defineProperty(c,"__esModule",{value:!0}),c.Unicode11Addon=void 0;let t=r(433);c.Unicode11Addon=class{activate(n){n.unicode.register(new t.UnicodeV11)}dispose(){}}})(),s})())});var iu=re((Es,mo)=>{(function(e,i){typeof Es=="object"&&typeof mo=="object"?mo.exports=i():typeof define=="function"&&define.amd?define([],i):typeof Es=="object"?Es.AttachAddon=i():e.AttachAddon=i()})(self,()=>(()=>{"use strict";var e={};return(()=>{var i=e;function r(s,c,t){return s.addEventListener(c,t),{dispose:()=>{t&&s.removeEventListener(c,t)}}}Object.defineProperty(i,"__esModule",{value:!0}),i.AttachAddon=void 0,i.AttachAddon=class{constructor(s,c){this._disposables=[],this._socket=s,this._socket.binaryType="arraybuffer",this._bidirectional=!(c&&c.bidirectional===!1)}activate(s){this._disposables.push(r(this._socket,"message",c=>{let t=c.data;s.write(typeof t=="string"?t:new Uint8Array(t))})),this._bidirectional&&(this._disposables.push(s.onData(c=>this._sendData(c))),this._disposables.push(s.onBinary(c=>this._sendBinary(c)))),this._disposables.push(r(this._socket,"close",()=>this.dispose())),this._disposables.push(r(this._socket,"error",()=>this.dispose()))}dispose(){for(let s of this._disposables)s.dispose()}_sendData(s){this._checkOpenSocket()&&this._socket.send(s)}_sendBinary(s){if(!this._checkOpenSocket())return;let c=new Uint8Array(s.length);for(let t=0;t<s.length;++t)c[t]=255&s.charCodeAt(t);this._socket.send(c)}_checkOpenSocket(){switch(this._socket.readyState){case WebSocket.OPEN:return!0;case WebSocket.CONNECTING:throw new Error("Attach addon was loaded before socket was open");case WebSocket.CLOSING:return console.warn("Attach addon socket is closing"),!1;case WebSocket.CLOSED:throw new Error("Attach addon socket is closed");default:throw new Error("Unexpected socket state")}}}})(),e})())});var ru=re((ks,yo)=>{(function(e,i){typeof ks=="object"&&typeof yo=="object"?yo.exports=i():typeof define=="function"&&define.amd?define([],i):typeof ks=="object"?ks.SearchAddon=i():e.SearchAddon=i()})(self,()=>(()=>{"use strict";var e={345:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.runAndSubscribe=t.forwardEvent=t.EventEmitter=void 0,t.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=n=>(this._listeners.push(n),{dispose:()=>{if(!this._disposed){for(let h=0;h<this._listeners.length;h++)if(this._listeners[h]===n)return void this._listeners.splice(h,1)}}})),this._event}fire(n,h){let g=[];for(let a=0;a<this._listeners.length;a++)g.push(this._listeners[a]);for(let a=0;a<g.length;a++)g[a].call(void 0,n,h)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},t.forwardEvent=function(n,h){return n(g=>h.fire(g))},t.runAndSubscribe=function(n,h){return h(void 0),n(g=>h(g))}},859:(c,t)=>{function n(h){for(let g of h)g.dispose();h.length=0}Object.defineProperty(t,"__esModule",{value:!0}),t.getDisposeArrayDisposable=t.disposeArray=t.toDisposable=t.MutableDisposable=t.Disposable=void 0,t.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(let h of this._disposables)h.dispose();this._disposables.length=0}register(h){return this._disposables.push(h),h}unregister(h){let g=this._disposables.indexOf(h);g!==-1&&this._disposables.splice(g,1)}},t.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(h){this._isDisposed||h===this._value||(this._value?.dispose(),this._value=h)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,this._value?.dispose(),this._value=void 0}},t.toDisposable=function(h){return{dispose:h}},t.disposeArray=n,t.getDisposeArrayDisposable=function(h){return{dispose:()=>n(h)}}}},i={};function r(c){var t=i[c];if(t!==void 0)return t.exports;var n=i[c]={exports:{}};return e[c](n,n.exports,r),n.exports}var s={};return(()=>{var c=s;Object.defineProperty(c,"__esModule",{value:!0}),c.SearchAddon=void 0;let t=r(345),n=r(859),h=" ~!@#$%^&*()+`-=[]{}|\\;:\"',./<>?";class g extends n.Disposable{constructor(l){super(),this._highlightedLines=new Set,this._highlightDecorations=[],this._selectedDecoration=this.register(new n.MutableDisposable),this._linesCacheTimeoutId=0,this._onDidChangeResults=this.register(new t.EventEmitter),this.onDidChangeResults=this._onDidChangeResults.event,this._highlightLimit=l?.highlightLimit??1e3}activate(l){this._terminal=l,this.register(this._terminal.onWriteParsed(()=>this._updateMatches())),this.register(this._terminal.onResize(()=>this._updateMatches())),this.register((0,n.toDisposable)(()=>this.clearDecorations()))}_updateMatches(){this._highlightTimeout&&window.clearTimeout(this._highlightTimeout),this._cachedSearchTerm&&this._lastSearchOptions?.decorations&&(this._highlightTimeout=setTimeout(()=>{let l=this._cachedSearchTerm;this._cachedSearchTerm=void 0,this.findPrevious(l,{...this._lastSearchOptions,incremental:!0,noScroll:!0})},200))}clearDecorations(l){this._selectedDecoration.clear(),(0,n.disposeArray)(this._highlightDecorations),this._highlightDecorations=[],this._highlightedLines.clear(),l||(this._cachedSearchTerm=void 0)}clearActiveDecoration(){this._selectedDecoration.clear()}findNext(l,_){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");let v=!this._lastSearchOptions||this._didOptionsChange(this._lastSearchOptions,_);this._lastSearchOptions=_,_?.decorations&&(this._cachedSearchTerm===void 0||l!==this._cachedSearchTerm||v)&&this._highlightAllMatches(l,_);let u=this._findNextAndSelect(l,_);return this._fireResults(_),this._cachedSearchTerm=l,u}_highlightAllMatches(l,_){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");if(!l||l.length===0)return void this.clearDecorations();_=_||{},this.clearDecorations(!0);let v=[],u,o=this._find(l,0,0,_);for(;o&&(u?.row!==o.row||u?.col!==o.col)&&!(v.length>=this._highlightLimit);)u=o,v.push(u),o=this._find(l,u.col+u.term.length>=this._terminal.cols?u.row+1:u.row,u.col+u.term.length>=this._terminal.cols?0:u.col+1,_);for(let d of v){let f=this._createResultDecoration(d,_.decorations);f&&(this._highlightedLines.add(f.marker.line),this._highlightDecorations.push({decoration:f,match:d,dispose(){f.dispose()}}))}}_find(l,_,v,u){if(!this._terminal||!l||l.length===0)return this._terminal?.clearSelection(),void this.clearDecorations();if(v>this._terminal.cols)throw new Error(`Invalid col: ${v} to search in terminal of ${this._terminal.cols} cols`);let o;this._initLinesCache();let d={startRow:_,startCol:v};if(o=this._findInLine(l,d,u),!o)for(let f=_+1;f<this._terminal.buffer.active.baseY+this._terminal.rows&&(d.startRow=f,d.startCol=0,o=this._findInLine(l,d,u),!o);f++);return o}_findNextAndSelect(l,_){if(!this._terminal||!l||l.length===0)return this._terminal?.clearSelection(),this.clearDecorations(),!1;let v=this._terminal.getSelectionPosition();this._terminal.clearSelection();let u=0,o=0;v&&(this._cachedSearchTerm===l?(u=v.end.x,o=v.end.y):(u=v.start.x,o=v.start.y)),this._initLinesCache();let d={startRow:o,startCol:u},f=this._findInLine(l,d,_);if(!f)for(let p=o+1;p<this._terminal.buffer.active.baseY+this._terminal.rows&&(d.startRow=p,d.startCol=0,f=this._findInLine(l,d,_),!f);p++);if(!f&&o!==0)for(let p=0;p<o&&(d.startRow=p,d.startCol=0,f=this._findInLine(l,d,_),!f);p++);return!f&&v&&(d.startRow=v.start.y,d.startCol=0,f=this._findInLine(l,d,_)),this._selectResult(f,_?.decorations,_?.noScroll)}findPrevious(l,_){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");let v=!this._lastSearchOptions||this._didOptionsChange(this._lastSearchOptions,_);this._lastSearchOptions=_,_?.decorations&&(this._cachedSearchTerm===void 0||l!==this._cachedSearchTerm||v)&&this._highlightAllMatches(l,_);let u=this._findPreviousAndSelect(l,_);return this._fireResults(_),this._cachedSearchTerm=l,u}_didOptionsChange(l,_){return!!_&&(l.caseSensitive!==_.caseSensitive||l.regex!==_.regex||l.wholeWord!==_.wholeWord)}_fireResults(l){if(l?.decorations){let _=-1;if(this._selectedDecoration.value){let v=this._selectedDecoration.value.match;for(let u=0;u<this._highlightDecorations.length;u++){let o=this._highlightDecorations[u].match;if(o.row===v.row&&o.col===v.col&&o.size===v.size){_=u;break}}}this._onDidChangeResults.fire({resultIndex:_,resultCount:this._highlightDecorations.length})}}_findPreviousAndSelect(l,_){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");if(!this._terminal||!l||l.length===0)return this._terminal?.clearSelection(),this.clearDecorations(),!1;let v=this._terminal.getSelectionPosition();this._terminal.clearSelection();let u=this._terminal.buffer.active.baseY+this._terminal.rows-1,o=this._terminal.cols,d=!0;this._initLinesCache();let f={startRow:u,startCol:o},p;if(v&&(f.startRow=u=v.start.y,f.startCol=o=v.start.x,this._cachedSearchTerm!==l&&(p=this._findInLine(l,f,_,!1),p||(f.startRow=u=v.end.y,f.startCol=o=v.end.x))),p||(p=this._findInLine(l,f,_,d)),!p){f.startCol=Math.max(f.startCol,this._terminal.cols);for(let y=u-1;y>=0&&(f.startRow=y,p=this._findInLine(l,f,_,d),!p);y--);}if(!p&&u!==this._terminal.buffer.active.baseY+this._terminal.rows-1)for(let y=this._terminal.buffer.active.baseY+this._terminal.rows-1;y>=u&&(f.startRow=y,p=this._findInLine(l,f,_,d),!p);y--);return this._selectResult(p,_?.decorations,_?.noScroll)}_initLinesCache(){let l=this._terminal;this._linesCache||(this._linesCache=new Array(l.buffer.active.length),this._cursorMoveListener=l.onCursorMove(()=>this._destroyLinesCache()),this._resizeListener=l.onResize(()=>this._destroyLinesCache())),window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=window.setTimeout(()=>this._destroyLinesCache(),15e3)}_destroyLinesCache(){this._linesCache=void 0,this._cursorMoveListener&&(this._cursorMoveListener.dispose(),this._cursorMoveListener=void 0),this._resizeListener&&(this._resizeListener.dispose(),this._resizeListener=void 0),this._linesCacheTimeoutId&&(window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=0)}_isWholeWord(l,_,v){return(l===0||h.includes(_[l-1]))&&(l+v.length===_.length||h.includes(_[l+v.length]))}_findInLine(l,_,v={},u=!1){let o=this._terminal,d=_.startRow,f=_.startCol;if(o.buffer.active.getLine(d)?.isWrapped)return u?void(_.startCol+=o.cols):(_.startRow--,_.startCol+=o.cols,this._findInLine(l,_,v));let y=this._linesCache?.[d];y||(y=this._translateBufferLineToStringWithWrap(d,!0),this._linesCache&&(this._linesCache[d]=y));let[w,b]=y,S=this._bufferColsToStringOffset(d,f),A=v.caseSensitive?l:l.toLowerCase(),C=v.caseSensitive?w:w.toLowerCase(),D=-1;if(v.regex){let L=RegExp(A,"g"),B;if(u)for(;B=L.exec(C.slice(0,S));)D=L.lastIndex-B[0].length,l=B[0],L.lastIndex-=l.length-1;else B=L.exec(C.slice(S)),B&&B[0].length>0&&(D=S+(L.lastIndex-B[0].length),l=B[0])}else u?S-A.length>=0&&(D=C.lastIndexOf(A,S-A.length)):D=C.indexOf(A,S);if(D>=0){if(v.wholeWord&&!this._isWholeWord(D,C,l))return;let L=0;for(;L<b.length-1&&D>=b[L+1];)L++;let B=L;for(;B<b.length-1&&D+l.length>=b[B+1];)B++;let R=D-b[L],F=D+l.length-b[B],K=this._stringLengthToBufferSize(d+L,R);return{term:l,col:K,row:d+L,size:this._stringLengthToBufferSize(d+B,F)-K+o.cols*(B-L)}}}_stringLengthToBufferSize(l,_){let v=this._terminal.buffer.active.getLine(l);if(!v)return 0;for(let u=0;u<_;u++){let o=v.getCell(u);if(!o)break;let d=o.getChars();d.length>1&&(_-=d.length-1);let f=v.getCell(u+1);f&&f.getWidth()===0&&_++}return _}_bufferColsToStringOffset(l,_){let v=this._terminal,u=l,o=0,d=v.buffer.active.getLine(u);for(;_>0&&d;){for(let f=0;f<_&&f<v.cols;f++){let p=d.getCell(f);if(!p)break;p.getWidth()&&(o+=p.getCode()===0?1:p.getChars().length)}if(u++,d=v.buffer.active.getLine(u),d&&!d.isWrapped)break;_-=v.cols}return o}_translateBufferLineToStringWithWrap(l,_){let v=this._terminal,u=[],o=[0],d=v.buffer.active.getLine(l);for(;d;){let f=v.buffer.active.getLine(l+1),p=!!f&&f.isWrapped,y=d.translateToString(!p&&_);if(p&&f){let w=d.getCell(d.length-1);w&&w.getCode()===0&&w.getWidth()===1&&f.getCell(0)?.getWidth()===2&&(y=y.slice(0,-1))}if(u.push(y),!p)break;o.push(o[o.length-1]+y.length),l++,d=f}return[u.join(""),o]}_selectResult(l,_,v){let u=this._terminal;if(this._selectedDecoration.clear(),!l)return u.clearSelection(),!1;if(u.select(l.col,l.row,l.size),_){let o=u.registerMarker(-u.buffer.active.baseY-u.buffer.active.cursorY+l.row);if(o){let d=u.registerDecoration({marker:o,x:l.col,width:l.size,backgroundColor:_.activeMatchBackground,layer:"top",overviewRulerOptions:{color:_.activeMatchColorOverviewRuler}});if(d){let f=[];f.push(o),f.push(d.onRender(p=>this._applyStyles(p,_.activeMatchBorder,!0))),f.push(d.onDispose(()=>(0,n.disposeArray)(f))),this._selectedDecoration.value={decoration:d,match:l,dispose(){d.dispose()}}}}}if(!v&&(l.row>=u.buffer.active.viewportY+u.rows||l.row<u.buffer.active.viewportY)){let o=l.row-u.buffer.active.viewportY;o-=Math.floor(u.rows/2),u.scrollLines(o)}return!0}_applyStyles(l,_,v){l.classList.contains("xterm-find-result-decoration")||(l.classList.add("xterm-find-result-decoration"),_&&(l.style.outline=`1px solid ${_}`)),v&&l.classList.add("xterm-find-active-result-decoration")}_createResultDecoration(l,_){let v=this._terminal,u=v.registerMarker(-v.buffer.active.baseY-v.buffer.active.cursorY+l.row);if(!u)return;let o=v.registerDecoration({marker:u,x:l.col,width:l.size,backgroundColor:_.matchBackground,overviewRulerOptions:this._highlightedLines.has(u.line)?void 0:{color:_.matchOverviewRuler,position:"center"}});if(o){let d=[];d.push(u),d.push(o.onRender(f=>this._applyStyles(f,_.matchBorder,!1))),d.push(o.onDispose(()=>(0,n.disposeArray)(d)))}return o}}c.SearchAddon=g})(),s})())});var su=re((Bs,bo)=>{(function(e,i){typeof Bs=="object"&&typeof bo=="object"?bo.exports=i():typeof define=="function"&&define.amd?define([],i):typeof Bs=="object"?Bs.ImageAddon=i():e.ImageAddon=i()})(self,()=>(()=>{"use strict";var e={615:(c,t)=>{function n(h){if(typeof Buffer<"u")return Buffer.from(h,"base64");let g=atob(h),a=new Uint8Array(g.length);for(let l=0;l<a.length;++l)a[l]=g.charCodeAt(l);return a}Object.defineProperty(t,"__esModule",{value:!0}),t.InWasm=void 0,t.InWasm=function(h){if(h.d){let{t:g,s:a,d:l}=h,_,v,u=WebAssembly;return g===2?a?()=>_||(_=n(l)):()=>Promise.resolve(_||(_=n(l))):g===1?a?()=>v||(v=new u.Module(_||(_=n(l)))):()=>v?Promise.resolve(v):u.compile(_||(_=n(l))).then(o=>v=o):a?o=>new u.Instance(v||(v=new u.Module(_||(_=n(l)))),o):o=>v?u.instantiate(v,o):u.instantiate(_||(_=n(l)),o).then(d=>(v=d.module)&&d.instance)}if(typeof _wasmCtx>"u")throw new Error('must run "inwasm"');_wasmCtx.add(h)}},477:(c,t)=>{function n(u){return 255&u}function h(u){return u>>>8&255}function g(u){return u>>>16&255}function a(u,o,d,f=255){return((255&f)<<24|(255&d)<<16|(255&o)<<8|255&u)>>>0}function l(u,o,d){return Math.max(u,Math.min(d,o))}function _(u,o,d){return d<0&&(d+=1),d>1&&(d-=1),6*d<1?o+6*(u-o)*d:2*d<1?u:3*d<2?o+(u-o)*(4-6*d):o}function v(u,o,d){return(4278190080|Math.round(d/100*255)<<16|Math.round(o/100*255)<<8|Math.round(u/100*255))>>>0}Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_FOREGROUND=t.DEFAULT_BACKGROUND=t.PALETTE_ANSI_256=t.PALETTE_VT340_GREY=t.PALETTE_VT340_COLOR=t.normalizeHLS=t.normalizeRGB=t.nearestColorIndex=t.fromRGBA8888=t.toRGBA8888=t.alpha=t.blue=t.green=t.red=t.BIG_ENDIAN=void 0,t.BIG_ENDIAN=new Uint8Array(new Uint32Array([4278190080]).buffer)[0]===255,t.BIG_ENDIAN&&console.warn("BE platform detected. This version of node-sixel works only on LE properly."),t.red=n,t.green=h,t.blue=g,t.alpha=function(u){return u>>>24&255},t.toRGBA8888=a,t.fromRGBA8888=function(u){return[255&u,u>>8&255,u>>16&255,u>>>24]},t.nearestColorIndex=function(u,o){let d=n(u),f=h(u),p=g(u),y=Number.MAX_SAFE_INTEGER,w=-1;for(let b=0;b<o.length;++b){let S=d-o[b][0],A=f-o[b][1],C=p-o[b][2],D=S*S+A*A+C*C;if(!D)return b;D<y&&(y=D,w=b)}return w},t.normalizeRGB=v,t.normalizeHLS=function(u,o,d){return function(f,p,y){if(!y){let S=Math.round(255*p);return a(S,S,S)}let w=p<.5?p*(1+y):p+y-p*y,b=2*p-w;return a(l(0,255,Math.round(255*_(w,b,f+.3333333333333333))),l(0,255,Math.round(255*_(w,b,f))),l(0,255,Math.round(255*_(w,b,f-.3333333333333333))))}((u+240)/360,o/100,d/100)},t.PALETTE_VT340_COLOR=new Uint32Array([v(0,0,0),v(20,20,80),v(80,13,13),v(20,80,20),v(80,20,80),v(20,80,80),v(80,80,20),v(53,53,53),v(26,26,26),v(33,33,60),v(60,26,26),v(33,60,33),v(60,33,60),v(33,60,60),v(60,60,33),v(80,80,80)]),t.PALETTE_VT340_GREY=new Uint32Array([v(0,0,0),v(13,13,13),v(26,26,26),v(40,40,40),v(6,6,6),v(20,20,20),v(33,33,33),v(46,46,46),v(0,0,0),v(13,13,13),v(26,26,26),v(40,40,40),v(6,6,6),v(20,20,20),v(33,33,33),v(46,46,46)]),t.PALETTE_ANSI_256=(()=>{let u=[a(0,0,0),a(205,0,0),a(0,205,0),a(205,205,0),a(0,0,238),a(205,0,205),a(0,250,205),a(229,229,229),a(127,127,127),a(255,0,0),a(0,255,0),a(255,255,0),a(92,92,255),a(255,0,255),a(0,255,255),a(255,255,255)],o=[0,95,135,175,215,255];for(let d=0;d<6;++d)for(let f=0;f<6;++f)for(let p=0;p<6;++p)u.push(a(o[d],o[f],o[p]));for(let d=8;d<=238;d+=10)u.push(a(d,d,d));return new Uint32Array(u)})(),t.DEFAULT_BACKGROUND=a(0,0,0,255),t.DEFAULT_FOREGROUND=a(255,255,255,255)},710:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.decodeAsync=t.decode=t.Decoder=t.DecoderAsync=void 0;let h=n(477),g=n(343),a=function(f){if(typeof Buffer<"u")return Buffer.from(f,"base64");let p=atob(f),y=new Uint8Array(p.length);for(let w=0;w<y.length;++w)y[w]=p.charCodeAt(w);return y}(g.LIMITS.BYTES),l,_=new Uint32Array;class v{constructor(){this.bandHandler=p=>1,this.modeHandler=p=>1}handle_band(p){return this.bandHandler(p)}mode_parsed(p){return this.modeHandler(p)}}let u={memoryLimit:134217728,sixelColor:h.DEFAULT_FOREGROUND,fillColor:h.DEFAULT_BACKGROUND,palette:h.PALETTE_VT340_COLOR,paletteLimit:g.LIMITS.PALETTE_SIZE,truncate:!0};function o(f){let p=new v,y={env:{handle_band:p.handle_band.bind(p),mode_parsed:p.mode_parsed.bind(p)}};return WebAssembly.instantiate(l||a,y).then(w=>(l=l||w.module,new d(f,w.instance||w,p)))}t.DecoderAsync=o;class d{constructor(p,y,w){if(this._PIXEL_OFFSET=g.LIMITS.MAX_WIDTH+4,this._canvas=_,this._bandWidths=[],this._maxWidth=0,this._minWidth=g.LIMITS.MAX_WIDTH,this._lastOffset=0,this._currentHeight=0,this._opts=Object.assign({},u,p),this._opts.paletteLimit>g.LIMITS.PALETTE_SIZE)throw new Error(`DecoderOptions.paletteLimit must not exceed ${g.LIMITS.PALETTE_SIZE}`);if(y)w.bandHandler=this._handle_band.bind(this),w.modeHandler=this._initCanvas.bind(this);else{let b=l||(l=new WebAssembly.Module(a));y=new WebAssembly.Instance(b,{env:{handle_band:this._handle_band.bind(this),mode_parsed:this._initCanvas.bind(this)}})}this._instance=y,this._wasm=this._instance.exports,this._chunk=new Uint8Array(this._wasm.memory.buffer,this._wasm.get_chunk_address(),g.LIMITS.CHUNK_SIZE),this._states=new Uint32Array(this._wasm.memory.buffer,this._wasm.get_state_address(),12),this._palette=new Uint32Array(this._wasm.memory.buffer,this._wasm.get_palette_address(),g.LIMITS.PALETTE_SIZE),this._palette.set(this._opts.palette),this._pSrc=new Uint32Array(this._wasm.memory.buffer,this._wasm.get_p0_address()),this._wasm.init(h.DEFAULT_FOREGROUND,0,this._opts.paletteLimit,0)}get _fillColor(){return this._states[0]}get _truncate(){return this._states[8]}get _rasterWidth(){return this._states[6]}get _rasterHeight(){return this._states[7]}get _width(){return this._states[2]?this._states[2]-4:0}get _height(){return this._states[3]}get _level(){return this._states[9]}get _mode(){return this._states[10]}get _paletteLimit(){return this._states[11]}_initCanvas(p){if(p===2){let y=this.width*this.height;if(y>this._canvas.length){if(this._opts.memoryLimit&&4*y>this._opts.memoryLimit)throw this.release(),new Error("image exceeds memory limit");this._canvas=new Uint32Array(y)}this._maxWidth=this._width}else if(p===1)if(this._level===2){let y=Math.min(this._rasterWidth,g.LIMITS.MAX_WIDTH)*this._rasterHeight;if(y>this._canvas.length){if(this._opts.memoryLimit&&4*y>this._opts.memoryLimit)throw this.release(),new Error("image exceeds memory limit");this._canvas=new Uint32Array(y)}}else this._canvas.length<65536&&(this._canvas=new Uint32Array(65536));return 0}_realloc(p,y){let w=p+y;if(w>this._canvas.length){if(this._opts.memoryLimit&&4*w>this._opts.memoryLimit)throw this.release(),new Error("image exceeds memory limit");let b=new Uint32Array(65536*Math.ceil(w/65536));b.set(this._canvas),this._canvas=b}}_handle_band(p){let y=this._PIXEL_OFFSET,w=this._lastOffset;if(this._mode===2){let b=this.height-this._currentHeight,S=0;for(;S<6&&b>0;)this._canvas.set(this._pSrc.subarray(y*S,y*S+p),w+p*S),S++,b--;this._lastOffset+=p*S,this._currentHeight+=S}else if(this._mode===1){this._realloc(w,6*p),this._maxWidth=Math.max(this._maxWidth,p),this._minWidth=Math.min(this._minWidth,p);for(let b=0;b<6;++b)this._canvas.set(this._pSrc.subarray(y*b,y*b+p),w+p*b);this._bandWidths.push(p),this._lastOffset+=6*p,this._currentHeight+=6}return 0}get width(){return this._mode!==1?this._width:Math.max(this._maxWidth,this._wasm.current_width())}get height(){return this._mode!==1?this._height:this._wasm.current_width()?6*this._bandWidths.length+this._wasm.current_height():6*this._bandWidths.length}get palette(){return this._palette.subarray(0,this._paletteLimit)}get memoryUsage(){return this._canvas.byteLength+this._wasm.memory.buffer.byteLength+8*this._bandWidths.length}get properties(){return{width:this.width,height:this.height,mode:this._mode,level:this._level,truncate:!!this._truncate,paletteLimit:this._paletteLimit,fillColor:this._fillColor,memUsage:this.memoryUsage,rasterAttributes:{numerator:this._states[4],denominator:this._states[5],width:this._rasterWidth,height:this._rasterHeight}}}init(p=this._opts.fillColor,y=this._opts.palette,w=this._opts.paletteLimit,b=this._opts.truncate){this._wasm.init(this._opts.sixelColor,p,w,b?1:0),y&&this._palette.set(y.subarray(0,g.LIMITS.PALETTE_SIZE)),this._bandWidths.length=0,this._maxWidth=0,this._minWidth=g.LIMITS.MAX_WIDTH,this._lastOffset=0,this._currentHeight=0}decode(p,y=0,w=p.length){let b=y;for(;b<w;){let S=Math.min(w-b,g.LIMITS.CHUNK_SIZE);this._chunk.set(p.subarray(b,b+=S)),this._wasm.decode(0,S)}}decodeString(p,y=0,w=p.length){let b=y;for(;b<w;){let S=Math.min(w-b,g.LIMITS.CHUNK_SIZE);for(let A=0,C=b;A<S;++A,++C)this._chunk[A]=p.charCodeAt(C);b+=S,this._wasm.decode(0,S)}}get data32(){if(this._mode===0||!this.width||!this.height)return _;let p=this._wasm.current_width();if(this._mode===2){let y=this.height-this._currentHeight;if(y>0){let w=this._PIXEL_OFFSET,b=this._lastOffset,S=0;for(;S<6&&y>0;)this._canvas.set(this._pSrc.subarray(w*S,w*S+p),b+p*S),S++,y--;y&&this._canvas.fill(this._fillColor,b+p*S)}return this._canvas.subarray(0,this.width*this.height)}if(this._mode===1){if(this._minWidth===this._maxWidth){let S=!1;if(p)if(p!==this._minWidth)S=!0;else{let A=this._PIXEL_OFFSET,C=this._lastOffset;this._realloc(C,6*p);for(let D=0;D<6;++D)this._canvas.set(this._pSrc.subarray(A*D,A*D+p),C+p*D)}if(!S)return this._canvas.subarray(0,this.width*this.height)}let y=new Uint32Array(this.width*this.height);y.fill(this._fillColor);let w=0,b=0;for(let S=0;S<this._bandWidths.length;++S){let A=this._bandWidths[S];for(let C=0;C<6;++C)y.set(this._canvas.subarray(b,b+=A),w),w+=this.width}if(p){let S=this._PIXEL_OFFSET,A=this._wasm.current_height();for(let C=0;C<A;++C)y.set(this._pSrc.subarray(S*C,S*C+p),w+this.width*C)}return y}return _}get data8(){return new Uint8ClampedArray(this.data32.buffer,0,this.width*this.height*4)}release(){this._canvas=_,this._bandWidths.length=0,this._maxWidth=0,this._minWidth=g.LIMITS.MAX_WIDTH,this._wasm.init(h.DEFAULT_FOREGROUND,0,this._opts.paletteLimit,0)}}t.Decoder=d,t.decode=function(f,p){let y=new d(p);return y.init(),typeof f=="string"?y.decodeString(f):y.decode(f),{width:y.width,height:y.height,data32:y.data32,data8:y.data8}},t.decodeAsync=async function(f,p){let y=await o(p);return y.init(),typeof f=="string"?y.decodeString(f):y.decode(f),{width:y.width,height:y.height,data32:y.data32,data8:y.data8}}},343:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LIMITS=void 0,t.LIMITS={CHUNK_SIZE:16384,PALETTE_SIZE:4096,MAX_WIDTH:16384,BYTES:"AGFzbQEAAAABJAdgAAF/YAJ/fwBgA39/fwF/YAF/AX9gAABgBH9/f38AYAF/AAIlAgNlbnYLaGFuZGxlX2JhbmQAAwNlbnYLbW9kZV9wYXJzZWQAAwMTEgQAAAAAAQQBAQUBAAACAgAGAwQFAXABBwcFBAEBBwcGCAF/AUGAihoLB9wBDgZtZW1vcnkCABFnZXRfc3RhdGVfYWRkcmVzcwADEWdldF9jaHVua19hZGRyZXNzAAQOZ2V0X3AwX2FkZHJlc3MABRNnZXRfcGFsZXR0ZV9hZGRyZXNzAAYEaW5pdAALBmRlY29kZQAMDWN1cnJlbnRfd2lkdGgADQ5jdXJyZW50X2hlaWdodAAOGV9faW5kaXJlY3RfZnVuY3Rpb25fdGFibGUBAAtfaW5pdGlhbGl6ZQACCXN0YWNrU2F2ZQARDHN0YWNrUmVzdG9yZQASCnN0YWNrQWxsb2MAEwkMAQBBAQsGCgcJDxACDAEBCq5UEgMAAQsFAEGgCAsGAEGQiQELBgBBsIkCCwUAQZAJC+okAQh/QeQIKAIAIQVB4AgoAgAhA0HoCCgCACEIIAFBkIkBaiIJQf8BOgAAIAAgAUgEQCAAQZCJAWohBgNAIAMhBCAGQQFqIQECQCAGLQAAQf8AcSIDQTBrQQlLBEAgASEGDAELQewIKAIAQQJ0QewIaiICKAIAIQADQCACIAMgAEEKbGpBMGsiADYCACABLQAAIQMgAUEBaiIGIQEgA0H/AHEiA0Ewa0EKSQ0ACwsCQAJAAkACQAJAAkACQAJ/AkACQCADQT9rIgBBP00EQCAERQ0BIARBIUYEQAJAQfAIKAIAIgFBASABGyIHIAhqIgFB1AgoAgAiA0gNACADQf//AEoNAANAIANBAnQiAkGgiQJqIgRBoAgpAwA3AwAgAkGoiQJqQaAIKQMANwMAIAJBsIkCakGgCCkDADcDACACQbiJAmpBoAgpAwA3AwAgAkHAiQJqQaAIKQMANwMAIAJByIkCakGgCCkDADcDACACQdCJAmpBoAgpAwA3AwAgAkHYiQJqQaAIKQMANwMAIAJB4IkCakGgCCkDADcDACACQeiJAmpBoAgpAwA3AwAgAkHwiQJqQaAIKQMANwMAIAJB+IkCakGgCCkDADcDACACQYCKAmpBoAgpAwA3AwAgAkGIigJqQaAIKQMANwMAIAJBkIoCakGgCCkDADcDACACQZiKAmpBoAgpAwA3AwAgAkGgigJqQaAIKQMANwMAIAJBqIoCakGgCCkDADcDACACQbCKAmpBoAgpAwA3AwAgAkG4igJqQaAIKQMANwMAIAJBwIoCakGgCCkDADcDACACQciKAmpBoAgpAwA3AwAgAkHQigJqQaAIKQMANwMAIAJB2IoCakGgCCkDADcDACACQeCKAmpBoAgpAwA3AwAgAkHoigJqQaAIKQMANwMAIAJB8IoCakGgCCkDADcDACACQfiKAmpBoAgpAwA3AwAgAkGAiwJqQaAIKQMANwMAIAJBiIsCakGgCCkDADcDACACQZCLAmpBoAgpAwA3AwAgAkGYiwJqQaAIKQMANwMAIAJBoIsCakGgCCkDADcDACACQaiLAmpBoAgpAwA3AwAgAkGwiwJqQaAIKQMANwMAIAJBuIsCakGgCCkDADcDACACQcCLAmpBoAgpAwA3AwAgAkHIiwJqQaAIKQMANwMAIAJB0IsCakGgCCkDADcDACACQdiLAmpBoAgpAwA3AwAgAkHgiwJqQaAIKQMANwMAIAJB6IsCakGgCCkDADcDACACQfCLAmpBoAgpAwA3AwAgAkH4iwJqQaAIKQMANwMAIAJBgIwCakGgCCkDADcDACACQYiMAmpBoAgpAwA3AwAgAkGQjAJqQaAIKQMANwMAIAJBmIwCakGgCCkDADcDACACQaCMAmpBoAgpAwA3AwAgAkGojAJqQaAIKQMANwMAIAJBsIwCakGgCCkDADcDACACQbiMAmpBoAgpAwA3AwAgAkHAjAJqQaAIKQMANwMAIAJByIwCakGgCCkDADcDACACQdCMAmpBoAgpAwA3AwAgAkHYjAJqQaAIKQMANwMAIAJB4IwCakGgCCkDADcDACACQeiMAmpBoAgpAwA3AwAgAkHwjAJqQaAIKQMANwMAIAJB+IwCakGgCCkDADcDACACQYCNAmpBoAgpAwA3AwAgAkGIjQJqQaAIKQMANwMAIAJBkI0CakGgCCkDADcDACACQZiNAmpBoAgpAwA3AwAgAkGwiQZqIARBgAT8CgAAQdQIKAIAQQJ0QcCJCmogBEGABPwKAABB1AgoAgBBAnRB0IkOaiAEQYAE/AoAAEHUCCgCAEECdEHgiRJqIARBgAT8CgAAQdQIKAIAQQJ0QfCJFmogBEGABPwKAABB1AhB1AgoAgAiAkGAAWoiAzYCACABIANIDQEgAkGA/wBIDQALCwJAIABFDQAgCEH//wBLDQBBgIABIAhrIAcgAUH//wBLGyECAkAgAEEBcUUNACACRQ0AIAhBAnRBoIkCaiEDIAIhBCACQQdxIgcEQANAIAMgBTYCACADQQRqIQMgBEEBayEEIAdBAWsiBw0ACwsgAkEBa0EHSQ0AA0AgAyAFNgIcIAMgBTYCGCADIAU2AhQgAyAFNgIQIAMgBTYCDCADIAU2AgggAyAFNgIEIAMgBTYCACADQSBqIQMgBEEIayIEDQALCwJAIABBAnFFDQAgAkUNACAIQQJ0QbCJBmohAyACIQQgAkEHcSIHBEADQCADIAU2AgAgA0EEaiEDIARBAWshBCAHQQFrIgcNAAsLIAJBAWtBB0kNAANAIAMgBTYCHCADIAU2AhggAyAFNgIUIAMgBTYCECADIAU2AgwgAyAFNgIIIAMgBTYCBCADIAU2AgAgA0EgaiEDIARBCGsiBA0ACwsCQCAAQQRxRQ0AIAJFDQAgCEECdEHAiQpqIQMgAiEEIAJBB3EiBwRAA0AgAyAFNgIAIANBBGohAyAEQQFrIQQgB0EBayIHDQALCyACQQFrQQdJDQADQCADIAU2AhwgAyAFNgIYIAMgBTYCFCADIAU2AhAgAyAFNgIMIAMgBTYCCCADIAU2AgQgAyAFNgIAIANBIGohAyAEQQhrIgQNAAsLAkAgAEEIcUUNACACRQ0AIAhBAnRB0IkOaiEDIAIhBCACQQdxIgcEQANAIAMgBTYCACADQQRqIQMgBEEBayEEIAdBAWsiBw0ACwsgAkEBa0EHSQ0AA0AgAyAFNgIcIAMgBTYCGCADIAU2AhQgAyAFNgIQIAMgBTYCDCADIAU2AgggAyAFNgIEIAMgBTYCACADQSBqIQMgBEEIayIEDQALCwJAIABBEHFFDQAgAkUNACAIQQJ0QeCJEmohAyACIQQgAkEHcSIHBEADQCADIAU2AgAgA0EEaiEDIARBAWshBCAHQQFrIgcNAAsLIAJBAWtBB0kNAANAIAMgBTYCHCADIAU2AhggAyAFNgIUIAMgBTYCECADIAU2AgwgAyAFNgIIIAMgBTYCBCADIAU2AgAgA0EgaiEDIARBCGsiBA0ACwsgAEEgcUUNACACRQ0AIAJBAWshByAIQQJ0QfCJFmohAyACQQdxIgQEQANAIAMgBTYCACADQQRqIQMgAkEBayECIARBAWsiBA0ACwsgB0EHSQ0AA0AgAyAFNgIcIAMgBTYCGCADIAU2AhQgAyAFNgIQIAMgBTYCDCADIAU2AgggAyAFNgIEIAMgBTYCACADQSBqIQMgAkEIayICDQALC0HcCEHcCCgCACAAcjYCACAGQQFqIgIgBi0AAEH/AHEiA0E/ayIAQT9LDQQaDAMLAkBB7AgoAgAiBEEBRgRAQfAIKAIAIgNBzAgoAgAiAUkNASADIAFwIQMMAQtB+AgoAgAhAkH0CCgCACEBAkACQCAEQQVHDQAgAUEBRw0AIAJB6QJODQQMAQsgAkHkAEoNA0H8CCgCAEHkAEoNA0GACSgCAEHkAEoNAwsCQCABRQ0AIAFBAkoNACACQfwIKAIAQYAJKAIAIAFBAnRBiAhqKAIAEQIAIQFB8AgoAgAiA0HMCCgCACICTwR/IAMgAnAFIAMLQQJ0QZAJaiABNgIAC0HwCCgCACIDQcwIKAIAIgFJDQAgAyABcCEDCyADQQJ0QZAJaigCACEFDAELIANB/QBxQSFHBEAgCCEBIAYhAgwECyAEQSNHDQQCQEHsCCgCACICQQFGBEBB8AgoAgAiAUHMCCgCACIASQ0BIAEgAHAhAQwBC0H4CCgCACEBQfQIKAIAIQACQAJAIAJBBUcNACAAQQFHDQAgAUHpAkgNAQwHCyABQeQASg0GQfwIKAIAQeQASg0GQYAJKAIAQeQASg0GCwJAIABFDQAgAEECSg0AIAFB/AgoAgBBgAkoAgAgAEECdEGICGooAgARAgAhAEHwCCgCACIBQcwIKAIAIgJPBH8gASACcAUgAQtBAnRBkAlqIAA2AgALQfAIKAIAIgFBzAgoAgAiAEkNACABIABwIQELIAFBAnRBkAlqKAIAIQUMBAsgCCEBIAYhAgtB1AgoAgAhBgNAAkAgASAGSA0AIAZB//8ASg0AIAZBAnQiBEGgiQJqIgZBoAgpAwA3AwAgBEGoiQJqQaAIKQMANwMAIARBsIkCakGgCCkDADcDACAEQbiJAmpBoAgpAwA3AwAgBEHAiQJqQaAIKQMANwMAIARByIkCakGgCCkDADcDACAEQdCJAmpBoAgpAwA3AwAgBEHYiQJqQaAIKQMANwMAIARB4IkCakGgCCkDADcDACAEQeiJAmpBoAgpAwA3AwAgBEHwiQJqQaAIKQMANwMAIARB+IkCakGgCCkDADcDACAEQYCKAmpBoAgpAwA3AwAgBEGIigJqQaAIKQMANwMAIARBkIoCakGgCCkDADcDACAEQZiKAmpBoAgpAwA3AwAgBEGgigJqQaAIKQMANwMAIARBqIoCakGgCCkDADcDACAEQbCKAmpBoAgpAwA3AwAgBEG4igJqQaAIKQMANwMAIARBwIoCakGgCCkDADcDACAEQciKAmpBoAgpAwA3AwAgBEHQigJqQaAIKQMANwMAIARB2IoCakGgCCkDADcDACAEQeCKAmpBoAgpAwA3AwAgBEHoigJqQaAIKQMANwMAIARB8IoCakGgCCkDADcDACAEQfiKAmpBoAgpAwA3AwAgBEGAiwJqQaAIKQMANwMAIARBiIsCakGgCCkDADcDACAEQZCLAmpBoAgpAwA3AwAgBEGYiwJqQaAIKQMANwMAIARBoIsCakGgCCkDADcDACAEQaiLAmpBoAgpAwA3AwAgBEGwiwJqQaAIKQMANwMAIARBuIsCakGgCCkDADcDACAEQcCLAmpBoAgpAwA3AwAgBEHIiwJqQaAIKQMANwMAIARB0IsCakGgCCkDADcDACAEQdiLAmpBoAgpAwA3AwAgBEHgiwJqQaAIKQMANwMAIARB6IsCakGgCCkDADcDACAEQfCLAmpBoAgpAwA3AwAgBEH4iwJqQaAIKQMANwMAIARBgIwCakGgCCkDADcDACAEQYiMAmpBoAgpAwA3AwAgBEGQjAJqQaAIKQMANwMAIARBmIwCakGgCCkDADcDACAEQaCMAmpBoAgpAwA3AwAgBEGojAJqQaAIKQMANwMAIARBsIwCakGgCCkDADcDACAEQbiMAmpBoAgpAwA3AwAgBEHAjAJqQaAIKQMANwMAIARByIwCakGgCCkDADcDACAEQdCMAmpBoAgpAwA3AwAgBEHYjAJqQaAIKQMANwMAIARB4IwCakGgCCkDADcDACAEQeiMAmpBoAgpAwA3AwAgBEHwjAJqQaAIKQMANwMAIARB+IwCakGgCCkDADcDACAEQYCNAmpBoAgpAwA3AwAgBEGIjQJqQaAIKQMANwMAIARBkI0CakGgCCkDADcDACAEQZiNAmpBoAgpAwA3AwAgBEGwiQZqIAZBgAT8CgAAQdQIKAIAQQJ0QcCJCmogBkGABPwKAABB1AgoAgBBAnRB0IkOaiAGQYAE/AoAAEHUCCgCAEECdEHgiRJqIAZBgAT8CgAAQdQIKAIAQQJ0QfCJFmogBkGABPwKAABB1AhB1AgoAgBBgAFqIgY2AgALIAFB//8ATQRAIABBAXEgAWxBAnRBoIkCaiAFNgIAIABBAXZBAXEgAWxBAnRBsIkGaiAFNgIAIABBAnZBAXEgAWxBAnRBwIkKaiAFNgIAIABBA3ZBAXEgAWxBAnRB0IkOaiAFNgIAIABBBHZBAXEgAWxBAnRB4IkSaiAFNgIAIABBBXYgAWxBAnRB8IkWaiAFNgIAQdQIKAIAIQYLIAFBAWohAUHcCEHcCCgCACAAcjYCACACLQAAIQAgAkEBaiIEIQIgAEH/AHEiA0E/ayIAQcAASQ0ACyAECyECQQAhBCACIQYgASEIIANB/QBxQSFGDQELIANBJGsOCgEDAwMDAwMDAwIDC0HsCEIBNwIADAQLQdgIIAFB2AgoAgAiACAAIAFIGyIAQYCAASAAQYCAAUgbNgIADAILQegIIAFB2AgoAgAiACAAIAFIGyIAQYCAASAAQYCAAUgbIgA2AgBB2AggADYCACAAQQRrEAAEQEHoCEEENgIAQdgIQQQ2AgBB0AhBATYCAA8LEAgMAQsCQCADQTtHDQBB7AgoAgAiAEEHSg0AQewIIABBAWo2AgAgAEECdEHwCGpBADYCAAsgAiEGIAQhAyABIQgMAQtBBCEIIAIhBiAEIQMLIAYgCUkNAAsLQeQIIAU2AgBB4AggAzYCAEHoCCAINgIAC9ELAgF+CH9B2AhCBDcDAEGojQJBoAgpAwAiADcDAEGgjQIgADcDAEGYjQIgADcDAEGQjQIgADcDAEGIjQIgADcDAEGAjQIgADcDAEH4jAIgADcDAEHwjAIgADcDAEHojAIgADcDAEHgjAIgADcDAEHYjAIgADcDAEHQjAIgADcDAEHIjAIgADcDAEHAjAIgADcDAEG4jAIgADcDAEGwjAIgADcDAEGojAIgADcDAEGgjAIgADcDAEGYjAIgADcDAEGQjAIgADcDAEGIjAIgADcDAEGAjAIgADcDAEH4iwIgADcDAEHwiwIgADcDAEHoiwIgADcDAEHgiwIgADcDAEHYiwIgADcDAEHQiwIgADcDAEHIiwIgADcDAEHAiwIgADcDAEG4iwIgADcDAEGwiwIgADcDAEGoiwIgADcDAEGgiwIgADcDAEGYiwIgADcDAEGQiwIgADcDAEGIiwIgADcDAEGAiwIgADcDAEH4igIgADcDAEHwigIgADcDAEHoigIgADcDAEHgigIgADcDAEHYigIgADcDAEHQigIgADcDAEHIigIgADcDAEHAigIgADcDAEG4igIgADcDAEGwigIgADcDAEGoigIgADcDAEGgigIgADcDAEGYigIgADcDAEGQigIgADcDAEGIigIgADcDAEGAigIgADcDAEH4iQIgADcDAEHwiQIgADcDAEHoiQIgADcDAEHgiQIgADcDAEHYiQIgADcDAEHQiQIgADcDAEHIiQIgADcDAEHAiQIgADcDAEG4iQIgADcDAEGwiQIgADcDAEGoCCgCACIEQf8AakGAAW0hCAJAIARBgQFIDQBBASEBIAhBAiAIQQJKG0EBayICQQFxIQMgBEGBAk4EQCACQX5xIQIDQCABQQl0IgdBEHJBoIkCakGwiQJBgAT8CgAAIAdBsI0CakGwiQJBgAT8CgAAIAFBAmohASACQQJrIgINAAsLIANFDQAgAUEJdEEQckGgiQJqQbCJAkGABPwKAAALAkAgBEEBSA0AIAhBASAIQQFKGyIDQQFxIQUCQCADQQFrIgdFBEBBACEBDAELIANB/v///wdxIQJBACEBA0AgAUEJdCIGQRByQbCJBmpBsIkCQYAE/AoAACAGQZAEckGwiQZqQbCJAkGABPwKAAAgAUECaiEBIAJBAmsiAg0ACwsgBQRAIAFBCXRBEHJBsIkGakGwiQJBgAT8CgAACyAEQQFIDQAgA0EBcSEFIAcEfyADQf7///8HcSECQQAhAQNAIAFBCXQiBkEQckHAiQpqQbCJAkGABPwKAAAgBkGQBHJBwIkKakGwiQJBgAT8CgAAIAFBAmohASACQQJrIgINAAsgAUEHdEEEcgVBBAshASAFBEAgAUECdEHAiQpqQbCJAkGABPwKAAALIARBAUgNACADQQFxIQUgBwR/IANB/v///wdxIQJBACEBA0AgAUEJdCIGQRByQdCJDmpBsIkCQYAE/AoAACAGQZAEckHQiQ5qQbCJAkGABPwKAAAgAUECaiEBIAJBAmsiAg0ACyABQQd0QQRyBUEECyEBIAUEQCABQQJ0QdCJDmpBsIkCQYAE/AoAAAsgBEEBSA0AIANBAXEhBSAHBH8gA0H+////B3EhAkEAIQEDQCABQQl0IgZBEHJB4IkSakGwiQJBgAT8CgAAIAZBkARyQeCJEmpBsIkCQYAE/AoAACABQQJqIQEgAkECayICDQALIAFBB3RBBHIFQQQLIQEgBQRAIAFBAnRB4IkSakGwiQJBgAT8CgAACyAEQQFIDQAgA0EBcSEEIAcEfyADQf7///8HcSECQQAhAQNAIAFBCXQiA0EQckHwiRZqQbCJAkGABPwKAAAgA0GQBHJB8IkWakGwiQJBgAT8CgAAIAFBAmohASACQQJrIgINAAsgAUEHdEEEcgVBBAshASAERQ0AIAFBAnRB8IkWakGwiQJBgAT8CgAAC0HUCCAIQQd0QQRyNgIAC58TAgh/AX5B5AgoAgAhA0HgCCgCACECQegIKAIAIQcgAUGQiQFqIglB/wE6AAAgACABSARAIABBkIkBaiEIA0AgAiEEIAhBAWohAQJAIAgtAABB/wBxIgJBMGtBCUsEQCABIQgMAQtB7AgoAgBBAnRB7AhqIgUoAgAhAANAIAUgAiAAQQpsakEwayIANgIAIAEtAAAhAiABQQFqIgghASACQf8AcSICQTBrQQpJDQALCwJAAkACQAJAAkACQAJ/AkAgAkE/ayIAQT9NBEAgBEUNASAEQSFGBEBB8AgoAgAiAUEBIAEbIgQgB2ohAQJAIABFDQAgB0H//wBLDQBBgIABIAdrIAQgAUH//wBLGyEFAkAgAEEBcUUNACAHQQJ0QaCJAmohAiAFIgRBB3EiBgRAA0AgAiADNgIAIAJBBGohAiAEQQFrIQQgBkEBayIGDQALCyAFQQFrQQdJDQADQCACIAM2AhwgAiADNgIYIAIgAzYCFCACIAM2AhAgAiADNgIMIAIgAzYCCCACIAM2AgQgAiADNgIAIAJBIGohAiAEQQhrIgQNAAsLAkAgAEECcUUNACAHQQJ0QbCJBmohAiAFIgRBB3EiBgRAA0AgAiADNgIAIAJBBGohAiAEQQFrIQQgBkEBayIGDQALCyAFQQFrQQdJDQADQCACIAM2AhwgAiADNgIYIAIgAzYCFCACIAM2AhAgAiADNgIMIAIgAzYCCCACIAM2AgQgAiADNgIAIAJBIGohAiAEQQhrIgQNAAsLAkAgAEEEcUUNACAHQQJ0QcCJCmohAiAFIgRBB3EiBgRAA0AgAiADNgIAIAJBBGohAiAEQQFrIQQgBkEBayIGDQALCyAFQQFrQQdJDQADQCACIAM2AhwgAiADNgIYIAIgAzYCFCACIAM2AhAgAiADNgIMIAIgAzYCCCACIAM2AgQgAiADNgIAIAJBIGohAiAEQQhrIgQNAAsLAkAgAEEIcUUNACAHQQJ0QdCJDmohAiAFIgRBB3EiBgRAA0AgAiADNgIAIAJBBGohAiAEQQFrIQQgBkEBayIGDQALCyAFQQFrQQdJDQADQCACIAM2AhwgAiADNgIYIAIgAzYCFCACIAM2AhAgAiADNgIMIAIgAzYCCCACIAM2AgQgAiADNgIAIAJBIGohAiAEQQhrIgQNAAsLAkAgAEEQcUUNACAHQQJ0QeCJEmohAiAFIgRBB3EiBgRAA0AgAiADNgIAIAJBBGohAiAEQQFrIQQgBkEBayIGDQALCyAFQQFrQQdJDQADQCACIAM2AhwgAiADNgIYIAIgAzYCFCACIAM2AhAgAiADNgIMIAIgAzYCCCACIAM2AgQgAiADNgIAIAJBIGohAiAEQQhrIgQNAAsLIABBIHFFDQAgBUEBayEEIAdBAnRB8IkWaiEAIAVBB3EiAgRAA0AgACADNgIAIABBBGohACAFQQFrIQUgAkEBayICDQALCyAEQQdJDQADQCAAIAM2AhwgACADNgIYIAAgAzYCFCAAIAM2AhAgACADNgIMIAAgAzYCCCAAIAM2AgQgACADNgIAIABBIGohACAFQQhrIgUNAAsLIAhBAWoiBSAILQAAQf8AcSICQT9rIgBBP00NAxoMBAsCQEHsCCgCACIFQQFGBEBB8AgoAgAiAUHMCCgCACIESQ0BIAEgBHAhAQwBC0H4CCgCACEEQfQIKAIAIQECQAJAIAVBBUcNACABQQFHDQAgBEHpAk4NBAwBCyAEQeQASg0DQfwIKAIAQeQASg0DQYAJKAIAQeQASg0DCwJAIAFFDQAgAUECSg0AIARB/AgoAgBBgAkoAgAgAUECdEGICGooAgARAgAhBEHwCCgCACIBQcwIKAIAIgVPBH8gASAFcAUgAQtBAnRBkAlqIAQ2AgALQfAIKAIAIgFBzAgoAgAiBEkNACABIARwIQELIAFBAnRBkAlqKAIAIQMMAQsgAkH9AHFBIUcEQCAHIQEgAiEADAQLIARBI0cNBAJAQewIKAIAIgRBAUYEQEHwCCgCACIBQcwIKAIAIgBJDQEgASAAcCEBDAELQfgIKAIAIQFB9AgoAgAhAAJAAkAgBEEFRw0AIABBAUcNACABQekCSA0BDAcLIAFB5ABKDQZB/AgoAgBB5ABKDQZBgAkoAgBB5ABKDQYLAkAgAEUNACAAQQJKDQAgAUH8CCgCAEGACSgCACAAQQJ0QYgIaigCABECACEAQfAIKAIAIgFBzAgoAgAiBE8EfyABIARwBSABC0ECdEGQCWogADYCAAtB8AgoAgAiAUHMCCgCACIASQ0AIAEgAHAhAQsgAUECdEGQCWooAgAhAwwECyAHIQEgCAshBQNAIAFB//8ATQRAIABBAXEgAWxBAnRBoIkCaiADNgIAIABBAXZBAXEgAWxBAnRBsIkGaiADNgIAIABBAnZBAXEgAWxBAnRBwIkKaiADNgIAIABBA3ZBAXEgAWxBAnRB0IkOaiADNgIAIABBBHZBAXEgAWxBAnRB4IkSaiADNgIAIABBBXYgAWxBAnRB8IkWaiADNgIACyABQQFqIQEgBS0AACEAIAVBAWoiBCEFIABB/wBxIgJBP2siAEHAAEkNAAsgBCEFC0EAIQQgBSEIIAEhByACIQAgAkH9AHFBIUYNAQtBBCEHIAQhAiAAQSRrDgoDAgICAgICAgIBAgtB7AhCATcCAAwCC0GoCCgCAEEEaxAABEBB0AhBATYCAA8LAkBBqAgoAgAiBkEFSA0AQaAIKQMAIQogBkEDa0EBdiIBQQdxIQJBACEAIAFBAWtBB08EQCABQfj///8HcSEFA0AgAEEDdCIBQbCJAmogCjcDACABQQhyQbCJAmogCjcDACABQRByQbCJAmogCjcDACABQRhyQbCJAmogCjcDACABQSByQbCJAmogCjcDACABQShyQbCJAmogCjcDACABQTByQbCJAmogCjcDACABQThyQbCJAmogCjcDACAAQQhqIQAgBUEIayIFDQALCyACRQ0AA0AgAEEDdEGwiQJqIAo3AwAgAEEBaiEAIAJBAWsiAg0ACwtBwIkGQbCJAiAGQQJ0IgD8CgAAQdCJCkGwiQIgAPwKAABB4IkOQbCJAiAA/AoAAEHwiRJBsIkCIAD8CgAAQYCKFkGwiQIgAPwKAAAgBCECDAELAkAgAEE7Rw0AQewIKAIAIgBBB0oNAEHsCCAAQQFqNgIAIABBAnRB8AhqQQA2AgALIAEhBwsgCCAJSQ0ACwtB5AggAzYCAEHgCCACNgIAQegIIAc2AgAL4gcCBX8BfgJAQdAIAn8CQAJAIAAgAU4NACABQZCJAWohBiAAQZCJAWohBQNAIAUtAAAiA0H/AHEhAgJAAkACQAJAAkACQAJAQeAIKAIAIgRBIkcEQCAEDQcgAkEiRgRAQewIQgE3AgBB4AhBIjYCAAwICyACQT9rQcAASQ0GIANBIWsiAkEMTQ0BDAULAkAgAkEwayIEQQlNBEBB7AgoAgBBAnRB7AhqIgIgBCACKAIAQQpsajYCAAwBC0HsCCgCACEEIAJBO0YEQCAEQQdKDQFB7AggBEEBajYCACAEQQJ0QfAIakEANgIADAELIARBBEYEQEHECEECNgIAQbAIQfAIKQMANwMAQbgIQfgIKAIAIgI2AgBBvAhB/AgoAgAiBDYCAEHICEECQQFBwAgoAgAiAxs2AgBBrAggBEEAIAMbNgIAQagIIAJBgIABIAJBgIABSBtBBGpBACADGzYCAEHgCEEANgIADAoLIAJBP2tBwABJDQQLIANBIWsiAkEMTQ0BDAILQQEgAnRBjSBxRQ0DDAQLQQEgAnRBjSBxDQELIANBoQFrIgJBDEsNA0EBIAJ0QY0gcUUNAwtBxAhCgYCAgBA3AgBBsAhB8AgoAgBBAEHsCCgCACICQQBKGzYCAEG0CEH0CCgCAEEAIAJBAUobNgIAQbgIQfgIKAIAQQAgAkECShs2AgBB4AhBADYCAEG8CEEANgIADAQLIANBoQFrIgJBDEsNAUEBIAJ0QY0gcUUNAQtBxAhCgYCAgBA3AgBBsAhCADcDAEG4CEIANwMADAMLIAVBAWoiBSAGSQ0ACwsCQEHICCgCAA4DAwEAAQsCQEGoCCgCACIFQQVIDQBBoAgpAwAhByAFQQNrQQF2IgNBB3EhBEEAIQIgA0EBa0EHTwRAIANB+P///wdxIQYDQCACQQN0IgNBsIkCaiAHNwMAIANBCHJBsIkCaiAHNwMAIANBEHJBsIkCaiAHNwMAIANBGHJBsIkCaiAHNwMAIANBIHJBsIkCaiAHNwMAIANBKHJBsIkCaiAHNwMAIANBMHJBsIkCaiAHNwMAIANBOHJBsIkCaiAHNwMAIAJBCGohAiAGQQhrIgYNAAsLIARFDQADQCACQQN0QbCJAmogBzcDACACQQFqIQIgBEEBayIEDQALC0HAiQZBsIkCIAVBAnQiA/wKAABB0IkKQbCJAiAD/AoAAEHgiQ5BsIkCIAP8CgAAQfCJEkGwiQIgA/wKAABBgIoWQbCJAiAD/AoAAEECDAELEAhByAgoAgALEAEiAjYCACACDQAgACABQcgIKAIAQQJ0QYAIaigCABEBAAsLdABB6AhBBDYCAEHkCCAANgIAQewIQgE3AgBBxAhCADcCAEHACCADNgIAQdwIQgA3AgBBqAhCADcDAEGwCEIANwMAQbgIQgA3AwBBzAggAkGAICACQYAgSRs2AgBBoAggAa1CgYCAgBB+NwMAQdAIQQA2AgALIwBB0AgoAgBFBEAgACABQcgIKAIAQQJ0QYAIaigCABEBAAsLWgECfwJAAkACQEHICCgCAEEBaw4CAAECC0HYCEHoCCgCACIAQdgIKAIAIgEgACABShsiAEGAgAEgAEGAgAFIGyIANgIAIABBBGsPC0GoCCgCAEEEayEACyAAC0IBAX8Cf0EGQdwIKAIAIgBBIHENABpBBSAAQRBxDQAaQQQgAEEIcQ0AGkEDIABBBHENABpBAiAAQQFxIABBAnEbCwu9BQEFfQJ/IAJFBEAgAUH/AWxBMmpB5ABtIgBBCHQgAHIgAEEQdHIMAQsgArJDAADIQpUhBiAAQfABarJDAAC0Q5UhBQJ9IAGyQwAAyEKVIgNDAAAAP10EQCADIAZDAACAP5KUDAELIAYgA0MAAIA/IAaTlJILIQcgAyADkiEGAkAgBUOrqqo+kiIEQwAAAABdBEAgBEMAAIA/kiEEDAELIARDAACAP15FDQAgBEMAAIC/kiEECyAGIAeTIQMgBUMAAAAAXSEAAn8CfSADIAcgA5NDAADAQJQgBJSSIARDq6oqPl0NABogByAEQwAAAD9dDQAaIAMgBEOrqio/XUUNABogAyAHIAOTIARDAADAwJRDAACAQJKUkgtDAAB/Q5RDAAAAP5IiBkMAAIBPXSAGQwAAAABgcQRAIAapDAELQQALIQECQCAABEAgBUMAAIA/kiEEDAELIAUiBEMAAIA/XkUNACAFQwAAgL+SIQQLIAVDq6qqvpIiBUMAAAAAXSECAn8CfSADIAcgA5NDAADAQJQgBJSSIARDq6oqPl0NABogByAEQwAAAD9dDQAaIAMgBEOrqio/XUUNABogAyAHIAOTIARDAADAwJRDAACAQJKUkgtDAAB/Q5RDAAAAP5IiBkMAAIBPXSAGQwAAAABgcQRAIAapDAELQQALIQACQCACBEAgBUMAAIA/kiEFDAELIAVDAACAP15FDQAgBUMAAIC/kiEFCwJAIAVDq6oqPl0EQCADIAcgA5NDAADAQJQgBZSSIQcMAQsgBUMAAAA/XQ0AIAVDq6oqP11FBEAgAyEHDAELIAMgByADkyAFQwAAwMCUQwAAgECSlJIhBwsgAEEIdAJ/IAdDAAB/Q5RDAAAAP5IiBkMAAIBPXSAGQwAAAABgcQRAIAapDAELQQALQRB0ciABcgtBgICAeHILNwAgAEH/AWxBMmpB5ABtIAFB/wFsQTJqQeQAbUEIdHIgAkH/AWxBMmpB5ABtQRB0ckGAgIB4cgsEACMACwYAIAAkAAsQACMAIABrQXBxIgAkACAACwsYAQBBgAgLEQEAAAACAAAAAwAAAAQAAAAF"}},280:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});let h=(0,n(615).InWasm)({s:1,t:0,d:"AGFzbQEAAAABBQFgAAF/Ag8BA2VudgZtZW1vcnkCAAEDAwIAAAcNAgNkZWMAAANlbmQAAQqxAwKuAQEFf0GIKCgCAEGgKGohAUGEKCgCACIAQYAoKAIAQQFrQXxxIgJIBEAgAkGgKGohAyAAQaAoaiEAA0AgAC0AA0ECdCgCgCAgAC0AAkECdCgCgBggAC0AAUECdCgCgBAgAC0AAEECdCgCgAhycnIiBEH///8HSwRAQQEPCyABIAQ2AgAgAUEDaiEBIABBBGoiACADSQ0ACwtBhCggAjYCAEGIKCABQaAoazYCAEEAC/4BAQZ/AkBBgCgoAgAiAUGEKCgCACIAa0EFTgRAQQEhAxAADQFBgCgoAgAhAUGEKCgCACEAC0EBIQMgASAAayIEQQJIDQAgAEGhKGotAABBAnQoAoAQIABBoChqLQAAQQJ0KAKACHIhAQJAIARBAkYEQEEBIQIMAQtBASECIAAtAKIoIgVBPUcEQEECIQIgBUECdCgCgBggAXIhAQsgBEEERw0AIAAtAKMoIgBBPUYNACACQQFqIQIgAEECdCgCgCAgAXIhAQsgAUH///8HSw0AQYgoKAIAQaAoaiABNgIAQYgoQYgoKAIAIAJqIgA2AgAgAEGQKCgCAEchAwsgAwsAdglwcm9kdWNlcnMBDHByb2Nlc3NlZC1ieQEFY2xhbmdWMTguMC4wIChodHRwczovL2dpdGh1Yi5jb20vbGx2bS9sbHZtLXByb2plY3QgZDFlNjg1ZGY0NWRjNTk0NGI0M2QyNTQ3ZDAxMzhjZDRhM2VlNGVmZSkALA90YXJnZXRfZmVhdHVyZXMCKw9tdXRhYmxlLWdsb2JhbHMrCHNpZ24tZXh0"}),g=new Uint8Array("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("").map(_=>_.charCodeAt(0))),a=new Uint32Array(1024);a.fill(4278190080);for(let _=0;_<g.length;++_)a[g[_]]=_<<2;for(let _=0;_<g.length;++_)a[256+g[_]]=_>>4|(_<<4&255)<<8;for(let _=0;_<g.length;++_)a[512+g[_]]=_>>2<<8|(_<<6&255)<<16;for(let _=0;_<g.length;++_)a[768+g[_]]=_<<16;let l=new Uint8Array(0);t.default=class{constructor(_){this.keepSize=_}get data8(){return this._inst?this._d.subarray(0,this._m32[1282]):l}release(){this._inst&&(this._mem.buffer.byteLength>this.keepSize?this._inst=this._m32=this._d=this._mem=null:(this._m32[1280]=0,this._m32[1281]=0,this._m32[1282]=0))}init(_){let v=this._m32,u=4*(Math.ceil(_/3)+1288);this._inst?this._mem.buffer.byteLength<u&&(this._mem.grow(Math.ceil((u-this._mem.buffer.byteLength)/65536)),v=new Uint32Array(this._mem.buffer,0),this._d=new Uint8Array(this._mem.buffer,5152)):(this._mem=new WebAssembly.Memory({initial:Math.ceil(u/65536)}),this._inst=h({env:{memory:this._mem}}),v=new Uint32Array(this._mem.buffer,0),v.set(a,256),this._d=new Uint8Array(this._mem.buffer,5152)),v[1284]=_,v[1283]=4*Math.ceil(_/3),v[1280]=0,v[1281]=0,v[1282]=0,this._m32=v}put(_,v,u){if(!this._inst)return 1;let o=this._m32;return u-v+o[1280]>o[1283]?1:(this._d.set(_.subarray(v,u),o[1280]),o[1280]+=u-v,o[1280]-o[1281]>=131072?this._inst.exports.dec():0)}end(){return this._inst?this._inst.exports.end():1}}},125:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IIPHandler=void 0;let h=n(782),g=n(216),a=n(280),l=n(769),_=n(326),v={name:"Unnamed file",size:0,width:"auto",height:"auto",preserveAspectRatio:1,inline:0};t.IIPHandler=class{constructor(u,o,d,f){this._opts=u,this._renderer=o,this._storage=d,this._coreTerminal=f,this._aborted=!1,this._hp=new l.HeaderParser,this._header=v,this._dec=new a.default(4194304),this._metrics=_.UNSUPPORTED_TYPE}reset(){}start(){this._aborted=!1,this._header=v,this._metrics=_.UNSUPPORTED_TYPE,this._hp.reset()}put(u,o,d){if(!this._aborted)if(this._hp.state===4)this._dec.put(u,o,d)&&(this._dec.release(),this._aborted=!0);else{let f=this._hp.parse(u,o,d);if(f===-1)return void(this._aborted=!0);if(f>0){if(this._header=Object.assign({},v,this._hp.fields),!this._header.inline||!this._header.size||this._header.size>this._opts.iipSizeLimit)return void(this._aborted=!0);this._dec.init(this._header.size),this._dec.put(u,f,d)&&(this._dec.release(),this._aborted=!0)}}}end(u){if(this._aborted)return!0;let o=0,d=0,f=!0;if((f=u)&&(f=!this._dec.end())&&(this._metrics=(0,_.imageType)(this._dec.data8),(f=this._metrics.mime!=="unsupported")&&(o=this._metrics.width,d=this._metrics.height,(f=o&&d&&o*d<this._opts.pixelLimit)&&([o,d]=this._resize(o,d).map(Math.floor),f=o&&d&&o*d<this._opts.pixelLimit))),!f)return this._dec.release(),!0;let p=new Blob([this._dec.data8],{type:this._metrics.mime});if(this._dec.release(),!window.createImageBitmap){let y=URL.createObjectURL(p),w=new Image;return new Promise(b=>{w.addEventListener("load",()=>{var S;URL.revokeObjectURL(y);let A=h.ImageRenderer.createCanvas(window.document,o,d);(S=A.getContext("2d"))===null||S===void 0||S.drawImage(w,0,0,o,d),this._storage.addImage(A),b(!0)}),w.src=y,setTimeout(()=>b(!0),1e3)})}return createImageBitmap(p,{resizeWidth:o,resizeHeight:d}).then(y=>(this._storage.addImage(y),!0))}_resize(u,o){var d,f,p,y;let w=((d=this._renderer.dimensions)===null||d===void 0?void 0:d.css.cell.width)||g.CELL_SIZE_DEFAULT.width,b=((f=this._renderer.dimensions)===null||f===void 0?void 0:f.css.cell.height)||g.CELL_SIZE_DEFAULT.height,S=((p=this._renderer.dimensions)===null||p===void 0?void 0:p.css.canvas.width)||w*this._coreTerminal.cols,A=((y=this._renderer.dimensions)===null||y===void 0?void 0:y.css.canvas.height)||b*this._coreTerminal.rows,C=this._dim(this._header.width,S,w),D=this._dim(this._header.height,A,b);if(!C&&!D){let L=S/u,B=(A-b)/o,R=Math.min(L,B);return R<1?[u*R,o*R]:[u,o]}return C?!this._header.preserveAspectRatio&&C&&D?[C,D]:[C,o*C/u]:[u*D/o,D]}_dim(u,o,d){return u==="auto"?0:u.endsWith("%")?parseInt(u.slice(0,-1))*o/100:u.endsWith("px")?parseInt(u.slice(0,-2)):parseInt(u)*d}}},769:(c,t)=>{function n(v){let u="";for(let o=0;o<v.length;++o)u+=String.fromCharCode(v[o]);return u}function h(v){let u=0;for(let o=0;o<v.length;++o){if(v[o]<48||v[o]>57)throw new Error("illegal char");u=10*u+v[o]-48}return u}function g(v){let u=n(v);if(!u.match(/^((auto)|(\d+?((px)|(%)){0,1}))$/))throw new Error("illegal size");return u}Object.defineProperty(t,"__esModule",{value:!0}),t.HeaderParser=void 0;let a={inline:h,size:h,name:function(v){if(typeof Buffer<"u")return Buffer.from(n(v),"base64").toString();let u=atob(n(v)),o=new Uint8Array(u.length);for(let d=0;d<o.length;++d)o[d]=u.charCodeAt(d);return new TextDecoder().decode(o)},width:g,height:g,preserveAspectRatio:h},l=[70,105,108,101],_=1024;t.HeaderParser=class{constructor(){this.state=0,this._buffer=new Uint32Array(_),this._position=0,this._key="",this.fields={}}reset(){this._buffer.fill(0),this.state=0,this._position=0,this.fields={},this._key=""}parse(v,u,o){let d=this.state,f=this._position,p=this._buffer;if(d===1||d===4||d===0&&f>6)return-1;for(let y=u;y<o;++y){let w=v[y];switch(w){case 59:if(!this._storeValue(f))return this._a();d=2,f=0;break;case 61:if(d===0){for(let b=0;b<l.length;++b)if(p[b]!==l[b])return this._a();d=2,f=0}else if(d===2){if(!this._storeKey(f))return this._a();d=3,f=0}else if(d===3){if(f>=_)return this._a();p[f++]=w}break;case 58:return d!==3||this._storeValue(f)?(this.state=4,y+1):this._a();default:if(f>=_)return this._a();p[f++]=w}}return this.state=d,this._position=f,-2}_a(){return this.state=1,-1}_storeKey(v){let u=n(this._buffer.subarray(0,v));return!!u&&(this._key=u,this.fields[u]=null,!0)}_storeValue(v){if(this._key){try{let u=this._buffer.slice(0,v);this.fields[this._key]=a[this._key]?a[this._key](u):u}catch{return!1}return!0}return!1}}},326:(c,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.imageType=t.UNSUPPORTED_TYPE=void 0,t.UNSUPPORTED_TYPE={mime:"unsupported",width:0,height:0},t.imageType=function(n){if(n.length<24)return t.UNSUPPORTED_TYPE;let h=new Uint32Array(n.buffer,n.byteOffset,6);if(h[0]===1196314761&&h[1]===169478669&&h[3]===1380206665)return{mime:"image/png",width:n[16]<<24|n[17]<<16|n[18]<<8|n[19],height:n[20]<<24|n[21]<<16|n[22]<<8|n[23]};if((h[0]===3774863615||h[0]===3791640831)&&(n[6]===74&&n[7]===70&&n[8]===73&&n[9]===70||n[6]===69&&n[7]===120&&n[8]===105&&n[9]===102)){let[g,a]=function(l){let _=l.length,v=4,u=l[v]<<8|l[v+1];for(;;){if(v+=u,v>=_)return[0,0];if(l[v]!==255)return[0,0];if(l[v+1]===192||l[v+1]===194)return v+8<_?[l[v+7]<<8|l[v+8],l[v+5]<<8|l[v+6]]:[0,0];v+=2,u=l[v]<<8|l[v+1]}}(n);return{mime:"image/jpeg",width:g,height:a}}return h[0]!==944130375||n[4]!==55&&n[4]!==57||n[5]!==97?t.UNSUPPORTED_TYPE:{mime:"image/gif",width:n[7]<<8|n[6],height:n[9]<<8|n[8]}}},782:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ImageRenderer=void 0;let h=n(477),g=n(859);class a extends g.Disposable{static createCanvas(_,v,u){let o=(_||document).createElement("canvas");return o.width=0|v,o.height=0|u,o}static createImageData(_,v,u,o){if(typeof ImageData!="function"){let d=_.createImageData(v,u);return o&&d.data.set(new Uint8ClampedArray(o,0,v*u*4)),d}return o?new ImageData(new Uint8ClampedArray(o,0,v*u*4),v,u):new ImageData(v,u)}static createImageBitmap(_){return typeof createImageBitmap!="function"?Promise.resolve(void 0):createImageBitmap(_)}constructor(_){super(),this._terminal=_,this._optionsRefresh=this.register(new g.MutableDisposable),this._oldOpen=this._terminal._core.open,this._terminal._core.open=v=>{var u;(u=this._oldOpen)===null||u===void 0||u.call(this._terminal._core,v),this._open()},this._terminal._core.screenElement&&this._open(),this._optionsRefresh.value=this._terminal._core.optionsService.onOptionChange(v=>{var u;v==="fontSize"&&(this.rescaleCanvas(),(u=this._renderService)===null||u===void 0||u.refreshRows(0,this._terminal.rows))}),this.register((0,g.toDisposable)(()=>{var v;this.removeLayerFromDom(),this._terminal._core&&this._oldOpen&&(this._terminal._core.open=this._oldOpen,this._oldOpen=void 0),this._renderService&&this._oldSetRenderer&&(this._renderService.setRenderer=this._oldSetRenderer,this._oldSetRenderer=void 0),this._renderService=void 0,this.canvas=void 0,this._ctx=void 0,(v=this._placeholderBitmap)===null||v===void 0||v.close(),this._placeholderBitmap=void 0,this._placeholder=void 0}))}showPlaceholder(_){var v,u;_?this._placeholder||this.cellSize.height===-1||this._createPlaceHolder(Math.max(this.cellSize.height+1,24)):((v=this._placeholderBitmap)===null||v===void 0||v.close(),this._placeholderBitmap=void 0,this._placeholder=void 0),(u=this._renderService)===null||u===void 0||u.refreshRows(0,this._terminal.rows)}get dimensions(){var _;return(_=this._renderService)===null||_===void 0?void 0:_.dimensions}get cellSize(){var _,v;return{width:((_=this.dimensions)===null||_===void 0?void 0:_.css.cell.width)||-1,height:((v=this.dimensions)===null||v===void 0?void 0:v.css.cell.height)||-1}}clearLines(_,v){var u,o,d,f;(u=this._ctx)===null||u===void 0||u.clearRect(0,_*(((o=this.dimensions)===null||o===void 0?void 0:o.css.cell.height)||0),((d=this.dimensions)===null||d===void 0?void 0:d.css.canvas.width)||0,(++v-_)*(((f=this.dimensions)===null||f===void 0?void 0:f.css.cell.height)||0))}clearAll(){var _,v,u;(_=this._ctx)===null||_===void 0||_.clearRect(0,0,((v=this.canvas)===null||v===void 0?void 0:v.width)||0,((u=this.canvas)===null||u===void 0?void 0:u.height)||0)}draw(_,v,u,o,d=1){if(!this._ctx)return;let{width:f,height:p}=this.cellSize;if(f===-1||p===-1)return;this._rescaleImage(_,f,p);let y=_.actual,w=Math.ceil(y.width/f),b=v%w*f,S=Math.floor(v/w)*p,A=u*f,C=o*p,D=d*f+b>y.width?y.width-b:d*f,L=S+p>y.height?y.height-S:p;this._ctx.drawImage(y,Math.floor(b),Math.floor(S),Math.ceil(D),Math.ceil(L),Math.floor(A),Math.floor(C),Math.ceil(D),Math.ceil(L))}extractTile(_,v){let{width:u,height:o}=this.cellSize;if(u===-1||o===-1)return;this._rescaleImage(_,u,o);let d=_.actual,f=Math.ceil(d.width/u),p=v%f*u,y=Math.floor(v/f)*o,w=u+p>d.width?d.width-p:u,b=y+o>d.height?d.height-y:o,S=a.createCanvas(this.document,w,b),A=S.getContext("2d");return A?(A.drawImage(d,Math.floor(p),Math.floor(y),Math.floor(w),Math.floor(b),0,0,Math.floor(w),Math.floor(b)),S):void 0}drawPlaceholder(_,v,u=1){if(this._ctx){let{width:o,height:d}=this.cellSize;if(o===-1||d===-1||(this._placeholder?d>=this._placeholder.height&&this._createPlaceHolder(d+1):this._createPlaceHolder(Math.max(d+1,24)),!this._placeholder))return;this._ctx.drawImage(this._placeholderBitmap||this._placeholder,_*o,v*d%2?0:1,o*u,d,_*o,v*d,o*u,d)}}rescaleCanvas(){this.canvas&&(this.canvas.width===this.dimensions.css.canvas.width&&this.canvas.height===this.dimensions.css.canvas.height||(this.canvas.width=this.dimensions.css.canvas.width||0,this.canvas.height=this.dimensions.css.canvas.height||0))}_rescaleImage(_,v,u){if(v===_.actualCellSize.width&&u===_.actualCellSize.height)return;let{width:o,height:d}=_.origCellSize;if(v===o&&u===d)return _.actual=_.orig,_.actualCellSize.width=o,void(_.actualCellSize.height=d);let f=a.createCanvas(this.document,Math.ceil(_.orig.width*v/o),Math.ceil(_.orig.height*u/d)),p=f.getContext("2d");p&&(p.drawImage(_.orig,0,0,f.width,f.height),_.actual=f,_.actualCellSize.width=v,_.actualCellSize.height=u)}_open(){this._renderService=this._terminal._core._renderService,this._oldSetRenderer=this._renderService.setRenderer.bind(this._renderService),this._renderService.setRenderer=_=>{var v;this.removeLayerFromDom(),(v=this._oldSetRenderer)===null||v===void 0||v.call(this._renderService,_)}}insertLayerToDom(){var _,v;this.document&&this._terminal._core.screenElement?this.canvas||(this.canvas=a.createCanvas(this.document,((_=this.dimensions)===null||_===void 0?void 0:_.css.canvas.width)||0,((v=this.dimensions)===null||v===void 0?void 0:v.css.canvas.height)||0),this.canvas.classList.add("xterm-image-layer"),this._terminal._core.screenElement.appendChild(this.canvas),this._ctx=this.canvas.getContext("2d",{alpha:!0,desynchronized:!0}),this.clearAll()):console.warn("image addon: cannot insert output canvas to DOM, missing document or screenElement")}removeLayerFromDom(){this.canvas&&(this._ctx=void 0,this.canvas.remove(),this.canvas=void 0)}_createPlaceHolder(_=24){var v;(v=this._placeholderBitmap)===null||v===void 0||v.close(),this._placeholderBitmap=void 0;let u=32,o=a.createCanvas(this.document,u,_),d=o.getContext("2d",{alpha:!1});if(!d)return;let f=a.createImageData(d,u,_),p=new Uint32Array(f.data.buffer),y=(0,h.toRGBA8888)(0,0,0),w=(0,h.toRGBA8888)(255,255,255);p.fill(y);for(let A=0;A<_;++A){let C=A%2,D=A*u;for(let L=0;L<u;L+=2)p[D+L+C]=w}d.putImageData(f,0,0);let b=screen.width+u-1&-32||4096;this._placeholder=a.createCanvas(this.document,b,_);let S=this._placeholder.getContext("2d",{alpha:!1});if(S){for(let A=0;A<b;A+=u)S.drawImage(o,A,0);a.createImageBitmap(this._placeholder).then(A=>this._placeholderBitmap=A)}else this._placeholder=void 0}get document(){var _;return(_=this._terminal._core._coreBrowserService)===null||_===void 0?void 0:_.window.document}}t.ImageRenderer=a},216:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ImageStorage=t.CELL_SIZE_DEFAULT=void 0;let h=n(782);t.CELL_SIZE_DEFAULT={width:7,height:14};class g{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(_){this._ext=_}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(_){this._ext&=-469762049,this._ext|=_<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(_){this._ext&=-67108864,this._ext|=67108863&_}get underlineVariantOffset(){let _=(3758096384&this._ext)>>29;return _<0?4294967288^_:_}set underlineVariantOffset(_){this._ext&=536870911,this._ext|=_<<29&3758096384}get urlId(){return this._urlId}set urlId(_){this._urlId=_}constructor(_=0,v=0,u=-1,o=-1){this.imageId=u,this.tileId=o,this._ext=0,this._urlId=0,this._ext=_,this._urlId=v}clone(){return new g(this._ext,this._urlId,this.imageId,this.tileId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0&&this.imageId===-1}}let a=new g;t.ImageStorage=class{constructor(l,_,v){this._terminal=l,this._renderer=_,this._opts=v,this._images=new Map,this._lastId=0,this._lowestId=0,this._fullyCleared=!1,this._needsFullClear=!1,this._pixelLimit=25e5;try{this.setLimit(this._opts.storageLimit)}catch(u){console.error(u.message),console.warn(`storageLimit is set to ${this.getLimit()} MB`)}this._viewportMetrics={cols:this._terminal.cols,rows:this._terminal.rows}}dispose(){this.reset()}reset(){var l;for(let _ of this._images.values())(l=_.marker)===null||l===void 0||l.dispose();this._images.clear(),this._renderer.clearAll()}getLimit(){return 4*this._pixelLimit/1e6}setLimit(l){if(l<.5||l>1e3)throw RangeError("invalid storageLimit, should be at least 0.5 MB and not exceed 1G");this._pixelLimit=l/4*1e6>>>0,this._evictOldest(0)}getUsage(){return 4*this._getStoredPixels()/1e6}_getStoredPixels(){let l=0;for(let _ of this._images.values())_.orig&&(l+=_.orig.width*_.orig.height,_.actual&&_.actual!==_.orig&&(l+=_.actual.width*_.actual.height));return l}_delImg(l){let _=this._images.get(l);this._images.delete(l),_&&window.ImageBitmap&&_.orig instanceof ImageBitmap&&_.orig.close()}wipeAlternate(){var l;let _=[];for(let[v,u]of this._images.entries())u.bufferType==="alternate"&&((l=u.marker)===null||l===void 0||l.dispose(),_.push(v));for(let v of _)this._delImg(v);this._needsFullClear=!0,this._fullyCleared=!1}advanceCursor(l){if(this._opts.sixelScrolling){let _=this._renderer.cellSize;_.width!==-1&&_.height!==-1||(_=t.CELL_SIZE_DEFAULT);let v=Math.ceil(l/_.height);for(let u=1;u<v;++u)this._terminal._core._inputHandler.lineFeed()}}addImage(l){var _;this._evictOldest(l.width*l.height);let v=this._renderer.cellSize;v.width!==-1&&v.height!==-1||(v=t.CELL_SIZE_DEFAULT);let u=Math.ceil(l.width/v.width),o=Math.ceil(l.height/v.height),d=++this._lastId,f=this._terminal._core.buffer,p=this._terminal.cols,y=this._terminal.rows,w=f.x,b=f.y,S=w,A=0;this._opts.sixelScrolling||(f.x=0,f.y=0,S=0),this._terminal._core._inputHandler._dirtyRowTracker.markDirty(f.y);for(let B=0;B<o;++B){let R=f.lines.get(f.y+f.ybase);for(let F=0;F<u&&!(S+F>=p);++F)this._writeToCell(R,S+F,d,B*u+F),A++;if(this._opts.sixelScrolling)B<o-1&&this._terminal._core._inputHandler.lineFeed();else if(++f.y>=y)break;f.x=S}this._terminal._core._inputHandler._dirtyRowTracker.markDirty(f.y),this._opts.sixelScrolling?f.x=S:(f.x=w,f.y=b);let C=[];for(let[B,R]of this._images.entries())R.tileCount<1&&((_=R.marker)===null||_===void 0||_.dispose(),C.push(B));for(let B of C)this._delImg(B);let D=this._terminal.registerMarker(0);D?.onDispose(()=>{this._images.get(d)&&this._delImg(d)}),this._terminal.buffer.active.type==="alternate"&&this._evictOnAlternate();let L={orig:l,origCellSize:v,actual:l,actualCellSize:Object.assign({},v),marker:D||void 0,tileCount:A,bufferType:this._terminal.buffer.active.type};this._images.set(d,L)}render(l){if(!this._renderer.canvas&&this._images.size&&(this._renderer.insertLayerToDom(),!this._renderer.canvas))return;if(this._renderer.rescaleCanvas(),!this._images.size)return this._fullyCleared||(this._renderer.clearAll(),this._fullyCleared=!0,this._needsFullClear=!1),void(this._renderer.canvas&&this._renderer.removeLayerFromDom());this._needsFullClear&&(this._renderer.clearAll(),this._fullyCleared=!0,this._needsFullClear=!1);let{start:_,end:v}=l,u=this._terminal._core.buffer,o=this._terminal._core.cols;this._renderer.clearLines(_,v);for(let d=_;d<=v;++d){let f=u.lines.get(d+u.ydisp);if(!f)return;for(let p=0;p<o;++p)if(268435456&f.getBg(p)){let y=f._extendedAttrs[p]||a,w=y.imageId;if(w===void 0||w===-1)continue;let b=this._images.get(w);if(y.tileId!==-1){let S=y.tileId,A=p,C=1;for(;++p<o&&268435456&f.getBg(p)&&(y=f._extendedAttrs[p]||a)&&y.imageId===w&&y.tileId===S+C;)C++;p--,b?b.actual&&this._renderer.draw(b,S,A,d,C):this._opts.showPlaceholder&&this._renderer.drawPlaceholder(A,d,C),this._fullyCleared=!1}}}}viewportResize(l){var _;if(!this._images.size)return void(this._viewportMetrics=l);if(this._viewportMetrics.cols>=l.cols)return void(this._viewportMetrics=l);let v=this._terminal._core.buffer,u=v.lines.length,o=this._viewportMetrics.cols-1;for(let d=0;d<u;++d){let f=v.lines.get(d);if(268435456&f.getBg(o)){let p=f._extendedAttrs[o]||a,y=p.imageId;if(y===void 0||y===-1)continue;let w=this._images.get(y);if(!w)continue;let b=Math.ceil((((_=w.actual)===null||_===void 0?void 0:_.width)||0)/w.actualCellSize.width);if(p.tileId%b+1>=b)continue;let S=!1;for(let D=o+1;D>l.cols;++D)if(4194303&f._data[3*D+0]){S=!0;break}if(S)continue;let A=Math.min(l.cols,b-p.tileId%b+o),C=p.tileId;for(let D=o+1;D<A;++D)this._writeToCell(f,D,y,++C),w.tileCount++}}this._viewportMetrics=l}getImageAtBufferCell(l,_){var v,u;let o=this._terminal._core.buffer.lines.get(_);if(o&&268435456&o.getBg(l)){let d=o._extendedAttrs[l]||a;if(d.imageId&&d.imageId!==-1){let f=(v=this._images.get(d.imageId))===null||v===void 0?void 0:v.orig;if(window.ImageBitmap&&f instanceof ImageBitmap){let p=h.ImageRenderer.createCanvas(window.document,f.width,f.height);return(u=p.getContext("2d"))===null||u===void 0||u.drawImage(f,0,0,f.width,f.height),p}return f}}}extractTileAtBufferCell(l,_){let v=this._terminal._core.buffer.lines.get(_);if(v&&268435456&v.getBg(l)){let u=v._extendedAttrs[l]||a;if(u.imageId&&u.imageId!==-1&&u.tileId!==-1){let o=this._images.get(u.imageId);if(o)return this._renderer.extractTile(o,u.tileId)}}}_evictOldest(l){var _;let v=this._getStoredPixels(),u=v;for(;this._pixelLimit<u+l&&this._images.size;){let o=this._images.get(++this._lowestId);o&&o.orig&&(u-=o.orig.width*o.orig.height,o.actual&&o.orig!==o.actual&&(u-=o.actual.width*o.actual.height),(_=o.marker)===null||_===void 0||_.dispose(),this._delImg(this._lowestId))}return v-u}_writeToCell(l,_,v,u){if(268435456&l._data[3*_+2]){let o=l._extendedAttrs[_];if(o){if(o.imageId!==void 0){let d=this._images.get(o.imageId);return d&&d.tileCount--,o.imageId=v,void(o.tileId=u)}return void(l._extendedAttrs[_]=new g(o.ext,o.urlId,v,u))}}l._data[3*_+2]|=268435456,l._extendedAttrs[_]=new g(0,0,v,u)}_evictOnAlternate(){var l,_;for(let o of this._images.values())o.bufferType==="alternate"&&(o.tileCount=0);let v=this._terminal._core.buffer;for(let o=0;o<this._terminal.rows;++o){let d=v.lines.get(o);if(d){for(let f=0;f<this._terminal.cols;++f)if(268435456&d._data[3*f+2]){let p=(l=d._extendedAttrs[f])===null||l===void 0?void 0:l.imageId;if(p){let y=this._images.get(p);y&&y.tileCount++}}}}let u=[];for(let[o,d]of this._images.entries())d.bufferType!=="alternate"||d.tileCount||((_=d.marker)===null||_===void 0||_.dispose(),u.push(o));for(let o of u)this._delImg(o)}}},973:(c,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SixelHandler=void 0;let h=n(477),g=n(782),a=n(710),l=h.PALETTE_ANSI_256;function _(v){return h.BIG_ENDIAN?v:(255&v)<<24|(v>>>8&255)<<16|(v>>>16&255)<<8|v>>>24&255}l.set(h.PALETTE_VT340_COLOR),t.SixelHandler=class{constructor(v,u,o){this._opts=v,this._storage=u,this._coreTerminal=o,this._size=0,this._aborted=!1,(0,a.DecoderAsync)({memoryLimit:4*this._opts.pixelLimit,palette:l,paletteLimit:this._opts.sixelPaletteLimit}).then(d=>this._dec=d)}reset(){this._dec&&(this._dec.release(),this._dec._palette.fill(0),this._dec.init(0,l,this._opts.sixelPaletteLimit))}hook(v){var u;if(this._size=0,this._aborted=!1,this._dec){let o=v.params[1]===1?0:function(d,f){let p=0;if(!f)return p;if(d.isInverse())if(d.isFgDefault())p=_(f.foreground.rgba);else if(d.isFgRGB()){let y=d.constructor.toColorRGB(d.getFgColor());p=(0,h.toRGBA8888)(...y)}else p=_(f.ansi[d.getFgColor()].rgba);else if(d.isBgDefault())p=_(f.background.rgba);else if(d.isBgRGB()){let y=d.constructor.toColorRGB(d.getBgColor());p=(0,h.toRGBA8888)(...y)}else p=_(f.ansi[d.getBgColor()].rgba);return p}(this._coreTerminal._core._inputHandler._curAttrData,(u=this._coreTerminal._core._themeService)===null||u===void 0?void 0:u.colors);this._dec.init(o,null,this._opts.sixelPaletteLimit)}}put(v,u,o){if(!this._aborted&&this._dec){if(this._size+=o-u,this._size>this._opts.sixelSizeLimit)return console.warn("SIXEL: too much data, aborting"),this._aborted=!0,void this._dec.release();try{this._dec.decode(v,u,o)}catch(d){console.warn(`SIXEL: error while decoding image - ${d}`),this._aborted=!0,this._dec.release()}}}unhook(v){var u;if(this._aborted||!v||!this._dec)return!0;let o=this._dec.width,d=this._dec.height;if(!o||!d)return d&&this._storage.advanceCursor(d),!0;let f=g.ImageRenderer.createCanvas(void 0,o,d);return(u=f.getContext("2d"))===null||u===void 0||u.putImageData(new ImageData(this._dec.data8,o,d),0,0),this._dec.memoryUsage>4194304&&this._dec.release(),this._storage.addImage(f),!0}}},859:(c,t)=>{function n(h){for(let g of h)g.dispose();h.length=0}Object.defineProperty(t,"__esModule",{value:!0}),t.getDisposeArrayDisposable=t.disposeArray=t.toDisposable=t.MutableDisposable=t.Disposable=void 0,t.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(let h of this._disposables)h.dispose();this._disposables.length=0}register(h){return this._disposables.push(h),h}unregister(h){let g=this._disposables.indexOf(h);g!==-1&&this._disposables.splice(g,1)}},t.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(h){this._isDisposed||h===this._value||(this._value?.dispose(),this._value=h)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,this._value?.dispose(),this._value=void 0}},t.toDisposable=function(h){return{dispose:h}},t.disposeArray=n,t.getDisposeArrayDisposable=function(h){return{dispose:()=>n(h)}}}},i={};function r(c){var t=i[c];if(t!==void 0)return t.exports;var n=i[c]={exports:{}};return e[c](n,n.exports,r),n.exports}var s={};return(()=>{var c=s;Object.defineProperty(c,"__esModule",{value:!0}),c.ImageAddon=void 0;let t=r(125),n=r(782),h=r(216),g=r(973),a={enableSizeReports:!0,pixelLimit:16777216,sixelSupport:!0,sixelScrolling:!0,sixelPaletteLimit:256,sixelSizeLimit:25e6,storageLimit:128,showPlaceholder:!0,iipSupport:!0,iipSizeLimit:2e7};c.ImageAddon=class{constructor(l){this._disposables=[],this._handlers=new Map,this._opts=Object.assign({},a,l),this._defaultOpts=Object.assign({},a,l)}dispose(){for(let l of this._disposables)l.dispose();this._disposables.length=0,this._handlers.clear()}_disposeLater(...l){for(let _ of l)this._disposables.push(_)}activate(l){if(this._terminal=l,this._renderer=new n.ImageRenderer(l),this._storage=new h.ImageStorage(l,this._renderer,this._opts),this._opts.enableSizeReports){let _=l.options.windowOptions||{};_.getWinSizePixels=!0,_.getCellSizePixels=!0,_.getWinSizeChars=!0,l.options.windowOptions=_}if(this._disposeLater(this._renderer,this._storage,l.parser.registerCsiHandler({prefix:"?",final:"h"},_=>this._decset(_)),l.parser.registerCsiHandler({prefix:"?",final:"l"},_=>this._decrst(_)),l.parser.registerCsiHandler({final:"c"},_=>this._da1(_)),l.parser.registerCsiHandler({prefix:"?",final:"S"},_=>this._xtermGraphicsAttributes(_)),l.onRender(_=>{var v;return(v=this._storage)===null||v===void 0?void 0:v.render(_)}),l.parser.registerCsiHandler({intermediates:"!",final:"p"},()=>this.reset()),l.parser.registerEscHandler({final:"c"},()=>this.reset()),l._core._inputHandler.onRequestReset(()=>this.reset()),l.buffer.onBufferChange(()=>{var _;return(_=this._storage)===null||_===void 0?void 0:_.wipeAlternate()}),l.onResize(_=>{var v;return(v=this._storage)===null||v===void 0?void 0:v.viewportResize(_)})),this._opts.sixelSupport){let _=new g.SixelHandler(this._opts,this._storage,l);this._handlers.set("sixel",_),this._disposeLater(l._core._inputHandler._parser.registerDcsHandler({final:"q"},_))}if(this._opts.iipSupport){let _=new t.IIPHandler(this._opts,this._renderer,this._storage,l);this._handlers.set("iip",_),this._disposeLater(l._core._inputHandler._parser.registerOscHandler(1337,_))}}reset(){var l;this._opts.sixelScrolling=this._defaultOpts.sixelScrolling,this._opts.sixelPaletteLimit=this._defaultOpts.sixelPaletteLimit,(l=this._storage)===null||l===void 0||l.reset();for(let _ of this._handlers.values())_.reset();return!1}get storageLimit(){var l;return((l=this._storage)===null||l===void 0?void 0:l.getLimit())||-1}set storageLimit(l){var _;(_=this._storage)===null||_===void 0||_.setLimit(l),this._opts.storageLimit=l}get storageUsage(){return this._storage?this._storage.getUsage():-1}get showPlaceholder(){return this._opts.showPlaceholder}set showPlaceholder(l){var _;this._opts.showPlaceholder=l,(_=this._renderer)===null||_===void 0||_.showPlaceholder(l)}getImageAtBufferCell(l,_){var v;return(v=this._storage)===null||v===void 0?void 0:v.getImageAtBufferCell(l,_)}extractTileAtBufferCell(l,_){var v;return(v=this._storage)===null||v===void 0?void 0:v.extractTileAtBufferCell(l,_)}_report(l){var _;(_=this._terminal)===null||_===void 0||_._core.coreService.triggerDataEvent(l)}_decset(l){for(let _=0;_<l.length;++_)l[_]===80&&(this._opts.sixelScrolling=!1);return!1}_decrst(l){for(let _=0;_<l.length;++_)l[_]===80&&(this._opts.sixelScrolling=!0);return!1}_da1(l){return!!l[0]||!!this._opts.sixelSupport&&(this._report("\x1B[?62;4;9;22c"),!0)}_xtermGraphicsAttributes(l){var _,v,u,o,d,f;if(l.length<2)return!0;if(l[0]===1)switch(l[1]){case 1:return this._report(`\x1B[?${l[0]};0;${this._opts.sixelPaletteLimit}S`),!0;case 2:this._opts.sixelPaletteLimit=this._defaultOpts.sixelPaletteLimit,this._report(`\x1B[?${l[0]};0;${this._opts.sixelPaletteLimit}S`);for(let p of this._handlers.values())p.reset();return!0;case 3:return l.length>2&&!(l[2]instanceof Array)&&l[2]<=4096?(this._opts.sixelPaletteLimit=l[2],this._report(`\x1B[?${l[0]};0;${this._opts.sixelPaletteLimit}S`)):this._report(`\x1B[?${l[0]};2S`),!0;case 4:return this._report(`\x1B[?${l[0]};0;4096S`),!0;default:return this._report(`\x1B[?${l[0]};2S`),!0}if(l[0]===2)switch(l[1]){case 1:let p=(v=(_=this._renderer)===null||_===void 0?void 0:_.dimensions)===null||v===void 0?void 0:v.css.canvas.width,y=(o=(u=this._renderer)===null||u===void 0?void 0:u.dimensions)===null||o===void 0?void 0:o.css.canvas.height;if(!p||!y){let b=h.CELL_SIZE_DEFAULT;p=(((d=this._terminal)===null||d===void 0?void 0:d.cols)||80)*b.width,y=(((f=this._terminal)===null||f===void 0?void 0:f.rows)||24)*b.height}if(p*y<this._opts.pixelLimit)this._report(`\x1B[?${l[0]};0;${p.toFixed(0)};${y.toFixed(0)}S`);else{let b=Math.floor(Math.sqrt(this._opts.pixelLimit));this._report(`\x1B[?${l[0]};0;${b};${b}S`)}return!0;case 4:let w=Math.floor(Math.sqrt(this._opts.pixelLimit));return this._report(`\x1B[?${l[0]};0;${w};${w}S`),!0;default:return this._report(`\x1B[?${l[0]};2S`),!0}return this._report(`\x1B[?${l[0]};1S`),!0}}})(),s})())});var mt={id:"bajrangcoder.acodex",name:"AcodeX - Terminal",main:"dist/main.js",version:"3.1.9",readme:"readme.md",icon:"icon.png",files:[],minVersionCode:290,author:{name:"Raunak Raj",email:"bajrangcoders@gmail.com",url:"https://github.com/bajrangCoder/acode-plugin-acodex",github:"bajrangCoder"}};function Eo(e){let r=window.getComputedStyle(e).backgroundColor.match(/\d+/g),s=Number.parseFloat(r[3])||1;return`rgba(${r[0]}, ${r[1]}, ${r[2]}, 0.5)`}function ko(e){let i="";for(let r=0;r<e.length;r++){let s=e.charCodeAt(r);(s>=32&&s<=126||s===13||s===8)&&(i+=e[r])}return i}function fr(e){return e.startsWith("content://com.termux.documents/tree")?e.split("::")[1].substring(0,e.split("::")[1].lastIndexOf("/")).replace(/^\/data\/data\/com\.termux\/files\/home/,"$HOME"):e.startsWith("file:///storage/emulated/0/")?`/sdcard${e.substr(26).replace(/\.[^/.]+$/,"").split("/").slice(0,-1).join("/")}/`:e.startsWith("content://com.android.externalstorage.documents/tree/primary")?`/sdcard/${e.split("::primary:")[1].substring(0,e.split("::primary:")[1].lastIndexOf("/"))}`:!1}function Bo(e,i){let r=e.replace("#",""),s=Number.parseInt(r.substring(0,2),16),c=Number.parseInt(r.substring(2,4),16),t=Number.parseInt(r.substring(4,6),16);return`rgba(${s}, ${c}, ${t}, ${i})`}async function Lo(e,i){try{let r=`${window.DATA_STORAGE}acodex_fonts`,s="https://cdn.jsdelivr.net/gh/bajrangCoder/acode-plugin-acodex@main/fonts/",c=[`${s}Fira Code Bold Nerd Font.ttf`,`${s}Fira Code Medium Nerd Font Complete Mono.ttf`,`${s}JetBrains Mono Bold Nerd Font Complete.ttf`,`${s}JetBrains Mono Medium Nerd Font Complete.ttf`,`${s}MesloLGS NF Bold Italic.ttf`,`${s}MesloLGS NF Bold.ttf`,`${s}MesloLGS NF Italic.ttf`,`${s}MesloLGS NF Regular.ttf`,`${s}SauceCodeProNerdFont-Bold.ttf`,`${s}SauceCodeProNerdFont-Medium.ttf`,`${s}VictorMonoNerdFont-Bold.ttf`,`${s}VictorMonoNerdFont-BoldItalic.ttf`,`${s}VictorMonoNerdFont-Italic.ttf`,`${s}VictorMonoNerdFont-Medium.ttf`];if(!await e(r).exists()){await e(window.DATA_STORAGE).createDirectory("acodex_fonts");let t=i.create("AcodeX","Downloading Fonts...");for(let n of c){let h=n.split("/").pop();t.setMessage(`Downloading Font: ${h}`),fetch(n).then(g=>g.blob()).then(async g=>{await e(r).createFile(h,g)}).catch(g=>{t.destroy(),window.toast(`Error fetching font file: ${g.toString()}`,4e3)})}t.destroy(),window.toast("Fonts Downloaded successfully \u{1F4A5}",3e3)}}catch(r){console.log(r),i.destroy()}}function Io(e){return`
@font-face {
  font-family: "Fira Code Bold Nerd Font";
  src: url("${e}Fira Code Bold Nerd Font.ttf") format("truetype");
  font-weight: bold;
  font-style: normal;
}
@font-face {
  font-family: "Fira Code Medium Nerd Font";
  src: url("${e}Fira Code Medium Nerd Font Complete Mono.ttf")
    format("truetype");
  font-weight: normal;
  font-style: normal;
}
@font-face {
  font-family: "JetBrains Mono Bold Nerd Font";
  src: url("${e}JetBrains Mono Bold Nerd Font Complete.ttf")
    format("truetype");
  font-weight: bold;
  font-style: normal;
}
@font-face {
  font-family: "JetBrains Mono Medium Nerd Font";
  src: url("${e}JetBrains Mono Medium Nerd Font Complete.ttf")
    format("truetype");
  font-weight: normal;
  font-style: normal;
}
@font-face {
  font-family: "VictorMonoNerdFont Bold";
  src: url("${e}VictorMonoNerdFont-Bold.ttf") format("truetype");
  font-weight: bold;
  font-style: normal;
}
@font-face {
  font-family: "VictorMonoNerdFont BoldItalic";
  src: url("${e}VictorMonoNerdFont-BoldItalic.ttf") format("truetype");
  font-weight: bold;
  font-style: italic;
}
@font-face {
  font-family: "VictorMonoNerdFont Medium";
  src: url("${e}VictorMonoNerdFont-Medium.ttf") format("truetype");
  font-weight: normal;
  font-style: normal;
}
@font-face {
  font-family: "VictorMonoNerdFont Italic";
  src: url("${e}VictorMonoNerdFont-Italic.ttf") format("truetype");
  font-weight: normal;
  font-style: italic;
}
@font-face {
  font-family: "SauceCodeProNerdFont Bold";
  src: url("${e}SauceCodeProNerdFont-Bold.ttf") format("truetype");
  font-weight: bold;
  font-style: normal;
}
@font-face {
  font-family: "SauceCodeProNerdFont Medium";
  src: url("${e}SauceCodeProNerdFont-Medium.ttf") format("truetype");
  font-weight: normal;
  font-style: normal;
}
@font-face {
  font-family: "MesloLGS NF Bold Italic";
  src: url("${e}MesloLGS NF Bold Italic.ttf") format("truetype");
  font-weight: bold;
  font-style: italic;
}
@font-face {
  font-family: "MesloLGS NF Bold";
  src: url("${e}MesloLGS NF Bold.ttf") format("truetype");
  font-weight: bold;
  font-style: normal;
}
@font-face {
  font-family: "MesloLGS NF Italic";
  src: url("${e}MesloLGS NF Italic.ttf") format("truetype");
  font-weight: normal;
  font-style: italic;
}
@font-face {
  font-family: "MesloLGS NF Regular";
  src: url("${e}MesloLGS NF Regular.ttf") format("truetype");
  font-weight: normal;
  font-style: normal;
}
  `}var xe={snazzy:{background:"#282A36",foreground:"#EFF0EB",cursor:"#EFF0EB",black:"#0C0D13",red:"#FF5C57",green:"#5AF78E",yellow:"#F3F99D",blue:"#57C7FF",magenta:"#FF6AC1",cyan:"#9AEDFE",white:"#EFF0EB",brightBlack:"#686868",brightRed:"#FF5C57",brightGreen:"#5AF78E",brightYellow:"#F3F99D",brightBlue:"#57C7FF",brightMagenta:"#FF6AC1",brightCyan:"#9AEDFE",brightWhite:"#EFF0EB"},xterm:{foreground:"#F8F8F8",background:"#2D2E2C",selectionBackground:"#5DA5D533",black:"#1E1E1D",brightBlack:"#262625",red:"#CE5C5C",brightRed:"#FF7272",green:"#5BCC5B",brightGreen:"#72FF72",yellow:"#CCCC5B",brightYellow:"#FFFF72",blue:"#5D5DD3",brightBlue:"#7279FF",magenta:"#BC5ED1",brightMagenta:"#E572FF",cyan:"#5DA5D5",brightCyan:"#72F0FF",white:"#F8F8F8",brightWhite:"#FFFFFF"},sapphire:{background:"#1c2431",foreground:"#cccccc",selectionBackground:"#399ef440",black:"#666666",blue:"#399ef4",brightBlack:"#666666",brightBlue:"#399ef4",brightCyan:"#21c5c7",brightGreen:"#4eb071",brightMagenta:"#b168df",brightRed:"#da6771",brightWhite:"#efefef",brightYellow:"#fff099",cyan:"#21c5c7",green:"#4eb071",magenta:"#b168df",red:"#da6771",white:"#efefef",yellow:"#fff099"},light:{background:"#ffffff",foreground:"#333333",cursor:"#333333",cursorAccent:"#ffffff",selectionBackground:"#add6ff",black:"#000000",blue:"#0451a5",brightBlack:"#666666",brightBlue:"#0451a5",brightCyan:"#0598bc",brightGreen:"#14ce14",brightMagenta:"#bc05bc",brightRed:"#cd3131",brightWhite:"#a5a5a5",brightYellow:"#b5ba00",cyan:"#0598bc",green:"#00bc00",magenta:"#bc05bc",red:"#cd3131",white:"#555555",yellow:"#949800"},custom:{background:"#1c2431",foreground:"#cccccc",cursor:"#ffffff",cursorAccent:"#fff",selectionBackground:"#399ef440",black:"#666666",blue:"#399ef4",brightBlack:"#666666",brightBlue:"#399ef4",brightCyan:"#21c5c7",brightGreen:"#4eb071",brightMagenta:"#b168df",brightRed:"#da6771",brightWhite:"#efefef",brightYellow:"#fff099",cyan:"#21c5c7",green:"#4eb071",magenta:"#b168df",red:"#da6771",white:"#efefef",yellow:"#fff099"},ayuDark:{background:"#090D13",foreground:"#FEFEFE",cursor:"#E96B72",black:"#00050D",red:"#E96B72",green:"#90B261",yellow:"#F8AE4E",blue:"#52BCF9",magenta:"#F9E893",cyan:"#8FE0C5",white:"#C6C6C6",brightBlack:"#676767",brightRed:"#EF7077",brightGreen:"#C1D84B",brightYellow:"#FEB353",brightBlue:"#58C1FE",brightMagenta:"#FEED98",brightCyan:"#94E5CA",brightWhite:"#FEFEFE"},catppuccin:{background:"#1E1D2F",foreground:"#D9E0EE",cursor:"#D9E0EE",black:"#6E6C7E",red:"#F28FAD",green:"#ABE9B3",yellow:"#FAE3B0",blue:"#96CDFB",magenta:"#F5C2E7",cyan:"#89DCEB",white:"#C3BAC6",brightBlack:"#988BA2",brightRed:"#F28FAD",brightGreen:"#ABE9B3",brightYellow:"#FAE3B0",brightBlue:"#96CDFB",brightMagenta:"#F5C2E7",brightCyan:"#89DCEB",brightWhite:"#D9E0EE"},oneDark:{background:"#1E2127",foreground:"#5C6370",cursor:"#5C6370",black:"#000000",red:"#E06C75",green:"#98C379",yellow:"#D19A66",blue:"#61AFEF",magenta:"#C678DD",cyan:"#56B6C2",white:"#ABB2BF",brightBlack:"#5C6370",brightRed:"#E06C75",brightGreen:"#98C379",brightYellow:"#D19A66",brightBlue:"#61AFEF",brightMagenta:"#C678DD",brightCyan:"#56B6C2",brightWhite:"#FFFEFE"},material:{background:"#1E282C",foreground:"#C3C7D1",cursor:"#657B83",black:"#073641",red:"#EB606B",green:"#C3E88D",yellow:"#F7EB95",blue:"#80CBC3",magenta:"#FF2490",cyan:"#AEDDFF",white:"#FFFFFF",brightBlack:"#002B36",brightRed:"#EB606B",brightGreen:"#C3E88D",brightYellow:"#F7EB95",brightBlue:"#7DC6BF",brightMagenta:"#6C71C3",brightCyan:"#34434D",brightWhite:"#FFFFFF"},nekonakoDjancoeg:{background:"#2a2c3a",foreground:"#eeeeee",cursor:"#fd6b85",black:"#2f343f",red:"#fd6b85",green:"#63e0be",yellow:"#fed270",blue:"#67d4f2",magenta:"#ff8167",cyan:"#63e0be",white:"#eeeeee",brightBlack:"#4f4f5b",brightRed:"#fd6b85",brightGreen:"#63e0be",brightYellow:"#fed270",brightBlue:"#67d4f2",brightMagenta:"#ff8167",brightCyan:"#63e0be",brightWhite:"#eeeeee"},dracula:{background:"#282a36",foreground:"#94A3A5",cursor:"#94A3A5",black:"#44475a",red:"#ff5555",green:"#50fa7b",yellow:"#ffb86c",blue:"#8be9fd",magenta:"#bd93f9",cyan:"#ff79c6",white:"#94A3A5",brightBlack:"#000000",brightRed:"#ff5555",brightGreen:"#50fa7b",brightYellow:"#ffb86c",brightBlue:"#8be9fd",brightMagenta:"#bd93f9",brightCyan:"#ff79c6",brightWhite:"#ffffff"},ayuMirage:{background:"#1F2430",foreground:"#E5E0CE",cursor:"#E96B72",black:"#00050D",red:"#E96B72",green:"#90B261",yellow:"#F8AE4E",blue:"#52BCF9",magenta:"#F9E893",cyan:"#8FE0C5",white:"#C6C6C6",brightBlack:"#676767",brightRed:"#EF7077",brightGreen:"#C1D84B",brightYellow:"#FEB353",brightBlue:"#58C1FE",brightMagenta:"#FEED98",brightCyan:"#94E5CA",brightWhite:"#FEFEFE"},siduckOneDark:{background:"#1e222a",foreground:"#c8ccd4",cursor:"#e06c75",black:"#1e222a",red:"#e06c75",green:"#98c379",yellow:"#e5c07b",blue:"#61afef",magenta:"#c678dd",cyan:"#56b6c2",white:"#D8DEE9",brightBlack:"#545862",brightRed:"#e06c75",brightGreen:"#98c379",brightYellow:"#e5c07b",brightBlue:"#61afef",brightMagenta:"#c678dd",brightCyan:"#56b6c2",brightWhite:"#c8ccd4"},elementary:{background:"#101010",foreground:"#f2f2f2",cursor:"#f2f2f2",black:"#303030",red:"#e1321a",green:"#6ab017",yellow:"#ffc005",blue:"#004f9e",magenta:"#ec0048",cyan:"#2aa7e7",white:"#f2f2f2",brightBlack:"#5d5d5d",brightRed:"#ff361e",brightGreen:"#7bc91f",brightYellow:"#ffd00a",brightBlue:"#0071ff",brightMagenta:"#ff1d62",brightCyan:"#4bb8fd",brightWhite:"#a020f0"},ayuLight:{background:"#FEFEFE",foreground:"#090D13",cursor:"#E96B72",black:"#00050D",red:"#E96B72",green:"#90B261",yellow:"#F8AE4E",blue:"#52BCF9",magenta:"#F9E893",cyan:"#8FE0C5",white:"#c6c6c694",brightBlack:"#676767",brightRed:"#EF7077",brightGreen:"#C1D84B",brightYellow:"#FEB353",brightBlue:"#58C1FE",brightMagenta:"#FEED98",brightCyan:"#94E5CA",brightWhite:"#dacaca"},everblush:{name:"Everblush",background:"#141b1e",foreground:"#dadada",cursor:"#3b4244",black:"#232a2d",red:"#e57474",green:"#8ccf7e",yellow:"#e5c76b",blue:"#67b0e8",magenta:"#c47fd5",cyan:"#6cbfbf",white:"#b3b9b8",brightBlack:"#2d3437",brightRed:"#ef7e7e",brightGreen:"#96d988",brightYellow:"#f4d67a",brightBlue:"#71baf2",brightMagenta:"#ce89df",brightCyan:"#67cbe7",brightWhite:"#bdc3c2"}};var Te=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof global<"u"&&global||{},He={searchParams:"URLSearchParams"in Te,iterable:"Symbol"in Te&&"iterator"in Symbol,blob:"FileReader"in Te&&"Blob"in Te&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in Te,arrayBuffer:"ArrayBuffer"in Te};function Su(e){return e&&DataView.prototype.isPrototypeOf(e)}He.arrayBuffer&&(Do=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],Mo=ArrayBuffer.isView||function(e){return e&&Do.indexOf(Object.prototype.toString.call(e))>-1});var Do,Mo;function ii(e){if(typeof e!="string"&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||e==="")throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function Ds(e){return typeof e!="string"&&(e=String(e)),e}function Rs(e){var i={next:function(){var r=e.shift();return{done:r===void 0,value:r}}};return He.iterable&&(i[Symbol.iterator]=function(){return i}),i}function De(e){this.map={},e instanceof De?e.forEach(function(i,r){this.append(r,i)},this):Array.isArray(e)?e.forEach(function(i){if(i.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+i.length);this.append(i[0],i[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(i){this.append(i,e[i])},this)}De.prototype.append=function(e,i){e=ii(e),i=Ds(i);var r=this.map[e];this.map[e]=r?r+", "+i:i};De.prototype.delete=function(e){delete this.map[ii(e)]};De.prototype.get=function(e){return e=ii(e),this.has(e)?this.map[e]:null};De.prototype.has=function(e){return this.map.hasOwnProperty(ii(e))};De.prototype.set=function(e,i){this.map[ii(e)]=Ds(i)};De.prototype.forEach=function(e,i){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(i,this.map[r],r,this)};De.prototype.keys=function(){var e=[];return this.forEach(function(i,r){e.push(r)}),Rs(e)};De.prototype.values=function(){var e=[];return this.forEach(function(i){e.push(i)}),Rs(e)};De.prototype.entries=function(){var e=[];return this.forEach(function(i,r){e.push([r,i])}),Rs(e)};He.iterable&&(De.prototype[Symbol.iterator]=De.prototype.entries);function Is(e){if(!e._noBody){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}}function To(e){return new Promise(function(i,r){e.onload=function(){i(e.result)},e.onerror=function(){r(e.error)}})}function Eu(e){var i=new FileReader,r=To(i);return i.readAsArrayBuffer(e),r}function ku(e){var i=new FileReader,r=To(i),s=/charset=([A-Za-z0-9_-]+)/.exec(e.type),c=s?s[1]:"utf-8";return i.readAsText(e,c),r}function Bu(e){for(var i=new Uint8Array(e),r=new Array(i.length),s=0;s<i.length;s++)r[s]=String.fromCharCode(i[s]);return r.join("")}function Ro(e){if(e.slice)return e.slice(0);var i=new Uint8Array(e.byteLength);return i.set(new Uint8Array(e)),i.buffer}function Fo(){return this.bodyUsed=!1,this._initBody=function(e){this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?typeof e=="string"?this._bodyText=e:He.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:He.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:He.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():He.arrayBuffer&&He.blob&&Su(e)?(this._bodyArrayBuffer=Ro(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):He.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||Mo(e))?this._bodyArrayBuffer=Ro(e):this._bodyText=e=Object.prototype.toString.call(e):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof e=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):He.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},He.blob&&(this.blob=function(){var e=Is(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=Is(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(He.blob)return this.blob().then(Eu);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var e=Is(this);if(e)return e;if(this._bodyBlob)return ku(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(Bu(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},He.formData&&(this.formData=function(){return this.text().then(Du)}),this.json=function(){return this.text().then(JSON.parse)},this}var Lu=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function Iu(e){var i=e.toUpperCase();return Lu.indexOf(i)>-1?i:e}function Nt(e,i){if(!(this instanceof Nt))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');i=i||{};var r=i.body;if(e instanceof Nt){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,i.headers||(this.headers=new De(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,!r&&e._bodyInit!=null&&(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=i.credentials||this.credentials||"same-origin",(i.headers||!this.headers)&&(this.headers=new De(i.headers)),this.method=Iu(i.method||this.method||"GET"),this.mode=i.mode||this.mode||null,this.signal=i.signal||this.signal||function(){if("AbortController"in Te){var t=new AbortController;return t.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&r)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(r),(this.method==="GET"||this.method==="HEAD")&&(i.cache==="no-store"||i.cache==="no-cache")){var s=/([?&])_=[^&]*/;if(s.test(this.url))this.url=this.url.replace(s,"$1_="+new Date().getTime());else{var c=/\?/;this.url+=(c.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}Nt.prototype.clone=function(){return new Nt(this,{body:this._bodyInit})};function Du(e){var i=new FormData;return e.trim().split("&").forEach(function(r){if(r){var s=r.split("="),c=s.shift().replace(/\+/g," "),t=s.join("=").replace(/\+/g," ");i.append(decodeURIComponent(c),decodeURIComponent(t))}}),i}function Ru(e){var i=new De,r=e.replace(/\r?\n[\t ]+/g," ");return r.split("\r").map(function(s){return s.indexOf(`
`)===0?s.substr(1,s.length):s}).forEach(function(s){var c=s.split(":"),t=c.shift().trim();if(t){var n=c.join(":").trim();try{i.append(t,n)}catch(h){console.warn("Response "+h.message)}}}),i}Fo.call(Nt.prototype);function at(e,i){if(!(this instanceof at))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(i||(i={}),this.type="default",this.status=i.status===void 0?200:i.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=i.statusText===void 0?"":""+i.statusText,this.headers=new De(i.headers),this.url=i.url||"",this._initBody(e)}Fo.call(at.prototype);at.prototype.clone=function(){return new at(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new De(this.headers),url:this.url})};at.error=function(){var e=new at(null,{status:200,statusText:""});return e.ok=!1,e.status=0,e.type="error",e};var Mu=[301,302,303,307,308];at.redirect=function(e,i){if(Mu.indexOf(i)===-1)throw new RangeError("Invalid status code");return new at(null,{status:i,headers:{location:e}})};var Ht=Te.DOMException;try{new Ht}catch{Ht=function(i,r){this.message=i,this.name=r;var s=Error(i);this.stack=s.stack},Ht.prototype=Object.create(Error.prototype),Ht.prototype.constructor=Ht}function Po(e,i){return new Promise(function(r,s){var c=new Nt(e,i);if(c.signal&&c.signal.aborted)return s(new Ht("Aborted","AbortError"));var t=new XMLHttpRequest;function n(){t.abort()}t.onload=function(){var a={statusText:t.statusText,headers:Ru(t.getAllResponseHeaders()||"")};c.url.indexOf("file://")===0&&(t.status<200||t.status>599)?a.status=200:a.status=t.status,a.url="responseURL"in t?t.responseURL:a.headers.get("X-Request-URL");var l="response"in t?t.response:t.responseText;setTimeout(function(){r(new at(l,a))},0)},t.onerror=function(){setTimeout(function(){s(new TypeError("Network request failed"))},0)},t.ontimeout=function(){setTimeout(function(){s(new TypeError("Network request timed out"))},0)},t.onabort=function(){setTimeout(function(){s(new Ht("Aborted","AbortError"))},0)};function h(a){try{return a===""&&Te.location.href?Te.location.href:a}catch{return a}}if(t.open(c.method,h(c.url),!0),c.credentials==="include"?t.withCredentials=!0:c.credentials==="omit"&&(t.withCredentials=!1),"responseType"in t&&(He.blob?t.responseType="blob":He.arrayBuffer&&(t.responseType="arraybuffer")),i&&typeof i.headers=="object"&&!(i.headers instanceof De||Te.Headers&&i.headers instanceof Te.Headers)){var g=[];Object.getOwnPropertyNames(i.headers).forEach(function(a){g.push(ii(a)),t.setRequestHeader(a,Ds(i.headers[a]))}),c.headers.forEach(function(a,l){g.indexOf(l)===-1&&t.setRequestHeader(l,a)})}else c.headers.forEach(function(a,l){t.setRequestHeader(l,a)});c.signal&&(c.signal.addEventListener("abort",n),t.onreadystatechange=function(){t.readyState===4&&c.signal.removeEventListener("abort",n)}),t.send(typeof c._bodyInit>"u"?null:c._bodyInit)})}Po.polyfill=!0;Te.fetch||(Te.fetch=Po,Te.Headers=De,Te.Request=Nt,Te.Response=at);var Tu="0.5.13",Ko="11434",Qo=`http://127.0.0.1:${Ko}`,Fu=Object.defineProperty,Pu=(e,i,r)=>i in e?Fu(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,Ms=(e,i,r)=>(Pu(e,typeof i!="symbol"?i+"":i,r),r),Fs=class e extends Error{constructor(i,r){super(i),this.error=i,this.status_code=r,this.name="ResponseError",Error.captureStackTrace&&Error.captureStackTrace(this,e)}},Ps=class{constructor(i,r,s){Ms(this,"abortController"),Ms(this,"itr"),Ms(this,"doneCallback"),this.abortController=i,this.itr=r,this.doneCallback=s}abort(){this.abortController.abort()}async*[Symbol.asyncIterator](){for await(let i of this.itr){if("error"in i)throw new Error(i.error);if(yield i,i.done||i.status==="success"){this.doneCallback();return}}throw new Error("Did not receive done or success response in stream.")}},Os=async e=>{if(e.ok)return;let i=`Error ${e.status}: ${e.statusText}`,r=null;if(e.headers.get("content-type")?.includes("application/json"))try{r=await e.json(),i=r.error||i}catch{console.log("Failed to parse error response as JSON")}else try{console.log("Getting text from response"),i=await e.text()||i}catch{console.log("Failed to get text from error response")}throw new Fs(i,e.status)};function Ou(){return typeof window<"u"&&window.navigator?`${window.navigator.platform.toLowerCase()} Browser/${navigator.userAgent};`:typeof process<"u"?`${process.arch} ${process.platform} Node.js/${process.version}`:""}var Ks=async(e,i,r={})=>{let s={"Content-Type":"application/json",Accept:"application/json","User-Agent":`ollama-js/${Tu} (${Ou()})`};r.headers||(r.headers={});let c=Object.fromEntries(Object.entries(r.headers).filter(([t])=>!Object.keys(s).some(n=>n.toLowerCase()===t.toLowerCase())));return r.headers={...s,...c},e(i,r)},Oo=async(e,i,r)=>{let s=await Ks(e,i,{headers:r?.headers});return await Os(s),s},ri=async(e,i,r,s)=>{let t=(h=>h!==null&&typeof h=="object"&&!Array.isArray(h))(r)?JSON.stringify(r):r,n=await Ks(e,i,{method:"POST",body:t,signal:s?.signal,headers:s?.headers});return await Os(n),n},Ku=async(e,i,r,s)=>{let c=await Ks(e,i,{method:"DELETE",body:JSON.stringify(r),headers:s?.headers});return await Os(c),c},Qu=async function*(e){let i=new TextDecoder("utf-8"),r="",s=e.getReader();for(;;){let{done:c,value:t}=await s.read();if(c)break;r+=i.decode(t);let n=r.split(`
`);r=n.pop()??"";for(let h of n)try{yield JSON.parse(h)}catch{console.warn("invalid json: ",h)}}for(let c of r.split(`
`).filter(t=>t!==""))try{yield JSON.parse(c)}catch{console.warn("invalid json: ",c)}},Xu=e=>{if(!e)return Qo;let i=e.includes("://");e.startsWith(":")&&(e=`http://127.0.0.1${e}`,i=!0),i||(e=`http://${e}`);let r=new URL(e),s=r.port;s||(i?s=r.protocol==="https:"?"443":"80":s=Ko);let c=`${r.protocol}//${r.hostname}:${s}${r.pathname}`;return c.endsWith("/")&&(c=c.slice(0,-1)),c},Hu=Object.defineProperty,Nu=(e,i,r)=>i in e?Hu(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,Ts=(e,i,r)=>(Nu(e,typeof i!="symbol"?i+"":i,r),r),Qs=class{constructor(i){Ts(this,"config"),Ts(this,"fetch"),Ts(this,"ongoingStreamedRequests",[]),this.config={host:"",headers:i?.headers},i?.proxy||(this.config.host=Xu(i?.host??Qo)),this.fetch=i?.fetch??fetch}abort(){for(let i of this.ongoingStreamedRequests)i.abort();this.ongoingStreamedRequests.length=0}async processStreamableRequest(i,r){r.stream=r.stream??!1;let s=`${this.config.host}/api/${i}`;if(r.stream){let t=new AbortController,n=await ri(this.fetch,s,r,{signal:t.signal,headers:this.config.headers});if(!n.body)throw new Error("Missing body");let h=Qu(n.body),g=new Ps(t,h,()=>{let a=this.ongoingStreamedRequests.indexOf(g);a>-1&&this.ongoingStreamedRequests.splice(a,1)});return this.ongoingStreamedRequests.push(g),g}return await(await ri(this.fetch,s,r,{headers:this.config.headers})).json()}async encodeImage(i){if(typeof i!="string"){let r=new Uint8Array(i),s="",c=r.byteLength;for(let t=0;t<c;t++)s+=String.fromCharCode(r[t]);return btoa(s)}return i}async generate(i){return i.images&&(i.images=await Promise.all(i.images.map(this.encodeImage.bind(this)))),this.processStreamableRequest("generate",i)}async chat(i){if(i.messages)for(let r of i.messages)r.images&&(r.images=await Promise.all(r.images.map(this.encodeImage.bind(this))));return this.processStreamableRequest("chat",i)}async create(i){return this.processStreamableRequest("create",{...i})}async pull(i){return this.processStreamableRequest("pull",{name:i.model,stream:i.stream,insecure:i.insecure})}async push(i){return this.processStreamableRequest("push",{name:i.model,stream:i.stream,insecure:i.insecure})}async delete(i){return await Ku(this.fetch,`${this.config.host}/api/delete`,{name:i.model},{headers:this.config.headers}),{status:"success"}}async copy(i){return await ri(this.fetch,`${this.config.host}/api/copy`,{...i},{headers:this.config.headers}),{status:"success"}}async list(){return await(await Oo(this.fetch,`${this.config.host}/api/tags`,{headers:this.config.headers})).json()}async show(i){return await(await ri(this.fetch,`${this.config.host}/api/show`,{...i},{headers:this.config.headers})).json()}async embed(i){return await(await ri(this.fetch,`${this.config.host}/api/embed`,{...i},{headers:this.config.headers})).json()}async embeddings(i){return await(await ri(this.fetch,`${this.config.host}/api/embeddings`,{...i},{headers:this.config.headers})).json()}async ps(){return await(await Oo(this.fetch,`${this.config.host}/api/ps`,{headers:this.config.headers})).json()}},Ep=new Qs;var Xs=class{constructor(i=null){if(this.apiKey=i,this.deepseekAPI="https://api.deepseek.com/v1/chat/completions",this.chatgptAPI="https://api.openai.com/v1/chat/completions",this.geminiAPI=`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${this.apiKey}`,!i){let r=localStorage.getItem("Ollama-Host")||"http://localhost:11434";this.ollama=new Qs({host:r})}}getSystemPrompt(){return`You are a terminal command assistant designed to help users with command-line tasks. Only respond with the exact command(s) needed, with no explanations or markdown formatting. Examples:
    - 'Show current directory': pwd
    - 'List all files': ls -la
    - 'Create new folder docs': mkdir docs
    If a query is not related to terminal commands, do not respond. Multiple commands should be separated by semicolons. Keep responses minimal and focused only on valid terminal commands.`}async generateDeepseekResponse(i){let r={model:"deepseek-chat",messages:[{role:"system",content:this.getSystemPrompt()},{role:"user",content:i}]};return this._fetchAndProcessResponse(this.deepseekAPI,r,this.apiKey)}async generateChatgptResponse(i){let r={model:"gpt-3.5-turbo-0125",messages:[{role:"system",content:this.getSystemPrompt()},{role:"user",content:i}]};return this._fetchAndProcessResponse(this.chatgptAPI,r,this.apiKey)}async generateGeminiResponse(i){let s={contents:[{parts:[{text:`${this.getSystemPrompt()} My query: ${i}`}]}]};return this._fetchAndProcessResponse(this.geminiAPI,s,null)}async getListOfOllamaModels(){try{return(await this.ollama.list()).models.map(s=>s.model)}catch(i){return i}}async generateOllamaResponse(i,r){try{return await this.ollama.generate({model:i,system:this.getSystemPrompt(),prompt:r})}catch(s){return s}}async _fetchAndProcessResponse(i,r,s){try{let c={"Content-Type":"application/json"};s&&(c.Authorization=`Bearer ${s}`);let t=await fetch(i,{method:"POST",headers:c,body:JSON.stringify(r)}),n=await t.json();if(t.ok)return{response:n};throw new Error(n.detail?n.detail:n.error.message||"Failed to fetch response")}catch(c){return{error:c.message}}}},Xo=Xs;var Uu=acode.require("settings");acode.addIcon("deepseek","https://raw.githubusercontent.com/deepseek-ai/DeepSeek-Coder/main/pictures/home.png");acode.addIcon("chatgpt","https://upload.wikimedia.org/wikipedia/commons/0/04/ChatGPT_logo.svg");acode.addIcon("gemini","https://upload.wikimedia.org/wikipedia/commons/4/45/Gemini_language_model_logo.png");var Ho=!1,No=!1,Uo=!1,$o=!0,Wo=!0,jo=!0,Hs=["block","underline","bar"],Ns=["outline","block","bar","underline","none"],Go=11,zo="MesloLGS NF Regular",Us=["normal","bold","100","200","300","400","500","600","700","800","900"],qo=1e3,Vo=1e3,Jo=35,Yo=!0,ke="catppuccin",$s=["ayuDark","ayuLight","ayuMirage","catppuccin","dracula","elementary","everblush","light","material","nekonakoDjancoeg","oneDark","sapphire","siduckOneDark","snazzy","xterm","custom"],Zo=[[Uu.get("editorFont"),"Default Editor Font","file file_type_font",!0],["Fira Code Bold Nerd Font","Fira Code Bold Nerd Font","file file_type_font",!0],["Fira Code Medium Nerd Font","Fira Code Medium Nerd Font","file file_type_font",!0],["JetBrains Mono Bold Nerd Font","JetBrains Mono Bold Nerd Font","file file_type_font",!0],["JetBrains Mono Medium Nerd Font","JetBrains Mono Medium Nerd Font","file file_type_font",!0],["VictorMonoNerdFont Bold","VictorMonoNerdFont Bold","file file_type_font",!0],["VictorMonoNerdFont BoldItalic","VictorMonoNerdFont BoldItalic","file file_type_font",!0],["VictorMonoNerdFont Medium","VictorMonoNerdFont Medium","file file_type_font",!0],["VictorMonoNerdFont Italic","VictorMonoNerdFont Italic","file file_type_font",!0],["SauceCodeProNerdFont Bold","SauceCodeProNerdFont Bold","file file_type_font",!0],["SauceCodeProNerdFont Medium","SauceCodeProNerdFont Medium","file file_type_font",!0],["MesloLGS NF Bold Italic","MesloLGS NF Bold Italic","file file_type_font",!0],["MesloLGS NF Bold","MesloLGS NF Bold","file file_type_font",!0],["MesloLGS NF Italic","MesloLGS NF Italic","file file_type_font",!0],["MesloLGS NF Regular","MesloLGS NF Regular","file file_type_font",!0]],ea="deepseek",Ws=[["deepseek","Deepseek","deepseek",!0],["chatgpt","ChatGPT","chatgpt",!0],["gemini-pro","Gemini Pro","gemini",!0],["local-llm","Local LLM(ollama)","icon phone_android",!0]];var au=it(qc()),hu=it(_i()),lu=it(Un()),cu=it(Jc()),uu=it(Yc()),du=it(Zc()),fu=it(eu()),_u=it(tu()),gu=it(iu()),pu=it(ru()),Co=it(su());var Ci=class{constructor(i={}){this._fallbackLigatures=i.fallbackLigatures||["<--","<---","<<-","<-","->","->>","-->","--->","<==","<===","<<=","<=","=>","=>>","==>","===>",">=",">>=","<->","<-->","<--->","<---->","<=>","<==>","<===>","<====>","<~~","<~","~>","~~>","::",":::","==","!=","===","!==",":=",":-",":+","<*","<*>","*>","<|","<|>","|>","+:","-:","=:",":>","++","+++","<!--","<!---","<***>"].sort((r,s)=>s.length-r.length),this._characterJoinerId=void 0,this._terminal=void 0}activate(i){this._terminal=i,this._characterJoinerId=i.registerCharacterJoiner(this._joinCharacters.bind(this)),i.element.style.fontFeatureSettings='"liga" on, "calt" on'}dispose(){this._characterJoinerId!==void 0&&(this._terminal?.deregisterCharacterJoiner(this._characterJoinerId),this._characterJoinerId=void 0),this._terminal?.element&&(this._terminal.element.style.fontFeatureSettings="")}_joinCharacters(i){return this._findLigatureRanges(i,this._fallbackLigatures)}_findLigatureRanges(i,r){let s=[];for(let c=0;c<i.length;c++)for(let t of r)if(i.startsWith(t,c)){s.push([c,c+t.length]),c+=t.length-1;break}return s}};var nu=acode.require("confirm"),Ee=acode.require("settings"),Ao=acode.require("fsOperation"),_p=acode.require("toInternalUrl"),ou=acode.require("select"),pt=acode.require("loader"),gp=acode.require("dialogBox"),pp=acode.require("page"),vp=acode.require("actionStack"),{clipboard:wo}=cordova.plugins,cr=class{isDragging=!1;startY;startHeight;isFlotBtnDragging=!1;btnStartPosX;btnStartPosY;isTerminalMinimized=!1;isTerminalOpened=!1;previousTerminalHeight;pid;terminal=null;socket=null;$fitAddon=void 0;isSelecting=!1;isTapAndHoldActive=!1;tapHoldTimeout=null;selectionStart=null;selectionEnd=null;lastTapTime=0;tapThreshold=300;touchStartY=0;touchStartTime=0;scrollThreshold=10;scrollTimeThreshold=100;constructor(){Ee.value[mt.id]?Object.prototype.hasOwnProperty.call(this.settings,"fontLigatures")||(delete Ee.value[mt.id],Ee.update(!1),this._saveSetting()):this._saveSetting()}async init(i,r,s){try{await Ao(`${window.DATA_STORAGE}acodex_fonts`).exists()||Lo(Ao,pt);let c=window.IS_FREE_VERSION?"https://localhost/__cdvfile_sdcard__/Android/data/com.foxdebug.acodefree/files/acodex_fonts/":"https://localhost/__cdvfile_sdcard__/Android/data/com.foxdebug.acode/files/acodex_fonts/";this.xtermCss=tag("link",{rel:"stylesheet",href:`${this.baseUrl}xterm.css`}),this.$style=tag("link",{rel:"stylesheet",href:`${this.baseUrl}main.css`}),this.$fontStyleSheet=tag("style",{textContent:Io(c)}),this._loadCustomFontStyleSheet(),document.head.append(this.xtermCss,this.$style,this.$fontStyleSheet),editorManager.editor.commands.addCommand({name:"acodex:open_terminal",description:"Open Terminal",bindKey:{win:"Ctrl-K"},exec:()=>{this.isTerminalOpened&&this.isTerminalMinimized?this.maxmise():this.openTerminalPanel(270,this.settings.port)}}),editorManager.editor.commands.addCommand({name:"acodex:close_terminal",description:"Close Terminal",bindKey:{win:"Ctrl-J"},exec:this.closeTerminal.bind(this)}),editorManager.editor.commands.addCommand({name:"acodex:maximise_terminal",description:"Maximise Terminal",bindKey:{win:"Ctrl-Shift-T"},exec:()=>{this.isTerminalOpened&&this.isTerminalMinimized?this.maxmise():this.minimise()}}),this.$terminalContainer=tag("div",{className:"terminal-panel"}),this.$terminalHeader=tag("div",{className:"terminal-title-bar"});let t=tag("div",{className:"left-section"}),n=tag("div",{className:"session-info"}),h=tag("div",{className:"pointer-indicator",ariaHidden:!0});this.$terminalTitle=tag("h3",{textContent:"AcodeX 1",className:"session-name"}),n.append(h,this.$terminalTitle),t.append(n);let g=tag("div",{className:"btn-section"}),a=tag("button",{className:"action-button new-session",ariaLabel:"New Session"});a.innerHTML='<svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" height="1.5em" width="1.5em"><path fill="currentColor" d="M24 38q-.65 0-1.075-.425-.425-.425-.425-1.075v-11h-11q-.65 0-1.075-.425Q10 24.65 10 24q0-.65.425-1.075.425-.425 1.075-.425h11v-11q0-.65.425-1.075Q23.35 10 24 10q.65 0 1.075.425.425.425.425 1.075v11h11q.65 0 1.075.425Q38 23.35 38 24q0 .65-.425 1.075-.425.425-1.075.425h-11v11q0 .65-.425 1.075Q24.65 38 24 38Z"/></svg>',this.$searchBtn=tag("button",{className:"action-button search-btn",ariaLabel:"Search"}),this.$searchBtn.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search-code"><path d="m9 9-2 2 2 2"/><path d="m13 13 2-2-2-2"/><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>',this.$cdBtn=tag("button",{className:"action-button folder-icon",ariaLabel:"Navigate to Folder"}),this.$cdBtn.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-folder2-open" viewBox="0 0 16 16"><path d="M1 3.5A1.5 1.5 0 0 1 2.5 2h2.764c.958 0 1.76.56 2.311 1.184C7.985 3.648 8.48 4 9 4h4.5A1.5 1.5 0 0 1 15 5.5v.64c.57.265.94.876.856 1.546l-.64 5.124A2.5 2.5 0 0 1 12.733 15H3.266a2.5 2.5 0 0 1-2.481-2.19l-.64-5.124A1.5 1.5 0 0 1 1 6.14V3.5zM2 6h12v-.5a.5.5 0 0 0-.5-.5H9c-.964 0-1.71-.629-2.174-1.154C6.374 3.334 5.82 3 5.264 3H2.5a.5.5 0 0 0-.5.5V6zm-.367 1a.5.5 0 0 0-.496.562l.64 5.124A1.5 1.5 0 0 0 3.266 14h9.468a1.5 1.5 0 0 0 1.489-1.314l.64-5.124A.5.5 0 0 0 14.367 7H1.633z"/></svg>',this.$minimizeBtn=tag("button",{className:"action-button minimize",ariaLabel:"Minimize"}),this.$minimizeBtn.innerHTML='<svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" height="1.5em" width="1.5em"><path fill="currentColor" d="M24 24.75q-.3 0-.55-.1-.25-.1-.5-.35l-9.9-9.9q-.45-.45-.45-1.05 0-.6.45-1.05.45-.45 1.05-.45.6 0 1.05.45L24 21.15l8.85-8.85q.45-.45 1.05-.45.6 0 1.05.45.45.45.45 1.05 0 .6-.45 1.05l-9.9 9.9q-.25.25-.5.35-.25.1-.55.1Zm0 12.65q-.3 0-.55-.1-.25-.1-.5-.35l-9.9-9.9q-.45-.45-.45-1.05 0-.6.45-1.05.45-.45 1.05-.45.6 0 1.05.45L24 33.8l8.85-8.85q.45-.45 1.05-.45.6 0 1.05.45.45.45.45 1.05 0 .6-.45 1.05l-9.9 9.9q-.25.25-.5.35-.25.1-.55.1Z"/></svg>',this.$closeTermBtn=tag("button",{className:"action-button close",ariaLabel:"Close Terminal"}),this.$closeTermBtn.innerHTML='<svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" height="1.5em" width="1.5em"><path fill="currentColor" d="M24 26.1 13.5 36.6q-.45.45-1.05.45-.6 0-1.05-.45-.45-.45-.45-1.05 0-.6.45-1.05L21.9 24 11.4 13.5q-.45-.45-.45-1.05 0-.6.45-1.05.45-.45 1.05-.45.6 0 1.05.45L24 21.9l10.5-10.5q.45-.45 1.05-.45.6 0 1.05.45.45.45.45 1.05 0 .6-.45 1.05L26.1 24l10.5 10.5q.45.45.45 1.05 0 .6-.45 1.05-.45.45-1.05.45-.6 0-1.05-.45Z"/></svg>',this.$searchInputContainer=tag("div",{className:"search-input-container"}),this.$searchInputContainer.append(tag("button",{className:"action-button find-previous",ariaLabel:"Find Previous",innerHTML:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>',onclick:this._findPreviousMatchofSearch.bind(this)}),tag("input",{type:"text",placeholder:"Find...",ariaLabel:"Search input",oninput:l=>{this.$searchAddon?.findNext(l.target.value)}}),tag("button",{className:"action-button find-next",ariaLabel:"Find Next",innerHTML:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>',onclick:this._findNextMatchofSearch.bind(this)})),this.settings.enableGuiViewer&&this.setupGUIViewerPage(),g.append(a,this.settings.enableGuiViewer?this.createGUIViewerBtn():"",this.$searchBtn,this.$cdBtn,this.$minimizeBtn,this.$closeTermBtn,this.$searchInputContainer),this.$terminalHeader.append(t,g),this.$terminalContent=tag("div",{className:"terminal-content"}),this.startHandle=tag("div",{className:"selection-handle selection-start-handle"}),this.endHandle=tag("div",{className:"selection-handle selection-end-handle"}),this.$terminalContainer.append(this.$terminalHeader,this.$terminalContent),this.$showTermBtn=tag("button",{className:"show-terminal-btn",innerHTML:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-terminal"><polyline points="4 17 10 11 4 5"/><line x1="12" x2="20" y1="19" y2="19"/></svg>'}),app.get("main")&&app.get("main").append(this.$terminalContainer,this.startHandle,this.endHandle,this.settings.showTerminalBtn?this.$showTermBtn:""),this.$showTermBtn?.classList.add("hide"),this.$terminalContainer?.classList.add("hide"),this.settings.showTerminalBtnSize&&this.settings.showTerminalBtn&&(this.$showTermBtn.style.height=`${this.settings.showTerminalBtnSize}px`,this.$showTermBtn.style.width=`${this.settings.showTerminalBtnSize}px`),this.$cacheFile=r,this.$terminalHeader.addEventListener("mousedown",this.startDragging.bind(this)),this.$terminalHeader.addEventListener("touchstart",this.startDragging.bind(this)),a.addEventListener("click",this.createSession.bind(this)),this.$searchBtn.addEventListener("click",()=>{let l=this.$searchInputContainer.querySelector("input");this.$searchInputContainer.classList.toggle("show"),this.$searchInputContainer.classList.contains("show")?(a.style.display="none",this.settings.enableGuiViewer&&(document.querySelector(".action-button.gui-viewer").style.display="none"),this.$cdBtn.style.display="none",this.$minimizeBtn.style.display="none",this.$closeTermBtn.style.display="none",l.addEventListener("click",()=>{l.focus()})):(this.$searchAddon?.clearDecorations(),this.$searchAddon?.clearActiveDecoration(),a.style.display="block",this.settings.enableGuiViewer&&(document.querySelector(".action-button.gui-viewer").style.display="block"),this.$cdBtn.style.display="block",this.$minimizeBtn.style.display="block",this.$closeTermBtn.style.display="block")}),this.$terminalTitle.addEventListener("click",async l=>{let _,v=await this.$cacheFile.readFile("utf8"),u=JSON.parse(v);Array.isArray(u)?_=u.map(f=>f.name):_=[];let o={hideOnSelect:!0,default:localStorage.getItem("AcodeX_Current_Session")},d=await ou("AcodeX Sessions",_,o);d&&this.changeSession(d)}),this.$closeTermBtn.addEventListener("click",this.closeTerminal.bind(this)),this.$minimizeBtn.addEventListener("click",this.minimise.bind(this)),this.$cdBtn.addEventListener("click",this._cdToActiveDir.bind(this)),this.settings.showTerminalBtn&&(this.$showTermBtn.addEventListener("mousedown",this.startDraggingFloatingBtn.bind(this)),document.addEventListener("mousemove",this.dragFlotButton.bind(this)),document.addEventListener("mouseup",this.startDraggingFloatingBtn.bind(this)),this.$showTermBtn.addEventListener("touchstart",this.startDraggingFloatingBtn.bind(this)),document.addEventListener("touchmove",this.dragFlotButton.bind(this)),document.addEventListener("touchend",this.stopDraggingFlotBtn.bind(this)),this.$showTermBtn.addEventListener("click",this.maxmise.bind(this))),window.addEventListener("mousemove",this.drag.bind(this)),window.addEventListener("touchmove",this.drag.bind(this)),window.addEventListener("mouseup",this.stopDragging.bind(this)),window.addEventListener("touchend",this.stopDragging.bind(this)),window.addEventListener("resize",()=>{if(this.$terminalContainer){if(!this.$terminalContainer.classList.contains("hide")){let _=document.querySelector("#root header")?.offsetHeight,v=document.querySelector("#root ul")?.offsetHeight||0,u=_+v,o=document.querySelector("#quick-tools")?.offsetHeight||0,d=window.innerHeight-(u+o),f=Number.parseInt(this.$terminalContainer.style.height),p=Math.min(f,d);this.$terminalContainer.style.height=`${p}px`,localStorage.setItem("AcodeX_Terminal_Cont_Height",this.$terminalContainer.offsetHeight)}let l=this.$terminal?.getSelection();l&&l.length>0&&this.updateHandles()}if(this.$showTermBtn&&this.settings.showTerminalBtn&&!this.$showTermBtn.classList.contains("hide")){let l=document.querySelector("#root header")?.offsetHeight,_=document.querySelector("#root ul")?.offsetHeight||0,v=l+_,u=window.innerHeight-v-this.$showTermBtn.offsetHeight,o=Number.parseInt(this.$showTermBtn.style.bottom);this.$showTermBtn.style.bottom=`${Math.max(0,Math.min(u,o))}px`}}),localStorage.getItem("AcodeX_Is_Opened")==="true"&&localStorage.getItem("AcodeX_Current_Session")&&await this.openTerminalPanel(localStorage.getItem("AcodeX_Terminal_Cont_Height")||270,this.settings.port),acode.define("acodex",{execute:(l,_=!0)=>{try{if(!this.isTerminalOpened)return;this.socket?.send(_?`${l}\r`:l)}catch(v){throw Error(v)}},isMinimized:()=>this.isTerminalMinimized,isTerminalOpened:()=>this.isTerminalOpened,maximiseTerminal:()=>{this.isTerminalOpened&&this.isTerminalMinimized&&this.maxmise()},openTerminal:async(l=270,_=this.settings.port)=>{if(!this.isTerminalOpened){let v=await this.openTerminalPanel(l,_);return{onmessage:u=>{v&&(v.onmessage=o=>u(typeof o.data=="string"?o.data:new Uint8Array(o.data)))},write:(u,o=!0)=>{let d=o?`${u}\r`:u;v.send(d)}}}},createSession:async()=>{if(this.isTerminalOpened){let l=await this.createSession();return{onmessage:_=>{l&&(l.onmessage=v=>_(typeof v.data=="string"?v.data:new Uint8Array(v.data)))},write:(_,v=!0)=>{let u=v?`${_}\r`:_;l.send(u)}}}},changeSession:async l=>{if(this.isTerminalOpened){let _=await this.changeSession(l);return{onmessage:v=>{_&&(_.onmessage=u=>v(typeof u.data=="string"?u.data:new Uint8Array(u.data)))},write:(v,u=!0)=>{let o=u?`${v}\r`:v;_.send(o)}}}},closeTerminal:()=>{this.isTerminalOpened&&this.closeTerminal()},convertAcodeUriToTermReadable:l=>fr(l),addTheme:(l,_)=>{$s.push(l),xe[l]=_},applyTheme:l=>{this.settings.theme=l,Ee.update()}})}catch(c){console.log(c)}}createGUIViewerBtn(){let i=tag("button",{className:"action-button gui-viewer",ariaLabel:"Open GUI Viewer"});return i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-image-play"><path d="m11 16-5 5"/><path d="M11 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v6.5"/><path d="M15.765 22a.5.5 0 0 1-.765-.424V13.38a.5.5 0 0 1 .765-.424l5.878 3.674a1 1 0 0 1 0 1.696z"/><circle cx="9" cy="9" r="2"/></svg>',i.onclick=this.openViewerPage.bind(this),i}setupGUIViewerPage(){let i=tag("span",{className:"icon clearclose",dataset:{action:"close-btn"}});this.displayVar=tag("span",{textContent:"Display: ",dataset:{action:"copy-display-num"}}),this.displayVar.onclick=()=>{wo.copy(`export DISPLAY=${this.displayVariable};`),acode.alert("AcodeX","Copied the display, just execute the copied command in your current terminal session.")},this.$page=pp("AcodeX GUI Viewer",{lead:i,tail:this.displayVar}),this.$page.id="acodex-gui-viewer",this.$page.show=()=>{vp.push({id:mt.id,action:this.$page.hide}),app.append(this.$page),this.$page.querySelector(".gui-viewer-canvas").appendChild(this._hiddenInput)},i.onclick=()=>{this.rfb.disconnect(),s.innerHTML="",this.$page.hide()},document.addEventListener("backbutton",()=>{document.contains(this.$page)&&(this.rfb.disconnect(),s.innerHTML="",this.$page.hide())},!1);let r=tag("span",{className:"icon keyboard_hide",dataset:{action:"show-keyboard"}});this.$page.header.append(r);let s=tag("div",{className:"gui-viewer-canvas"});this.$page.body.append(s),this._hiddenInput=tag("textarea",{autocapitalize:"off",autocomplete:"off",spellcheck:"false",tabindex:"-1"}),this._hiddenInput.style.position="absolute",this._hiddenInput.style.opacity="0",this._hiddenInput.style.height="0px",this._hiddenInput.style.width="0px",this._hiddenInput.style.zIndex="-1",this._hiddenInput.style.imeMode="disabled",this.$page.querySelector(".gui-viewer-canvas").appendChild(this._hiddenInput),r.onclick=()=>{this._hiddenInput.focus()};function c(t){let n=t.target.value,h=t.target.dataset.lastValue||"",g;try{g=Math.max(t.target.selectionStart,n.length)}catch{g=n.length}let a=h.length,l=g-a,_=l<0?-l:0;for(let v=0;v<Math.min(a,g);v++)if(n.charAt(v)!==h.charAt(v)){l=g-v,_=a-v;break}for(let v=0;v<_;v++)this.rfb.sendKey(hu.default.XK_BackSpace,"Backspace");for(let v=g-l;v<g;v++){let u=n.charCodeAt(v),o=lu.default.lookup(u);o&&this.rfb.sendKey(o)}t.target.dataset.lastValue=n}this._hiddenInput.addEventListener("input",c.bind(this))}async openViewerPage(){pt.showTitleLoader();let i=/(?:bash|zsh|sh|.*):(?:\s*line \d+:)?\s*\w+:? command not found|not found/;try{if(this.rfb)pt?.removeTitleLoader(),this.$page.show();else{let r=await this.executeCommandOnPty("vncserver --help");if(i.test(r.output))pt?.removeTitleLoader(),acode.alert("AcodeX Error","vncserver not found, First go head and read readme of acodex regarding 'Gui Setup'. To setup it");else{let s=await this.executeCommandOnPty("vncserver -list");if(/:\d+\s+\t+\d+/.test(s.output))this.displayVariable=s.output.match(/:(\d+)/)[0],this.connectVncServer(this.displayVariable);else if(/TigerVNC server sessions:\s+X DISPLAY #\tPROCESS ID/.test(s.output)){let c=await this.executeCommandOnPty("vncserver"),t=/New 'localhost:(\d+)/,n=c.output.match(t);n?(this.displayVariable=`:${n[1]}`,this.connectVncServer(this.displayVariable)):(pt?.removeTitleLoader(),acode.alert("AcodeX Error","Failed to create new vnc server session, try creating it manually by executing: `vncserver` command"))}else throw new Error("Unexpected output from vncserver -list.")}}}catch(r){pt?.removeTitleLoader(),console.error("Error executing command:",r),acode.alert("AcodeX Error",r.message)}}async connectVncServer(i){try{let r=/(?:bash|zsh|sh|.*):(?:\s*line \d+:)?\s*\w+:? command not found|not found/,s=await this.executeCommandOnPty("websockify_rs");if(r.test(s.output)&&acode.alert("AcodeX Warning","websockify_rs not found, which acts as a proxy. Go ahead and install it(Check readme for guide)."),(await this.executeCommandOnPty("ps aux | grep websockify_rs | grep -v grep")).output===""){let t=5900+Number.parseInt(i.split(":")[1]),n=localStorage.getItem("AcodeX_Current_Session");await(await this.createSession()).send(`websockify_rs localhost:6778 localhost:${t}\r`),await this.changeSession(n),await this.waitForWebsockifyToStart()}this.bindNoVnc()}catch(r){pt?.removeTitleLoader(),console.error("Error in connecting to vnc server:",r),acode.alert("AcodeX Error",r.message)}}async waitForWebsockifyToStart(){let i=5,r=s=>new Promise(c=>setTimeout(c,s));for(;i>0;){if((await this.executeCommandOnPty("ps aux | grep websockify_rs | grep -v grep")).output!==""){console.log("AcodeX: Websockify_rs started successfully.");return}i--,console.log("AcodeX: Waiting for websockify_rs to start..."),await r(1e3)}throw new Error("AcodeX: Failed to start websockify_rs within the timeout period.")}async bindNoVnc(){try{this.rfb=new au.default(this.$page.querySelector(".gui-viewer-canvas"),"ws://localhost:6778/"),this.rfb.scaleViewport=!0,this.rfb.clipViewport=!0;let r=getComputedStyle(document.documentElement).getPropertyValue("--secondary-color").trim();this.rfb.background=r||"",this.rfb.addEventListener("connect",()=>{this.$page.show(),pt?.removeTitleLoader(),this.displayVar.textContent=`Display: ${this.displayVariable.split(":")[1]}`}),this.rfb.addEventListener("disconnect",()=>{this.rfb=void 0,this.$page?.hide(),pt?.removeTitleLoader()}),this.rfb.addEventListener("credentialsrequired",async()=>{let s;if(localStorage.getItem("VNC_PASS"))s=localStorage.getItem("VNC_PASS");else{if(s=await acode.prompt("Enter vncserver password:","","text"),!s)return;localStorage.setItem("VNC_PASS",s)}this.rfb?.sendCredentials({password:s})}),this.rfb.addEventListener("securityfailure",s=>{acode.alert("AcodeX Error",`Security failure: ${s.detail.reason}`),console.error("Security failure:",s.detail),localStorage.removeItem("VNC_PASS")}),this.rfb.addEventListener("serververification",s=>{acode.alert("AcodeX Error",`Server verification failed: ${JSON.stringify(s.detail)}`),console.error("Server verification failed:",s)})}catch(i){pt?.removeTitleLoader(),console.error("Error novnc:",i),acode.alert("AcodeX Error",i.message)}}async executeCommandOnPty(i){let r=await fetch(`http://${this.settings.serverHost}:${this.settings.port}/execute-command`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({command:i})});if(!r.ok)throw new Error(`Request failed with status: ${r.status}`);return await r.json()}async openTerminalPanel(i,r){if(!r)return;document.querySelector(".terminal-panel")||app.get("main").append(this.$terminalContainer,this.$showTermBtn,this.startHandle,this.endHandle),this.settings.port=r,Ee.update(!1),this.$terminalContainer.classList.remove("hide"),this.isTerminalOpened=!0,this.$terminalContainer.style.height=`${i}px`,this.$terminalContent.style.width="100%",this.$terminalContent.style.height=`calc(100% - ${this.$terminalContainer.offsetHeight}px)`,this.settings.transparency?(this.$terminalContainer.style.background="transparent",this.$terminalContainer.style.backdropFilter=`blur(${this.settings.blurValue})`,this.$terminalHeader.style.background=Eo(this.$terminalHeader),this.$terminalHeader.style.backdropFilter=`blur(${this.settings.blurValue})`):(this.$terminalContainer.style.background="var(--popup-background-color)",this.$terminalHeader.style.background="var(--primary-color)");let s;return localStorage.getItem("AcodeX_Current_Session")?s=await this.changeSession(localStorage.getItem("AcodeX_Current_Session"),!0):(this.$terminalContent.innerHTML="",s=await this.createSession()),s}async createXtermTerminal(i){if(this.$terminal=this.terminalObj,this.$fitAddon=new uu.FitAddon,this.$webglAddon=new du.WebglAddon,this.$unicode11Addon=new _u.Unicode11Addon,this.$webLinkAddon=new fu.WebLinksAddon(async(r,s)=>{await nu("AcodeX Link",`Do you want to open ${s} in browser?`)&&system.openInBrowser(s)}),this.$searchAddon=new pu.SearchAddon,this.settings.imageRendering&&(this.$imageAddon=new Co.ImageAddon,this.$terminal.loadAddon(this.$imageAddon)),this.$terminal.loadAddon(this.$fitAddon),this.$terminal.loadAddon(this.$unicode11Addon),this.$terminal.loadAddon(this.$webLinkAddon),this.$terminal.loadAddon(this.$searchAddon),this.fitTerminal(),this.$webglAddon)try{this.$terminal.loadAddon(this.$webglAddon),this.$terminal.open(this.$terminalContent)}catch(r){window.toast(`error during loading webgl addon: ${r}`,4e3),this.$webglAddon.dispose(),this.$webglAddon=void 0}this.$terminal.element||this.$terminal.open(this.$terminalContent),this.settings.fontLigatures&&(this.$ligatureAddon=new Ci,this.$terminal.loadAddon(this.$ligatureAddon)),this.$terminal.focus(),this._updateTerminalHeight()}async attachSocketToXterm(i,r){this.$terminal.onResize(async t=>{if(!r)return;let n=t.cols.toString(),h=t.rows.toString(),g=`http://${this.settings.serverHost}:${i}/terminals/${r}/resize`;await fetch(g,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cols:n,rows:h})})}),this.socket=new WebSocket(`ws://${this.settings.serverHost}:${i}/terminals/${r}`),this.socket.onopen=()=>{this.$attachAddon=new gu.AttachAddon(this.socket),this.$terminal.loadAddon(this.$attachAddon),this.$terminal.unicode.activeVersion="11",this._updateTerminalHeight(),localStorage.setItem("AcodeX_Is_Opened",this.isTerminalOpened),localStorage.setItem("AcodeX_Terminal_Cont_Height",this.$terminalContainer.offsetHeight),localStorage.getItem("AcodeX_Terminal_Is_Minimised")==="true"&&this.minimise(),this._updateTerminalHeight(),this.startHandle.addEventListener("touchmove",this.startHandleTouchMoveCb.bind(this)),this.endHandle.addEventListener("touchmove",this.endHandleTouchMoveCb.bind(this)),this.$terminal.element.addEventListener("touchstart",this.terminalTouchStartCb.bind(this)),this.$terminal.element.addEventListener("touchmove",this.terminalTouchMoveCb.bind(this)),this.$terminal.element.addEventListener("touchend",this.terminalTouchEndCb.bind(this)),this.$terminal.onSelectionChange(this.terminalSelectionChangeCb.bind(this)),document.addEventListener("click",this.removeSelectionCb.bind(this))},this.socket.onclose=async t=>{try{let n=await fetch(`http://${this.settings.serverHost}:${i}/`);n.ok||console.warn("Server responded with an error:",n.status,n.statusText);return}catch{this.removeTerminal(),acode.alert("AcodeX Server","Disconnected from server because server gets closed \u{1F61E}!")}},this.socket.onerror=t=>{acode.alert("AcodeX Error",JSON.stringify(t))},this.$terminal.attachCustomKeyEventHandler(async t=>{if(t.type==="keydown"){let n=await this.$cacheFile.readFile("utf8"),h=n?JSON.parse(n):[];if(t.ctrlKey&&(t.key==="N"||t.key==="n"))return this.createSession(),!1;if(t.ctrlKey&&(t.key==="W"||t.key==="w"))return this.closeTerminal(),!1;if(t.ctrlKey&&t.shiftKey&&(t.key==="T"||t.key==="t"))return this.isTerminalMinimized||this.minimise(),!1;if(t.ctrlKey&&t.shiftKey&&(t.key==="V"||t.key==="v"))return wo.paste(g=>{this.$terminal?.paste(g)}),!1;if(t.ctrlKey&&t.keyCode>=49&&t.keyCode<=53){let g=t.keyCode-49;if(h.length>g){let a=h[g];return this.changeSession(a.name),!1}}if(t.ctrlKey&&t.key==="ArrowLeft"){let g=h.findIndex(a=>a.name===localStorage.getItem("AcodeX_Current_Session"));if(g>0){let a=h[g-1];return this.changeSession(a.name),!1}}if(t.ctrlKey&&t.key==="ArrowRight"){let g=h.findIndex(a=>a.name===localStorage.getItem("AcodeX_Current_Session"));if(g<h.length-1){let a=h[g+1];return this.changeSession(a.name),!1}}if(t.ctrlKey&&t.key==="+")return this.$terminal.options.fontSize=this.$terminal.options.fontSize+1,this.$terminal.refresh(0,this.$terminal.rows-1),this.settings.fontSize=this.$terminal.options.fontSize,Ee.update(!1),!1;if(t.ctrlKey&&t.key==="-"){let g=this.$terminal.options.fontSize-1;return g<1?void 0:(this.$terminal.options.fontSize=g,this.$terminal.refresh(0,this.$terminal.rows-1),this.settings.fontSize=this.$terminal.options.fontSize,Ee.update(!1),!1)}if(t.ctrlKey&&t.shiftKey&&(t.key==="c"||t.key==="C")){if(!this.$terminal?.hasSelection())return;let g=this.$terminal?.getSelection();return g&&wo.copy(g),window.toast("Copied \u2705",3e3),this.$terminal.focus(),!1}if(t.ctrlKey&&t.shiftKey&&(t.key==="i"||t.key==="I"))return this.$terminal?.clear(),this.socket?.send("clear\r"),!1;if(t.ctrlKey&&(t.key==="a"||t.key==="A"))return this.$terminal?.selectAll(),!1}});let s="",c=!0;this.$terminal.onData(t=>{if(t==="\x7F"){s.trim()===""?c=!0:(s=s.slice(0,-1),c=s.trim()==="");return}let n=ko(t);s+=n,n.startsWith("#")&&c&&this.openAIPromptPopup(),t==="\r"&&(s.trim().toLowerCase()==="exit"&&(console.log("Exiting current session..."),this.terminalCloseHandler()),s="",c=!0),c=s.trim()===""})}_getCellSize(){let i=this.$terminal._core._renderService.dimensions;return{cellWidth:i.css.cell.width,cellHeight:i.css.cell.height}}getTouchCoordinates(i){let r=this.$terminal.element.getBoundingClientRect(),s=i.touches[0],c=s.clientX-r.left,t=s.clientY-r.top,{cellWidth:n,cellHeight:h}=this._getCellSize(),g=this.$terminal.buffer.active.viewportY,a=Math.floor(c/n);return{row:Math.floor(t/h)+g,column:a}}setHandlePosition(i,r,s,c=!1){let{cellWidth:t,cellHeight:n}=this._getCellSize(),h=this.$terminal.element.getBoundingClientRect(),g=this.$terminalContainer,a=this.$terminalHeader,l=g.getBoundingClientRect(),_=a?a.getBoundingClientRect().height:0,v=this.$terminal.element.scrollTop||0,u=this.$terminal.buffer.active.viewportY,o=r-u,d=c?h.left+s*t-10:h.left+(s+1)*t-t,f=h.top+o*n-_-v-n;(this.selectionStart.row>this.selectionEnd.row||this.selectionStart.row===this.selectionEnd.row&&this.selectionStart.column>this.selectionEnd.column)&&(d=c?h.left+(s+1)*t-t:h.left+s*t-10),d=Math.max(h.left,Math.min(d,h.right-i.offsetWidth)),f=Math.max(l.top-_,Math.min(f,l.bottom-i.offsetHeight-document.querySelector("#quick-tools")?.offsetHeight||0)),i.style.left=`${d}px`,i.style.top=`${f}px`,i.style.display="block"}hideHandles(){this.startHandle.style.display="none",this.endHandle.style.display="none"}showHandles(){this.startHandle.style.display="block",this.endHandle.style.display="block"}startSelection(i,r){this.selectionStart={row:i,column:r},this.selectionEnd={row:i,column:r},this.isSelecting=!0,this.$terminal.clearSelection(),this.$terminal.select(r,i,1),this.setHandlePosition(this.startHandle,i,r,!0),this.setHandlePosition(this.endHandle,i,r)}updateSelection(){this.$terminal.clearSelection();let i=this.selectionStart.row,r=this.selectionStart.column,s=this.selectionEnd.row,c=this.selectionEnd.column;(i>s||i===s&&r>c)&&([i,r,s,c]=[s,c,i,r]);let t=this._calculateTotalSelectionLength(i,s,r,c);this.$terminal.select(r,i,t),this.setHandlePosition(this.startHandle,this.selectionStart.row,this.selectionStart.column,!0),this.setHandlePosition(this.endHandle,this.selectionEnd.row,this.selectionEnd.column)}updateHandles(){this.setHandlePosition(this.startHandle,this.selectionStart.row,this.selectionStart.column,!0),this.setHandlePosition(this.endHandle,this.selectionEnd.row,this.selectionEnd.column)}_calculateTotalSelectionLength(i,r,s,c){let t=this.$terminal.cols;if(i===r)return Math.abs(c-s)+1;let n=0;return n+=t-s,n+=(r-i-1)*t,n+=c+1,n}startHandleTouchMoveCb(i){i.preventDefault();let r=this.getTouchCoordinates(i);r&&(this.selectionStart=r,this.updateSelection())}endHandleTouchMoveCb(i){i.preventDefault();let r=this.getTouchCoordinates(i);r&&(this.selectionEnd=r,this.updateSelection())}terminalTouchStartCb(i){this.touchStartY=i.touches[0].clientY,this.touchStartTime=Date.now();let r=this.getTouchCoordinates(i);r&&(this.isTapAndHoldActive=!1,this.tapHoldTimeout=setTimeout(()=>{this.settings.selectionHaptics&&navigator.vibrate(300),this.isTapAndHoldActive=!0,this.$terminal.focus(),this.startSelection(r.row,r.column)},500))}terminalTouchMoveCb(i){if(this.isSelecting){i.preventDefault();let r=this.getTouchCoordinates(i);if(!r)return;this.selectionEnd=r,this.updateSelection()}else{let r=i.touches[0].clientY,s=Math.abs(r-this.touchStartY),c=Date.now()-this.touchStartTime;s>this.scrollThreshold&&c<this.scrollTimeThreshold&&clearTimeout(this.tapHoldTimeout)}}terminalTouchEndCb(i){clearTimeout(this.tapHoldTimeout)}terminalSelectionChangeCb(){let i=this.$terminal.getSelection();i&&i.length>0||(this.hideHandles(),this.isSelecting=!1)}removeSelectionCb(i){this.$terminal?.element.contains(i.target)||(this.isSelecting=!1,this.$terminal?.clearSelection(),this.hideHandles())}async getOllamaModel(i){let r=localStorage.getItem("ACODEX_LOCAL_LLM_MODEL");if(r)return r;try{let s=await i.getListOfOllamaModels();if(!Array.isArray(s))throw new Error("Failed to fetch Ollama models");let c=await ou("Select Local Model",s);return c?(localStorage.setItem("ACODEX_LOCAL_LLM_MODEL",c),c):null}catch(s){return console.error("Error getting Ollama models:",s),acode.alert("Error","Failed to fetch Ollama models"),null}}async openAIPromptPopup(){let i=new Xo(this.settings.aiModel===Ws[3][0]?null:this.settings.aiApiKey),r;if(this.settings.aiModel==="local-llm"&&(r=await this.getOllamaModel(i),!r))return;let s=gp("\u26A1 Ask  AcodeX Ai",`<textarea id="acodeXAiPromptBox" rows="2" placeholder="for eg: delete sample.txt file"></textarea>
			<div class="ai-loader-container">
        <div class="wave"></div>
        <div class="wave"></div>
        <div class="wave"></div>
        <div class="wave"></div>
        <div class="wave"></div>
			</div>`,"Start Magic \u2728");s.ok(async()=>{let c=document.querySelector("#acodeXAiPromptBox").value;if(!c){s.hide();return}document.querySelector(".ai-loader-container").style.display="flex",window.toast("Wait! To see the magic of AcodeX AI \u2728",2e3);try{let t="";switch(this.settings.aiModel){case"deepseek":{let{response:n,error:h}=await i.generateDeepseekResponse(c)}if(error){document.querySelector(".ai-loader-container").style.display="none",s.hide(),acode.alert("AcodeX AI Error",error.toString()),console.error("AcodeX AI Error:",error);return}t=response.choices[0].message.content;break;case"chatgpt":{let{response:n,error:h}=await i.generateChatgptResponse(c);if(h){document.querySelector(".ai-loader-container").style.display="none",s.hide(),acode.alert("AcodeX AI Error",h.toString()),console.error("AcodeX AI Error:",h);return}t=n.choices[0].message.content;break}case"gemini-pro":{let{response:n,error:h}=await i.generateGeminiResponse(c);if(h){document.querySelector(".ai-loader-container").style.display="none",s.hide(),acode.alert("AcodeX AI Error",h.toString()),console.error("AcodeX AI Error:",h);return}t=n.candidates[0].content.parts[0].text;break}case"local-llm":{t=(await i.generateOllamaResponse(r,c)).response;break}}if(!t){document.querySelector(".ai-loader-container").style.display="none",s.hide();return}this.socket?.send("\b"),this.socket?.send(t.trim()),document.querySelector(".ai-loader-container").style.display="none",s.hide()}catch(t){document.querySelector(".ai-loader-container").style.display="none",s?.hide(),console.error(t),acode.alert("AcodeX AI Error",JSON.stringify(t))}})}async createSession(){let i,r=await this.$cacheFile.readFile("utf8"),s=r?JSON.parse(r):[];if(s.length===0){if(await this.createXtermTerminal(this.settings.port),i=await this._generateProcessId(),!i)return;s=[{name:"AcodeX1",pid:i}]}else{this._hideTerminalSession();let n=`AcodeX${s.reduce((h,g)=>{let l=g.name.match(/^AcodeX(\d+)$/);if(l){let _=Number.parseInt(l[1],10);return Math.max(h,_)}return h},0)+1}`;if(await this.createXtermTerminal(this.settings.port),i=await this._generateProcessId(),!i)return;s.push({name:n,pid:i})}return await Promise.all([this.$cacheFile.writeFile(s),this.attachSocketToXterm(this.settings.port,i)]),this._updateTerminalHeight(),localStorage.setItem("AcodeX_Current_Session",s[s.length-1].name),this.$terminalTitle.textContent=s[s.length-1].name,window.toast(`Created Session: ${s[s.length-1].name}`,3e3),this.socket}_hideTerminalSession(){this.$attachAddon.dispose(),this.$fitAddon.dispose(),this.$unicode11Addon.dispose(),this.$webLinkAddon.dispose(),this.$searchAddon.dispose(),this.settings.imageRendering&&this.$imageAddon.dispose(),this.settings.fontLigatures&&this.$ligatureAddon.dispose(),this.$webglAddon.dispose(),this.$terminal.dispose(),this.socket.close(),this.socket=null,this.$terminal=void 0,this.$attachAddon=void 0,this.$fitAddon=void 0,this.$unicode11Addon=void 0,this.$webLinkAddon=void 0,this.$searchAddon=void 0,this.$imageAddon=void 0,this.$ligatureAddon=void 0,this.$webglAddon=void 0,this.$terminalContent.innerHTML=""}async _generateProcessId(){try{let i=this.$terminal.cols.toString(),r=this.$terminal.rows.toString(),s=await fetch(`http://${this.settings.serverHost}:${this.settings.port}/terminals`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cols:i,rows:r})});if(!s.ok)throw new Error("Failed to create terminal");return await s.text()}catch{this.$terminalContainer.classList.contains("hide")||this.$terminalContainer.classList.add("hide"),this.$showTermBtn.classList.contains("hide")||this.$showTermBtn.classList.add("hide"),this.isTerminalMinimized=!1,this.isTerminalOpened=!1,localStorage.setItem("AcodeX_Terminal_Is_Minimised",this.isTerminalMinimized),localStorage.setItem("AcodeX_Is_Opened",this.isTerminalOpened),this.$terminalContainer.style.height=this.previousTerminalHeight,localStorage.setItem("AcodeX_Terminal_Cont_Height",this.$terminalContainer.offsetHeight),localStorage.removeItem("AcodeX_Current_Session"),window.toast("Start the acodex server in termux first!",4e3)}}async changeSession(i,r=!1){if(r){await this.createXtermTerminal(this.settings.port);let c=await this._getPidBySessionName(i);if(!c){this.$terminalContainer.classList.contains("hide")||this.$terminalContainer.classList.add("hide"),this.$showTermBtn.classList.contains("hide")||this.$showTermBtn.classList.add("hide"),this.isTerminalMinimized=!1,this.isTerminalOpened=!1,localStorage.setItem("AcodeX_Terminal_Is_Minimised",this.isTerminalMinimized),localStorage.setItem("AcodeX_Is_Opened",this.isTerminalOpened),this.$terminalContainer.style.height=this.previousTerminalHeight,localStorage.setItem("AcodeX_Terminal_Cont_Height",this.$terminalContainer.offsetHeight),localStorage.removeItem("AcodeX_Current_Session"),window.toast("Oops! Something went wrong in the Core \u{1F614}",4e3);return}return await this.attachSocketToXterm(this.settings.port,c),localStorage.setItem("AcodeX_Current_Session",i),this.$terminalTitle.textContent=i,this.socket}if(i===localStorage.getItem("AcodeX_Current_Session"))return;let s=await this._getPidBySessionName(i);if(s)return this._hideTerminalSession(),await this.createXtermTerminal(this.settings.port),await this.attachSocketToXterm(this.settings.port,s),localStorage.setItem("AcodeX_Current_Session",i),this.$terminalTitle.textContent=i,this.socket}async _getPidBySessionName(i){let r=await this.$cacheFile.readFile("utf8"),s=r?JSON.parse(r):[];if(Array.isArray(s)){let c=s.find(t=>t.name===i);return c?c.pid:(console.log(`Error: Session '${i}' not found in JSON file.`),null)}return console.log("Error: Sessions data is not an array in JSON file."),null}_saveSetting(){Ee.value[mt.id]={port:8767,serverHost:"localhost",aiApiKey:"",aiModel:ea,transparency:Uo,selectionHaptics:$o,fontLigatures:Wo,enableGuiViewer:Ho,imageRendering:No,showTerminalBtnSize:Jo,showTerminalBtn:Yo,blurValue:"4px",cursorBlink:jo,cursorStyle:Hs[0],cursorInactiveStyle:Ns[0],fontSize:Go,fontFamily:zo,letterSpacing:0,fontWeight:Us[0],customFontStyleSheet:"",scrollBack:qo,scrollSensitivity:Vo,theme:ke,background:xe[ke].background,foreground:xe[ke].foreground,cursor:xe[ke].cursor||"",cursorAccent:xe[ke].cursorAccent||"",selectionBackground:xe[ke].selectionBackground,black:xe[ke].black,blue:xe[ke].blue,brightBlack:xe[ke].brightBlack,brightBlue:xe[ke].brightBlue,brightCyan:xe[ke].brightCyan,brightGreen:xe[ke].brightGreen,brightMagenta:xe[ke].brightMagenta,brightRed:xe[ke].brightWhite,brightWhite:xe[ke].brightWhite,brightYellow:xe[ke].brightYellow,cyan:xe[ke].cyan,green:xe[ke].green,magenta:xe[ke].magenta,red:xe[ke].red,white:xe[ke].white,yellow:xe[ke].yellow},Ee.update(!1)}_loadCustomFontStyleSheet(){if(this.settings.customFontStyleSheet!=="")if(document.querySelector("#customFontAcodeXStyleSheet"))document.querySelector("#customFontAcodeXStyleSheet").href=this.settings.customFontStyleSheet;else{let i=tag("link",{href:this.settings.customFontStyleSheet,rel:"stylesheet",id:"customFontAcodeXStyleSheet"});document.head.append(i)}}_updateTerminalHeight(){let i=this.$terminalHeader.offsetHeight;this.$terminalContent.style.height=`calc(100vh - ${i+1}px)`,localStorage.setItem("AcodeX_Terminal_Cont_Height",this.$terminalContainer.offsetHeight),this.fitTerminal()}fitTerminal(){let i=this.$fitAddon.proposeDimensions();i&&this.$terminal.resize(i.cols+2,i.rows+1)}async _getLastSessionName(){try{let i=await this.$cacheFile.readFile("utf8"),r=i?JSON.parse(i):[];return Array.isArray(r)&&r.length>0?r[r.length-1].name:(console.error("Error: No sessions found in JSON file or sessions data is not an array."),null)}catch(i){return console.error("Error reading or parsing JSON file:",i),null}}async removeTerminal(){this.$terminalContainer.classList.contains("hide")||(this.$terminalContainer.style.opacity=1),this.$terminalContainer.classList.add("hide"),this.$showTermBtn.classList.contains("hide")||this.$showTermBtn.classList.add("hide"),this.isTerminalMinimized=!1,this.isTerminalOpened=!1,localStorage.setItem("AcodeX_Terminal_Is_Minimised",this.isTerminalMinimized),localStorage.setItem("AcodeX_Is_Opened",this.isTerminalOpened),this.$terminalContainer.style.height=this.previousTerminalHeight,localStorage.setItem("AcodeX_Terminal_Cont_Height",this.$terminalContainer.offsetHeight),localStorage.removeItem("AcodeX_Current_Session"),await this.$cacheFile.writeFile("")}async terminalCloseHandler(){let i=await this.$cacheFile.readFile("utf8"),r=i?JSON.parse(i):[];if(r=r.filter(s=>s.name!==localStorage.getItem("AcodeX_Current_Session")),await this.$cacheFile.writeFile(r),r.length>0){let s=await this._getLastSessionName();this.changeSession(s)}else this._hideTerminalSession(),this.$terminalContainer.classList.contains("hide")||this.$terminalContainer.classList.add("hide"),this.$showTermBtn.classList.contains("hide")||this.$showTermBtn.classList.add("hide"),this.isTerminalMinimized=!1,this.isTerminalOpened=!1,this.rfb?.disconnect(),this.rfb=void 0,localStorage.removeItem("AcodeX_Current_Session"),localStorage.setItem("AcodeX_Terminal_Is_Minimised",this.isTerminalMinimized),localStorage.setItem("AcodeX_Is_Opened",this.isTerminalOpened),this.$terminalContainer.style.height=this.previousTerminalHeight,localStorage.setItem("AcodeX_Terminal_Cont_Height",this.$terminalContainer.offsetHeight)}async closeTerminal(){if(await nu("Warning","Are you sure ?")&&this.$terminal!=null&&localStorage.getItem("AcodeX_Current_Session")){let r=await this._getPidBySessionName(localStorage.getItem("AcodeX_Current_Session"));if(!r)return;fetch(`http://${this.settings.serverHost}:${this.settings.port}/terminals/${r}/terminate`,{method:"POST"}).then(async s=>{s.ok?this.terminalCloseHandler():(acode.alert("AcodeX Error",`Failed to close terminal ${this.pid}. Trying to force close it...`),this.removeTerminal())}).catch(async s=>{this.removeTerminal(),acode.alert("AcodeX Server","Disconnected from server because server gets closed \u{1F61E}!"),console.error(`Error while closing terminal ${this.pid}: ${s}`)})}}startDraggingFloatingBtn(i){try{this.isFlotBtnDragging=!0,this.$showTermBtn.style.border="2px solid #fff",i.type==="touchstart"?(this.btnStartPosX=i.touches[0].clientX,this.btnStartPosY=i.touches[0].clientY):(this.btnStartPosX=i.clientX,this.btnStartPosY=i.clientY)}catch(r){window.alert(r)}}dragFlotButton(i){try{if(!this.isFlotBtnDragging)return;i.preventDefault();let r,s;i.type==="touchmove"?(r=i.touches[0].clientX,s=i.touches[0].clientY):(r=i.clientX,s=i.clientY);let c=this.btnStartPosX-r,t=this.btnStartPosY-s;this.btnStartPosX=r,this.btnStartPosY=s;let n=window.innerHeight-(this.$showTermBtn.offsetTop+this.$showTermBtn.offsetHeight)+t,h=this.$showTermBtn.offsetLeft-c,g=document.querySelector("#root header")?.offsetHeight,a=document.querySelector("#root ul")?.offsetHeight||0,l=g+a,_=window.innerWidth-this.$showTermBtn.offsetWidth,v=window.innerHeight-l-this.$showTermBtn.offsetHeight;this.$showTermBtn.style.bottom=`${Math.max(0,Math.min(v,n))}px`,this.$showTermBtn.style.left=`${Math.max(0,Math.min(_,h))}px`}catch(r){window.alert(r)}}stopDraggingFlotBtn(){try{this.isFlotBtnDragging=!1,this.$showTermBtn.style.border="none"}catch(i){window.alert(i)}}startDragging(i){i.type==="touchstart"?this.startY=i.touches[0].clientY:(i.preventDefault(),this.startY=i.clientY),this.startHeight=this.$terminalContainer.clientHeight,this.isDragging=!0,this.$terminalContainer.style.borderTop="1px solid var(--link-text-color)"}drag(i){if(!this.isDragging)return;i.preventDefault();let r;i.type==="touchmove"?r=i.touches[0].clientY:r=i.clientY;let s=r-this.startY,c=this.startHeight-s,t=document.querySelector("#root header")?.offsetHeight,n=document.querySelector("#root ul")?.offsetHeight||0,h=t+n,g=document.querySelector("#quick-tools")?.offsetHeight||0,a=window.innerHeight-(h+g);c=Math.max(100,Math.min(c,a)),this.$terminalContainer.style.height=`${c}px`,localStorage.setItem("AcodeX_Terminal_Cont_Height",c),this._updateTerminalHeight();let _=this.$terminal?.getSelection();_&&_.length>0&&this.updateHandles()}stopDragging(i){this.isDragging=!1,this.$terminalContainer.style.borderTop="1px solid var(--popup-border-color)"}minimise(){try{this.isTerminalMinimized||(this.previousTerminalHeight=window.getComputedStyle(this.$terminalContainer).height,localStorage.setItem("AcodeX_Terminal_Cont_Height",this.$terminalContainer.offsetHeight),this.$terminalContainer.style.height="0px",this.$terminalContainer.classList.add("hide"),this.isTerminalMinimized=!0,localStorage.setItem("AcodeX_Terminal_Is_Minimised",this.isTerminalMinimized),this.settings.showTerminalBtn&&this.$showTermBtn.classList.remove("hide"))}catch(i){window.alert(i)}}maxmise(){if(this.isTerminalMinimized){Number.parseInt(localStorage.getItem("AcodeX_Terminal_Cont_Height"))<=50?this.$terminalContainer.style.height="50px":this.$terminalContainer.style.height=`${localStorage.getItem("AcodeX_Terminal_Cont_Height")}px`,this.$terminalContainer.classList.remove("hide"),this.$terminalContent.style.height=`calc(100% - ${this.$terminalContainer.offsetHeight}px)`,this.fitTerminal(),localStorage.setItem("AcodeX_Terminal_Cont_Height",this.$terminalContainer.offsetHeight),this.settings.showTerminalBtn&&this.$showTermBtn.classList.add("hide"),this.isTerminalMinimized=!1,localStorage.setItem("AcodeX_Terminal_Is_Minimised",this.isTerminalMinimized),this._updateTerminalHeight();let i=this.$terminal?.getSelection();i&&i.length>0&&this.updateHandles()}}_findPreviousMatchofSearch(){let i=document.querySelector(".search-input-container input").value;this.$searchAddon?.findPrevious(i)}_findNextMatchofSearch(){let i=document.querySelector(".search-input-container input").value;this.$searchAddon?.findNext(i)}async _cdToActiveDir(){let{activeFile:i}=editorManager;if(i.uri){let r=fr(i.uri);if(!r){navigator.vibrate(300),window.toast("unsupported path type.",3e3);return}this.socket.send(`cd "${r}"\r`)}}async destroy(){this.$style.remove(),this.xtermCss.remove(),this.$fontStyleSheet.remove(),await Ao(`${window.DATA_STORAGE}acodex_fonts`).delete(),editorManager.editor.commands.removeCommand("terminal:open_terminal"),editorManager.editor.commands.removeCommand("terminal:close_terminal"),this.$terminalContainer.remove(),this.$showTermBtn.remove(),this.startHandle?.remove(),this.endHandle?.remove(),document.removeEventListener("mousemove",this.dragFlotButton.bind(this)),document.removeEventListener("mouseup",this.stopDraggingFlotBtn.bind(this)),document.removeEventListener("touchmove",this.dragFlotButton.bind(this)),document.removeEventListener("touchend",this.stopDraggingFlotBtn.bind(this)),window.removeEventListener("mousemove",this.drag),window.removeEventListener("touchmove",this.drag),window.removeEventListener("mouseup",this.stopDragging),window.removeEventListener("touchend",this.stopDragging),localStorage.removeItem("AcodeX_Terminal_Is_Minimised"),localStorage.removeItem("AcodeX_Current_Session"),localStorage.removeItem("AcodeX_Terminal_Cont_Height"),localStorage.removeItem("AcodeX_Is_Opened"),localStorage.getItem("ACODEX_LOCAL_LLM_MODEL")&&localStorage.removeItem("ACODEX_LOCAL_LLM_MODEL")}async setCustomFontFile(){let{url:i}=await acode.fileBrowser("file","select custom font stylesheet");if(!i)return;let r=fr(i);if(r.startsWith("/sdcard"))r=r.replace("/sdcard","file:///storage/emulated/0");else if(r.startsWith("$HOME"))return;let s=i.split("/"),c=s[s.length-1];r=`${r}/${c}`;let t=await _p(r);this.settings.customFontStyleSheet=t,Ee.update()}async applyTheme(i){let r=xe[i];this.settings.theme=i,this.settings.background=r.background,this.settings.foreground=r.foreground,this.settings.cursor=r.cursor||"#fff",this.settings.cursorAccent=r.cursorAccent||"#fff",this.settings.selectionBackground=r.selectionBackground,this.settings.black=r.black,this.settings.blue=r.blue,this.settings.brightBlack=r.brightBlack,this.settings.brightBlue=r.brightBlue,this.settings.brightCyan=r.brightCyan,this.settings.brightGreen=r.brightGreen,this.settings.brightMagenta=r.brightMagenta,this.settings.brightRed=r.brightRed,this.settings.brightWhite=r.brightWhite,this.settings.brightYellow=r.brightYellow,this.settings.cyan=r.cyan,this.settings.green=r.green,this.settings.magenta=r.magenta,this.settings.red=r.red,this.settings.white=r.white,this.settings.yellow=r.yellow,Ee.update()}get terminalThemeObj(){return{background:this.settings.transparency?Bo(this.settings.background,.5):this.settings.background,foreground:this.settings.foreground,selectionBackground:this.settings.selectionBackground,cursor:this.settings.cursor,cursorAccent:this.settings.cursorAccent,black:this.settings.black,blue:this.settings.blue,brightBlack:this.settings.brightBlack,brightBlue:this.settings.brightBlue,brightCyan:this.settings.brightCyan,brightGreen:this.settings.brightGreen,brightMagenta:this.settings.brightMagenta,brightRed:this.settings.brightRed,brightWhite:this.settings.brightWhite,brightYellow:this.settings.brightYellow,cyan:this.settings.cyan,green:this.settings.green,magenta:this.settings.magenta,red:this.settings.red,white:this.settings.white,yellow:this.settings.yellow}}get terminalObj(){return new cu.Terminal({allowTransparency:this.settings.transparency,allowProposedApi:!0,scrollOnUserInput:!0,cursorBlink:this.settings.cursorBlink,cursorStyle:this.settings.cursorStyle,cursorInactiveStyle:this.settings.cursorInactiveStyle,scrollBack:this.settings.scrollBack,scrollSensitivity:this.settings.scrollSensitivity,fontSize:this.settings.fontSize,fontFamily:`${this.settings.fontFamily}, Fira Code, monospace`,fontWeight:this.settings.fontWeight,letterSpacing:this.settings.letterSpacing,theme:this.terminalThemeObj})}async clearCache(){await this.$cacheFile.writeFile(""),window.toast("Cache cleared \u{1F525}",3e3)}get settingsObj(){return this.settings.theme==="custom"?{list:this.settingsList.concat(this.settingsListWithThemeColor),cb:(i,r)=>this.settingsSaveCallback(i,r)}:{list:this.settingsList,cb:(i,r)=>this.settingsSaveCallback(i,r)}}get settingsList(){return[{key:"port",text:"Server Port",value:this.settings.port,info:"Port which is displayed on termux when starting the server",prompt:"Server Port",promptType:"number",promptOption:[{required:!0}]},{key:"letterSpacing",text:"Letter Spacing",value:this.settings.letterSpacing,info:"The spacing in whole pixels between characters.",prompt:"Letter spacing",promptType:"number",promptOption:[{required:!0}]},{key:"serverHost",text:"Server Host Name",value:this.settings.serverHost,info:"Hostname which is displayed on termux when starting the server",prompt:"Server Host Name",promptType:"text",promptOption:[{required:!0}]},{key:"aiApiKey",text:"AI API Key",value:this.settings.aiApiKey,info:"API key of your selected model, if your selected model doesn't need any api key then leave it empty. For how to get api key : check the readme of plugin",prompt:"AI API Key",promptType:"text",promptOption:[{required:!0}]},{key:"aiModel",text:"AI Model",value:this.settings.aiModel,info:"ai model to generate terminal suggestions and commands",select:Ws},{key:"fontWeight",text:"Font Weight",value:this.settings.fontWeight,info:"The font weight used to render non-bold text.",select:Us},{key:"showTerminalBtnSize",text:"Show Terminal button size",value:this.settings.showTerminalBtnSize,info:"Size of terminal show button (in px)",prompt:"Show Terminal button size",promptType:"number",promptOption:[{required:!0}]},{key:"blurValue",text:"Blur Value(in px)",value:this.settings.blurValue,info:"Blur value for terminal in transparent mode",prompt:"Blur Value",promptType:"text",promptOption:[{required:!0}]},{key:"clearCache",text:"Clear Cache",info:"Helps in clearing cache which contains session details in case of any problems or bug"},{key:"transparency",text:"Allow Transparent Terminal",info:"Makes terminal transparent but it will also led to slightly performance decrement",checkbox:!!this.settings.transparency},{key:"imageRendering",text:"Image Rendering",info:"Enables image rendering inside the terminal but it can reduce performance",checkbox:!!this.settings.imageRendering},{key:"enableGuiViewer",text:"GUI Viewer",info:"Enables gui viewer, to view the output of graphical apps",checkbox:!!this.settings.enableGuiViewer},{key:"selectionHaptics",text:"Selection Haptics",info:"Enable/Disable vibration on selection",checkbox:!!this.settings.selectionHaptics},{key:"fontLigatures",text:"Font Ligatures",info:"Enable/Disable font ligatures in terminal",checkbox:!!this.settings.fontLigatures},{key:"showTerminalBtn",text:"Terminal Maximise Button",info:"Hide/Unhide terminal maximise button",checkbox:!!this.settings.showTerminalBtn},{index:7,key:"customFontStyleSheet",text:"Custom Font Stylesheet file",info:"Select css file in which you have to define about your custom font.",value:this.settings.customFontStyleSheet},{index:0,key:"cursorBlink",text:"Cursor Blink",info:"Whether the cursor blinks.",checkbox:!!this.settings.cursorBlink},{index:1,key:"cursorStyle",text:"Cursor Style",value:this.settings.cursorStyle,info:"The style of the cursor.",select:Hs},{key:"cursorInactiveStyle",text:"Cursor Inactive Style",value:this.settings.cursorInactiveStyle,info:"The style of the cursor when the terminal is not focused.",select:Ns},{index:2,key:"fontSize",text:"Font Size",value:this.settings.fontSize,info:"The font size used to render text.",prompt:"Font Size",promptType:"text",promptOption:[{match:/^[0-9]+$/,required:!0}]},{index:3,key:"fontFamily",text:"Font Family",value:this.settings.fontFamily,info:"The font family used to render text.",select:Zo},{index:4,key:"scrollBack",text:"Scroll Back",value:this.settings.scrollBack,info:"The amount of scrollback in the terminal. Scrollback is the amount of rows that are retained when lines are scrolled beyond the initial viewport.",prompt:"Scroll Back",promptType:"number",promptOption:[{match:/^[0-9]+$/,required:!0}]},{index:5,key:"scrollSensitivity",text:"Scroll Sensitivity",value:this.settings.scrollSensitivity,info:"The scrolling speed multiplier used for adjusting normal scrolling speed.",prompt:"Scroll Sensitivity",promptType:"number",promptOption:[{match:/^[0-9]+$/,required:!0}]},{index:6,key:"theme",text:"Theme",value:this.settings.theme,info:"Theme of terminal.",select:$s}]}get settingsListWithThemeColor(){return[{index:8,key:"background",text:"Background Color",value:this.settings.background,color:this.settings.background},{index:9,key:"foreground",text:"Foreground Color",value:this.settings.foreground,color:this.settings.foreground},{index:10,key:"selectionBackground",text:"Selection Background Color",value:this.settings.selectionBackground,color:this.settings.selectionBackground},{index:11,key:"cursor",text:"Cursor Color",value:this.settings.cursor,color:this.settings.cursor},{index:12,key:"cursorAccent",text:"Cursor Accent Color",value:this.settings.cursorAccent,color:this.settings.cursorAccent},{index:13,key:"black",text:"Black Color",value:this.settings.black,color:this.settings.black},{index:14,key:"blue",text:"Blue Color",value:this.settings.blue,color:this.settings.blue},{index:15,key:"brightBlack",text:"Bright Black Color",value:this.settings.brightBlack,color:this.settings.brightBlack},{index:16,key:"brightBlue",text:"Bright Blue Color",value:this.settings.brightBlue,color:this.settings.brightBlue},{index:17,key:"brightCyan",text:"Bright Cyan Color",value:this.settings.brightCyan,color:this.settings.brightCyan},{index:18,key:"brightGreen",text:"Bright Green Color",value:this.settings.brightGreen,color:this.settings.brightGreen},{index:19,key:"brightMagenta",text:"Bright Magenta Color",value:this.settings.brightMagenta,color:this.settings.brightMagenta},{index:20,key:"brightRed",text:"Bright Red Color",value:this.settings.brightRed,color:this.settings.brightRed},{index:21,key:"brightWhite",text:"Bright White Color",value:this.settings.brightWhite,color:this.settings.brightWhite},{index:22,key:"brightYellow",text:"Bright Yellow Color",value:this.settings.brightYellow,color:this.settings.brightYellow},{index:23,key:"cyan",text:"Cyan Color",value:this.settings.cyan,color:this.settings.cyan},{index:24,key:"green",text:"Green Color",value:this.settings.green,color:this.settings.green},{index:25,key:"magenta",text:"Magenta Color",value:this.settings.magenta,color:this.settings.magenta},{index:26,key:"red",text:"Red Color",value:this.settings.red,color:this.settings.red},{index:27,key:"white",text:"White Color",value:this.settings.white,color:this.settings.white},{index:28,key:"yellow",text:"Yellow Color",value:this.settings.yellow,color:this.settings.yellow}]}settingsSaveCallback(i,r){switch(i){case"customFontStyleSheet":this.setCustomFontFile();break;case"theme":this.applyTheme(r),r==="custom"&&acode.alert("AcodeX Warning","Restart the app please"),this.$terminal&&(this.$terminal.options.theme=this.terminalThemeObj);break;case"clearCache":this.clearCache();break;case"showTerminalBtnSize":this.$showTermBtn&&(this.$showTermBtn.style.height=`${r}px`,this.$showTermBtn.style.width=`${r}px`);break;case"fontSize":this.$terminal&&(this.$terminal.options.fontSize=r),this.settings[i]=r,Ee.update();break;case"fontFamily":this.$terminal&&(this.$terminal.options.fontFamily=r,this.$terminal.refresh(0,this.$terminal.rows-1)),this.settings[i]=r,Ee.update();break;case"fontWeight":this.$terminal&&(this.$terminal.options.fontWeight=r),this.settings[i]=r,Ee.update();break;case"letterSpacing":this.$terminal&&(this.$terminal.options.letterSpacing=r),this.settings[i]=r,Ee.update();break;case"cursorBlink":this.$terminal&&(this.$terminal.options.cursorBlink=r),this.settings[i]=r,Ee.update();break;case"cursorStyle":this.$terminal&&(this.$terminal.options.cursorStyle=r),this.settings[i]=r,Ee.update();break;case"cursorInactiveStyle":this.$terminal&&(this.$terminal.options.cursorInactiveStyle=r),this.settings[i]=r,Ee.update();break;case"imageRendering":this.$terminal&&(r?(this.$imageAddon=new Co.ImageAddon,this.$terminal.loadAddon(this.$imageAddon)):this.$imageAddon?.dispose()),this.settings[i]=r,Ee.update();break;case"fontLigatures":this.$terminal&&(r?(this.$ligatureAddon=new Ci,this.$terminal.loadAddon(this.$ligatureAddon)):this.$ligatureAddon?.dispose()),this.settings[i]=r,Ee.update();break;case"enableGuiViewer":this.settings[i]=r,Ee.update(),acode.alert("AcodeX Warning","Make sure to restart to see this setting in effect");break;case"showTerminalBtn":this.$showTermBtn?r?acode.alert("AcodeX Warning","Restart App to see this change"):this.$showTermBtn.remove():acode.alert("AcodeX Warning","Restart App to see this change"),this.settings[i]=r,Ee.update();break;default:this.settings[i]=r,Ee.update()}}get settings(){return Ee.value[mt.id]}};if(window.acode){let e=new cr;acode.setPluginInit(mt.id,async(i,r,{cacheFileUrl:s,cacheFile:c})=>{let t=i.endsWith("/")?i:`${i}/`;e.baseUrl=t,await e.init(r,c,s)},e.settingsObj),acode.setPluginUnmount(mt.id,()=>{e.destroy()})}})();
/*! Bundled license information:

@novnc/novnc/lib/crypto/aes.js:
  (*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE *)

@novnc/novnc/lib/crypto/rsa.js:
  (*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE *)

@novnc/novnc/lib/crypto/md5.js:
  (*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE *)

@novnc/novnc/lib/ra2.js:
  (*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE *)

@novnc/novnc/lib/rfb.js:
  (*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE *)

@xterm/addon-image/lib/addon-image.js:
  (*! For license information please see addon-image.js.LICENSE.txt *)
*/
