"use strict";(()=>{var aw=Object.create;var Af=Object.defineProperty;var lw=Object.getOwnPropertyDescriptor;var hw=Object.getOwnPropertyNames;var cw=Object.getPrototypeOf,uw=Object.prototype.hasOwnProperty;var ie=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var dw=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of hw(t))!uw.call(e,s)&&s!==i&&Af(e,s,{get:()=>t[s],enumerable:!(r=lw(t,s))||r.enumerable});return e};var Vl=(e,t,i)=>(i=e!=null?aw(cw(e)):{},dw(t||!e||!e.__esModule?Af(i,"default",{value:e,enumerable:!0}):i,e));var ph=ie(mo=>{"use strict";Object.defineProperty(mo,"__esModule",{value:!0});mo.toSigned32bit=Rw;mo.toUnsigned32bit=Tw;function Tw(e){return e>>>0}function Rw(e){return e|0}});var Ci=ie(Oe=>{"use strict";Object.defineProperty(Oe,"__esModule",{value:!0});Oe.Warn=Oe.Info=Oe.Error=Oe.Debug=void 0;Oe.getLogging=Fw;Oe.initLogging=Jf;var gh="warn",jf=Oe.Debug=function(){},qf=Oe.Info=function(){},Vf=Oe.Warn=function(){},Yf=Oe.Error=function(){};function Jf(e){if(typeof e>"u"?e=gh:gh=e,Oe.Debug=jf=Oe.Info=qf=Oe.Warn=Vf=Oe.Error=Yf=function(){},typeof window.console<"u")switch(e){case"debug":Oe.Debug=jf=console.debug.bind(window.console);case"info":Oe.Info=qf=console.info.bind(window.console);case"warn":Oe.Warn=Vf=console.warn.bind(window.console);case"error":Oe.Error=Yf=console.error.bind(window.console);case"none":break;default:throw new window.Error("invalid logging type '"+e+"'")}}function Fw(){return gh}Jf()});var mh=ie(vo=>{"use strict";Object.defineProperty(vo,"__esModule",{value:!0});vo.decodeUTF8=Pw;vo.encodeUTF8=Ow;function Pw(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;try{return decodeURIComponent(escape(e))}catch(i){if(i instanceof URIError&&t)return e;throw i}}function Ow(e){return unescape(encodeURIComponent(e))}});var Xs=ie(ye=>{"use strict";function bh(e){"@babel/helpers - typeof";return bh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bh(e)}Object.defineProperty(ye,"__esModule",{value:!0});ye.hasScrollbarGutter=ye.dragThreshold=void 0;ye.isAndroid=Uw;ye.isBlink=Zw;ye.isChrome=Gw;ye.isChromeOS=zw;ye.isChromium=jw;ye.isEdge=Vw;ye.isFirefox=$w;ye.isGecko=Yw;ye.isIOS=Xw;ye.isMac=Qw;ye.isOpera=qw;ye.isSafari=Ww;ye.isTouchDevice=void 0;ye.isWebKit=Jw;ye.isWindows=Hw;ye.supportsCursorURIs=void 0;var yo=Kw(Ci());function e_(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(e_=function(s){return s?i:t})(e)}function Kw(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||bh(e)!="object"&&typeof e!="function")return{default:e};var i=e_(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&{}.hasOwnProperty.call(e,n)){var o=s?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}var Nw=ye.isTouchDevice="ontouchstart"in document.documentElement||document.ontouchstart!==void 0||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;window.addEventListener("touchstart",function e(){ye.isTouchDevice=Nw=!0,window.removeEventListener("touchstart",e,!1)},!1);var J4=ye.dragThreshold=10*(window.devicePixelRatio||1),t_=!1;try{vh=document.createElement("canvas"),vh.style.cursor='url("data:image/x-icon;base64,AAACAAEACAgAAAIAAgA4AQAAFgAAACgAAAAIAAAAEAAAAAEAIAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AAAAAAAAAAAAAAAAAAAAAA==") 2 2, default',vh.style.cursor.indexOf("url")===0?(yo.Info("Data URI scheme cursor supported"),t_=!0):yo.Warn("Data URI scheme cursor not supported")}catch(e){yo.Error("Data URI scheme cursor test exception: "+e)}var vh,Z4=ye.supportsCursorURIs=t_,i_=!0;try{Zi=document.createElement("div"),Zi.style.visibility="hidden",Zi.style.overflow="scroll",document.body.appendChild(Zi),yh=document.createElement("div"),Zi.appendChild(yh),Zf=Zi.offsetWidth-yh.offsetWidth,Zi.parentNode.removeChild(Zi),i_=Zf!=0}catch(e){yo.Error("Scrollbar test exception: "+e)}var Zi,yh,Zf,eD=ye.hasScrollbarGutter=i_;function Qw(){return!!/mac/i.exec(navigator.platform)}function Hw(){return!!/win/i.exec(navigator.platform)}function Xw(){return!!/ipad/i.exec(navigator.platform)||!!/iphone/i.exec(navigator.platform)||!!/ipod/i.exec(navigator.platform)}function Uw(){return!!navigator.userAgent.match("Android ")}function zw(){return!!navigator.userAgent.match(" CrOS ")}function Ww(){return!!navigator.userAgent.match("Safari/...")&&!navigator.userAgent.match("Chrome/...")&&!navigator.userAgent.match("Chromium/...")&&!navigator.userAgent.match("Epiphany/...")}function $w(){return!!navigator.userAgent.match("Firefox/...")&&!navigator.userAgent.match("Seamonkey/...")}function Gw(){return!!navigator.userAgent.match("Chrome/...")&&!navigator.userAgent.match("Chromium/...")&&!navigator.userAgent.match("Edg/...")&&!navigator.userAgent.match("OPR/...")}function jw(){return!!navigator.userAgent.match("Chromium/...")}function qw(){return!!navigator.userAgent.match("OPR/...")}function Vw(){return!!navigator.userAgent.match("Edg/...")}function Yw(){return!!navigator.userAgent.match("Gecko/...")}function Jw(){return!!navigator.userAgent.match("AppleWebKit/...")&&!navigator.userAgent.match("Chrome/...")}function Zw(){return!!navigator.userAgent.match("Chrome/...")}});var r_=ie(wh=>{"use strict";Object.defineProperty(wh,"__esModule",{value:!0});wh.clientToElement=eA;function eA(e,t,i){var r=i.getBoundingClientRect(),s={x:0,y:0};return e<r.left?s.x=0:e>=r.right?s.x=r.width-1:s.x=e-r.left,t<r.top?s.y=0:t>=r.bottom?s.y=r.height-1:s.y=t-r.top,s}});var Sh=ie(ts=>{"use strict";Object.defineProperty(ts,"__esModule",{value:!0});ts.getPointerEvent=tA;ts.releaseCapture=xh;ts.setCapture=rA;ts.stopEvent=iA;function tA(e){return e.changedTouches?e.changedTouches[0]:e.touches?e.touches[0]:e}function iA(e){e.stopPropagation(),e.preventDefault()}var Ah=!1,s_=null;document.captureElement=null;function Dr(e){if(!Ah){var t=new e.constructor(e.type,e);Ah=!0,document.captureElement?document.captureElement.dispatchEvent(t):s_.dispatchEvent(t),Ah=!1,e.stopPropagation(),t.defaultPrevented&&e.preventDefault(),e.type==="mouseup"&&xh()}}function n_(){var e=document.getElementById("noVNC_mouse_capture_elem");e.style.cursor=window.getComputedStyle(document.captureElement).cursor}var o_=new MutationObserver(n_);function rA(e){if(e.setCapture)e.setCapture(),document.captureElement=e;else{xh();var t=document.getElementById("noVNC_mouse_capture_elem");t===null&&(t=document.createElement("div"),t.id="noVNC_mouse_capture_elem",t.style.position="fixed",t.style.top="0px",t.style.left="0px",t.style.width="100%",t.style.height="100%",t.style.zIndex=1e4,t.style.display="none",document.body.appendChild(t),t.addEventListener("contextmenu",Dr),t.addEventListener("mousemove",Dr),t.addEventListener("mouseup",Dr)),document.captureElement=e,o_.observe(e,{attributes:!0}),n_(),t.style.display="",window.addEventListener("mousemove",Dr),window.addEventListener("mouseup",Dr)}}function xh(){if(document.releaseCapture)document.releaseCapture(),document.captureElement=null;else{if(!document.captureElement)return;s_=document.captureElement,document.captureElement=null,o_.disconnect();var e=document.getElementById("noVNC_mouse_capture_elem");e.style.display="none",window.removeEventListener("mousemove",Dr),window.removeEventListener("mouseup",Dr)}}});var Ch=ie(bo=>{"use strict";Object.defineProperty(bo,"__esModule",{value:!0});bo.default=void 0;function Us(e){"@babel/helpers - typeof";return Us=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Us(e)}function sA(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a_(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,oA(r.key),r)}}function nA(e,t,i){return t&&a_(e.prototype,t),i&&a_(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function oA(e){var t=aA(e,"string");return Us(t)=="symbol"?t:t+""}function aA(e,t){if(Us(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(Us(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var sD=bo.default=function(){function e(){sA(this,e),this._listeners=new Map}return nA(e,[{key:"addEventListener",value:function(i,r){this._listeners.has(i)||this._listeners.set(i,new Set),this._listeners.get(i).add(r)}},{key:"removeEventListener",value:function(i,r){this._listeners.has(i)&&this._listeners.get(i).delete(r)}},{key:"dispatchEvent",value:function(i){var r=this;return this._listeners.has(i.type)?(this._listeners.get(i.type).forEach(function(s){return s.call(r,i)}),!i.defaultPrevented):!0}}])}()});var Eh=ie(wo=>{"use strict";function kh(e){"@babel/helpers - typeof";return kh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kh(e)}Object.defineProperty(wo,"__esModule",{value:!0});wo.default=void 0;var lA=hA(Ci());function l_(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(l_=function(s){return s?i:t})(e)}function hA(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||kh(e)!="object"&&typeof e!="function")return{default:e};var i=l_(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&{}.hasOwnProperty.call(e,n)){var o=s?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}var oD=wo.default={toBase64Table:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split(""),base64Pad:"=",encode:function(t){"use strict";for(var i="",r=t.length,s=r%3,n=0;n<r-2;n+=3)i+=this.toBase64Table[t[n]>>2],i+=this.toBase64Table[((t[n]&3)<<4)+(t[n+1]>>4)],i+=this.toBase64Table[((t[n+1]&15)<<2)+(t[n+2]>>6)],i+=this.toBase64Table[t[n+2]&63];var o=r-s;return s===2?(i+=this.toBase64Table[t[o]>>2],i+=this.toBase64Table[((t[o]&3)<<4)+(t[o+1]>>4)],i+=this.toBase64Table[(t[o+1]&15)<<2],i+=this.toBase64Table[64]):s===1&&(i+=this.toBase64Table[t[o]>>2],i+=this.toBase64Table[(t[o]&3)<<4],i+=this.toBase64Table[64],i+=this.toBase64Table[64]),i},toBinaryTable:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],decode:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=t.indexOf("=")-i;r<0&&(r=t.length-i);for(var s=(r>>2)*3+Math.floor(r%4/1.5),n=new Array(s),o=0,a=0,h=0,l=i;l<t.length;l++){var c=this.toBinaryTable[t.charCodeAt(l)&127],u=t.charAt(l)===this.base64Pad;if(c===-1){lA.Error("Illegal character code "+t.charCodeAt(l)+" at position "+l);continue}a=a<<6|c,o+=6,o>=8&&(o-=8,u||(n[h++]=a>>o&255),a&=(1<<o)-1)}if(o){var g=new Error("Corrupted base64 string");throw g.name="Base64-Error",g}return n}}});var d_=ie(Ao=>{"use strict";Object.defineProperty(Ao,"__esModule",{value:!0});Ao.default=void 0;var is=dA(Ci()),cA=uA(Eh()),h_=ph();function uA(e){return e&&e.__esModule?e:{default:e}}function u_(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(u_=function(s){return s?i:t})(e)}function dA(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||rs(e)!="object"&&typeof e!="function")return{default:e};var i=u_(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&{}.hasOwnProperty.call(e,n)){var o=s?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}function rs(e){"@babel/helpers - typeof";return rs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rs(e)}function fA(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c_(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,pA(r.key),r)}}function _A(e,t,i){return t&&c_(e.prototype,t),i&&c_(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function pA(e){var t=gA(e,"string");return rs(t)=="symbol"?t:t+""}function gA(e,t){if(rs(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(rs(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var lD=Ao.default=function(){function e(t){if(fA(this,e),this._drawCtx=null,this._renderQ=[],this._flushPromise=null,this._fbWidth=0,this._fbHeight=0,this._prevDrawStyle="",is.Debug(">> Display.constructor"),this._target=t,!this._target)throw new Error("Target must be set");if(typeof this._target=="string")throw new Error("target must be a DOM element");if(!this._target.getContext)throw new Error("no getContext method");this._targetCtx=this._target.getContext("2d"),this._viewportLoc={x:0,y:0,w:this._target.width,h:this._target.height},this._backbuffer=document.createElement("canvas"),this._drawCtx=this._backbuffer.getContext("2d"),this._damageBounds={left:0,top:0,right:this._backbuffer.width,bottom:this._backbuffer.height},is.Debug("User Agent: "+navigator.userAgent),is.Debug("<< Display.constructor"),this._scale=1,this._clipViewport=!1}return _A(e,[{key:"scale",get:function(){return this._scale},set:function(i){this._rescale(i)}},{key:"clipViewport",get:function(){return this._clipViewport},set:function(i){this._clipViewport=i;var r=this._viewportLoc;this.viewportChangeSize(r.w,r.h),this.viewportChangePos(0,0)}},{key:"width",get:function(){return this._fbWidth}},{key:"height",get:function(){return this._fbHeight}},{key:"viewportChangePos",value:function(i,r){var s=this._viewportLoc;i=Math.floor(i),r=Math.floor(r),this._clipViewport||(i=-s.w,r=-s.h);var n=s.x+s.w-1,o=s.y+s.h-1;i<0&&s.x+i<0&&(i=-s.x),n+i>=this._fbWidth&&(i-=n+i-this._fbWidth+1),s.y+r<0&&(r=-s.y),o+r>=this._fbHeight&&(r-=o+r-this._fbHeight+1),!(i===0&&r===0)&&(is.Debug("viewportChange deltaX: "+i+", deltaY: "+r),s.x+=i,s.y+=r,this._damage(s.x,s.y,s.w,s.h),this.flip())}},{key:"viewportChangeSize",value:function(i,r){(!this._clipViewport||typeof i>"u"||typeof r>"u")&&(is.Debug("Setting viewport to full display region"),i=this._fbWidth,r=this._fbHeight),i=Math.floor(i),r=Math.floor(r),i>this._fbWidth&&(i=this._fbWidth),r>this._fbHeight&&(r=this._fbHeight);var s=this._viewportLoc;if(s.w!==i||s.h!==r){s.w=i,s.h=r;var n=this._target;n.width=i,n.height=r,this.viewportChangePos(0,0),this._damage(s.x,s.y,s.w,s.h),this.flip(),this._rescale(this._scale)}}},{key:"absX",value:function(i){return this._scale===0?0:(0,h_.toSigned32bit)(i/this._scale+this._viewportLoc.x)}},{key:"absY",value:function(i){return this._scale===0?0:(0,h_.toSigned32bit)(i/this._scale+this._viewportLoc.y)}},{key:"resize",value:function(i,r){this._prevDrawStyle="",this._fbWidth=i,this._fbHeight=r;var s=this._backbuffer;if(s.width!==i||s.height!==r){var n=null;s.width>0&&s.height>0&&(n=this._drawCtx.getImageData(0,0,s.width,s.height)),s.width!==i&&(s.width=i),s.height!==r&&(s.height=r),n&&this._drawCtx.putImageData(n,0,0)}var o=this._viewportLoc;this.viewportChangeSize(o.w,o.h),this.viewportChangePos(0,0)}},{key:"getImageData",value:function(){return this._drawCtx.getImageData(0,0,this.width,this.height)}},{key:"toDataURL",value:function(i,r){return this._backbuffer.toDataURL(i,r)}},{key:"toBlob",value:function(i,r,s){return this._backbuffer.toBlob(i,r,s)}},{key:"_damage",value:function(i,r,s,n){i<this._damageBounds.left&&(this._damageBounds.left=i),r<this._damageBounds.top&&(this._damageBounds.top=r),i+s>this._damageBounds.right&&(this._damageBounds.right=i+s),r+n>this._damageBounds.bottom&&(this._damageBounds.bottom=r+n)}},{key:"flip",value:function(i){if(this._renderQ.length!==0&&!i)this._renderQPush({type:"flip"});else{var r=this._damageBounds.left,s=this._damageBounds.top,n=this._damageBounds.right-r,o=this._damageBounds.bottom-s,a=r-this._viewportLoc.x,h=s-this._viewportLoc.y;a<0&&(n+=a,r-=a,a=0),h<0&&(o+=h,s-=h,h=0),a+n>this._viewportLoc.w&&(n=this._viewportLoc.w-a),h+o>this._viewportLoc.h&&(o=this._viewportLoc.h-h),n>0&&o>0&&this._targetCtx.drawImage(this._backbuffer,r,s,n,o,a,h,n,o),this._damageBounds.left=this._damageBounds.top=65535,this._damageBounds.right=this._damageBounds.bottom=0}}},{key:"pending",value:function(){return this._renderQ.length>0}},{key:"flush",value:function(){var i=this;return this._renderQ.length===0?Promise.resolve():(this._flushPromise===null&&(this._flushPromise=new Promise(function(r){i._flushResolve=r})),this._flushPromise)}},{key:"fillRect",value:function(i,r,s,n,o,a){this._renderQ.length!==0&&!a?this._renderQPush({type:"fill",x:i,y:r,width:s,height:n,color:o}):(this._setFillColor(o),this._drawCtx.fillRect(i,r,s,n),this._damage(i,r,s,n))}},{key:"copyImage",value:function(i,r,s,n,o,a,h){this._renderQ.length!==0&&!h?this._renderQPush({type:"copy",oldX:i,oldY:r,x:s,y:n,width:o,height:a}):(this._drawCtx.mozImageSmoothingEnabled=!1,this._drawCtx.webkitImageSmoothingEnabled=!1,this._drawCtx.msImageSmoothingEnabled=!1,this._drawCtx.imageSmoothingEnabled=!1,this._drawCtx.drawImage(this._backbuffer,i,r,o,a,s,n,o,a),this._damage(s,n,o,a))}},{key:"imageRect",value:function(i,r,s,n,o,a){if(!(s===0||n===0)){var h=new Image;h.src="data: "+o+";base64,"+cA.default.encode(a),this._renderQPush({type:"img",img:h,x:i,y:r,width:s,height:n})}}},{key:"blitImage",value:function(i,r,s,n,o,a,h){if(this._renderQ.length!==0&&!h){var l=new Uint8Array(s*n*4);l.set(new Uint8Array(o.buffer,0,l.length)),this._renderQPush({type:"blit",data:l,x:i,y:r,width:s,height:n})}else{var c=new Uint8ClampedArray(o.buffer,o.byteOffset+a,s*n*4),u=new ImageData(c,s,n);this._drawCtx.putImageData(u,i,r),this._damage(i,r,s,n)}}},{key:"drawImage",value:function(i,r,s){this._drawCtx.drawImage(i,r,s),this._damage(r,s,i.width,i.height)}},{key:"autoscale",value:function(i,r){var s;if(i===0||r===0)s=0;else{var n=this._viewportLoc,o=i/r,a=n.w/n.h;a>=o?s=i/n.w:s=r/n.h}this._rescale(s)}},{key:"_rescale",value:function(i){this._scale=i;var r=this._viewportLoc,s=i*r.w+"px",n=i*r.h+"px";(this._target.style.width!==s||this._target.style.height!==n)&&(this._target.style.width=s,this._target.style.height=n)}},{key:"_setFillColor",value:function(i){var r="rgb("+i[0]+","+i[1]+","+i[2]+")";r!==this._prevDrawStyle&&(this._drawCtx.fillStyle=r,this._prevDrawStyle=r)}},{key:"_renderQPush",value:function(i){this._renderQ.push(i),this._renderQ.length===1&&this._scanRenderQ()}},{key:"_resumeRenderQ",value:function(){this.removeEventListener("load",this._noVNCDisplay._resumeRenderQ),this._noVNCDisplay._scanRenderQ()}},{key:"_scanRenderQ",value:function(){for(var i=!0;i&&this._renderQ.length>0;){var r=this._renderQ[0];switch(r.type){case"flip":this.flip(!0);break;case"copy":this.copyImage(r.oldX,r.oldY,r.x,r.y,r.width,r.height,!0);break;case"fill":this.fillRect(r.x,r.y,r.width,r.height,r.color,!0);break;case"blit":this.blitImage(r.x,r.y,r.width,r.height,r.data,0,!0);break;case"img":if(r.img.complete){if(r.img.width!==r.width||r.img.height!==r.height){is.Error("Decoded image has incorrect dimensions. Got "+r.img.width+"x"+r.img.height+". Expected "+r.width+"x"+r.height+".");return}this.drawImage(r.img,r.x,r.y)}else r.img._noVNCDisplay=this,r.img.addEventListener("load",this._resumeRenderQ),i=!1;break}i&&this._renderQ.shift()}this._renderQ.length===0&&this._flushPromise!==null&&(this._flushResolve(),this._flushPromise=null,this._flushResolve=null)}}])}()});var zs=ie(Jt=>{"use strict";Object.defineProperty(Jt,"__esModule",{value:!0});Jt.Buf8=Jt.Buf32=Jt.Buf16=void 0;Jt.arraySet=vA;Jt.flattenChunks=yA;Jt.shrinkBuf=mA;function mA(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)}function vA(e,t,i,r,s){if(t.subarray&&e.subarray){e.set(t.subarray(i,i+r),s);return}for(var n=0;n<r;n++)e[s+n]=t[i+n]}function yA(e){var t,i,r,s,n,o;for(r=0,t=0,i=e.length;t<i;t++)r+=e[t].length;for(o=new Uint8Array(r),s=0,t=0,i=e.length;t<i;t++)n=e[t],o.set(n,s),s+=n.length;return o}var cD=Jt.Buf8=Uint8Array,uD=Jt.Buf16=Uint16Array,dD=Jt.Buf32=Int32Array});var Lh=ie(Bh=>{"use strict";Object.defineProperty(Bh,"__esModule",{value:!0});Bh.default=bA;function bA(e,t,i,r){for(var s=e&65535|0,n=e>>>16&65535|0,o=0;i!==0;){o=i>2e3?2e3:i,i-=o;do s=s+t[r++]|0,n=n+s|0;while(--o);s%=65521,n%=65521}return s|n<<16|0}});var Ih=ie(Dh=>{"use strict";Object.defineProperty(Dh,"__esModule",{value:!0});Dh.default=f_;function f_(){for(var e,t=[],i=0;i<256;i++){e=i;for(var r=0;r<8;r++)e=e&1?3988292384^e>>>1:e>>>1;t[i]=e}return t}var pD=f_()});var __=ie(Mh=>{"use strict";Object.defineProperty(Mh,"__esModule",{value:!0});Mh.default=AA;var xo=30,wA=12;function AA(e,t){var i,r,s,n,o,a,h,l,c,u,g,_,m,v,x,E,M,D,b,L,I,R,G,W,V;i=e.state,r=e.next_in,W=e.input,s=r+(e.avail_in-5),n=e.next_out,V=e.output,o=n-(t-e.avail_out),a=n+(e.avail_out-257),h=i.dmax,l=i.wsize,c=i.whave,u=i.wnext,g=i.window,_=i.hold,m=i.bits,v=i.lencode,x=i.distcode,E=(1<<i.lenbits)-1,M=(1<<i.distbits)-1;e:do{m<15&&(_+=W[r++]<<m,m+=8,_+=W[r++]<<m,m+=8),D=v[_&E];t:for(;;){if(b=D>>>24,_>>>=b,m-=b,b=D>>>16&255,b===0)V[n++]=D&65535;else if(b&16){L=D&65535,b&=15,b&&(m<b&&(_+=W[r++]<<m,m+=8),L+=_&(1<<b)-1,_>>>=b,m-=b),m<15&&(_+=W[r++]<<m,m+=8,_+=W[r++]<<m,m+=8),D=x[_&M];i:for(;;){if(b=D>>>24,_>>>=b,m-=b,b=D>>>16&255,b&16){if(I=D&65535,b&=15,m<b&&(_+=W[r++]<<m,m+=8,m<b&&(_+=W[r++]<<m,m+=8)),I+=_&(1<<b)-1,I>h){e.msg="invalid distance too far back",i.mode=xo;break e}if(_>>>=b,m-=b,b=n-o,I>b){if(b=I-b,b>c&&i.sane){e.msg="invalid distance too far back",i.mode=xo;break e}if(R=0,G=g,u===0){if(R+=l-b,b<L){L-=b;do V[n++]=g[R++];while(--b);R=n-I,G=V}}else if(u<b){if(R+=l+u-b,b-=u,b<L){L-=b;do V[n++]=g[R++];while(--b);if(R=0,u<L){b=u,L-=b;do V[n++]=g[R++];while(--b);R=n-I,G=V}}}else if(R+=u-b,b<L){L-=b;do V[n++]=g[R++];while(--b);R=n-I,G=V}for(;L>2;)V[n++]=G[R++],V[n++]=G[R++],V[n++]=G[R++],L-=3;L&&(V[n++]=G[R++],L>1&&(V[n++]=G[R++]))}else{R=n-I;do V[n++]=V[R++],V[n++]=V[R++],V[n++]=V[R++],L-=3;while(L>2);L&&(V[n++]=V[R++],L>1&&(V[n++]=V[R++]))}}else if((b&64)===0){D=x[(D&65535)+(_&(1<<b)-1)];continue i}else{e.msg="invalid distance code",i.mode=xo;break e}break}}else if((b&64)===0){D=v[(D&65535)+(_&(1<<b)-1)];continue t}else if(b&32){i.mode=wA;break e}else{e.msg="invalid literal/length code",i.mode=xo;break e}break}}while(r<s&&n<a);L=m>>3,r-=L,m-=L<<3,_&=(1<<m)-1,e.next_in=r,e.next_out=n,e.avail_in=r<s?5+(s-r):5-(r-s),e.avail_out=n<a?257+(a-n):257-(n-a),i.hold=_,i.bits=m}});var w_=ie(Fh=>{"use strict";function Rh(e){"@babel/helpers - typeof";return Rh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rh(e)}Object.defineProperty(Fh,"__esModule",{value:!0});Fh.default=BA;var p_=xA(zs());function b_(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(b_=function(s){return s?i:t})(e)}function xA(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||Rh(e)!="object"&&typeof e!="function")return{default:e};var i=b_(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&{}.hasOwnProperty.call(e,n)){var o=s?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}var ss=15,g_=852,m_=592,v_=0,Th=1,y_=2,SA=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],CA=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],kA=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],EA=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function BA(e,t,i,r,s,n,o,a){var h=a.bits,l=0,c=0,u=0,g=0,_=0,m=0,v=0,x=0,E=0,M=0,D,b,L,I,R,G=null,W=0,V,q=new p_.Buf16(ss+1),ne=new p_.Buf16(ss+1),C=null,w=0,k,f,d;for(l=0;l<=ss;l++)q[l]=0;for(c=0;c<r;c++)q[t[i+c]]++;for(_=h,g=ss;g>=1&&q[g]===0;g--);if(_>g&&(_=g),g===0)return s[n++]=1<<24|64<<16|0,s[n++]=1<<24|64<<16|0,a.bits=1,0;for(u=1;u<g&&q[u]===0;u++);for(_<u&&(_=u),x=1,l=1;l<=ss;l++)if(x<<=1,x-=q[l],x<0)return-1;if(x>0&&(e===v_||g!==1))return-1;for(ne[1]=0,l=1;l<ss;l++)ne[l+1]=ne[l]+q[l];for(c=0;c<r;c++)t[i+c]!==0&&(o[ne[t[i+c]]++]=c);if(e===v_?(G=C=o,V=19):e===Th?(G=SA,W-=257,C=CA,w-=257,V=256):(G=kA,C=EA,V=-1),M=0,c=0,l=u,R=n,m=_,v=0,L=-1,E=1<<_,I=E-1,e===Th&&E>g_||e===y_&&E>m_)return 1;for(;;){k=l-v,o[c]<V?(f=0,d=o[c]):o[c]>V?(f=C[w+o[c]],d=G[W+o[c]]):(f=96,d=0),D=1<<l-v,b=1<<m,u=b;do b-=D,s[R+(M>>v)+b]=k<<24|f<<16|d|0;while(b!==0);for(D=1<<l-1;M&D;)D>>=1;if(D!==0?(M&=D-1,M+=D):M=0,c++,--q[l]===0){if(l===g)break;l=t[i+o[c]]}if(l>_&&(M&I)!==L){for(v===0&&(v=_),R+=u,m=l-v,x=1<<m;m+v<g&&(x-=q[m+v],!(x<=0));)m++,x<<=1;if(E+=1<<m,e===Th&&E>g_||e===y_&&E>m_)return 1;L=M&I,s[L]=_<<24|m<<16|R-n|0}}return M!==0&&(s[R+M]=l-v<<24|64<<16|0),a.bits=_,0}});var r0=ie(he=>{"use strict";function Hh(e){"@babel/helpers - typeof";return Hh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hh(e)}Object.defineProperty(he,"__esModule",{value:!0});he.Z_TREES=he.Z_STREAM_ERROR=he.Z_STREAM_END=he.Z_OK=he.Z_NEED_DICT=he.Z_MEM_ERROR=he.Z_FINISH=he.Z_DEFLATED=he.Z_DATA_ERROR=he.Z_BUF_ERROR=he.Z_BLOCK=void 0;he.inflate=zA;he.inflateEnd=WA;he.inflateGetHeader=$A;he.inflateInfo=void 0;he.inflateInit=XA;he.inflateInit2=t0;he.inflateReset=Z_;he.inflateReset2=e0;he.inflateResetKeep=J_;he.inflateSetDictionary=GA;var Bt=DA(zs()),Xh=Bo(Lh()),ni=Bo(Ih()),LA=Bo(__()),Ws=Bo(w_());function Bo(e){return e&&e.__esModule?e:{default:e}}function G_(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(G_=function(s){return s?i:t})(e)}function DA(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||Hh(e)!="object"&&typeof e!="function")return{default:e};var i=G_(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&{}.hasOwnProperty.call(e,n)){var o=s?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}var IA=0,j_=1,q_=2,A_=he.Z_FINISH=4,MA=he.Z_BLOCK=5,So=he.Z_TREES=6,Ir=he.Z_OK=0,TA=he.Z_STREAM_END=1,RA=he.Z_NEED_DICT=2,Kt=he.Z_STREAM_ERROR=-2,V_=he.Z_DATA_ERROR=-3,Uh=he.Z_MEM_ERROR=-4,FA=he.Z_BUF_ERROR=-5,x_=he.Z_DEFLATED=8,Y_=1,S_=2,C_=3,k_=4,E_=5,B_=6,L_=7,D_=8,I_=9,M_=10,Eo=11,ki=12,Ph=13,T_=14,Oh=15,R_=16,F_=17,P_=18,O_=19,Co=20,ko=21,K_=22,N_=23,Q_=24,H_=25,X_=26,Kh=27,U_=28,z_=29,Ce=30,zh=31,PA=32,OA=852,KA=592,NA=15,QA=NA;function W_(e){return(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24)}function HA(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Bt.Buf16(320),this.work=new Bt.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function J_(e){var t;return!e||!e.state?Kt:(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=t.wrap&1),t.mode=Y_,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Bt.Buf32(OA),t.distcode=t.distdyn=new Bt.Buf32(KA),t.sane=1,t.back=-1,Ir)}function Z_(e){var t;return!e||!e.state?Kt:(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,J_(e))}function e0(e,t){var i,r;return!e||!e.state||(r=e.state,t<0?(i=0,t=-t):(i=(t>>4)+1,t<48&&(t&=15)),t&&(t<8||t>15))?Kt:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=i,r.wbits=t,Z_(e))}function t0(e,t){var i,r;return e?(r=new HA,e.state=r,r.window=null,i=e0(e,t),i!==Ir&&(e.state=null),i):Kt}function XA(e){return t0(e,QA)}var $_=!0,Nh,Qh;function UA(e){if($_){var t;for(Nh=new Bt.Buf32(512),Qh=new Bt.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for((0,Ws.default)(j_,e.lens,0,288,Nh,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;(0,Ws.default)(q_,e.lens,0,32,Qh,0,e.work,{bits:5}),$_=!1}e.lencode=Nh,e.lenbits=9,e.distcode=Qh,e.distbits=5}function i0(e,t,i,r){var s,n=e.state;return n.window===null&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new Bt.Buf8(n.wsize)),r>=n.wsize?(Bt.arraySet(n.window,t,i-n.wsize,n.wsize,0),n.wnext=0,n.whave=n.wsize):(s=n.wsize-n.wnext,s>r&&(s=r),Bt.arraySet(n.window,t,i-r,s,n.wnext),r-=s,r?(Bt.arraySet(n.window,t,i-r,r,0),n.wnext=r,n.whave=n.wsize):(n.wnext+=s,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=s))),0}function zA(e,t){var i,r,s,n,o,a,h,l,c,u,g,_,m,v,x=0,E,M,D,b,L,I,R,G,W=new Bt.Buf8(4),V,q,ne=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&e.avail_in!==0)return Kt;i=e.state,i.mode===ki&&(i.mode=Ph),o=e.next_out,s=e.output,h=e.avail_out,n=e.next_in,r=e.input,a=e.avail_in,l=i.hold,c=i.bits,u=a,g=h,G=Ir;e:for(;;)switch(i.mode){case Y_:if(i.wrap===0){i.mode=Ph;break}for(;c<16;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}if(i.wrap&2&&l===35615){i.check=0,W[0]=l&255,W[1]=l>>>8&255,i.check=(0,ni.default)(i.check,W,2,0),l=0,c=0,i.mode=S_;break}if(i.flags=0,i.head&&(i.head.done=!1),!(i.wrap&1)||(((l&255)<<8)+(l>>8))%31){e.msg="incorrect header check",i.mode=Ce;break}if((l&15)!==x_){e.msg="unknown compression method",i.mode=Ce;break}if(l>>>=4,c-=4,R=(l&15)+8,i.wbits===0)i.wbits=R;else if(R>i.wbits){e.msg="invalid window size",i.mode=Ce;break}i.dmax=1<<R,e.adler=i.check=1,i.mode=l&512?M_:ki,l=0,c=0;break;case S_:for(;c<16;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}if(i.flags=l,(i.flags&255)!==x_){e.msg="unknown compression method",i.mode=Ce;break}if(i.flags&57344){e.msg="unknown header flags set",i.mode=Ce;break}i.head&&(i.head.text=l>>8&1),i.flags&512&&(W[0]=l&255,W[1]=l>>>8&255,i.check=(0,ni.default)(i.check,W,2,0)),l=0,c=0,i.mode=C_;case C_:for(;c<32;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}i.head&&(i.head.time=l),i.flags&512&&(W[0]=l&255,W[1]=l>>>8&255,W[2]=l>>>16&255,W[3]=l>>>24&255,i.check=(0,ni.default)(i.check,W,4,0)),l=0,c=0,i.mode=k_;case k_:for(;c<16;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}i.head&&(i.head.xflags=l&255,i.head.os=l>>8),i.flags&512&&(W[0]=l&255,W[1]=l>>>8&255,i.check=(0,ni.default)(i.check,W,2,0)),l=0,c=0,i.mode=E_;case E_:if(i.flags&1024){for(;c<16;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}i.length=l,i.head&&(i.head.extra_len=l),i.flags&512&&(W[0]=l&255,W[1]=l>>>8&255,i.check=(0,ni.default)(i.check,W,2,0)),l=0,c=0}else i.head&&(i.head.extra=null);i.mode=B_;case B_:if(i.flags&1024&&(_=i.length,_>a&&(_=a),_&&(i.head&&(R=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),Bt.arraySet(i.head.extra,r,n,_,R)),i.flags&512&&(i.check=(0,ni.default)(i.check,r,_,n)),a-=_,n+=_,i.length-=_),i.length))break e;i.length=0,i.mode=L_;case L_:if(i.flags&2048){if(a===0)break e;_=0;do R=r[n+_++],i.head&&R&&i.length<65536&&(i.head.name+=String.fromCharCode(R));while(R&&_<a);if(i.flags&512&&(i.check=(0,ni.default)(i.check,r,_,n)),a-=_,n+=_,R)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=D_;case D_:if(i.flags&4096){if(a===0)break e;_=0;do R=r[n+_++],i.head&&R&&i.length<65536&&(i.head.comment+=String.fromCharCode(R));while(R&&_<a);if(i.flags&512&&(i.check=(0,ni.default)(i.check,r,_,n)),a-=_,n+=_,R)break e}else i.head&&(i.head.comment=null);i.mode=I_;case I_:if(i.flags&512){for(;c<16;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}if(l!==(i.check&65535)){e.msg="header crc mismatch",i.mode=Ce;break}l=0,c=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=ki;break;case M_:for(;c<32;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}e.adler=i.check=W_(l),l=0,c=0,i.mode=Eo;case Eo:if(i.havedict===0)return e.next_out=o,e.avail_out=h,e.next_in=n,e.avail_in=a,i.hold=l,i.bits=c,RA;e.adler=i.check=1,i.mode=ki;case ki:if(t===MA||t===So)break e;case Ph:if(i.last){l>>>=c&7,c-=c&7,i.mode=Kh;break}for(;c<3;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}switch(i.last=l&1,l>>>=1,c-=1,l&3){case 0:i.mode=T_;break;case 1:if(UA(i),i.mode=Co,t===So){l>>>=2,c-=2;break e}break;case 2:i.mode=F_;break;case 3:e.msg="invalid block type",i.mode=Ce}l>>>=2,c-=2;break;case T_:for(l>>>=c&7,c-=c&7;c<32;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}if((l&65535)!==(l>>>16^65535)){e.msg="invalid stored block lengths",i.mode=Ce;break}if(i.length=l&65535,l=0,c=0,i.mode=Oh,t===So)break e;case Oh:i.mode=R_;case R_:if(_=i.length,_){if(_>a&&(_=a),_>h&&(_=h),_===0)break e;Bt.arraySet(s,r,n,_,o),a-=_,n+=_,h-=_,o+=_,i.length-=_;break}i.mode=ki;break;case F_:for(;c<14;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}if(i.nlen=(l&31)+257,l>>>=5,c-=5,i.ndist=(l&31)+1,l>>>=5,c-=5,i.ncode=(l&15)+4,l>>>=4,c-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=Ce;break}i.have=0,i.mode=P_;case P_:for(;i.have<i.ncode;){for(;c<3;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}i.lens[ne[i.have++]]=l&7,l>>>=3,c-=3}for(;i.have<19;)i.lens[ne[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,V={bits:i.lenbits},G=(0,Ws.default)(IA,i.lens,0,19,i.lencode,0,i.work,V),i.lenbits=V.bits,G){e.msg="invalid code lengths set",i.mode=Ce;break}i.have=0,i.mode=O_;case O_:for(;i.have<i.nlen+i.ndist;){for(;x=i.lencode[l&(1<<i.lenbits)-1],E=x>>>24,M=x>>>16&255,D=x&65535,!(E<=c);){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}if(D<16)l>>>=E,c-=E,i.lens[i.have++]=D;else{if(D===16){for(q=E+2;c<q;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}if(l>>>=E,c-=E,i.have===0){e.msg="invalid bit length repeat",i.mode=Ce;break}R=i.lens[i.have-1],_=3+(l&3),l>>>=2,c-=2}else if(D===17){for(q=E+3;c<q;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}l>>>=E,c-=E,R=0,_=3+(l&7),l>>>=3,c-=3}else{for(q=E+7;c<q;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}l>>>=E,c-=E,R=0,_=11+(l&127),l>>>=7,c-=7}if(i.have+_>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=Ce;break}for(;_--;)i.lens[i.have++]=R}}if(i.mode===Ce)break;if(i.lens[256]===0){e.msg="invalid code -- missing end-of-block",i.mode=Ce;break}if(i.lenbits=9,V={bits:i.lenbits},G=(0,Ws.default)(j_,i.lens,0,i.nlen,i.lencode,0,i.work,V),i.lenbits=V.bits,G){e.msg="invalid literal/lengths set",i.mode=Ce;break}if(i.distbits=6,i.distcode=i.distdyn,V={bits:i.distbits},G=(0,Ws.default)(q_,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,V),i.distbits=V.bits,G){e.msg="invalid distances set",i.mode=Ce;break}if(i.mode=Co,t===So)break e;case Co:i.mode=ko;case ko:if(a>=6&&h>=258){e.next_out=o,e.avail_out=h,e.next_in=n,e.avail_in=a,i.hold=l,i.bits=c,(0,LA.default)(e,g),o=e.next_out,s=e.output,h=e.avail_out,n=e.next_in,r=e.input,a=e.avail_in,l=i.hold,c=i.bits,i.mode===ki&&(i.back=-1);break}for(i.back=0;x=i.lencode[l&(1<<i.lenbits)-1],E=x>>>24,M=x>>>16&255,D=x&65535,!(E<=c);){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}if(M&&(M&240)===0){for(b=E,L=M,I=D;x=i.lencode[I+((l&(1<<b+L)-1)>>b)],E=x>>>24,M=x>>>16&255,D=x&65535,!(b+E<=c);){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}l>>>=b,c-=b,i.back+=b}if(l>>>=E,c-=E,i.back+=E,i.length=D,M===0){i.mode=X_;break}if(M&32){i.back=-1,i.mode=ki;break}if(M&64){e.msg="invalid literal/length code",i.mode=Ce;break}i.extra=M&15,i.mode=K_;case K_:if(i.extra){for(q=i.extra;c<q;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}i.length+=l&(1<<i.extra)-1,l>>>=i.extra,c-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=N_;case N_:for(;x=i.distcode[l&(1<<i.distbits)-1],E=x>>>24,M=x>>>16&255,D=x&65535,!(E<=c);){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}if((M&240)===0){for(b=E,L=M,I=D;x=i.distcode[I+((l&(1<<b+L)-1)>>b)],E=x>>>24,M=x>>>16&255,D=x&65535,!(b+E<=c);){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}l>>>=b,c-=b,i.back+=b}if(l>>>=E,c-=E,i.back+=E,M&64){e.msg="invalid distance code",i.mode=Ce;break}i.offset=D,i.extra=M&15,i.mode=Q_;case Q_:if(i.extra){for(q=i.extra;c<q;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}i.offset+=l&(1<<i.extra)-1,l>>>=i.extra,c-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=Ce;break}i.mode=H_;case H_:if(h===0)break e;if(_=g-h,i.offset>_){if(_=i.offset-_,_>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=Ce;break}_>i.wnext?(_-=i.wnext,m=i.wsize-_):m=i.wnext-_,_>i.length&&(_=i.length),v=i.window}else v=s,m=o-i.offset,_=i.length;_>h&&(_=h),h-=_,i.length-=_;do s[o++]=v[m++];while(--_);i.length===0&&(i.mode=ko);break;case X_:if(h===0)break e;s[o++]=i.length,h--,i.mode=ko;break;case Kh:if(i.wrap){for(;c<32;){if(a===0)break e;a--,l|=r[n++]<<c,c+=8}if(g-=h,e.total_out+=g,i.total+=g,g&&(e.adler=i.check=i.flags?(0,ni.default)(i.check,s,g,o-g):(0,Xh.default)(i.check,s,g,o-g)),g=h,(i.flags?l:W_(l))!==i.check){e.msg="incorrect data check",i.mode=Ce;break}l=0,c=0}i.mode=U_;case U_:if(i.wrap&&i.flags){for(;c<32;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}if(l!==(i.total&4294967295)){e.msg="incorrect length check",i.mode=Ce;break}l=0,c=0}i.mode=z_;case z_:G=TA;break e;case Ce:G=V_;break e;case zh:return Uh;case PA:default:return Kt}return e.next_out=o,e.avail_out=h,e.next_in=n,e.avail_in=a,i.hold=l,i.bits=c,(i.wsize||g!==e.avail_out&&i.mode<Ce&&(i.mode<Kh||t!==A_))&&i0(e,e.output,e.next_out,g-e.avail_out)?(i.mode=zh,Uh):(u-=e.avail_in,g-=e.avail_out,e.total_in+=u,e.total_out+=g,i.total+=g,i.wrap&&g&&(e.adler=i.check=i.flags?(0,ni.default)(i.check,s,g,e.next_out-g):(0,Xh.default)(i.check,s,g,e.next_out-g)),e.data_type=i.bits+(i.last?64:0)+(i.mode===ki?128:0)+(i.mode===Co||i.mode===Oh?256:0),(u===0&&g===0||t===A_)&&G===Ir&&(G=FA),G)}function WA(e){if(!e||!e.state)return Kt;var t=e.state;return t.window&&(t.window=null),e.state=null,Ir}function $A(e,t){var i;return!e||!e.state||(i=e.state,(i.wrap&2)===0)?Kt:(i.head=t,t.done=!1,Ir)}function GA(e,t){var i=t.length,r,s,n;return!e||!e.state||(r=e.state,r.wrap!==0&&r.mode!==Eo)?Kt:r.mode===Eo&&(s=1,s=(0,Xh.default)(s,t,i,0),s!==r.check)?V_:(n=i0(e,t,i,i),n?(r.mode=zh,Uh):(r.havedict=1,Ir))}var yD=he.inflateInfo="pako inflate (from Nodeca project)"});var $h=ie(Wh=>{"use strict";Object.defineProperty(Wh,"__esModule",{value:!0});Wh.default=jA;function jA(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}});var Do=ie(Lo=>{"use strict";Object.defineProperty(Lo,"__esModule",{value:!0});Lo.default=void 0;var Gh=r0(),qA=VA($h());function VA(e){return e&&e.__esModule?e:{default:e}}function $s(e){"@babel/helpers - typeof";return $s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$s(e)}function YA(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s0(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ZA(r.key),r)}}function JA(e,t,i){return t&&s0(e.prototype,t),i&&s0(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function ZA(e){var t=ex(e,"string");return $s(t)=="symbol"?t:t+""}function ex(e,t){if($s(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if($s(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var AD=Lo.default=function(){function e(){YA(this,e),this.strm=new qA.default,this.chunkSize=1024*10*10,this.strm.output=new Uint8Array(this.chunkSize),(0,Gh.inflateInit)(this.strm)}return JA(e,[{key:"setInput",value:function(i){i?(this.strm.input=i,this.strm.avail_in=this.strm.input.length,this.strm.next_in=0):(this.strm.input=null,this.strm.avail_in=0,this.strm.next_in=0)}},{key:"inflate",value:function(i){i>this.chunkSize&&(this.chunkSize=i,this.strm.output=new Uint8Array(this.chunkSize)),this.strm.next_out=0,this.strm.avail_out=i;var r=(0,Gh.inflate)(this.strm,0);if(r<0)throw new Error("zlib inflate failed");if(this.strm.next_out!=i)throw new Error("Incomplete zlib block");return new Uint8Array(this.strm.output.buffer,0,this.strm.next_out)}},{key:"reset",value:function(){(0,Gh.inflateReset)(this.strm)}}])}()});var B0=ie(Tr=>{"use strict";function Jh(e){"@babel/helpers - typeof";return Jh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jh(e)}Object.defineProperty(Tr,"__esModule",{value:!0});Tr._tr_align=bx;Tr._tr_flush_block=wx;Tr._tr_init=yx;Tr._tr_stored_block=E0;Tr._tr_tally=Ax;var tx=ix(zs());function d0(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(d0=function(s){return s?i:t})(e)}function ix(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||Jh(e)!="object"&&typeof e!="function")return{default:e};var i=d0(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&{}.hasOwnProperty.call(e,n)){var o=s?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}var rx=4,n0=0,o0=1,sx=2;function os(e){for(var t=e.length;--t>=0;)e[t]=0}var nx=0,f0=1,ox=2,ax=3,lx=258,tc=29,Js=256,js=Js+1+tc,ns=30,ic=19,_0=2*js+1,Mr=15,jh=16,hx=7,rc=256,p0=16,g0=17,m0=18,Zh=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Io=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],cx=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],v0=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ux=512,Ei=new Array((js+2)*2);os(Ei);var Gs=new Array(ns*2);os(Gs);var qs=new Array(ux);os(qs);var Vs=new Array(lx-ax+1);os(Vs);var sc=new Array(tc);os(sc);var Mo=new Array(ns);os(Mo);function qh(e,t,i,r,s){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=r,this.max_length=s,this.has_stree=e&&e.length}var y0,b0,w0;function Vh(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function A0(e){return e<256?qs[e]:qs[256+(e>>>7)]}function Ys(e,t){e.pending_buf[e.pending++]=t&255,e.pending_buf[e.pending++]=t>>>8&255}function At(e,t,i){e.bi_valid>jh-i?(e.bi_buf|=t<<e.bi_valid&65535,Ys(e,e.bi_buf),e.bi_buf=t>>jh-e.bi_valid,e.bi_valid+=i-jh):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)}function oi(e,t,i){At(e,i[t*2],i[t*2+1])}function x0(e,t){var i=0;do i|=e&1,e>>>=1,i<<=1;while(--t>0);return i>>>1}function dx(e){e.bi_valid===16?(Ys(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)}function fx(e,t){var i=t.dyn_tree,r=t.max_code,s=t.stat_desc.static_tree,n=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,a=t.stat_desc.extra_base,h=t.stat_desc.max_length,l,c,u,g,_,m,v=0;for(g=0;g<=Mr;g++)e.bl_count[g]=0;for(i[e.heap[e.heap_max]*2+1]=0,l=e.heap_max+1;l<_0;l++)c=e.heap[l],g=i[i[c*2+1]*2+1]+1,g>h&&(g=h,v++),i[c*2+1]=g,!(c>r)&&(e.bl_count[g]++,_=0,c>=a&&(_=o[c-a]),m=i[c*2],e.opt_len+=m*(g+_),n&&(e.static_len+=m*(s[c*2+1]+_)));if(v!==0){do{for(g=h-1;e.bl_count[g]===0;)g--;e.bl_count[g]--,e.bl_count[g+1]+=2,e.bl_count[h]--,v-=2}while(v>0);for(g=h;g!==0;g--)for(c=e.bl_count[g];c!==0;)u=e.heap[--l],!(u>r)&&(i[u*2+1]!==g&&(e.opt_len+=(g-i[u*2+1])*i[u*2],i[u*2+1]=g),c--)}}function S0(e,t,i){var r=new Array(Mr+1),s=0,n,o;for(n=1;n<=Mr;n++)r[n]=s=s+i[n-1]<<1;for(o=0;o<=t;o++){var a=e[o*2+1];a!==0&&(e[o*2]=x0(r[a]++,a))}}function _x(){var e,t,i,r,s,n=new Array(Mr+1);for(i=0,r=0;r<tc-1;r++)for(sc[r]=i,e=0;e<1<<Zh[r];e++)Vs[i++]=r;for(Vs[i-1]=r,s=0,r=0;r<16;r++)for(Mo[r]=s,e=0;e<1<<Io[r];e++)qs[s++]=r;for(s>>=7;r<ns;r++)for(Mo[r]=s<<7,e=0;e<1<<Io[r]-7;e++)qs[256+s++]=r;for(t=0;t<=Mr;t++)n[t]=0;for(e=0;e<=143;)Ei[e*2+1]=8,e++,n[8]++;for(;e<=255;)Ei[e*2+1]=9,e++,n[9]++;for(;e<=279;)Ei[e*2+1]=7,e++,n[7]++;for(;e<=287;)Ei[e*2+1]=8,e++,n[8]++;for(S0(Ei,js+1,n),e=0;e<ns;e++)Gs[e*2+1]=5,Gs[e*2]=x0(e,5);y0=new qh(Ei,Zh,Js+1,js,Mr),b0=new qh(Gs,Io,0,ns,Mr),w0=new qh(new Array(0),cx,0,ic,hx)}function C0(e){var t;for(t=0;t<js;t++)e.dyn_ltree[t*2]=0;for(t=0;t<ns;t++)e.dyn_dtree[t*2]=0;for(t=0;t<ic;t++)e.bl_tree[t*2]=0;e.dyn_ltree[rc*2]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function k0(e){e.bi_valid>8?Ys(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function px(e,t,i,r){k0(e),r&&(Ys(e,i),Ys(e,~i)),tx.arraySet(e.pending_buf,e.window,t,i,e.pending),e.pending+=i}function a0(e,t,i,r){var s=t*2,n=i*2;return e[s]<e[n]||e[s]===e[n]&&r[t]<=r[i]}function Yh(e,t,i){for(var r=e.heap[i],s=i<<1;s<=e.heap_len&&(s<e.heap_len&&a0(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!a0(t,r,e.heap[s],e.depth));)e.heap[i]=e.heap[s],i=s,s<<=1;e.heap[i]=r}function l0(e,t,i){var r,s,n=0,o,a;if(e.last_lit!==0)do r=e.pending_buf[e.d_buf+n*2]<<8|e.pending_buf[e.d_buf+n*2+1],s=e.pending_buf[e.l_buf+n],n++,r===0?oi(e,s,t):(o=Vs[s],oi(e,o+Js+1,t),a=Zh[o],a!==0&&(s-=sc[o],At(e,s,a)),r--,o=A0(r),oi(e,o,i),a=Io[o],a!==0&&(r-=Mo[o],At(e,r,a)));while(n<e.last_lit);oi(e,rc,t)}function ec(e,t){var i=t.dyn_tree,r=t.stat_desc.static_tree,s=t.stat_desc.has_stree,n=t.stat_desc.elems,o,a,h=-1,l;for(e.heap_len=0,e.heap_max=_0,o=0;o<n;o++)i[o*2]!==0?(e.heap[++e.heap_len]=h=o,e.depth[o]=0):i[o*2+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=h<2?++h:0,i[l*2]=1,e.depth[l]=0,e.opt_len--,s&&(e.static_len-=r[l*2+1]);for(t.max_code=h,o=e.heap_len>>1;o>=1;o--)Yh(e,i,o);l=n;do o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Yh(e,i,1),a=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=a,i[l*2]=i[o*2]+i[a*2],e.depth[l]=(e.depth[o]>=e.depth[a]?e.depth[o]:e.depth[a])+1,i[o*2+1]=i[a*2+1]=l,e.heap[1]=l++,Yh(e,i,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],fx(e,t),S0(i,h,e.bl_count)}function h0(e,t,i){var r,s=-1,n,o=t[0*2+1],a=0,h=7,l=4;for(o===0&&(h=138,l=3),t[(i+1)*2+1]=65535,r=0;r<=i;r++)n=o,o=t[(r+1)*2+1],!(++a<h&&n===o)&&(a<l?e.bl_tree[n*2]+=a:n!==0?(n!==s&&e.bl_tree[n*2]++,e.bl_tree[p0*2]++):a<=10?e.bl_tree[g0*2]++:e.bl_tree[m0*2]++,a=0,s=n,o===0?(h=138,l=3):n===o?(h=6,l=3):(h=7,l=4))}function c0(e,t,i){var r,s=-1,n,o=t[0*2+1],a=0,h=7,l=4;for(o===0&&(h=138,l=3),r=0;r<=i;r++)if(n=o,o=t[(r+1)*2+1],!(++a<h&&n===o)){if(a<l)do oi(e,n,e.bl_tree);while(--a!==0);else n!==0?(n!==s&&(oi(e,n,e.bl_tree),a--),oi(e,p0,e.bl_tree),At(e,a-3,2)):a<=10?(oi(e,g0,e.bl_tree),At(e,a-3,3)):(oi(e,m0,e.bl_tree),At(e,a-11,7));a=0,s=n,o===0?(h=138,l=3):n===o?(h=6,l=3):(h=7,l=4)}}function gx(e){var t;for(h0(e,e.dyn_ltree,e.l_desc.max_code),h0(e,e.dyn_dtree,e.d_desc.max_code),ec(e,e.bl_desc),t=ic-1;t>=3&&e.bl_tree[v0[t]*2+1]===0;t--);return e.opt_len+=3*(t+1)+5+5+4,t}function mx(e,t,i,r){var s;for(At(e,t-257,5),At(e,i-1,5),At(e,r-4,4),s=0;s<r;s++)At(e,e.bl_tree[v0[s]*2+1],3);c0(e,e.dyn_ltree,t-1),c0(e,e.dyn_dtree,i-1)}function vx(e){var t=4093624447,i;for(i=0;i<=31;i++,t>>>=1)if(t&1&&e.dyn_ltree[i*2]!==0)return n0;if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0)return o0;for(i=32;i<Js;i++)if(e.dyn_ltree[i*2]!==0)return o0;return n0}var u0=!1;function yx(e){u0||(_x(),u0=!0),e.l_desc=new Vh(e.dyn_ltree,y0),e.d_desc=new Vh(e.dyn_dtree,b0),e.bl_desc=new Vh(e.bl_tree,w0),e.bi_buf=0,e.bi_valid=0,C0(e)}function E0(e,t,i,r){At(e,(nx<<1)+(r?1:0),3),px(e,t,i,!0)}function bx(e){At(e,f0<<1,3),oi(e,rc,Ei),dx(e)}function wx(e,t,i,r){var s,n,o=0;e.level>0?(e.strm.data_type===sx&&(e.strm.data_type=vx(e)),ec(e,e.l_desc),ec(e,e.d_desc),o=gx(e),s=e.opt_len+3+7>>>3,n=e.static_len+3+7>>>3,n<=s&&(s=n)):s=n=i+5,i+4<=s&&t!==-1?E0(e,t,i,r):e.strategy===rx||n===s?(At(e,(f0<<1)+(r?1:0),3),l0(e,Ei,Gs)):(At(e,(ox<<1)+(r?1:0),3),mx(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),l0(e,e.dyn_ltree,e.dyn_dtree)),C0(e),r&&k0(e)}function Ax(e,t,i){return e.pending_buf[e.d_buf+e.last_lit*2]=t>>>8&255,e.pending_buf[e.d_buf+e.last_lit*2+1]=t&255,e.pending_buf[e.l_buf+e.last_lit]=i&255,e.last_lit++,t===0?e.dyn_ltree[i*2]++:(e.matches++,t--,e.dyn_ltree[(Vs[i]+Js+1)*2]++,e.dyn_dtree[A0(t)*2]++),e.last_lit===e.lit_bufsize-1}});var L0=ie(To=>{"use strict";Object.defineProperty(To,"__esModule",{value:!0});To.default=void 0;var CD=To.default={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}});var Q0=ie(re=>{"use strict";function ac(e){"@babel/helpers - typeof";return ac=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ac(e)}Object.defineProperty(re,"__esModule",{value:!0});re.Z_UNKNOWN=re.Z_STREAM_ERROR=re.Z_STREAM_END=re.Z_RLE=re.Z_PARTIAL_FLUSH=re.Z_OK=re.Z_NO_FLUSH=re.Z_HUFFMAN_ONLY=re.Z_FULL_FLUSH=re.Z_FIXED=re.Z_FINISH=re.Z_FILTERED=re.Z_DEFLATED=re.Z_DEFAULT_STRATEGY=re.Z_DEFAULT_COMPRESSION=re.Z_DATA_ERROR=re.Z_BUF_ERROR=re.Z_BLOCK=void 0;re.deflate=Jx;re.deflateEnd=Zx;re.deflateInfo=void 0;re.deflateInit=Yx;re.deflateInit2=N0;re.deflateReset=K0;re.deflateResetKeep=O0;re.deflateSetDictionary=eS;re.deflateSetHeader=Vx;var pt=F0(zs()),Nt=F0(B0()),T0=cc(Lh()),er=cc(Ih()),xx=cc(L0());function cc(e){return e&&e.__esModule?e:{default:e}}function R0(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(R0=function(s){return s?i:t})(e)}function F0(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||ac(e)!="object"&&typeof e!="function")return{default:e};var i=R0(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&{}.hasOwnProperty.call(e,n)){var o=s?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}var Or=re.Z_NO_FLUSH=0,Sx=re.Z_PARTIAL_FLUSH=1,Cx=re.Z_FULL_FLUSH=3,nr=re.Z_FINISH=4,D0=re.Z_BLOCK=5,li=re.Z_OK=0,I0=re.Z_STREAM_END=1,Qt=re.Z_STREAM_ERROR=-2,kx=re.Z_DATA_ERROR=-3,nc=re.Z_BUF_ERROR=-5,Ex=re.Z_DEFAULT_COMPRESSION=-1,Bx=re.Z_FILTERED=1,Ro=re.Z_HUFFMAN_ONLY=2,Lx=re.Z_RLE=3,Dx=re.Z_FIXED=4,Ix=re.Z_DEFAULT_STRATEGY=0,Mx=re.Z_UNKNOWN=2,Ko=re.Z_DEFLATED=8,Tx=9,Rx=15,Fx=8,Px=29,Ox=256,lc=Ox+1+Px,Kx=30,Nx=19,Qx=2*lc+1,Hx=15,ce=3,rr=258,Zt=rr+ce+1,Xx=32,No=42,hc=69,Fo=73,Po=91,Oo=103,Rr=113,en=666,ze=1,tn=2,Fr=3,hs=4,Ux=3;function sr(e,t){return e.msg=xx.default[t],t}function M0(e){return(e<<1)-(e>4?9:0)}function ir(e){for(var t=e.length;--t>=0;)e[t]=0}function tr(e){var t=e.state,i=t.pending;i>e.avail_out&&(i=e.avail_out),i!==0&&(pt.arraySet(e.output,t.pending_buf,t.pending_out,i,e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,t.pending===0&&(t.pending_out=0))}function nt(e,t){Nt._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,tr(e.strm)}function _e(e,t){e.pending_buf[e.pending++]=t}function Zs(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=t&255}function zx(e,t,i,r){var s=e.avail_in;return s>r&&(s=r),s===0?0:(e.avail_in-=s,pt.arraySet(t,e.input,e.next_in,s,i),e.state.wrap===1?e.adler=(0,T0.default)(e.adler,t,s,i):e.state.wrap===2&&(e.adler=(0,er.default)(e.adler,t,s,i)),e.next_in+=s,e.total_in+=s,s)}function P0(e,t){var i=e.max_chain_length,r=e.strstart,s,n,o=e.prev_length,a=e.nice_match,h=e.strstart>e.w_size-Zt?e.strstart-(e.w_size-Zt):0,l=e.window,c=e.w_mask,u=e.prev,g=e.strstart+rr,_=l[r+o-1],m=l[r+o];e.prev_length>=e.good_match&&(i>>=2),a>e.lookahead&&(a=e.lookahead);do if(s=t,!(l[s+o]!==m||l[s+o-1]!==_||l[s]!==l[r]||l[++s]!==l[r+1])){r+=2,s++;do;while(l[++r]===l[++s]&&l[++r]===l[++s]&&l[++r]===l[++s]&&l[++r]===l[++s]&&l[++r]===l[++s]&&l[++r]===l[++s]&&l[++r]===l[++s]&&l[++r]===l[++s]&&r<g);if(n=rr-(g-r),r=g-rr,n>o){if(e.match_start=t,o=n,n>=a)break;_=l[r+o-1],m=l[r+o]}}while((t=u[t&c])>h&&--i!==0);return o<=e.lookahead?o:e.lookahead}function Pr(e){var t=e.w_size,i,r,s,n,o;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Zt)){pt.arraySet(e.window,e.window,t,t,0),e.match_start-=t,e.strstart-=t,e.block_start-=t,r=e.hash_size,i=r;do s=e.head[--i],e.head[i]=s>=t?s-t:0;while(--r);r=t,i=r;do s=e.prev[--i],e.prev[i]=s>=t?s-t:0;while(--r);n+=t}if(e.strm.avail_in===0)break;if(r=zx(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=r,e.lookahead+e.insert>=ce)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+ce-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<ce)););}while(e.lookahead<Zt&&e.strm.avail_in!==0)}function Wx(e,t){var i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(Pr(e),e.lookahead===0&&t===Or)return ze;if(e.lookahead===0)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+i;if((e.strstart===0||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,nt(e,!1),e.strm.avail_out===0)||e.strstart-e.block_start>=e.w_size-Zt&&(nt(e,!1),e.strm.avail_out===0))return ze}return e.insert=0,t===nr?(nt(e,!0),e.strm.avail_out===0?Fr:hs):(e.strstart>e.block_start&&(nt(e,!1),e.strm.avail_out===0),ze)}function oc(e,t){for(var i,r;;){if(e.lookahead<Zt){if(Pr(e),e.lookahead<Zt&&t===Or)return ze;if(e.lookahead===0)break}if(i=0,e.lookahead>=ce&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ce-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),i!==0&&e.strstart-i<=e.w_size-Zt&&(e.match_length=P0(e,i)),e.match_length>=ce)if(r=Nt._tr_tally(e,e.strstart-e.match_start,e.match_length-ce),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=ce){e.match_length--;do e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ce-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=Nt._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(nt(e,!1),e.strm.avail_out===0))return ze}return e.insert=e.strstart<ce-1?e.strstart:ce-1,t===nr?(nt(e,!0),e.strm.avail_out===0?Fr:hs):e.last_lit&&(nt(e,!1),e.strm.avail_out===0)?ze:tn}function as(e,t){for(var i,r,s;;){if(e.lookahead<Zt){if(Pr(e),e.lookahead<Zt&&t===Or)return ze;if(e.lookahead===0)break}if(i=0,e.lookahead>=ce&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ce-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=ce-1,i!==0&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-Zt&&(e.match_length=P0(e,i),e.match_length<=5&&(e.strategy===Bx||e.match_length===ce&&e.strstart-e.match_start>4096)&&(e.match_length=ce-1)),e.prev_length>=ce&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-ce,r=Nt._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-ce),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=s&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ce-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=ce-1,e.strstart++,r&&(nt(e,!1),e.strm.avail_out===0))return ze}else if(e.match_available){if(r=Nt._tr_tally(e,0,e.window[e.strstart-1]),r&&nt(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return ze}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=Nt._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<ce-1?e.strstart:ce-1,t===nr?(nt(e,!0),e.strm.avail_out===0?Fr:hs):e.last_lit&&(nt(e,!1),e.strm.avail_out===0)?ze:tn}function $x(e,t){for(var i,r,s,n,o=e.window;;){if(e.lookahead<=rr){if(Pr(e),e.lookahead<=rr&&t===Or)return ze;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=ce&&e.strstart>0&&(s=e.strstart-1,r=o[s],r===o[++s]&&r===o[++s]&&r===o[++s])){n=e.strstart+rr;do;while(r===o[++s]&&r===o[++s]&&r===o[++s]&&r===o[++s]&&r===o[++s]&&r===o[++s]&&r===o[++s]&&r===o[++s]&&s<n);e.match_length=rr-(n-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=ce?(i=Nt._tr_tally(e,1,e.match_length-ce),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=Nt._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(nt(e,!1),e.strm.avail_out===0))return ze}return e.insert=0,t===nr?(nt(e,!0),e.strm.avail_out===0?Fr:hs):e.last_lit&&(nt(e,!1),e.strm.avail_out===0)?ze:tn}function Gx(e,t){for(var i;;){if(e.lookahead===0&&(Pr(e),e.lookahead===0)){if(t===Or)return ze;break}if(e.match_length=0,i=Nt._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(nt(e,!1),e.strm.avail_out===0))return ze}return e.insert=0,t===nr?(nt(e,!0),e.strm.avail_out===0?Fr:hs):e.last_lit&&(nt(e,!1),e.strm.avail_out===0)?ze:tn}function ai(e,t,i,r,s){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=r,this.func=s}var ls;ls=[new ai(0,0,0,0,Wx),new ai(4,4,8,4,oc),new ai(4,5,16,8,oc),new ai(4,6,32,32,oc),new ai(4,4,16,16,as),new ai(8,16,32,32,as),new ai(8,16,128,128,as),new ai(8,32,128,256,as),new ai(32,128,258,1024,as),new ai(32,258,258,4096,as)];function jx(e){e.window_size=2*e.w_size,ir(e.head),e.max_lazy_match=ls[e.level].max_lazy,e.good_match=ls[e.level].good_length,e.nice_match=ls[e.level].nice_length,e.max_chain_length=ls[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=ce-1,e.match_available=0,e.ins_h=0}function qx(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Ko,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new pt.Buf16(Qx*2),this.dyn_dtree=new pt.Buf16((2*Kx+1)*2),this.bl_tree=new pt.Buf16((2*Nx+1)*2),ir(this.dyn_ltree),ir(this.dyn_dtree),ir(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new pt.Buf16(Hx+1),this.heap=new pt.Buf16(2*lc+1),ir(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new pt.Buf16(2*lc+1),ir(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function O0(e){var t;return!e||!e.state?sr(e,Qt):(e.total_in=e.total_out=0,e.data_type=Mx,t=e.state,t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?No:Rr,e.adler=t.wrap===2?0:1,t.last_flush=Or,Nt._tr_init(t),li)}function K0(e){var t=O0(e);return t===li&&jx(e.state),t}function Vx(e,t){return!e||!e.state||e.state.wrap!==2?Qt:(e.state.gzhead=t,li)}function N0(e,t,i,r,s,n){if(!e)return Qt;var o=1;if(t===Ex&&(t=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),s<1||s>Tx||i!==Ko||r<8||r>15||t<0||t>9||n<0||n>Dx)return sr(e,Qt);r===8&&(r=9);var a=new qx;return e.state=a,a.strm=e,a.wrap=o,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=s+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+ce-1)/ce),a.window=new pt.Buf8(a.w_size*2),a.head=new pt.Buf16(a.hash_size),a.prev=new pt.Buf16(a.w_size),a.lit_bufsize=1<<s+6,a.pending_buf_size=a.lit_bufsize*4,a.pending_buf=new pt.Buf8(a.pending_buf_size),a.d_buf=1*a.lit_bufsize,a.l_buf=3*a.lit_bufsize,a.level=t,a.strategy=n,a.method=i,K0(e)}function Yx(e,t){return N0(e,t,Ko,Rx,Fx,Ix)}function Jx(e,t){var i,r,s,n;if(!e||!e.state||t>D0||t<0)return e?sr(e,Qt):Qt;if(r=e.state,!e.output||!e.input&&e.avail_in!==0||r.status===en&&t!==nr)return sr(e,e.avail_out===0?nc:Qt);if(r.strm=e,i=r.last_flush,r.last_flush=t,r.status===No)if(r.wrap===2)e.adler=0,_e(r,31),_e(r,139),_e(r,8),r.gzhead?(_e(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),_e(r,r.gzhead.time&255),_e(r,r.gzhead.time>>8&255),_e(r,r.gzhead.time>>16&255),_e(r,r.gzhead.time>>24&255),_e(r,r.level===9?2:r.strategy>=Ro||r.level<2?4:0),_e(r,r.gzhead.os&255),r.gzhead.extra&&r.gzhead.extra.length&&(_e(r,r.gzhead.extra.length&255),_e(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=(0,er.default)(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=hc):(_e(r,0),_e(r,0),_e(r,0),_e(r,0),_e(r,0),_e(r,r.level===9?2:r.strategy>=Ro||r.level<2?4:0),_e(r,Ux),r.status=Rr);else{var o=Ko+(r.w_bits-8<<4)<<8,a=-1;r.strategy>=Ro||r.level<2?a=0:r.level<6?a=1:r.level===6?a=2:a=3,o|=a<<6,r.strstart!==0&&(o|=Xx),o+=31-o%31,r.status=Rr,Zs(r,o),r.strstart!==0&&(Zs(r,e.adler>>>16),Zs(r,e.adler&65535)),e.adler=1}if(r.status===hc)if(r.gzhead.extra){for(s=r.pending;r.gzindex<(r.gzhead.extra.length&65535)&&!(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>s&&(e.adler=(0,er.default)(e.adler,r.pending_buf,r.pending-s,s)),tr(e),s=r.pending,r.pending===r.pending_buf_size));)_e(r,r.gzhead.extra[r.gzindex]&255),r.gzindex++;r.gzhead.hcrc&&r.pending>s&&(e.adler=(0,er.default)(e.adler,r.pending_buf,r.pending-s,s)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=Fo)}else r.status=Fo;if(r.status===Fo)if(r.gzhead.name){s=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>s&&(e.adler=(0,er.default)(e.adler,r.pending_buf,r.pending-s,s)),tr(e),s=r.pending,r.pending===r.pending_buf_size)){n=1;break}r.gzindex<r.gzhead.name.length?n=r.gzhead.name.charCodeAt(r.gzindex++)&255:n=0,_e(r,n)}while(n!==0);r.gzhead.hcrc&&r.pending>s&&(e.adler=(0,er.default)(e.adler,r.pending_buf,r.pending-s,s)),n===0&&(r.gzindex=0,r.status=Po)}else r.status=Po;if(r.status===Po)if(r.gzhead.comment){s=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>s&&(e.adler=(0,er.default)(e.adler,r.pending_buf,r.pending-s,s)),tr(e),s=r.pending,r.pending===r.pending_buf_size)){n=1;break}r.gzindex<r.gzhead.comment.length?n=r.gzhead.comment.charCodeAt(r.gzindex++)&255:n=0,_e(r,n)}while(n!==0);r.gzhead.hcrc&&r.pending>s&&(e.adler=(0,er.default)(e.adler,r.pending_buf,r.pending-s,s)),n===0&&(r.status=Oo)}else r.status=Oo;if(r.status===Oo&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&tr(e),r.pending+2<=r.pending_buf_size&&(_e(r,e.adler&255),_e(r,e.adler>>8&255),e.adler=0,r.status=Rr)):r.status=Rr),r.pending!==0){if(tr(e),e.avail_out===0)return r.last_flush=-1,li}else if(e.avail_in===0&&M0(t)<=M0(i)&&t!==nr)return sr(e,nc);if(r.status===en&&e.avail_in!==0)return sr(e,nc);if(e.avail_in!==0||r.lookahead!==0||t!==Or&&r.status!==en){var h=r.strategy===Ro?Gx(r,t):r.strategy===Lx?$x(r,t):ls[r.level].func(r,t);if((h===Fr||h===hs)&&(r.status=en),h===ze||h===Fr)return e.avail_out===0&&(r.last_flush=-1),li;if(h===tn&&(t===Sx?Nt._tr_align(r):t!==D0&&(Nt._tr_stored_block(r,0,0,!1),t===Cx&&(ir(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),tr(e),e.avail_out===0))return r.last_flush=-1,li}return t!==nr?li:r.wrap<=0?I0:(r.wrap===2?(_e(r,e.adler&255),_e(r,e.adler>>8&255),_e(r,e.adler>>16&255),_e(r,e.adler>>24&255),_e(r,e.total_in&255),_e(r,e.total_in>>8&255),_e(r,e.total_in>>16&255),_e(r,e.total_in>>24&255)):(Zs(r,e.adler>>>16),Zs(r,e.adler&65535)),tr(e),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?li:I0)}function Zx(e){var t;return!e||!e.state?Qt:(t=e.state.status,t!==No&&t!==hc&&t!==Fo&&t!==Po&&t!==Oo&&t!==Rr&&t!==en?sr(e,Qt):(e.state=null,t===Rr?sr(e,kx):li))}function eS(e,t){var i=t.length,r,s,n,o,a,h,l,c;if(!e||!e.state||(r=e.state,o=r.wrap,o===2||o===1&&r.status!==No||r.lookahead))return Qt;for(o===1&&(e.adler=(0,T0.default)(e.adler,t,i,0)),r.wrap=0,i>=r.w_size&&(o===0&&(ir(r.head),r.strstart=0,r.block_start=0,r.insert=0),c=new pt.Buf8(r.w_size),pt.arraySet(c,t,i-r.w_size,r.w_size,0),t=c,i=r.w_size),a=e.avail_in,h=e.next_in,l=e.input,e.avail_in=i,e.next_in=0,e.input=t,Pr(r);r.lookahead>=ce;){s=r.strstart,n=r.lookahead-(ce-1);do r.ins_h=(r.ins_h<<r.hash_shift^r.window[s+ce-1])&r.hash_mask,r.prev[s&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=s,s++;while(--n);r.strstart=s,r.lookahead=ce-1,Pr(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=ce-1,r.match_available=0,e.next_in=h,e.input=l,e.avail_in=a,r.wrap=o,li}var ED=re.deflateInfo="pako deflate (from Nodeca project)"});var X0=ie(Qo=>{"use strict";Object.defineProperty(Qo,"__esModule",{value:!0});Qo.default=void 0;var cs=Q0(),tS=iS($h());function iS(e){return e&&e.__esModule?e:{default:e}}function rn(e){"@babel/helpers - typeof";return rn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rn(e)}function rS(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function H0(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,nS(r.key),r)}}function sS(e,t,i){return t&&H0(e.prototype,t),i&&H0(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function nS(e){var t=oS(e,"string");return rn(t)=="symbol"?t:t+""}function oS(e,t){if(rn(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(rn(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var LD=Qo.default=function(){function e(){rS(this,e),this.strm=new tS.default,this.chunkSize=1024*10*10,this.outputBuffer=new Uint8Array(this.chunkSize),(0,cs.deflateInit)(this.strm,cs.Z_DEFAULT_COMPRESSION)}return sS(e,[{key:"deflate",value:function(i){this.strm.input=i,this.strm.avail_in=this.strm.input.length,this.strm.next_in=0,this.strm.output=this.outputBuffer,this.strm.avail_out=this.chunkSize,this.strm.next_out=0;var r=(0,cs.deflate)(this.strm,cs.Z_FULL_FLUSH),s=new Uint8Array(this.strm.output.buffer,0,this.strm.next_out);if(r<0)throw new Error("zlib deflate failed");if(this.strm.avail_in>0){var n=[s],o=s.length;do{if(this.strm.output=new Uint8Array(this.chunkSize),this.strm.next_out=0,this.strm.avail_out=this.chunkSize,r=(0,cs.deflate)(this.strm,cs.Z_FULL_FLUSH),r<0)throw new Error("zlib deflate failed");var a=new Uint8Array(this.strm.output.buffer,0,this.strm.next_out);o+=a.length,n.push(a)}while(this.strm.avail_in>0);for(var h=new Uint8Array(o),l=0,c=0;c<n.length;c++)h.set(n[c],l),l+=n[c].length;s=h}return this.strm.input=null,this.strm.avail_in=0,this.strm.next_in=0,s}}])}()});var us=ie(Ho=>{"use strict";Object.defineProperty(Ho,"__esModule",{value:!0});Ho.default=void 0;var ID=Ho.default={XK_VoidSymbol:16777215,XK_BackSpace:65288,XK_Tab:65289,XK_Linefeed:65290,XK_Clear:65291,XK_Return:65293,XK_Pause:65299,XK_Scroll_Lock:65300,XK_Sys_Req:65301,XK_Escape:65307,XK_Delete:65535,XK_Multi_key:65312,XK_Codeinput:65335,XK_SingleCandidate:65340,XK_MultipleCandidate:65341,XK_PreviousCandidate:65342,XK_Kanji:65313,XK_Muhenkan:65314,XK_Henkan_Mode:65315,XK_Henkan:65315,XK_Romaji:65316,XK_Hiragana:65317,XK_Katakana:65318,XK_Hiragana_Katakana:65319,XK_Zenkaku:65320,XK_Hankaku:65321,XK_Zenkaku_Hankaku:65322,XK_Touroku:65323,XK_Massyo:65324,XK_Kana_Lock:65325,XK_Kana_Shift:65326,XK_Eisu_Shift:65327,XK_Eisu_toggle:65328,XK_Kanji_Bangou:65335,XK_Zen_Koho:65341,XK_Mae_Koho:65342,XK_Home:65360,XK_Left:65361,XK_Up:65362,XK_Right:65363,XK_Down:65364,XK_Prior:65365,XK_Page_Up:65365,XK_Next:65366,XK_Page_Down:65366,XK_End:65367,XK_Begin:65368,XK_Select:65376,XK_Print:65377,XK_Execute:65378,XK_Insert:65379,XK_Undo:65381,XK_Redo:65382,XK_Menu:65383,XK_Find:65384,XK_Cancel:65385,XK_Help:65386,XK_Break:65387,XK_Mode_switch:65406,XK_script_switch:65406,XK_Num_Lock:65407,XK_KP_Space:65408,XK_KP_Tab:65417,XK_KP_Enter:65421,XK_KP_F1:65425,XK_KP_F2:65426,XK_KP_F3:65427,XK_KP_F4:65428,XK_KP_Home:65429,XK_KP_Left:65430,XK_KP_Up:65431,XK_KP_Right:65432,XK_KP_Down:65433,XK_KP_Prior:65434,XK_KP_Page_Up:65434,XK_KP_Next:65435,XK_KP_Page_Down:65435,XK_KP_End:65436,XK_KP_Begin:65437,XK_KP_Insert:65438,XK_KP_Delete:65439,XK_KP_Equal:65469,XK_KP_Multiply:65450,XK_KP_Add:65451,XK_KP_Separator:65452,XK_KP_Subtract:65453,XK_KP_Decimal:65454,XK_KP_Divide:65455,XK_KP_0:65456,XK_KP_1:65457,XK_KP_2:65458,XK_KP_3:65459,XK_KP_4:65460,XK_KP_5:65461,XK_KP_6:65462,XK_KP_7:65463,XK_KP_8:65464,XK_KP_9:65465,XK_F1:65470,XK_F2:65471,XK_F3:65472,XK_F4:65473,XK_F5:65474,XK_F6:65475,XK_F7:65476,XK_F8:65477,XK_F9:65478,XK_F10:65479,XK_F11:65480,XK_L1:65480,XK_F12:65481,XK_L2:65481,XK_F13:65482,XK_L3:65482,XK_F14:65483,XK_L4:65483,XK_F15:65484,XK_L5:65484,XK_F16:65485,XK_L6:65485,XK_F17:65486,XK_L7:65486,XK_F18:65487,XK_L8:65487,XK_F19:65488,XK_L9:65488,XK_F20:65489,XK_L10:65489,XK_F21:65490,XK_R1:65490,XK_F22:65491,XK_R2:65491,XK_F23:65492,XK_R3:65492,XK_F24:65493,XK_R4:65493,XK_F25:65494,XK_R5:65494,XK_F26:65495,XK_R6:65495,XK_F27:65496,XK_R7:65496,XK_F28:65497,XK_R8:65497,XK_F29:65498,XK_R9:65498,XK_F30:65499,XK_R10:65499,XK_F31:65500,XK_R11:65500,XK_F32:65501,XK_R12:65501,XK_F33:65502,XK_R13:65502,XK_F34:65503,XK_R14:65503,XK_F35:65504,XK_R15:65504,XK_Shift_L:65505,XK_Shift_R:65506,XK_Control_L:65507,XK_Control_R:65508,XK_Caps_Lock:65509,XK_Shift_Lock:65510,XK_Meta_L:65511,XK_Meta_R:65512,XK_Alt_L:65513,XK_Alt_R:65514,XK_Super_L:65515,XK_Super_R:65516,XK_Hyper_L:65517,XK_Hyper_R:65518,XK_ISO_Level3_Shift:65027,XK_ISO_Next_Group:65032,XK_ISO_Prev_Group:65034,XK_ISO_First_Group:65036,XK_ISO_Last_Group:65038,XK_space:32,XK_exclam:33,XK_quotedbl:34,XK_numbersign:35,XK_dollar:36,XK_percent:37,XK_ampersand:38,XK_apostrophe:39,XK_quoteright:39,XK_parenleft:40,XK_parenright:41,XK_asterisk:42,XK_plus:43,XK_comma:44,XK_minus:45,XK_period:46,XK_slash:47,XK_0:48,XK_1:49,XK_2:50,XK_3:51,XK_4:52,XK_5:53,XK_6:54,XK_7:55,XK_8:56,XK_9:57,XK_colon:58,XK_semicolon:59,XK_less:60,XK_equal:61,XK_greater:62,XK_question:63,XK_at:64,XK_A:65,XK_B:66,XK_C:67,XK_D:68,XK_E:69,XK_F:70,XK_G:71,XK_H:72,XK_I:73,XK_J:74,XK_K:75,XK_L:76,XK_M:77,XK_N:78,XK_O:79,XK_P:80,XK_Q:81,XK_R:82,XK_S:83,XK_T:84,XK_U:85,XK_V:86,XK_W:87,XK_X:88,XK_Y:89,XK_Z:90,XK_bracketleft:91,XK_backslash:92,XK_bracketright:93,XK_asciicircum:94,XK_underscore:95,XK_grave:96,XK_quoteleft:96,XK_a:97,XK_b:98,XK_c:99,XK_d:100,XK_e:101,XK_f:102,XK_g:103,XK_h:104,XK_i:105,XK_j:106,XK_k:107,XK_l:108,XK_m:109,XK_n:110,XK_o:111,XK_p:112,XK_q:113,XK_r:114,XK_s:115,XK_t:116,XK_u:117,XK_v:118,XK_w:119,XK_x:120,XK_y:121,XK_z:122,XK_braceleft:123,XK_bar:124,XK_braceright:125,XK_asciitilde:126,XK_nobreakspace:160,XK_exclamdown:161,XK_cent:162,XK_sterling:163,XK_currency:164,XK_yen:165,XK_brokenbar:166,XK_section:167,XK_diaeresis:168,XK_copyright:169,XK_ordfeminine:170,XK_guillemotleft:171,XK_notsign:172,XK_hyphen:173,XK_registered:174,XK_macron:175,XK_degree:176,XK_plusminus:177,XK_twosuperior:178,XK_threesuperior:179,XK_acute:180,XK_mu:181,XK_paragraph:182,XK_periodcentered:183,XK_cedilla:184,XK_onesuperior:185,XK_masculine:186,XK_guillemotright:187,XK_onequarter:188,XK_onehalf:189,XK_threequarters:190,XK_questiondown:191,XK_Agrave:192,XK_Aacute:193,XK_Acircumflex:194,XK_Atilde:195,XK_Adiaeresis:196,XK_Aring:197,XK_AE:198,XK_Ccedilla:199,XK_Egrave:200,XK_Eacute:201,XK_Ecircumflex:202,XK_Ediaeresis:203,XK_Igrave:204,XK_Iacute:205,XK_Icircumflex:206,XK_Idiaeresis:207,XK_ETH:208,XK_Eth:208,XK_Ntilde:209,XK_Ograve:210,XK_Oacute:211,XK_Ocircumflex:212,XK_Otilde:213,XK_Odiaeresis:214,XK_multiply:215,XK_Oslash:216,XK_Ooblique:216,XK_Ugrave:217,XK_Uacute:218,XK_Ucircumflex:219,XK_Udiaeresis:220,XK_Yacute:221,XK_THORN:222,XK_Thorn:222,XK_ssharp:223,XK_agrave:224,XK_aacute:225,XK_acircumflex:226,XK_atilde:227,XK_adiaeresis:228,XK_aring:229,XK_ae:230,XK_ccedilla:231,XK_egrave:232,XK_eacute:233,XK_ecircumflex:234,XK_ediaeresis:235,XK_igrave:236,XK_iacute:237,XK_icircumflex:238,XK_idiaeresis:239,XK_eth:240,XK_ntilde:241,XK_ograve:242,XK_oacute:243,XK_ocircumflex:244,XK_otilde:245,XK_odiaeresis:246,XK_division:247,XK_oslash:248,XK_ooblique:248,XK_ugrave:249,XK_uacute:250,XK_ucircumflex:251,XK_udiaeresis:252,XK_yacute:253,XK_thorn:254,XK_ydiaeresis:255,XK_Hangul:65329,XK_Hangul_Hanja:65332,XK_Hangul_Jeonja:65336,XF86XK_ModeLock:269025025,XF86XK_MonBrightnessUp:269025026,XF86XK_MonBrightnessDown:269025027,XF86XK_KbdLightOnOff:269025028,XF86XK_KbdBrightnessUp:269025029,XF86XK_KbdBrightnessDown:269025030,XF86XK_Standby:269025040,XF86XK_AudioLowerVolume:269025041,XF86XK_AudioMute:269025042,XF86XK_AudioRaiseVolume:269025043,XF86XK_AudioPlay:269025044,XF86XK_AudioStop:269025045,XF86XK_AudioPrev:269025046,XF86XK_AudioNext:269025047,XF86XK_HomePage:269025048,XF86XK_Mail:269025049,XF86XK_Start:269025050,XF86XK_Search:269025051,XF86XK_AudioRecord:269025052,XF86XK_Calculator:269025053,XF86XK_Memo:269025054,XF86XK_ToDoList:269025055,XF86XK_Calendar:269025056,XF86XK_PowerDown:269025057,XF86XK_ContrastAdjust:269025058,XF86XK_RockerUp:269025059,XF86XK_RockerDown:269025060,XF86XK_RockerEnter:269025061,XF86XK_Back:269025062,XF86XK_Forward:269025063,XF86XK_Stop:269025064,XF86XK_Refresh:269025065,XF86XK_PowerOff:269025066,XF86XK_WakeUp:269025067,XF86XK_Eject:269025068,XF86XK_ScreenSaver:269025069,XF86XK_WWW:269025070,XF86XK_Sleep:269025071,XF86XK_Favorites:269025072,XF86XK_AudioPause:269025073,XF86XK_AudioMedia:269025074,XF86XK_MyComputer:269025075,XF86XK_VendorHome:269025076,XF86XK_LightBulb:269025077,XF86XK_Shop:269025078,XF86XK_History:269025079,XF86XK_OpenURL:269025080,XF86XK_AddFavorite:269025081,XF86XK_HotLinks:269025082,XF86XK_BrightnessAdjust:269025083,XF86XK_Finance:269025084,XF86XK_Community:269025085,XF86XK_AudioRewind:269025086,XF86XK_BackForward:269025087,XF86XK_Launch0:269025088,XF86XK_Launch1:269025089,XF86XK_Launch2:269025090,XF86XK_Launch3:269025091,XF86XK_Launch4:269025092,XF86XK_Launch5:269025093,XF86XK_Launch6:269025094,XF86XK_Launch7:269025095,XF86XK_Launch8:269025096,XF86XK_Launch9:269025097,XF86XK_LaunchA:269025098,XF86XK_LaunchB:269025099,XF86XK_LaunchC:269025100,XF86XK_LaunchD:269025101,XF86XK_LaunchE:269025102,XF86XK_LaunchF:269025103,XF86XK_ApplicationLeft:269025104,XF86XK_ApplicationRight:269025105,XF86XK_Book:269025106,XF86XK_CD:269025107,XF86XK_Calculater:269025108,XF86XK_Clear:269025109,XF86XK_Close:269025110,XF86XK_Copy:269025111,XF86XK_Cut:269025112,XF86XK_Display:269025113,XF86XK_DOS:269025114,XF86XK_Documents:269025115,XF86XK_Excel:269025116,XF86XK_Explorer:269025117,XF86XK_Game:269025118,XF86XK_Go:269025119,XF86XK_iTouch:269025120,XF86XK_LogOff:269025121,XF86XK_Market:269025122,XF86XK_Meeting:269025123,XF86XK_MenuKB:269025125,XF86XK_MenuPB:269025126,XF86XK_MySites:269025127,XF86XK_New:269025128,XF86XK_News:269025129,XF86XK_OfficeHome:269025130,XF86XK_Open:269025131,XF86XK_Option:269025132,XF86XK_Paste:269025133,XF86XK_Phone:269025134,XF86XK_Q:269025136,XF86XK_Reply:269025138,XF86XK_Reload:269025139,XF86XK_RotateWindows:269025140,XF86XK_RotationPB:269025141,XF86XK_RotationKB:269025142,XF86XK_Save:269025143,XF86XK_ScrollUp:269025144,XF86XK_ScrollDown:269025145,XF86XK_ScrollClick:269025146,XF86XK_Send:269025147,XF86XK_Spell:269025148,XF86XK_SplitScreen:269025149,XF86XK_Support:269025150,XF86XK_TaskPane:269025151,XF86XK_Terminal:269025152,XF86XK_Tools:269025153,XF86XK_Travel:269025154,XF86XK_UserPB:269025156,XF86XK_User1KB:269025157,XF86XK_User2KB:269025158,XF86XK_Video:269025159,XF86XK_WheelButton:269025160,XF86XK_Word:269025161,XF86XK_Xfer:269025162,XF86XK_ZoomIn:269025163,XF86XK_ZoomOut:269025164,XF86XK_Away:269025165,XF86XK_Messenger:269025166,XF86XK_WebCam:269025167,XF86XK_MailForward:269025168,XF86XK_Pictures:269025169,XF86XK_Music:269025170,XF86XK_Battery:269025171,XF86XK_Bluetooth:269025172,XF86XK_WLAN:269025173,XF86XK_UWB:269025174,XF86XK_AudioForward:269025175,XF86XK_AudioRepeat:269025176,XF86XK_AudioRandomPlay:269025177,XF86XK_Subtitle:269025178,XF86XK_AudioCycleTrack:269025179,XF86XK_CycleAngle:269025180,XF86XK_FrameBack:269025181,XF86XK_FrameForward:269025182,XF86XK_Time:269025183,XF86XK_Select:269025184,XF86XK_View:269025185,XF86XK_TopMenu:269025186,XF86XK_Red:269025187,XF86XK_Green:269025188,XF86XK_Yellow:269025189,XF86XK_Blue:269025190,XF86XK_Suspend:269025191,XF86XK_Hibernate:269025192,XF86XK_TouchpadToggle:269025193,XF86XK_TouchpadOn:269025200,XF86XK_TouchpadOff:269025201,XF86XK_AudioMicMute:269025202,XF86XK_Switch_VT_1:269024769,XF86XK_Switch_VT_2:269024770,XF86XK_Switch_VT_3:269024771,XF86XK_Switch_VT_4:269024772,XF86XK_Switch_VT_5:269024773,XF86XK_Switch_VT_6:269024774,XF86XK_Switch_VT_7:269024775,XF86XK_Switch_VT_8:269024776,XF86XK_Switch_VT_9:269024777,XF86XK_Switch_VT_10:269024778,XF86XK_Switch_VT_11:269024779,XF86XK_Switch_VT_12:269024780,XF86XK_Ungrab:269024800,XF86XK_ClearGrab:269024801,XF86XK_Next_VMode:269024802,XF86XK_Prev_VMode:269024803,XF86XK_LogWindowTree:269024804,XF86XK_LogGrabInfo:269024805}});var uc=ie(Xo=>{"use strict";Object.defineProperty(Xo,"__esModule",{value:!0});Xo.default=void 0;var aS={256:960,257:992,258:451,259:483,260:417,261:433,262:454,263:486,264:710,265:742,266:709,267:741,268:456,269:488,270:463,271:495,272:464,273:496,274:938,275:954,278:972,279:1004,280:458,281:490,282:460,283:492,284:728,285:760,286:683,287:699,288:725,289:757,290:939,291:955,292:678,293:694,294:673,295:689,296:933,297:949,298:975,299:1007,302:967,303:999,304:681,305:697,308:684,309:700,310:979,311:1011,312:930,313:453,314:485,315:934,316:950,317:421,318:437,321:419,322:435,323:465,324:497,325:977,326:1009,327:466,328:498,330:957,331:959,332:978,333:1010,336:469,337:501,338:5052,339:5053,340:448,341:480,342:931,343:947,344:472,345:504,346:422,347:438,348:734,349:766,350:426,351:442,352:425,353:441,354:478,355:510,356:427,357:443,358:940,359:956,360:989,361:1021,362:990,363:1022,364:733,365:765,366:473,367:505,368:475,369:507,370:985,371:1017,376:5054,377:428,378:444,379:431,380:447,381:430,382:446,402:2294,466:16777681,711:439,728:418,729:511,731:434,733:445,901:1966,902:1953,904:1954,905:1955,906:1956,908:1959,910:1960,911:1963,912:1974,913:1985,914:1986,915:1987,916:1988,917:1989,918:1990,919:1991,920:1992,921:1993,922:1994,923:1995,924:1996,925:1997,926:1998,927:1999,928:2e3,929:2001,931:2002,932:2004,933:2005,934:2006,935:2007,936:2008,937:2009,938:1957,939:1961,940:1969,941:1970,942:1971,943:1972,944:1978,945:2017,946:2018,947:2019,948:2020,949:2021,950:2022,951:2023,952:2024,953:2025,954:2026,955:2027,956:2028,957:2029,958:2030,959:2031,960:2032,961:2033,962:2035,963:2034,964:2036,965:2037,966:2038,967:2039,968:2040,969:2041,970:1973,971:1977,972:1975,973:1976,974:1979,1025:1715,1026:1713,1027:1714,1028:1716,1029:1717,1030:1718,1031:1719,1032:1720,1033:1721,1034:1722,1035:1723,1036:1724,1038:1726,1039:1727,1040:1761,1041:1762,1042:1783,1043:1767,1044:1764,1045:1765,1046:1782,1047:1786,1048:1769,1049:1770,1050:1771,1051:1772,1052:1773,1053:1774,1054:1775,1055:1776,1056:1778,1057:1779,1058:1780,1059:1781,1060:1766,1061:1768,1062:1763,1063:1790,1064:1787,1065:1789,1066:1791,1067:1785,1068:1784,1069:1788,1070:1760,1071:1777,1072:1729,1073:1730,1074:1751,1075:1735,1076:1732,1077:1733,1078:1750,1079:1754,1080:1737,1081:1738,1082:1739,1083:1740,1084:1741,1085:1742,1086:1743,1087:1744,1088:1746,1089:1747,1090:1748,1091:1749,1092:1734,1093:1736,1094:1731,1095:1758,1096:1755,1097:1757,1098:1759,1099:1753,1100:1752,1101:1756,1102:1728,1103:1745,1105:1699,1106:1697,1107:1698,1108:1700,1109:1701,1110:1702,1111:1703,1112:1704,1113:1705,1114:1706,1115:1707,1116:1708,1118:1710,1119:1711,1168:1725,1169:1709,1488:3296,1489:3297,1490:3298,1491:3299,1492:3300,1493:3301,1494:3302,1495:3303,1496:3304,1497:3305,1498:3306,1499:3307,1500:3308,1501:3309,1502:3310,1503:3311,1504:3312,1505:3313,1506:3314,1507:3315,1508:3316,1509:3317,1510:3318,1511:3319,1512:3320,1513:3321,1514:3322,1548:1452,1563:1467,1567:1471,1569:1473,1570:1474,1571:1475,1572:1476,1573:1477,1574:1478,1575:1479,1576:1480,1577:1481,1578:1482,1579:1483,1580:1484,1581:1485,1582:1486,1583:1487,1584:1488,1585:1489,1586:1490,1587:1491,1588:1492,1589:1493,1590:1494,1591:1495,1592:1496,1593:1497,1594:1498,1600:1504,1601:1505,1602:1506,1603:1507,1604:1508,1605:1509,1606:1510,1607:1511,1608:1512,1609:1513,1610:1514,1611:1515,1612:1516,1613:1517,1614:1518,1615:1519,1616:1520,1617:1521,1618:1522,3585:3489,3586:3490,3587:3491,3588:3492,3589:3493,3590:3494,3591:3495,3592:3496,3593:3497,3594:3498,3595:3499,3596:3500,3597:3501,3598:3502,3599:3503,3600:3504,3601:3505,3602:3506,3603:3507,3604:3508,3605:3509,3606:3510,3607:3511,3608:3512,3609:3513,3610:3514,3611:3515,3612:3516,3613:3517,3614:3518,3615:3519,3616:3520,3617:3521,3618:3522,3619:3523,3620:3524,3621:3525,3622:3526,3623:3527,3624:3528,3625:3529,3626:3530,3627:3531,3628:3532,3629:3533,3630:3534,3631:3535,3632:3536,3633:3537,3634:3538,3635:3539,3636:3540,3637:3541,3638:3542,3639:3543,3640:3544,3641:3545,3642:3546,3647:3551,3648:3552,3649:3553,3650:3554,3651:3555,3652:3556,3653:3557,3654:3558,3655:3559,3656:3560,3657:3561,3658:3562,3659:3563,3660:3564,3661:3565,3664:3568,3665:3569,3666:3570,3667:3571,3668:3572,3669:3573,3670:3574,3671:3575,3672:3576,3673:3577,8194:2722,8195:2721,8196:2723,8197:2724,8199:2725,8200:2726,8201:2727,8202:2728,8210:2747,8211:2730,8212:2729,8213:1967,8215:3295,8216:2768,8217:2769,8218:2813,8220:2770,8221:2771,8222:2814,8224:2801,8225:2802,8226:2790,8229:2735,8230:2734,8240:2773,8242:2774,8243:2775,8248:2812,8254:1150,8361:3839,8364:8364,8453:2744,8470:1712,8471:2811,8478:2772,8482:2761,8531:2736,8532:2737,8533:2738,8534:2739,8535:2740,8536:2741,8537:2742,8538:2743,8539:2755,8540:2756,8541:2757,8542:2758,8592:2299,8593:2300,8594:2301,8595:2302,8658:2254,8660:2253,8706:2287,8711:2245,8728:3018,8730:2262,8733:2241,8734:2242,8743:2270,8744:2271,8745:2268,8746:2269,8747:2239,8756:2240,8764:2248,8771:2249,8773:16785992,8800:2237,8801:2255,8804:2236,8805:2238,8834:2266,8835:2267,8866:3068,8867:3036,8868:3010,8869:3022,8968:3027,8970:3012,8981:2810,8992:2212,8993:2213,9109:3020,9115:2219,9117:2220,9118:2221,9120:2222,9121:2215,9123:2216,9124:2217,9126:2218,9128:2223,9132:2224,9143:2209,9146:2543,9147:2544,9148:2546,9149:2547,9225:2530,9226:2533,9227:2537,9228:2531,9229:2532,9251:2732,9252:2536,9472:2211,9474:2214,9484:2210,9488:2539,9492:2541,9496:2538,9500:2548,9508:2549,9516:2551,9524:2550,9532:2542,9618:2529,9642:2791,9643:2785,9644:2779,9645:2786,9646:2783,9647:2767,9650:2792,9651:2787,9654:2781,9655:2765,9660:2793,9661:2788,9664:2780,9665:2764,9670:2528,9675:2766,9679:2782,9702:2784,9734:2789,9742:2809,9747:2762,9756:2794,9758:2795,9792:2808,9794:2807,9827:2796,9829:2798,9830:2797,9837:2806,9839:2805,10003:2803,10007:2804,10013:2777,10016:2800,10216:2748,10217:2750,12289:1188,12290:1185,12300:1186,12301:1187,12443:1246,12444:1247,12449:1191,12450:1201,12451:1192,12452:1202,12453:1193,12454:1203,12455:1194,12456:1204,12457:1195,12458:1205,12459:1206,12461:1207,12463:1208,12465:1209,12467:1210,12469:1211,12471:1212,12473:1213,12475:1214,12477:1215,12479:1216,12481:1217,12483:1199,12484:1218,12486:1219,12488:1220,12490:1221,12491:1222,12492:1223,12493:1224,12494:1225,12495:1226,12498:1227,12501:1228,12504:1229,12507:1230,12510:1231,12511:1232,12512:1233,12513:1234,12514:1235,12515:1196,12516:1236,12517:1197,12518:1237,12519:1198,12520:1238,12521:1239,12522:1240,12523:1241,12524:1242,12525:1243,12527:1244,12530:1190,12531:1245,12539:1189,12540:1200},TD=Xo.default={lookup:function(t){if(t>=32&&t<=255)return t;var i=aS[t];return i!==void 0?i:16777216|t}}});var U0=ie(Uo=>{"use strict";Object.defineProperty(Uo,"__esModule",{value:!0});Uo.default=void 0;var FD=Uo.default={8:"Backspace",9:"Tab",10:"NumpadClear",13:"Enter",16:"ShiftLeft",17:"ControlLeft",18:"AltLeft",19:"Pause",20:"CapsLock",21:"Lang1",25:"Lang2",27:"Escape",28:"Convert",29:"NonConvert",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",41:"Select",44:"PrintScreen",45:"Insert",46:"Delete",47:"Help",48:"Digit0",49:"Digit1",50:"Digit2",51:"Digit3",52:"Digit4",53:"Digit5",54:"Digit6",55:"Digit7",56:"Digit8",57:"Digit9",91:"MetaLeft",92:"MetaRight",93:"ContextMenu",95:"Sleep",96:"Numpad0",97:"Numpad1",98:"Numpad2",99:"Numpad3",100:"Numpad4",101:"Numpad5",102:"Numpad6",103:"Numpad7",104:"Numpad8",105:"Numpad9",106:"NumpadMultiply",107:"NumpadAdd",108:"NumpadDecimal",109:"NumpadSubtract",110:"NumpadDecimal",111:"NumpadDivide",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",124:"F13",125:"F14",126:"F15",127:"F16",128:"F17",129:"F18",130:"F19",131:"F20",132:"F21",133:"F22",134:"F23",135:"F24",144:"NumLock",145:"ScrollLock",166:"BrowserBack",167:"BrowserForward",168:"BrowserRefresh",169:"BrowserStop",170:"BrowserSearch",171:"BrowserFavorites",172:"BrowserHome",173:"AudioVolumeMute",174:"AudioVolumeDown",175:"AudioVolumeUp",176:"MediaTrackNext",177:"MediaTrackPrevious",178:"MediaStop",179:"MediaPlayPause",180:"LaunchMail",181:"MediaSelect",182:"LaunchApp1",183:"LaunchApp2",225:"AltRight"}});var z0=ie(zo=>{"use strict";Object.defineProperty(zo,"__esModule",{value:!0});zo.default=void 0;var OD=zo.default={Backspace:"Backspace",AltLeft:"Alt",AltRight:"Alt",CapsLock:"CapsLock",ContextMenu:"ContextMenu",ControlLeft:"Control",ControlRight:"Control",Enter:"Enter",MetaLeft:"Meta",MetaRight:"Meta",ShiftLeft:"Shift",ShiftRight:"Shift",Tab:"Tab",Delete:"Delete",End:"End",Help:"Help",Home:"Home",Insert:"Insert",PageDown:"PageDown",PageUp:"PageUp",ArrowDown:"ArrowDown",ArrowLeft:"ArrowLeft",ArrowRight:"ArrowRight",ArrowUp:"ArrowUp",NumLock:"NumLock",NumpadBackspace:"Backspace",NumpadClear:"Clear",Escape:"Escape",F1:"F1",F2:"F2",F3:"F3",F4:"F4",F5:"F5",F6:"F6",F7:"F7",F8:"F8",F9:"F9",F10:"F10",F11:"F11",F12:"F12",F13:"F13",F14:"F14",F15:"F15",F16:"F16",F17:"F17",F18:"F18",F19:"F19",F20:"F20",F21:"F21",F22:"F22",F23:"F23",F24:"F24",F25:"F25",F26:"F26",F27:"F27",F28:"F28",F29:"F29",F30:"F30",F31:"F31",F32:"F32",F33:"F33",F34:"F34",F35:"F35",PrintScreen:"PrintScreen",ScrollLock:"ScrollLock",Pause:"Pause",BrowserBack:"BrowserBack",BrowserFavorites:"BrowserFavorites",BrowserForward:"BrowserForward",BrowserHome:"BrowserHome",BrowserRefresh:"BrowserRefresh",BrowserSearch:"BrowserSearch",BrowserStop:"BrowserStop",Eject:"Eject",LaunchApp1:"LaunchMyComputer",LaunchApp2:"LaunchCalendar",LaunchMail:"LaunchMail",MediaPlayPause:"MediaPlay",MediaStop:"MediaStop",MediaTrackNext:"MediaTrackNext",MediaTrackPrevious:"MediaTrackPrevious",Power:"Power",Sleep:"Sleep",AudioVolumeDown:"AudioVolumeDown",AudioVolumeMute:"AudioVolumeMute",AudioVolumeUp:"AudioVolumeUp",WakeUp:"WakeUp"}});var W0=ie($o=>{"use strict";Object.defineProperty($o,"__esModule",{value:!0});$o.default=void 0;var T=lS(us());function lS(e){return e&&e.__esModule?e:{default:e}}var Kr={};function Q(e,t){if(t===void 0)throw new Error('Undefined keysym for key "'+e+'"');if(e in Kr)throw new Error('Duplicate entry for key "'+e+'"');Kr[e]=[t,t,t,t]}function Wo(e,t,i){if(t===void 0)throw new Error('Undefined keysym for key "'+e+'"');if(i===void 0)throw new Error('Undefined keysym for key "'+e+'"');if(e in Kr)throw new Error('Duplicate entry for key "'+e+'"');Kr[e]=[t,t,i,t]}function pe(e,t,i){if(t===void 0)throw new Error('Undefined keysym for key "'+e+'"');if(i===void 0)throw new Error('Undefined keysym for key "'+e+'"');if(e in Kr)throw new Error('Duplicate entry for key "'+e+'"');Kr[e]=[t,t,t,i]}Wo("Alt",T.default.XK_Alt_L,T.default.XK_Alt_R);Q("AltGraph",T.default.XK_ISO_Level3_Shift);Q("CapsLock",T.default.XK_Caps_Lock);Wo("Control",T.default.XK_Control_L,T.default.XK_Control_R);Wo("Meta",T.default.XK_Super_L,T.default.XK_Super_R);Q("NumLock",T.default.XK_Num_Lock);Q("ScrollLock",T.default.XK_Scroll_Lock);Wo("Shift",T.default.XK_Shift_L,T.default.XK_Shift_R);pe("Enter",T.default.XK_Return,T.default.XK_KP_Enter);Q("Tab",T.default.XK_Tab);pe(" ",T.default.XK_space,T.default.XK_KP_Space);pe("ArrowDown",T.default.XK_Down,T.default.XK_KP_Down);pe("ArrowLeft",T.default.XK_Left,T.default.XK_KP_Left);pe("ArrowRight",T.default.XK_Right,T.default.XK_KP_Right);pe("ArrowUp",T.default.XK_Up,T.default.XK_KP_Up);pe("End",T.default.XK_End,T.default.XK_KP_End);pe("Home",T.default.XK_Home,T.default.XK_KP_Home);pe("PageDown",T.default.XK_Next,T.default.XK_KP_Next);pe("PageUp",T.default.XK_Prior,T.default.XK_KP_Prior);Q("Backspace",T.default.XK_BackSpace);pe("Clear",T.default.XK_Clear,T.default.XK_KP_Begin);Q("Copy",T.default.XF86XK_Copy);Q("Cut",T.default.XF86XK_Cut);pe("Delete",T.default.XK_Delete,T.default.XK_KP_Delete);pe("Insert",T.default.XK_Insert,T.default.XK_KP_Insert);Q("Paste",T.default.XF86XK_Paste);Q("Redo",T.default.XK_Redo);Q("Undo",T.default.XK_Undo);Q("Cancel",T.default.XK_Cancel);Q("ContextMenu",T.default.XK_Menu);Q("Escape",T.default.XK_Escape);Q("Execute",T.default.XK_Execute);Q("Find",T.default.XK_Find);Q("Help",T.default.XK_Help);Q("Pause",T.default.XK_Pause);Q("Select",T.default.XK_Select);Q("ZoomIn",T.default.XF86XK_ZoomIn);Q("ZoomOut",T.default.XF86XK_ZoomOut);Q("BrightnessDown",T.default.XF86XK_MonBrightnessDown);Q("BrightnessUp",T.default.XF86XK_MonBrightnessUp);Q("Eject",T.default.XF86XK_Eject);Q("LogOff",T.default.XF86XK_LogOff);Q("Power",T.default.XF86XK_PowerOff);Q("PowerOff",T.default.XF86XK_PowerDown);Q("PrintScreen",T.default.XK_Print);Q("Hibernate",T.default.XF86XK_Hibernate);Q("Standby",T.default.XF86XK_Standby);Q("WakeUp",T.default.XF86XK_WakeUp);Q("AllCandidates",T.default.XK_MultipleCandidate);Q("Alphanumeric",T.default.XK_Eisu_toggle);Q("CodeInput",T.default.XK_Codeinput);Q("Compose",T.default.XK_Multi_key);Q("Convert",T.default.XK_Henkan);Q("GroupFirst",T.default.XK_ISO_First_Group);Q("GroupLast",T.default.XK_ISO_Last_Group);Q("GroupNext",T.default.XK_ISO_Next_Group);Q("GroupPrevious",T.default.XK_ISO_Prev_Group);Q("NonConvert",T.default.XK_Muhenkan);Q("PreviousCandidate",T.default.XK_PreviousCandidate);Q("SingleCandidate",T.default.XK_SingleCandidate);Q("HangulMode",T.default.XK_Hangul);Q("HanjaMode",T.default.XK_Hangul_Hanja);Q("JunjaMode",T.default.XK_Hangul_Jeonja);Q("Eisu",T.default.XK_Eisu_toggle);Q("Hankaku",T.default.XK_Hankaku);Q("Hiragana",T.default.XK_Hiragana);Q("HiraganaKatakana",T.default.XK_Hiragana_Katakana);Q("KanaMode",T.default.XK_Kana_Shift);Q("KanjiMode",T.default.XK_Kanji);Q("Katakana",T.default.XK_Katakana);Q("Romaji",T.default.XK_Romaji);Q("Zenkaku",T.default.XK_Zenkaku);Q("ZenkakuHankaku",T.default.XK_Zenkaku_Hankaku);Q("F1",T.default.XK_F1);Q("F2",T.default.XK_F2);Q("F3",T.default.XK_F3);Q("F4",T.default.XK_F4);Q("F5",T.default.XK_F5);Q("F6",T.default.XK_F6);Q("F7",T.default.XK_F7);Q("F8",T.default.XK_F8);Q("F9",T.default.XK_F9);Q("F10",T.default.XK_F10);Q("F11",T.default.XK_F11);Q("F12",T.default.XK_F12);Q("F13",T.default.XK_F13);Q("F14",T.default.XK_F14);Q("F15",T.default.XK_F15);Q("F16",T.default.XK_F16);Q("F17",T.default.XK_F17);Q("F18",T.default.XK_F18);Q("F19",T.default.XK_F19);Q("F20",T.default.XK_F20);Q("F21",T.default.XK_F21);Q("F22",T.default.XK_F22);Q("F23",T.default.XK_F23);Q("F24",T.default.XK_F24);Q("F25",T.default.XK_F25);Q("F26",T.default.XK_F26);Q("F27",T.default.XK_F27);Q("F28",T.default.XK_F28);Q("F29",T.default.XK_F29);Q("F30",T.default.XK_F30);Q("F31",T.default.XK_F31);Q("F32",T.default.XK_F32);Q("F33",T.default.XK_F33);Q("F34",T.default.XK_F34);Q("F35",T.default.XK_F35);Q("Close",T.default.XF86XK_Close);Q("MailForward",T.default.XF86XK_MailForward);Q("MailReply",T.default.XF86XK_Reply);Q("MailSend",T.default.XF86XK_Send);Q("MediaFastForward",T.default.XF86XK_AudioForward);Q("MediaPause",T.default.XF86XK_AudioPause);Q("MediaPlay",T.default.XF86XK_AudioPlay);Q("MediaRecord",T.default.XF86XK_AudioRecord);Q("MediaRewind",T.default.XF86XK_AudioRewind);Q("MediaStop",T.default.XF86XK_AudioStop);Q("MediaTrackNext",T.default.XF86XK_AudioNext);Q("MediaTrackPrevious",T.default.XF86XK_AudioPrev);Q("New",T.default.XF86XK_New);Q("Open",T.default.XF86XK_Open);Q("Print",T.default.XK_Print);Q("Save",T.default.XF86XK_Save);Q("SpellCheck",T.default.XF86XK_Spell);Q("AudioVolumeDown",T.default.XF86XK_AudioLowerVolume);Q("AudioVolumeUp",T.default.XF86XK_AudioRaiseVolume);Q("AudioVolumeMute",T.default.XF86XK_AudioMute);Q("MicrophoneVolumeMute",T.default.XF86XK_AudioMicMute);Q("LaunchApplication1",T.default.XF86XK_MyComputer);Q("LaunchApplication2",T.default.XF86XK_Calculator);Q("LaunchCalendar",T.default.XF86XK_Calendar);Q("LaunchMail",T.default.XF86XK_Mail);Q("LaunchMediaPlayer",T.default.XF86XK_AudioMedia);Q("LaunchMusicPlayer",T.default.XF86XK_Music);Q("LaunchPhone",T.default.XF86XK_Phone);Q("LaunchScreenSaver",T.default.XF86XK_ScreenSaver);Q("LaunchSpreadsheet",T.default.XF86XK_Excel);Q("LaunchWebBrowser",T.default.XF86XK_WWW);Q("LaunchWebCam",T.default.XF86XK_WebCam);Q("LaunchWordProcessor",T.default.XF86XK_Word);Q("BrowserBack",T.default.XF86XK_Back);Q("BrowserFavorites",T.default.XF86XK_Favorites);Q("BrowserForward",T.default.XF86XK_Forward);Q("BrowserHome",T.default.XF86XK_HomePage);Q("BrowserRefresh",T.default.XF86XK_Refresh);Q("BrowserSearch",T.default.XF86XK_Search);Q("BrowserStop",T.default.XF86XK_Stop);Q("Dimmer",T.default.XF86XK_BrightnessAdjust);Q("MediaAudioTrack",T.default.XF86XK_AudioCycleTrack);Q("RandomToggle",T.default.XF86XK_AudioRandomPlay);Q("SplitScreenToggle",T.default.XF86XK_SplitScreen);Q("Subtitle",T.default.XF86XK_Subtitle);Q("VideoModeNext",T.default.XF86XK_Next_VMode);pe("=",T.default.XK_equal,T.default.XK_KP_Equal);pe("+",T.default.XK_plus,T.default.XK_KP_Add);pe("-",T.default.XK_minus,T.default.XK_KP_Subtract);pe("*",T.default.XK_asterisk,T.default.XK_KP_Multiply);pe("/",T.default.XK_slash,T.default.XK_KP_Divide);pe(".",T.default.XK_period,T.default.XK_KP_Decimal);pe(",",T.default.XK_comma,T.default.XK_KP_Separator);pe("0",T.default.XK_0,T.default.XK_KP_0);pe("1",T.default.XK_1,T.default.XK_KP_1);pe("2",T.default.XK_2,T.default.XK_KP_2);pe("3",T.default.XK_3,T.default.XK_KP_3);pe("4",T.default.XK_4,T.default.XK_KP_4);pe("5",T.default.XK_5,T.default.XK_KP_5);pe("6",T.default.XK_6,T.default.XK_KP_6);pe("7",T.default.XK_7,T.default.XK_KP_7);pe("8",T.default.XK_8,T.default.XK_KP_8);pe("9",T.default.XK_9,T.default.XK_KP_9);var ND=$o.default=Kr});var J0=ie(an=>{"use strict";function dc(e){"@babel/helpers - typeof";return dc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dc(e)}Object.defineProperty(an,"__esModule",{value:!0});an.getKey=Y0;an.getKeycode=nn;an.getKeysym=uS;var sn=on(us()),hS=on(uc()),$0=on(U0()),G0=on(z0()),j0=on(W0()),q0=cS(Xs());function V0(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(V0=function(s){return s?i:t})(e)}function cS(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||dc(e)!="object"&&typeof e!="function")return{default:e};var i=V0(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&{}.hasOwnProperty.call(e,n)){var o=s?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}function on(e){return e&&e.__esModule?e:{default:e}}function nn(e){if(e.code){switch(e.code){case"OSLeft":return"MetaLeft";case"OSRight":return"MetaRight"}return e.code}if(e.keyCode in $0.default){var t=$0.default[e.keyCode];if(q0.isMac()&&t==="ContextMenu"&&(t="MetaRight"),e.location===2)switch(t){case"ShiftLeft":return"ShiftRight";case"ControlLeft":return"ControlRight";case"AltLeft":return"AltRight"}if(e.location===3)switch(t){case"Delete":return"NumpadDecimal";case"Insert":return"Numpad0";case"End":return"Numpad1";case"ArrowDown":return"Numpad2";case"PageDown":return"Numpad3";case"ArrowLeft":return"Numpad4";case"ArrowRight":return"Numpad6";case"Home":return"Numpad7";case"ArrowUp":return"Numpad8";case"PageUp":return"Numpad9";case"Enter":return"NumpadEnter"}return t}return"Unidentified"}function Y0(e){if(e.key!==void 0&&e.key!=="Unidentified"){switch(e.key){case"OS":return"Meta";case"LaunchMyComputer":return"LaunchApplication1";case"LaunchCalculator":return"LaunchApplication2"}switch(e.key){case"UIKeyInputUpArrow":return"ArrowUp";case"UIKeyInputDownArrow":return"ArrowDown";case"UIKeyInputLeftArrow":return"ArrowLeft";case"UIKeyInputRightArrow":return"ArrowRight";case"UIKeyInputEscape":return"Escape"}return e.key==="\0"&&e.code==="NumpadDecimal"?"Delete":e.key}var t=nn(e);return t in G0.default?G0.default[t]:e.charCode?String.fromCharCode(e.charCode):"Unidentified"}function uS(e){var t=Y0(e);if(t==="Unidentified")return null;if(t in j0.default){var i=e.location;if(t==="Meta"&&i===0&&(i=2),t==="Clear"&&i===3){var r=nn(e);r==="NumLock"&&(i=0)}if((i===void 0||i>3)&&(i=0),t==="Meta"){var s=nn(e);if(s==="AltLeft")return sn.default.XK_Meta_L;if(s==="AltRight")return sn.default.XK_Meta_R}if(t==="Clear"){var n=nn(e);if(n==="NumLock")return sn.default.XK_Num_Lock}if(q0.isWindows())switch(t){case"Zenkaku":case"Hankaku":return sn.default.XK_Zenkaku_Hankaku;case"Romaji":case"KanaMode":return sn.default.XK_Romaji}return j0.default[t][i]}if(t.length!==1)return null;var o=t.charCodeAt();return o?hS.default.lookup(o):null}});var ip=ie(Go=>{"use strict";Object.defineProperty(Go,"__esModule",{value:!0});Go.default=void 0;var fc=_c(Ci()),ds=Sh(),Z0=_c(J0()),Fe=dS(us()),Lt=_c(Xs());function dS(e){return e&&e.__esModule?e:{default:e}}function tp(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(tp=function(s){return s?i:t})(e)}function _c(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||fs(e)!="object"&&typeof e!="function")return{default:e};var i=tp(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&{}.hasOwnProperty.call(e,n)){var o=s?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}function fs(e){"@babel/helpers - typeof";return fs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fs(e)}function fS(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ep(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,pS(r.key),r)}}function _S(e,t,i){return t&&ep(e.prototype,t),i&&ep(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function pS(e){var t=gS(e,"string");return fs(t)=="symbol"?t:t+""}function gS(e,t){if(fs(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(fs(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var XD=Go.default=function(){function e(t){fS(this,e),this._target=t||null,this._keyDownList={},this._altGrArmed=!1,this._eventHandlers={keyup:this._handleKeyUp.bind(this),keydown:this._handleKeyDown.bind(this),blur:this._allKeysUp.bind(this)},this.onkeyevent=function(){}}return _S(e,[{key:"_sendKeyEvent",value:function(i,r,s){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(s)this._keyDownList[r]=i;else{if(!(r in this._keyDownList))return;delete this._keyDownList[r]}fc.Debug("onkeyevent "+(s?"down":"up")+", keysym: "+i,", code: "+r+", numlock: "+n+", capslock: "+o),this.onkeyevent(i,r,s,n,o)}},{key:"_getKeyCode",value:function(i){var r=Z0.getKeycode(i);if(r!=="Unidentified")return r;if(i.keyCode&&i.keyCode!==229)return"Platform"+i.keyCode;if(i.keyIdentifier){if(i.keyIdentifier.substr(0,2)!=="U+")return i.keyIdentifier;var s=parseInt(i.keyIdentifier.substr(2),16),n=String.fromCharCode(s).toUpperCase();return"Platform"+n.charCodeAt()}return"Unidentified"}},{key:"_handleKeyDown",value:function(i){var r=this._getKeyCode(i),s=Z0.getKeysym(i),n=i.getModifierState("NumLock"),o=i.getModifierState("CapsLock");if((Lt.isMac()||Lt.isIOS())&&(n=null),this._altGrArmed&&(this._altGrArmed=!1,clearTimeout(this._altGrTimeout),r==="AltRight"&&i.timeStamp-this._altGrCtrlTime<50?s=Fe.default.XK_ISO_Level3_Shift:this._sendKeyEvent(Fe.default.XK_Control_L,"ControlLeft",!0,n,o)),r==="Unidentified"){s&&(this._sendKeyEvent(s,r,!0,n,o),this._sendKeyEvent(s,r,!1,n,o)),(0,ds.stopEvent)(i);return}if(Lt.isMac()||Lt.isIOS())switch(s){case Fe.default.XK_Super_L:s=Fe.default.XK_Alt_L;break;case Fe.default.XK_Super_R:s=Fe.default.XK_Super_L;break;case Fe.default.XK_Alt_L:s=Fe.default.XK_Mode_switch;break;case Fe.default.XK_Alt_R:s=Fe.default.XK_ISO_Level3_Shift;break}if(r in this._keyDownList&&(s=this._keyDownList[r]),(Lt.isMac()||Lt.isIOS())&&i.metaKey&&r!=="MetaLeft"&&r!=="MetaRight"){this._sendKeyEvent(s,r,!0,n,o),this._sendKeyEvent(s,r,!1,n,o),(0,ds.stopEvent)(i);return}if((Lt.isMac()||Lt.isIOS())&&r==="CapsLock"){this._sendKeyEvent(Fe.default.XK_Caps_Lock,"CapsLock",!0,n,o),this._sendKeyEvent(Fe.default.XK_Caps_Lock,"CapsLock",!1,n,o),(0,ds.stopEvent)(i);return}var a=[Fe.default.XK_Zenkaku_Hankaku,Fe.default.XK_Eisu_toggle,Fe.default.XK_Katakana,Fe.default.XK_Hiragana,Fe.default.XK_Romaji];if(Lt.isWindows()&&a.includes(s)){this._sendKeyEvent(s,r,!0,n,o),this._sendKeyEvent(s,r,!1,n,o),(0,ds.stopEvent)(i);return}if((0,ds.stopEvent)(i),r==="ControlLeft"&&Lt.isWindows()&&!("ControlLeft"in this._keyDownList)){this._altGrArmed=!0,this._altGrTimeout=setTimeout(this._handleAltGrTimeout.bind(this),100),this._altGrCtrlTime=i.timeStamp;return}this._sendKeyEvent(s,r,!0,n,o)}},{key:"_handleKeyUp",value:function(i){(0,ds.stopEvent)(i);var r=this._getKeyCode(i);if(this._altGrArmed&&(this._altGrArmed=!1,clearTimeout(this._altGrTimeout),this._sendKeyEvent(Fe.default.XK_Control_L,"ControlLeft",!0)),(Lt.isMac()||Lt.isIOS())&&r==="CapsLock"){this._sendKeyEvent(Fe.default.XK_Caps_Lock,"CapsLock",!0),this._sendKeyEvent(Fe.default.XK_Caps_Lock,"CapsLock",!1);return}this._sendKeyEvent(this._keyDownList[r],r,!1),Lt.isWindows()&&(r==="ShiftLeft"||r==="ShiftRight")&&("ShiftRight"in this._keyDownList&&this._sendKeyEvent(this._keyDownList.ShiftRight,"ShiftRight",!1),"ShiftLeft"in this._keyDownList&&this._sendKeyEvent(this._keyDownList.ShiftLeft,"ShiftLeft",!1))}},{key:"_handleAltGrTimeout",value:function(){this._altGrArmed=!1,clearTimeout(this._altGrTimeout),this._sendKeyEvent(Fe.default.XK_Control_L,"ControlLeft",!0)}},{key:"_allKeysUp",value:function(){fc.Debug(">> Keyboard.allKeysUp");for(var i in this._keyDownList)this._sendKeyEvent(this._keyDownList[i],i,!1);fc.Debug("<< Keyboard.allKeysUp")}},{key:"grab",value:function(){this._target.addEventListener("keydown",this._eventHandlers.keydown),this._target.addEventListener("keyup",this._eventHandlers.keyup),window.addEventListener("blur",this._eventHandlers.blur)}},{key:"ungrab",value:function(){this._target.removeEventListener("keydown",this._eventHandlers.keydown),this._target.removeEventListener("keyup",this._eventHandlers.keyup),window.removeEventListener("blur",this._eventHandlers.blur),this._allKeysUp()}}])}()});var op=ie(qo=>{"use strict";Object.defineProperty(qo,"__esModule",{value:!0});qo.default=void 0;function dn(e){"@babel/helpers - typeof";return dn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dn(e)}function mS(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function rp(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,yS(r.key),r)}}function vS(e,t,i){return t&&rp(e.prototype,t),i&&rp(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function yS(e){var t=bS(e,"string");return dn(t)=="symbol"?t:t+""}function bS(e,t){if(dn(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(dn(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var hi=0,ln=1,hn=2,cn=4,jo=8,un=16,or=32,ar=64,pc=127,sp=50,wS=90,np=250,AS=1e3,xS=1e3,SS=50,zD=qo.default=function(){function e(){mS(this,e),this._target=null,this._state=pc,this._tracked=[],this._ignored=[],this._waitingRelease=!1,this._releaseStart=0,this._longpressTimeoutId=null,this._twoTouchTimeoutId=null,this._boundEventHandler=this._eventHandler.bind(this)}return vS(e,[{key:"attach",value:function(i){this.detach(),this._target=i,this._target.addEventListener("touchstart",this._boundEventHandler),this._target.addEventListener("touchmove",this._boundEventHandler),this._target.addEventListener("touchend",this._boundEventHandler),this._target.addEventListener("touchcancel",this._boundEventHandler)}},{key:"detach",value:function(){this._target&&(this._stopLongpressTimeout(),this._stopTwoTouchTimeout(),this._target.removeEventListener("touchstart",this._boundEventHandler),this._target.removeEventListener("touchmove",this._boundEventHandler),this._target.removeEventListener("touchend",this._boundEventHandler),this._target.removeEventListener("touchcancel",this._boundEventHandler),this._target=null)}},{key:"_eventHandler",value:function(i){var r;switch(i.stopPropagation(),i.preventDefault(),i.type){case"touchstart":r=this._touchStart;break;case"touchmove":r=this._touchMove;break;case"touchend":case"touchcancel":r=this._touchEnd;break}for(var s=0;s<i.changedTouches.length;s++){var n=i.changedTouches[s];r.call(this,n.identifier,n.clientX,n.clientY)}}},{key:"_touchStart",value:function(i,r,s){if(this._hasDetectedGesture()||this._state===hi){this._ignored.push(i);return}if(this._tracked.length>0&&Date.now()-this._tracked[0].started>np){this._state=hi,this._ignored.push(i);return}if(this._waitingRelease){this._state=hi,this._ignored.push(i);return}switch(this._tracked.push({id:i,started:Date.now(),active:!0,firstX:r,firstY:s,lastX:r,lastY:s,angle:0}),this._tracked.length){case 1:this._startLongpressTimeout();break;case 2:this._state&=~(ln|jo|un),this._stopLongpressTimeout();break;case 3:this._state&=~(hn|or|ar);break;default:this._state=hi}}},{key:"_touchMove",value:function(i,r,s){var n=this._tracked.find(function(u){return u.id===i});if(n!==void 0){n.lastX=r,n.lastY=s;var o=r-n.firstX,a=s-n.firstY;if((n.firstX!==n.lastX||n.firstY!==n.lastY)&&(n.angle=Math.atan2(a,o)*180/Math.PI),!this._hasDetectedGesture()){if(Math.hypot(o,a)<sp)return;if(this._state&=~(ln|hn|cn|un),this._stopLongpressTimeout(),this._tracked.length!==1&&(this._state&=~jo),this._tracked.length!==2&&(this._state&=~(or|ar)),this._tracked.length===2){var h=this._tracked.find(function(u){return u.id!==i}),l=Math.hypot(h.firstX-h.lastX,h.firstY-h.lastY);if(l>sp){var c=Math.abs(n.angle-h.angle);c=Math.abs((c+180)%360-180),c>wS?this._state&=~or:this._state&=~ar,this._isTwoTouchTimeoutRunning()&&this._stopTwoTouchTimeout()}else this._isTwoTouchTimeoutRunning()||this._startTwoTouchTimeout()}if(!this._hasDetectedGesture())return;this._pushEvent("gesturestart")}this._pushEvent("gesturemove")}}},{key:"_touchEnd",value:function(i,r,s){if(this._ignored.indexOf(i)!==-1){this._ignored.splice(this._ignored.indexOf(i),1),this._ignored.length===0&&this._tracked.length===0&&(this._state=pc,this._waitingRelease=!1);return}if(!this._hasDetectedGesture()&&this._isTwoTouchTimeoutRunning()&&(this._stopTwoTouchTimeout(),this._state=hi),!this._hasDetectedGesture()&&(this._state&=~(jo|or|ar),this._state&=~un,this._stopLongpressTimeout(),!this._waitingRelease))switch(this._releaseStart=Date.now(),this._waitingRelease=!0,this._tracked.length){case 1:this._state&=~(hn|cn);break;case 2:this._state&=~(ln|cn);break}if(this._waitingRelease){Date.now()-this._releaseStart>np&&(this._state=hi),this._tracked.some(function(a){return Date.now()-a.started>AS})&&(this._state=hi);var n=this._tracked.find(function(a){return a.id===i});if(n.active=!1,this._hasDetectedGesture())this._pushEvent("gesturestart");else if(this._state!==hi)return}this._hasDetectedGesture()&&this._pushEvent("gestureend");for(var o=0;o<this._tracked.length;o++)this._tracked[o].active&&this._ignored.push(this._tracked[o].id);this._tracked=[],this._state=hi,this._ignored.indexOf(i)!==-1&&this._ignored.splice(this._ignored.indexOf(i),1),this._ignored.length===0&&(this._state=pc,this._waitingRelease=!1)}},{key:"_hasDetectedGesture",value:function(){return!(this._state===hi||this._state&this._state-1||this._state&(ln|hn|cn)&&this._tracked.some(function(i){return i.active}))}},{key:"_startLongpressTimeout",value:function(){var i=this;this._stopLongpressTimeout(),this._longpressTimeoutId=setTimeout(function(){return i._longpressTimeout()},xS)}},{key:"_stopLongpressTimeout",value:function(){clearTimeout(this._longpressTimeoutId),this._longpressTimeoutId=null}},{key:"_longpressTimeout",value:function(){if(this._hasDetectedGesture())throw new Error("A longpress gesture failed, conflict with a different gesture");this._state=un,this._pushEvent("gesturestart")}},{key:"_startTwoTouchTimeout",value:function(){var i=this;this._stopTwoTouchTimeout(),this._twoTouchTimeoutId=setTimeout(function(){return i._twoTouchTimeout()},SS)}},{key:"_stopTwoTouchTimeout",value:function(){clearTimeout(this._twoTouchTimeoutId),this._twoTouchTimeoutId=null}},{key:"_isTwoTouchTimeoutRunning",value:function(){return this._twoTouchTimeoutId!==null}},{key:"_twoTouchTimeout",value:function(){if(this._tracked.length===0)throw new Error("A pinch or two drag gesture failed, no tracked touches");var i=this._getAverageMovement(),r=Math.abs(i.x),s=Math.abs(i.y),n=this._getAverageDistance(),o=Math.abs(Math.hypot(n.first.x,n.first.y)-Math.hypot(n.last.x,n.last.y));s<o&&r<o?this._state=ar:this._state=or,this._pushEvent("gesturestart"),this._pushEvent("gesturemove")}},{key:"_pushEvent",value:function(i){var r={type:this._stateToGesture(this._state)},s=this._getPosition(),n=s.last;switch(i==="gesturestart"&&(n=s.first),this._state){case or:case ar:n=s.first;break}if(r.clientX=n.x,r.clientY=n.y,this._state===ar){var o=this._getAverageDistance();i==="gesturestart"?(r.magnitudeX=o.first.x,r.magnitudeY=o.first.y):(r.magnitudeX=o.last.x,r.magnitudeY=o.last.y)}else if(this._state===or)if(i==="gesturestart")r.magnitudeX=0,r.magnitudeY=0;else{var a=this._getAverageMovement();r.magnitudeX=a.x,r.magnitudeY=a.y}var h=new CustomEvent(i,{detail:r});this._target.dispatchEvent(h)}},{key:"_stateToGesture",value:function(i){switch(i){case ln:return"onetap";case hn:return"twotap";case cn:return"threetap";case jo:return"drag";case un:return"longpress";case or:return"twodrag";case ar:return"pinch"}throw new Error("Unknown gesture state: "+i)}},{key:"_getPosition",value:function(){if(this._tracked.length===0)throw new Error("Failed to get gesture position, no tracked touches");for(var i=this._tracked.length,r=0,s=0,n=0,o=0,a=0;a<this._tracked.length;a++)r+=this._tracked[a].firstX,s+=this._tracked[a].firstY,n+=this._tracked[a].lastX,o+=this._tracked[a].lastY;return{first:{x:r/i,y:s/i},last:{x:n/i,y:o/i}}}},{key:"_getAverageMovement",value:function(){if(this._tracked.length===0)throw new Error("Failed to get gesture movement, no tracked touches");var i,r;i=r=0;for(var s=this._tracked.length,n=0;n<this._tracked.length;n++)i+=this._tracked[n].lastX-this._tracked[n].firstX,r+=this._tracked[n].lastY-this._tracked[n].firstY;return{x:i/s,y:r/s}}},{key:"_getAverageDistance",value:function(){if(this._tracked.length===0)throw new Error("Failed to get gesture distance, no tracked touches");var i=this._tracked[0],r=this._tracked[this._tracked.length-1],s=Math.abs(r.firstX-i.firstX),n=Math.abs(r.firstY-i.firstY),o=Math.abs(r.lastX-i.lastX),a=Math.abs(r.lastY-i.lastY);return{first:{x:s,y:n},last:{x:o,y:a}}}}])}()});var hp=ie(Vo=>{"use strict";Object.defineProperty(Vo,"__esModule",{value:!0});Vo.default=void 0;var ap=Xs();function _n(e){"@babel/helpers - typeof";return _n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_n(e)}function CS(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function lp(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ES(r.key),r)}}function kS(e,t,i){return t&&lp(e.prototype,t),i&&lp(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function ES(e){var t=BS(e,"string");return _n(t)=="symbol"?t:t+""}function BS(e,t){if(_n(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(_n(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var fn=!ap.supportsCursorURIs||ap.isTouchDevice,$D=Vo.default=function(){function e(){CS(this,e),this._target=null,this._canvas=document.createElement("canvas"),fn&&(this._canvas.style.position="fixed",this._canvas.style.zIndex="65535",this._canvas.style.pointerEvents="none",this._canvas.style.userSelect="none",this._canvas.style.WebkitUserSelect="none",this._canvas.style.visibility="hidden"),this._position={x:0,y:0},this._hotSpot={x:0,y:0},this._eventHandlers={mouseover:this._handleMouseOver.bind(this),mouseleave:this._handleMouseLeave.bind(this),mousemove:this._handleMouseMove.bind(this),mouseup:this._handleMouseUp.bind(this)}}return kS(e,[{key:"attach",value:function(i){if(this._target&&this.detach(),this._target=i,fn){document.body.appendChild(this._canvas);var r={capture:!0,passive:!0};this._target.addEventListener("mouseover",this._eventHandlers.mouseover,r),this._target.addEventListener("mouseleave",this._eventHandlers.mouseleave,r),this._target.addEventListener("mousemove",this._eventHandlers.mousemove,r),this._target.addEventListener("mouseup",this._eventHandlers.mouseup,r)}this.clear()}},{key:"detach",value:function(){if(this._target){if(fn){var i={capture:!0,passive:!0};this._target.removeEventListener("mouseover",this._eventHandlers.mouseover,i),this._target.removeEventListener("mouseleave",this._eventHandlers.mouseleave,i),this._target.removeEventListener("mousemove",this._eventHandlers.mousemove,i),this._target.removeEventListener("mouseup",this._eventHandlers.mouseup,i),document.contains(this._canvas)&&document.body.removeChild(this._canvas)}this._target=null}}},{key:"change",value:function(i,r,s,n,o){if(n===0||o===0){this.clear();return}this._position.x=this._position.x+this._hotSpot.x-r,this._position.y=this._position.y+this._hotSpot.y-s,this._hotSpot.x=r,this._hotSpot.y=s;var a=this._canvas.getContext("2d");this._canvas.width=n,this._canvas.height=o;var h=new ImageData(new Uint8ClampedArray(i),n,o);if(a.clearRect(0,0,n,o),a.putImageData(h,0,0),fn)this._updatePosition();else{var l=this._canvas.toDataURL();this._target.style.cursor="url("+l+")"+r+" "+s+", default"}}},{key:"clear",value:function(){this._target.style.cursor="none",this._canvas.width=0,this._canvas.height=0,this._position.x=this._position.x+this._hotSpot.x,this._position.y=this._position.y+this._hotSpot.y,this._hotSpot.x=0,this._hotSpot.y=0}},{key:"move",value:function(i,r){if(fn){window.visualViewport?(this._position.x=i+window.visualViewport.offsetLeft,this._position.y=r+window.visualViewport.offsetTop):(this._position.x=i,this._position.y=r),this._updatePosition();var s=document.elementFromPoint(i,r);this._updateVisibility(s)}}},{key:"_handleMouseOver",value:function(i){this._handleMouseMove(i)}},{key:"_handleMouseLeave",value:function(i){this._updateVisibility(i.relatedTarget)}},{key:"_handleMouseMove",value:function(i){this._updateVisibility(i.target),this._position.x=i.clientX-this._hotSpot.x,this._position.y=i.clientY-this._hotSpot.y,this._updatePosition()}},{key:"_handleMouseUp",value:function(i){var r=this,s=document.elementFromPoint(i.clientX,i.clientY);this._updateVisibility(s),this._captureIsActive()&&window.setTimeout(function(){r._target&&(s=document.elementFromPoint(i.clientX,i.clientY),r._updateVisibility(s))},0)}},{key:"_showCursor",value:function(){this._canvas.style.visibility==="hidden"&&(this._canvas.style.visibility="")}},{key:"_hideCursor",value:function(){this._canvas.style.visibility!=="hidden"&&(this._canvas.style.visibility="hidden")}},{key:"_shouldShowCursor",value:function(i){return i?i===this._target?!0:!(!this._target.contains(i)||window.getComputedStyle(i).cursor!=="none"):!1}},{key:"_updateVisibility",value:function(i){this._captureIsActive()&&(i=document.captureElement),this._shouldShowCursor(i)?this._showCursor():this._hideCursor()}},{key:"_updatePosition",value:function(){this._canvas.style.left=this._position.x+"px",this._canvas.style.top=this._position.y+"px"}},{key:"_captureIsActive",value:function(){return document.captureElement&&document.documentElement.contains(document.captureElement)}}])}()});var _p=ie(Zo=>{"use strict";Object.defineProperty(Zo,"__esModule",{value:!0});Zo.default=void 0;var Bi=LS(Ci());function fp(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(fp=function(s){return s?i:t})(e)}function LS(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||_s(e)!="object"&&typeof e!="function")return{default:e};var i=fp(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&{}.hasOwnProperty.call(e,n)){var o=s?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}function _s(e){"@babel/helpers - typeof";return _s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_s(e)}function cp(e){return TS(e)||MS(e)||IS(e)||DS()}function DS(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function IS(e,t){if(e){if(typeof e=="string")return mc(e,t);var i={}.toString.call(e).slice(8,-1);return i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set"?Array.from(e):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?mc(e,t):void 0}}function MS(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function TS(e){if(Array.isArray(e))return mc(e)}function mc(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,r=Array(t);i<t;i++)r[i]=e[i];return r}function RS(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function up(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,PS(r.key),r)}}function FS(e,t,i){return t&&up(e.prototype,t),i&&up(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function PS(e){var t=OS(e,"string");return _s(t)=="symbol"?t:t+""}function OS(e,t){if(_s(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(_s(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var gc=40*1024*1024,Yo={CONNECTING:"connecting",OPEN:"open",CLOSING:"closing",CLOSED:"closed"},Jo={CONNECTING:[WebSocket.CONNECTING,Yo.CONNECTING],OPEN:[WebSocket.OPEN,Yo.OPEN],CLOSING:[WebSocket.CLOSING,Yo.CLOSING],CLOSED:[WebSocket.CLOSED,Yo.CLOSED]},dp=["send","close","binaryType","onerror","onmessage","onopen","protocol","readyState"],jD=Zo.default=function(){function e(){RS(this,e),this._websocket=null,this._rQi=0,this._rQlen=0,this._rQbufferSize=1024*1024*4,this._rQ=null,this._sQbufferSize=1024*10,this._sQlen=0,this._sQ=null,this._eventHandlers={message:function(){},open:function(){},close:function(){},error:function(){}}}return FS(e,[{key:"readyState",get:function(){var i;return this._websocket===null?"unused":(i=this._websocket.readyState,Jo.CONNECTING.includes(i)?"connecting":Jo.OPEN.includes(i)?"open":Jo.CLOSING.includes(i)?"closing":Jo.CLOSED.includes(i)?"closed":"unknown")}},{key:"rQpeek8",value:function(){return this._rQ[this._rQi]}},{key:"rQskipBytes",value:function(i){this._rQi+=i}},{key:"rQshift8",value:function(){return this._rQshift(1)}},{key:"rQshift16",value:function(){return this._rQshift(2)}},{key:"rQshift32",value:function(){return this._rQshift(4)}},{key:"_rQshift",value:function(i){for(var r=0,s=i-1;s>=0;s--)r+=this._rQ[this._rQi++]<<s*8;return r>>>0}},{key:"rQshiftStr",value:function(i){for(var r="",s=0;s<i;s+=4096){var n=this.rQshiftBytes(Math.min(4096,i-s),!1);r+=String.fromCharCode.apply(null,n)}return r}},{key:"rQshiftBytes",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return this._rQi+=i,r?this._rQ.slice(this._rQi-i,this._rQi):this._rQ.subarray(this._rQi-i,this._rQi)}},{key:"rQshiftTo",value:function(i,r){i.set(new Uint8Array(this._rQ.buffer,this._rQi,r)),this._rQi+=r}},{key:"rQpeekBytes",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return r?this._rQ.slice(this._rQi,this._rQi+i):this._rQ.subarray(this._rQi,this._rQi+i)}},{key:"rQwait",value:function(i,r,s){if(this._rQlen-this._rQi<r){if(s){if(this._rQi<s)throw new Error("rQwait cannot backup "+s+" bytes");this._rQi-=s}return!0}return!1}},{key:"sQpush8",value:function(i){this._sQensureSpace(1),this._sQ[this._sQlen++]=i}},{key:"sQpush16",value:function(i){this._sQensureSpace(2),this._sQ[this._sQlen++]=i>>8&255,this._sQ[this._sQlen++]=i>>0&255}},{key:"sQpush32",value:function(i){this._sQensureSpace(4),this._sQ[this._sQlen++]=i>>24&255,this._sQ[this._sQlen++]=i>>16&255,this._sQ[this._sQlen++]=i>>8&255,this._sQ[this._sQlen++]=i>>0&255}},{key:"sQpushString",value:function(i){var r=i.split("").map(function(s){return s.charCodeAt(0)});this.sQpushBytes(new Uint8Array(r))}},{key:"sQpushBytes",value:function(i){for(var r=0;r<i.length;){this._sQensureSpace(1);var s=this._sQbufferSize-this._sQlen;s>i.length-r&&(s=i.length-r),this._sQ.set(i.subarray(r,s),this._sQlen),this._sQlen+=s,r+=s}}},{key:"flush",value:function(){this._sQlen>0&&this.readyState==="open"&&(this._websocket.send(new Uint8Array(this._sQ.buffer,0,this._sQlen)),this._sQlen=0)}},{key:"_sQensureSpace",value:function(i){this._sQbufferSize-this._sQlen<i&&this.flush()}},{key:"off",value:function(i){this._eventHandlers[i]=function(){}}},{key:"on",value:function(i,r){this._eventHandlers[i]=r}},{key:"_allocateBuffers",value:function(){this._rQ=new Uint8Array(this._rQbufferSize),this._sQ=new Uint8Array(this._sQbufferSize)}},{key:"init",value:function(){this._allocateBuffers(),this._rQi=0,this._websocket=null}},{key:"open",value:function(i,r){this.attach(new WebSocket(i,r))}},{key:"attach",value:function(i){var r=this;this.init();for(var s=[].concat(cp(Object.keys(i)),cp(Object.getOwnPropertyNames(Object.getPrototypeOf(i)))),n=0;n<dp.length;n++){var o=dp[n];if(s.indexOf(o)<0)throw new Error("Raw channel missing property: "+o)}this._websocket=i,this._websocket.binaryType="arraybuffer",this._websocket.onmessage=this._recvMessage.bind(this),this._websocket.onopen=function(){Bi.Debug(">> WebSock.onopen"),r._websocket.protocol&&Bi.Info("Server choose sub-protocol: "+r._websocket.protocol),r._eventHandlers.open(),Bi.Debug("<< WebSock.onopen")},this._websocket.onclose=function(a){Bi.Debug(">> WebSock.onclose"),r._eventHandlers.close(a),Bi.Debug("<< WebSock.onclose")},this._websocket.onerror=function(a){Bi.Debug(">> WebSock.onerror: "+a),r._eventHandlers.error(a),Bi.Debug("<< WebSock.onerror: "+a)}}},{key:"close",value:function(){this._websocket&&((this.readyState==="connecting"||this.readyState==="open")&&(Bi.Info("Closing WebSocket connection"),this._websocket.close()),this._websocket.onmessage=function(){})}},{key:"_expandCompactRQ",value:function(i){var r=(this._rQlen-this._rQi+i)*8,s=this._rQbufferSize<r;if(s&&(this._rQbufferSize=Math.max(this._rQbufferSize*2,r)),this._rQbufferSize>gc&&(this._rQbufferSize=gc,this._rQbufferSize-(this._rQlen-this._rQi)<i))throw new Error("Receive Queue buffer exceeded "+gc+" bytes, and the new message could not fit");if(s){var n=this._rQ.buffer;this._rQ=new Uint8Array(this._rQbufferSize),this._rQ.set(new Uint8Array(n,this._rQi,this._rQlen-this._rQi))}else this._rQ.copyWithin(0,this._rQi,this._rQlen);this._rQlen=this._rQlen-this._rQi,this._rQi=0}},{key:"_recvMessage",value:function(i){this._rQlen==this._rQi&&(this._rQlen=0,this._rQi=0);var r=new Uint8Array(i.data);r.length>this._rQbufferSize-this._rQlen&&this._expandCompactRQ(r.length),this._rQ.set(r,this._rQlen),this._rQlen+=r.length,this._rQlen-this._rQi>0?this._eventHandlers.message():Bi.Debug("Ignoring empty message")}}])}()});var pp=ie(ea=>{"use strict";Object.defineProperty(ea,"__esModule",{value:!0});ea.default=void 0;var VD=ea.default={Again:57349,AltLeft:56,AltRight:57400,ArrowDown:57424,ArrowLeft:57419,ArrowRight:57421,ArrowUp:57416,AudioVolumeDown:57390,AudioVolumeMute:57376,AudioVolumeUp:57392,Backquote:41,Backslash:43,Backspace:14,BracketLeft:26,BracketRight:27,BrowserBack:57450,BrowserFavorites:57446,BrowserForward:57449,BrowserHome:57394,BrowserRefresh:57447,BrowserSearch:57445,BrowserStop:57448,CapsLock:58,Comma:51,ContextMenu:57437,ControlLeft:29,ControlRight:57373,Convert:121,Copy:57464,Cut:57404,Delete:57427,Digit0:11,Digit1:2,Digit2:3,Digit3:4,Digit4:5,Digit5:6,Digit6:7,Digit7:8,Digit8:9,Digit9:10,Eject:57469,End:57423,Enter:28,Equal:13,Escape:1,F1:59,F10:68,F11:87,F12:88,F13:93,F14:94,F15:95,F16:85,F17:57347,F18:57463,F19:57348,F2:60,F20:90,F21:116,F22:57465,F23:109,F24:111,F3:61,F4:62,F5:63,F6:64,F7:65,F8:66,F9:67,Find:57409,Help:57461,Hiragana:119,Home:57415,Insert:57426,IntlBackslash:86,IntlRo:115,IntlYen:125,KanaMode:112,Katakana:120,KeyA:30,KeyB:48,KeyC:46,KeyD:32,KeyE:18,KeyF:33,KeyG:34,KeyH:35,KeyI:23,KeyJ:36,KeyK:37,KeyL:38,KeyM:50,KeyN:49,KeyO:24,KeyP:25,KeyQ:16,KeyR:19,KeyS:31,KeyT:20,KeyU:22,KeyV:47,KeyW:17,KeyX:45,KeyY:21,KeyZ:44,Lang1:114,Lang2:113,Lang3:120,Lang4:119,Lang5:118,LaunchApp1:57451,LaunchApp2:57377,LaunchMail:57452,MediaPlayPause:57378,MediaSelect:57453,MediaStop:57380,MediaTrackNext:57369,MediaTrackPrevious:57360,MetaLeft:57435,MetaRight:57436,Minus:12,NonConvert:123,NumLock:69,Numpad0:82,Numpad1:79,Numpad2:80,Numpad3:81,Numpad4:75,Numpad5:76,Numpad6:77,Numpad7:71,Numpad8:72,Numpad9:73,NumpadAdd:78,NumpadComma:126,NumpadDecimal:83,NumpadDivide:57397,NumpadEnter:57372,NumpadEqual:89,NumpadMultiply:55,NumpadParenLeft:57462,NumpadParenRight:57467,NumpadSubtract:74,Open:100,PageDown:57425,PageUp:57417,Paste:101,Pause:57414,Period:52,Power:57438,PrintScreen:84,Props:57350,Quote:40,ScrollLock:70,Semicolon:39,ShiftLeft:42,ShiftRight:54,Slash:53,Sleep:57439,Space:57,Suspend:57381,Tab:15,Undo:57351,WakeUp:57443}});var gp=ie(pn=>{"use strict";Object.defineProperty(pn,"__esModule",{value:!0});pn.encodingName=KS;pn.encodings=void 0;var lr=pn.encodings={encodingRaw:0,encodingCopyRect:1,encodingRRE:2,encodingHextile:5,encodingTight:7,encodingZRLE:16,encodingTightPNG:-260,encodingJPEG:21,pseudoEncodingQualityLevel9:-23,pseudoEncodingQualityLevel0:-32,pseudoEncodingDesktopSize:-223,pseudoEncodingLastRect:-224,pseudoEncodingCursor:-239,pseudoEncodingQEMUExtendedKeyEvent:-258,pseudoEncodingQEMULedEvent:-261,pseudoEncodingDesktopName:-307,pseudoEncodingExtendedDesktopSize:-308,pseudoEncodingXvp:-309,pseudoEncodingFence:-312,pseudoEncodingContinuousUpdates:-313,pseudoEncodingCompressLevel9:-247,pseudoEncodingCompressLevel0:-256,pseudoEncodingVMwareCursor:1464686180,pseudoEncodingExtendedClipboard:3231835598};function KS(e){switch(e){case lr.encodingRaw:return"Raw";case lr.encodingCopyRect:return"CopyRect";case lr.encodingRRE:return"RRE";case lr.encodingHextile:return"Hextile";case lr.encodingTight:return"Tight";case lr.encodingZRLE:return"ZRLE";case lr.encodingTightPNG:return"TightPNG";case lr.encodingJPEG:return"JPEG";default:return"[unknown encoding "+e+"]"}}});var wp=ie(ps=>{"use strict";Object.defineProperty(ps,"__esModule",{value:!0});ps.AESECBCipher=ps.AESEAXCipher=void 0;function Nr(e){"@babel/helpers - typeof";return Nr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Nr(e)}function be(){"use strict";be=function(){return t};var e,t={},i=Object.prototype,r=i.hasOwnProperty,s=Object.defineProperty||function(f,d,p){f[d]=p.value},n=typeof Symbol=="function"?Symbol:{},o=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",h=n.toStringTag||"@@toStringTag";function l(f,d,p){return Object.defineProperty(f,d,{value:p,enumerable:!0,configurable:!0,writable:!0}),f[d]}try{l({},"")}catch{l=function(p,y,A){return p[y]=A}}function c(f,d,p,y){var A=d&&d.prototype instanceof E?d:E,S=Object.create(A.prototype),F=new w(y||[]);return s(S,"_invoke",{value:V(f,p,F)}),S}function u(f,d,p){try{return{type:"normal",arg:f.call(d,p)}}catch(y){return{type:"throw",arg:y}}}t.wrap=c;var g="suspendedStart",_="suspendedYield",m="executing",v="completed",x={};function E(){}function M(){}function D(){}var b={};l(b,o,function(){return this});var L=Object.getPrototypeOf,I=L&&L(L(k([])));I&&I!==i&&r.call(I,o)&&(b=I);var R=D.prototype=E.prototype=Object.create(b);function G(f){["next","throw","return"].forEach(function(d){l(f,d,function(p){return this._invoke(d,p)})})}function W(f,d){function p(A,S,F,U){var $=u(f[A],f,S);if($.type!=="throw"){var z=$.arg,J=z.value;return J&&Nr(J)=="object"&&r.call(J,"__await")?d.resolve(J.__await).then(function(ee){p("next",ee,F,U)},function(ee){p("throw",ee,F,U)}):d.resolve(J).then(function(ee){z.value=ee,F(z)},function(ee){return p("throw",ee,F,U)})}U($.arg)}var y;s(this,"_invoke",{value:function(S,F){function U(){return new d(function($,z){p(S,F,$,z)})}return y=y?y.then(U,U):U()}})}function V(f,d,p){var y=g;return function(A,S){if(y===m)throw Error("Generator is already running");if(y===v){if(A==="throw")throw S;return{value:e,done:!0}}for(p.method=A,p.arg=S;;){var F=p.delegate;if(F){var U=q(F,p);if(U){if(U===x)continue;return U}}if(p.method==="next")p.sent=p._sent=p.arg;else if(p.method==="throw"){if(y===g)throw y=v,p.arg;p.dispatchException(p.arg)}else p.method==="return"&&p.abrupt("return",p.arg);y=m;var $=u(f,d,p);if($.type==="normal"){if(y=p.done?v:_,$.arg===x)continue;return{value:$.arg,done:p.done}}$.type==="throw"&&(y=v,p.method="throw",p.arg=$.arg)}}}function q(f,d){var p=d.method,y=f.iterator[p];if(y===e)return d.delegate=null,p==="throw"&&f.iterator.return&&(d.method="return",d.arg=e,q(f,d),d.method==="throw")||p!=="return"&&(d.method="throw",d.arg=new TypeError("The iterator does not provide a '"+p+"' method")),x;var A=u(y,f.iterator,d.arg);if(A.type==="throw")return d.method="throw",d.arg=A.arg,d.delegate=null,x;var S=A.arg;return S?S.done?(d[f.resultName]=S.value,d.next=f.nextLoc,d.method!=="return"&&(d.method="next",d.arg=e),d.delegate=null,x):S:(d.method="throw",d.arg=new TypeError("iterator result is not an object"),d.delegate=null,x)}function ne(f){var d={tryLoc:f[0]};1 in f&&(d.catchLoc=f[1]),2 in f&&(d.finallyLoc=f[2],d.afterLoc=f[3]),this.tryEntries.push(d)}function C(f){var d=f.completion||{};d.type="normal",delete d.arg,f.completion=d}function w(f){this.tryEntries=[{tryLoc:"root"}],f.forEach(ne,this),this.reset(!0)}function k(f){if(f||f===""){var d=f[o];if(d)return d.call(f);if(typeof f.next=="function")return f;if(!isNaN(f.length)){var p=-1,y=function A(){for(;++p<f.length;)if(r.call(f,p))return A.value=f[p],A.done=!1,A;return A.value=e,A.done=!0,A};return y.next=y}}throw new TypeError(Nr(f)+" is not iterable")}return M.prototype=D,s(R,"constructor",{value:D,configurable:!0}),s(D,"constructor",{value:M,configurable:!0}),M.displayName=l(D,h,"GeneratorFunction"),t.isGeneratorFunction=function(f){var d=typeof f=="function"&&f.constructor;return!!d&&(d===M||(d.displayName||d.name)==="GeneratorFunction")},t.mark=function(f){return Object.setPrototypeOf?Object.setPrototypeOf(f,D):(f.__proto__=D,l(f,h,"GeneratorFunction")),f.prototype=Object.create(R),f},t.awrap=function(f){return{__await:f}},G(W.prototype),l(W.prototype,a,function(){return this}),t.AsyncIterator=W,t.async=function(f,d,p,y,A){A===void 0&&(A=Promise);var S=new W(c(f,d,p,y),A);return t.isGeneratorFunction(d)?S:S.next().then(function(F){return F.done?F.value:S.next()})},G(R),l(R,h,"Generator"),l(R,o,function(){return this}),l(R,"toString",function(){return"[object Generator]"}),t.keys=function(f){var d=Object(f),p=[];for(var y in d)p.push(y);return p.reverse(),function A(){for(;p.length;){var S=p.pop();if(S in d)return A.value=S,A.done=!1,A}return A.done=!0,A}},t.values=k,w.prototype={constructor:w,reset:function(d){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!d)for(var p in this)p.charAt(0)==="t"&&r.call(this,p)&&!isNaN(+p.slice(1))&&(this[p]=e)},stop:function(){this.done=!0;var d=this.tryEntries[0].completion;if(d.type==="throw")throw d.arg;return this.rval},dispatchException:function(d){if(this.done)throw d;var p=this;function y(z,J){return F.type="throw",F.arg=d,p.next=z,J&&(p.method="next",p.arg=e),!!J}for(var A=this.tryEntries.length-1;A>=0;--A){var S=this.tryEntries[A],F=S.completion;if(S.tryLoc==="root")return y("end");if(S.tryLoc<=this.prev){var U=r.call(S,"catchLoc"),$=r.call(S,"finallyLoc");if(U&&$){if(this.prev<S.catchLoc)return y(S.catchLoc,!0);if(this.prev<S.finallyLoc)return y(S.finallyLoc)}else if(U){if(this.prev<S.catchLoc)return y(S.catchLoc,!0)}else{if(!$)throw Error("try statement without catch or finally");if(this.prev<S.finallyLoc)return y(S.finallyLoc)}}}},abrupt:function(d,p){for(var y=this.tryEntries.length-1;y>=0;--y){var A=this.tryEntries[y];if(A.tryLoc<=this.prev&&r.call(A,"finallyLoc")&&this.prev<A.finallyLoc){var S=A;break}}S&&(d==="break"||d==="continue")&&S.tryLoc<=p&&p<=S.finallyLoc&&(S=null);var F=S?S.completion:{};return F.type=d,F.arg=p,S?(this.method="next",this.next=S.finallyLoc,x):this.complete(F)},complete:function(d,p){if(d.type==="throw")throw d.arg;return d.type==="break"||d.type==="continue"?this.next=d.arg:d.type==="return"?(this.rval=this.arg=d.arg,this.method="return",this.next="end"):d.type==="normal"&&p&&(this.next=p),x},finish:function(d){for(var p=this.tryEntries.length-1;p>=0;--p){var y=this.tryEntries[p];if(y.finallyLoc===d)return this.complete(y.completion,y.afterLoc),C(y),x}},catch:function(d){for(var p=this.tryEntries.length-1;p>=0;--p){var y=this.tryEntries[p];if(y.tryLoc===d){var A=y.completion;if(A.type==="throw"){var S=A.arg;C(y)}return S}}throw Error("illegal catch attempt")},delegateYield:function(d,p,y){return this.delegate={iterator:k(d),resultName:p,nextLoc:y},this.method==="next"&&(this.arg=e),x}},t}function mp(e,t,i,r,s,n,o){try{var a=e[n](o),h=a.value}catch(l){return void i(l)}a.done?t(h):Promise.resolve(h).then(r,s)}function Ht(e){return function(){var t=this,i=arguments;return new Promise(function(r,s){var n=e.apply(t,i);function o(h){mp(n,r,s,o,a,"next",h)}function a(h){mp(n,r,s,o,a,"throw",h)}o(void 0)})}}function yp(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function vp(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,NS(r.key),r)}}function bp(e,t,i){return t&&vp(e.prototype,t),i&&vp(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function NS(e){var t=QS(e,"string");return Nr(t)=="symbol"?t:t+""}function QS(e,t){if(Nr(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(Nr(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var ZD=ps.AESECBCipher=function(){function e(){yp(this,e),this._key=null}return bp(e,[{key:"algorithm",get:function(){return{name:"AES-ECB"}}},{key:"_importKey",value:function(){var t=Ht(be().mark(function r(s,n,o){return be().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,window.crypto.subtle.importKey("raw",s,{name:"AES-CBC"},n,o);case 2:this._key=h.sent;case 3:case"end":return h.stop()}},r,this)}));function i(r,s,n){return t.apply(this,arguments)}return i}()},{key:"encrypt",value:function(){var t=Ht(be().mark(function r(s,n){var o,a,h,l;return be().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(o=new Uint8Array(n),!(o.length%16!==0||this._key===null)){u.next=3;break}return u.abrupt("return",null);case 3:a=o.length/16,h=0;case 5:if(!(h<a)){u.next=15;break}return u.t0=Uint8Array,u.next=9,window.crypto.subtle.encrypt({name:"AES-CBC",iv:new Uint8Array(16)},this._key,o.slice(h*16,h*16+16));case 9:u.t1=u.sent,l=new u.t0(u.t1).slice(0,16),o.set(l,h*16);case 12:h++,u.next=5;break;case 15:return u.abrupt("return",o);case 16:case"end":return u.stop()}},r,this)}));function i(r,s){return t.apply(this,arguments)}return i}()}],[{key:"importKey",value:function(){var t=Ht(be().mark(function r(s,n,o,a){var h;return be().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return h=new e,c.next=3,h._importKey(s,o,a);case 3:return c.abrupt("return",h);case 4:case"end":return c.stop()}},r)}));function i(r,s,n,o){return t.apply(this,arguments)}return i}()}])}(),eI=ps.AESEAXCipher=function(){function e(){yp(this,e),this._rawKey=null,this._ctrKey=null,this._cbcKey=null,this._zeroBlock=new Uint8Array(16),this._prefixBlock0=this._zeroBlock,this._prefixBlock1=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1]),this._prefixBlock2=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2])}return bp(e,[{key:"algorithm",get:function(){return{name:"AES-EAX"}}},{key:"_encryptBlock",value:function(){var t=Ht(be().mark(function r(s){var n;return be().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,window.crypto.subtle.encrypt({name:"AES-CBC",iv:this._zeroBlock},this._cbcKey,s);case 2:return n=a.sent,a.abrupt("return",new Uint8Array(n).slice(0,16));case 4:case"end":return a.stop()}},r,this)}));function i(r){return t.apply(this,arguments)}return i}()},{key:"_initCMAC",value:function(){var t=Ht(be().mark(function r(){var s,n,o,a,h;return be().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this._encryptBlock(this._zeroBlock);case 2:for(s=c.sent,n=new Uint8Array(16),o=s[0]>>>6,a=0;a<15;a++)n[a]=s[a+1]>>6|s[a]<<2,s[a]=s[a+1]>>7|s[a]<<1;h=[0,135,14,137],n[14]^=o>>>1,n[15]=s[15]<<2^h[o],s[15]=s[15]<<1^h[o>>1],this._k1=s,this._k2=n;case 12:case"end":return c.stop()}},r,this)}));function i(){return t.apply(this,arguments)}return i}()},{key:"_encryptCTR",value:function(){var t=Ht(be().mark(function r(s,n){var o;return be().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,window.crypto.subtle.encrypt({name:"AES-CTR",counter:n,length:128},this._ctrKey,s);case 2:return o=h.sent,h.abrupt("return",new Uint8Array(o));case 4:case"end":return h.stop()}},r,this)}));function i(r,s){return t.apply(this,arguments)}return i}()},{key:"_decryptCTR",value:function(){var t=Ht(be().mark(function r(s,n){var o;return be().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,window.crypto.subtle.decrypt({name:"AES-CTR",counter:n,length:128},this._ctrKey,s);case 2:return o=h.sent,h.abrupt("return",new Uint8Array(o));case 4:case"end":return h.stop()}},r,this)}));function i(r,s){return t.apply(this,arguments)}return i}()},{key:"_computeCMAC",value:function(){var t=Ht(be().mark(function r(s,n){var o,a,h,l,c,u,g,_;return be().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(n.length===16){v.next=2;break}return v.abrupt("return",null);case 2:if(o=Math.floor(s.length/16),a=Math.ceil(s.length/16),h=s.length-o*16,l=new Uint8Array((a+1)*16),l.set(n),l.set(s,16),h===0)for(c=0;c<16;c++)l[o*16+c]^=this._k1[c];else for(l[(o+1)*16+h]=128,u=0;u<16;u++)l[(o+1)*16+u]^=this._k2[u];return v.next=11,window.crypto.subtle.encrypt({name:"AES-CBC",iv:this._zeroBlock},this._cbcKey,l);case 11:return g=v.sent,g=new Uint8Array(g),_=g.slice(g.length-32,g.length-16),v.abrupt("return",_);case 15:case"end":return v.stop()}},r,this)}));function i(r,s){return t.apply(this,arguments)}return i}()},{key:"_importKey",value:function(){var t=Ht(be().mark(function r(s){return be().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this._rawKey=s,o.next=3,window.crypto.subtle.importKey("raw",s,{name:"AES-CTR"},!1,["encrypt","decrypt"]);case 3:return this._ctrKey=o.sent,o.next=6,window.crypto.subtle.importKey("raw",s,{name:"AES-CBC"},!1,["encrypt"]);case 6:return this._cbcKey=o.sent,o.next=9,this._initCMAC();case 9:case"end":return o.stop()}},r,this)}));function i(r){return t.apply(this,arguments)}return i}()},{key:"encrypt",value:function(){var t=Ht(be().mark(function r(s,n){var o,a,h,l,c,u,g,_;return be().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return o=s.additionalData,a=s.iv,v.next=4,this._computeCMAC(a,this._prefixBlock0);case 4:return h=v.sent,v.next=7,this._encryptCTR(n,h);case 7:return l=v.sent,v.next=10,this._computeCMAC(o,this._prefixBlock1);case 10:return c=v.sent,v.next=13,this._computeCMAC(l,this._prefixBlock2);case 13:for(u=v.sent,g=0;g<16;g++)u[g]^=h[g]^c[g];return _=new Uint8Array(16+l.length),_.set(l),_.set(u,l.length),v.abrupt("return",_);case 19:case"end":return v.stop()}},r,this)}));function i(r,s){return t.apply(this,arguments)}return i}()},{key:"decrypt",value:function(){var t=Ht(be().mark(function r(s,n){var o,a,h,l,c,u,g,_,m,v;return be().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return o=n.slice(0,n.length-16),a=s.additionalData,h=s.iv,l=n.slice(n.length-16),E.next=6,this._computeCMAC(h,this._prefixBlock0);case 6:return c=E.sent,E.next=9,this._computeCMAC(a,this._prefixBlock1);case 9:return u=E.sent,E.next=12,this._computeCMAC(o,this._prefixBlock2);case 12:for(g=E.sent,_=0;_<16;_++)g[_]^=c[_]^u[_];if(g.length===l.length){E.next=16;break}return E.abrupt("return",null);case 16:m=0;case 17:if(!(m<l.length)){E.next=23;break}if(g[m]===l[m]){E.next=20;break}return E.abrupt("return",null);case 20:m++,E.next=17;break;case 23:return E.next=25,this._decryptCTR(o,c);case 25:return v=E.sent,E.abrupt("return",v);case 27:case"end":return E.stop()}},r,this)}));function i(r,s){return t.apply(this,arguments)}return i}()}],[{key:"importKey",value:function(){var t=Ht(be().mark(function r(s,n,o,a){var h;return be().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return h=new e,c.next=3,h._importKey(s);case 3:return c.abrupt("return",h);case 4:case"end":return c.stop()}},r)}));function i(r,s,n,o){return t.apply(this,arguments)}return i}()}])}()});var Tp=ie(gs=>{"use strict";Object.defineProperty(gs,"__esModule",{value:!0});gs.DESECBCipher=gs.DESCBCCipher=void 0;function gn(e){"@babel/helpers - typeof";return gn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gn(e)}function vc(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ap(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,HS(r.key),r)}}function yc(e,t,i){return t&&Ap(e.prototype,t),i&&Ap(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function HS(e){var t=XS(e,"string");return gn(t)=="symbol"?t:t+""}function XS(e,t){if(gn(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(gn(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var xp=[13,16,10,23,0,4,2,27,14,5,20,9,22,18,11,3,25,7,15,6,26,19,12,1,40,51,30,36,46,54,29,39,50,44,32,47,43,48,38,55,33,52,45,41,49,35,28,31],US=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],B=0,P,O,H,K,N,X;P=65536;O=1<<24;H=P|O;K=4;N=1024;X=K|N;var Sp=[H|N,B|B,P|B,H|X,H|K,P|X,B|K,P|B,B|N,H|N,H|X,B|N,O|X,H|K,O|B,B|K,B|X,O|N,O|N,P|N,P|N,H|B,H|B,O|X,P|K,O|K,O|K,P|K,B|B,B|X,P|X,O|B,P|B,H|X,B|K,H|B,H|N,O|B,O|B,B|N,H|K,P|B,P|N,O|K,B|N,B|K,O|X,P|X,H|X,P|K,H|B,O|X,O|K,B|X,P|X,H|N,B|X,O|N,O|N,B|B,P|K,P|N,B|B,H|K];P=1<<20;O=1<<31;H=P|O;K=32;N=32768;X=K|N;var Cp=[H|X,O|N,B|N,P|X,P|B,B|K,H|K,O|X,O|K,H|X,H|N,O|B,O|N,P|B,B|K,H|K,P|N,P|K,O|X,B|B,O|B,B|N,P|X,H|B,P|K,O|K,B|B,P|N,B|X,H|N,H|B,B|X,B|B,P|X,H|K,P|B,O|X,H|B,H|N,B|N,H|B,O|N,B|K,H|X,P|X,B|K,B|N,O|B,B|X,H|N,P|B,O|K,P|K,O|X,O|K,P|K,P|N,B|B,O|N,B|X,O|B,H|K,H|X,P|N];P=1<<17;O=1<<27;H=P|O;K=8;N=512;X=K|N;var kp=[B|X,H|N,B|B,H|K,O|N,B|B,P|X,O|N,P|K,O|K,O|K,P|B,H|X,P|K,H|B,B|X,O|B,B|K,H|N,B|N,P|N,H|B,H|K,P|X,O|X,P|N,P|B,O|X,B|K,H|X,B|N,O|B,H|N,O|B,P|K,B|X,P|B,H|N,O|N,B|B,B|N,P|K,H|X,O|N,O|K,B|N,B|B,H|K,O|X,P|B,O|B,H|X,B|K,P|X,P|N,O|K,H|B,O|X,B|X,H|B,P|X,B|K,H|K,P|N];P=8192;O=1<<23;H=P|O;K=1;N=128;X=K|N;var Ep=[H|K,P|X,P|X,B|N,H|N,O|X,O|K,P|K,B|B,H|B,H|B,H|X,B|X,B|B,O|N,O|K,B|K,P|B,O|B,H|K,B|N,O|B,P|K,P|N,O|X,B|K,P|N,O|N,P|B,H|N,H|X,B|X,O|N,O|K,H|B,H|X,B|X,B|B,B|B,H|B,P|N,O|N,O|X,B|K,H|K,P|X,P|X,B|N,H|X,B|X,B|K,P|B,O|K,P|K,H|N,O|X,P|K,P|N,O|B,H|K,B|N,O|B,P|B,H|N];P=1<<25;O=1<<30;H=P|O;K=256;N=1<<19;X=K|N;var Bp=[B|K,P|X,P|N,H|K,B|N,B|K,O|B,P|N,O|X,B|N,P|K,O|X,H|K,H|N,B|X,O|B,P|B,O|N,O|N,B|B,O|K,H|X,H|X,P|K,H|N,O|K,B|B,H|B,P|X,P|B,H|B,B|X,B|N,H|K,B|K,P|B,O|B,P|N,H|K,O|X,P|K,O|B,H|N,P|X,O|X,B|K,P|B,H|N,H|X,B|X,H|B,H|X,P|N,B|B,O|N,H|B,B|X,P|K,O|K,B|N,B|B,O|N,P|X,O|K];P=1<<22;O=1<<29;H=P|O;K=16;N=16384;X=K|N;var Lp=[O|K,H|B,B|N,H|X,H|B,B|K,H|X,P|B,O|N,P|X,P|B,O|K,P|K,O|N,O|B,B|X,B|B,P|K,O|X,B|N,P|N,O|X,B|K,H|K,H|K,B|B,P|X,H|N,B|X,P|N,H|N,O|B,O|N,B|K,H|K,P|N,H|X,P|B,B|X,O|K,P|B,O|N,O|B,B|X,O|K,H|X,P|N,H|B,P|X,H|N,B|B,H|K,B|K,B|N,H|B,P|X,B|N,P|K,O|X,B|B,H|N,O|B,P|K,O|X];P=1<<21;O=1<<26;H=P|O;K=2;N=2048;X=K|N;var Dp=[P|B,H|K,O|X,B|B,B|N,O|X,P|X,H|N,H|X,P|B,B|B,O|K,B|K,O|B,H|K,B|X,O|N,P|X,P|K,O|N,O|K,H|B,H|N,P|K,H|B,B|N,B|X,H|X,P|N,B|K,O|B,P|N,O|B,P|N,P|B,O|X,O|X,H|K,H|K,B|K,P|K,O|B,O|N,P|B,H|N,B|X,P|X,H|N,B|X,O|K,H|X,H|B,P|N,B|B,B|K,H|X,B|B,P|X,H|B,B|N,O|K,O|N,B|N,P|K];P=1<<18;O=1<<28;H=P|O;K=64;N=4096;X=K|N;var Ip=[O|X,B|N,P|B,H|X,O|B,O|X,B|K,O|B,P|K,H|B,H|X,P|N,H|N,P|X,B|N,B|K,H|B,O|K,O|N,B|X,P|N,P|K,H|K,H|N,B|X,B|B,B|B,H|K,O|K,O|N,P|X,P|B,P|X,P|B,H|N,B|N,B|K,H|K,B|N,P|X,O|N,B|K,O|K,H|B,H|K,O|B,P|B,O|X,B|B,H|X,P|K,O|K,H|B,O|N,O|X,B|B,H|X,P|N,P|N,B|X,B|X,P|K,O|B,H|N],Mp=function(){function e(t){vc(this,e),this.keys=[];for(var i=[],r=[],s=[],n=0,o=56;n<56;++n,o-=8){o+=o<-5?65:o<-3?31:o<-1?63:o===27?35:0;var a=o&7;i[n]=(t[o>>>3]&1<<a)!==0?1:0}for(var h=0;h<16;++h){var l=h<<1,c=l+1;s[l]=s[c]=0;for(var u=28;u<59;u+=28)for(var g=u-28;g<u;++g){var _=g+US[h];r[g]=_<u?i[_]:i[_-28]}for(var m=0;m<24;++m)r[xp[m]]!==0&&(s[l]|=1<<23-m),r[xp[m+24]]!==0&&(s[c]|=1<<23-m)}for(var v=0,x=0,E=0;v<16;++v){var M=s[x++],D=s[x++];this.keys[E]=(M&16515072)<<6,this.keys[E]|=(M&4032)<<10,this.keys[E]|=(D&16515072)>>>10,this.keys[E]|=(D&4032)>>>6,++E,this.keys[E]=(M&258048)<<12,this.keys[E]|=(M&63)<<16,this.keys[E]|=(D&258048)>>>4,this.keys[E]|=D&63,++E}}return yc(e,[{key:"enc8",value:function(i){var r=i.slice(),s=0,n,o,a;n=r[s++]<<24|r[s++]<<16|r[s++]<<8|r[s++],o=r[s++]<<24|r[s++]<<16|r[s++]<<8|r[s++],a=(n>>>4^o)&252645135,o^=a,n^=a<<4,a=(n>>>16^o)&65535,o^=a,n^=a<<16,a=(o>>>2^n)&858993459,n^=a,o^=a<<2,a=(o>>>8^n)&16711935,n^=a,o^=a<<8,o=o<<1|o>>>31&1,a=(n^o)&2863311530,n^=a,o^=a,n=n<<1|n>>>31&1;for(var h=0,l=0;h<8;++h){a=o<<28|o>>>4,a^=this.keys[l++];var c=Dp[a&63];c|=Bp[a>>>8&63],c|=kp[a>>>16&63],c|=Sp[a>>>24&63],a=o^this.keys[l++],c|=Ip[a&63],c|=Lp[a>>>8&63],c|=Ep[a>>>16&63],c|=Cp[a>>>24&63],n^=c,a=n<<28|n>>>4,a^=this.keys[l++],c=Dp[a&63],c|=Bp[a>>>8&63],c|=kp[a>>>16&63],c|=Sp[a>>>24&63],a=n^this.keys[l++],c|=Ip[a&63],c|=Lp[a>>>8&63],c|=Ep[a>>>16&63],c|=Cp[a>>>24&63],o^=c}for(o=o<<31|o>>>1,a=(n^o)&2863311530,n^=a,o^=a,n=n<<31|n>>>1,a=(n>>>8^o)&16711935,o^=a,n^=a<<8,a=(n>>>2^o)&858993459,o^=a,n^=a<<2,a=(o>>>16^n)&65535,n^=a,o^=a<<16,a=(o>>>4^n)&252645135,n^=a,o^=a<<4,a=[o,n],s=0;s<8;s++)r[s]=(a[s>>>2]>>>8*(3-s%4))%256,r[s]<0&&(r[s]+=256);return r}}])}(),iI=gs.DESECBCipher=function(){function e(){vc(this,e),this._cipher=null}return yc(e,[{key:"algorithm",get:function(){return{name:"DES-ECB"}}},{key:"_importKey",value:function(i,r,s){this._cipher=new Mp(i)}},{key:"encrypt",value:function(i,r){var s=new Uint8Array(r);if(s.length%8!==0||this._cipher===null)return null;for(var n=s.length/8,o=0;o<n;o++)s.set(this._cipher.enc8(s.slice(o*8,o*8+8)),o*8);return s}}],[{key:"importKey",value:function(i,r,s,n){var o=new e;return o._importKey(i),o}}])}(),rI=gs.DESCBCCipher=function(){function e(){vc(this,e),this._cipher=null}return yc(e,[{key:"algorithm",get:function(){return{name:"DES-CBC"}}},{key:"_importKey",value:function(i){this._cipher=new Mp(i)}},{key:"encrypt",value:function(i,r){var s=new Uint8Array(r),n=new Uint8Array(i.iv);if(s.length%8!==0||this._cipher===null)return null;for(var o=s.length/8,a=0;a<o;a++){for(var h=0;h<8;h++)n[h]^=r[a*8+h];n=this._cipher.enc8(n),s.set(n,a*8)}return s}}],[{key:"importKey",value:function(i,r,s,n){var o=new e;return o._importKey(i),o}}])}()});var bc=ie(mn=>{"use strict";Object.defineProperty(mn,"__esModule",{value:!0});mn.bigIntToU8Array=WS;mn.modPow=zS;mn.u8ArrayToBigInt=$S;function zS(e,t,i){var r=1n;for(e=e%i;t>0n;)(t&1n)===1n&&(r=r*e%i),t=t>>1n,e=e*e%i;return r}function WS(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=e.toString(16);t===0&&(t=Math.ceil(i.length/2)),i=i.padStart(t*2,"0");for(var r=i.length/2,s=new Uint8Array(r),n=0;n<r;n++)s[n]=parseInt(i.slice(n*2,n*2+2),16);return s}function $S(e){for(var t="0x",i=0;i<e.length;i++)t+=e[i].toString(16).padStart(2,"0");return BigInt(t)}});var Pp=ie(ta=>{"use strict";Object.defineProperty(ta,"__esModule",{value:!0});ta.RSACipher=void 0;var GS=jS(Eh()),ei=bc();function jS(e){return e&&e.__esModule?e:{default:e}}function Hr(e){"@babel/helpers - typeof";return Hr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hr(e)}function gt(){"use strict";gt=function(){return t};var e,t={},i=Object.prototype,r=i.hasOwnProperty,s=Object.defineProperty||function(f,d,p){f[d]=p.value},n=typeof Symbol=="function"?Symbol:{},o=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",h=n.toStringTag||"@@toStringTag";function l(f,d,p){return Object.defineProperty(f,d,{value:p,enumerable:!0,configurable:!0,writable:!0}),f[d]}try{l({},"")}catch{l=function(p,y,A){return p[y]=A}}function c(f,d,p,y){var A=d&&d.prototype instanceof E?d:E,S=Object.create(A.prototype),F=new w(y||[]);return s(S,"_invoke",{value:V(f,p,F)}),S}function u(f,d,p){try{return{type:"normal",arg:f.call(d,p)}}catch(y){return{type:"throw",arg:y}}}t.wrap=c;var g="suspendedStart",_="suspendedYield",m="executing",v="completed",x={};function E(){}function M(){}function D(){}var b={};l(b,o,function(){return this});var L=Object.getPrototypeOf,I=L&&L(L(k([])));I&&I!==i&&r.call(I,o)&&(b=I);var R=D.prototype=E.prototype=Object.create(b);function G(f){["next","throw","return"].forEach(function(d){l(f,d,function(p){return this._invoke(d,p)})})}function W(f,d){function p(A,S,F,U){var $=u(f[A],f,S);if($.type!=="throw"){var z=$.arg,J=z.value;return J&&Hr(J)=="object"&&r.call(J,"__await")?d.resolve(J.__await).then(function(ee){p("next",ee,F,U)},function(ee){p("throw",ee,F,U)}):d.resolve(J).then(function(ee){z.value=ee,F(z)},function(ee){return p("throw",ee,F,U)})}U($.arg)}var y;s(this,"_invoke",{value:function(S,F){function U(){return new d(function($,z){p(S,F,$,z)})}return y=y?y.then(U,U):U()}})}function V(f,d,p){var y=g;return function(A,S){if(y===m)throw Error("Generator is already running");if(y===v){if(A==="throw")throw S;return{value:e,done:!0}}for(p.method=A,p.arg=S;;){var F=p.delegate;if(F){var U=q(F,p);if(U){if(U===x)continue;return U}}if(p.method==="next")p.sent=p._sent=p.arg;else if(p.method==="throw"){if(y===g)throw y=v,p.arg;p.dispatchException(p.arg)}else p.method==="return"&&p.abrupt("return",p.arg);y=m;var $=u(f,d,p);if($.type==="normal"){if(y=p.done?v:_,$.arg===x)continue;return{value:$.arg,done:p.done}}$.type==="throw"&&(y=v,p.method="throw",p.arg=$.arg)}}}function q(f,d){var p=d.method,y=f.iterator[p];if(y===e)return d.delegate=null,p==="throw"&&f.iterator.return&&(d.method="return",d.arg=e,q(f,d),d.method==="throw")||p!=="return"&&(d.method="throw",d.arg=new TypeError("The iterator does not provide a '"+p+"' method")),x;var A=u(y,f.iterator,d.arg);if(A.type==="throw")return d.method="throw",d.arg=A.arg,d.delegate=null,x;var S=A.arg;return S?S.done?(d[f.resultName]=S.value,d.next=f.nextLoc,d.method!=="return"&&(d.method="next",d.arg=e),d.delegate=null,x):S:(d.method="throw",d.arg=new TypeError("iterator result is not an object"),d.delegate=null,x)}function ne(f){var d={tryLoc:f[0]};1 in f&&(d.catchLoc=f[1]),2 in f&&(d.finallyLoc=f[2],d.afterLoc=f[3]),this.tryEntries.push(d)}function C(f){var d=f.completion||{};d.type="normal",delete d.arg,f.completion=d}function w(f){this.tryEntries=[{tryLoc:"root"}],f.forEach(ne,this),this.reset(!0)}function k(f){if(f||f===""){var d=f[o];if(d)return d.call(f);if(typeof f.next=="function")return f;if(!isNaN(f.length)){var p=-1,y=function A(){for(;++p<f.length;)if(r.call(f,p))return A.value=f[p],A.done=!1,A;return A.value=e,A.done=!0,A};return y.next=y}}throw new TypeError(Hr(f)+" is not iterable")}return M.prototype=D,s(R,"constructor",{value:D,configurable:!0}),s(D,"constructor",{value:M,configurable:!0}),M.displayName=l(D,h,"GeneratorFunction"),t.isGeneratorFunction=function(f){var d=typeof f=="function"&&f.constructor;return!!d&&(d===M||(d.displayName||d.name)==="GeneratorFunction")},t.mark=function(f){return Object.setPrototypeOf?Object.setPrototypeOf(f,D):(f.__proto__=D,l(f,h,"GeneratorFunction")),f.prototype=Object.create(R),f},t.awrap=function(f){return{__await:f}},G(W.prototype),l(W.prototype,a,function(){return this}),t.AsyncIterator=W,t.async=function(f,d,p,y,A){A===void 0&&(A=Promise);var S=new W(c(f,d,p,y),A);return t.isGeneratorFunction(d)?S:S.next().then(function(F){return F.done?F.value:S.next()})},G(R),l(R,h,"Generator"),l(R,o,function(){return this}),l(R,"toString",function(){return"[object Generator]"}),t.keys=function(f){var d=Object(f),p=[];for(var y in d)p.push(y);return p.reverse(),function A(){for(;p.length;){var S=p.pop();if(S in d)return A.value=S,A.done=!1,A}return A.done=!0,A}},t.values=k,w.prototype={constructor:w,reset:function(d){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!d)for(var p in this)p.charAt(0)==="t"&&r.call(this,p)&&!isNaN(+p.slice(1))&&(this[p]=e)},stop:function(){this.done=!0;var d=this.tryEntries[0].completion;if(d.type==="throw")throw d.arg;return this.rval},dispatchException:function(d){if(this.done)throw d;var p=this;function y(z,J){return F.type="throw",F.arg=d,p.next=z,J&&(p.method="next",p.arg=e),!!J}for(var A=this.tryEntries.length-1;A>=0;--A){var S=this.tryEntries[A],F=S.completion;if(S.tryLoc==="root")return y("end");if(S.tryLoc<=this.prev){var U=r.call(S,"catchLoc"),$=r.call(S,"finallyLoc");if(U&&$){if(this.prev<S.catchLoc)return y(S.catchLoc,!0);if(this.prev<S.finallyLoc)return y(S.finallyLoc)}else if(U){if(this.prev<S.catchLoc)return y(S.catchLoc,!0)}else{if(!$)throw Error("try statement without catch or finally");if(this.prev<S.finallyLoc)return y(S.finallyLoc)}}}},abrupt:function(d,p){for(var y=this.tryEntries.length-1;y>=0;--y){var A=this.tryEntries[y];if(A.tryLoc<=this.prev&&r.call(A,"finallyLoc")&&this.prev<A.finallyLoc){var S=A;break}}S&&(d==="break"||d==="continue")&&S.tryLoc<=p&&p<=S.finallyLoc&&(S=null);var F=S?S.completion:{};return F.type=d,F.arg=p,S?(this.method="next",this.next=S.finallyLoc,x):this.complete(F)},complete:function(d,p){if(d.type==="throw")throw d.arg;return d.type==="break"||d.type==="continue"?this.next=d.arg:d.type==="return"?(this.rval=this.arg=d.arg,this.method="return",this.next="end"):d.type==="normal"&&p&&(this.next=p),x},finish:function(d){for(var p=this.tryEntries.length-1;p>=0;--p){var y=this.tryEntries[p];if(y.finallyLoc===d)return this.complete(y.completion,y.afterLoc),C(y),x}},catch:function(d){for(var p=this.tryEntries.length-1;p>=0;--p){var y=this.tryEntries[p];if(y.tryLoc===d){var A=y.completion;if(A.type==="throw"){var S=A.arg;C(y)}return S}}throw Error("illegal catch attempt")},delegateYield:function(d,p,y){return this.delegate={iterator:k(d),resultName:p,nextLoc:y},this.method==="next"&&(this.arg=e),x}},t}function Rp(e,t,i,r,s,n,o){try{var a=e[n](o),h=a.value}catch(l){return void i(l)}a.done?t(h):Promise.resolve(h).then(r,s)}function Qr(e){return function(){var t=this,i=arguments;return new Promise(function(r,s){var n=e.apply(t,i);function o(h){Rp(n,r,s,o,a,"next",h)}function a(h){Rp(n,r,s,o,a,"throw",h)}o(void 0)})}}function qS(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Fp(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,YS(r.key),r)}}function VS(e,t,i){return t&&Fp(e.prototype,t),i&&Fp(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function YS(e){var t=JS(e,"string");return Hr(t)=="symbol"?t:t+""}function JS(e,t){if(Hr(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(Hr(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var oI=ta.RSACipher=function(){function e(){qS(this,e),this._keyLength=0,this._keyBytes=0,this._n=null,this._e=null,this._d=null,this._nBigInt=null,this._eBigInt=null,this._dBigInt=null,this._extractable=!1}return VS(e,[{key:"algorithm",get:function(){return{name:"RSA-PKCS1-v1_5"}}},{key:"_base64urlDecode",value:function(i){return i=i.replace(/-/g,"+").replace(/_/g,"/"),i=i.padEnd(Math.ceil(i.length/4)*4,"="),GS.default.decode(i)}},{key:"_padArray",value:function(i,r){var s=new Uint8Array(r);return s.set(i,r-i.length),s}},{key:"_generateKey",value:function(){var t=Qr(gt().mark(function r(s,n){var o,a;return gt().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this._keyLength=s.modulusLength,this._keyBytes=Math.ceil(this._keyLength/8),l.next=4,window.crypto.subtle.generateKey({name:"RSA-OAEP",modulusLength:s.modulusLength,publicExponent:s.publicExponent,hash:{name:"SHA-256"}},!0,["encrypt","decrypt"]);case 4:return o=l.sent,l.next=7,window.crypto.subtle.exportKey("jwk",o.privateKey);case 7:a=l.sent,this._n=this._padArray(this._base64urlDecode(a.n),this._keyBytes),this._nBigInt=(0,ei.u8ArrayToBigInt)(this._n),this._e=this._padArray(this._base64urlDecode(a.e),this._keyBytes),this._eBigInt=(0,ei.u8ArrayToBigInt)(this._e),this._d=this._padArray(this._base64urlDecode(a.d),this._keyBytes),this._dBigInt=(0,ei.u8ArrayToBigInt)(this._d),this._extractable=n;case 15:case"end":return l.stop()}},r,this)}));function i(r,s){return t.apply(this,arguments)}return i}()},{key:"_importKey",value:function(){var t=Qr(gt().mark(function r(s,n){var o,a;return gt().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(o=s.n,a=s.e,o.length===a.length){l.next=4;break}throw new Error("the sizes of modulus and public exponent do not match");case 4:this._keyBytes=o.length,this._keyLength=this._keyBytes*8,this._n=new Uint8Array(this._keyBytes),this._e=new Uint8Array(this._keyBytes),this._n.set(o),this._e.set(a),this._nBigInt=(0,ei.u8ArrayToBigInt)(this._n),this._eBigInt=(0,ei.u8ArrayToBigInt)(this._e),this._extractable=n;case 13:case"end":return l.stop()}},r,this)}));function i(r,s){return t.apply(this,arguments)}return i}()},{key:"encrypt",value:function(){var t=Qr(gt().mark(function r(s,n){var o,a,h,l,c;return gt().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(!(n.length>this._keyBytes-11)){g.next=2;break}return g.abrupt("return",null);case 2:for(o=new Uint8Array(this._keyBytes-n.length-3),window.crypto.getRandomValues(o),a=0;a<o.length;a++)o[a]=Math.floor(o[a]*254/255+1);return h=new Uint8Array(this._keyBytes),h[1]=2,h.set(o,2),h.set(n,o.length+3),l=(0,ei.u8ArrayToBigInt)(h),c=(0,ei.modPow)(l,this._eBigInt,this._nBigInt),g.abrupt("return",(0,ei.bigIntToU8Array)(c,this._keyBytes));case 12:case"end":return g.stop()}},r,this)}));function i(r,s){return t.apply(this,arguments)}return i}()},{key:"decrypt",value:function(){var t=Qr(gt().mark(function r(s,n){var o,a,h,l;return gt().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(n.length===this._keyBytes){u.next=2;break}return u.abrupt("return",null);case 2:if(o=(0,ei.u8ArrayToBigInt)(n),a=(0,ei.modPow)(o,this._dBigInt,this._nBigInt),h=(0,ei.bigIntToU8Array)(a,this._keyBytes),!(h[0]!==0||h[1]!==2)){u.next=7;break}return u.abrupt("return",null);case 7:l=2;case 8:if(!(l<h.length)){u.next=14;break}if(h[l]!==0){u.next=11;break}return u.abrupt("break",14);case 11:l++,u.next=8;break;case 14:if(l!==h.length){u.next=16;break}return u.abrupt("return",null);case 16:return u.abrupt("return",h.slice(l+1,h.length));case 17:case"end":return u.stop()}},r,this)}));function i(r,s){return t.apply(this,arguments)}return i}()},{key:"exportKey",value:function(){var t=Qr(gt().mark(function r(){return gt().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(this._extractable){n.next=2;break}throw new Error("key is not extractable");case 2:return n.abrupt("return",{n:this._n,e:this._e,d:this._d});case 3:case"end":return n.stop()}},r,this)}));function i(){return t.apply(this,arguments)}return i}()}],[{key:"generateKey",value:function(){var t=Qr(gt().mark(function r(s,n,o){var a;return gt().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return a=new e,l.next=3,a._generateKey(s,n);case 3:return l.abrupt("return",{privateKey:a});case 4:case"end":return l.stop()}},r)}));function i(r,s,n){return t.apply(this,arguments)}return i}()},{key:"importKey",value:function(){var t=Qr(gt().mark(function r(s,n,o,a){var h;return gt().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!(a.length!==1||a[0]!=="encrypt")){c.next=2;break}throw new Error("only support importing RSA public key");case 2:return h=new e,c.next=5,h._importKey(s,o);case 5:return c.abrupt("return",h);case 6:case"end":return c.stop()}},r)}));function i(r,s,n,o){return t.apply(this,arguments)}return i}()}])}()});var Qp=ie(ia=>{"use strict";Object.defineProperty(ia,"__esModule",{value:!0});ia.DHCipher=void 0;var hr=bc();function vn(e){"@babel/helpers - typeof";return vn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vn(e)}function Kp(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Op(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ZS(r.key),r)}}function Np(e,t,i){return t&&Op(e.prototype,t),i&&Op(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function ZS(e){var t=eC(e,"string");return vn(t)=="symbol"?t:t+""}function eC(e,t){if(vn(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(vn(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var tC=function(){function e(t){Kp(this,e),this._key=t}return Np(e,[{key:"algorithm",get:function(){return{name:"DH"}}},{key:"exportKey",value:function(){return this._key}}])}(),lI=ia.DHCipher=function(){function e(){Kp(this,e),this._g=null,this._p=null,this._gBigInt=null,this._pBigInt=null,this._privateKey=null}return Np(e,[{key:"algorithm",get:function(){return{name:"DH"}}},{key:"_generateKey",value:function(i){var r=i.g,s=i.p;this._keyBytes=s.length,this._gBigInt=(0,hr.u8ArrayToBigInt)(r),this._pBigInt=(0,hr.u8ArrayToBigInt)(s),this._privateKey=window.crypto.getRandomValues(new Uint8Array(this._keyBytes)),this._privateKeyBigInt=(0,hr.u8ArrayToBigInt)(this._privateKey),this._publicKey=(0,hr.bigIntToU8Array)((0,hr.modPow)(this._gBigInt,this._privateKeyBigInt,this._pBigInt),this._keyBytes)}},{key:"deriveBits",value:function(i,r){var s=Math.ceil(r/8),n=new Uint8Array(i.public),o=s>this._keyBytes?s:this._keyBytes,a=(0,hr.modPow)((0,hr.u8ArrayToBigInt)(n),this._privateKeyBigInt,this._pBigInt);return(0,hr.bigIntToU8Array)(a,o).slice(0,o)}}],[{key:"generateKey",value:function(i,r){var s=new e;return s._generateKey(i),{privateKey:s,publicKey:new tC(s._publicKey)}}}])}()});var Xp=ie(xc=>{"use strict";Object.defineProperty(xc,"__esModule",{value:!0});xc.MD5=rC;function ra(e){"@babel/helpers - typeof";return ra=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ra(e)}function wc(){"use strict";wc=function(){return t};var e,t={},i=Object.prototype,r=i.hasOwnProperty,s=Object.defineProperty||function(f,d,p){f[d]=p.value},n=typeof Symbol=="function"?Symbol:{},o=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",h=n.toStringTag||"@@toStringTag";function l(f,d,p){return Object.defineProperty(f,d,{value:p,enumerable:!0,configurable:!0,writable:!0}),f[d]}try{l({},"")}catch{l=function(p,y,A){return p[y]=A}}function c(f,d,p,y){var A=d&&d.prototype instanceof E?d:E,S=Object.create(A.prototype),F=new w(y||[]);return s(S,"_invoke",{value:V(f,p,F)}),S}function u(f,d,p){try{return{type:"normal",arg:f.call(d,p)}}catch(y){return{type:"throw",arg:y}}}t.wrap=c;var g="suspendedStart",_="suspendedYield",m="executing",v="completed",x={};function E(){}function M(){}function D(){}var b={};l(b,o,function(){return this});var L=Object.getPrototypeOf,I=L&&L(L(k([])));I&&I!==i&&r.call(I,o)&&(b=I);var R=D.prototype=E.prototype=Object.create(b);function G(f){["next","throw","return"].forEach(function(d){l(f,d,function(p){return this._invoke(d,p)})})}function W(f,d){function p(A,S,F,U){var $=u(f[A],f,S);if($.type!=="throw"){var z=$.arg,J=z.value;return J&&ra(J)=="object"&&r.call(J,"__await")?d.resolve(J.__await).then(function(ee){p("next",ee,F,U)},function(ee){p("throw",ee,F,U)}):d.resolve(J).then(function(ee){z.value=ee,F(z)},function(ee){return p("throw",ee,F,U)})}U($.arg)}var y;s(this,"_invoke",{value:function(S,F){function U(){return new d(function($,z){p(S,F,$,z)})}return y=y?y.then(U,U):U()}})}function V(f,d,p){var y=g;return function(A,S){if(y===m)throw Error("Generator is already running");if(y===v){if(A==="throw")throw S;return{value:e,done:!0}}for(p.method=A,p.arg=S;;){var F=p.delegate;if(F){var U=q(F,p);if(U){if(U===x)continue;return U}}if(p.method==="next")p.sent=p._sent=p.arg;else if(p.method==="throw"){if(y===g)throw y=v,p.arg;p.dispatchException(p.arg)}else p.method==="return"&&p.abrupt("return",p.arg);y=m;var $=u(f,d,p);if($.type==="normal"){if(y=p.done?v:_,$.arg===x)continue;return{value:$.arg,done:p.done}}$.type==="throw"&&(y=v,p.method="throw",p.arg=$.arg)}}}function q(f,d){var p=d.method,y=f.iterator[p];if(y===e)return d.delegate=null,p==="throw"&&f.iterator.return&&(d.method="return",d.arg=e,q(f,d),d.method==="throw")||p!=="return"&&(d.method="throw",d.arg=new TypeError("The iterator does not provide a '"+p+"' method")),x;var A=u(y,f.iterator,d.arg);if(A.type==="throw")return d.method="throw",d.arg=A.arg,d.delegate=null,x;var S=A.arg;return S?S.done?(d[f.resultName]=S.value,d.next=f.nextLoc,d.method!=="return"&&(d.method="next",d.arg=e),d.delegate=null,x):S:(d.method="throw",d.arg=new TypeError("iterator result is not an object"),d.delegate=null,x)}function ne(f){var d={tryLoc:f[0]};1 in f&&(d.catchLoc=f[1]),2 in f&&(d.finallyLoc=f[2],d.afterLoc=f[3]),this.tryEntries.push(d)}function C(f){var d=f.completion||{};d.type="normal",delete d.arg,f.completion=d}function w(f){this.tryEntries=[{tryLoc:"root"}],f.forEach(ne,this),this.reset(!0)}function k(f){if(f||f===""){var d=f[o];if(d)return d.call(f);if(typeof f.next=="function")return f;if(!isNaN(f.length)){var p=-1,y=function A(){for(;++p<f.length;)if(r.call(f,p))return A.value=f[p],A.done=!1,A;return A.value=e,A.done=!0,A};return y.next=y}}throw new TypeError(ra(f)+" is not iterable")}return M.prototype=D,s(R,"constructor",{value:D,configurable:!0}),s(D,"constructor",{value:M,configurable:!0}),M.displayName=l(D,h,"GeneratorFunction"),t.isGeneratorFunction=function(f){var d=typeof f=="function"&&f.constructor;return!!d&&(d===M||(d.displayName||d.name)==="GeneratorFunction")},t.mark=function(f){return Object.setPrototypeOf?Object.setPrototypeOf(f,D):(f.__proto__=D,l(f,h,"GeneratorFunction")),f.prototype=Object.create(R),f},t.awrap=function(f){return{__await:f}},G(W.prototype),l(W.prototype,a,function(){return this}),t.AsyncIterator=W,t.async=function(f,d,p,y,A){A===void 0&&(A=Promise);var S=new W(c(f,d,p,y),A);return t.isGeneratorFunction(d)?S:S.next().then(function(F){return F.done?F.value:S.next()})},G(R),l(R,h,"Generator"),l(R,o,function(){return this}),l(R,"toString",function(){return"[object Generator]"}),t.keys=function(f){var d=Object(f),p=[];for(var y in d)p.push(y);return p.reverse(),function A(){for(;p.length;){var S=p.pop();if(S in d)return A.value=S,A.done=!1,A}return A.done=!0,A}},t.values=k,w.prototype={constructor:w,reset:function(d){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!d)for(var p in this)p.charAt(0)==="t"&&r.call(this,p)&&!isNaN(+p.slice(1))&&(this[p]=e)},stop:function(){this.done=!0;var d=this.tryEntries[0].completion;if(d.type==="throw")throw d.arg;return this.rval},dispatchException:function(d){if(this.done)throw d;var p=this;function y(z,J){return F.type="throw",F.arg=d,p.next=z,J&&(p.method="next",p.arg=e),!!J}for(var A=this.tryEntries.length-1;A>=0;--A){var S=this.tryEntries[A],F=S.completion;if(S.tryLoc==="root")return y("end");if(S.tryLoc<=this.prev){var U=r.call(S,"catchLoc"),$=r.call(S,"finallyLoc");if(U&&$){if(this.prev<S.catchLoc)return y(S.catchLoc,!0);if(this.prev<S.finallyLoc)return y(S.finallyLoc)}else if(U){if(this.prev<S.catchLoc)return y(S.catchLoc,!0)}else{if(!$)throw Error("try statement without catch or finally");if(this.prev<S.finallyLoc)return y(S.finallyLoc)}}}},abrupt:function(d,p){for(var y=this.tryEntries.length-1;y>=0;--y){var A=this.tryEntries[y];if(A.tryLoc<=this.prev&&r.call(A,"finallyLoc")&&this.prev<A.finallyLoc){var S=A;break}}S&&(d==="break"||d==="continue")&&S.tryLoc<=p&&p<=S.finallyLoc&&(S=null);var F=S?S.completion:{};return F.type=d,F.arg=p,S?(this.method="next",this.next=S.finallyLoc,x):this.complete(F)},complete:function(d,p){if(d.type==="throw")throw d.arg;return d.type==="break"||d.type==="continue"?this.next=d.arg:d.type==="return"?(this.rval=this.arg=d.arg,this.method="return",this.next="end"):d.type==="normal"&&p&&(this.next=p),x},finish:function(d){for(var p=this.tryEntries.length-1;p>=0;--p){var y=this.tryEntries[p];if(y.finallyLoc===d)return this.complete(y.completion,y.afterLoc),C(y),x}},catch:function(d){for(var p=this.tryEntries.length-1;p>=0;--p){var y=this.tryEntries[p];if(y.tryLoc===d){var A=y.completion;if(A.type==="throw"){var S=A.arg;C(y)}return S}}throw Error("illegal catch attempt")},delegateYield:function(d,p,y){return this.delegate={iterator:k(d),resultName:p,nextLoc:y},this.method==="next"&&(this.arg=e),x}},t}function Hp(e,t,i,r,s,n,o){try{var a=e[n](o),h=a.value}catch(l){return void i(l)}a.done?t(h):Promise.resolve(h).then(r,s)}function iC(e){return function(){var t=this,i=arguments;return new Promise(function(r,s){var n=e.apply(t,i);function o(h){Hp(n,r,s,o,a,"next",h)}function a(h){Hp(n,r,s,o,a,"throw",h)}o(void 0)})}}function rC(e){return Ac.apply(this,arguments)}function Ac(){return Ac=iC(wc().mark(function e(t){var i,r;return wc().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:for(i="",r=0;r<t.length;r++)i+=String.fromCharCode(t[r]);return n.abrupt("return",sC(oC(aC(nC(i),8*i.length))));case 3:case"end":return n.stop()}},e)})),Ac.apply(this,arguments)}function sC(e){for(var t=new Uint8Array(e.length),i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}function nC(e){for(var t=Array(e.length>>2),i=0;i<t.length;i++)t[i]=0;for(var r=0;r<8*e.length;r+=8)t[r>>5]|=(255&e.charCodeAt(r/8))<<r%32;return t}function oC(e){for(var t="",i=0;i<32*e.length;i+=8)t+=String.fromCharCode(e[i>>5]>>>i%32&255);return t}function aC(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var i=1732584193,r=-271733879,s=-1732584194,n=271733878,o=0;o<e.length;o+=16){var a=i,h=r,l=s,c=n;r=dt(r=dt(r=dt(r=dt(r=ut(r=ut(r=ut(r=ut(r=ct(r=ct(r=ct(r=ct(r=ht(r=ht(r=ht(r=ht(r,s=ht(s,n=ht(n,i=ht(i,r,s,n,e[o+0],7,-680876936),r,s,e[o+1],12,-389564586),i,r,e[o+2],17,606105819),n,i,e[o+3],22,-1044525330),s=ht(s,n=ht(n,i=ht(i,r,s,n,e[o+4],7,-176418897),r,s,e[o+5],12,1200080426),i,r,e[o+6],17,-1473231341),n,i,e[o+7],22,-45705983),s=ht(s,n=ht(n,i=ht(i,r,s,n,e[o+8],7,1770035416),r,s,e[o+9],12,-1958414417),i,r,e[o+10],17,-42063),n,i,e[o+11],22,-1990404162),s=ht(s,n=ht(n,i=ht(i,r,s,n,e[o+12],7,1804603682),r,s,e[o+13],12,-40341101),i,r,e[o+14],17,-1502002290),n,i,e[o+15],22,1236535329),s=ct(s,n=ct(n,i=ct(i,r,s,n,e[o+1],5,-165796510),r,s,e[o+6],9,-1069501632),i,r,e[o+11],14,643717713),n,i,e[o+0],20,-373897302),s=ct(s,n=ct(n,i=ct(i,r,s,n,e[o+5],5,-701558691),r,s,e[o+10],9,38016083),i,r,e[o+15],14,-660478335),n,i,e[o+4],20,-405537848),s=ct(s,n=ct(n,i=ct(i,r,s,n,e[o+9],5,568446438),r,s,e[o+14],9,-1019803690),i,r,e[o+3],14,-187363961),n,i,e[o+8],20,1163531501),s=ct(s,n=ct(n,i=ct(i,r,s,n,e[o+13],5,-1444681467),r,s,e[o+2],9,-51403784),i,r,e[o+7],14,1735328473),n,i,e[o+12],20,-1926607734),s=ut(s,n=ut(n,i=ut(i,r,s,n,e[o+5],4,-378558),r,s,e[o+8],11,-2022574463),i,r,e[o+11],16,1839030562),n,i,e[o+14],23,-35309556),s=ut(s,n=ut(n,i=ut(i,r,s,n,e[o+1],4,-1530992060),r,s,e[o+4],11,1272893353),i,r,e[o+7],16,-155497632),n,i,e[o+10],23,-1094730640),s=ut(s,n=ut(n,i=ut(i,r,s,n,e[o+13],4,681279174),r,s,e[o+0],11,-358537222),i,r,e[o+3],16,-722521979),n,i,e[o+6],23,76029189),s=ut(s,n=ut(n,i=ut(i,r,s,n,e[o+9],4,-640364487),r,s,e[o+12],11,-421815835),i,r,e[o+15],16,530742520),n,i,e[o+2],23,-995338651),s=dt(s,n=dt(n,i=dt(i,r,s,n,e[o+0],6,-198630844),r,s,e[o+7],10,1126891415),i,r,e[o+14],15,-1416354905),n,i,e[o+5],21,-57434055),s=dt(s,n=dt(n,i=dt(i,r,s,n,e[o+12],6,1700485571),r,s,e[o+3],10,-1894986606),i,r,e[o+10],15,-1051523),n,i,e[o+1],21,-2054922799),s=dt(s,n=dt(n,i=dt(i,r,s,n,e[o+8],6,1873313359),r,s,e[o+15],10,-30611744),i,r,e[o+6],15,-1560198380),n,i,e[o+13],21,1309151649),s=dt(s,n=dt(n,i=dt(i,r,s,n,e[o+4],6,-145523070),r,s,e[o+11],10,-1120210379),i,r,e[o+2],15,718787259),n,i,e[o+9],21,-343485551),i=cr(i,a),r=cr(r,h),s=cr(s,l),n=cr(n,c)}return Array(i,r,s,n)}function sa(e,t,i,r,s,n){return cr(lC(cr(cr(t,e),cr(r,n)),s),i)}function ht(e,t,i,r,s,n,o){return sa(t&i|~t&r,e,t,s,n,o)}function ct(e,t,i,r,s,n,o){return sa(t&r|i&~r,e,t,s,n,o)}function ut(e,t,i,r,s,n,o){return sa(t^i^r,e,t,s,n,o)}function dt(e,t,i,r,s,n,o){return sa(i^(t|~r),e,t,s,n,o)}function cr(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}function lC(e,t){return e<<t|e>>>32-t}});var Sc=ie(na=>{"use strict";Object.defineProperty(na,"__esModule",{value:!0});na.default=void 0;var Up=wp(),zp=Tp(),hC=Pp(),cC=Qp(),uC=Xp();function yn(e){"@babel/helpers - typeof";return yn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yn(e)}function dC(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Wp(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_C(r.key),r)}}function fC(e,t,i){return t&&Wp(e.prototype,t),i&&Wp(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _C(e){var t=pC(e,"string");return yn(t)=="symbol"?t:t+""}function pC(e,t){if(yn(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(yn(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var gC=function(){function e(){dC(this,e),this._algorithms={"AES-ECB":Up.AESECBCipher,"AES-EAX":Up.AESEAXCipher,"DES-ECB":zp.DESECBCipher,"DES-CBC":zp.DESCBCCipher,"RSA-PKCS1-v1_5":hC.RSACipher,DH:cC.DHCipher,MD5:uC.MD5}}return fC(e,[{key:"encrypt",value:function(i,r,s){if(r.algorithm.name!==i.name)throw new Error("algorithm does not match");if(typeof r.encrypt!="function")throw new Error("key does not support encryption");return r.encrypt(i,s)}},{key:"decrypt",value:function(i,r,s){if(r.algorithm.name!==i.name)throw new Error("algorithm does not match");if(typeof r.decrypt!="function")throw new Error("key does not support encryption");return r.decrypt(i,s)}},{key:"importKey",value:function(i,r,s,n,o){if(i!=="raw")throw new Error("key format is not supported");var a=this._algorithms[s.name];if(typeof a>"u"||typeof a.importKey!="function")throw new Error("algorithm is not supported");return a.importKey(r,s,n,o)}},{key:"generateKey",value:function(i,r,s){var n=this._algorithms[i.name];if(typeof n>"u"||typeof n.generateKey!="function")throw new Error("algorithm is not supported");return n.generateKey(i,r,s)}},{key:"exportKey",value:function(i,r){if(i!=="raw")throw new Error("key format is not supported");if(typeof r.exportKey!="function")throw new Error("key does not support exportKey");return r.exportKey()}},{key:"digest",value:function(i,r){var s=this._algorithms[i];if(typeof s!="function")throw new Error("algorithm is not supported");return s(r)}},{key:"deriveBits",value:function(i,r,s){if(r.algorithm.name!==i.name)throw new Error("algorithm does not match");if(typeof r.deriveBits!="function")throw new Error("key does not support deriveBits");return r.deriveBits(i,s)}}])}(),uI=na.default=new gC});var eg=ie(la=>{"use strict";Object.defineProperty(la,"__esModule",{value:!0});la.default=void 0;var $p=mh(),mC=Vp(Ch()),ur=Vp(Sc());function Vp(e){return e&&e.__esModule?e:{default:e}}function vC(e,t,i){return t=aa(t),yC(e,Yp()?Reflect.construct(t,i||[],aa(e).constructor):t.apply(e,i))}function yC(e,t){if(t&&(dr(t)=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return bC(e)}function bC(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Yp(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Yp=function(){return!!e})()}function aa(e){return aa=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},aa(e)}function wC(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Cc(e,t)}function Cc(e,t){return Cc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},Cc(e,t)}function dr(e){"@babel/helpers - typeof";return dr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dr(e)}function Li(){"use strict";Li=function(){return t};var e,t={},i=Object.prototype,r=i.hasOwnProperty,s=Object.defineProperty||function(f,d,p){f[d]=p.value},n=typeof Symbol=="function"?Symbol:{},o=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",h=n.toStringTag||"@@toStringTag";function l(f,d,p){return Object.defineProperty(f,d,{value:p,enumerable:!0,configurable:!0,writable:!0}),f[d]}try{l({},"")}catch{l=function(p,y,A){return p[y]=A}}function c(f,d,p,y){var A=d&&d.prototype instanceof E?d:E,S=Object.create(A.prototype),F=new w(y||[]);return s(S,"_invoke",{value:V(f,p,F)}),S}function u(f,d,p){try{return{type:"normal",arg:f.call(d,p)}}catch(y){return{type:"throw",arg:y}}}t.wrap=c;var g="suspendedStart",_="suspendedYield",m="executing",v="completed",x={};function E(){}function M(){}function D(){}var b={};l(b,o,function(){return this});var L=Object.getPrototypeOf,I=L&&L(L(k([])));I&&I!==i&&r.call(I,o)&&(b=I);var R=D.prototype=E.prototype=Object.create(b);function G(f){["next","throw","return"].forEach(function(d){l(f,d,function(p){return this._invoke(d,p)})})}function W(f,d){function p(A,S,F,U){var $=u(f[A],f,S);if($.type!=="throw"){var z=$.arg,J=z.value;return J&&dr(J)=="object"&&r.call(J,"__await")?d.resolve(J.__await).then(function(ee){p("next",ee,F,U)},function(ee){p("throw",ee,F,U)}):d.resolve(J).then(function(ee){z.value=ee,F(z)},function(ee){return p("throw",ee,F,U)})}U($.arg)}var y;s(this,"_invoke",{value:function(S,F){function U(){return new d(function($,z){p(S,F,$,z)})}return y=y?y.then(U,U):U()}})}function V(f,d,p){var y=g;return function(A,S){if(y===m)throw Error("Generator is already running");if(y===v){if(A==="throw")throw S;return{value:e,done:!0}}for(p.method=A,p.arg=S;;){var F=p.delegate;if(F){var U=q(F,p);if(U){if(U===x)continue;return U}}if(p.method==="next")p.sent=p._sent=p.arg;else if(p.method==="throw"){if(y===g)throw y=v,p.arg;p.dispatchException(p.arg)}else p.method==="return"&&p.abrupt("return",p.arg);y=m;var $=u(f,d,p);if($.type==="normal"){if(y=p.done?v:_,$.arg===x)continue;return{value:$.arg,done:p.done}}$.type==="throw"&&(y=v,p.method="throw",p.arg=$.arg)}}}function q(f,d){var p=d.method,y=f.iterator[p];if(y===e)return d.delegate=null,p==="throw"&&f.iterator.return&&(d.method="return",d.arg=e,q(f,d),d.method==="throw")||p!=="return"&&(d.method="throw",d.arg=new TypeError("The iterator does not provide a '"+p+"' method")),x;var A=u(y,f.iterator,d.arg);if(A.type==="throw")return d.method="throw",d.arg=A.arg,d.delegate=null,x;var S=A.arg;return S?S.done?(d[f.resultName]=S.value,d.next=f.nextLoc,d.method!=="return"&&(d.method="next",d.arg=e),d.delegate=null,x):S:(d.method="throw",d.arg=new TypeError("iterator result is not an object"),d.delegate=null,x)}function ne(f){var d={tryLoc:f[0]};1 in f&&(d.catchLoc=f[1]),2 in f&&(d.finallyLoc=f[2],d.afterLoc=f[3]),this.tryEntries.push(d)}function C(f){var d=f.completion||{};d.type="normal",delete d.arg,f.completion=d}function w(f){this.tryEntries=[{tryLoc:"root"}],f.forEach(ne,this),this.reset(!0)}function k(f){if(f||f===""){var d=f[o];if(d)return d.call(f);if(typeof f.next=="function")return f;if(!isNaN(f.length)){var p=-1,y=function A(){for(;++p<f.length;)if(r.call(f,p))return A.value=f[p],A.done=!1,A;return A.value=e,A.done=!0,A};return y.next=y}}throw new TypeError(dr(f)+" is not iterable")}return M.prototype=D,s(R,"constructor",{value:D,configurable:!0}),s(D,"constructor",{value:M,configurable:!0}),M.displayName=l(D,h,"GeneratorFunction"),t.isGeneratorFunction=function(f){var d=typeof f=="function"&&f.constructor;return!!d&&(d===M||(d.displayName||d.name)==="GeneratorFunction")},t.mark=function(f){return Object.setPrototypeOf?Object.setPrototypeOf(f,D):(f.__proto__=D,l(f,h,"GeneratorFunction")),f.prototype=Object.create(R),f},t.awrap=function(f){return{__await:f}},G(W.prototype),l(W.prototype,a,function(){return this}),t.AsyncIterator=W,t.async=function(f,d,p,y,A){A===void 0&&(A=Promise);var S=new W(c(f,d,p,y),A);return t.isGeneratorFunction(d)?S:S.next().then(function(F){return F.done?F.value:S.next()})},G(R),l(R,h,"Generator"),l(R,o,function(){return this}),l(R,"toString",function(){return"[object Generator]"}),t.keys=function(f){var d=Object(f),p=[];for(var y in d)p.push(y);return p.reverse(),function A(){for(;p.length;){var S=p.pop();if(S in d)return A.value=S,A.done=!1,A}return A.done=!0,A}},t.values=k,w.prototype={constructor:w,reset:function(d){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!d)for(var p in this)p.charAt(0)==="t"&&r.call(this,p)&&!isNaN(+p.slice(1))&&(this[p]=e)},stop:function(){this.done=!0;var d=this.tryEntries[0].completion;if(d.type==="throw")throw d.arg;return this.rval},dispatchException:function(d){if(this.done)throw d;var p=this;function y(z,J){return F.type="throw",F.arg=d,p.next=z,J&&(p.method="next",p.arg=e),!!J}for(var A=this.tryEntries.length-1;A>=0;--A){var S=this.tryEntries[A],F=S.completion;if(S.tryLoc==="root")return y("end");if(S.tryLoc<=this.prev){var U=r.call(S,"catchLoc"),$=r.call(S,"finallyLoc");if(U&&$){if(this.prev<S.catchLoc)return y(S.catchLoc,!0);if(this.prev<S.finallyLoc)return y(S.finallyLoc)}else if(U){if(this.prev<S.catchLoc)return y(S.catchLoc,!0)}else{if(!$)throw Error("try statement without catch or finally");if(this.prev<S.finallyLoc)return y(S.finallyLoc)}}}},abrupt:function(d,p){for(var y=this.tryEntries.length-1;y>=0;--y){var A=this.tryEntries[y];if(A.tryLoc<=this.prev&&r.call(A,"finallyLoc")&&this.prev<A.finallyLoc){var S=A;break}}S&&(d==="break"||d==="continue")&&S.tryLoc<=p&&p<=S.finallyLoc&&(S=null);var F=S?S.completion:{};return F.type=d,F.arg=p,S?(this.method="next",this.next=S.finallyLoc,x):this.complete(F)},complete:function(d,p){if(d.type==="throw")throw d.arg;return d.type==="break"||d.type==="continue"?this.next=d.arg:d.type==="return"?(this.rval=this.arg=d.arg,this.method="return",this.next="end"):d.type==="normal"&&p&&(this.next=p),x},finish:function(d){for(var p=this.tryEntries.length-1;p>=0;--p){var y=this.tryEntries[p];if(y.finallyLoc===d)return this.complete(y.completion,y.afterLoc),C(y),x}},catch:function(d){for(var p=this.tryEntries.length-1;p>=0;--p){var y=this.tryEntries[p];if(y.tryLoc===d){var A=y.completion;if(A.type==="throw"){var S=A.arg;C(y)}return S}}throw Error("illegal catch attempt")},delegateYield:function(d,p,y){return this.delegate={iterator:k(d),resultName:p,nextLoc:y},this.method==="next"&&(this.arg=e),x}},t}function Gp(e,t,i,r,s,n,o){try{var a=e[n](o),h=a.value}catch(l){return void i(l)}a.done?t(h):Promise.resolve(h).then(r,s)}function oa(e){return function(){var t=this,i=arguments;return new Promise(function(r,s){var n=e.apply(t,i);function o(h){Gp(n,r,s,o,a,"next",h)}function a(h){Gp(n,r,s,o,a,"throw",h)}o(void 0)})}}function Jp(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function jp(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,AC(r.key),r)}}function Zp(e,t,i){return t&&jp(e.prototype,t),i&&jp(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function AC(e){var t=xC(e,"string");return dr(t)=="symbol"?t:t+""}function xC(e,t){if(dr(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(dr(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var qp=function(){function e(){Jp(this,e),this._cipher=null,this._counter=new Uint8Array(16)}return Zp(e,[{key:"setKey",value:function(){var t=oa(Li().mark(function r(s){return Li().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,ur.default.importKey("raw",s,{name:"AES-EAX"},!1,["encrypt, decrypt"]);case 2:this._cipher=o.sent;case 3:case"end":return o.stop()}},r,this)}));function i(r){return t.apply(this,arguments)}return i}()},{key:"makeMessage",value:function(){var t=oa(Li().mark(function r(s){var n,o,a,h;return Li().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return n=new Uint8Array([(s.length&65280)>>>8,s.length&255]),c.next=3,ur.default.encrypt({name:"AES-EAX",iv:this._counter,additionalData:n},this._cipher,s);case 3:for(o=c.sent,a=0;a<16&&this._counter[a]++===255;a++);return h=new Uint8Array(s.length+2+16),h.set(n),h.set(o,2),c.abrupt("return",h);case 9:case"end":return c.stop()}},r,this)}));function i(r){return t.apply(this,arguments)}return i}()},{key:"receiveMessage",value:function(){var t=oa(Li().mark(function r(s,n){var o,a,h;return Li().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=new Uint8Array([(s&65280)>>>8,s&255]),c.next=3,ur.default.decrypt({name:"AES-EAX",iv:this._counter,additionalData:o},this._cipher,n);case 3:for(a=c.sent,h=0;h<16&&this._counter[h]++===255;h++);return c.abrupt("return",a);case 6:case"end":return c.stop()}},r,this)}));function i(r,s){return t.apply(this,arguments)}return i}()}])}(),fI=la.default=function(e){function t(i,r){var s;return Jp(this,t),s=vC(this,t),s._hasStarted=!1,s._checkSock=null,s._checkCredentials=null,s._approveServerResolve=null,s._sockReject=null,s._credentialsReject=null,s._approveServerReject=null,s._sock=i,s._getCredentials=r,s}return wC(t,e),Zp(t,[{key:"_waitSockAsync",value:function(r){var s=this;return new Promise(function(n,o){var a=function(){return!s._sock.rQwait("RA2",r)};a()?n():(s._checkSock=function(){a()&&(n(),s._checkSock=null,s._sockReject=null)},s._sockReject=o)})}},{key:"_waitApproveKeyAsync",value:function(){var r=this;return new Promise(function(s,n){r._approveServerResolve=s,r._approveServerReject=n})}},{key:"_waitCredentialsAsync",value:function(r){var s=this,n=function(){return r===1&&s._getCredentials().username!==void 0&&s._getCredentials().password!==void 0?!0:r===2&&s._getCredentials().password!==void 0};return new Promise(function(o,a){n()?o():(s._checkCredentials=function(){n()&&(o(),s._checkCredentials=null,s._credentialsReject=null)},s._credentialsReject=a)})}},{key:"checkInternalEvents",value:function(){this._checkSock!==null&&this._checkSock(),this._checkCredentials!==null&&this._checkCredentials()}},{key:"approveServer",value:function(){this._approveServerResolve!==null&&(this._approveServerResolve(),this._approveServerResolve=null)}},{key:"disconnect",value:function(){this._sockReject!==null&&(this._sockReject(new Error("disconnect normally")),this._sockReject=null),this._credentialsReject!==null&&(this._credentialsReject(new Error("disconnect normally")),this._credentialsReject=null),this._approveServerReject!==null&&(this._approveServerReject(new Error("disconnect normally")),this._approveServerReject=null)}},{key:"negotiateRA2neAuthAsync",value:function(){var i=oa(Li().mark(function s(){var n,o,a,h,l,c,u,g,_,m,v,x,E,M,D,b,L,I,R,G,W,V,q,ne,C,w,k,f,d,p,y,A,S,F,U;return Li().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return this._hasStarted=!0,z.next=3,this._waitSockAsync(4);case 3:if(n=this._sock.rQpeekBytes(4),o=this._sock.rQshift32(),!(o<1024)){z.next=9;break}throw new Error("RA2: server public key is too short: "+o);case 9:if(!(o>8192)){z.next=11;break}throw new Error("RA2: server public key is too long: "+o);case 11:return a=Math.ceil(o/8),z.next=14,this._waitSockAsync(a*2);case 14:return h=this._sock.rQshiftBytes(a),l=this._sock.rQshiftBytes(a),z.next=18,ur.default.importKey("raw",{n:h,e:l},{name:"RSA-PKCS1-v1_5"},!1,["encrypt"]);case 18:return c=z.sent,u=new Uint8Array(4+a*2),u.set(n),u.set(h,4),u.set(l,4+a),g=this._waitApproveKeyAsync(),this.dispatchEvent(new CustomEvent("serververification",{detail:{type:"RSA",publickey:u}})),z.next=27,g;case 27:return _=2048,m=Math.ceil(_/8),z.next=31,ur.default.generateKey({name:"RSA-PKCS1-v1_5",modulusLength:_,publicExponent:new Uint8Array([1,0,1])},!0,["encrypt"]);case 31:return v=z.sent.privateKey,z.next=34,ur.default.exportKey("raw",v);case 34:return x=z.sent,E=x.n,M=x.e,D=new Uint8Array(4+m*2),D[0]=(_&4278190080)>>>24,D[1]=(_&16711680)>>>16,D[2]=(_&65280)>>>8,D[3]=_&255,D.set(E,4),D.set(M,4+m),this._sock.sQpushBytes(D),this._sock.flush(),b=new Uint8Array(16),window.crypto.getRandomValues(b),z.next=50,ur.default.encrypt({name:"RSA-PKCS1-v1_5"},c,b);case 50:return L=z.sent,I=new Uint8Array(2+a),I[0]=(a&65280)>>>8,I[1]=a&255,I.set(L,2),this._sock.sQpushBytes(I),this._sock.flush(),z.next=59,this._waitSockAsync(2);case 59:if(this._sock.rQshift16()===m){z.next=61;break}throw new Error("RA2: wrong encrypted message length");case 61:return R=this._sock.rQshiftBytes(m),z.next=64,ur.default.decrypt({name:"RSA-PKCS1-v1_5"},v,R);case 64:if(G=z.sent,!(G===null||G.length!==16)){z.next=67;break}throw new Error("RA2: corrupted server encrypted random");case 67:return W=new Uint8Array(32),V=new Uint8Array(32),W.set(G),W.set(b,16),V.set(b),V.set(G,16),z.next=75,window.crypto.subtle.digest("SHA-1",W);case 75:return W=z.sent,W=new Uint8Array(W).slice(0,16),z.next=79,window.crypto.subtle.digest("SHA-1",V);case 79:return V=z.sent,V=new Uint8Array(V).slice(0,16),q=new qp,z.next=84,q.setKey(W);case 84:return ne=new qp,z.next=87,ne.setKey(V);case 87:return C=new Uint8Array(8+a*2+m*2),w=new Uint8Array(8+a*2+m*2),C.set(u),C.set(D,4+a*2),w.set(D),w.set(u,4+m*2),z.next=95,window.crypto.subtle.digest("SHA-1",C);case 95:return C=z.sent,z.next=98,window.crypto.subtle.digest("SHA-1",w);case 98:return w=z.sent,C=new Uint8Array(C),w=new Uint8Array(w),z.t0=this._sock,z.next=104,q.makeMessage(w);case 104:return z.t1=z.sent,z.t0.sQpushBytes.call(z.t0,z.t1),this._sock.flush(),z.next=109,this._waitSockAsync(38);case 109:if(this._sock.rQshift16()===20){z.next=111;break}throw new Error("RA2: wrong server hash");case 111:return z.next=113,ne.receiveMessage(20,this._sock.rQshiftBytes(36));case 113:if(k=z.sent,k!==null){z.next=116;break}throw new Error("RA2: failed to authenticate the message");case 116:f=0;case 117:if(!(f<20)){z.next=123;break}if(k[f]===C[f]){z.next=120;break}throw new Error("RA2: wrong server hash");case 120:f++,z.next=117;break;case 123:return z.next=125,this._waitSockAsync(19);case 125:if(this._sock.rQshift16()===1){z.next=127;break}throw new Error("RA2: wrong subtype");case 127:return z.next=129,ne.receiveMessage(1,this._sock.rQshiftBytes(17));case 129:if(d=z.sent,d!==null){z.next=132;break}throw new Error("RA2: failed to authenticate the message");case 132:if(d=d[0],p=this._waitCredentialsAsync(d),d!==1){z.next=138;break}(this._getCredentials().username===void 0||this._getCredentials().password===void 0)&&this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["username","password"]}})),z.next=143;break;case 138:if(d!==2){z.next=142;break}this._getCredentials().password===void 0&&this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["password"]}})),z.next=143;break;case 142:throw new Error("RA2: wrong subtype");case 143:return z.next=145,p;case 145:for(d===1?y=(0,$p.encodeUTF8)(this._getCredentials().username).slice(0,255):y="",A=(0,$p.encodeUTF8)(this._getCredentials().password).slice(0,255),S=new Uint8Array(y.length+A.length+2),S[0]=y.length,S[y.length+1]=A.length,F=0;F<y.length;F++)S[F+1]=y.charCodeAt(F);for(U=0;U<A.length;U++)S[y.length+2+U]=A.charCodeAt(U);return z.t2=this._sock,z.next=155,q.makeMessage(S);case 155:z.t3=z.sent,z.t2.sQpushBytes.call(z.t2,z.t3),this._sock.flush();case 158:case"end":return z.stop()}},s,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"hasStarted",get:function(){return this._hasStarted},set:function(r){this._hasStarted=r}}])}(mC.default)});var ig=ie(ha=>{"use strict";Object.defineProperty(ha,"__esModule",{value:!0});ha.default=void 0;function bn(e){"@babel/helpers - typeof";return bn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bn(e)}function SC(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function tg(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,kC(r.key),r)}}function CC(e,t,i){return t&&tg(e.prototype,t),i&&tg(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function kC(e){var t=EC(e,"string");return bn(t)=="symbol"?t:t+""}function EC(e,t){if(bn(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(bn(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var pI=ha.default=function(){function e(){SC(this,e),this._lines=0}return CC(e,[{key:"decodeRect",value:function(i,r,s,n,o,a,h){if(s===0||n===0)return!0;this._lines===0&&(this._lines=n);for(var l=h==8?1:4,c=s*l;this._lines>0;){if(o.rQwait("RAW",c))return!1;var u=r+(n-this._lines),g=o.rQshiftBytes(c,!1);if(h==8){for(var _=new Uint8Array(s*4),m=0;m<s;m++)_[m*4+0]=(g[m]>>0&3)*255/3,_[m*4+1]=(g[m]>>2&3)*255/3,_[m*4+2]=(g[m]>>4&3)*255/3,_[m*4+3]=255;g=_}for(var v=0;v<s;v++)g[v*4+3]=255;a.blitImage(i,u,s,1,g,0),this._lines--}return!0}}])}()});var sg=ie(ca=>{"use strict";Object.defineProperty(ca,"__esModule",{value:!0});ca.default=void 0;function wn(e){"@babel/helpers - typeof";return wn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wn(e)}function BC(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function rg(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,DC(r.key),r)}}function LC(e,t,i){return t&&rg(e.prototype,t),i&&rg(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function DC(e){var t=IC(e,"string");return wn(t)=="symbol"?t:t+""}function IC(e,t){if(wn(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(wn(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var mI=ca.default=function(){function e(){BC(this,e)}return LC(e,[{key:"decodeRect",value:function(i,r,s,n,o,a,h){if(o.rQwait("COPYRECT",4))return!1;var l=o.rQshift16(),c=o.rQshift16();return s===0||n===0||a.copyImage(l,c,i,r,s,n),!0}}])}()});var og=ie(ua=>{"use strict";Object.defineProperty(ua,"__esModule",{value:!0});ua.default=void 0;function An(e){"@babel/helpers - typeof";return An=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},An(e)}function MC(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ng(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,RC(r.key),r)}}function TC(e,t,i){return t&&ng(e.prototype,t),i&&ng(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function RC(e){var t=FC(e,"string");return An(t)=="symbol"?t:t+""}function FC(e,t){if(An(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(An(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var yI=ua.default=function(){function e(){MC(this,e),this._subrects=0}return TC(e,[{key:"decodeRect",value:function(i,r,s,n,o,a,h){if(this._subrects===0){if(o.rQwait("RRE",8))return!1;this._subrects=o.rQshift32();var l=o.rQshiftBytes(4);a.fillRect(i,r,s,n,l)}for(;this._subrects>0;){if(o.rQwait("RRE",12))return!1;var c=o.rQshiftBytes(4),u=o.rQshift16(),g=o.rQshift16(),_=o.rQshift16(),m=o.rQshift16();a.fillRect(i+u,r+g,_,m,c),this._subrects--}return!0}}])}()});var hg=ie(da=>{"use strict";Object.defineProperty(da,"__esModule",{value:!0});da.default=void 0;var PC=OC(Ci());function lg(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(lg=function(s){return s?i:t})(e)}function OC(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||ms(e)!="object"&&typeof e!="function")return{default:e};var i=lg(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&{}.hasOwnProperty.call(e,n)){var o=s?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}function ms(e){"@babel/helpers - typeof";return ms=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ms(e)}function KC(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ag(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,QC(r.key),r)}}function NC(e,t,i){return t&&ag(e.prototype,t),i&&ag(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function QC(e){var t=HC(e,"string");return ms(t)=="symbol"?t:t+""}function HC(e,t){if(ms(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(ms(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var wI=da.default=function(){function e(){KC(this,e),this._tiles=0,this._lastsubencoding=0,this._tileBuffer=new Uint8Array(16*16*4)}return NC(e,[{key:"decodeRect",value:function(i,r,s,n,o,a,h){for(this._tiles===0&&(this._tilesX=Math.ceil(s/16),this._tilesY=Math.ceil(n/16),this._totalTiles=this._tilesX*this._tilesY,this._tiles=this._totalTiles);this._tiles>0;){var l=1;if(o.rQwait("HEXTILE",l))return!1;var c=o.rQpeek8();if(c>30)throw new Error("Illegal hextile subencoding (subencoding: "+c+")");var u=this._totalTiles-this._tiles,g=u%this._tilesX,_=Math.floor(u/this._tilesX),m=i+g*16,v=r+_*16,x=Math.min(16,i+s-m),E=Math.min(16,r+n-v);if(c&1)l+=x*E*4;else if(c&2&&(l+=4),c&4&&(l+=4),c&8){if(l++,o.rQwait("HEXTILE",l))return!1;var M=o.rQpeekBytes(l).at(-1);c&16?l+=M*6:l+=M*2}if(o.rQwait("HEXTILE",l))return!1;if(o.rQshift8(),c===0)this._lastsubencoding&1?PC.Debug("     Ignoring blank after RAW"):a.fillRect(m,v,x,E,this._background);else if(c&1){for(var D=x*E,b=o.rQshiftBytes(D*4,!1),L=0;L<D;L++)b[L*4+3]=255;a.blitImage(m,v,x,E,b,0)}else{if(c&2&&(this._background=new Uint8Array(o.rQshiftBytes(4))),c&4&&(this._foreground=new Uint8Array(o.rQshiftBytes(4))),this._startTile(m,v,x,E,this._background),c&8)for(var I=o.rQshift8(),R=0;R<I;R++){var G=void 0;c&16?G=o.rQshiftBytes(4):G=this._foreground;var W=o.rQshift8(),V=W>>4,q=W&15,ne=o.rQshift8(),C=(ne>>4)+1,w=(ne&15)+1;this._subTile(V,q,C,w,G)}this._finishTile(a)}this._lastsubencoding=c,this._tiles--}return!0}},{key:"_startTile",value:function(i,r,s,n,o){this._tileX=i,this._tileY=r,this._tileW=s,this._tileH=n;for(var a=o[0],h=o[1],l=o[2],c=this._tileBuffer,u=0;u<s*n*4;u+=4)c[u]=a,c[u+1]=h,c[u+2]=l,c[u+3]=255}},{key:"_subTile",value:function(i,r,s,n,o){for(var a=o[0],h=o[1],l=o[2],c=i+s,u=r+n,g=this._tileBuffer,_=this._tileW,m=r;m<u;m++)for(var v=i;v<c;v++){var x=(v+m*_)*4;g[x]=a,g[x+1]=h,g[x+2]=l,g[x+3]=255}}},{key:"_finishTile",value:function(i){i.blitImage(this._tileX,this._tileY,this._tileW,this._tileH,this._tileBuffer,0)}}])}()});var kc=ie(fa=>{"use strict";Object.defineProperty(fa,"__esModule",{value:!0});fa.default=void 0;var XC=WC(Ci()),UC=zC(Do());function zC(e){return e&&e.__esModule?e:{default:e}}function ug(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(ug=function(s){return s?i:t})(e)}function WC(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||vs(e)!="object"&&typeof e!="function")return{default:e};var i=ug(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&{}.hasOwnProperty.call(e,n)){var o=s?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}function vs(e){"@babel/helpers - typeof";return vs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vs(e)}function $C(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function cg(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,jC(r.key),r)}}function GC(e,t,i){return t&&cg(e.prototype,t),i&&cg(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function jC(e){var t=qC(e,"string");return vs(t)=="symbol"?t:t+""}function qC(e,t){if(vs(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(vs(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var xI=fa.default=function(){function e(){$C(this,e),this._ctl=null,this._filter=null,this._numColors=0,this._palette=new Uint8Array(1024),this._len=0,this._zlibs=[];for(var t=0;t<4;t++)this._zlibs[t]=new UC.default}return GC(e,[{key:"decodeRect",value:function(i,r,s,n,o,a,h){if(this._ctl===null){if(o.rQwait("TIGHT compression-control",1))return!1;this._ctl=o.rQshift8();for(var l=0;l<4;l++)this._ctl>>l&1&&(this._zlibs[l].reset(),XC.Info("Reset zlib stream "+l));this._ctl=this._ctl>>4}var c;if(this._ctl===8)c=this._fillRect(i,r,s,n,o,a,h);else if(this._ctl===9)c=this._jpegRect(i,r,s,n,o,a,h);else if(this._ctl===10)c=this._pngRect(i,r,s,n,o,a,h);else if((this._ctl&8)==0)c=this._basicRect(this._ctl,i,r,s,n,o,a,h);else throw new Error("Illegal tight compression received (ctl: "+this._ctl+")");return c&&(this._ctl=null),c}},{key:"_fillRect",value:function(i,r,s,n,o,a,h){if(o.rQwait("TIGHT",3))return!1;var l=o.rQshiftBytes(3);return a.fillRect(i,r,s,n,l,!1),!0}},{key:"_jpegRect",value:function(i,r,s,n,o,a,h){var l=this._readData(o);return l===null?!1:(a.imageRect(i,r,s,n,"image/jpeg",l),!0)}},{key:"_pngRect",value:function(i,r,s,n,o,a,h){throw new Error("PNG received in standard Tight rect")}},{key:"_basicRect",value:function(i,r,s,n,o,a,h,l){if(this._filter===null)if(i&4){if(a.rQwait("TIGHT",1))return!1;this._filter=a.rQshift8()}else this._filter=0;var c=i&3,u;switch(this._filter){case 0:u=this._copyFilter(c,r,s,n,o,a,h,l);break;case 1:u=this._paletteFilter(c,r,s,n,o,a,h,l);break;case 2:u=this._gradientFilter(c,r,s,n,o,a,h,l);break;default:throw new Error("Illegal tight filter received (ctl: "+this._filter+")")}return u&&(this._filter=null),u}},{key:"_copyFilter",value:function(i,r,s,n,o,a,h,l){var c=n*o*3,u;if(c===0)return!0;if(c<12){if(a.rQwait("TIGHT",c))return!1;u=a.rQshiftBytes(c)}else{if(u=this._readData(a),u===null)return!1;this._zlibs[i].setInput(u),u=this._zlibs[i].inflate(c),this._zlibs[i].setInput(null)}for(var g=new Uint8Array(n*o*4),_=0,m=0;_<n*o*4;_+=4,m+=3)g[_]=u[m],g[_+1]=u[m+1],g[_+2]=u[m+2],g[_+3]=255;return h.blitImage(r,s,n,o,g,0,!1),!0}},{key:"_paletteFilter",value:function(i,r,s,n,o,a,h,l){if(this._numColors===0){if(a.rQwait("TIGHT palette",1))return!1;var c=a.rQpeek8()+1,u=c*3;if(a.rQwait("TIGHT palette",1+u))return!1;this._numColors=c,a.rQskipBytes(1),a.rQshiftTo(this._palette,u)}var g=this._numColors<=2?1:8,_=Math.floor((n*g+7)/8),m=_*o,v;if(m===0)return!0;if(m<12){if(a.rQwait("TIGHT",m))return!1;v=a.rQshiftBytes(m)}else{if(v=this._readData(a),v===null)return!1;this._zlibs[i].setInput(v),v=this._zlibs[i].inflate(m),this._zlibs[i].setInput(null)}return this._numColors==2?this._monoRect(r,s,n,o,v,this._palette,h):this._paletteRect(r,s,n,o,v,this._palette,h),this._numColors=0,!0}},{key:"_monoRect",value:function(i,r,s,n,o,a,h){for(var l=this._getScratchBuffer(s*n*4),c=Math.floor((s+7)/8),u=Math.floor(s/8),g=0;g<n;g++){var _=void 0,m=void 0,v=void 0;for(v=0;v<u;v++)for(var x=7;x>=0;x--)_=(g*s+v*8+7-x)*4,m=(o[g*c+v]>>x&1)*3,l[_]=a[m],l[_+1]=a[m+1],l[_+2]=a[m+2],l[_+3]=255;for(var E=7;E>=8-s%8;E--)_=(g*s+v*8+7-E)*4,m=(o[g*c+v]>>E&1)*3,l[_]=a[m],l[_+1]=a[m+1],l[_+2]=a[m+2],l[_+3]=255}h.blitImage(i,r,s,n,l,0,!1)}},{key:"_paletteRect",value:function(i,r,s,n,o,a,h){for(var l=this._getScratchBuffer(s*n*4),c=s*n*4,u=0,g=0;u<c;u+=4,g++){var _=o[g]*3;l[u]=a[_],l[u+1]=a[_+1],l[u+2]=a[_+2],l[u+3]=255}h.blitImage(i,r,s,n,l,0,!1)}},{key:"_gradientFilter",value:function(i,r,s,n,o,a,h,l){var c=n*o*3,u;if(c===0)return!0;if(c<12){if(a.rQwait("TIGHT",c))return!1;u=a.rQshiftBytes(c)}else{if(u=this._readData(a),u===null)return!1;this._zlibs[i].setInput(u),u=this._zlibs[i].inflate(c),this._zlibs[i].setInput(null)}for(var g=new Uint8Array(4*n*o),_=0,m=0,v=new Uint8Array(3),x=0;x<n;x++){for(var E=0;E<3;E++){var M=v[E],D=u[m++]+M;g[_++]=D,v[E]=D}g[_++]=255}for(var b=0,L=new Uint8Array(3),I=new Uint8Array(3),R=1;R<o;R++){v.fill(0),I.fill(0);for(var G=0;G<n;G++){for(var W=0;W<3;W++){L[W]=g[b++];var V=v[W]+L[W]-I[W];V<0?V=0:V>255&&(V=255);var q=u[m++]+V;g[_++]=q,I[W]=L[W],v[W]=q}g[_++]=255,b++}}return h.blitImage(r,s,n,o,g,0,!1),!0}},{key:"_readData",value:function(i){if(this._len===0){if(i.rQwait("TIGHT",3))return null;var r;r=i.rQshift8(),this._len=r&127,r&128&&(r=i.rQshift8(),this._len|=(r&127)<<7,r&128&&(r=i.rQshift8(),this._len|=r<<14))}if(i.rQwait("TIGHT",this._len))return null;var s=i.rQshiftBytes(this._len,!1);return this._len=0,s}},{key:"_getScratchBuffer",value:function(i){return(!this._scratchBuffer||this._scratchBuffer.length<i)&&(this._scratchBuffer=new Uint8Array(i)),this._scratchBuffer}}])}()});var _g=ie(pa=>{"use strict";function ys(e){"@babel/helpers - typeof";return ys=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ys(e)}Object.defineProperty(pa,"__esModule",{value:!0});pa.default=void 0;var VC=YC(kc());function YC(e){return e&&e.__esModule?e:{default:e}}function JC(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function dg(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,e2(r.key),r)}}function ZC(e,t,i){return t&&dg(e.prototype,t),i&&dg(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function e2(e){var t=t2(e,"string");return ys(t)=="symbol"?t:t+""}function t2(e,t){if(ys(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(ys(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function i2(e,t,i){return t=_a(t),r2(e,fg()?Reflect.construct(t,i||[],_a(e).constructor):t.apply(e,i))}function r2(e,t){if(t&&(ys(t)=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return s2(e)}function s2(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fg(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(fg=function(){return!!e})()}function _a(e){return _a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_a(e)}function n2(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ec(e,t)}function Ec(e,t){return Ec=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},Ec(e,t)}var CI=pa.default=function(e){function t(){return JC(this,t),i2(this,t,arguments)}return n2(t,e),ZC(t,[{key:"_pngRect",value:function(r,s,n,o,a,h,l){var c=this._readData(a);return c===null?!1:(h.imageRect(r,s,n,o,"image/png",c),!0)}},{key:"_basicRect",value:function(r,s,n,o,a,h,l,c){throw new Error("BasicCompression received in TightPNG rect")}}])}(VC.default)});var gg=ie(va=>{"use strict";Object.defineProperty(va,"__esModule",{value:!0});va.default=void 0;var o2=a2(Do());function a2(e){return e&&e.__esModule?e:{default:e}}function xn(e){"@babel/helpers - typeof";return xn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xn(e)}function l2(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function pg(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,c2(r.key),r)}}function h2(e,t,i){return t&&pg(e.prototype,t),i&&pg(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function c2(e){var t=u2(e,"string");return xn(t)=="symbol"?t:t+""}function u2(e,t){if(xn(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(xn(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var ga=64,ma=64,EI=va.default=function(){function e(){l2(this,e),this._length=0,this._inflator=new o2.default,this._pixelBuffer=new Uint8Array(ga*ma*4),this._tileBuffer=new Uint8Array(ga*ma*4)}return h2(e,[{key:"decodeRect",value:function(i,r,s,n,o,a,h){if(this._length===0){if(o.rQwait("ZLib data length",4))return!1;this._length=o.rQshift32()}if(o.rQwait("Zlib data",this._length))return!1;var l=o.rQshiftBytes(this._length,!1);this._inflator.setInput(l);for(var c=r;c<r+n;c+=ma)for(var u=Math.min(ma,r+n-c),g=i;g<i+s;g+=ga){var _=Math.min(ga,i+s-g),m=_*u,v=this._inflator.inflate(1)[0];if(v===0){var x=this._readPixels(m);a.blitImage(g,c,_,u,x,0,!1)}else if(v===1){var E=this._readPixels(1);a.fillRect(g,c,_,u,[E[0],E[1],E[2]])}else if(v>=2&&v<=16){var M=this._decodePaletteTile(v,m,_,u);a.blitImage(g,c,_,u,M,0,!1)}else if(v===128){var D=this._decodeRLETile(m);a.blitImage(g,c,_,u,D,0,!1)}else if(v>=130&&v<=255){var b=this._decodeRLEPaletteTile(v-128,m);a.blitImage(g,c,_,u,b,0,!1)}else throw new Error("Unknown subencoding: "+v)}return this._length=0,!0}},{key:"_getBitsPerPixelInPalette",value:function(i){if(i<=2)return 1;if(i<=4)return 2;if(i<=16)return 4}},{key:"_readPixels",value:function(i){for(var r=this._pixelBuffer,s=this._inflator.inflate(3*i),n=0,o=0;n<i*4;n+=4,o+=3)r[n]=s[o],r[n+1]=s[o+1],r[n+2]=s[o+2],r[n+3]=255;return r}},{key:"_decodePaletteTile",value:function(i,r,s,n){for(var o=this._tileBuffer,a=this._readPixels(i),h=this._getBitsPerPixelInPalette(i),l=(1<<h)-1,c=0,u=this._inflator.inflate(1)[0],g=0;g<n;g++){for(var _=8-h,m=0;m<s;m++){_<0&&(_=8-h,u=this._inflator.inflate(1)[0]);var v=u>>_&l;o[c]=a[v*4],o[c+1]=a[v*4+1],o[c+2]=a[v*4+2],o[c+3]=a[v*4+3],c+=4,_-=h}_<8-h&&g<n-1&&(u=this._inflator.inflate(1)[0])}return o}},{key:"_decodeRLETile",value:function(i){for(var r=this._tileBuffer,s=0;s<i;)for(var n=this._readPixels(1),o=this._readRLELength(),a=0;a<o;a++)r[s*4]=n[0],r[s*4+1]=n[1],r[s*4+2]=n[2],r[s*4+3]=n[3],s++;return r}},{key:"_decodeRLEPaletteTile",value:function(i,r){for(var s=this._tileBuffer,n=this._readPixels(i),o=0;o<r;){var a=this._inflator.inflate(1)[0],h=1;if(a>=128&&(a-=128,h=this._readRLELength()),a>i)throw new Error("Too big index in palette: "+a+", palette size: "+i);if(o+h>r)throw new Error("Too big rle length in palette mode: "+h+", allowed length is: "+(r-o));for(var l=0;l<h;l++)s[o*4]=n[a*4],s[o*4+1]=n[a*4+1],s[o*4+2]=n[a*4+2],s[o*4+3]=n[a*4+3],o++}return s}},{key:"_readRLELength",value:function(){var i=0,r=0;do r=this._inflator.inflate(1)[0],i+=r;while(r===255);return i+1}}])}()});var bg=ie(ya=>{"use strict";Object.defineProperty(ya,"__esModule",{value:!0});ya.default=void 0;function Sn(e){"@babel/helpers - typeof";return Sn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Sn(e)}function mg(e){return _2(e)||f2(e)||yg(e)||d2()}function d2(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function f2(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function _2(e){if(Array.isArray(e))return Lc(e)}function Bc(e,t){var i=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=yg(e))||t&&e&&typeof e.length=="number"){i&&(e=i);var r=0,s=function(){};return{s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(l){throw l},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var n,o=!0,a=!1;return{s:function(){i=i.call(e)},n:function(){var l=i.next();return o=l.done,l},e:function(l){a=!0,n=l},f:function(){try{o||i.return==null||i.return()}finally{if(a)throw n}}}}function yg(e,t){if(e){if(typeof e=="string")return Lc(e,t);var i={}.toString.call(e).slice(8,-1);return i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set"?Array.from(e):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Lc(e,t):void 0}}function Lc(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,r=Array(t);i<t;i++)r[i]=e[i];return r}function p2(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function vg(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,m2(r.key),r)}}function g2(e,t,i){return t&&vg(e.prototype,t),i&&vg(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function m2(e){var t=v2(e,"string");return Sn(t)=="symbol"?t:t+""}function v2(e,t){if(Sn(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(Sn(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var LI=ya.default=function(){function e(){p2(this,e),this._cachedQuantTables=[],this._cachedHuffmanTables=[],this._segments=[]}return g2(e,[{key:"decodeRect",value:function(i,r,s,n,o,a,h){for(;;){var l=this._readSegment(o);if(l===null)return!1;if(this._segments.push(l),l[1]===217)break}var c=[],u=[],g=Bc(this._segments),_;try{for(g.s();!(_=g.n()).done;){var m=_.value,v=m[1];v===196?c.push(m):v===219&&u.push(m)}}catch(q){g.e(q)}finally{g.f()}var x=this._segments.findIndex(function(q){return q[1]==192||q[1]==194});if(x==-1)throw new Error("Illegal JPEG image without SOF");if(u.length===0){var E;(E=this._segments).splice.apply(E,[x+1,0].concat(mg(this._cachedQuantTables)))}if(c.length===0){var M;(M=this._segments).splice.apply(M,[x+1,0].concat(mg(this._cachedHuffmanTables)))}var D=0,b=Bc(this._segments),L;try{for(b.s();!(L=b.n()).done;){var I=L.value;D+=I.length}}catch(q){b.e(q)}finally{b.f()}var R=new Uint8Array(D);D=0;var G=Bc(this._segments),W;try{for(G.s();!(W=G.n()).done;){var V=W.value;R.set(V,D),D+=V.length}}catch(q){G.e(q)}finally{G.f()}return a.imageRect(i,r,s,n,"image/jpeg",R),c.length!==0&&(this._cachedHuffmanTables=c),u.length!==0&&(this._cachedQuantTables=u),this._segments=[],!0}},{key:"_readSegment",value:function(i){if(i.rQwait("JPEG",2))return null;var r=i.rQshift8();if(r!=255)throw new Error("Illegal JPEG marker received (byte: "+r+")");var s=i.rQshift8();if(s>=208&&s<=217||s==1)return new Uint8Array([r,s]);if(i.rQwait("JPEG",2,2))return null;var n=i.rQshift16();if(n<2)throw new Error("Illegal JPEG length received (length: "+n+")");if(i.rQwait("JPEG",n-2,4))return null;var o=0;if(s===218)for(o+=2;;){if(i.rQwait("JPEG",n-2+o,4))return null;var a=i.rQpeekBytes(n-2+o,!1);if(a.at(-2)===255&&a.at(-1)!==0&&!(a.at(-1)>=208&&a.at(-1)<=215)){o-=2;break}o++}var h=new Uint8Array(2+n+o);return h[0]=r,h[1]=s,h[2]=n>>8,h[3]=n,h.set(i.rQshiftBytes(n-2+o,!1),4),h}}])}()});var Xg=ie(Sa=>{"use strict";function Di(e){"@babel/helpers - typeof";return Di=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Di(e)}Object.defineProperty(Sa,"__esModule",{value:!0});Sa.default=void 0;var Kg=ph(),te=K2(Ci()),ci=mh(),wg=Xs(),Cn=r_(),y2=Sh(),b2=Ke(Ch()),w2=Ke(d_()),A2=Ke(Do()),x2=Ke(X0()),S2=Ke(ip()),C2=Ke(op()),k2=Ke(hp()),E2=Ke(_p()),Xt=Ke(us()),B2=Ke(pp()),le=gp(),L2=Ke(eg()),xt=Ke(Sc()),D2=Ke(ig()),I2=Ke(sg()),M2=Ke(og()),T2=Ke(hg()),R2=Ke(kc()),F2=Ke(_g()),P2=Ke(gg()),O2=Ke(bg());function Ke(e){return e&&e.__esModule?e:{default:e}}function Ng(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(Ng=function(s){return s?i:t})(e)}function K2(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||Di(e)!="object"&&typeof e!="function")return{default:e};var i=Ng(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&{}.hasOwnProperty.call(e,n)){var o=s?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}function Mc(){"use strict";Mc=function(){return t};var e,t={},i=Object.prototype,r=i.hasOwnProperty,s=Object.defineProperty||function(f,d,p){f[d]=p.value},n=typeof Symbol=="function"?Symbol:{},o=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",h=n.toStringTag||"@@toStringTag";function l(f,d,p){return Object.defineProperty(f,d,{value:p,enumerable:!0,configurable:!0,writable:!0}),f[d]}try{l({},"")}catch{l=function(p,y,A){return p[y]=A}}function c(f,d,p,y){var A=d&&d.prototype instanceof E?d:E,S=Object.create(A.prototype),F=new w(y||[]);return s(S,"_invoke",{value:V(f,p,F)}),S}function u(f,d,p){try{return{type:"normal",arg:f.call(d,p)}}catch(y){return{type:"throw",arg:y}}}t.wrap=c;var g="suspendedStart",_="suspendedYield",m="executing",v="completed",x={};function E(){}function M(){}function D(){}var b={};l(b,o,function(){return this});var L=Object.getPrototypeOf,I=L&&L(L(k([])));I&&I!==i&&r.call(I,o)&&(b=I);var R=D.prototype=E.prototype=Object.create(b);function G(f){["next","throw","return"].forEach(function(d){l(f,d,function(p){return this._invoke(d,p)})})}function W(f,d){function p(A,S,F,U){var $=u(f[A],f,S);if($.type!=="throw"){var z=$.arg,J=z.value;return J&&Di(J)=="object"&&r.call(J,"__await")?d.resolve(J.__await).then(function(ee){p("next",ee,F,U)},function(ee){p("throw",ee,F,U)}):d.resolve(J).then(function(ee){z.value=ee,F(z)},function(ee){return p("throw",ee,F,U)})}U($.arg)}var y;s(this,"_invoke",{value:function(S,F){function U(){return new d(function($,z){p(S,F,$,z)})}return y=y?y.then(U,U):U()}})}function V(f,d,p){var y=g;return function(A,S){if(y===m)throw Error("Generator is already running");if(y===v){if(A==="throw")throw S;return{value:e,done:!0}}for(p.method=A,p.arg=S;;){var F=p.delegate;if(F){var U=q(F,p);if(U){if(U===x)continue;return U}}if(p.method==="next")p.sent=p._sent=p.arg;else if(p.method==="throw"){if(y===g)throw y=v,p.arg;p.dispatchException(p.arg)}else p.method==="return"&&p.abrupt("return",p.arg);y=m;var $=u(f,d,p);if($.type==="normal"){if(y=p.done?v:_,$.arg===x)continue;return{value:$.arg,done:p.done}}$.type==="throw"&&(y=v,p.method="throw",p.arg=$.arg)}}}function q(f,d){var p=d.method,y=f.iterator[p];if(y===e)return d.delegate=null,p==="throw"&&f.iterator.return&&(d.method="return",d.arg=e,q(f,d),d.method==="throw")||p!=="return"&&(d.method="throw",d.arg=new TypeError("The iterator does not provide a '"+p+"' method")),x;var A=u(y,f.iterator,d.arg);if(A.type==="throw")return d.method="throw",d.arg=A.arg,d.delegate=null,x;var S=A.arg;return S?S.done?(d[f.resultName]=S.value,d.next=f.nextLoc,d.method!=="return"&&(d.method="next",d.arg=e),d.delegate=null,x):S:(d.method="throw",d.arg=new TypeError("iterator result is not an object"),d.delegate=null,x)}function ne(f){var d={tryLoc:f[0]};1 in f&&(d.catchLoc=f[1]),2 in f&&(d.finallyLoc=f[2],d.afterLoc=f[3]),this.tryEntries.push(d)}function C(f){var d=f.completion||{};d.type="normal",delete d.arg,f.completion=d}function w(f){this.tryEntries=[{tryLoc:"root"}],f.forEach(ne,this),this.reset(!0)}function k(f){if(f||f===""){var d=f[o];if(d)return d.call(f);if(typeof f.next=="function")return f;if(!isNaN(f.length)){var p=-1,y=function A(){for(;++p<f.length;)if(r.call(f,p))return A.value=f[p],A.done=!1,A;return A.value=e,A.done=!0,A};return y.next=y}}throw new TypeError(Di(f)+" is not iterable")}return M.prototype=D,s(R,"constructor",{value:D,configurable:!0}),s(D,"constructor",{value:M,configurable:!0}),M.displayName=l(D,h,"GeneratorFunction"),t.isGeneratorFunction=function(f){var d=typeof f=="function"&&f.constructor;return!!d&&(d===M||(d.displayName||d.name)==="GeneratorFunction")},t.mark=function(f){return Object.setPrototypeOf?Object.setPrototypeOf(f,D):(f.__proto__=D,l(f,h,"GeneratorFunction")),f.prototype=Object.create(R),f},t.awrap=function(f){return{__await:f}},G(W.prototype),l(W.prototype,a,function(){return this}),t.AsyncIterator=W,t.async=function(f,d,p,y,A){A===void 0&&(A=Promise);var S=new W(c(f,d,p,y),A);return t.isGeneratorFunction(d)?S:S.next().then(function(F){return F.done?F.value:S.next()})},G(R),l(R,h,"Generator"),l(R,o,function(){return this}),l(R,"toString",function(){return"[object Generator]"}),t.keys=function(f){var d=Object(f),p=[];for(var y in d)p.push(y);return p.reverse(),function A(){for(;p.length;){var S=p.pop();if(S in d)return A.value=S,A.done=!1,A}return A.done=!0,A}},t.values=k,w.prototype={constructor:w,reset:function(d){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!d)for(var p in this)p.charAt(0)==="t"&&r.call(this,p)&&!isNaN(+p.slice(1))&&(this[p]=e)},stop:function(){this.done=!0;var d=this.tryEntries[0].completion;if(d.type==="throw")throw d.arg;return this.rval},dispatchException:function(d){if(this.done)throw d;var p=this;function y(z,J){return F.type="throw",F.arg=d,p.next=z,J&&(p.method="next",p.arg=e),!!J}for(var A=this.tryEntries.length-1;A>=0;--A){var S=this.tryEntries[A],F=S.completion;if(S.tryLoc==="root")return y("end");if(S.tryLoc<=this.prev){var U=r.call(S,"catchLoc"),$=r.call(S,"finallyLoc");if(U&&$){if(this.prev<S.catchLoc)return y(S.catchLoc,!0);if(this.prev<S.finallyLoc)return y(S.finallyLoc)}else if(U){if(this.prev<S.catchLoc)return y(S.catchLoc,!0)}else{if(!$)throw Error("try statement without catch or finally");if(this.prev<S.finallyLoc)return y(S.finallyLoc)}}}},abrupt:function(d,p){for(var y=this.tryEntries.length-1;y>=0;--y){var A=this.tryEntries[y];if(A.tryLoc<=this.prev&&r.call(A,"finallyLoc")&&this.prev<A.finallyLoc){var S=A;break}}S&&(d==="break"||d==="continue")&&S.tryLoc<=p&&p<=S.finallyLoc&&(S=null);var F=S?S.completion:{};return F.type=d,F.arg=p,S?(this.method="next",this.next=S.finallyLoc,x):this.complete(F)},complete:function(d,p){if(d.type==="throw")throw d.arg;return d.type==="break"||d.type==="continue"?this.next=d.arg:d.type==="return"?(this.rval=this.arg=d.arg,this.method="return",this.next="end"):d.type==="normal"&&p&&(this.next=p),x},finish:function(d){for(var p=this.tryEntries.length-1;p>=0;--p){var y=this.tryEntries[p];if(y.finallyLoc===d)return this.complete(y.completion,y.afterLoc),C(y),x}},catch:function(d){for(var p=this.tryEntries.length-1;p>=0;--p){var y=this.tryEntries[p];if(y.tryLoc===d){var A=y.completion;if(A.type==="throw"){var S=A.arg;C(y)}return S}}throw Error("illegal catch attempt")},delegateYield:function(d,p,y){return this.delegate={iterator:k(d),resultName:p,nextLoc:y},this.method==="next"&&(this.arg=e),x}},t}function Ag(e,t,i,r,s,n,o){try{var a=e[n](o),h=a.value}catch(l){return void i(l)}a.done?t(h):Promise.resolve(h).then(r,s)}function N2(e){return function(){var t=this,i=arguments;return new Promise(function(r,s){var n=e.apply(t,i);function o(h){Ag(n,r,s,o,a,"next",h)}function a(h){Ag(n,r,s,o,a,"throw",h)}o(void 0)})}}function Q2(e,t){return U2(e)||X2(e,t)||Qg(e,t)||H2()}function H2(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function X2(e,t){var i=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(i!=null){var r,s,n,o,a=[],h=!0,l=!1;try{if(n=(i=i.call(e)).next,t===0){if(Object(i)!==i)return;h=!1}else for(;!(h=(r=n.call(i)).done)&&(a.push(r.value),a.length!==t);h=!0);}catch(c){l=!0,s=c}finally{try{if(!h&&i.return!=null&&(o=i.return(),Object(o)!==o))return}finally{if(l)throw s}}return a}}function U2(e){if(Array.isArray(e))return e}function Dc(e,t){var i=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=Qg(e))||t&&e&&typeof e.length=="number"){i&&(e=i);var r=0,s=function(){};return{s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(l){throw l},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var n,o=!0,a=!1;return{s:function(){i=i.call(e)},n:function(){var l=i.next();return o=l.done,l},e:function(l){a=!0,n=l},f:function(){try{o||i.return==null||i.return()}finally{if(a)throw n}}}}function Qg(e,t){if(e){if(typeof e=="string")return xg(e,t);var i={}.toString.call(e).slice(8,-1);return i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set"?Array.from(e):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?xg(e,t):void 0}}function xg(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,r=Array(t);i<t;i++)r[i]=e[i];return r}function z2(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Sg(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,$2(r.key),r)}}function W2(e,t,i){return t&&Sg(e.prototype,t),i&&Sg(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function $2(e){var t=G2(e,"string");return Di(t)=="symbol"?t:t+""}function G2(e,t){if(Di(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(Di(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function j2(e,t,i){return t=xa(t),q2(e,Hg()?Reflect.construct(t,i||[],xa(e).constructor):t.apply(e,i))}function q2(e,t){if(t&&(Di(t)=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return V2(e)}function V2(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Hg(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Hg=function(){return!!e})()}function xa(e){return xa=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},xa(e)}function Y2(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Tc(e,t)}function Tc(e,t){return Tc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},Tc(e,t)}var J2=3,Z2="rgb(40, 40, 40)",Cg=17,kg=50,Eg=19,kn=75,fr=50,e5=1e3,t5=50,Bg=1,ba=2,Lg=6,Dg=16,Ic=19,Ig=22,Mg=30,Tg=113,Rg=129,Fg=256,ui=1,Pg=1<<24,wa=1<<25,Og=1<<26,En=1<<27,Aa=1<<28,di=Sa.default=function(e){function t(i,r,s){var n;if(z2(this,t),!i)throw new Error("Must specify target");if(!r)throw new Error("Must specify URL, WebSocket or RTCDataChannel");window.isSecureContext||te.Error("noVNC requires a secure context (TLS). Expect crashes!"),n=j2(this,t),n._target=i,typeof r=="string"?n._url=r:(n._url=null,n._rawChannel=r),s=s||{},n._rfbCredentials=s.credentials||{},n._shared="shared"in s?!!s.shared:!0,n._repeaterID=s.repeaterID||"",n._wsProtocols=s.wsProtocols||[],n._rfbConnectionState="",n._rfbInitState="",n._rfbAuthScheme=-1,n._rfbCleanDisconnect=!0,n._rfbRSAAESAuthenticationState=null,n._rfbVersion=0,n._rfbMaxVersion=3.8,n._rfbTightVNC=!1,n._rfbVeNCryptState=0,n._rfbXvpVer=0,n._fbWidth=0,n._fbHeight=0,n._fbName="",n._capabilities={power:!1},n._supportsFence=!1,n._supportsContinuousUpdates=!1,n._enabledContinuousUpdates=!1,n._supportsSetDesktopSize=!1,n._screenID=0,n._screenFlags=0,n._qemuExtKeyEventSupported=!1,n._clipboardText=null,n._clipboardServerCapabilitiesActions={},n._clipboardServerCapabilitiesFormats={},n._sock=null,n._display=null,n._flushing=!1,n._keyboard=null,n._gestures=null,n._resizeObserver=null,n._disconnTimer=null,n._resizeTimeout=null,n._mouseMoveTimer=null,n._decoders={},n._FBU={rects:0,x:0,y:0,width:0,height:0,encoding:null},n._mousePos={},n._mouseButtonMask=0,n._mouseLastMoveTime=0,n._viewportDragging=!1,n._viewportDragPos={},n._viewportHasMoved=!1,n._accumulatedWheelDeltaX=0,n._accumulatedWheelDeltaY=0,n._gestureLastTapTime=null,n._gestureFirstDoubleTapEv=null,n._gestureLastMagnitudeX=0,n._gestureLastMagnitudeY=0,n._eventHandlers={focusCanvas:n._focusCanvas.bind(n),handleResize:n._handleResize.bind(n),handleMouse:n._handleMouse.bind(n),handleWheel:n._handleWheel.bind(n),handleGesture:n._handleGesture.bind(n),handleRSAAESCredentialsRequired:n._handleRSAAESCredentialsRequired.bind(n),handleRSAAESServerVerification:n._handleRSAAESServerVerification.bind(n)},te.Debug(">> RFB.constructor"),n._screen=document.createElement("div"),n._screen.style.display="flex",n._screen.style.width="100%",n._screen.style.height="100%",n._screen.style.overflow="auto",n._screen.style.background=Z2,n._canvas=document.createElement("canvas"),n._canvas.style.margin="auto",n._canvas.style.outline="none",n._canvas.width=0,n._canvas.height=0,n._canvas.tabIndex=-1,n._screen.appendChild(n._canvas),n._cursor=new k2.default,n._cursorImage=t.cursors.none,n._decoders[le.encodings.encodingRaw]=new D2.default,n._decoders[le.encodings.encodingCopyRect]=new I2.default,n._decoders[le.encodings.encodingRRE]=new M2.default,n._decoders[le.encodings.encodingHextile]=new T2.default,n._decoders[le.encodings.encodingTight]=new R2.default,n._decoders[le.encodings.encodingTightPNG]=new F2.default,n._decoders[le.encodings.encodingZRLE]=new P2.default,n._decoders[le.encodings.encodingJPEG]=new O2.default;try{n._display=new w2.default(n._canvas)}catch(o){throw te.Error("Display exception: "+o),o}return n._keyboard=new S2.default(n._canvas),n._keyboard.onkeyevent=n._handleKeyEvent.bind(n),n._remoteCapsLock=null,n._remoteNumLock=null,n._gestures=new C2.default,n._sock=new E2.default,n._sock.on("open",n._socketOpen.bind(n)),n._sock.on("close",n._socketClose.bind(n)),n._sock.on("message",n._handleMessage.bind(n)),n._sock.on("error",n._socketError.bind(n)),n._expectedClientWidth=null,n._expectedClientHeight=null,n._resizeObserver=new ResizeObserver(n._eventHandlers.handleResize),n._updateConnectionState("connecting"),te.Debug("<< RFB.constructor"),n.dragViewport=!1,n.focusOnClick=!0,n._viewOnly=!1,n._clipViewport=!1,n._clippingViewport=!1,n._scaleViewport=!1,n._resizeSession=!1,n._showDotCursor=!1,s.showDotCursor!==void 0&&(te.Warn("Specifying showDotCursor as a RFB constructor argument is deprecated"),n._showDotCursor=s.showDotCursor),n._qualityLevel=6,n._compressionLevel=2,n}return Y2(t,e),W2(t,[{key:"viewOnly",get:function(){return this._viewOnly},set:function(r){this._viewOnly=r,(this._rfbConnectionState==="connecting"||this._rfbConnectionState==="connected")&&(r?this._keyboard.ungrab():this._keyboard.grab())}},{key:"capabilities",get:function(){return this._capabilities}},{key:"clippingViewport",get:function(){return this._clippingViewport}},{key:"_setClippingViewport",value:function(r){r!==this._clippingViewport&&(this._clippingViewport=r,this.dispatchEvent(new CustomEvent("clippingviewport",{detail:this._clippingViewport})))}},{key:"touchButton",get:function(){return 0},set:function(r){te.Warn("Using old API!")}},{key:"clipViewport",get:function(){return this._clipViewport},set:function(r){this._clipViewport=r,this._updateClip()}},{key:"scaleViewport",get:function(){return this._scaleViewport},set:function(r){this._scaleViewport=r,r&&this._clipViewport&&this._updateClip(),this._updateScale(),!r&&this._clipViewport&&this._updateClip()}},{key:"resizeSession",get:function(){return this._resizeSession},set:function(r){this._resizeSession=r,r&&this._requestRemoteResize()}},{key:"showDotCursor",get:function(){return this._showDotCursor},set:function(r){this._showDotCursor=r,this._refreshCursor()}},{key:"background",get:function(){return this._screen.style.background},set:function(r){this._screen.style.background=r}},{key:"qualityLevel",get:function(){return this._qualityLevel},set:function(r){if(!Number.isInteger(r)||r<0||r>9){te.Error("qualityLevel must be an integer between 0 and 9");return}this._qualityLevel!==r&&(this._qualityLevel=r,this._rfbConnectionState==="connected"&&this._sendEncodings())}},{key:"compressionLevel",get:function(){return this._compressionLevel},set:function(r){if(!Number.isInteger(r)||r<0||r>9){te.Error("compressionLevel must be an integer between 0 and 9");return}this._compressionLevel!==r&&(this._compressionLevel=r,this._rfbConnectionState==="connected"&&this._sendEncodings())}},{key:"disconnect",value:function(){this._updateConnectionState("disconnecting"),this._sock.off("error"),this._sock.off("message"),this._sock.off("open"),this._rfbRSAAESAuthenticationState!==null&&this._rfbRSAAESAuthenticationState.disconnect()}},{key:"approveServer",value:function(){this._rfbRSAAESAuthenticationState!==null&&this._rfbRSAAESAuthenticationState.approveServer()}},{key:"sendCredentials",value:function(r){this._rfbCredentials=r,this._resumeAuthentication()}},{key:"sendCtrlAltDel",value:function(){this._rfbConnectionState!=="connected"||this._viewOnly||(te.Info("Sending Ctrl-Alt-Del"),this.sendKey(Xt.default.XK_Control_L,"ControlLeft",!0),this.sendKey(Xt.default.XK_Alt_L,"AltLeft",!0),this.sendKey(Xt.default.XK_Delete,"Delete",!0),this.sendKey(Xt.default.XK_Delete,"Delete",!1),this.sendKey(Xt.default.XK_Alt_L,"AltLeft",!1),this.sendKey(Xt.default.XK_Control_L,"ControlLeft",!1))}},{key:"machineShutdown",value:function(){this._xvpOp(1,2)}},{key:"machineReboot",value:function(){this._xvpOp(1,3)}},{key:"machineReset",value:function(){this._xvpOp(1,4)}},{key:"sendKey",value:function(r,s,n){if(!(this._rfbConnectionState!=="connected"||this._viewOnly)){if(n===void 0){this.sendKey(r,s,!0),this.sendKey(r,s,!1);return}var o=B2.default[s];if(this._qemuExtKeyEventSupported&&o)r=r||0,te.Info("Sending key ("+(n?"down":"up")+"): keysym "+r+", scancode "+o),t.messages.QEMUExtendedKeyEvent(this._sock,r,n,o);else{if(!r)return;te.Info("Sending keysym ("+(n?"down":"up")+"): "+r),t.messages.keyEvent(this._sock,r,n?1:0)}}}},{key:"focus",value:function(r){this._canvas.focus(r)}},{key:"blur",value:function(){this._canvas.blur()}},{key:"clipboardPasteFrom",value:function(r){if(!(this._rfbConnectionState!=="connected"||this._viewOnly))if(this._clipboardServerCapabilitiesFormats[ui]&&this._clipboardServerCapabilitiesActions[En])this._clipboardText=r,t.messages.extendedClipboardNotify(this._sock,[ui]);else{var s,n,o;s=0;var a=Dc(r),h;try{for(a.s();!(h=a.n()).done;){var l=h.value;s++}}catch(m){a.e(m)}finally{a.f()}o=new Uint8Array(s),n=0;var c=Dc(r),u;try{for(c.s();!(u=c.n()).done;){var g=u.value,_=g.codePointAt(0);_>255&&(_=63),o[n++]=_}}catch(m){c.e(m)}finally{c.f()}t.messages.clientCutText(this._sock,o)}}},{key:"getImageData",value:function(){return this._display.getImageData()}},{key:"toDataURL",value:function(r,s){return this._display.toDataURL(r,s)}},{key:"toBlob",value:function(r,s,n){return this._display.toBlob(r,s,n)}},{key:"_connect",value:function(){if(te.Debug(">> RFB.connect"),this._url)te.Info("connecting to ".concat(this._url)),this._sock.open(this._url,this._wsProtocols);else{if(te.Info("attaching ".concat(this._rawChannel," to Websock")),this._sock.attach(this._rawChannel),this._sock.readyState==="closed")throw Error("Cannot use already closed WebSocket/RTCDataChannel");this._sock.readyState==="open"&&this._socketOpen()}this._target.appendChild(this._screen),this._gestures.attach(this._canvas),this._cursor.attach(this._canvas),this._refreshCursor(),this._resizeObserver.observe(this._screen),this._canvas.addEventListener("mousedown",this._eventHandlers.focusCanvas),this._canvas.addEventListener("touchstart",this._eventHandlers.focusCanvas),this._canvas.addEventListener("mousedown",this._eventHandlers.handleMouse),this._canvas.addEventListener("mouseup",this._eventHandlers.handleMouse),this._canvas.addEventListener("mousemove",this._eventHandlers.handleMouse),this._canvas.addEventListener("click",this._eventHandlers.handleMouse),this._canvas.addEventListener("contextmenu",this._eventHandlers.handleMouse),this._canvas.addEventListener("wheel",this._eventHandlers.handleWheel),this._canvas.addEventListener("gesturestart",this._eventHandlers.handleGesture),this._canvas.addEventListener("gesturemove",this._eventHandlers.handleGesture),this._canvas.addEventListener("gestureend",this._eventHandlers.handleGesture),te.Debug("<< RFB.connect")}},{key:"_disconnect",value:function(){te.Debug(">> RFB.disconnect"),this._cursor.detach(),this._canvas.removeEventListener("gesturestart",this._eventHandlers.handleGesture),this._canvas.removeEventListener("gesturemove",this._eventHandlers.handleGesture),this._canvas.removeEventListener("gestureend",this._eventHandlers.handleGesture),this._canvas.removeEventListener("wheel",this._eventHandlers.handleWheel),this._canvas.removeEventListener("mousedown",this._eventHandlers.handleMouse),this._canvas.removeEventListener("mouseup",this._eventHandlers.handleMouse),this._canvas.removeEventListener("mousemove",this._eventHandlers.handleMouse),this._canvas.removeEventListener("click",this._eventHandlers.handleMouse),this._canvas.removeEventListener("contextmenu",this._eventHandlers.handleMouse),this._canvas.removeEventListener("mousedown",this._eventHandlers.focusCanvas),this._canvas.removeEventListener("touchstart",this._eventHandlers.focusCanvas),this._resizeObserver.disconnect(),this._keyboard.ungrab(),this._gestures.detach(),this._sock.close();try{this._target.removeChild(this._screen)}catch(r){if(r.name!=="NotFoundError")throw r}clearTimeout(this._resizeTimeout),clearTimeout(this._mouseMoveTimer),te.Debug("<< RFB.disconnect")}},{key:"_socketOpen",value:function(){this._rfbConnectionState==="connecting"&&this._rfbInitState===""?(this._rfbInitState="ProtocolVersion",te.Debug("Starting VNC handshake")):this._fail("Unexpected server connection while "+this._rfbConnectionState)}},{key:"_socketClose",value:function(r){te.Debug("WebSocket on-close event");var s="";switch(r.code&&(s="(code: "+r.code,r.reason&&(s+=", reason: "+r.reason),s+=")"),this._rfbConnectionState){case"connecting":this._fail("Connection closed "+s);break;case"connected":this._updateConnectionState("disconnecting"),this._updateConnectionState("disconnected");break;case"disconnecting":this._updateConnectionState("disconnected");break;case"disconnected":this._fail("Unexpected server disconnect when already disconnected "+s);break;default:this._fail("Unexpected server disconnect before connecting "+s);break}this._sock.off("close"),this._rawChannel=null}},{key:"_socketError",value:function(r){te.Warn("WebSocket on-error event")}},{key:"_focusCanvas",value:function(r){this.focusOnClick&&this.focus({preventScroll:!0})}},{key:"_setDesktopName",value:function(r){this._fbName=r,this.dispatchEvent(new CustomEvent("desktopname",{detail:{name:this._fbName}}))}},{key:"_saveExpectedClientSize",value:function(){this._expectedClientWidth=this._screen.clientWidth,this._expectedClientHeight=this._screen.clientHeight}},{key:"_currentClientSize",value:function(){return[this._screen.clientWidth,this._screen.clientHeight]}},{key:"_clientHasExpectedSize",value:function(){var r=this._currentClientSize(),s=Q2(r,2),n=s[0],o=s[1];return n==this._expectedClientWidth&&o==this._expectedClientHeight}},{key:"_handleResize",value:function(){var r=this;this._clientHasExpectedSize()||(window.requestAnimationFrame(function(){r._updateClip(),r._updateScale()}),this._resizeSession&&(clearTimeout(this._resizeTimeout),this._resizeTimeout=setTimeout(this._requestRemoteResize.bind(this),500)))}},{key:"_updateClip",value:function(){var r=this._display.clipViewport,s=this._clipViewport;if(this._scaleViewport&&(s=!1),r!==s&&(this._display.clipViewport=s),s){var n=this._screenSize();this._display.viewportChangeSize(n.w,n.h),this._fixScrollbars(),this._setClippingViewport(n.w<this._display.width||n.h<this._display.height)}else this._setClippingViewport(!1);r!==s&&this._saveExpectedClientSize()}},{key:"_updateScale",value:function(){if(!this._scaleViewport)this._display.scale=1;else{var r=this._screenSize();this._display.autoscale(r.w,r.h)}this._fixScrollbars()}},{key:"_requestRemoteResize",value:function(){if(clearTimeout(this._resizeTimeout),this._resizeTimeout=null,!(!this._resizeSession||this._viewOnly||!this._supportsSetDesktopSize)){var r=this._screenSize();t.messages.setDesktopSize(this._sock,Math.floor(r.w),Math.floor(r.h),this._screenID,this._screenFlags),te.Debug("Requested new desktop size: "+r.w+"x"+r.h)}}},{key:"_screenSize",value:function(){var r=this._screen.getBoundingClientRect();return{w:r.width,h:r.height}}},{key:"_fixScrollbars",value:function(){var r=this._screen.style.overflow;this._screen.style.overflow="hidden",this._screen.getBoundingClientRect(),this._screen.style.overflow=r}},{key:"_updateConnectionState",value:function(r){var s=this,n=this._rfbConnectionState;if(r===n){te.Debug("Already in state '"+r+"', ignoring");return}if(n==="disconnected"){te.Error("Tried changing state of a disconnected RFB object");return}switch(r){case"connected":if(n!=="connecting"){te.Error("Bad transition to connected state, previous connection state: "+n);return}break;case"disconnected":if(n!=="disconnecting"){te.Error("Bad transition to disconnected state, previous connection state: "+n);return}break;case"connecting":if(n!==""){te.Error("Bad transition to connecting state, previous connection state: "+n);return}break;case"disconnecting":if(n!=="connected"&&n!=="connecting"){te.Error("Bad transition to disconnecting state, previous connection state: "+n);return}break;default:te.Error("Unknown connection state: "+r);return}switch(this._rfbConnectionState=r,te.Debug("New state '"+r+"', was '"+n+"'."),this._disconnTimer&&r!=="disconnecting"&&(te.Debug("Clearing disconnect timer"),clearTimeout(this._disconnTimer),this._disconnTimer=null,this._sock.off("close")),r){case"connecting":this._connect();break;case"connected":this.dispatchEvent(new CustomEvent("connect",{detail:{}}));break;case"disconnecting":this._disconnect(),this._disconnTimer=setTimeout(function(){te.Error("Disconnection timed out."),s._updateConnectionState("disconnected")},J2*1e3);break;case"disconnected":this.dispatchEvent(new CustomEvent("disconnect",{detail:{clean:this._rfbCleanDisconnect}}));break}}},{key:"_fail",value:function(r){switch(this._rfbConnectionState){case"disconnecting":te.Error("Failed when disconnecting: "+r);break;case"connected":te.Error("Failed while connected: "+r);break;case"connecting":te.Error("Failed when connecting: "+r);break;default:te.Error("RFB failure: "+r);break}return this._rfbCleanDisconnect=!1,this._updateConnectionState("disconnecting"),this._updateConnectionState("disconnected"),!1}},{key:"_setCapability",value:function(r,s){this._capabilities[r]=s,this.dispatchEvent(new CustomEvent("capabilities",{detail:{capabilities:this._capabilities}}))}},{key:"_handleMessage",value:function(){if(this._sock.rQwait("message",1)){te.Warn("handleMessage called on an empty receive queue");return}switch(this._rfbConnectionState){case"disconnected":te.Error("Got data while disconnected");break;case"connected":for(;!(this._flushing||!this._normalMsg()||this._sock.rQwait("message",1)););break;case"connecting":for(;this._rfbConnectionState==="connecting"&&this._initMsg(););break;default:te.Error("Got data while in an invalid state");break}}},{key:"_handleKeyEvent",value:function(r,s,n,o,a){s=="CapsLock"&&n&&(this._remoteCapsLock=null),this._remoteCapsLock!==null&&a!==null&&this._remoteCapsLock!==a&&n&&(te.Debug("Fixing remote caps lock"),this.sendKey(Xt.default.XK_Caps_Lock,"CapsLock",!0),this.sendKey(Xt.default.XK_Caps_Lock,"CapsLock",!1),this._remoteCapsLock=null),s=="NumLock"&&n&&(this._remoteNumLock=null),this._remoteNumLock!==null&&o!==null&&this._remoteNumLock!==o&&n&&(te.Debug("Fixing remote num lock"),this.sendKey(Xt.default.XK_Num_Lock,"NumLock",!0),this.sendKey(Xt.default.XK_Num_Lock,"NumLock",!1),this._remoteNumLock=null),this.sendKey(r,s,n)}},{key:"_handleMouse",value:function(r){if(!(r.type==="click"&&r.target!==this._canvas)&&(r.stopPropagation(),r.preventDefault(),!(r.type==="click"||r.type==="contextmenu"))){var s=(0,Cn.clientToElement)(r.clientX,r.clientY,this._canvas);switch(r.type){case"mousedown":(0,y2.setCapture)(this._canvas),this._handleMouseButton(s.x,s.y,!0,1<<r.button);break;case"mouseup":this._handleMouseButton(s.x,s.y,!1,1<<r.button);break;case"mousemove":this._handleMouseMove(s.x,s.y);break}}}},{key:"_handleMouseButton",value:function(r,s,n,o){if(this.dragViewport)if(n&&!this._viewportDragging){this._viewportDragging=!0,this._viewportDragPos={x:r,y:s},this._viewportHasMoved=!1;return}else{if(this._viewportDragging=!1,this._viewportHasMoved)return;this._sendMouse(r,s,o)}this._mouseMoveTimer!==null&&(clearTimeout(this._mouseMoveTimer),this._mouseMoveTimer=null,this._sendMouse(r,s,this._mouseButtonMask)),n?this._mouseButtonMask|=o:this._mouseButtonMask&=~o,this._sendMouse(r,s,this._mouseButtonMask)}},{key:"_handleMouseMove",value:function(r,s){var n=this;if(this._viewportDragging){var o=this._viewportDragPos.x-r,a=this._viewportDragPos.y-s;(this._viewportHasMoved||Math.abs(o)>wg.dragThreshold||Math.abs(a)>wg.dragThreshold)&&(this._viewportHasMoved=!0,this._viewportDragPos={x:r,y:s},this._display.viewportChangePos(o,a));return}if(this._mousePos={x:r,y:s},this._mouseMoveTimer==null){var h=Date.now()-this._mouseLastMoveTime;h>Cg?(this._sendMouse(r,s,this._mouseButtonMask),this._mouseLastMoveTime=Date.now()):this._mouseMoveTimer=setTimeout(function(){n._handleDelayedMouseMove()},Cg-h)}}},{key:"_handleDelayedMouseMove",value:function(){this._mouseMoveTimer=null,this._sendMouse(this._mousePos.x,this._mousePos.y,this._mouseButtonMask),this._mouseLastMoveTime=Date.now()}},{key:"_sendMouse",value:function(r,s,n){this._rfbConnectionState==="connected"&&(this._viewOnly||t.messages.pointerEvent(this._sock,this._display.absX(r),this._display.absY(s),n))}},{key:"_handleWheel",value:function(r){if(this._rfbConnectionState==="connected"&&!this._viewOnly){r.stopPropagation(),r.preventDefault();var s=(0,Cn.clientToElement)(r.clientX,r.clientY,this._canvas),n=r.deltaX,o=r.deltaY;r.deltaMode!==0&&(n*=Eg,o*=Eg),this._accumulatedWheelDeltaX+=n,this._accumulatedWheelDeltaY+=o,Math.abs(this._accumulatedWheelDeltaX)>=kg&&(this._accumulatedWheelDeltaX<0?(this._handleMouseButton(s.x,s.y,!0,32),this._handleMouseButton(s.x,s.y,!1,32)):this._accumulatedWheelDeltaX>0&&(this._handleMouseButton(s.x,s.y,!0,64),this._handleMouseButton(s.x,s.y,!1,64)),this._accumulatedWheelDeltaX=0),Math.abs(this._accumulatedWheelDeltaY)>=kg&&(this._accumulatedWheelDeltaY<0?(this._handleMouseButton(s.x,s.y,!0,8),this._handleMouseButton(s.x,s.y,!1,8)):this._accumulatedWheelDeltaY>0&&(this._handleMouseButton(s.x,s.y,!0,16),this._handleMouseButton(s.x,s.y,!1,16)),this._accumulatedWheelDeltaY=0)}}},{key:"_fakeMouseMove",value:function(r,s,n){this._handleMouseMove(s,n),this._cursor.move(r.detail.clientX,r.detail.clientY)}},{key:"_handleTapEvent",value:function(r,s){var n=(0,Cn.clientToElement)(r.detail.clientX,r.detail.clientY,this._canvas);if(this._gestureLastTapTime!==null&&Date.now()-this._gestureLastTapTime<e5&&this._gestureFirstDoubleTapEv.detail.type===r.detail.type){var o=this._gestureFirstDoubleTapEv.detail.clientX-r.detail.clientX,a=this._gestureFirstDoubleTapEv.detail.clientY-r.detail.clientY,h=Math.hypot(o,a);h<t5?n=(0,Cn.clientToElement)(this._gestureFirstDoubleTapEv.detail.clientX,this._gestureFirstDoubleTapEv.detail.clientY,this._canvas):this._gestureFirstDoubleTapEv=r}else this._gestureFirstDoubleTapEv=r;this._gestureLastTapTime=Date.now(),this._fakeMouseMove(this._gestureFirstDoubleTapEv,n.x,n.y),this._handleMouseButton(n.x,n.y,!0,s),this._handleMouseButton(n.x,n.y,!1,s)}},{key:"_handleGesture",value:function(r){var s,n=(0,Cn.clientToElement)(r.detail.clientX,r.detail.clientY,this._canvas);switch(r.type){case"gesturestart":switch(r.detail.type){case"onetap":this._handleTapEvent(r,1);break;case"twotap":this._handleTapEvent(r,4);break;case"threetap":this._handleTapEvent(r,2);break;case"drag":this._fakeMouseMove(r,n.x,n.y),this._handleMouseButton(n.x,n.y,!0,1);break;case"longpress":this._fakeMouseMove(r,n.x,n.y),this._handleMouseButton(n.x,n.y,!0,4);break;case"twodrag":this._gestureLastMagnitudeX=r.detail.magnitudeX,this._gestureLastMagnitudeY=r.detail.magnitudeY,this._fakeMouseMove(r,n.x,n.y);break;case"pinch":this._gestureLastMagnitudeX=Math.hypot(r.detail.magnitudeX,r.detail.magnitudeY),this._fakeMouseMove(r,n.x,n.y);break}break;case"gesturemove":switch(r.detail.type){case"onetap":case"twotap":case"threetap":break;case"drag":case"longpress":this._fakeMouseMove(r,n.x,n.y);break;case"twodrag":for(this._fakeMouseMove(r,n.x,n.y);r.detail.magnitudeY-this._gestureLastMagnitudeY>fr;)this._handleMouseButton(n.x,n.y,!0,8),this._handleMouseButton(n.x,n.y,!1,8),this._gestureLastMagnitudeY+=fr;for(;r.detail.magnitudeY-this._gestureLastMagnitudeY<-fr;)this._handleMouseButton(n.x,n.y,!0,16),this._handleMouseButton(n.x,n.y,!1,16),this._gestureLastMagnitudeY-=fr;for(;r.detail.magnitudeX-this._gestureLastMagnitudeX>fr;)this._handleMouseButton(n.x,n.y,!0,32),this._handleMouseButton(n.x,n.y,!1,32),this._gestureLastMagnitudeX+=fr;for(;r.detail.magnitudeX-this._gestureLastMagnitudeX<-fr;)this._handleMouseButton(n.x,n.y,!0,64),this._handleMouseButton(n.x,n.y,!1,64),this._gestureLastMagnitudeX-=fr;break;case"pinch":if(this._fakeMouseMove(r,n.x,n.y),s=Math.hypot(r.detail.magnitudeX,r.detail.magnitudeY),Math.abs(s-this._gestureLastMagnitudeX)>kn){for(this._handleKeyEvent(Xt.default.XK_Control_L,"ControlLeft",!0);s-this._gestureLastMagnitudeX>kn;)this._handleMouseButton(n.x,n.y,!0,8),this._handleMouseButton(n.x,n.y,!1,8),this._gestureLastMagnitudeX+=kn;for(;s-this._gestureLastMagnitudeX<-kn;)this._handleMouseButton(n.x,n.y,!0,16),this._handleMouseButton(n.x,n.y,!1,16),this._gestureLastMagnitudeX-=kn}this._handleKeyEvent(Xt.default.XK_Control_L,"ControlLeft",!1);break}break;case"gestureend":switch(r.detail.type){case"onetap":case"twotap":case"threetap":case"pinch":case"twodrag":break;case"drag":this._fakeMouseMove(r,n.x,n.y),this._handleMouseButton(n.x,n.y,!1,1);break;case"longpress":this._fakeMouseMove(r,n.x,n.y),this._handleMouseButton(n.x,n.y,!1,4);break}break}}},{key:"_negotiateProtocolVersion",value:function(){if(this._sock.rQwait("version",12))return!1;var r=this._sock.rQshiftStr(12).substr(4,7);te.Info("Server ProtocolVersion: "+r);var s=0;switch(r){case"000.000":s=1;break;case"003.003":case"003.006":this._rfbVersion=3.3;break;case"003.007":this._rfbVersion=3.7;break;case"003.008":case"003.889":case"004.000":case"004.001":case"005.000":this._rfbVersion=3.8;break;default:return this._fail("Invalid server version "+r)}if(s){for(var n="ID:"+this._repeaterID;n.length<250;)n+="\0";return this._sock.sQpushString(n),this._sock.flush(),!0}this._rfbVersion>this._rfbMaxVersion&&(this._rfbVersion=this._rfbMaxVersion);var o="00"+parseInt(this._rfbVersion,10)+".00"+this._rfbVersion*10%10;this._sock.sQpushString("RFB "+o+`
`),this._sock.flush(),te.Debug("Sent ProtocolVersion: "+o),this._rfbInitState="Security"}},{key:"_isSupportedSecurityType",value:function(r){var s=[Bg,ba,Lg,Dg,Ic,Ig,Mg,Tg,Fg];return s.includes(r)}},{key:"_negotiateSecurity",value:function(){if(this._rfbVersion>=3.7){var r=this._sock.rQshift8();if(this._sock.rQwait("security type",r,1))return!1;if(r===0)return this._rfbInitState="SecurityReason",this._securityContext="no security types",this._securityStatus=1,!0;var s=this._sock.rQshiftBytes(r);te.Debug("Server security types: "+s),this._rfbAuthScheme=-1;var n=Dc(s),o;try{for(n.s();!(o=n.n()).done;){var a=o.value;if(this._isSupportedSecurityType(a)){this._rfbAuthScheme=a;break}}}catch(h){n.e(h)}finally{n.f()}if(this._rfbAuthScheme===-1)return this._fail("Unsupported security types (types: "+s+")");this._sock.sQpush8(this._rfbAuthScheme),this._sock.flush()}else{if(this._sock.rQwait("security scheme",4))return!1;if(this._rfbAuthScheme=this._sock.rQshift32(),this._rfbAuthScheme==0)return this._rfbInitState="SecurityReason",this._securityContext="authentication scheme",this._securityStatus=1,!0}return this._rfbInitState="Authentication",te.Debug("Authenticating using scheme: "+this._rfbAuthScheme),!0}},{key:"_handleSecurityReason",value:function(){if(this._sock.rQwait("reason length",4))return!1;var r=this._sock.rQshift32(),s="";if(r>0){if(this._sock.rQwait("reason",r,4))return!1;s=this._sock.rQshiftStr(r)}return s!==""?(this.dispatchEvent(new CustomEvent("securityfailure",{detail:{status:this._securityStatus,reason:s}})),this._fail("Security negotiation failed on "+this._securityContext+" (reason: "+s+")")):(this.dispatchEvent(new CustomEvent("securityfailure",{detail:{status:this._securityStatus}})),this._fail("Security negotiation failed on "+this._securityContext))}},{key:"_negotiateXvpAuth",value:function(){return this._rfbCredentials.username===void 0||this._rfbCredentials.password===void 0||this._rfbCredentials.target===void 0?(this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["username","password","target"]}})),!1):(this._sock.sQpush8(this._rfbCredentials.username.length),this._sock.sQpush8(this._rfbCredentials.target.length),this._sock.sQpushString(this._rfbCredentials.username),this._sock.sQpushString(this._rfbCredentials.target),this._sock.flush(),this._rfbAuthScheme=ba,this._negotiateAuthentication())}},{key:"_negotiateVeNCryptAuth",value:function(){if(this._rfbVeNCryptState==0){if(this._sock.rQwait("vencrypt version",2))return!1;var r=this._sock.rQshift8(),s=this._sock.rQshift8();if(!(r==0&&s==2))return this._fail("Unsupported VeNCrypt version "+r+"."+s);this._sock.sQpush8(0),this._sock.sQpush8(2),this._sock.flush(),this._rfbVeNCryptState=1}if(this._rfbVeNCryptState==1){if(this._sock.rQwait("vencrypt ack",1))return!1;var n=this._sock.rQshift8();if(n!=0)return this._fail("VeNCrypt failure "+n);this._rfbVeNCryptState=2}if(this._rfbVeNCryptState==2){if(this._sock.rQwait("vencrypt subtypes length",1))return!1;var o=this._sock.rQshift8();if(o<1)return this._fail("VeNCrypt subtypes empty");this._rfbVeNCryptSubtypesLength=o,this._rfbVeNCryptState=3}if(this._rfbVeNCryptState==3){if(this._sock.rQwait("vencrypt subtypes",4*this._rfbVeNCryptSubtypesLength))return!1;for(var a=[],h=0;h<this._rfbVeNCryptSubtypesLength;h++)a.push(this._sock.rQshift32());this._rfbAuthScheme=-1;for(var l=0,c=a;l<c.length;l++){var u=c[l];if(u!==Ic&&this._isSupportedSecurityType(u)){this._rfbAuthScheme=u;break}}return this._rfbAuthScheme===-1?this._fail("Unsupported security types (types: "+a+")"):(this._sock.sQpush32(this._rfbAuthScheme),this._sock.flush(),this._rfbVeNCryptState=4,!0)}}},{key:"_negotiatePlainAuth",value:function(){if(this._rfbCredentials.username===void 0||this._rfbCredentials.password===void 0)return this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["username","password"]}})),!1;var r=(0,ci.encodeUTF8)(this._rfbCredentials.username),s=(0,ci.encodeUTF8)(this._rfbCredentials.password);return this._sock.sQpush32(r.length),this._sock.sQpush32(s.length),this._sock.sQpushString(r),this._sock.sQpushString(s),this._sock.flush(),this._rfbInitState="SecurityResult",!0}},{key:"_negotiateStdVNCAuth",value:function(){if(this._sock.rQwait("auth challenge",16))return!1;if(this._rfbCredentials.password===void 0)return this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["password"]}})),!1;var r=Array.prototype.slice.call(this._sock.rQshiftBytes(16)),s=t.genDES(this._rfbCredentials.password,r);return this._sock.sQpushBytes(s),this._sock.flush(),this._rfbInitState="SecurityResult",!0}},{key:"_negotiateARDAuth",value:function(){if(this._rfbCredentials.username===void 0||this._rfbCredentials.password===void 0)return this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["username","password"]}})),!1;if(this._rfbCredentials.ardPublicKey!=null&&this._rfbCredentials.ardCredentials!=null)return this._sock.sQpushBytes(this._rfbCredentials.ardCredentials),this._sock.sQpushBytes(this._rfbCredentials.ardPublicKey),this._sock.flush(),this._rfbCredentials.ardCredentials=null,this._rfbCredentials.ardPublicKey=null,this._rfbInitState="SecurityResult",!0;if(this._sock.rQwait("read ard",4))return!1;var r=this._sock.rQshiftBytes(2),s=this._sock.rQshift16();if(this._sock.rQwait("read ard keylength",s*2,4))return!1;var n=this._sock.rQshiftBytes(s),o=this._sock.rQshiftBytes(s),a=xt.default.generateKey({name:"DH",g:r,p:n},!1,["deriveBits"]);return this._negotiateARDAuthAsync(s,o,a),!1}},{key:"_negotiateARDAuthAsync",value:function(){var i=N2(Mc().mark(function s(n,o,a){var h,l,c,u,g,_,m,v,x,E;return Mc().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:for(h=xt.default.exportKey("raw",a.publicKey),l=xt.default.deriveBits({name:"DH",public:o},a.privateKey,n*8),c=(0,ci.encodeUTF8)(this._rfbCredentials.username).substring(0,63),u=(0,ci.encodeUTF8)(this._rfbCredentials.password).substring(0,63),g=window.crypto.getRandomValues(new Uint8Array(128)),_=0;_<c.length;_++)g[_]=c.charCodeAt(_);for(g[c.length]=0,m=0;m<u.length;m++)g[64+m]=u.charCodeAt(m);return g[64+u.length]=0,D.next=11,xt.default.digest("MD5",l);case 11:return v=D.sent,D.next=14,xt.default.importKey("raw",v,{name:"AES-ECB"},!1,["encrypt"]);case 14:return x=D.sent,D.next=17,xt.default.encrypt({name:"AES-ECB"},x,g);case 17:E=D.sent,this._rfbCredentials.ardCredentials=E,this._rfbCredentials.ardPublicKey=h,this._resumeAuthentication();case 21:case"end":return D.stop()}},s,this)}));function r(s,n,o){return i.apply(this,arguments)}return r}()},{key:"_negotiateTightUnixAuth",value:function(){return this._rfbCredentials.username===void 0||this._rfbCredentials.password===void 0?(this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["username","password"]}})),!1):(this._sock.sQpush32(this._rfbCredentials.username.length),this._sock.sQpush32(this._rfbCredentials.password.length),this._sock.sQpushString(this._rfbCredentials.username),this._sock.sQpushString(this._rfbCredentials.password),this._sock.flush(),this._rfbInitState="SecurityResult",!0)}},{key:"_negotiateTightTunnels",value:function(r){for(var s={0:{vendor:"TGHT",signature:"NOTUNNEL"}},n={},o=0;o<r;o++){var a=this._sock.rQshift32(),h=this._sock.rQshiftStr(4),l=this._sock.rQshiftStr(8);n[a]={vendor:h,signature:l}}return te.Debug("Server Tight tunnel types: "+n),n[1]&&n[1].vendor==="SICR"&&n[1].signature==="SCHANNEL"&&(te.Debug("Detected Siemens server. Assuming NOTUNNEL support."),n[0]={vendor:"TGHT",signature:"NOTUNNEL"}),n[0]?n[0].vendor!=s[0].vendor||n[0].signature!=s[0].signature?this._fail("Client's tunnel type had the incorrect vendor or signature"):(te.Debug("Selected tunnel type: "+s[0]),this._sock.sQpush32(0),this._sock.flush(),!1):this._fail("Server wanted tunnels, but doesn't support the notunnel type")}},{key:"_negotiateTightAuth",value:function(){if(!this._rfbTightVNC){if(this._sock.rQwait("num tunnels",4))return!1;var r=this._sock.rQshift32();if(r>0&&this._sock.rQwait("tunnel capabilities",16*r,4))return!1;if(this._rfbTightVNC=!0,r>0)return this._negotiateTightTunnels(r),!1}if(this._sock.rQwait("sub auth count",4))return!1;var s=this._sock.rQshift32();if(s===0)return this._rfbInitState="SecurityResult",!0;if(this._sock.rQwait("sub auth capabilities",16*s,4))return!1;for(var n={STDVNOAUTH__:1,STDVVNCAUTH_:2,TGHTULGNAUTH:129},o=[],a=0;a<s;a++){this._sock.rQshift32();var h=this._sock.rQshiftStr(12);o.push(h)}te.Debug("Server Tight authentication types: "+o);for(var l in n)if(o.indexOf(l)!=-1)switch(this._sock.sQpush32(n[l]),this._sock.flush(),te.Debug("Selected authentication type: "+l),l){case"STDVNOAUTH__":return this._rfbInitState="SecurityResult",!0;case"STDVVNCAUTH_":return this._rfbAuthScheme=ba,!0;case"TGHTULGNAUTH":return this._rfbAuthScheme=Rg,!0;default:return this._fail("Unsupported tiny auth scheme (scheme: "+l+")")}return this._fail("No supported sub-auth types!")}},{key:"_handleRSAAESCredentialsRequired",value:function(r){this.dispatchEvent(r)}},{key:"_handleRSAAESServerVerification",value:function(r){this.dispatchEvent(r)}},{key:"_negotiateRA2neAuth",value:function(){var r=this;return this._rfbRSAAESAuthenticationState===null&&(this._rfbRSAAESAuthenticationState=new L2.default(this._sock,function(){return r._rfbCredentials}),this._rfbRSAAESAuthenticationState.addEventListener("serververification",this._eventHandlers.handleRSAAESServerVerification),this._rfbRSAAESAuthenticationState.addEventListener("credentialsrequired",this._eventHandlers.handleRSAAESCredentialsRequired)),this._rfbRSAAESAuthenticationState.checkInternalEvents(),this._rfbRSAAESAuthenticationState.hasStarted||this._rfbRSAAESAuthenticationState.negotiateRA2neAuthAsync().catch(function(s){s.message!=="disconnect normally"&&r._fail(s.message)}).then(function(){return r._rfbInitState="SecurityResult",!0}).finally(function(){r._rfbRSAAESAuthenticationState.removeEventListener("serververification",r._eventHandlers.handleRSAAESServerVerification),r._rfbRSAAESAuthenticationState.removeEventListener("credentialsrequired",r._eventHandlers.handleRSAAESCredentialsRequired),r._rfbRSAAESAuthenticationState=null}),!1}},{key:"_negotiateMSLogonIIAuth",value:function(){if(this._sock.rQwait("mslogonii dh param",24))return!1;if(this._rfbCredentials.username===void 0||this._rfbCredentials.password===void 0)return this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["username","password"]}})),!1;var r=this._sock.rQshiftBytes(8),s=this._sock.rQshiftBytes(8),n=this._sock.rQshiftBytes(8),o=xt.default.generateKey({name:"DH",g:r,p:s},!0,["deriveBits"]),a=xt.default.exportKey("raw",o.publicKey),h=xt.default.deriveBits({name:"DH",public:n},o.privateKey,64),l=xt.default.importKey("raw",h,{name:"DES-CBC"},!1,["encrypt"]),c=(0,ci.encodeUTF8)(this._rfbCredentials.username).substring(0,255),u=(0,ci.encodeUTF8)(this._rfbCredentials.password).substring(0,63),g=new Uint8Array(256),_=new Uint8Array(64);window.crypto.getRandomValues(g),window.crypto.getRandomValues(_);for(var m=0;m<c.length;m++)g[m]=c.charCodeAt(m);g[c.length]=0;for(var v=0;v<u.length;v++)_[v]=u.charCodeAt(v);return _[u.length]=0,g=xt.default.encrypt({name:"DES-CBC",iv:h},l,g),_=xt.default.encrypt({name:"DES-CBC",iv:h},l,_),this._sock.sQpushBytes(a),this._sock.sQpushBytes(g),this._sock.sQpushBytes(_),this._sock.flush(),this._rfbInitState="SecurityResult",!0}},{key:"_negotiateAuthentication",value:function(){switch(this._rfbAuthScheme){case Bg:return this._rfbVersion>=3.8?this._rfbInitState="SecurityResult":this._rfbInitState="ClientInitialisation",!0;case Ig:return this._negotiateXvpAuth();case Mg:return this._negotiateARDAuth();case ba:return this._negotiateStdVNCAuth();case Dg:return this._negotiateTightAuth();case Ic:return this._negotiateVeNCryptAuth();case Fg:return this._negotiatePlainAuth();case Rg:return this._negotiateTightUnixAuth();case Lg:return this._negotiateRA2neAuth();case Tg:return this._negotiateMSLogonIIAuth();default:return this._fail("Unsupported auth scheme (scheme: "+this._rfbAuthScheme+")")}}},{key:"_handleSecurityResult",value:function(){if(this._sock.rQwait("VNC auth response ",4))return!1;var r=this._sock.rQshift32();return r===0?(this._rfbInitState="ClientInitialisation",te.Debug("Authentication OK"),!0):this._rfbVersion>=3.8?(this._rfbInitState="SecurityReason",this._securityContext="security result",this._securityStatus=r,!0):(this.dispatchEvent(new CustomEvent("securityfailure",{detail:{status:r}})),this._fail("Security handshake failed"))}},{key:"_negotiateServerInit",value:function(){if(this._sock.rQwait("server initialization",24))return!1;var r=this._sock.rQshift16(),s=this._sock.rQshift16(),n=this._sock.rQshift8(),o=this._sock.rQshift8(),a=this._sock.rQshift8(),h=this._sock.rQshift8(),l=this._sock.rQshift16(),c=this._sock.rQshift16(),u=this._sock.rQshift16(),g=this._sock.rQshift8(),_=this._sock.rQshift8(),m=this._sock.rQshift8();this._sock.rQskipBytes(3);var v=this._sock.rQshift32();if(this._sock.rQwait("server init name",v,24))return!1;var x=this._sock.rQshiftStr(v);if(x=(0,ci.decodeUTF8)(x,!0),this._rfbTightVNC){if(this._sock.rQwait("TightVNC extended server init header",8,24+v))return!1;var E=this._sock.rQshift16(),M=this._sock.rQshift16(),D=this._sock.rQshift16();this._sock.rQskipBytes(2);var b=(E+M+D)*16;if(this._sock.rQwait("TightVNC extended server init header",b,32+v))return!1;this._sock.rQskipBytes(16*E),this._sock.rQskipBytes(16*M),this._sock.rQskipBytes(16*D)}return te.Info("Screen: "+r+"x"+s+", bpp: "+n+", depth: "+o+", bigEndian: "+a+", trueColor: "+h+", redMax: "+l+", greenMax: "+c+", blueMax: "+u+", redShift: "+g+", greenShift: "+_+", blueShift: "+m),this._setDesktopName(x),this._resize(r,s),this._viewOnly||this._keyboard.grab(),this._fbDepth=24,this._fbName==="Intel(r) AMT KVM"&&(te.Warn("Intel AMT KVM only supports 8/16 bit depths. Using low color mode."),this._fbDepth=8),t.messages.pixelFormat(this._sock,this._fbDepth,!0),this._sendEncodings(),t.messages.fbUpdateRequest(this._sock,!1,0,0,this._fbWidth,this._fbHeight),this._updateConnectionState("connected"),!0}},{key:"_sendEncodings",value:function(){var r=[];r.push(le.encodings.encodingCopyRect),this._fbDepth==24&&(r.push(le.encodings.encodingTight),r.push(le.encodings.encodingTightPNG),r.push(le.encodings.encodingZRLE),r.push(le.encodings.encodingJPEG),r.push(le.encodings.encodingHextile),r.push(le.encodings.encodingRRE)),r.push(le.encodings.encodingRaw),r.push(le.encodings.pseudoEncodingQualityLevel0+this._qualityLevel),r.push(le.encodings.pseudoEncodingCompressLevel0+this._compressionLevel),r.push(le.encodings.pseudoEncodingDesktopSize),r.push(le.encodings.pseudoEncodingLastRect),r.push(le.encodings.pseudoEncodingQEMUExtendedKeyEvent),r.push(le.encodings.pseudoEncodingQEMULedEvent),r.push(le.encodings.pseudoEncodingExtendedDesktopSize),r.push(le.encodings.pseudoEncodingXvp),r.push(le.encodings.pseudoEncodingFence),r.push(le.encodings.pseudoEncodingContinuousUpdates),r.push(le.encodings.pseudoEncodingDesktopName),r.push(le.encodings.pseudoEncodingExtendedClipboard),this._fbDepth==24&&(r.push(le.encodings.pseudoEncodingVMwareCursor),r.push(le.encodings.pseudoEncodingCursor)),t.messages.clientEncodings(this._sock,r)}},{key:"_initMsg",value:function(){switch(this._rfbInitState){case"ProtocolVersion":return this._negotiateProtocolVersion();case"Security":return this._negotiateSecurity();case"Authentication":return this._negotiateAuthentication();case"SecurityResult":return this._handleSecurityResult();case"SecurityReason":return this._handleSecurityReason();case"ClientInitialisation":return this._sock.sQpush8(this._shared?1:0),this._sock.flush(),this._rfbInitState="ServerInitialisation",!0;case"ServerInitialisation":return this._negotiateServerInit();default:return this._fail("Unknown init state (state: "+this._rfbInitState+")")}}},{key:"_resumeAuthentication",value:function(){setTimeout(this._initMsg.bind(this),0)}},{key:"_handleSetColourMapMsg",value:function(){return te.Debug("SetColorMapEntries"),this._fail("Unexpected SetColorMapEntries message")}},{key:"_handleServerCutText",value:function(){if(te.Debug("ServerCutText"),this._sock.rQwait("ServerCutText header",7,1))return!1;this._sock.rQskipBytes(3);var r=this._sock.rQshift32();if(r=(0,Kg.toSigned32bit)(r),this._sock.rQwait("ServerCutText content",Math.abs(r),8))return!1;if(r>=0){var s=this._sock.rQshiftStr(r);if(this._viewOnly)return!0;this.dispatchEvent(new CustomEvent("clipboard",{detail:{text:s}}))}else{r=Math.abs(r);var n=this._sock.rQshift32(),o=n&65535,a=n&4278190080,h=!!(a&Pg);if(h){this._clipboardServerCapabilitiesFormats={},this._clipboardServerCapabilitiesActions={};for(var l=0;l<=15;l++){var c=1<<l;o&c&&(this._clipboardServerCapabilitiesFormats[c]=!0,this._sock.rQshift32())}for(var u=24;u<=31;u++){var g=1<<u;this._clipboardServerCapabilitiesActions[g]=!!(a&g)}var _=[Pg,wa,Og,En,Aa];t.messages.extendedClipboardCaps(this._sock,_,{extendedClipboardFormatText:0})}else if(a===wa){if(this._viewOnly)return!0;this._clipboardText!=null&&this._clipboardServerCapabilitiesActions[Aa]&&o&ui&&t.messages.extendedClipboardProvide(this._sock,[ui],[this._clipboardText])}else if(a===Og){if(this._viewOnly)return!0;this._clipboardServerCapabilitiesActions[En]&&(this._clipboardText!=null?t.messages.extendedClipboardNotify(this._sock,[ui]):t.messages.extendedClipboardNotify(this._sock,[]))}else if(a===En){if(this._viewOnly)return!0;this._clipboardServerCapabilitiesActions[wa]&&o&ui&&t.messages.extendedClipboardRequest(this._sock,[ui])}else if(a===Aa){if(this._viewOnly||!(o&ui))return!0;this._clipboardText=null;var m=this._sock.rQshiftBytes(r-4),v=new A2.default,x=null;v.setInput(m);for(var E=0;E<=15;E++){var M=1<<E;if(o&M){var D=0,b=v.inflate(4);D|=b[0]<<24,D|=b[1]<<16,D|=b[2]<<8,D|=b[3];var L=v.inflate(D);M===ui&&(x=L)}}if(v.setInput(null),x!==null){for(var I="",R=0;R<x.length;R++)I+=String.fromCharCode(x[R]);x=I,x=(0,ci.decodeUTF8)(x),x.length>0&&x.charAt(x.length-1)==="\0"&&(x=x.slice(0,-1)),x=x.replaceAll(`\r
`,`
`),this.dispatchEvent(new CustomEvent("clipboard",{detail:{text:x}}))}}else return this._fail("Unexpected action in extended clipboard message: "+a)}return!0}},{key:"_handleServerFenceMsg",value:function(){if(this._sock.rQwait("ServerFence header",8,1))return!1;this._sock.rQskipBytes(3);var r=this._sock.rQshift32(),s=this._sock.rQshift8();if(this._sock.rQwait("ServerFence payload",s,9))return!1;s>64&&(te.Warn("Bad payload length ("+s+") in fence response"),s=64);var n=this._sock.rQshiftStr(s);return this._supportsFence=!0,r&1<<31?(r&=3,t.messages.clientFence(this._sock,r,n),!0):this._fail("Unexpected fence response")}},{key:"_handleXvpMsg",value:function(){if(this._sock.rQwait("XVP version and message",3,1))return!1;this._sock.rQskipBytes(1);var r=this._sock.rQshift8(),s=this._sock.rQshift8();switch(s){case 0:te.Error("XVP Operation Failed");break;case 1:this._rfbXvpVer=r,te.Info("XVP extensions enabled (version "+this._rfbXvpVer+")"),this._setCapability("power",!0);break;default:this._fail("Illegal server XVP message (msg: "+s+")");break}return!0}},{key:"_normalMsg",value:function(){var r;this._FBU.rects>0?r=0:r=this._sock.rQshift8();var s,n;switch(r){case 0:return n=this._framebufferUpdate(),n&&!this._enabledContinuousUpdates&&t.messages.fbUpdateRequest(this._sock,!0,0,0,this._fbWidth,this._fbHeight),n;case 1:return this._handleSetColourMapMsg();case 2:return te.Debug("Bell"),this.dispatchEvent(new CustomEvent("bell",{detail:{}})),!0;case 3:return this._handleServerCutText();case 150:return s=!this._supportsContinuousUpdates,this._supportsContinuousUpdates=!0,this._enabledContinuousUpdates=!1,s&&(this._enabledContinuousUpdates=!0,this._updateContinuousUpdates(),te.Info("Enabling continuous updates.")),!0;case 248:return this._handleServerFenceMsg();case 250:return this._handleXvpMsg();default:return this._fail("Unexpected server message (type "+r+")"),te.Debug("sock.rQpeekBytes(30): "+this._sock.rQpeekBytes(30)),!0}}},{key:"_framebufferUpdate",value:function(){var r=this;if(this._FBU.rects===0){if(this._sock.rQwait("FBU header",3,1))return!1;if(this._sock.rQskipBytes(1),this._FBU.rects=this._sock.rQshift16(),this._display.pending())return this._flushing=!0,this._display.flush().then(function(){r._flushing=!1,r._sock.rQwait("message",1)||r._handleMessage()}),!1}for(;this._FBU.rects>0;){if(this._FBU.encoding===null){if(this._sock.rQwait("rect header",12))return!1;this._FBU.x=this._sock.rQshift16(),this._FBU.y=this._sock.rQshift16(),this._FBU.width=this._sock.rQshift16(),this._FBU.height=this._sock.rQshift16(),this._FBU.encoding=this._sock.rQshift32(),this._FBU.encoding>>=0}if(!this._handleRect())return!1;this._FBU.rects--,this._FBU.encoding=null}return this._display.flip(),!0}},{key:"_handleRect",value:function(){switch(this._FBU.encoding){case le.encodings.pseudoEncodingLastRect:return this._FBU.rects=1,!0;case le.encodings.pseudoEncodingVMwareCursor:return this._handleVMwareCursor();case le.encodings.pseudoEncodingCursor:return this._handleCursor();case le.encodings.pseudoEncodingQEMUExtendedKeyEvent:return this._qemuExtKeyEventSupported=!0,!0;case le.encodings.pseudoEncodingDesktopName:return this._handleDesktopName();case le.encodings.pseudoEncodingDesktopSize:return this._resize(this._FBU.width,this._FBU.height),!0;case le.encodings.pseudoEncodingExtendedDesktopSize:return this._handleExtendedDesktopSize();case le.encodings.pseudoEncodingQEMULedEvent:return this._handleLedEvent();default:return this._handleDataRect()}}},{key:"_handleVMwareCursor",value:function(){var r=this._FBU.x,s=this._FBU.y,n=this._FBU.width,o=this._FBU.height;if(this._sock.rQwait("VMware cursor encoding",1))return!1;var a=this._sock.rQshift8();this._sock.rQshift8();var h,l=4;if(a==0){var c=-256;if(h=new Array(n*o*l),this._sock.rQwait("VMware cursor classic encoding",n*o*l*2,2))return!1;for(var u=new Array(n*o),g=0;g<n*o;g++)u[g]=this._sock.rQshift32();for(var _=new Array(n*o),m=0;m<n*o;m++)_[m]=this._sock.rQshift32();for(var v=0;v<n*o;v++)if(u[v]==0){var x=_[v],E=x>>8&255,M=x>>16&255,D=x>>24&255;h[v*l]=E,h[v*l+1]=M,h[v*l+2]=D,h[v*l+3]=255}else(u[v]&c)==c?_[v]==0?(h[v*l]=0,h[v*l+1]=0,h[v*l+2]=0,h[v*l+3]=0):((_[v]&c)==c,h[v*l]=0,h[v*l+1]=0,h[v*l+2]=0,h[v*l+3]=255):(h[v*l]=0,h[v*l+1]=0,h[v*l+2]=0,h[v*l+3]=255)}else if(a==1){if(this._sock.rQwait("VMware cursor alpha encoding",n*o*4,2))return!1;h=new Array(n*o*l);for(var b=0;b<n*o;b++){var L=this._sock.rQshift32();h[b*4]=L>>24&255,h[b*4+1]=L>>16&255,h[b*4+2]=L>>8&255,h[b*4+3]=L&255}}else return te.Warn("The given cursor type is not supported: "+a+" given."),!1;return this._updateCursor(h,r,s,n,o),!0}},{key:"_handleCursor",value:function(){var r=this._FBU.x,s=this._FBU.y,n=this._FBU.width,o=this._FBU.height,a=n*o*4,h=Math.ceil(n/8)*o,l=a+h;if(this._sock.rQwait("cursor encoding",l))return!1;for(var c=this._sock.rQshiftBytes(a),u=this._sock.rQshiftBytes(h),g=new Uint8Array(n*o*4),_=0,m=0;m<o;m++)for(var v=0;v<n;v++){var x=m*Math.ceil(n/8)+Math.floor(v/8),E=u[x]<<v%8&128?255:0;g[_]=c[_+2],g[_+1]=c[_+1],g[_+2]=c[_],g[_+3]=E,_+=4}return this._updateCursor(g,r,s,n,o),!0}},{key:"_handleDesktopName",value:function(){if(this._sock.rQwait("DesktopName",4))return!1;var r=this._sock.rQshift32();if(this._sock.rQwait("DesktopName",r,4))return!1;var s=this._sock.rQshiftStr(r);return s=(0,ci.decodeUTF8)(s,!0),this._setDesktopName(s),!0}},{key:"_handleLedEvent",value:function(){if(this._sock.rQwait("LED Status",1))return!1;var r=this._sock.rQshift8(),s=!!(r&2),n=!!(r&4);return this._remoteCapsLock=n,this._remoteNumLock=s,!0}},{key:"_handleExtendedDesktopSize",value:function(){if(this._sock.rQwait("ExtendedDesktopSize",4))return!1;var r=this._sock.rQpeek8(),s=4+r*16;if(this._sock.rQwait("ExtendedDesktopSize",s))return!1;var n=!this._supportsSetDesktopSize;this._supportsSetDesktopSize=!0,this._sock.rQskipBytes(1),this._sock.rQskipBytes(3);for(var o=0;o<r;o+=1)o===0?(this._screenID=this._sock.rQshift32(),this._sock.rQskipBytes(2),this._sock.rQskipBytes(2),this._sock.rQskipBytes(2),this._sock.rQskipBytes(2),this._screenFlags=this._sock.rQshift32()):this._sock.rQskipBytes(16);if(this._FBU.x===1&&this._FBU.y!==0){var a="";switch(this._FBU.y){case 1:a="Resize is administratively prohibited";break;case 2:a="Out of resources";break;case 3:a="Invalid screen layout";break;default:a="Unknown reason";break}te.Warn("Server did not accept the resize request: "+a)}else this._resize(this._FBU.width,this._FBU.height);return n&&this._requestRemoteResize(),!0}},{key:"_handleDataRect",value:function(){var r=this._decoders[this._FBU.encoding];if(!r)return this._fail("Unsupported encoding (encoding: "+this._FBU.encoding+")"),!1;try{return r.decodeRect(this._FBU.x,this._FBU.y,this._FBU.width,this._FBU.height,this._sock,this._display,this._fbDepth)}catch(s){return this._fail("Error decoding rect: "+s),!1}}},{key:"_updateContinuousUpdates",value:function(){this._enabledContinuousUpdates&&t.messages.enableContinuousUpdates(this._sock,!0,0,0,this._fbWidth,this._fbHeight)}},{key:"_resize",value:function(r,s){this._fbWidth=r,this._fbHeight=s,this._display.resize(this._fbWidth,this._fbHeight),this._updateClip(),this._updateScale(),this._updateContinuousUpdates(),this._saveExpectedClientSize()}},{key:"_xvpOp",value:function(r,s){this._rfbXvpVer<r||(te.Info("Sending XVP operation "+s+" (version "+r+")"),t.messages.xvpOp(this._sock,r,s))}},{key:"_updateCursor",value:function(r,s,n,o,a){this._cursorImage={rgbaPixels:r,hotx:s,hoty:n,w:o,h:a},this._refreshCursor()}},{key:"_shouldShowDotCursor",value:function(){if(!this._showDotCursor)return!1;for(var r=3;r<this._cursorImage.rgbaPixels.length;r+=4)if(this._cursorImage.rgbaPixels[r])return!1;return!0}},{key:"_refreshCursor",value:function(){if(!(this._rfbConnectionState!=="connecting"&&this._rfbConnectionState!=="connected")){var r=this._shouldShowDotCursor()?t.cursors.dot:this._cursorImage;this._cursor.change(r.rgbaPixels,r.hotx,r.hoty,r.w,r.h)}}}],[{key:"genDES",value:function(r,s){var n=r.split("").map(function(a){return a.charCodeAt(0)}),o=xt.default.importKey("raw",n,{name:"DES-ECB"},!1,["encrypt"]);return xt.default.encrypt({name:"DES-ECB"},o,s)}}])}(b2.default);di.messages={keyEvent:function(t,i,r){t.sQpush8(4),t.sQpush8(r),t.sQpush16(0),t.sQpush32(i),t.flush()},QEMUExtendedKeyEvent:function(t,i,r,s){function n(a){var h=s>>8,l=s&255;return h===224&&l<127?l|128:a}t.sQpush8(255),t.sQpush8(0),t.sQpush16(r),t.sQpush32(i);var o=n(s);t.sQpush32(o),t.flush()},pointerEvent:function(t,i,r,s){t.sQpush8(5),t.sQpush8(s),t.sQpush16(i),t.sQpush16(r),t.flush()},_buildExtendedClipboardFlags:function(t,i){for(var r=new Uint8Array(4),s=0,n=0,o=0;o<t.length;o++)n|=t[o];for(var a=0;a<i.length;a++)s|=i[a];return r[0]=n>>24,r[1]=0,r[2]=0,r[3]=s,r},extendedClipboardProvide:function(t,i,r){for(var s=new x2.default,n=[],o=0;o<i.length;o++){if(i[o]!=ui)throw new Error("Unsupported extended clipboard format for Provide message.");r[o]=r[o].replace(/\r\n|\r|\n/gm,`\r
`);var a=(0,ci.encodeUTF8)(r[o]+"\0");n.push(a.length>>24&255,a.length>>16&255,a.length>>8&255,a.length&255);for(var h=0;h<a.length;h++)n.push(a.charCodeAt(h))}var l=s.deflate(new Uint8Array(n)),c=new Uint8Array(4+l.length);c.set(di.messages._buildExtendedClipboardFlags([Aa],i)),c.set(l,4),di.messages.clientCutText(t,c,!0)},extendedClipboardNotify:function(t,i){var r=di.messages._buildExtendedClipboardFlags([En],i);di.messages.clientCutText(t,r,!0)},extendedClipboardRequest:function(t,i){var r=di.messages._buildExtendedClipboardFlags([wa],i);di.messages.clientCutText(t,r,!0)},extendedClipboardCaps:function(t,i,r){var s=Object.keys(r),n=new Uint8Array(4+4*s.length);s.map(function(h){return parseInt(h)}),s.sort(function(h,l){return h-l}),n.set(di.messages._buildExtendedClipboardFlags(i,[]));for(var o=4,a=0;a<s.length;a++)n[o]=r[s[a]]>>24,n[o+1]=r[s[a]]>>16,n[o+2]=r[s[a]]>>8,n[o+3]=r[s[a]]>>0,o+=4,n[3]|=1<<s[a];di.messages.clientCutText(t,n,!0)},clientCutText:function(t,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;t.sQpush8(6),t.sQpush8(0),t.sQpush8(0),t.sQpush8(0);var s;r?s=(0,Kg.toUnsigned32bit)(-i.length):s=i.length,t.sQpush32(s),t.sQpushBytes(i),t.flush()},setDesktopSize:function(t,i,r,s,n){t.sQpush8(251),t.sQpush8(0),t.sQpush16(i),t.sQpush16(r),t.sQpush8(1),t.sQpush8(0),t.sQpush32(s),t.sQpush16(0),t.sQpush16(0),t.sQpush16(i),t.sQpush16(r),t.sQpush32(n),t.flush()},clientFence:function(t,i,r){t.sQpush8(248),t.sQpush8(0),t.sQpush8(0),t.sQpush8(0),t.sQpush32(i),t.sQpush8(r.length),t.sQpushString(r),t.flush()},enableContinuousUpdates:function(t,i,r,s,n,o){t.sQpush8(150),t.sQpush8(i),t.sQpush16(r),t.sQpush16(s),t.sQpush16(n),t.sQpush16(o),t.flush()},pixelFormat:function(t,i,r){var s;i>16?s=32:i>8?s=16:s=8;var n=Math.floor(i/3);t.sQpush8(0),t.sQpush8(0),t.sQpush8(0),t.sQpush8(0),t.sQpush8(s),t.sQpush8(i),t.sQpush8(0),t.sQpush8(r?1:0),t.sQpush16((1<<n)-1),t.sQpush16((1<<n)-1),t.sQpush16((1<<n)-1),t.sQpush8(n*0),t.sQpush8(n*1),t.sQpush8(n*2),t.sQpush8(0),t.sQpush8(0),t.sQpush8(0),t.flush()},clientEncodings:function(t,i){t.sQpush8(2),t.sQpush8(0),t.sQpush16(i.length);for(var r=0;r<i.length;r++)t.sQpush32(i[r]);t.flush()},fbUpdateRequest:function(t,i,r,s,n,o){typeof r>"u"&&(r=0),typeof s>"u"&&(s=0),t.sQpush8(3),t.sQpush8(i?1:0),t.sQpush16(r),t.sQpush16(s),t.sQpush16(n),t.sQpush16(o),t.flush()},xvpOp:function(t,i,r){t.sQpush8(250),t.sQpush8(0),t.sQpush8(i),t.sQpush8(r),t.flush()}};di.cursors={none:{rgbaPixels:new Uint8Array,w:0,h:0,hotx:0,hoty:0},dot:{rgbaPixels:new Uint8Array([255,255,255,255,0,0,0,255,255,255,255,255,0,0,0,255,0,0,0,0,0,0,0,255,255,255,255,255,0,0,0,255,255,255,255,255]),w:3,h:3,hotx:1,hoty:1}}});var Si={$schema:"https://acode.app/schema/plugin/v0.1.0.json",id:"bajrangcoder.acodex",name:"AcodeX - Terminal",main:"dist/main.js",version:"3.2.0",readme:"readme.md",icon:"icon.png",files:[],minVersionCode:290,license:"MIT",keywords:["terminal","acodex","termux"],changelogs:"ChangeLog.md",contributors:[],author:{name:"Raunak Raj",email:"bajrangcoders@gmail.com",url:"https://github.com/bajrangCoder/acode-plugin-acodex",github:"bajrangCoder"}};function xf(e){let i=window.getComputedStyle(e).backgroundColor.match(/\d+/g),r=Number.parseFloat(i[3])||1;return`rgba(${i[0]}, ${i[1]}, ${i[2]}, 0.5)`}function Sf(e){let t="";for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);(r>=32&&r<=126||r===13||r===8)&&(t+=e[i])}return t}function go(e){return e.startsWith("content://com.termux.documents/tree")?e.split("::")[1].substring(0,e.split("::")[1].lastIndexOf("/")).replace(/^\/data\/data\/com\.termux\/files\/home/,"$HOME"):e.startsWith("file:///storage/emulated/0/")?`/sdcard${e.substr(26).replace(/\.[^/.]+$/,"").split("/").slice(0,-1).join("/")}/`:e.startsWith("content://com.android.externalstorage.documents/tree/primary")?`/sdcard/${e.split("::primary:")[1].substring(0,e.split("::primary:")[1].lastIndexOf("/"))}`:!1}function Cf(e,t){let i=e.replace("#",""),r=Number.parseInt(i.substring(0,2),16),s=Number.parseInt(i.substring(2,4),16),n=Number.parseInt(i.substring(4,6),16);return`rgba(${r}, ${s}, ${n}, ${t})`}var Se={snazzy:{background:"#282A36",foreground:"#EFF0EB",cursor:"#EFF0EB",black:"#0C0D13",red:"#FF5C57",green:"#5AF78E",yellow:"#F3F99D",blue:"#57C7FF",magenta:"#FF6AC1",cyan:"#9AEDFE",white:"#EFF0EB",brightBlack:"#686868",brightRed:"#FF5C57",brightGreen:"#5AF78E",brightYellow:"#F3F99D",brightBlue:"#57C7FF",brightMagenta:"#FF6AC1",brightCyan:"#9AEDFE",brightWhite:"#EFF0EB"},xterm:{foreground:"#F8F8F8",background:"#2D2E2C",selectionBackground:"#5DA5D533",black:"#1E1E1D",brightBlack:"#262625",red:"#CE5C5C",brightRed:"#FF7272",green:"#5BCC5B",brightGreen:"#72FF72",yellow:"#CCCC5B",brightYellow:"#FFFF72",blue:"#5D5DD3",brightBlue:"#7279FF",magenta:"#BC5ED1",brightMagenta:"#E572FF",cyan:"#5DA5D5",brightCyan:"#72F0FF",white:"#F8F8F8",brightWhite:"#FFFFFF"},sapphire:{background:"#1c2431",foreground:"#cccccc",selectionBackground:"#399ef440",black:"#666666",blue:"#399ef4",brightBlack:"#666666",brightBlue:"#399ef4",brightCyan:"#21c5c7",brightGreen:"#4eb071",brightMagenta:"#b168df",brightRed:"#da6771",brightWhite:"#efefef",brightYellow:"#fff099",cyan:"#21c5c7",green:"#4eb071",magenta:"#b168df",red:"#da6771",white:"#efefef",yellow:"#fff099"},light:{background:"#ffffff",foreground:"#333333",cursor:"#333333",cursorAccent:"#ffffff",selectionBackground:"#add6ff",black:"#000000",blue:"#0451a5",brightBlack:"#666666",brightBlue:"#0451a5",brightCyan:"#0598bc",brightGreen:"#14ce14",brightMagenta:"#bc05bc",brightRed:"#cd3131",brightWhite:"#a5a5a5",brightYellow:"#b5ba00",cyan:"#0598bc",green:"#00bc00",magenta:"#bc05bc",red:"#cd3131",white:"#555555",yellow:"#949800"},custom:{background:"#1c2431",foreground:"#cccccc",cursor:"#ffffff",cursorAccent:"#fff",selectionBackground:"#399ef440",black:"#666666",blue:"#399ef4",brightBlack:"#666666",brightBlue:"#399ef4",brightCyan:"#21c5c7",brightGreen:"#4eb071",brightMagenta:"#b168df",brightRed:"#da6771",brightWhite:"#efefef",brightYellow:"#fff099",cyan:"#21c5c7",green:"#4eb071",magenta:"#b168df",red:"#da6771",white:"#efefef",yellow:"#fff099"},ayuDark:{background:"#090D13",foreground:"#FEFEFE",cursor:"#E96B72",black:"#00050D",red:"#E96B72",green:"#90B261",yellow:"#F8AE4E",blue:"#52BCF9",magenta:"#F9E893",cyan:"#8FE0C5",white:"#C6C6C6",brightBlack:"#676767",brightRed:"#EF7077",brightGreen:"#C1D84B",brightYellow:"#FEB353",brightBlue:"#58C1FE",brightMagenta:"#FEED98",brightCyan:"#94E5CA",brightWhite:"#FEFEFE"},catppuccin:{background:"#1e1e2e",foreground:"#cdd6f4",cursor:"#f5e0dc",cursorAccent:"#1e1e2e",selection:"#585b70",black:"#45475a",red:"#f38ba8",green:"#a6e3a1",yellow:"#f9e2af",blue:"#89b4fa",magenta:"#f5c2e7",cyan:"#94e2d5",white:"#bac2de",brightBlack:"#585b70",brightRed:"#f38ba8",brightGreen:"#a6e3a1",brightYellow:"#f9e2af",brightBlue:"#89b4fa",brightMagenta:"#f5c2e7",brightCyan:"#94e2d5",brightWhite:"#a6adc8"},wal:{background:"#181820",foreground:"#e5e7eb",cursor:"#6366f1",cursorAccent:"#181820",selection:"#374151",black:"#0f0f14",red:"#f87171",green:"#4ade80",yellow:"#fbbf24",blue:"#6366f1",magenta:"#a78bfa",cyan:"#22d3ee",white:"#e5e7eb",brightBlack:"#1f1f2a",brightRed:"#fca5a5",brightGreen:"#86efac",brightYellow:"#fcd34d",brightBlue:"#818cf8",brightMagenta:"#c4b5fd",brightCyan:"#67e8f9",brightWhite:"#f3f4f6"},oneDark:{background:"#1E2127",foreground:"#5C6370",cursor:"#5C6370",black:"#000000",red:"#E06C75",green:"#98C379",yellow:"#D19A66",blue:"#61AFEF",magenta:"#C678DD",cyan:"#56B6C2",white:"#ABB2BF",brightBlack:"#5C6370",brightRed:"#E06C75",brightGreen:"#98C379",brightYellow:"#D19A66",brightBlue:"#61AFEF",brightMagenta:"#C678DD",brightCyan:"#56B6C2",brightWhite:"#FFFEFE"},material:{background:"#1E282C",foreground:"#C3C7D1",cursor:"#657B83",black:"#073641",red:"#EB606B",green:"#C3E88D",yellow:"#F7EB95",blue:"#80CBC3",magenta:"#FF2490",cyan:"#AEDDFF",white:"#FFFFFF",brightBlack:"#002B36",brightRed:"#EB606B",brightGreen:"#C3E88D",brightYellow:"#F7EB95",brightBlue:"#7DC6BF",brightMagenta:"#6C71C3",brightCyan:"#34434D",brightWhite:"#FFFFFF"},nekonakoDjancoeg:{background:"#2a2c3a",foreground:"#eeeeee",cursor:"#fd6b85",black:"#2f343f",red:"#fd6b85",green:"#63e0be",yellow:"#fed270",blue:"#67d4f2",magenta:"#ff8167",cyan:"#63e0be",white:"#eeeeee",brightBlack:"#4f4f5b",brightRed:"#fd6b85",brightGreen:"#63e0be",brightYellow:"#fed270",brightBlue:"#67d4f2",brightMagenta:"#ff8167",brightCyan:"#63e0be",brightWhite:"#eeeeee"},dracula:{background:"#282a36",foreground:"#94A3A5",cursor:"#94A3A5",black:"#44475a",red:"#ff5555",green:"#50fa7b",yellow:"#ffb86c",blue:"#8be9fd",magenta:"#bd93f9",cyan:"#ff79c6",white:"#94A3A5",brightBlack:"#000000",brightRed:"#ff5555",brightGreen:"#50fa7b",brightYellow:"#ffb86c",brightBlue:"#8be9fd",brightMagenta:"#bd93f9",brightCyan:"#ff79c6",brightWhite:"#ffffff"},ayuMirage:{background:"#1F2430",foreground:"#E5E0CE",cursor:"#E96B72",black:"#00050D",red:"#E96B72",green:"#90B261",yellow:"#F8AE4E",blue:"#52BCF9",magenta:"#F9E893",cyan:"#8FE0C5",white:"#C6C6C6",brightBlack:"#676767",brightRed:"#EF7077",brightGreen:"#C1D84B",brightYellow:"#FEB353",brightBlue:"#58C1FE",brightMagenta:"#FEED98",brightCyan:"#94E5CA",brightWhite:"#FEFEFE"},siduckOneDark:{background:"#1e222a",foreground:"#c8ccd4",cursor:"#e06c75",black:"#1e222a",red:"#e06c75",green:"#98c379",yellow:"#e5c07b",blue:"#61afef",magenta:"#c678dd",cyan:"#56b6c2",white:"#D8DEE9",brightBlack:"#545862",brightRed:"#e06c75",brightGreen:"#98c379",brightYellow:"#e5c07b",brightBlue:"#61afef",brightMagenta:"#c678dd",brightCyan:"#56b6c2",brightWhite:"#c8ccd4"},elementary:{background:"#101010",foreground:"#f2f2f2",cursor:"#f2f2f2",black:"#303030",red:"#e1321a",green:"#6ab017",yellow:"#ffc005",blue:"#004f9e",magenta:"#ec0048",cyan:"#2aa7e7",white:"#f2f2f2",brightBlack:"#5d5d5d",brightRed:"#ff361e",brightGreen:"#7bc91f",brightYellow:"#ffd00a",brightBlue:"#0071ff",brightMagenta:"#ff1d62",brightCyan:"#4bb8fd",brightWhite:"#a020f0"},ayuLight:{background:"#FEFEFE",foreground:"#090D13",cursor:"#E96B72",black:"#00050D",red:"#E96B72",green:"#90B261",yellow:"#F8AE4E",blue:"#52BCF9",magenta:"#F9E893",cyan:"#8FE0C5",white:"#c6c6c694",brightBlack:"#676767",brightRed:"#EF7077",brightGreen:"#C1D84B",brightYellow:"#FEB353",brightBlue:"#58C1FE",brightMagenta:"#FEED98",brightCyan:"#94E5CA",brightWhite:"#dacaca"},everblush:{name:"Everblush",background:"#141b1e",foreground:"#dadada",cursor:"#3b4244",black:"#232a2d",red:"#e57474",green:"#8ccf7e",yellow:"#e5c76b",blue:"#67b0e8",magenta:"#c47fd5",cyan:"#6cbfbf",white:"#b3b9b8",brightBlack:"#2d3437",brightRed:"#ef7e7e",brightGreen:"#96d988",brightYellow:"#f4d67a",brightBlue:"#71baf2",brightMagenta:"#ce89df",brightCyan:"#67cbe7",brightWhite:"#bdc3c2"}};var st=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof global<"u"&&global||{},_t={searchParams:"URLSearchParams"in st,iterable:"Symbol"in st&&"iterator"in Symbol,blob:"FileReader"in st&&"Blob"in st&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in st,arrayBuffer:"ArrayBuffer"in st};function pw(e){return e&&DataView.prototype.isPrototypeOf(e)}_t.arrayBuffer&&(kf=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],Bf=ArrayBuffer.isView||function(e){return e&&kf.indexOf(Object.prototype.toString.call(e))>-1});var kf,Bf;function Zr(e){if(typeof e!="string"&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||e==="")throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function Jl(e){return typeof e!="string"&&(e=String(e)),e}function Zl(e){var t={next:function(){var i=e.shift();return{done:i===void 0,value:i}}};return _t.iterable&&(t[Symbol.iterator]=function(){return t}),t}function Ue(e){this.map={},e instanceof Ue?e.forEach(function(t,i){this.append(i,t)},this):Array.isArray(e)?e.forEach(function(t){if(t.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+t.length);this.append(t[0],t[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}Ue.prototype.append=function(e,t){e=Zr(e),t=Jl(t);var i=this.map[e];this.map[e]=i?i+", "+t:t};Ue.prototype.delete=function(e){delete this.map[Zr(e)]};Ue.prototype.get=function(e){return e=Zr(e),this.has(e)?this.map[e]:null};Ue.prototype.has=function(e){return this.map.hasOwnProperty(Zr(e))};Ue.prototype.set=function(e,t){this.map[Zr(e)]=Jl(t)};Ue.prototype.forEach=function(e,t){for(var i in this.map)this.map.hasOwnProperty(i)&&e.call(t,this.map[i],i,this)};Ue.prototype.keys=function(){var e=[];return this.forEach(function(t,i){e.push(i)}),Zl(e)};Ue.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),Zl(e)};Ue.prototype.entries=function(){var e=[];return this.forEach(function(t,i){e.push([i,t])}),Zl(e)};_t.iterable&&(Ue.prototype[Symbol.iterator]=Ue.prototype.entries);function Yl(e){if(!e._noBody){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}}function Lf(e){return new Promise(function(t,i){e.onload=function(){t(e.result)},e.onerror=function(){i(e.error)}})}function gw(e){var t=new FileReader,i=Lf(t);return t.readAsArrayBuffer(e),i}function mw(e){var t=new FileReader,i=Lf(t),r=/charset=([A-Za-z0-9_-]+)/.exec(e.type),s=r?r[1]:"utf-8";return t.readAsText(e,s),i}function vw(e){for(var t=new Uint8Array(e),i=new Array(t.length),r=0;r<t.length;r++)i[r]=String.fromCharCode(t[r]);return i.join("")}function Ef(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function Df(){return this.bodyUsed=!1,this._initBody=function(e){this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?typeof e=="string"?this._bodyText=e:_t.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:_t.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:_t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():_t.arrayBuffer&&_t.blob&&pw(e)?(this._bodyArrayBuffer=Ef(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):_t.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||Bf(e))?this._bodyArrayBuffer=Ef(e):this._bodyText=e=Object.prototype.toString.call(e):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof e=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):_t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},_t.blob&&(this.blob=function(){var e=Yl(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=Yl(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(_t.blob)return this.blob().then(gw);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var e=Yl(this);if(e)return e;if(this._bodyBlob)return mw(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(vw(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},_t.formData&&(this.formData=function(){return this.text().then(ww)}),this.json=function(){return this.text().then(JSON.parse)},this}var yw=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function bw(e){var t=e.toUpperCase();return yw.indexOf(t)>-1?t:e}function Lr(e,t){if(!(this instanceof Lr))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');t=t||{};var i=t.body;if(e instanceof Lr){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new Ue(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,!i&&e._bodyInit!=null&&(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",(t.headers||!this.headers)&&(this.headers=new Ue(t.headers)),this.method=bw(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal||function(){if("AbortController"in st){var n=new AbortController;return n.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&i)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(i),(this.method==="GET"||this.method==="HEAD")&&(t.cache==="no-store"||t.cache==="no-cache")){var r=/([?&])_=[^&]*/;if(r.test(this.url))this.url=this.url.replace(r,"$1_="+new Date().getTime());else{var s=/\?/;this.url+=(s.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}Lr.prototype.clone=function(){return new Lr(this,{body:this._bodyInit})};function ww(e){var t=new FormData;return e.trim().split("&").forEach(function(i){if(i){var r=i.split("="),s=r.shift().replace(/\+/g," "),n=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(s),decodeURIComponent(n))}}),t}function Aw(e){var t=new Ue,i=e.replace(/\r?\n[\t ]+/g," ");return i.split("\r").map(function(r){return r.indexOf(`
`)===0?r.substr(1,r.length):r}).forEach(function(r){var s=r.split(":"),n=s.shift().trim();if(n){var o=s.join(":").trim();try{t.append(n,o)}catch(a){console.warn("Response "+a.message)}}}),t}Df.call(Lr.prototype);function si(e,t){if(!(this instanceof si))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(t||(t={}),this.type="default",this.status=t.status===void 0?200:t.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=t.statusText===void 0?"":""+t.statusText,this.headers=new Ue(t.headers),this.url=t.url||"",this._initBody(e)}Df.call(si.prototype);si.prototype.clone=function(){return new si(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Ue(this.headers),url:this.url})};si.error=function(){var e=new si(null,{status:200,statusText:""});return e.ok=!1,e.status=0,e.type="error",e};var xw=[301,302,303,307,308];si.redirect=function(e,t){if(xw.indexOf(t)===-1)throw new RangeError("Invalid status code");return new si(null,{status:t,headers:{location:e}})};var Br=st.DOMException;try{new Br}catch{Br=function(t,i){this.message=t,this.name=i;var r=Error(t);this.stack=r.stack},Br.prototype=Object.create(Error.prototype),Br.prototype.constructor=Br}function If(e,t){return new Promise(function(i,r){var s=new Lr(e,t);if(s.signal&&s.signal.aborted)return r(new Br("Aborted","AbortError"));var n=new XMLHttpRequest;function o(){n.abort()}n.onload=function(){var l={statusText:n.statusText,headers:Aw(n.getAllResponseHeaders()||"")};s.url.indexOf("file://")===0&&(n.status<200||n.status>599)?l.status=200:l.status=n.status,l.url="responseURL"in n?n.responseURL:l.headers.get("X-Request-URL");var c="response"in n?n.response:n.responseText;setTimeout(function(){i(new si(c,l))},0)},n.onerror=function(){setTimeout(function(){r(new TypeError("Network request failed"))},0)},n.ontimeout=function(){setTimeout(function(){r(new TypeError("Network request timed out"))},0)},n.onabort=function(){setTimeout(function(){r(new Br("Aborted","AbortError"))},0)};function a(l){try{return l===""&&st.location.href?st.location.href:l}catch{return l}}if(n.open(s.method,a(s.url),!0),s.credentials==="include"?n.withCredentials=!0:s.credentials==="omit"&&(n.withCredentials=!1),"responseType"in n&&(_t.blob?n.responseType="blob":_t.arrayBuffer&&(n.responseType="arraybuffer")),t&&typeof t.headers=="object"&&!(t.headers instanceof Ue||st.Headers&&t.headers instanceof st.Headers)){var h=[];Object.getOwnPropertyNames(t.headers).forEach(function(l){h.push(Zr(l)),n.setRequestHeader(l,Jl(t.headers[l]))}),s.headers.forEach(function(l,c){h.indexOf(c)===-1&&n.setRequestHeader(c,l)})}else s.headers.forEach(function(l,c){n.setRequestHeader(c,l)});s.signal&&(s.signal.addEventListener("abort",o),n.onreadystatechange=function(){n.readyState===4&&s.signal.removeEventListener("abort",o)}),n.send(typeof s._bodyInit>"u"?null:s._bodyInit)})}If.polyfill=!0;st.fetch||(st.fetch=If,st.Headers=Ue,st.Request=Lr,st.Response=si);var Sw="0.5.13",Tf="11434",Rf=`http://127.0.0.1:${Tf}`,Cw=Object.defineProperty,kw=(e,t,i)=>t in e?Cw(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,eh=(e,t,i)=>(kw(e,typeof t!="symbol"?t+"":t,i),i),ih=class e extends Error{constructor(t,i){super(t),this.error=t,this.status_code=i,this.name="ResponseError",Error.captureStackTrace&&Error.captureStackTrace(this,e)}},rh=class{constructor(t,i,r){eh(this,"abortController"),eh(this,"itr"),eh(this,"doneCallback"),this.abortController=t,this.itr=i,this.doneCallback=r}abort(){this.abortController.abort()}async*[Symbol.asyncIterator](){for await(let t of this.itr){if("error"in t)throw new Error(t.error);if(yield t,t.done||t.status==="success"){this.doneCallback();return}}throw new Error("Did not receive done or success response in stream.")}},sh=async e=>{if(e.ok)return;let t=`Error ${e.status}: ${e.statusText}`,i=null;if(e.headers.get("content-type")?.includes("application/json"))try{i=await e.json(),t=i.error||t}catch{console.log("Failed to parse error response as JSON")}else try{console.log("Getting text from response"),t=await e.text()||t}catch{console.log("Failed to get text from error response")}throw new ih(t,e.status)};function Ew(){return typeof window<"u"&&window.navigator?`${window.navigator.platform.toLowerCase()} Browser/${navigator.userAgent};`:typeof process<"u"?`${process.arch} ${process.platform} Node.js/${process.version}`:""}var nh=async(e,t,i={})=>{let r={"Content-Type":"application/json",Accept:"application/json","User-Agent":`ollama-js/${Sw} (${Ew()})`};i.headers||(i.headers={});let s=Object.fromEntries(Object.entries(i.headers).filter(([n])=>!Object.keys(r).some(o=>o.toLowerCase()===n.toLowerCase())));return i.headers={...r,...s},e(t,i)},Mf=async(e,t,i)=>{let r=await nh(e,t,{headers:i?.headers});return await sh(r),r},es=async(e,t,i,r)=>{let n=(a=>a!==null&&typeof a=="object"&&!Array.isArray(a))(i)?JSON.stringify(i):i,o=await nh(e,t,{method:"POST",body:n,signal:r?.signal,headers:r?.headers});return await sh(o),o},Bw=async(e,t,i,r)=>{let s=await nh(e,t,{method:"DELETE",body:JSON.stringify(i),headers:r?.headers});return await sh(s),s},Lw=async function*(e){let t=new TextDecoder("utf-8"),i="",r=e.getReader();for(;;){let{done:s,value:n}=await r.read();if(s)break;i+=t.decode(n);let o=i.split(`
`);i=o.pop()??"";for(let a of o)try{yield JSON.parse(a)}catch{console.warn("invalid json: ",a)}}for(let s of i.split(`
`).filter(n=>n!==""))try{yield JSON.parse(s)}catch{console.warn("invalid json: ",s)}},Dw=e=>{if(!e)return Rf;let t=e.includes("://");e.startsWith(":")&&(e=`http://127.0.0.1${e}`,t=!0),t||(e=`http://${e}`);let i=new URL(e),r=i.port;r||(t?r=i.protocol==="https:"?"443":"80":r=Tf);let s=`${i.protocol}//${i.hostname}:${r}${i.pathname}`;return s.endsWith("/")&&(s=s.slice(0,-1)),s},Iw=Object.defineProperty,Mw=(e,t,i)=>t in e?Iw(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,th=(e,t,i)=>(Mw(e,typeof t!="symbol"?t+"":t,i),i),oh=class{constructor(t){th(this,"config"),th(this,"fetch"),th(this,"ongoingStreamedRequests",[]),this.config={host:"",headers:t?.headers},t?.proxy||(this.config.host=Dw(t?.host??Rf)),this.fetch=t?.fetch??fetch}abort(){for(let t of this.ongoingStreamedRequests)t.abort();this.ongoingStreamedRequests.length=0}async processStreamableRequest(t,i){i.stream=i.stream??!1;let r=`${this.config.host}/api/${t}`;if(i.stream){let n=new AbortController,o=await es(this.fetch,r,i,{signal:n.signal,headers:this.config.headers});if(!o.body)throw new Error("Missing body");let a=Lw(o.body),h=new rh(n,a,()=>{let l=this.ongoingStreamedRequests.indexOf(h);l>-1&&this.ongoingStreamedRequests.splice(l,1)});return this.ongoingStreamedRequests.push(h),h}return await(await es(this.fetch,r,i,{headers:this.config.headers})).json()}async encodeImage(t){if(typeof t!="string"){let i=new Uint8Array(t),r="",s=i.byteLength;for(let n=0;n<s;n++)r+=String.fromCharCode(i[n]);return btoa(r)}return t}async generate(t){return t.images&&(t.images=await Promise.all(t.images.map(this.encodeImage.bind(this)))),this.processStreamableRequest("generate",t)}async chat(t){if(t.messages)for(let i of t.messages)i.images&&(i.images=await Promise.all(i.images.map(this.encodeImage.bind(this))));return this.processStreamableRequest("chat",t)}async create(t){return this.processStreamableRequest("create",{...t})}async pull(t){return this.processStreamableRequest("pull",{name:t.model,stream:t.stream,insecure:t.insecure})}async push(t){return this.processStreamableRequest("push",{name:t.model,stream:t.stream,insecure:t.insecure})}async delete(t){return await Bw(this.fetch,`${this.config.host}/api/delete`,{name:t.model},{headers:this.config.headers}),{status:"success"}}async copy(t){return await es(this.fetch,`${this.config.host}/api/copy`,{...t},{headers:this.config.headers}),{status:"success"}}async list(){return await(await Mf(this.fetch,`${this.config.host}/api/tags`,{headers:this.config.headers})).json()}async show(t){return await(await es(this.fetch,`${this.config.host}/api/show`,{...t},{headers:this.config.headers})).json()}async embed(t){return await(await es(this.fetch,`${this.config.host}/api/embed`,{...t},{headers:this.config.headers})).json()}async embeddings(t){return await(await es(this.fetch,`${this.config.host}/api/embeddings`,{...t},{headers:this.config.headers})).json()}async ps(){return await(await Mf(this.fetch,`${this.config.host}/api/ps`,{headers:this.config.headers})).json()}},U4=new oh;var ah=class{constructor(t=null){if(this.apiKey=t,this.deepseekAPI="https://api.deepseek.com/v1/chat/completions",this.chatgptAPI="https://api.openai.com/v1/chat/completions",this.geminiAPI=`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-lite:generateContent?key=${this.apiKey}`,!t){let i=localStorage.getItem("Ollama-Host")||"http://localhost:11434";this.ollama=new oh({host:i})}}getSystemPrompt(){return`You are a terminal command assistant designed to help users with command-line tasks. Only respond with the exact command(s) needed, with no explanations or markdown formatting. Examples:
    - 'Show current directory': pwd
    - 'List all files': ls -la
    - 'Create new folder docs': mkdir docs
    If a query is not related to terminal commands, do not respond. Multiple commands should be separated by semicolons. Keep responses minimal and focused only on valid terminal commands.`}async generateDeepseekResponse(t){let i={model:"deepseek-chat",messages:[{role:"system",content:this.getSystemPrompt()},{role:"user",content:t}]};return this._fetchAndProcessResponse(this.deepseekAPI,i,this.apiKey)}async generateChatgptResponse(t){let i={model:"gpt-3.5-turbo-0125",messages:[{role:"system",content:this.getSystemPrompt()},{role:"user",content:t}]};return this._fetchAndProcessResponse(this.chatgptAPI,i,this.apiKey)}async generateGeminiResponse(t){let r={contents:[{parts:[{text:`${this.getSystemPrompt()} My query: ${t}`}]}]};return this._fetchAndProcessResponse(this.geminiAPI,r,null)}async getListOfOllamaModels(){try{return(await this.ollama.list()).models.map(r=>r.model)}catch(t){return t}}async generateOllamaResponse(t,i){try{return await this.ollama.generate({model:t,system:this.getSystemPrompt(),prompt:i})}catch(r){return r}}async _fetchAndProcessResponse(t,i,r){try{let s={"Content-Type":"application/json"};r&&(s.Authorization=`Bearer ${r}`);let n=await fetch(t,{method:"POST",headers:s,body:JSON.stringify(i)}),o=await n.json();if(n.ok)return{response:o};throw new Error(o.detail?o.detail:o.error.message||"Failed to fetch response")}catch(s){return{error:s.message}}}},Ff=ah;var Hs=class{constructor(t,i,r={},s={}){this.terminal=t,this.terminalContainer=i,this.settings=r,this.options={tapHoldDuration:600,moveThreshold:8,handleSize:24,fingerOffset:40,hapticFeedback:!!r?.selectionHaptics,showContextMenu:!0,zoomThrottle:50,minFontSize:8,maxFontSize:48,onFontSizeChange:null,...s},this.options.minFontSize=Number(this.options.minFontSize)||8,this.options.maxFontSize=Number(this.options.maxFontSize)||48,this.options.minFontSize>this.options.maxFontSize&&([this.options.minFontSize,this.options.maxFontSize]=[this.options.maxFontSize,this.options.minFontSize]),typeof this.options.onFontSizeChange!="function"&&(this.options.onFontSizeChange=n=>{this.terminal.options.fontSize=n,this.terminal.refresh?.(0,this.terminal.rows-1)}),this.isSelecting=!1,this.isHandleDragging=!1,this.selectionStart=null,this.selectionEnd=null,this.currentSelection=null,this.dragHandle=null,this.touchStartTime=0,this.touchStartPos={x:0,y:0},this.initialTouchPos={x:0,y:0},this.tapHoldTimeout=null,this.isPinching=!1,this.pinchStartDistance=0,this.lastPinchDistance=0,this.initialFontSize=0,this.lastZoomTime=0,this.selectionOverlay=null,this.startHandle=null,this.endHandle=null,this.contextMenu=null,this.contextMenuShouldStayVisible=!1,this.cellDimensions={width:0,height:0},this.boundHandlers={},this.wasFocusedBeforeSelection=!1,this.selectionProtected=!1,this.protectionTimeout=null,this.selectionChangeDisposable=null,this.resizeDisposable=null,this.init()}init(){this.createSelectionOverlay(),this.createHandles(),this.attachEventListeners(),this.updateCellDimensions()}createSelectionOverlay(){this.selectionOverlay=document.createElement("div"),this.selectionOverlay.className="terminal-selection-overlay",this.selectionOverlay.style.pointerEvents="none",this.terminalContainer.appendChild(this.selectionOverlay)}createHandles(){this.startHandle=this.createHandle("start"),this.endHandle=this.createHandle("end"),this.selectionOverlay.appendChild(this.startHandle),this.selectionOverlay.appendChild(this.endHandle)}createHandle(t){let i=document.createElement("div");return i.className=`terminal-selection-handle terminal-selection-handle-${t}`,i.style.width=`${this.options.handleSize}px`,i.style.height=`${this.options.handleSize}px`,i.style.display="none",i.dataset.handleType=t,i}attachEventListeners(){this.boundHandlers.terminalTouchStart=this.onTerminalTouchStart.bind(this),this.boundHandlers.terminalTouchMove=this.onTerminalTouchMove.bind(this),this.boundHandlers.terminalTouchEnd=this.onTerminalTouchEnd.bind(this),this.boundHandlers.selectionChange=this.onSelectionChange.bind(this),this.boundHandlers.terminalAreaTouchStart=this.onTerminalAreaTouchStart.bind(this),this.boundHandlers.handleTouchStart=this.onHandleTouchStart.bind(this),this.boundHandlers.handleTouchMove=this.onHandleTouchMove.bind(this),this.boundHandlers.handleTouchEnd=this.onHandleTouchEnd.bind(this),this.boundHandlers.orientationChange=this.onOrientationChange.bind(this),this.boundHandlers.terminalScroll=this.onTerminalScroll.bind(this),this.boundHandlers.terminalResize=this.onTerminalResize.bind(this),this.boundHandlers.documentTouchStart=this.onDocumentTouchStart.bind(this),this.terminal.element.addEventListener("touchstart",this.boundHandlers.terminalTouchStart,{passive:!1}),this.terminal.element.addEventListener("touchmove",this.boundHandlers.terminalTouchMove,{passive:!1}),this.terminal.element.addEventListener("touchend",this.boundHandlers.terminalTouchEnd,{passive:!1}),this.terminal.element.addEventListener("touchstart",this.boundHandlers.terminalAreaTouchStart,{passive:!1}),this.terminal.element.addEventListener("scroll",this.boundHandlers.terminalScroll,{passive:!0}),this.startHandle.addEventListener("touchstart",this.boundHandlers.handleTouchStart,{passive:!1}),this.startHandle.addEventListener("touchmove",this.boundHandlers.handleTouchMove,{passive:!1}),this.startHandle.addEventListener("touchend",this.boundHandlers.handleTouchEnd,{passive:!1}),this.endHandle.addEventListener("touchstart",this.boundHandlers.handleTouchStart,{passive:!1}),this.endHandle.addEventListener("touchmove",this.boundHandlers.handleTouchMove,{passive:!1}),this.endHandle.addEventListener("touchend",this.boundHandlers.handleTouchEnd,{passive:!1}),this.selectionChangeDisposable=this.terminal.onSelectionChange?this.terminal.onSelectionChange(this.boundHandlers.selectionChange):null,this.resizeDisposable=this.terminal.onResize?this.terminal.onResize(this.boundHandlers.terminalResize):null,window.addEventListener("orientationchange",this.boundHandlers.orientationChange),window.addEventListener("resize",this.boundHandlers.orientationChange),document.addEventListener("touchstart",this.boundHandlers.documentTouchStart,{passive:!0})}onTerminalTouchStart(t){if(t.touches.length===2){t.preventDefault(),this.startPinchZoom(t);return}if(t.touches.length!==1)return;let i=t.touches[0];this.touchStartTime=Date.now(),this.touchStartPos={x:i.clientX,y:i.clientY},this.initialTouchPos={x:i.clientX,y:i.clientY},!this.isSelecting&&(this.isEdgeGesture(i)||(this.tapHoldTimeout&&clearTimeout(this.tapHoldTimeout),this.tapHoldTimeout=setTimeout(()=>{!this.isSelecting&&!this.isPinching&&this.startSelection(i)},this.options.tapHoldDuration)))}onTerminalTouchMove(t){if(t.touches.length===2){t.preventDefault(),this.handlePinchZoom(t);return}if(t.touches.length!==1||this.isPinching)return;let i=t.touches[0],r=Math.abs(i.clientX-this.touchStartPos.x),s=Math.abs(i.clientY-this.touchStartPos.y),n=i.clientX-this.touchStartPos.x;if(this.isEdgeGesture(this.initialTouchPos)&&Math.abs(n)>s&&r>this.options.moveThreshold){this.tapHoldTimeout&&(clearTimeout(this.tapHoldTimeout),this.tapHoldTimeout=null);return}(r>this.options.moveThreshold||s>this.options.moveThreshold)&&(this.tapHoldTimeout&&(clearTimeout(this.tapHoldTimeout),this.tapHoldTimeout=null),this.isSelecting&&!this.isHandleDragging&&(t.preventDefault(),this.extendSelection(i)))}onTerminalTouchEnd(){if(this.isPinching){this.endPinchZoom();return}this.tapHoldTimeout&&(clearTimeout(this.tapHoldTimeout),this.tapHoldTimeout=null),this.isSelecting&&!this.isHandleDragging?this.finalizeSelection():this.isSelecting||this.isTerminalFocused()&&this.terminal.focus()}onHandleTouchStart(t){if(t.preventDefault(),t.stopPropagation(),t.touches.length!==1)return;let i=t.target.dataset.handleType;if(i||(t.target===this.startHandle||this.startHandle.contains(t.target)?i="start":(t.target===this.endHandle||this.endHandle.contains(t.target))&&(i="end")),!i)return;this.isHandleDragging=!0,this.dragHandle=i;let r=t.touches[0];this.initialTouchPos={x:r.clientX,y:r.clientY};let s=i==="start"?this.startHandle:this.endHandle;s.style.cursor="grabbing",s.style.setProperty("--handle-scale","1.2")}onHandleTouchMove(t){if(!this.isHandleDragging||t.touches.length!==1)return;t.preventDefault(),t.stopPropagation();let i=t.touches[0],r=Math.abs(i.clientX-this.initialTouchPos.x),s=Math.abs(i.clientY-this.initialTouchPos.y);if(r<this.options.moveThreshold&&s<this.options.moveThreshold)return;let n={clientX:i.clientX,clientY:i.clientY-this.options.fingerOffset},o=this.touchToTerminalCoords(n);if(o){if(this.dragHandle==="start"){if(this.selectionStart=o,this.selectionEnd&&(o.row>this.selectionEnd.row||o.row===this.selectionEnd.row&&o.col>this.selectionEnd.col)){let a=this.selectionStart;this.selectionStart=this.selectionEnd,this.selectionEnd=a,this.dragHandle="end"}}else if(this.selectionEnd=o,this.selectionStart&&(o.row<this.selectionStart.row||o.row===this.selectionStart.row&&o.col<this.selectionStart.col)){let a=this.selectionEnd;this.selectionEnd=this.selectionStart,this.selectionStart=a,this.dragHandle="start"}this.updateSelection()}}onHandleTouchEnd(t){this.isHandleDragging&&(t.preventDefault(),t.stopPropagation(),this.isHandleDragging=!1,this.dragHandle=null,[this.startHandle,this.endHandle].forEach(i=>{i.style.cursor="grab",i.style.removeProperty("--handle-scale")}),this.finalizeSelection())}onSelectionChange(){if(!this.isSelecting)return;let t=this.terminal.getSelection?.();t&&t.length>0&&(this.currentSelection=t,this.updateHandlePositions())}onTerminalAreaTouchStart(t){if(!this.isSelecting||this.selectionProtected)return;if(this.contextMenu&&this.contextMenu.style.display==="flex"){let r=this.contextMenu.getBoundingClientRect(),s=t.touches[0];if(s.clientX>=r.left&&s.clientX<=r.right&&s.clientY>=r.top&&s.clientY<=r.bottom)return}!(this.startHandle.contains(t.target)||this.endHandle.contains(t.target))&&this.terminal.element.contains(t.target)&&this.clearSelection()}onDocumentTouchStart(t){this.isSelecting&&t.target&&(this.terminalContainer.contains(t.target)||this.forceClearSelection())}onOrientationChange(){setTimeout(()=>{this.updateCellDimensions(),this.isSelecting&&this.updateHandlePositions()},100)}onTerminalScroll(){this.isSelecting&&(this.updateHandlePositions(),this.contextMenu&&this.contextMenu.style.display==="flex"&&this.hideContextMenu())}onTerminalResize(t){setTimeout(()=>{if(this.updateCellDimensions(),!!this.isSelecting){if(this.selectionProtected){this.updateHandlePositions();return}if(this.selectionStart&&this.selectionEnd&&(this.selectionStart.row>=t.rows||this.selectionEnd.row>=t.rows)){this.clearSelection();return}this.updateHandlePositions(),this.contextMenu&&this.contextMenu.style.display==="flex"&&(this.hideContextMenu(),setTimeout(()=>{this.isSelecting&&this.options.showContextMenu&&this.showContextMenu()},100))}},50)}startSelection(t){let i=this.touchToTerminalCoords(t);if(!i)return;this.wasFocusedBeforeSelection=this.isTerminalFocused(),this.selectionProtected=!0,this.protectionTimeout&&clearTimeout(this.protectionTimeout),this.protectionTimeout=setTimeout(()=>{this.selectionProtected=!1},1e3),this.isSelecting=!0;let r=this.getWordBoundsAt(i);r?(this.selectionStart=r.start,this.selectionEnd=r.end):(this.selectionStart=i,this.selectionEnd=i),this.terminal.clearSelection?.(),this.updateSelection(),this.currentSelection=this.terminal.getSelection?.(),this.showHandles(),this.options.showContextMenu&&this.showContextMenu(),this.options.hapticFeedback&&navigator?.vibrate&&navigator.vibrate(50)}extendSelection(t){let i=this.touchToTerminalCoords(t);i&&(this.selectionEnd=i,this.updateSelection())}updateSelection(){if(!this.selectionStart||!this.selectionEnd)return;let t=this.selectionStart,i=this.selectionEnd,r=t.row,s=t.col,n=i.row,o=i.col;(r>n||r===n&&s>o)&&([r,s,n,o]=[n,o,r,s]);let a=this.calculateSelectionLength(r,s,n,o);this.terminal.clearSelection?.(),this.terminal.select?.(s,r,a),this.updateHandlePositions(),this.contextMenuShouldStayVisible&&this.options.showContextMenu&&this.showContextMenu()}calculateSelectionLength(t,i,r,s){if(t===r)return s-i+1;let n=this.terminal.cols,o=n-i;return o+=(r-t-1)*n,o+=s+1,o}finalizeSelection(){this.options.showContextMenu&&this.currentSelection&&this.showContextMenu()}showHandles(){this.startHandle.style.display="block",this.endHandle.style.display="block",this.updateHandlePositions()}hideHandles(){this.startHandle.style.display="none",this.endHandle.style.display="none"}updateHandlePositions(){if(!this.selectionStart||!this.selectionEnd)return;let t=this.selectionStart,i=this.selectionEnd;(this.selectionStart.row>this.selectionEnd.row||this.selectionStart.row===this.selectionEnd.row&&this.selectionStart.col>this.selectionEnd.col)&&(t=this.selectionEnd,i=this.selectionStart);let r=this.terminalCoordsToPixels(t),s=this.terminalCoordsToPixels(i);r?(this.startHandle.style.display="block",this.startHandle.style.left=`${r.x}px`,this.startHandle.style.top=`${r.y+this.cellDimensions.height+4}px`):this.startHandle.style.display="none",s?(this.endHandle.style.display="block",this.endHandle.style.left=`${s.x+this.cellDimensions.width}px`,this.endHandle.style.top=`${s.y+this.cellDimensions.height+4}px`):this.endHandle.style.display="none"}showContextMenu(){if(!this.options.showContextMenu)return;this.contextMenu||this.createContextMenu(),this.contextMenuShouldStayVisible=!0;let t=this.terminalCoordsToPixels(this.selectionStart),i=this.terminalCoordsToPixels(this.selectionEnd);if(!t&&!i)return;let r,s;t&&i?(r=(t.x+i.x)/2,s=Math.max(t.y,i.y)):t?(r=t.x,s=t.y):(r=i.x,s=i.y);let n=this.contextMenu.offsetWidth||200,o=this.contextMenu.offsetHeight||50,a=this.terminalContainer.getBoundingClientRect(),h=r-n/2,l=s+this.cellDimensions.height+40,c=10,u=a.width-n-10;h=Math.max(c,Math.min(h,u));let g=a.height-o-10;l>g&&(l=(t&&i?Math.min(t.y,i.y):s)-o-10),l=Math.max(10,Math.min(l,g)),this.contextMenu.style.left=`${h}px`,this.contextMenu.style.top=`${l}px`,this.contextMenu.style.display="flex"}createContextMenu(){this.contextMenu=document.createElement("div"),this.contextMenu.className="terminal-context-menu",[{label:this.getString("copy","Copy"),action:this.copySelection.bind(this)},{label:this.getString("paste","Paste"),action:this.pasteFromClipboard.bind(this)},{label:this.getString("more","More..."),action:this.showMoreOptions.bind(this)}].forEach(i=>{let r=document.createElement("button");r.textContent=i.label;let s=!1,n=o=>{o.preventDefault(),o.stopPropagation(),s||(s=!0,i.action())};r.addEventListener("touchstart",o=>{o.preventDefault(),o.stopPropagation(),s=!1}),r.addEventListener("touchend",n),r.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation(),s=!1}),r.addEventListener("mouseup",n),r.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation()}),this.contextMenu.appendChild(r)}),this.selectionOverlay.appendChild(this.contextMenu)}hideContextMenu(){this.contextMenu&&!this.contextMenuShouldStayVisible&&(this.contextMenu.style.display="none")}forceHideContextMenu(){this.contextMenu&&(this.contextMenu.style.display="none",this.contextMenuShouldStayVisible=!1)}copySelection(){let t=this.currentSelection||this.terminal.getSelection?.();t&&cordova?.plugins?.clipboard&&cordova.plugins.clipboard.copy(t),this.forceClearSelection()}pasteFromClipboard(){cordova?.plugins?.clipboard&&cordova.plugins.clipboard.paste(t=>{t&&this.terminal.paste?.(t),this.forceClearSelection()})}showMoreOptions(){window.toast?.("More options are not implemented yet."),this.forceClearSelection()}clearSelection(){if(this.selectionProtected)return;let t=this.wasFocusedBeforeSelection&&this.isSelecting;this.isSelecting=!1,this.isHandleDragging=!1,this.selectionStart=null,this.selectionEnd=null,this.currentSelection=null,this.dragHandle=null,this.terminal.clearSelection?.(),this.hideHandles(),this.forceHideContextMenu(),this.tapHoldTimeout&&(clearTimeout(this.tapHoldTimeout),this.tapHoldTimeout=null),this.protectionTimeout&&(clearTimeout(this.protectionTimeout),this.protectionTimeout=null),this.selectionProtected=!1,t&&!this.isTerminalFocused()&&setTimeout(()=>{this.isSelecting||this.terminal.focus?.()},150),this.wasFocusedBeforeSelection=!1}forceClearSelection(){let t=this.selectionProtected;this.selectionProtected=!1,this.clearSelection(),this.selectionProtected=t&&this.isSelecting}touchToTerminalCoords(t){let i=this.terminal.element.getBoundingClientRect(),r=t.clientX-i.left,s=t.clientY-i.top;if(r<0||s<0||r>i.width||s>i.height||((!this.cellDimensions.width||!this.cellDimensions.height)&&this.updateCellDimensions(),!this.cellDimensions.width||!this.cellDimensions.height))return null;let n=Math.floor(r/this.cellDimensions.width),o=Math.floor(s/this.cellDimensions.height)+this.terminal.buffer.active.viewportY;return{col:Math.max(0,Math.min(n,this.terminal.cols-1)),row:Math.max(0,o)}}terminalCoordsToPixels(t){if(!t)return null;(!this.cellDimensions.width||!this.cellDimensions.height)&&this.updateCellDimensions();let i=this.terminal.element.getBoundingClientRect(),r=this.terminalContainer.getBoundingClientRect(),s=t.col*this.cellDimensions.width+(i.left-r.left),n=(t.row-this.terminal.buffer.active.viewportY)*this.cellDimensions.height+(i.top-r.top);return t.row>=this.terminal.buffer.active.viewportY&&t.row<this.terminal.buffer.active.viewportY+this.terminal.rows?{x:s,y:n}:null}updateCellDimensions(){let t=this.terminal?._core?._renderService?.dimensions;if(t?.css?.cell){this.cellDimensions={width:t.css.cell.width,height:t.css.cell.height};return}let i=this.terminal.element.getBoundingClientRect(),r=this.terminal.cols||1,s=this.terminal.rows||1;this.cellDimensions={width:i.width/r,height:i.height/s}}isTerminalFocused(){try{return document.activeElement===this.terminal.element||this.terminal.element.contains(document.activeElement)||this.terminal._core?._hasFocus}catch{return!1}}getWordBoundsAt(t){try{let r=this.terminal.buffer.active.getLine(t.row);if(!r)return null;let s=r.translateToString(!1);if(!s||t.col>=s.length)return null;let n=s[t.col];if(!this.isWordCharacter(n))return null;let o=t.col;for(;o>0&&this.isWordCharacter(s[o-1]);)o--;let a=t.col;for(;a<s.length-1&&this.isWordCharacter(s[a+1]);)a++;return a>=o?{start:{row:t.row,col:o},end:{row:t.row,col:a}}:null}catch(i){return console.warn("Error finding word bounds:",i),null}}isWordCharacter(t){return t?/[a-zA-Z0-9_\-.]/.test(t):!1}startPinchZoom(t){if(t.touches.length!==2)return;this.isPinching=!0,this.initialFontSize=this.terminal.options.fontSize;let i=t.touches[0],r=t.touches[1];this.pinchStartDistance=this.getDistance(i,r),this.lastPinchDistance=this.pinchStartDistance,this.tapHoldTimeout&&(clearTimeout(this.tapHoldTimeout),this.tapHoldTimeout=null)}handlePinchZoom(t){if(!this.isPinching||t.touches.length!==2)return;let i=Date.now();if(i-this.lastZoomTime<this.options.zoomThrottle)return;this.lastZoomTime=i;let r=t.touches[0],s=t.touches[1],o=this.getDistance(r,s)/this.pinchStartDistance,a=Math.round(this.initialFontSize*o),h=this.options.minFontSize,l=this.options.maxFontSize,c=Math.max(h,Math.min(l,a));c!==this.terminal.options.fontSize&&typeof this.options.onFontSizeChange=="function"&&this.options.onFontSizeChange(c)}endPinchZoom(){this.isPinching=!1,this.pinchStartDistance=0,this.lastPinchDistance=0,this.initialFontSize=0}getDistance(t,i){let r=i.clientX-t.clientX,s=i.clientY-t.clientY;return Math.hypot(r,s)}isEdgeGesture(t){let r=window.innerWidth;return t.clientX<=30||t.clientX>=r-30}getString(t,i){try{if(typeof window<"u"&&window?.strings?.[t])return window.strings[t]}catch{}return i}updateHandles(){this.updateHandlePositions()}destroy(){if(this.forceClearSelection(),this.terminal.element.removeEventListener("touchstart",this.boundHandlers.terminalTouchStart),this.terminal.element.removeEventListener("touchmove",this.boundHandlers.terminalTouchMove),this.terminal.element.removeEventListener("touchend",this.boundHandlers.terminalTouchEnd),this.terminal.element.removeEventListener("touchstart",this.boundHandlers.terminalAreaTouchStart),this.terminal.element.removeEventListener("scroll",this.boundHandlers.terminalScroll),this.startHandle.removeEventListener("touchstart",this.boundHandlers.handleTouchStart),this.startHandle.removeEventListener("touchmove",this.boundHandlers.handleTouchMove),this.startHandle.removeEventListener("touchend",this.boundHandlers.handleTouchEnd),this.endHandle.removeEventListener("touchstart",this.boundHandlers.handleTouchStart),this.endHandle.removeEventListener("touchmove",this.boundHandlers.handleTouchMove),this.endHandle.removeEventListener("touchend",this.boundHandlers.handleTouchEnd),window.removeEventListener("orientationchange",this.boundHandlers.orientationChange),window.removeEventListener("resize",this.boundHandlers.orientationChange),document.removeEventListener("touchstart",this.boundHandlers.documentTouchStart),this.selectionChangeDisposable?.dispose)this.selectionChangeDisposable.dispose();else if(this.terminal.onSelectionChange)try{this.terminal.onSelectionChange(null)}catch(t){console.warn("Could not remove selection change listener",t)}this.resizeDisposable?.dispose&&this.resizeDisposable.dispose(),this.selectionOverlay?.parentNode&&this.selectionOverlay.parentNode.removeChild(this.selectionOverlay)}};acode.addIcon("deepseek","https://raw.githubusercontent.com/deepseek-ai/DeepSeek-Coder/main/pictures/home.png");acode.addIcon("chatgpt","https://upload.wikimedia.org/wikipedia/commons/0/04/ChatGPT_logo.svg");acode.addIcon("gemini","https://upload.wikimedia.org/wikipedia/commons/4/45/Gemini_language_model_logo.png");var Pf=!1,Of=!1,Kf=!1,Nf=!0,Qf=!0,Hf=!0,lh=["block","underline","bar"],hh=["outline","block","bar","underline","none"],ch=11,Xf="MesloLGS NF Regular",uh=["normal","bold","100","200","300","400","500","600","700","800","900"],Uf=1e3,zf=1e3,dh=0,Wf=35,$f=!0,Ee="catppuccin",fh=["ayuDark","ayuLight","ayuMirage","catppuccin","dracula","elementary","everblush","light","material","nekonakoDjancoeg","oneDark","sapphire","siduckOneDark","snazzy","xterm","wal","custom"],Gf="deepseek",_h=[["deepseek","Deepseek","deepseek",!0],["chatgpt","ChatGPT","chatgpt",!0],["gemini-pro","Gemini Flash Lite","gemini",!0],["local-llm","Local LLM(ollama)","icon phone_android",!0]];var tw=Vl(Xg()),iw=Vl(us()),rw=Vl(uc());var Ia,me,Gg,i5,Xr,Ug,jg,qg,Vg,Oc,Rc,Fc,r5,Ba={},La=[],s5=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Ma=Array.isArray;function Ii(e,t){for(var i in t)e[i]=t[i];return e}function Kc(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function ue(e,t,i){var r,s,n,o={};for(n in t)n=="key"?r=t[n]:n=="ref"?s=t[n]:o[n]=t[n];if(arguments.length>2&&(o.children=arguments.length>3?Ia.call(arguments,2):i),typeof e=="function"&&e.defaultProps!=null)for(n in e.defaultProps)o[n]===void 0&&(o[n]=e.defaultProps[n]);return ka(e,o,r,s,null)}function ka(e,t,i,r,s){var n={type:e,props:t,key:i,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:s??++Gg,__i:-1,__u:0};return s==null&&me.vnode!=null&&me.vnode(n),n}function ws(e){return e.children}function Ea(e,t){this.props=e,this.context=t}function bs(e,t){if(t==null)return e.__?bs(e.__,e.__i+1):null;for(var i;t<e.__k.length;t++)if((i=e.__k[t])!=null&&i.__e!=null)return i.__e;return typeof e.type=="function"?bs(e):null}function n5(e){if(e.__P&&e.__d){var t=e.__v,i=t.__e,r=[],s=[],n=Ii({},t);n.__v=t.__v+1,me.vnode&&me.vnode(n),Nc(e.__P,n,t,e.__n,e.__P.namespaceURI,32&t.__u?[i]:null,r,i??bs(t),!!(32&t.__u),s),n.__v=t.__v,n.__.__k[n.__i]=n,em(r,n,s),t.__e=t.__=null,n.__e!=i&&Yg(n)}}function Yg(e){if((e=e.__)!=null&&e.__c!=null)return e.__e=e.__c.base=null,e.__k.some(function(t){if(t!=null&&t.__e!=null)return e.__e=e.__c.base=t.__e}),Yg(e)}function zg(e){(!e.__d&&(e.__d=!0)&&Xr.push(e)&&!Da.__r++||Ug!=me.debounceRendering)&&((Ug=me.debounceRendering)||jg)(Da)}function Da(){for(var e,t=1;Xr.length;)Xr.length>t&&Xr.sort(qg),e=Xr.shift(),t=Xr.length,n5(e);Da.__r=0}function Jg(e,t,i,r,s,n,o,a,h,l,c){var u,g,_,m,v,x,E,M=r&&r.__k||La,D=t.length;for(h=o5(i,t,M,h,D),u=0;u<D;u++)(_=i.__k[u])!=null&&(g=_.__i!=-1&&M[_.__i]||Ba,_.__i=u,x=Nc(e,_,g,s,n,o,a,h,l,c),m=_.__e,_.ref&&g.ref!=_.ref&&(g.ref&&Qc(g.ref,null,_),c.push(_.ref,_.__c||m,_)),v==null&&m!=null&&(v=m),(E=!!(4&_.__u))||g.__k===_.__k?h=Zg(_,h,e,E):typeof _.type=="function"&&x!==void 0?h=x:m&&(h=m.nextSibling),_.__u&=-7);return i.__e=v,h}function o5(e,t,i,r,s){var n,o,a,h,l,c=i.length,u=c,g=0;for(e.__k=new Array(s),n=0;n<s;n++)(o=t[n])!=null&&typeof o!="boolean"&&typeof o!="function"?(typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?o=e.__k[n]=ka(null,o,null,null,null):Ma(o)?o=e.__k[n]=ka(ws,{children:o},null,null,null):o.constructor===void 0&&o.__b>0?o=e.__k[n]=ka(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):e.__k[n]=o,h=n+g,o.__=e,o.__b=e.__b+1,a=null,(l=o.__i=a5(o,i,h,u))!=-1&&(u--,(a=i[l])&&(a.__u|=2)),a==null||a.__v==null?(l==-1&&(s>c?g--:s<c&&g++),typeof o.type!="function"&&(o.__u|=4)):l!=h&&(l==h-1?g--:l==h+1?g++:(l>h?g--:g++,o.__u|=4))):e.__k[n]=null;if(u)for(n=0;n<c;n++)(a=i[n])!=null&&(2&a.__u)==0&&(a.__e==r&&(r=bs(a)),im(a,a));return r}function Zg(e,t,i,r){var s,n;if(typeof e.type=="function"){for(s=e.__k,n=0;s&&n<s.length;n++)s[n]&&(s[n].__=e,t=Zg(s[n],t,i,r));return t}e.__e!=t&&(r&&(t&&e.type&&!t.parentNode&&(t=bs(e)),i.insertBefore(e.__e,t||null)),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function a5(e,t,i,r){var s,n,o,a=e.key,h=e.type,l=t[i],c=l!=null&&(2&l.__u)==0;if(l===null&&a==null||c&&a==l.key&&h==l.type)return i;if(r>(c?1:0)){for(s=i-1,n=i+1;s>=0||n<t.length;)if((l=t[o=s>=0?s--:n++])!=null&&(2&l.__u)==0&&a==l.key&&h==l.type)return o}return-1}function Wg(e,t,i){t[0]=="-"?e.setProperty(t,i??""):e[t]=i==null?"":typeof i!="number"||s5.test(t)?i:i+"px"}function Ca(e,t,i,r,s){var n,o;e:if(t=="style")if(typeof i=="string")e.style.cssText=i;else{if(typeof r=="string"&&(e.style.cssText=r=""),r)for(t in r)i&&t in i||Wg(e.style,t,"");if(i)for(t in i)r&&i[t]==r[t]||Wg(e.style,t,i[t])}else if(t[0]=="o"&&t[1]=="n")n=t!=(t=t.replace(Vg,"$1")),o=t.toLowerCase(),t=o in e||t=="onFocusOut"||t=="onFocusIn"?o.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+n]=i,i?r?i.u=r.u:(i.u=Oc,e.addEventListener(t,n?Fc:Rc,n)):e.removeEventListener(t,n?Fc:Rc,n);else{if(s=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=i??"";break e}catch{}typeof i=="function"||(i==null||i===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&i==1?"":i))}}function $g(e){return function(t){if(this.l){var i=this.l[t.type+e];if(t.t==null)t.t=Oc++;else if(t.t<i.u)return;return i(me.event?me.event(t):t)}}}function Nc(e,t,i,r,s,n,o,a,h,l){var c,u,g,_,m,v,x,E,M,D,b,L,I,R,G,W=t.type;if(t.constructor!==void 0)return null;128&i.__u&&(h=!!(32&i.__u),n=[a=t.__e=i.__e]),(c=me.__b)&&c(t);e:if(typeof W=="function")try{if(E=t.props,M="prototype"in W&&W.prototype.render,D=(c=W.contextType)&&r[c.__c],b=c?D?D.props.value:c.__:r,i.__c?x=(u=t.__c=i.__c).__=u.__E:(M?t.__c=u=new W(E,b):(t.__c=u=new Ea(E,b),u.constructor=W,u.render=h5),D&&D.sub(u),u.state||(u.state={}),u.__n=r,g=u.__d=!0,u.__h=[],u._sb=[]),M&&u.__s==null&&(u.__s=u.state),M&&W.getDerivedStateFromProps!=null&&(u.__s==u.state&&(u.__s=Ii({},u.__s)),Ii(u.__s,W.getDerivedStateFromProps(E,u.__s))),_=u.props,m=u.state,u.__v=t,g)M&&W.getDerivedStateFromProps==null&&u.componentWillMount!=null&&u.componentWillMount(),M&&u.componentDidMount!=null&&u.__h.push(u.componentDidMount);else{if(M&&W.getDerivedStateFromProps==null&&E!==_&&u.componentWillReceiveProps!=null&&u.componentWillReceiveProps(E,b),t.__v==i.__v||!u.__e&&u.shouldComponentUpdate!=null&&u.shouldComponentUpdate(E,u.__s,b)===!1){t.__v!=i.__v&&(u.props=E,u.state=u.__s,u.__d=!1),t.__e=i.__e,t.__k=i.__k,t.__k.some(function(V){V&&(V.__=t)}),La.push.apply(u.__h,u._sb),u._sb=[],u.__h.length&&o.push(u);break e}u.componentWillUpdate!=null&&u.componentWillUpdate(E,u.__s,b),M&&u.componentDidUpdate!=null&&u.__h.push(function(){u.componentDidUpdate(_,m,v)})}if(u.context=b,u.props=E,u.__P=e,u.__e=!1,L=me.__r,I=0,M)u.state=u.__s,u.__d=!1,L&&L(t),c=u.render(u.props,u.state,u.context),La.push.apply(u.__h,u._sb),u._sb=[];else do u.__d=!1,L&&L(t),c=u.render(u.props,u.state,u.context),u.state=u.__s;while(u.__d&&++I<25);u.state=u.__s,u.getChildContext!=null&&(r=Ii(Ii({},r),u.getChildContext())),M&&!g&&u.getSnapshotBeforeUpdate!=null&&(v=u.getSnapshotBeforeUpdate(_,m)),R=c!=null&&c.type===ws&&c.key==null?tm(c.props.children):c,a=Jg(e,Ma(R)?R:[R],t,i,r,s,n,o,a,h,l),u.base=t.__e,t.__u&=-161,u.__h.length&&o.push(u),x&&(u.__E=u.__=null)}catch(V){if(t.__v=null,h||n!=null)if(V.then){for(t.__u|=h?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;n[n.indexOf(a)]=null,t.__e=a}else{for(G=n.length;G--;)Kc(n[G]);Pc(t)}else t.__e=i.__e,t.__k=i.__k,V.then||Pc(t);me.__e(V,t,i)}else n==null&&t.__v==i.__v?(t.__k=i.__k,t.__e=i.__e):a=t.__e=l5(i.__e,t,i,r,s,n,o,h,l);return(c=me.diffed)&&c(t),128&t.__u?void 0:a}function Pc(e){e&&(e.__c&&(e.__c.__e=!0),e.__k&&e.__k.some(Pc))}function em(e,t,i){for(var r=0;r<i.length;r++)Qc(i[r],i[++r],i[++r]);me.__c&&me.__c(t,e),e.some(function(s){try{e=s.__h,s.__h=[],e.some(function(n){n.call(s)})}catch(n){me.__e(n,s.__v)}})}function tm(e){return typeof e!="object"||e==null||e.__b>0?e:Ma(e)?e.map(tm):Ii({},e)}function l5(e,t,i,r,s,n,o,a,h){var l,c,u,g,_,m,v,x=i.props||Ba,E=t.props,M=t.type;if(M=="svg"?s="http://www.w3.org/2000/svg":M=="math"?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),n!=null){for(l=0;l<n.length;l++)if((_=n[l])&&"setAttribute"in _==!!M&&(M?_.localName==M:_.nodeType==3)){e=_,n[l]=null;break}}if(e==null){if(M==null)return document.createTextNode(E);e=document.createElementNS(s,M,E.is&&E),a&&(me.__m&&me.__m(t,n),a=!1),n=null}if(M==null)x===E||a&&e.data==E||(e.data=E);else{if(n=n&&Ia.call(e.childNodes),!a&&n!=null)for(x={},l=0;l<e.attributes.length;l++)x[(_=e.attributes[l]).name]=_.value;for(l in x)_=x[l],l=="dangerouslySetInnerHTML"?u=_:l=="children"||l in E||l=="value"&&"defaultValue"in E||l=="checked"&&"defaultChecked"in E||Ca(e,l,null,_,s);for(l in E)_=E[l],l=="children"?g=_:l=="dangerouslySetInnerHTML"?c=_:l=="value"?m=_:l=="checked"?v=_:a&&typeof _!="function"||x[l]===_||Ca(e,l,_,x[l],s);if(c)a||u&&(c.__html==u.__html||c.__html==e.innerHTML)||(e.innerHTML=c.__html),t.__k=[];else if(u&&(e.innerHTML=""),Jg(t.type=="template"?e.content:e,Ma(g)?g:[g],t,i,r,M=="foreignObject"?"http://www.w3.org/1999/xhtml":s,n,o,n?n[0]:i.__k&&bs(i,0),a,h),n!=null)for(l=n.length;l--;)Kc(n[l]);a||(l="value",M=="progress"&&m==null?e.removeAttribute("value"):m!=null&&(m!==e[l]||M=="progress"&&!m||M=="option"&&m!=x[l])&&Ca(e,l,m,x[l],s),l="checked",v!=null&&v!=e[l]&&Ca(e,l,v,x[l],s))}return e}function Qc(e,t,i){try{if(typeof e=="function"){var r=typeof e.__u=="function";r&&e.__u(),r&&t==null||(e.__u=e(t))}else e.current=t}catch(s){me.__e(s,i)}}function im(e,t,i){var r,s;if(me.unmount&&me.unmount(e),(r=e.ref)&&(r.current&&r.current!=e.__e||Qc(r,null,t)),(r=e.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(n){me.__e(n,t)}r.base=r.__P=null}if(r=e.__k)for(s=0;s<r.length;s++)r[s]&&im(r[s],t,i||typeof e.type!="function");i||Kc(e.__e),e.__c=e.__=e.__e=void 0}function h5(e,t,i){return this.constructor(e,i)}function Bn(e,t,i){var r,s,n,o;t==document&&(t=document.documentElement),me.__&&me.__(e,t),s=(r=typeof i=="function")?null:i&&i.__k||t.__k,n=[],o=[],Nc(t,e=(!r&&i||t).__k=ue(ws,null,[e]),s||Ba,Ba,t.namespaceURI,!r&&i?[i]:s?null:t.firstChild?Ia.call(t.childNodes):null,n,!r&&i?i:s?s.__e:t.firstChild,r,o),em(n,e,o)}Ia=La.slice,me={__e:function(e,t,i,r){for(var s,n,o;t=t.__;)if((s=t.__c)&&!s.__)try{if((n=s.constructor)&&n.getDerivedStateFromError!=null&&(s.setState(n.getDerivedStateFromError(e)),o=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(e,r||{}),o=s.__d),o)return s.__E=s}catch(a){e=a}throw e}},Gg=0,i5=function(e){return e!=null&&e.constructor===void 0},Ea.prototype.setState=function(e,t){var i;i=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=Ii({},this.state),typeof e=="function"&&(e=e(Ii({},i),this.props)),e&&Ii(i,e),e!=null&&this.__v&&(t&&this._sb.push(t),zg(this))},Ea.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),zg(this))},Ea.prototype.render=ws,Xr=[],jg=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,qg=function(e,t){return e.__v.__b-t.__v.__b},Da.__r=0,Vg=/(PointerCapture)$|Capture$/i,Oc=0,Rc=$g(!1),Fc=$g(!0),r5=0;var ov=Object.defineProperty,c5=Object.getOwnPropertyDescriptor,u5=(e,t)=>{for(var i in t)ov(e,i,{get:t[i],enumerable:!0})},Me=(e,t,i,r)=>{for(var s=r>1?void 0:r?c5(t,i):t,n=e.length-1,o;n>=0;n--)(o=e[n])&&(s=(r?o(t,i,s):o(s))||s);return r&&s&&ov(t,i,s),s},Z=(e,t)=>(i,r)=>t(i,r,e),rm="Terminal input",ru={get:()=>rm,set:e=>rm=e},sm="Too much output to announce, navigate to rows manually to read",su={get:()=>sm,set:e=>sm=e};function d5(e){return e.replace(/\r?\n/g,"\r")}function f5(e,t){return t?"\x1B[200~"+e+"\x1B[201~":e}function _5(e,t){e.clipboardData&&e.clipboardData.setData("text/plain",t.selectionText),e.preventDefault()}function p5(e,t,i,r){if(e.stopPropagation(),e.clipboardData){let s=e.clipboardData.getData("text/plain");av(s,t,i,r)}}function av(e,t,i,r){e=d5(e),e=f5(e,i.decPrivateModes.bracketedPasteMode&&r.rawOptions.ignoreBracketedPasteMode!==!0),i.triggerDataEvent(e,!0),t.value=""}function lv(e,t,i){let r=i.getBoundingClientRect(),s=e.clientX-r.left-10,n=e.clientY-r.top-10;t.style.width="20px",t.style.height="20px",t.style.left=`${s}px`,t.style.top=`${n}px`,t.style.zIndex="1000",t.focus()}function nm(e,t,i,r,s){lv(e,t,i),s&&r.rightClickSelect(e),t.value=r.selectionText,t.select()}function vr(e){return e>65535?(e-=65536,String.fromCharCode((e>>10)+55296)+String.fromCharCode(e%1024+56320)):String.fromCharCode(e)}function rl(e,t=0,i=e.length){let r="";for(let s=t;s<i;++s){let n=e[s];n>65535?(n-=65536,r+=String.fromCharCode((n>>10)+55296)+String.fromCharCode(n%1024+56320)):r+=String.fromCharCode(n)}return r}var g5=class{constructor(){this._interim=0}clear(){this._interim=0}decode(e,t){let i=e.length;if(!i)return 0;let r=0,s=0;if(this._interim){let n=e.charCodeAt(s++);56320<=n&&n<=57343?t[r++]=(this._interim-55296)*1024+n-56320+65536:(t[r++]=this._interim,t[r++]=n),this._interim=0}for(let n=s;n<i;++n){let o=e.charCodeAt(n);if(55296<=o&&o<=56319){if(++n>=i)return this._interim=o,r;let a=e.charCodeAt(n);56320<=a&&a<=57343?t[r++]=(o-55296)*1024+a-56320+65536:(t[r++]=o,t[r++]=a);continue}o!==65279&&(t[r++]=o)}return r}},m5=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(e,t){let i=e.length;if(!i)return 0;let r=0,s,n,o,a,h=0,l=0;if(this.interim[0]){let g=!1,_=this.interim[0];_&=(_&224)===192?31:(_&240)===224?15:7;let m=0,v;for(;(v=this.interim[++m]&63)&&m<4;)_<<=6,_|=v;let x=(this.interim[0]&224)===192?2:(this.interim[0]&240)===224?3:4,E=x-m;for(;l<E;){if(l>=i)return 0;if(v=e[l++],(v&192)!==128){l--,g=!0;break}else this.interim[m++]=v,_<<=6,_|=v&63}g||(x===2?_<128?l--:t[r++]=_:x===3?_<2048||_>=55296&&_<=57343||_===65279||(t[r++]=_):_<65536||_>1114111||(t[r++]=_)),this.interim.fill(0)}let c=i-4,u=l;for(;u<i;){for(;u<c&&!((s=e[u])&128)&&!((n=e[u+1])&128)&&!((o=e[u+2])&128)&&!((a=e[u+3])&128);)t[r++]=s,t[r++]=n,t[r++]=o,t[r++]=a,u+=4;if(s=e[u++],s<128)t[r++]=s;else if((s&224)===192){if(u>=i)return this.interim[0]=s,r;if(n=e[u++],(n&192)!==128){u--;continue}if(h=(s&31)<<6|n&63,h<128){u--;continue}t[r++]=h}else if((s&240)===224){if(u>=i)return this.interim[0]=s,r;if(n=e[u++],(n&192)!==128){u--;continue}if(u>=i)return this.interim[0]=s,this.interim[1]=n,r;if(o=e[u++],(o&192)!==128){u--;continue}if(h=(s&15)<<12|(n&63)<<6|o&63,h<2048||h>=55296&&h<=57343||h===65279)continue;t[r++]=h}else if((s&248)===240){if(u>=i)return this.interim[0]=s,r;if(n=e[u++],(n&192)!==128){u--;continue}if(u>=i)return this.interim[0]=s,this.interim[1]=n,r;if(o=e[u++],(o&192)!==128){u--;continue}if(u>=i)return this.interim[0]=s,this.interim[1]=n,this.interim[2]=o,r;if(a=e[u++],(a&192)!==128){u--;continue}if(h=(s&7)<<18|(n&63)<<12|(o&63)<<6|a&63,h<65536||h>1114111)continue;t[r++]=h}}return r}},hv="",yr=" ",jn=class cv{constructor(){this.fg=0,this.bg=0,this.extended=new ja}static toColorRGB(t){return[t>>>16&255,t>>>8&255,t&255]}static fromColorRGB(t){return(t[0]&255)<<16|(t[1]&255)<<8|t[2]&255}clone(){let t=new cv;return t.fg=this.fg,t.bg=this.bg,t.extended=this.extended.clone(),t}isInverse(){return this.fg&67108864}isBold(){return this.fg&134217728}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:this.fg&268435456}isBlink(){return this.fg&536870912}isInvisible(){return this.fg&1073741824}isItalic(){return this.bg&67108864}isDim(){return this.bg&134217728}isStrikethrough(){return this.fg&2147483648}isProtected(){return this.bg&536870912}isOverline(){return this.bg&1073741824}getFgColorMode(){return this.fg&50331648}getBgColorMode(){return this.bg&50331648}isFgRGB(){return(this.fg&50331648)===50331648}isBgRGB(){return(this.bg&50331648)===50331648}isFgPalette(){return(this.fg&50331648)===16777216||(this.fg&50331648)===33554432}isBgPalette(){return(this.bg&50331648)===16777216||(this.bg&50331648)===33554432}isFgDefault(){return(this.fg&50331648)===0}isBgDefault(){return(this.bg&50331648)===0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(this.fg&50331648){case 16777216:case 33554432:return this.fg&255;case 50331648:return this.fg&16777215;default:return-1}}getBgColor(){switch(this.bg&50331648){case 16777216:case 33554432:return this.bg&255;case 50331648:return this.bg&16777215;default:return-1}}hasExtendedAttrs(){return this.bg&268435456}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(this.bg&268435456&&~this.extended.underlineColor)switch(this.extended.underlineColor&50331648){case 16777216:case 33554432:return this.extended.underlineColor&255;case 50331648:return this.extended.underlineColor&16777215;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return this.bg&268435456&&~this.extended.underlineColor?this.extended.underlineColor&50331648:this.getFgColorMode()}isUnderlineColorRGB(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===50331648:this.isFgRGB()}isUnderlineColorPalette(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===16777216||(this.extended.underlineColor&50331648)===33554432:this.isFgPalette()}isUnderlineColorDefault(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===0:this.isFgDefault()}getUnderlineStyle(){return this.fg&268435456?this.bg&268435456?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}},ja=class uv{constructor(t=0,i=0){this._ext=0,this._urlId=0,this._ext=t,this._urlId=i}get ext(){return this._urlId?this._ext&-469762049|this.underlineStyle<<26:this._ext}set ext(t){this._ext=t}get underlineStyle(){return this._urlId?5:(this._ext&469762048)>>26}set underlineStyle(t){this._ext&=-469762049,this._ext|=t<<26&469762048}get underlineColor(){return this._ext&67108863}set underlineColor(t){this._ext&=-67108864,this._ext|=t&67108863}get urlId(){return this._urlId}set urlId(t){this._urlId=t}get underlineVariantOffset(){let t=(this._ext&3758096384)>>29;return t<0?t^4294967288:t}set underlineVariantOffset(t){this._ext&=536870911,this._ext|=t<<29&3758096384}clone(){return new uv(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}},$t=class dv extends jn{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new ja,this.combinedData=""}static fromCharData(t){let i=new dv;return i.setFromCharData(t),i}isCombined(){return this.content&2097152}getWidth(){return this.content>>22}getChars(){return this.content&2097152?this.combinedData:this.content&2097151?vr(this.content&2097151):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):this.content&2097151}setFromCharData(t){this.fg=t[0],this.bg=0;let i=!1;if(t[1].length>2)i=!0;else if(t[1].length===2){let r=t[1].charCodeAt(0);if(55296<=r&&r<=56319){let s=t[1].charCodeAt(1);56320<=s&&s<=57343?this.content=(r-55296)*1024+s-56320+65536|t[2]<<22:i=!0}else i=!0}else this.content=t[1].charCodeAt(0)|t[2]<<22;i&&(this.combinedData=t[1],this.content=2097152|t[2]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},om="di$target",nu="di$dependencies",Hc=new Map;function v5(e){return e[nu]||[]}function Ze(e){if(Hc.has(e))return Hc.get(e);let t=function(i,r,s){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");y5(t,i,s)};return t._id=e,Hc.set(e,t),t}function y5(e,t,i){t[om]===t?t[nu].push({id:e,index:i}):(t[nu]=[{id:e,index:i}],t[om]=t)}var vt=Ze("BufferService"),fv=Ze("CoreMouseService"),Vr=Ze("CoreService"),b5=Ze("CharsetService"),Hu=Ze("InstantiationService"),_v=Ze("LogService"),yt=Ze("OptionsService"),pv=Ze("OscLinkService"),w5=Ze("UnicodeService"),qn=Ze("DecorationService"),ou=class{constructor(e,t,i){this._bufferService=e,this._optionsService=t,this._oscLinkService=i}provideLinks(e,t){let i=this._bufferService.buffer.lines.get(e-1);if(!i){t(void 0);return}let r=[],s=this._optionsService.rawOptions.linkHandler,n=new $t,o=i.getTrimmedLength(),a=-1,h=-1,l=!1;for(let c=0;c<o;c++)if(!(h===-1&&!i.hasContent(c))){if(i.loadCell(c,n),n.hasExtendedAttrs()&&n.extended.urlId)if(h===-1){h=c,a=n.extended.urlId;continue}else l=n.extended.urlId!==a;else h!==-1&&(l=!0);if(l||h!==-1&&c===o-1){let u=this._oscLinkService.getLinkData(a)?.uri;if(u){let g={start:{x:h+1,y:e},end:{x:c+(!l&&c===o-1?1:0),y:e}},_=!1;if(!s?.allowNonHttpProtocols)try{let m=new URL(u);["http:","https:"].includes(m.protocol)||(_=!0)}catch{_=!0}_||r.push({text:u,range:g,activate:(m,v)=>s?s.activate(m,v,g):A5(m,v),hover:(m,v)=>s?.hover?.(m,v,g),leave:(m,v)=>s?.leave?.(m,v,g)})}l=!1,n.hasExtendedAttrs()&&n.extended.urlId?(h=c,a=n.extended.urlId):(h=-1,a=-1)}}t(r)}};ou=Me([Z(0,vt),Z(1,yt),Z(2,pv)],ou);function A5(e,t){if(confirm(`Do you want to navigate to ${t}?

WARNING: This link could potentially be dangerous`)){let i=window.open();if(i){try{i.opener=null}catch{}i.location.href=t}else console.warn("Opening link blocked as opener could not be cleared")}}var sl=Ze("CharSizeService"),Pi=Ze("CoreBrowserService"),Xu=Ze("MouseService"),Oi=Ze("RenderService"),x5=Ze("SelectionService"),gv=Ze("CharacterJoinerService"),Cs=Ze("ThemeService"),mv=Ze("LinkProviderService"),S5=class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(e){setTimeout(()=>{throw e.stack?am.isErrorNoTelemetry(e)?new am(e.message+`

`+e.stack):new Error(e.message+`

`+e.stack):e},0)}}addListener(e){return this.listeners.push(e),()=>{this._removeListener(e)}}emit(e){this.listeners.forEach(t=>{t(e)})}_removeListener(e){this.listeners.splice(this.listeners.indexOf(e),1)}setUnexpectedErrorHandler(e){this.unexpectedErrorHandler=e}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(e){this.unexpectedErrorHandler(e),this.emit(e)}onUnexpectedExternalError(e){this.unexpectedErrorHandler(e)}},C5=new S5;function Ka(e){k5(e)||C5.onUnexpectedError(e)}var au="Canceled";function k5(e){return e instanceof E5?!0:e instanceof Error&&e.name===au&&e.message===au}var E5=class extends Error{constructor(){super(au),this.name=this.message}};function B5(e){return e?new Error(`Illegal argument: ${e}`):new Error("Illegal argument")}var am=class lu extends Error{constructor(t){super(t),this.name="CodeExpectedError"}static fromError(t){if(t instanceof lu)return t;let i=new lu;return i.message=t.message,i.stack=t.stack,i}static isErrorNoTelemetry(t){return t.name==="CodeExpectedError"}},hu=class vv extends Error{constructor(t){super(t||"An unexpected bug occurred."),Object.setPrototypeOf(this,vv.prototype)}};function L5(e,t,i=0,r=e.length){let s=i,n=r;for(;s<n;){let o=Math.floor((s+n)/2);t(e[o])?s=o+1:n=o}return s-1}var D5=class yv{constructor(t){this._array=t,this._findLastMonotonousLastIdx=0}findLastMonotonous(t){if(yv.assertInvariants){if(this._prevFindLastPredicate){for(let r of this._array)if(this._prevFindLastPredicate(r)&&!t(r))throw new Error("MonotonousArray: current predicate must be weaker than (or equal to) the previous predicate.")}this._prevFindLastPredicate=t}let i=L5(this._array,t,this._findLastMonotonousLastIdx);return this._findLastMonotonousLastIdx=i+1,i===-1?void 0:this._array[i]}};D5.assertInvariants=!1;function Dt(e,t=0){return e[e.length-(1+t)]}var bv;(e=>{function t(n){return n<0}e.isLessThan=t;function i(n){return n<=0}e.isLessThanOrEqual=i;function r(n){return n>0}e.isGreaterThan=r;function s(n){return n===0}e.isNeitherLessOrGreaterThan=s,e.greaterThan=1,e.lessThan=-1,e.neitherLessOrGreaterThan=0})(bv||={});function I5(e,t){return(i,r)=>t(e(i),e(r))}var M5=(e,t)=>e-t,lm=class cu{constructor(t){this.iterate=t}forEach(t){this.iterate(i=>(t(i),!0))}toArray(){let t=[];return this.iterate(i=>(t.push(i),!0)),t}filter(t){return new cu(i=>this.iterate(r=>t(r)?i(r):!0))}map(t){return new cu(i=>this.iterate(r=>i(t(r))))}some(t){let i=!1;return this.iterate(r=>(i=t(r),!i)),i}findFirst(t){let i;return this.iterate(r=>t(r)?(i=r,!1):!0),i}findLast(t){let i;return this.iterate(r=>(t(r)&&(i=r),!0)),i}findLastMaxBy(t){let i,r=!0;return this.iterate(s=>((r||bv.isGreaterThan(t(s,i)))&&(r=!1,i=s),!0)),i}};lm.empty=new lm(e=>{});function T5(e,t){let i=Object.create(null);for(let r of e){let s=t(r),n=i[s];n||(n=i[s]=[]),n.push(r)}return i}var hm,cm,TI=class{constructor(e,t){this.toKey=t,this._map=new Map,this[hm]="SetWithKey";for(let i of e)this.add(i)}get size(){return this._map.size}add(e){let t=this.toKey(e);return this._map.set(t,e),this}delete(e){return this._map.delete(this.toKey(e))}has(e){return this._map.has(this.toKey(e))}*entries(){for(let e of this._map.values())yield[e,e]}keys(){return this.values()}*values(){for(let e of this._map.values())yield e}clear(){this._map.clear()}forEach(e,t){this._map.forEach(i=>e.call(t,i,i,this))}[(cm=Symbol.iterator,hm=Symbol.toStringTag,cm)](){return this.values()}},R5=class{constructor(){this.map=new Map}add(e,t){let i=this.map.get(e);i||(i=new Set,this.map.set(e,i)),i.add(t)}delete(e,t){let i=this.map.get(e);i&&(i.delete(t),i.size===0&&this.map.delete(e))}forEach(e,t){let i=this.map.get(e);i&&i.forEach(t)}get(e){return this.map.get(e)||new Set}};function F5(e,t){let i=this,r=!1,s;return function(){if(r)return s;if(r=!0,t)try{s=e.apply(i,arguments)}finally{t()}else s=e.apply(i,arguments);return s}}var wv;(e=>{function t(b){return b&&typeof b=="object"&&typeof b[Symbol.iterator]=="function"}e.is=t;let i=Object.freeze([]);function r(){return i}e.empty=r;function*s(b){yield b}e.single=s;function n(b){return t(b)?b:s(b)}e.wrap=n;function o(b){return b||i}e.from=o;function*a(b){for(let L=b.length-1;L>=0;L--)yield b[L]}e.reverse=a;function h(b){return!b||b[Symbol.iterator]().next().done===!0}e.isEmpty=h;function l(b){return b[Symbol.iterator]().next().value}e.first=l;function c(b,L){let I=0;for(let R of b)if(L(R,I++))return!0;return!1}e.some=c;function u(b,L){for(let I of b)if(L(I))return I}e.find=u;function*g(b,L){for(let I of b)L(I)&&(yield I)}e.filter=g;function*_(b,L){let I=0;for(let R of b)yield L(R,I++)}e.map=_;function*m(b,L){let I=0;for(let R of b)yield*L(R,I++)}e.flatMap=m;function*v(...b){for(let L of b)yield*L}e.concat=v;function x(b,L,I){let R=I;for(let G of b)R=L(R,G);return R}e.reduce=x;function*E(b,L,I=b.length){for(L<0&&(L+=b.length),I<0?I+=b.length:I>b.length&&(I=b.length);L<I;L++)yield b[L]}e.slice=E;function M(b,L=Number.POSITIVE_INFINITY){let I=[];if(L===0)return[I,b];let R=b[Symbol.iterator]();for(let G=0;G<L;G++){let W=R.next();if(W.done)return[I,e.empty()];I.push(W.value)}return[I,{[Symbol.iterator](){return R}}]}e.consume=M;async function D(b){let L=[];for await(let I of b)L.push(I);return Promise.resolve(L)}e.asyncToArray=D})(wv||={});var P5=!1,Gr=null,O5=class Av{constructor(){this.livingDisposables=new Map}getDisposableData(t){let i=this.livingDisposables.get(t);return i||(i={parent:null,source:null,isSingleton:!1,value:t,idx:Av.idx++},this.livingDisposables.set(t,i)),i}trackDisposable(t){let i=this.getDisposableData(t);i.source||(i.source=new Error().stack)}setParent(t,i){let r=this.getDisposableData(t);r.parent=i}markAsDisposed(t){this.livingDisposables.delete(t)}markAsSingleton(t){this.getDisposableData(t).isSingleton=!0}getRootParent(t,i){let r=i.get(t);if(r)return r;let s=t.parent?this.getRootParent(this.getDisposableData(t.parent),i):t;return i.set(t,s),s}getTrackedDisposables(){let t=new Map;return[...this.livingDisposables.entries()].filter(([,i])=>i.source!==null&&!this.getRootParent(i,t).isSingleton).flatMap(([i])=>i)}computeLeakingDisposables(t=10,i){let r;if(i)r=i;else{let h=new Map,l=[...this.livingDisposables.values()].filter(u=>u.source!==null&&!this.getRootParent(u,h).isSingleton);if(l.length===0)return;let c=new Set(l.map(u=>u.value));if(r=l.filter(u=>!(u.parent&&c.has(u.parent))),r.length===0)throw new Error("There are cyclic diposable chains!")}if(!r)return;function s(h){function l(u,g){for(;u.length>0&&g.some(_=>typeof _=="string"?_===u[0]:u[0].match(_));)u.shift()}let c=h.source.split(`
`).map(u=>u.trim().replace("at ","")).filter(u=>u!=="");return l(c,["Error",/^trackDisposable \(.*\)$/,/^DisposableTracker.trackDisposable \(.*\)$/]),c.reverse()}let n=new R5;for(let h of r){let l=s(h);for(let c=0;c<=l.length;c++)n.add(l.slice(0,c).join(`
`),h)}r.sort(I5(h=>h.idx,M5));let o="",a=0;for(let h of r.slice(0,t)){a++;let l=s(h),c=[];for(let u=0;u<l.length;u++){let g=l[u];g=`(shared with ${n.get(l.slice(0,u+1).join(`
`)).size}/${r.length} leaks) at ${g}`;let _=n.get(l.slice(0,u).join(`
`)),m=T5([..._].map(v=>s(v)[u]),v=>v);delete m[l[u]];for(let[v,x]of Object.entries(m))c.unshift(`    - stacktraces of ${x.length} other leaks continue with ${v}`);c.unshift(g)}o+=`


==================== Leaking disposable ${a}/${r.length}: ${h.value.constructor.name} ====================
${c.join(`
`)}
============================================================

`}return r.length>t&&(o+=`


... and ${r.length-t} more leaking disposables

`),{leaks:r,details:o}}};O5.idx=0;function K5(e){Gr=e}if(P5){let e="__is_disposable_tracked__";K5(new class{trackDisposable(t){let i=new Error("Potentially leaked disposable").stack;setTimeout(()=>{t[e]||console.log(i)},3e3)}setParent(t,i){if(t&&t!==oe.None)try{t[e]=!0}catch{}}markAsDisposed(t){if(t&&t!==oe.None)try{t[e]=!0}catch{}}markAsSingleton(t){}})}function nl(e){return Gr?.trackDisposable(e),e}function ol(e){Gr?.markAsDisposed(e)}function zn(e,t){Gr?.setParent(e,t)}function N5(e,t){if(Gr)for(let i of e)Gr.setParent(i,t)}function um(e){return Gr?.markAsSingleton(e),e}function jr(e){if(wv.is(e)){let t=[];for(let i of e)if(i)try{i.dispose()}catch(r){t.push(r)}if(t.length===1)throw t[0];if(t.length>1)throw new AggregateError(t,"Encountered errors while disposing of store");return Array.isArray(e)?[]:e}else if(e)return e.dispose(),e}function Q5(...e){let t=Ae(()=>jr(e));return N5(e,t),t}function Ae(e){let t=nl({dispose:F5(()=>{ol(t),e()})});return t}var xv=class Sv{constructor(){this._toDispose=new Set,this._isDisposed=!1,nl(this)}dispose(){this._isDisposed||(ol(this),this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{jr(this._toDispose)}finally{this._toDispose.clear()}}add(t){if(!t)return t;if(t===this)throw new Error("Cannot register a disposable on itself!");return zn(t,this),this._isDisposed?Sv.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(t),t}delete(t){if(t){if(t===this)throw new Error("Cannot dispose a disposable on itself!");this._toDispose.delete(t),t.dispose()}}deleteAndLeak(t){t&&this._toDispose.has(t)&&(this._toDispose.delete(t),zn(t,null))}};xv.DISABLE_DISPOSED_WARNING=!1;var br=xv,oe=class{constructor(){this._store=new br,nl(this),zn(this._store,this)}dispose(){ol(this),this._store.dispose()}_register(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}};oe.None=Object.freeze({dispose(){}});var Ss=class{constructor(){this._isDisposed=!1,nl(this)}get value(){return this._isDisposed?void 0:this._value}set value(e){this._isDisposed||e===this._value||(this._value?.dispose(),e&&zn(e,this),this._value=e)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,ol(this),this._value?.dispose(),this._value=void 0}clearAndLeak(){let e=this._value;return this._value=void 0,e&&zn(e,null),e}},Tt=typeof window=="object"?window:globalThis,uu=class du{constructor(t){this.element=t,this.next=du.Undefined,this.prev=du.Undefined}};uu.Undefined=new uu(void 0);var Be=uu,dm=class{constructor(){this._first=Be.Undefined,this._last=Be.Undefined,this._size=0}get size(){return this._size}isEmpty(){return this._first===Be.Undefined}clear(){let e=this._first;for(;e!==Be.Undefined;){let t=e.next;e.prev=Be.Undefined,e.next=Be.Undefined,e=t}this._first=Be.Undefined,this._last=Be.Undefined,this._size=0}unshift(e){return this._insert(e,!1)}push(e){return this._insert(e,!0)}_insert(e,t){let i=new Be(e);if(this._first===Be.Undefined)this._first=i,this._last=i;else if(t){let s=this._last;this._last=i,i.prev=s,s.next=i}else{let s=this._first;this._first=i,i.next=s,s.prev=i}this._size+=1;let r=!1;return()=>{r||(r=!0,this._remove(i))}}shift(){if(this._first!==Be.Undefined){let e=this._first.element;return this._remove(this._first),e}}pop(){if(this._last!==Be.Undefined){let e=this._last.element;return this._remove(this._last),e}}_remove(e){if(e.prev!==Be.Undefined&&e.next!==Be.Undefined){let t=e.prev;t.next=e.next,e.next.prev=t}else e.prev===Be.Undefined&&e.next===Be.Undefined?(this._first=Be.Undefined,this._last=Be.Undefined):e.next===Be.Undefined?(this._last=this._last.prev,this._last.next=Be.Undefined):e.prev===Be.Undefined&&(this._first=this._first.next,this._first.prev=Be.Undefined);this._size-=1}*[Symbol.iterator](){let e=this._first;for(;e!==Be.Undefined;)yield e.element,e=e.next}},H5=globalThis.performance&&typeof globalThis.performance.now=="function",X5=class Cv{static create(t){return new Cv(t)}constructor(t){this._now=H5&&t===!1?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}},U5=!1,fm=!1,z5=!1,ot;(e=>{e.None=()=>oe.None;function t(C){if(z5){let{onDidAddListener:w}=C,k=pu.create(),f=0;C.onDidAddListener=()=>{++f===2&&(console.warn("snapshotted emitter LIKELY used public and SHOULD HAVE BEEN created with DisposableStore. snapshotted here"),k.print()),w?.()}}}function i(C,w){return g(C,()=>{},0,void 0,!0,void 0,w)}e.defer=i;function r(C){return(w,k=null,f)=>{let d=!1,p;return p=C(y=>{if(!d)return p?p.dispose():d=!0,w.call(k,y)},null,f),d&&p.dispose(),p}}e.once=r;function s(C,w,k){return c((f,d=null,p)=>C(y=>f.call(d,w(y)),null,p),k)}e.map=s;function n(C,w,k){return c((f,d=null,p)=>C(y=>{w(y),f.call(d,y)},null,p),k)}e.forEach=n;function o(C,w,k){return c((f,d=null,p)=>C(y=>w(y)&&f.call(d,y),null,p),k)}e.filter=o;function a(C){return C}e.signal=a;function h(...C){return(w,k=null,f)=>{let d=Q5(...C.map(p=>p(y=>w.call(k,y))));return u(d,f)}}e.any=h;function l(C,w,k,f){let d=k;return s(C,p=>(d=w(d,p),d),f)}e.reduce=l;function c(C,w){let k,f={onWillAddFirstListener(){k=C(d.fire,d)},onDidRemoveLastListener(){k?.dispose()}};w||t(f);let d=new Y(f);return w?.add(d),d.event}function u(C,w){return w instanceof Array?w.push(C):w&&w.add(C),C}function g(C,w,k=100,f=!1,d=!1,p,y){let A,S,F,U=0,$,z={leakWarningThreshold:p,onWillAddFirstListener(){A=C(ee=>{U++,S=w(S,ee),f&&!F&&(J.fire(S),S=void 0),$=()=>{let de=S;S=void 0,F=void 0,(!f||U>1)&&J.fire(de),U=0},typeof k=="number"?(clearTimeout(F),F=setTimeout($,k)):F===void 0&&(F=0,queueMicrotask($))})},onWillRemoveListener(){d&&U>0&&$?.()},onDidRemoveLastListener(){$=void 0,A.dispose()}};y||t(z);let J=new Y(z);return y?.add(J),J.event}e.debounce=g;function _(C,w=0,k){return e.debounce(C,(f,d)=>f?(f.push(d),f):[d],w,void 0,!0,void 0,k)}e.accumulate=_;function m(C,w=(f,d)=>f===d,k){let f=!0,d;return o(C,p=>{let y=f||!w(p,d);return f=!1,d=p,y},k)}e.latch=m;function v(C,w,k){return[e.filter(C,w,k),e.filter(C,f=>!w(f),k)]}e.split=v;function x(C,w=!1,k=[],f){let d=k.slice(),p=C(S=>{d?d.push(S):A.fire(S)});f&&f.add(p);let y=()=>{d?.forEach(S=>A.fire(S)),d=null},A=new Y({onWillAddFirstListener(){p||(p=C(S=>A.fire(S)),f&&f.add(p))},onDidAddFirstListener(){d&&(w?setTimeout(y):y())},onDidRemoveLastListener(){p&&p.dispose(),p=null}});return f&&f.add(A),A.event}e.buffer=x;function E(C,w){return(k,f,d)=>{let p=w(new D);return C(function(y){let A=p.evaluate(y);A!==M&&k.call(f,A)},void 0,d)}}e.chain=E;let M=Symbol("HaltChainable");class D{constructor(){this.steps=[]}map(w){return this.steps.push(w),this}forEach(w){return this.steps.push(k=>(w(k),k)),this}filter(w){return this.steps.push(k=>w(k)?k:M),this}reduce(w,k){let f=k;return this.steps.push(d=>(f=w(f,d),f)),this}latch(w=(k,f)=>k===f){let k=!0,f;return this.steps.push(d=>{let p=k||!w(d,f);return k=!1,f=d,p?d:M}),this}evaluate(w){for(let k of this.steps)if(w=k(w),w===M)break;return w}}function b(C,w,k=f=>f){let f=(...A)=>y.fire(k(...A)),d=()=>C.on(w,f),p=()=>C.removeListener(w,f),y=new Y({onWillAddFirstListener:d,onDidRemoveLastListener:p});return y.event}e.fromNodeEventEmitter=b;function L(C,w,k=f=>f){let f=(...A)=>y.fire(k(...A)),d=()=>C.addEventListener(w,f),p=()=>C.removeEventListener(w,f),y=new Y({onWillAddFirstListener:d,onDidRemoveLastListener:p});return y.event}e.fromDOMEventEmitter=L;function I(C){return new Promise(w=>r(C)(w))}e.toPromise=I;function R(C){let w=new Y;return C.then(k=>{w.fire(k)},()=>{w.fire(void 0)}).finally(()=>{w.dispose()}),w.event}e.fromPromise=R;function G(C,w){return C(k=>w.fire(k))}e.forward=G;function W(C,w,k){return w(k),C(f=>w(f))}e.runAndSubscribe=W;class V{constructor(w,k){this._observable=w,this._counter=0,this._hasChanged=!1;let f={onWillAddFirstListener:()=>{w.addObserver(this)},onDidRemoveLastListener:()=>{w.removeObserver(this)}};k||t(f),this.emitter=new Y(f),k&&k.add(this.emitter)}beginUpdate(w){this._counter++}handlePossibleChange(w){}handleChange(w,k){this._hasChanged=!0}endUpdate(w){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}function q(C,w){return new V(C,w).emitter.event}e.fromObservable=q;function ne(C){return(w,k,f)=>{let d=0,p=!1,y={beginUpdate(){d++},endUpdate(){d--,d===0&&(C.reportChanges(),p&&(p=!1,w.call(k)))},handlePossibleChange(){},handleChange(){p=!0}};C.addObserver(y),C.reportChanges();let A={dispose(){C.removeObserver(y)}};return f instanceof br?f.add(A):Array.isArray(f)&&f.push(A),A}}e.fromObservableLight=ne})(ot||={});var fu=class _u{constructor(t){this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name=`${t}_${_u._idPool++}`,_u.all.add(this)}start(t){this._stopWatch=new X5,this.listenerCount=t}stop(){if(this._stopWatch){let t=this._stopWatch.elapsed();this.durations.push(t),this.elapsedOverall+=t,this.invocationCount+=1,this._stopWatch=void 0}}};fu.all=new Set,fu._idPool=0;var W5=fu,_m=-1,kv=class Ev{constructor(t,i,r=(Ev._idPool++).toString(16).padStart(3,"0")){this._errorHandler=t,this.threshold=i,this.name=r,this._warnCountdown=0}dispose(){this._stacks?.clear()}check(t,i){let r=this.threshold;if(r<=0||i<r)return;this._stacks||(this._stacks=new Map);let s=this._stacks.get(t.value)||0;if(this._stacks.set(t.value,s+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=r*.5;let[n,o]=this.getMostFrequentStack(),a=`[${this.name}] potential listener LEAK detected, having ${i} listeners already. MOST frequent listener (${o}):`;console.warn(a),console.warn(n);let h=new G5(a,n);this._errorHandler(h)}return()=>{let n=this._stacks.get(t.value)||0;this._stacks.set(t.value,n-1)}}getMostFrequentStack(){if(!this._stacks)return;let t,i=0;for(let[r,s]of this._stacks)(!t||i<s)&&(t=[r,s],i=s);return t}};kv._idPool=1;var $5=kv,pu=class Bv{constructor(t){this.value=t}static create(){let t=new Error;return new Bv(t.stack??"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},G5=class extends Error{constructor(e,t){super(e),this.name="ListenerLeakError",this.stack=t}},j5=class extends Error{constructor(e,t){super(e),this.name="ListenerRefusalError",this.stack=t}},q5=0,Na=class{constructor(e){this.value=e,this.id=q5++}},V5=2,Y5=(e,t)=>{if(e instanceof Na)t(e);else for(let i=0;i<e.length;i++){let r=e[i];r&&t(r)}},Qa;if(U5){let e=[];setInterval(()=>{e.length!==0&&(console.warn("[LEAKING LISTENERS] GC'ed these listeners that were NOT yet disposed:"),console.warn(e.join(`
`)),e.length=0)},3e3),Qa=new FinalizationRegistry(t=>{typeof t=="string"&&e.push(t)})}var Y=class{constructor(e){this._size=0,this._options=e,this._leakageMon=_m>0||this._options?.leakWarningThreshold?new $5(e?.onListenerError??Ka,this._options?.leakWarningThreshold??_m):void 0,this._perfMon=this._options?._profName?new W5(this._options._profName):void 0,this._deliveryQueue=this._options?.deliveryQueue}dispose(){if(!this._disposed){if(this._disposed=!0,this._deliveryQueue?.current===this&&this._deliveryQueue.reset(),this._listeners){if(fm){let e=this._listeners;queueMicrotask(()=>{Y5(e,t=>t.stack?.print())})}this._listeners=void 0,this._size=0}this._options?.onDidRemoveLastListener?.(),this._leakageMon?.dispose()}}get event(){return this._event??=(e,t,i)=>{if(this._leakageMon&&this._size>this._leakageMon.threshold**2){let a=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(a);let h=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],l=new j5(`${a}. HINT: Stack shows most frequent listener (${h[1]}-times)`,h[0]);return(this._options?.onListenerError||Ka)(l),oe.None}if(this._disposed)return oe.None;t&&(e=e.bind(t));let r=new Na(e),s,n;this._leakageMon&&this._size>=Math.ceil(this._leakageMon.threshold*.2)&&(r.stack=pu.create(),s=this._leakageMon.check(r.stack,this._size+1)),fm&&(r.stack=n??pu.create()),this._listeners?this._listeners instanceof Na?(this._deliveryQueue??=new J5,this._listeners=[this._listeners,r]):this._listeners.push(r):(this._options?.onWillAddFirstListener?.(this),this._listeners=r,this._options?.onDidAddFirstListener?.(this)),this._size++;let o=Ae(()=>{Qa?.unregister(o),s?.(),this._removeListener(r)});if(i instanceof br?i.add(o):Array.isArray(i)&&i.push(o),Qa){let a=new Error().stack.split(`
`).slice(2,3).join(`
`).trim(),h=/(file:|vscode-file:\/\/vscode-app)?(\/[^:]*:\d+:\d+)/.exec(a);Qa.register(o,h?.[2]??a,o)}return o},this._event}_removeListener(e){if(this._options?.onWillRemoveListener?.(this),!this._listeners)return;if(this._size===1){this._listeners=void 0,this._options?.onDidRemoveLastListener?.(this),this._size=0;return}let t=this._listeners,i=t.indexOf(e);if(i===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),new Error("Attempted to dispose unknown listener");this._size--,t[i]=void 0;let r=this._deliveryQueue.current===this;if(this._size*V5<=t.length){let s=0;for(let n=0;n<t.length;n++)t[n]?t[s++]=t[n]:r&&(this._deliveryQueue.end--,s<this._deliveryQueue.i&&this._deliveryQueue.i--);t.length=s}}_deliver(e,t){if(!e)return;let i=this._options?.onListenerError||Ka;if(!i){e.value(t);return}try{e.value(t)}catch(r){i(r)}}_deliverQueue(e){let t=e.current._listeners;for(;e.i<e.end;)this._deliver(t[e.i++],e.value);e.reset()}fire(e){if(this._deliveryQueue?.current&&(this._deliverQueue(this._deliveryQueue),this._perfMon?.stop()),this._perfMon?.start(this._size),this._listeners)if(this._listeners instanceof Na)this._deliver(this._listeners,e);else{let t=this._deliveryQueue;t.enqueue(this,e,this._listeners.length),this._deliverQueue(t)}this._perfMon?.stop()}hasListeners(){return this._size>0}},J5=class{constructor(){this.i=-1,this.end=0}enqueue(e,t,i){this.i=0,this.end=i,this.current=e,this.value=t}reset(){this.i=this.end,this.current=void 0,this.value=void 0}},gu=class{constructor(){this.mapWindowIdToZoomLevel=new Map,this._onDidChangeZoomLevel=new Y,this.onDidChangeZoomLevel=this._onDidChangeZoomLevel.event,this.mapWindowIdToZoomFactor=new Map,this._onDidChangeFullscreen=new Y,this.onDidChangeFullscreen=this._onDidChangeFullscreen.event,this.mapWindowIdToFullScreen=new Map}getZoomLevel(t){return this.mapWindowIdToZoomLevel.get(this.getWindowId(t))??0}setZoomLevel(t,i){if(this.getZoomLevel(i)===t)return;let r=this.getWindowId(i);this.mapWindowIdToZoomLevel.set(r,t),this._onDidChangeZoomLevel.fire(r)}getZoomFactor(t){return this.mapWindowIdToZoomFactor.get(this.getWindowId(t))??1}setZoomFactor(t,i){this.mapWindowIdToZoomFactor.set(this.getWindowId(i),t)}setFullscreen(t,i){if(this.isFullscreen(i)===t)return;let r=this.getWindowId(i);this.mapWindowIdToFullScreen.set(r,t),this._onDidChangeFullscreen.fire(r)}isFullscreen(t){return!!this.mapWindowIdToFullScreen.get(this.getWindowId(t))}getWindowId(t){return t.vscodeWindowId}};gu.INSTANCE=new gu;var Uu=gu;function Z5(e,t,i){typeof t=="string"&&(t=e.matchMedia(t)),t.addEventListener("change",i)}var FI=Uu.INSTANCE.onDidChangeZoomLevel;function ek(e){return Uu.INSTANCE.getZoomFactor(e)}var PI=Uu.INSTANCE.onDidChangeFullscreen,ks=typeof navigator=="object"?navigator.userAgent:"",mu=ks.indexOf("Firefox")>=0,Ha=ks.indexOf("AppleWebKit")>=0,zu=ks.indexOf("Chrome")>=0,Lv=!zu&&ks.indexOf("Safari")>=0,OI=ks.indexOf("Electron/")>=0,KI=ks.indexOf("Android")>=0,Xa=!1;if(typeof Tt.matchMedia=="function"){let e=Tt.matchMedia("(display-mode: standalone) or (display-mode: window-controls-overlay)"),t=Tt.matchMedia("(display-mode: fullscreen)");Xa=e.matches,Z5(Tt,e,({matches:i})=>{Xa&&t.matches||(Xa=i)})}function tk(){return Xa}var xs="en",qa=!1,Va=!1,Xn=!1,ik=!1,Dv=!1,Iv=!1,rk=!1,sk=!1,nk=!1,ok=!1,Ta,Ua=xs,pm=xs,ak,Ti,Fi=globalThis,Mt;typeof Fi.vscode<"u"&&typeof Fi.vscode.process<"u"?Mt=Fi.vscode.process:typeof process<"u"&&typeof process?.versions?.node=="string"&&(Mt=process);var Mv=typeof Mt?.versions?.electron=="string",lk=Mv&&Mt?.type==="renderer";if(typeof Mt=="object"){qa=Mt.platform==="win32",Va=Mt.platform==="darwin",Xn=Mt.platform==="linux",ik=Xn&&!!Mt.env.SNAP&&!!Mt.env.SNAP_REVISION,rk=Mv,nk=!!Mt.env.CI||!!Mt.env.BUILD_ARTIFACTSTAGINGDIRECTORY,Ta=xs,Ua=xs;let e=Mt.env.VSCODE_NLS_CONFIG;if(e)try{let t=JSON.parse(e);Ta=t.userLocale,pm=t.osLocale,Ua=t.resolvedLanguage||xs,ak=t.languagePack?.translationsConfigFile}catch{}Dv=!0}else typeof navigator=="object"&&!lk?(Ti=navigator.userAgent,qa=Ti.indexOf("Windows")>=0,Va=Ti.indexOf("Macintosh")>=0,sk=(Ti.indexOf("Macintosh")>=0||Ti.indexOf("iPad")>=0||Ti.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,Xn=Ti.indexOf("Linux")>=0,ok=Ti?.indexOf("Mobi")>=0,Iv=!0,Ua=globalThis._VSCODE_NLS_LANGUAGE||xs,Ta=navigator.language.toLowerCase(),pm=Ta):console.error("Unable to resolve platform.");var Xc=0;Va?Xc=1:qa?Xc=3:Xn&&(Xc=2);var Tv=qa,gi=Va,hk=Xn,Uc=Dv,ck=Iv&&typeof Fi.importScripts=="function",NI=ck?Fi.origin:void 0,mi=Ti,_r=Ua,uk;(e=>{function t(){return _r}e.value=t;function i(){return _r.length===2?_r==="en":_r.length>=3?_r[0]==="e"&&_r[1]==="n"&&_r[2]==="-":!1}e.isDefaultVariant=i;function r(){return _r==="en"}e.isDefault=r})(uk||={});var dk=typeof Fi.postMessage=="function"&&!Fi.importScripts,fk=(()=>{if(dk){let e=[];Fi.addEventListener("message",i=>{if(i.data&&i.data.vscodeScheduleAsyncWork)for(let r=0,s=e.length;r<s;r++){let n=e[r];if(n.id===i.data.vscodeScheduleAsyncWork){e.splice(r,1),n.callback();return}}});let t=0;return i=>{let r=++t;e.push({id:r,callback:i}),Fi.postMessage({vscodeScheduleAsyncWork:r},"*")}}return e=>setTimeout(e)})(),_k=!!(mi&&mi.indexOf("Chrome")>=0),QI=!!(mi&&mi.indexOf("Firefox")>=0),HI=!!(!_k&&mi&&mi.indexOf("Safari")>=0),XI=!!(mi&&mi.indexOf("Edg/")>=0),UI=!!(mi&&mi.indexOf("Android")>=0),pr=typeof navigator=="object"?navigator:{},zI={clipboard:{writeText:Uc||document.queryCommandSupported&&document.queryCommandSupported("copy")||!!(pr&&pr.clipboard&&pr.clipboard.writeText),readText:Uc||!!(pr&&pr.clipboard&&pr.clipboard.readText)},keyboard:Uc||tk()?0:pr.keyboard||Lv?1:2,touch:"ontouchstart"in Tt||pr.maxTouchPoints>0,pointerEvents:Tt.PointerEvent&&("ontouchstart"in Tt||navigator.maxTouchPoints>0)},Wu=class{constructor(){this._keyCodeToStr=[],this._strToKeyCode=Object.create(null)}define(e,t){this._keyCodeToStr[e]=t,this._strToKeyCode[t.toLowerCase()]=e}keyCodeToStr(e){return this._keyCodeToStr[e]}strToKeyCode(e){return this._strToKeyCode[e.toLowerCase()]||0}},zc=new Wu,gm=new Wu,mm=new Wu,pk=new Array(230),Rv;(e=>{function t(a){return zc.keyCodeToStr(a)}e.toString=t;function i(a){return zc.strToKeyCode(a)}e.fromString=i;function r(a){return gm.keyCodeToStr(a)}e.toUserSettingsUS=r;function s(a){return mm.keyCodeToStr(a)}e.toUserSettingsGeneral=s;function n(a){return gm.strToKeyCode(a)||mm.strToKeyCode(a)}e.fromUserSettings=n;function o(a){if(a>=98&&a<=113)return null;switch(a){case 16:return"Up";case 18:return"Down";case 15:return"Left";case 17:return"Right"}return zc.keyCodeToStr(a)}e.toElectronAccelerator=o})(Rv||={});var gk=class Fv{constructor(t,i,r,s,n){this.ctrlKey=t,this.shiftKey=i,this.altKey=r,this.metaKey=s,this.keyCode=n}equals(t){return t instanceof Fv&&this.ctrlKey===t.ctrlKey&&this.shiftKey===t.shiftKey&&this.altKey===t.altKey&&this.metaKey===t.metaKey&&this.keyCode===t.keyCode}getHashCode(){let t=this.ctrlKey?"1":"0",i=this.shiftKey?"1":"0",r=this.altKey?"1":"0",s=this.metaKey?"1":"0";return`K${t}${i}${r}${s}${this.keyCode}`}isModifierKey(){return this.keyCode===0||this.keyCode===5||this.keyCode===57||this.keyCode===6||this.keyCode===4}toKeybinding(){return new mk([this])}isDuplicateModifierCase(){return this.ctrlKey&&this.keyCode===5||this.shiftKey&&this.keyCode===4||this.altKey&&this.keyCode===6||this.metaKey&&this.keyCode===57}},mk=class{constructor(e){if(e.length===0)throw B5("chords");this.chords=e}getHashCode(){let e="";for(let t=0,i=this.chords.length;t<i;t++)t!==0&&(e+=";"),e+=this.chords[t].getHashCode();return e}equals(e){if(e===null||this.chords.length!==e.chords.length)return!1;for(let t=0;t<this.chords.length;t++)if(!this.chords[t].equals(e.chords[t]))return!1;return!0}};function vk(e){if(e.charCode){let i=String.fromCharCode(e.charCode).toUpperCase();return Rv.fromString(i)}let t=e.keyCode;if(t===3)return 7;if(mu)switch(t){case 59:return 85;case 60:if(hk)return 97;break;case 61:return 86;case 107:return 109;case 109:return 111;case 173:return 88;case 224:if(gi)return 57;break}else if(Ha&&(gi&&t===93||!gi&&t===92))return 57;return pk[t]||0}var yk=gi?256:2048,bk=512,wk=1024,Ak=gi?2048:256,vu=class{constructor(e){this._standardKeyboardEventBrand=!0;let t=e;this.browserEvent=t,this.target=t.target,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.altKey=t.altKey,this.metaKey=t.metaKey,this.altGraphKey=t.getModifierState?.("AltGraph"),this.keyCode=vk(t),this.code=t.code,this.ctrlKey=this.ctrlKey||this.keyCode===5,this.altKey=this.altKey||this.keyCode===6,this.shiftKey=this.shiftKey||this.keyCode===4,this.metaKey=this.metaKey||this.keyCode===57,this._asKeybinding=this._computeKeybinding(),this._asKeyCodeChord=this._computeKeyCodeChord()}preventDefault(){this.browserEvent&&this.browserEvent.preventDefault&&this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent&&this.browserEvent.stopPropagation&&this.browserEvent.stopPropagation()}toKeyCodeChord(){return this._asKeyCodeChord}equals(e){return this._asKeybinding===e}_computeKeybinding(){let e=0;this.keyCode!==5&&this.keyCode!==4&&this.keyCode!==6&&this.keyCode!==57&&(e=this.keyCode);let t=0;return this.ctrlKey&&(t|=yk),this.altKey&&(t|=bk),this.shiftKey&&(t|=wk),this.metaKey&&(t|=Ak),t|=e,t}_computeKeyCodeChord(){let e=0;return this.keyCode!==5&&this.keyCode!==4&&this.keyCode!==6&&this.keyCode!==57&&(e=this.keyCode),new gk(this.ctrlKey,this.shiftKey,this.altKey,this.metaKey,e)}},vm=new WeakMap;function xk(e){if(!e.parent||e.parent===e)return null;try{let t=e.location,i=e.parent.location;if(t.origin!=="null"&&i.origin!=="null"&&t.origin!==i.origin)return null}catch{return null}return e.parent}var Sk=class{static getSameOriginWindowChain(e){let t=vm.get(e);if(!t){t=[],vm.set(e,t);let i=e,r;do r=xk(i),r?t.push({window:new WeakRef(i),iframeElement:i.frameElement||null}):t.push({window:new WeakRef(i),iframeElement:null}),i=r;while(i)}return t.slice(0)}static getPositionOfChildWindowRelativeToAncestorWindow(e,t){if(!t||e===t)return{top:0,left:0};let i=0,r=0,s=this.getSameOriginWindowChain(e);for(let n of s){let o=n.window.deref();if(i+=o?.scrollY??0,r+=o?.scrollX??0,o===t||!n.iframeElement)break;let a=n.iframeElement.getBoundingClientRect();i+=a.top,r+=a.left}return{top:i,left:r}}},Pn=class{constructor(e,t){this.timestamp=Date.now(),this.browserEvent=t,this.leftButton=t.button===0,this.middleButton=t.button===1,this.rightButton=t.button===2,this.buttons=t.buttons,this.target=t.target,this.detail=t.detail||1,t.type==="dblclick"&&(this.detail=2),this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.altKey=t.altKey,this.metaKey=t.metaKey,typeof t.pageX=="number"?(this.posx=t.pageX,this.posy=t.pageY):(this.posx=t.clientX+this.target.ownerDocument.body.scrollLeft+this.target.ownerDocument.documentElement.scrollLeft,this.posy=t.clientY+this.target.ownerDocument.body.scrollTop+this.target.ownerDocument.documentElement.scrollTop);let i=Sk.getPositionOfChildWindowRelativeToAncestorWindow(e,t.view);this.posx-=i.left,this.posy-=i.top}preventDefault(){this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent.stopPropagation()}},ym=class{constructor(e,t=0,i=0){this.browserEvent=e||null,this.target=e?e.target||e.targetNode||e.srcElement:null,this.deltaY=i,this.deltaX=t;let r=!1;if(zu){let s=navigator.userAgent.match(/Chrome\/(\d+)/);r=(s?parseInt(s[1]):123)<=122}if(e){let s=e,n=e,o=e.view?.devicePixelRatio||1;if(typeof s.wheelDeltaY<"u")r?this.deltaY=s.wheelDeltaY/(120*o):this.deltaY=s.wheelDeltaY/120;else if(typeof n.VERTICAL_AXIS<"u"&&n.axis===n.VERTICAL_AXIS)this.deltaY=-n.detail/3;else if(e.type==="wheel"){let a=e;a.deltaMode===a.DOM_DELTA_LINE?mu&&!gi?this.deltaY=-e.deltaY/3:this.deltaY=-e.deltaY:this.deltaY=-e.deltaY/40}if(typeof s.wheelDeltaX<"u")Lv&&Tv?this.deltaX=-(s.wheelDeltaX/120):r?this.deltaX=s.wheelDeltaX/(120*o):this.deltaX=s.wheelDeltaX/120;else if(typeof n.HORIZONTAL_AXIS<"u"&&n.axis===n.HORIZONTAL_AXIS)this.deltaX=-e.detail/3;else if(e.type==="wheel"){let a=e;a.deltaMode===a.DOM_DELTA_LINE?mu&&!gi?this.deltaX=-e.deltaX/3:this.deltaX=-e.deltaX:this.deltaX=-e.deltaX/40}this.deltaY===0&&this.deltaX===0&&e.wheelDelta&&(r?this.deltaY=e.wheelDelta/(120*o):this.deltaY=e.wheelDelta/120)}}preventDefault(){this.browserEvent?.preventDefault()}stopPropagation(){this.browserEvent?.stopPropagation()}},Pv=Object.freeze(function(e,t){let i=setTimeout(e.bind(t),0);return{dispose(){clearTimeout(i)}}}),Ck;(e=>{function t(i){return i===e.None||i===e.Cancelled||i instanceof kk?!0:!i||typeof i!="object"?!1:typeof i.isCancellationRequested=="boolean"&&typeof i.onCancellationRequested=="function"}e.isCancellationToken=t,e.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:ot.None}),e.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:Pv})})(Ck||={});var kk=class{constructor(){this._isCancelled=!1,this._emitter=null}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?Pv:(this._emitter||(this._emitter=new Y),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}},WI=Symbol("MicrotaskDelay"),$u=class{constructor(e,t){this._isDisposed=!1,this._token=-1,typeof e=="function"&&typeof t=="number"&&this.setIfNotSet(e,t)}dispose(){this.cancel(),this._isDisposed=!0}cancel(){this._token!==-1&&(clearTimeout(this._token),this._token=-1)}cancelAndSet(e,t){if(this._isDisposed)throw new hu("Calling 'cancelAndSet' on a disposed TimeoutTimer");this.cancel(),this._token=setTimeout(()=>{this._token=-1,e()},t)}setIfNotSet(e,t){if(this._isDisposed)throw new hu("Calling 'setIfNotSet' on a disposed TimeoutTimer");this._token===-1&&(this._token=setTimeout(()=>{this._token=-1,e()},t))}},Ek=class{constructor(){this.disposable=void 0,this.isDisposed=!1}cancel(){this.disposable?.dispose(),this.disposable=void 0}cancelAndSet(e,t,i=globalThis){if(this.isDisposed)throw new hu("Calling 'cancelAndSet' on a disposed IntervalTimer");this.cancel();let r=i.setInterval(()=>{e()},t);this.disposable=Ae(()=>{i.clearInterval(r),this.disposable=void 0})}dispose(){this.cancel(),this.isDisposed=!0}},Bk,Wc;(function(){typeof globalThis.requestIdleCallback!="function"||typeof globalThis.cancelIdleCallback!="function"?Wc=(e,t)=>{fk(()=>{if(i)return;let r=Date.now()+15;t(Object.freeze({didTimeout:!0,timeRemaining(){return Math.max(0,r-Date.now())}}))});let i=!1;return{dispose(){i||(i=!0)}}}:Wc=(e,t,i)=>{let r=e.requestIdleCallback(t,typeof i=="number"?{timeout:i}:void 0),s=!1;return{dispose(){s||(s=!0,e.cancelIdleCallback(r))}}},Bk=e=>Wc(globalThis,e)})();var Lk;(e=>{async function t(r){let s,n=await Promise.all(r.map(o=>o.then(a=>a,a=>{s||(s=a)})));if(typeof s<"u")throw s;return n}e.settled=t;function i(r){return new Promise(async(s,n)=>{try{await r(s,n)}catch(o){n(o)}})}e.withAsyncBody=i})(Lk||={});var bm=class zt{static fromArray(t){return new zt(i=>{i.emitMany(t)})}static fromPromise(t){return new zt(async i=>{i.emitMany(await t)})}static fromPromises(t){return new zt(async i=>{await Promise.all(t.map(async r=>i.emitOne(await r)))})}static merge(t){return new zt(async i=>{await Promise.all(t.map(async r=>{for await(let s of r)i.emitOne(s)}))})}constructor(t,i){this._state=0,this._results=[],this._error=null,this._onReturn=i,this._onStateChanged=new Y,queueMicrotask(async()=>{let r={emitOne:s=>this.emitOne(s),emitMany:s=>this.emitMany(s),reject:s=>this.reject(s)};try{await Promise.resolve(t(r)),this.resolve()}catch(s){this.reject(s)}finally{r.emitOne=void 0,r.emitMany=void 0,r.reject=void 0}})}[Symbol.asyncIterator](){let t=0;return{next:async()=>{do{if(this._state===2)throw this._error;if(t<this._results.length)return{done:!1,value:this._results[t++]};if(this._state===1)return{done:!0,value:void 0};await ot.toPromise(this._onStateChanged.event)}while(!0)},return:async()=>(this._onReturn?.(),{done:!0,value:void 0})}}static map(t,i){return new zt(async r=>{for await(let s of t)r.emitOne(i(s))})}map(t){return zt.map(this,t)}static filter(t,i){return new zt(async r=>{for await(let s of t)i(s)&&r.emitOne(s)})}filter(t){return zt.filter(this,t)}static coalesce(t){return zt.filter(t,i=>!!i)}coalesce(){return zt.coalesce(this)}static async toPromise(t){let i=[];for await(let r of t)i.push(r);return i}toPromise(){return zt.toPromise(this)}emitOne(t){this._state===0&&(this._results.push(t),this._onStateChanged.fire())}emitMany(t){this._state===0&&(this._results=this._results.concat(t),this._onStateChanged.fire())}resolve(){this._state===0&&(this._state=1,this._onStateChanged.fire())}reject(t){this._state===0&&(this._state=2,this._error=t,this._onStateChanged.fire())}};bm.EMPTY=bm.fromArray([]);function Dk(e){return 55296<=e&&e<=56319}function wm(e){return 56320<=e&&e<=57343}function Ik(e,t){return(e-55296<<10)+(t-56320)+65536}function Mk(e){return Gu(e,0)}function Gu(e,t){switch(typeof e){case"object":return e===null?Ri(349,t):Array.isArray(e)?Rk(e,t):Fk(e,t);case"string":return Ov(e,t);case"boolean":return Tk(e,t);case"number":return Ri(e,t);case"undefined":return Ri(937,t);default:return Ri(617,t)}}function Ri(e,t){return(t<<5)-t+e|0}function Tk(e,t){return Ri(e?433:863,t)}function Ov(e,t){t=Ri(149417,t);for(let i=0,r=e.length;i<r;i++)t=Ri(e.charCodeAt(i),t);return t}function Rk(e,t){return t=Ri(104579,t),e.reduce((i,r)=>Gu(r,i),t)}function Fk(e,t){return t=Ri(181387,t),Object.keys(e).sort().reduce((i,r)=>(i=Ov(r,i),Gu(e[r],i)),t)}function $c(e,t,i=32){let r=i-t,s=~((1<<r)-1);return(e<<t|(s&e)>>>r)>>>0}function Am(e,t=0,i=e.byteLength,r=0){for(let s=0;s<i;s++)e[t+s]=r}function Pk(e,t,i="0"){for(;e.length<t;)e=i+e;return e}function Ln(e,t=32){return e instanceof ArrayBuffer?Array.from(new Uint8Array(e)).map(i=>i.toString(16).padStart(2,"0")).join(""):Pk((e>>>0).toString(16),t/4)}var Ok=class Kv{constructor(){this._h0=1732584193,this._h1=4023233417,this._h2=2562383102,this._h3=271733878,this._h4=3285377520,this._buff=new Uint8Array(67),this._buffDV=new DataView(this._buff.buffer),this._buffLen=0,this._totalLen=0,this._leftoverHighSurrogate=0,this._finished=!1}update(t){let i=t.length;if(i===0)return;let r=this._buff,s=this._buffLen,n=this._leftoverHighSurrogate,o,a;for(n!==0?(o=n,a=-1,n=0):(o=t.charCodeAt(0),a=0);;){let h=o;if(Dk(o))if(a+1<i){let l=t.charCodeAt(a+1);wm(l)?(a++,h=Ik(o,l)):h=65533}else{n=o;break}else wm(o)&&(h=65533);if(s=this._push(r,s,h),a++,a<i)o=t.charCodeAt(a);else break}this._buffLen=s,this._leftoverHighSurrogate=n}_push(t,i,r){return r<128?t[i++]=r:r<2048?(t[i++]=192|(r&1984)>>>6,t[i++]=128|(r&63)>>>0):r<65536?(t[i++]=224|(r&61440)>>>12,t[i++]=128|(r&4032)>>>6,t[i++]=128|(r&63)>>>0):(t[i++]=240|(r&1835008)>>>18,t[i++]=128|(r&258048)>>>12,t[i++]=128|(r&4032)>>>6,t[i++]=128|(r&63)>>>0),i>=64&&(this._step(),i-=64,this._totalLen+=64,t[0]=t[64],t[1]=t[65],t[2]=t[66]),i}digest(){return this._finished||(this._finished=!0,this._leftoverHighSurrogate&&(this._leftoverHighSurrogate=0,this._buffLen=this._push(this._buff,this._buffLen,65533)),this._totalLen+=this._buffLen,this._wrapUp()),Ln(this._h0)+Ln(this._h1)+Ln(this._h2)+Ln(this._h3)+Ln(this._h4)}_wrapUp(){this._buff[this._buffLen++]=128,Am(this._buff,this._buffLen),this._buffLen>56&&(this._step(),Am(this._buff));let t=8*this._totalLen;this._buffDV.setUint32(56,Math.floor(t/4294967296),!1),this._buffDV.setUint32(60,t%4294967296,!1),this._step()}_step(){let t=Kv._bigBlock32,i=this._buffDV;for(let u=0;u<64;u+=4)t.setUint32(u,i.getUint32(u,!1),!1);for(let u=64;u<320;u+=4)t.setUint32(u,$c(t.getUint32(u-12,!1)^t.getUint32(u-32,!1)^t.getUint32(u-56,!1)^t.getUint32(u-64,!1),1),!1);let r=this._h0,s=this._h1,n=this._h2,o=this._h3,a=this._h4,h,l,c;for(let u=0;u<80;u++)u<20?(h=s&n|~s&o,l=1518500249):u<40?(h=s^n^o,l=1859775393):u<60?(h=s&n|s&o|n&o,l=2400959708):(h=s^n^o,l=3395469782),c=$c(r,5)+h+a+l+t.getUint32(u*4,!1)&4294967295,a=o,o=n,n=$c(s,30),s=r,r=c;this._h0=this._h0+r&4294967295,this._h1=this._h1+s&4294967295,this._h2=this._h2+n&4294967295,this._h3=this._h3+o&4294967295,this._h4=this._h4+a&4294967295}};Ok._bigBlock32=new DataView(new ArrayBuffer(320));var{registerWindow:$I,getWindow:ti,getDocument:GI,getWindows:jI,getWindowsCount:qI,getWindowId:xm,getWindowById:VI,hasWindow:YI,onDidRegisterWindow:Kk,onWillUnregisterWindow:JI,onDidUnregisterWindow:ZI}=function(){let e=new Map,t={window:Tt,disposables:new br};e.set(Tt.vscodeWindowId,t);let i=new Y,r=new Y,s=new Y;function n(o,a){return(typeof o=="number"?e.get(o):void 0)??(a?t:void 0)}return{onDidRegisterWindow:i.event,onWillUnregisterWindow:s.event,onDidUnregisterWindow:r.event,registerWindow(o){if(e.has(o.vscodeWindowId))return oe.None;let a=new br,h={window:o,disposables:a.add(new br)};return e.set(o.vscodeWindowId,h),a.add(Ae(()=>{e.delete(o.vscodeWindowId),r.fire(o)})),a.add(se(o,qe.BEFORE_UNLOAD,()=>{s.fire(o)})),i.fire(h),a},getWindows(){return e.values()},getWindowsCount(){return e.size},getWindowId(o){return o.vscodeWindowId},hasWindow(o){return e.has(o)},getWindowById:n,getWindow(o){let a=o;if(a?.ownerDocument?.defaultView)return a.ownerDocument.defaultView.window;let h=o;return h?.view?h.view.window:Tt},getDocument(o){return ti(o).document}}}(),Nk=class{constructor(e,t,i,r){this._node=e,this._type=t,this._handler=i,this._options=r||!1,this._node.addEventListener(this._type,this._handler,this._options)}dispose(){this._handler&&(this._node.removeEventListener(this._type,this._handler,this._options),this._node=null,this._handler=null)}};function se(e,t,i,r){return new Nk(e,t,i,r)}function Qk(e,t){return function(i){return t(new Pn(e,i))}}function Hk(e){return function(t){return e(new vu(t))}}var Sm=function(e,t,i,r){let s=i;return t==="click"||t==="mousedown"||t==="contextmenu"?s=Qk(ti(e),i):(t==="keydown"||t==="keypress"||t==="keyup")&&(s=Hk(i)),se(e,t,s,r)},Xk,Ya,Uk=class extends Ek{constructor(e){super(),this.defaultTarget=e&&ti(e)}cancelAndSet(e,t,i){return super.cancelAndSet(e,t,i??this.defaultTarget)}},Gc=class{constructor(e,t=0){this._runner=e,this.priority=t,this._canceled=!1}dispose(){this._canceled=!0}execute(){if(!this._canceled)try{this._runner()}catch(e){Ka(e)}}static sort(e,t){return t.priority-e.priority}};(function(){let e=new Map,t=new Map,i=new Map,r=new Map,s=n=>{i.set(n,!1);let o=e.get(n)??[];for(t.set(n,o),e.set(n,[]),r.set(n,!0);o.length>0;)o.sort(Gc.sort),o.shift().execute();r.set(n,!1)};Ya=(n,o,a=0)=>{let h=xm(n),l=new Gc(o,a),c=e.get(h);return c||(c=[],e.set(h,c)),c.push(l),i.get(h)||(i.set(h,!0),n.requestAnimationFrame(()=>s(h))),l},Xk=(n,o,a)=>{let h=xm(n);if(r.get(h)){let l=new Gc(o,a),c=t.get(h);return c||(c=[],t.set(h,c)),c.push(l),l}else return Ya(n,o,a)}})();var Cm=class za{constructor(t,i){this.width=t,this.height=i}with(t=this.width,i=this.height){return t!==this.width||i!==this.height?new za(t,i):this}static is(t){return typeof t=="object"&&typeof t.height=="number"&&typeof t.width=="number"}static lift(t){return t instanceof za?t:new za(t.width,t.height)}static equals(t,i){return t===i?!0:!t||!i?!1:t.width===i.width&&t.height===i.height}};Cm.None=new Cm(0,0);function zk(e){let t=e.getBoundingClientRect(),i=ti(e);return{left:t.left+i.scrollX,top:t.top+i.scrollY,width:t.width,height:t.height}}var eM=new class{constructor(){this.mutationObservers=new Map}observe(e,t,i){let r=this.mutationObservers.get(e);r||(r=new Map,this.mutationObservers.set(e,r));let s=Mk(i),n=r.get(s);if(n)n.users+=1;else{let o=new Y,a=new MutationObserver(l=>o.fire(l));a.observe(e,i);let h=n={users:1,observer:a,onDidMutate:o.event};t.add(Ae(()=>{h.users-=1,h.users===0&&(o.dispose(),a.disconnect(),r?.delete(s),r?.size===0&&this.mutationObservers.delete(e))})),r.set(s,n)}return n.onDidMutate}},qe={CLICK:"click",AUXCLICK:"auxclick",DBLCLICK:"dblclick",MOUSE_UP:"mouseup",MOUSE_DOWN:"mousedown",MOUSE_OVER:"mouseover",MOUSE_MOVE:"mousemove",MOUSE_OUT:"mouseout",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_WHEEL:"wheel",POINTER_UP:"pointerup",POINTER_DOWN:"pointerdown",POINTER_MOVE:"pointermove",POINTER_LEAVE:"pointerleave",CONTEXT_MENU:"contextmenu",WHEEL:"wheel",KEY_DOWN:"keydown",KEY_PRESS:"keypress",KEY_UP:"keyup",LOAD:"load",BEFORE_UNLOAD:"beforeunload",UNLOAD:"unload",PAGE_SHOW:"pageshow",PAGE_HIDE:"pagehide",PASTE:"paste",ABORT:"abort",ERROR:"error",RESIZE:"resize",SCROLL:"scroll",FULLSCREEN_CHANGE:"fullscreenchange",WK_FULLSCREEN_CHANGE:"webkitfullscreenchange",SELECT:"select",CHANGE:"change",SUBMIT:"submit",RESET:"reset",FOCUS:"focus",FOCUS_IN:"focusin",FOCUS_OUT:"focusout",BLUR:"blur",INPUT:"input",STORAGE:"storage",DRAG_START:"dragstart",DRAG:"drag",DRAG_ENTER:"dragenter",DRAG_LEAVE:"dragleave",DRAG_OVER:"dragover",DROP:"drop",DRAG_END:"dragend",ANIMATION_START:Ha?"webkitAnimationStart":"animationstart",ANIMATION_END:Ha?"webkitAnimationEnd":"animationend",ANIMATION_ITERATION:Ha?"webkitAnimationIteration":"animationiteration"},Wk=/([\w\-]+)?(#([\w\-]+))?((\.([\w\-]+))*)/;function Nv(e,t,i,...r){let s=Wk.exec(t);if(!s)throw new Error("Bad use of emmet");let n=s[1]||"div",o;return e!=="http://www.w3.org/1999/xhtml"?o=document.createElementNS(e,n):o=document.createElement(n),s[3]&&(o.id=s[3]),s[4]&&(o.className=s[4].replace(/\./g," ").trim()),i&&Object.entries(i).forEach(([a,h])=>{typeof h>"u"||(/^on\w+$/.test(a)?o[a]=h:a==="selected"?h&&o.setAttribute(a,"true"):o.setAttribute(a,h))}),o.append(...r),o}function $k(e,t,...i){return Nv("http://www.w3.org/1999/xhtml",e,t,...i)}$k.SVG=function(e,t,...i){return Nv("http://www.w3.org/2000/svg",e,t,...i)};var Gk=class{constructor(e){this.domNode=e,this._maxWidth="",this._width="",this._height="",this._top="",this._left="",this._bottom="",this._right="",this._paddingTop="",this._paddingLeft="",this._paddingBottom="",this._paddingRight="",this._fontFamily="",this._fontWeight="",this._fontSize="",this._fontStyle="",this._fontFeatureSettings="",this._fontVariationSettings="",this._textDecoration="",this._lineHeight="",this._letterSpacing="",this._className="",this._display="",this._position="",this._visibility="",this._color="",this._backgroundColor="",this._layerHint=!1,this._contain="none",this._boxShadow=""}setMaxWidth(e){let t=St(e);this._maxWidth!==t&&(this._maxWidth=t,this.domNode.style.maxWidth=this._maxWidth)}setWidth(e){let t=St(e);this._width!==t&&(this._width=t,this.domNode.style.width=this._width)}setHeight(e){let t=St(e);this._height!==t&&(this._height=t,this.domNode.style.height=this._height)}setTop(e){let t=St(e);this._top!==t&&(this._top=t,this.domNode.style.top=this._top)}setLeft(e){let t=St(e);this._left!==t&&(this._left=t,this.domNode.style.left=this._left)}setBottom(e){let t=St(e);this._bottom!==t&&(this._bottom=t,this.domNode.style.bottom=this._bottom)}setRight(e){let t=St(e);this._right!==t&&(this._right=t,this.domNode.style.right=this._right)}setPaddingTop(e){let t=St(e);this._paddingTop!==t&&(this._paddingTop=t,this.domNode.style.paddingTop=this._paddingTop)}setPaddingLeft(e){let t=St(e);this._paddingLeft!==t&&(this._paddingLeft=t,this.domNode.style.paddingLeft=this._paddingLeft)}setPaddingBottom(e){let t=St(e);this._paddingBottom!==t&&(this._paddingBottom=t,this.domNode.style.paddingBottom=this._paddingBottom)}setPaddingRight(e){let t=St(e);this._paddingRight!==t&&(this._paddingRight=t,this.domNode.style.paddingRight=this._paddingRight)}setFontFamily(e){this._fontFamily!==e&&(this._fontFamily=e,this.domNode.style.fontFamily=this._fontFamily)}setFontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.domNode.style.fontWeight=this._fontWeight)}setFontSize(e){let t=St(e);this._fontSize!==t&&(this._fontSize=t,this.domNode.style.fontSize=this._fontSize)}setFontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.domNode.style.fontStyle=this._fontStyle)}setFontFeatureSettings(e){this._fontFeatureSettings!==e&&(this._fontFeatureSettings=e,this.domNode.style.fontFeatureSettings=this._fontFeatureSettings)}setFontVariationSettings(e){this._fontVariationSettings!==e&&(this._fontVariationSettings=e,this.domNode.style.fontVariationSettings=this._fontVariationSettings)}setTextDecoration(e){this._textDecoration!==e&&(this._textDecoration=e,this.domNode.style.textDecoration=this._textDecoration)}setLineHeight(e){let t=St(e);this._lineHeight!==t&&(this._lineHeight=t,this.domNode.style.lineHeight=this._lineHeight)}setLetterSpacing(e){let t=St(e);this._letterSpacing!==t&&(this._letterSpacing=t,this.domNode.style.letterSpacing=this._letterSpacing)}setClassName(e){this._className!==e&&(this._className=e,this.domNode.className=this._className)}toggleClassName(e,t){this.domNode.classList.toggle(e,t),this._className=this.domNode.className}setDisplay(e){this._display!==e&&(this._display=e,this.domNode.style.display=this._display)}setPosition(e){this._position!==e&&(this._position=e,this.domNode.style.position=this._position)}setVisibility(e){this._visibility!==e&&(this._visibility=e,this.domNode.style.visibility=this._visibility)}setColor(e){this._color!==e&&(this._color=e,this.domNode.style.color=this._color)}setBackgroundColor(e){this._backgroundColor!==e&&(this._backgroundColor=e,this.domNode.style.backgroundColor=this._backgroundColor)}setLayerHinting(e){this._layerHint!==e&&(this._layerHint=e,this.domNode.style.transform=this._layerHint?"translate3d(0px, 0px, 0px)":"")}setBoxShadow(e){this._boxShadow!==e&&(this._boxShadow=e,this.domNode.style.boxShadow=e)}setContain(e){this._contain!==e&&(this._contain=e,this.domNode.style.contain=this._contain)}setAttribute(e,t){this.domNode.setAttribute(e,t)}removeAttribute(e){this.domNode.removeAttribute(e)}appendChild(e){this.domNode.appendChild(e.domNode)}removeChild(e){this.domNode.removeChild(e.domNode)}};function St(e){return typeof e=="number"?`${e}px`:e}function Un(e){return new Gk(e)}var Qv=class{constructor(){this._hooks=new br,this._pointerMoveCallback=null,this._onStopCallback=null}dispose(){this.stopMonitoring(!1),this._hooks.dispose()}stopMonitoring(e,t){if(!this.isMonitoring())return;this._hooks.clear(),this._pointerMoveCallback=null;let i=this._onStopCallback;this._onStopCallback=null,e&&i&&i(t)}isMonitoring(){return!!this._pointerMoveCallback}startMonitoring(e,t,i,r,s){this.isMonitoring()&&this.stopMonitoring(!1),this._pointerMoveCallback=r,this._onStopCallback=s;let n=e;try{e.setPointerCapture(t),this._hooks.add(Ae(()=>{try{e.releasePointerCapture(t)}catch{}}))}catch{n=ti(e)}this._hooks.add(se(n,qe.POINTER_MOVE,o=>{if(o.buttons!==i){this.stopMonitoring(!0);return}o.preventDefault(),this._pointerMoveCallback(o)})),this._hooks.add(se(n,qe.POINTER_UP,o=>this.stopMonitoring(!0)))}};function jk(e,t,i){let r=null,s=null;if(typeof i.value=="function"?(r="value",s=i.value,s.length!==0&&console.warn("Memoize should only be used in functions with zero parameters")):typeof i.get=="function"&&(r="get",s=i.get),!s)throw new Error("not supported");let n=`$memoize$${t}`;i[r]=function(...o){return this.hasOwnProperty(n)||Object.defineProperty(this,n,{configurable:!1,enumerable:!1,writable:!1,value:s.apply(this,o)}),this[n]}}var pi;(e=>(e.Tap="-xterm-gesturetap",e.Change="-xterm-gesturechange",e.Start="-xterm-gesturestart",e.End="-xterm-gesturesend",e.Contextmenu="-xterm-gesturecontextmenu"))(pi||={});var On=class ft extends oe{constructor(){super(),this.dispatched=!1,this.targets=new dm,this.ignoreTargets=new dm,this.activeTouches={},this.handle=null,this._lastSetTapCountTime=0,this._register(ot.runAndSubscribe(Kk,({window:t,disposables:i})=>{i.add(se(t.document,"touchstart",r=>this.onTouchStart(r),{passive:!1})),i.add(se(t.document,"touchend",r=>this.onTouchEnd(t,r))),i.add(se(t.document,"touchmove",r=>this.onTouchMove(r),{passive:!1}))},{window:Tt,disposables:this._store}))}static addTarget(t){if(!ft.isTouchDevice())return oe.None;ft.INSTANCE||(ft.INSTANCE=um(new ft));let i=ft.INSTANCE.targets.push(t);return Ae(i)}static ignoreTarget(t){if(!ft.isTouchDevice())return oe.None;ft.INSTANCE||(ft.INSTANCE=um(new ft));let i=ft.INSTANCE.ignoreTargets.push(t);return Ae(i)}static isTouchDevice(){return"ontouchstart"in Tt||navigator.maxTouchPoints>0}dispose(){this.handle&&(this.handle.dispose(),this.handle=null),super.dispose()}onTouchStart(t){let i=Date.now();this.handle&&(this.handle.dispose(),this.handle=null);for(let r=0,s=t.targetTouches.length;r<s;r++){let n=t.targetTouches.item(r);this.activeTouches[n.identifier]={id:n.identifier,initialTarget:n.target,initialTimeStamp:i,initialPageX:n.pageX,initialPageY:n.pageY,rollingTimestamps:[i],rollingPageX:[n.pageX],rollingPageY:[n.pageY]};let o=this.newGestureEvent(pi.Start,n.target);o.pageX=n.pageX,o.pageY=n.pageY,this.dispatchEvent(o)}this.dispatched&&(t.preventDefault(),t.stopPropagation(),this.dispatched=!1)}onTouchEnd(t,i){let r=Date.now(),s=Object.keys(this.activeTouches).length;for(let n=0,o=i.changedTouches.length;n<o;n++){let a=i.changedTouches.item(n);if(!this.activeTouches.hasOwnProperty(String(a.identifier))){console.warn("move of an UNKNOWN touch",a);continue}let h=this.activeTouches[a.identifier],l=Date.now()-h.initialTimeStamp;if(l<ft.HOLD_DELAY&&Math.abs(h.initialPageX-Dt(h.rollingPageX))<30&&Math.abs(h.initialPageY-Dt(h.rollingPageY))<30){let c=this.newGestureEvent(pi.Tap,h.initialTarget);c.pageX=Dt(h.rollingPageX),c.pageY=Dt(h.rollingPageY),this.dispatchEvent(c)}else if(l>=ft.HOLD_DELAY&&Math.abs(h.initialPageX-Dt(h.rollingPageX))<30&&Math.abs(h.initialPageY-Dt(h.rollingPageY))<30){let c=this.newGestureEvent(pi.Contextmenu,h.initialTarget);c.pageX=Dt(h.rollingPageX),c.pageY=Dt(h.rollingPageY),this.dispatchEvent(c)}else if(s===1){let c=Dt(h.rollingPageX),u=Dt(h.rollingPageY),g=Dt(h.rollingTimestamps)-h.rollingTimestamps[0],_=c-h.rollingPageX[0],m=u-h.rollingPageY[0],v=[...this.targets].filter(x=>h.initialTarget instanceof Node&&x.contains(h.initialTarget));this.inertia(t,v,r,Math.abs(_)/g,_>0?1:-1,c,Math.abs(m)/g,m>0?1:-1,u)}this.dispatchEvent(this.newGestureEvent(pi.End,h.initialTarget)),delete this.activeTouches[a.identifier]}this.dispatched&&(i.preventDefault(),i.stopPropagation(),this.dispatched=!1)}newGestureEvent(t,i){let r=document.createEvent("CustomEvent");return r.initEvent(t,!1,!0),r.initialTarget=i,r.tapCount=0,r}dispatchEvent(t){if(t.type===pi.Tap){let i=new Date().getTime(),r=0;i-this._lastSetTapCountTime>ft.CLEAR_TAP_COUNT_TIME?r=1:r=2,this._lastSetTapCountTime=i,t.tapCount=r}else(t.type===pi.Change||t.type===pi.Contextmenu)&&(this._lastSetTapCountTime=0);if(t.initialTarget instanceof Node){for(let r of this.ignoreTargets)if(r.contains(t.initialTarget))return;let i=[];for(let r of this.targets)if(r.contains(t.initialTarget)){let s=0,n=t.initialTarget;for(;n&&n!==r;)s++,n=n.parentElement;i.push([s,r])}i.sort((r,s)=>r[0]-s[0]);for(let[r,s]of i)s.dispatchEvent(t),this.dispatched=!0}}inertia(t,i,r,s,n,o,a,h,l){this.handle=Ya(t,()=>{let c=Date.now(),u=c-r,g=0,_=0,m=!0;s+=ft.SCROLL_FRICTION*u,a+=ft.SCROLL_FRICTION*u,s>0&&(m=!1,g=n*s*u),a>0&&(m=!1,_=h*a*u);let v=this.newGestureEvent(pi.Change);v.translationX=g,v.translationY=_,i.forEach(x=>x.dispatchEvent(v)),m||this.inertia(t,i,c,s,n,o+g,a,h,l+_)})}onTouchMove(t){let i=Date.now();for(let r=0,s=t.changedTouches.length;r<s;r++){let n=t.changedTouches.item(r);if(!this.activeTouches.hasOwnProperty(String(n.identifier))){console.warn("end of an UNKNOWN touch",n);continue}let o=this.activeTouches[n.identifier],a=this.newGestureEvent(pi.Change,o.initialTarget);a.translationX=n.pageX-Dt(o.rollingPageX),a.translationY=n.pageY-Dt(o.rollingPageY),a.pageX=n.pageX,a.pageY=n.pageY,this.dispatchEvent(a),o.rollingPageX.length>3&&(o.rollingPageX.shift(),o.rollingPageY.shift(),o.rollingTimestamps.shift()),o.rollingPageX.push(n.pageX),o.rollingPageY.push(n.pageY),o.rollingTimestamps.push(i)}this.dispatched&&(t.preventDefault(),t.stopPropagation(),this.dispatched=!1)}};On.SCROLL_FRICTION=-.005,On.HOLD_DELAY=700,On.CLEAR_TAP_COUNT_TIME=400,Me([jk],On,"isTouchDevice",1);var qk=On,ju=class extends oe{onclick(e,t){this._register(se(e,qe.CLICK,i=>t(new Pn(ti(e),i))))}onmousedown(e,t){this._register(se(e,qe.MOUSE_DOWN,i=>t(new Pn(ti(e),i))))}onmouseover(e,t){this._register(se(e,qe.MOUSE_OVER,i=>t(new Pn(ti(e),i))))}onmouseleave(e,t){this._register(se(e,qe.MOUSE_LEAVE,i=>t(new Pn(ti(e),i))))}onkeydown(e,t){this._register(se(e,qe.KEY_DOWN,i=>t(new vu(i))))}onkeyup(e,t){this._register(se(e,qe.KEY_UP,i=>t(new vu(i))))}oninput(e,t){this._register(se(e,qe.INPUT,t))}onblur(e,t){this._register(se(e,qe.BLUR,t))}onfocus(e,t){this._register(se(e,qe.FOCUS,t))}onchange(e,t){this._register(se(e,qe.CHANGE,t))}ignoreGesture(e){return qk.ignoreTarget(e)}},km=11,Vk=class extends ju{constructor(e){super(),this._onActivate=e.onActivate,this.bgDomNode=document.createElement("div"),this.bgDomNode.className="arrow-background",this.bgDomNode.style.position="absolute",this.bgDomNode.style.width=e.bgWidth+"px",this.bgDomNode.style.height=e.bgHeight+"px",typeof e.top<"u"&&(this.bgDomNode.style.top="0px"),typeof e.left<"u"&&(this.bgDomNode.style.left="0px"),typeof e.bottom<"u"&&(this.bgDomNode.style.bottom="0px"),typeof e.right<"u"&&(this.bgDomNode.style.right="0px"),this.domNode=document.createElement("div"),this.domNode.className=e.className,this.domNode.style.position="absolute",this.domNode.style.width=km+"px",this.domNode.style.height=km+"px",typeof e.top<"u"&&(this.domNode.style.top=e.top+"px"),typeof e.left<"u"&&(this.domNode.style.left=e.left+"px"),typeof e.bottom<"u"&&(this.domNode.style.bottom=e.bottom+"px"),typeof e.right<"u"&&(this.domNode.style.right=e.right+"px"),this._pointerMoveMonitor=this._register(new Qv),this._register(Sm(this.bgDomNode,qe.POINTER_DOWN,t=>this._arrowPointerDown(t))),this._register(Sm(this.domNode,qe.POINTER_DOWN,t=>this._arrowPointerDown(t))),this._pointerdownRepeatTimer=this._register(new Uk),this._pointerdownScheduleRepeatTimer=this._register(new $u)}_arrowPointerDown(e){if(!e.target||!(e.target instanceof Element))return;let t=()=>{this._pointerdownRepeatTimer.cancelAndSet(()=>this._onActivate(),1e3/24,ti(e))};this._onActivate(),this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancelAndSet(t,200),this._pointerMoveMonitor.startMonitoring(e.target,e.pointerId,e.buttons,i=>{},()=>{this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancel()}),e.preventDefault()}},Yk=class yu{constructor(t,i,r,s,n,o,a){this._forceIntegerValues=t,this._scrollStateBrand=void 0,this._forceIntegerValues&&(i=i|0,r=r|0,s=s|0,n=n|0,o=o|0,a=a|0),this.rawScrollLeft=s,this.rawScrollTop=a,i<0&&(i=0),s+i>r&&(s=r-i),s<0&&(s=0),n<0&&(n=0),a+n>o&&(a=o-n),a<0&&(a=0),this.width=i,this.scrollWidth=r,this.scrollLeft=s,this.height=n,this.scrollHeight=o,this.scrollTop=a}equals(t){return this.rawScrollLeft===t.rawScrollLeft&&this.rawScrollTop===t.rawScrollTop&&this.width===t.width&&this.scrollWidth===t.scrollWidth&&this.scrollLeft===t.scrollLeft&&this.height===t.height&&this.scrollHeight===t.scrollHeight&&this.scrollTop===t.scrollTop}withScrollDimensions(t,i){return new yu(this._forceIntegerValues,typeof t.width<"u"?t.width:this.width,typeof t.scrollWidth<"u"?t.scrollWidth:this.scrollWidth,i?this.rawScrollLeft:this.scrollLeft,typeof t.height<"u"?t.height:this.height,typeof t.scrollHeight<"u"?t.scrollHeight:this.scrollHeight,i?this.rawScrollTop:this.scrollTop)}withScrollPosition(t){return new yu(this._forceIntegerValues,this.width,this.scrollWidth,typeof t.scrollLeft<"u"?t.scrollLeft:this.rawScrollLeft,this.height,this.scrollHeight,typeof t.scrollTop<"u"?t.scrollTop:this.rawScrollTop)}createScrollEvent(t,i){let r=this.width!==t.width,s=this.scrollWidth!==t.scrollWidth,n=this.scrollLeft!==t.scrollLeft,o=this.height!==t.height,a=this.scrollHeight!==t.scrollHeight,h=this.scrollTop!==t.scrollTop;return{inSmoothScrolling:i,oldWidth:t.width,oldScrollWidth:t.scrollWidth,oldScrollLeft:t.scrollLeft,width:this.width,scrollWidth:this.scrollWidth,scrollLeft:this.scrollLeft,oldHeight:t.height,oldScrollHeight:t.scrollHeight,oldScrollTop:t.scrollTop,height:this.height,scrollHeight:this.scrollHeight,scrollTop:this.scrollTop,widthChanged:r,scrollWidthChanged:s,scrollLeftChanged:n,heightChanged:o,scrollHeightChanged:a,scrollTopChanged:h}}},Jk=class extends oe{constructor(e){super(),this._scrollableBrand=void 0,this._onScroll=this._register(new Y),this.onScroll=this._onScroll.event,this._smoothScrollDuration=e.smoothScrollDuration,this._scheduleAtNextAnimationFrame=e.scheduleAtNextAnimationFrame,this._state=new Yk(e.forceIntegerValues,0,0,0,0,0,0),this._smoothScrolling=null}dispose(){this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),super.dispose()}setSmoothScrollDuration(e){this._smoothScrollDuration=e}validateScrollPosition(e){return this._state.withScrollPosition(e)}getScrollDimensions(){return this._state}setScrollDimensions(e,t){let i=this._state.withScrollDimensions(e,t);this._setState(i,!!this._smoothScrolling),this._smoothScrolling?.acceptScrollDimensions(this._state)}getFutureScrollPosition(){return this._smoothScrolling?this._smoothScrolling.to:this._state}getCurrentScrollPosition(){return this._state}setScrollPositionNow(e){let t=this._state.withScrollPosition(e);this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),this._setState(t,!1)}setScrollPositionSmooth(e,t){if(this._smoothScrollDuration===0)return this.setScrollPositionNow(e);if(this._smoothScrolling){e={scrollLeft:typeof e.scrollLeft>"u"?this._smoothScrolling.to.scrollLeft:e.scrollLeft,scrollTop:typeof e.scrollTop>"u"?this._smoothScrolling.to.scrollTop:e.scrollTop};let i=this._state.withScrollPosition(e);if(this._smoothScrolling.to.scrollLeft===i.scrollLeft&&this._smoothScrolling.to.scrollTop===i.scrollTop)return;let r;t?r=new Bm(this._smoothScrolling.from,i,this._smoothScrolling.startTime,this._smoothScrolling.duration):r=this._smoothScrolling.combine(this._state,i,this._smoothScrollDuration),this._smoothScrolling.dispose(),this._smoothScrolling=r}else{let i=this._state.withScrollPosition(e);this._smoothScrolling=Bm.start(this._state,i,this._smoothScrollDuration)}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}hasPendingScrollAnimation(){return!!this._smoothScrolling}_performSmoothScrolling(){if(!this._smoothScrolling)return;let e=this._smoothScrolling.tick(),t=this._state.withScrollPosition(e);if(this._setState(t,!0),!!this._smoothScrolling){if(e.isDone){this._smoothScrolling.dispose(),this._smoothScrolling=null;return}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}}_setState(e,t){let i=this._state;i.equals(e)||(this._state=e,this._onScroll.fire(this._state.createScrollEvent(i,t)))}},Em=class{constructor(e,t,i){this.scrollLeft=e,this.scrollTop=t,this.isDone=i}};function jc(e,t){let i=t-e;return function(r){return e+i*tE(r)}}function Zk(e,t,i){return function(r){return r<i?e(r/i):t((r-i)/(1-i))}}var Bm=class bu{constructor(t,i,r,s){this.from=t,this.to=i,this.duration=s,this.startTime=r,this.animationFrameDisposable=null,this._initAnimations()}_initAnimations(){this.scrollLeft=this._initAnimation(this.from.scrollLeft,this.to.scrollLeft,this.to.width),this.scrollTop=this._initAnimation(this.from.scrollTop,this.to.scrollTop,this.to.height)}_initAnimation(t,i,r){if(Math.abs(t-i)>2.5*r){let s,n;return t<i?(s=t+.75*r,n=i-.75*r):(s=t-.75*r,n=i+.75*r),Zk(jc(t,s),jc(n,i),.33)}return jc(t,i)}dispose(){this.animationFrameDisposable!==null&&(this.animationFrameDisposable.dispose(),this.animationFrameDisposable=null)}acceptScrollDimensions(t){this.to=t.withScrollPosition(this.to),this._initAnimations()}tick(){return this._tick(Date.now())}_tick(t){let i=(t-this.startTime)/this.duration;if(i<1){let r=this.scrollLeft(i),s=this.scrollTop(i);return new Em(r,s,!1)}return new Em(this.to.scrollLeft,this.to.scrollTop,!0)}combine(t,i,r){return bu.start(t,i,r)}static start(t,i,r){r=r+10;let s=Date.now()-10;return new bu(t,i,s,r)}};function eE(e){return Math.pow(e,3)}function tE(e){return 1-eE(1-e)}var iE=class extends oe{constructor(e,t,i){super(),this._visibility=e,this._visibleClassName=t,this._invisibleClassName=i,this._domNode=null,this._isVisible=!1,this._isNeeded=!1,this._rawShouldBeVisible=!1,this._shouldBeVisible=!1,this._revealTimer=this._register(new $u)}setVisibility(e){this._visibility!==e&&(this._visibility=e,this._updateShouldBeVisible())}setShouldBeVisible(e){this._rawShouldBeVisible=e,this._updateShouldBeVisible()}_applyVisibilitySetting(){return this._visibility===2?!1:this._visibility===3?!0:this._rawShouldBeVisible}_updateShouldBeVisible(){let e=this._applyVisibilitySetting();this._shouldBeVisible!==e&&(this._shouldBeVisible=e,this.ensureVisibility())}setIsNeeded(e){this._isNeeded!==e&&(this._isNeeded=e,this.ensureVisibility())}setDomNode(e){this._domNode=e,this._domNode.setClassName(this._invisibleClassName),this.setShouldBeVisible(!1)}ensureVisibility(){if(!this._isNeeded){this._hide(!1);return}this._shouldBeVisible?this._reveal():this._hide(!0)}_reveal(){this._isVisible||(this._isVisible=!0,this._revealTimer.setIfNotSet(()=>{this._domNode?.setClassName(this._visibleClassName)},0))}_hide(e){this._revealTimer.cancel(),this._isVisible&&(this._isVisible=!1,this._domNode?.setClassName(this._invisibleClassName+(e?" fade":"")))}},rE=140,Hv=class extends ju{constructor(e){super(),this._lazyRender=e.lazyRender,this._host=e.host,this._scrollable=e.scrollable,this._scrollByPage=e.scrollByPage,this._scrollbarState=e.scrollbarState,this._visibilityController=this._register(new iE(e.visibility,"visible scrollbar "+e.extraScrollbarClassName,"invisible scrollbar "+e.extraScrollbarClassName)),this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._pointerMoveMonitor=this._register(new Qv),this._shouldRender=!0,this.domNode=Un(document.createElement("div")),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this._visibilityController.setDomNode(this.domNode),this.domNode.setPosition("absolute"),this._register(se(this.domNode.domNode,qe.POINTER_DOWN,t=>this._domNodePointerDown(t)))}_createArrow(e){let t=this._register(new Vk(e));this.domNode.domNode.appendChild(t.bgDomNode),this.domNode.domNode.appendChild(t.domNode)}_createSlider(e,t,i,r){this.slider=Un(document.createElement("div")),this.slider.setClassName("slider"),this.slider.setPosition("absolute"),this.slider.setTop(e),this.slider.setLeft(t),typeof i=="number"&&this.slider.setWidth(i),typeof r=="number"&&this.slider.setHeight(r),this.slider.setLayerHinting(!0),this.slider.setContain("strict"),this.domNode.domNode.appendChild(this.slider.domNode),this._register(se(this.slider.domNode,qe.POINTER_DOWN,s=>{s.button===0&&(s.preventDefault(),this._sliderPointerDown(s))})),this.onclick(this.slider.domNode,s=>{s.leftButton&&s.stopPropagation()})}_onElementSize(e){return this._scrollbarState.setVisibleSize(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}_onElementScrollSize(e){return this._scrollbarState.setScrollSize(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}_onElementScrollPosition(e){return this._scrollbarState.setScrollPosition(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}beginReveal(){this._visibilityController.setShouldBeVisible(!0)}beginHide(){this._visibilityController.setShouldBeVisible(!1)}render(){this._shouldRender&&(this._shouldRender=!1,this._renderDomNode(this._scrollbarState.getRectangleLargeSize(),this._scrollbarState.getRectangleSmallSize()),this._updateSlider(this._scrollbarState.getSliderSize(),this._scrollbarState.getArrowSize()+this._scrollbarState.getSliderPosition()))}_domNodePointerDown(e){e.target===this.domNode.domNode&&this._onPointerDown(e)}delegatePointerDown(e){let t=this.domNode.domNode.getClientRects()[0].top,i=t+this._scrollbarState.getSliderPosition(),r=t+this._scrollbarState.getSliderPosition()+this._scrollbarState.getSliderSize(),s=this._sliderPointerPosition(e);i<=s&&s<=r?e.button===0&&(e.preventDefault(),this._sliderPointerDown(e)):this._onPointerDown(e)}_onPointerDown(e){let t,i;if(e.target===this.domNode.domNode&&typeof e.offsetX=="number"&&typeof e.offsetY=="number")t=e.offsetX,i=e.offsetY;else{let s=zk(this.domNode.domNode);t=e.pageX-s.left,i=e.pageY-s.top}let r=this._pointerDownRelativePosition(t,i);this._setDesiredScrollPositionNow(this._scrollByPage?this._scrollbarState.getDesiredScrollPositionFromOffsetPaged(r):this._scrollbarState.getDesiredScrollPositionFromOffset(r)),e.button===0&&(e.preventDefault(),this._sliderPointerDown(e))}_sliderPointerDown(e){if(!e.target||!(e.target instanceof Element))return;let t=this._sliderPointerPosition(e),i=this._sliderOrthogonalPointerPosition(e),r=this._scrollbarState.clone();this.slider.toggleClassName("active",!0),this._pointerMoveMonitor.startMonitoring(e.target,e.pointerId,e.buttons,s=>{let n=this._sliderOrthogonalPointerPosition(s),o=Math.abs(n-i);if(Tv&&o>rE){this._setDesiredScrollPositionNow(r.getScrollPosition());return}let a=this._sliderPointerPosition(s)-t;this._setDesiredScrollPositionNow(r.getDesiredScrollPositionFromDelta(a))},()=>{this.slider.toggleClassName("active",!1),this._host.onDragEnd()}),this._host.onDragStart()}_setDesiredScrollPositionNow(e){let t={};this.writeScrollPosition(t,e),this._scrollable.setScrollPositionNow(t)}updateScrollbarSize(e){this._updateScrollbarSize(e),this._scrollbarState.setScrollbarSize(e),this._shouldRender=!0,this._lazyRender||this.render()}isNeeded(){return this._scrollbarState.isNeeded()}},Xv=class wu{constructor(t,i,r,s,n,o){this._scrollbarSize=Math.round(i),this._oppositeScrollbarSize=Math.round(r),this._arrowSize=Math.round(t),this._visibleSize=s,this._scrollSize=n,this._scrollPosition=o,this._computedAvailableSize=0,this._computedIsNeeded=!1,this._computedSliderSize=0,this._computedSliderRatio=0,this._computedSliderPosition=0,this._refreshComputedValues()}clone(){return new wu(this._arrowSize,this._scrollbarSize,this._oppositeScrollbarSize,this._visibleSize,this._scrollSize,this._scrollPosition)}setVisibleSize(t){let i=Math.round(t);return this._visibleSize!==i?(this._visibleSize=i,this._refreshComputedValues(),!0):!1}setScrollSize(t){let i=Math.round(t);return this._scrollSize!==i?(this._scrollSize=i,this._refreshComputedValues(),!0):!1}setScrollPosition(t){let i=Math.round(t);return this._scrollPosition!==i?(this._scrollPosition=i,this._refreshComputedValues(),!0):!1}setScrollbarSize(t){this._scrollbarSize=Math.round(t)}setOppositeScrollbarSize(t){this._oppositeScrollbarSize=Math.round(t)}static _computeValues(t,i,r,s,n){let o=Math.max(0,r-t),a=Math.max(0,o-2*i),h=s>0&&s>r;if(!h)return{computedAvailableSize:Math.round(o),computedIsNeeded:h,computedSliderSize:Math.round(a),computedSliderRatio:0,computedSliderPosition:0};let l=Math.round(Math.max(20,Math.floor(r*a/s))),c=(a-l)/(s-r),u=n*c;return{computedAvailableSize:Math.round(o),computedIsNeeded:h,computedSliderSize:Math.round(l),computedSliderRatio:c,computedSliderPosition:Math.round(u)}}_refreshComputedValues(){let t=wu._computeValues(this._oppositeScrollbarSize,this._arrowSize,this._visibleSize,this._scrollSize,this._scrollPosition);this._computedAvailableSize=t.computedAvailableSize,this._computedIsNeeded=t.computedIsNeeded,this._computedSliderSize=t.computedSliderSize,this._computedSliderRatio=t.computedSliderRatio,this._computedSliderPosition=t.computedSliderPosition}getArrowSize(){return this._arrowSize}getScrollPosition(){return this._scrollPosition}getRectangleLargeSize(){return this._computedAvailableSize}getRectangleSmallSize(){return this._scrollbarSize}isNeeded(){return this._computedIsNeeded}getSliderSize(){return this._computedSliderSize}getSliderPosition(){return this._computedSliderPosition}getDesiredScrollPositionFromOffset(t){if(!this._computedIsNeeded)return 0;let i=t-this._arrowSize-this._computedSliderSize/2;return Math.round(i/this._computedSliderRatio)}getDesiredScrollPositionFromOffsetPaged(t){if(!this._computedIsNeeded)return 0;let i=t-this._arrowSize,r=this._scrollPosition;return i<this._computedSliderPosition?r-=this._visibleSize:r+=this._visibleSize,r}getDesiredScrollPositionFromDelta(t){if(!this._computedIsNeeded)return 0;let i=this._computedSliderPosition+t;return Math.round(i/this._computedSliderRatio)}},sE=class extends Hv{constructor(e,t,i){let r=e.getScrollDimensions(),s=e.getCurrentScrollPosition();if(super({lazyRender:t.lazyRender,host:i,scrollbarState:new Xv(t.horizontalHasArrows?t.arrowSize:0,t.horizontal===2?0:t.horizontalScrollbarSize,t.vertical===2?0:t.verticalScrollbarSize,r.width,r.scrollWidth,s.scrollLeft),visibility:t.horizontal,extraScrollbarClassName:"horizontal",scrollable:e,scrollByPage:t.scrollByPage}),t.horizontalHasArrows)throw new Error("horizontalHasArrows is not supported in xterm.js");this._createSlider(Math.floor((t.horizontalScrollbarSize-t.horizontalSliderSize)/2),0,void 0,t.horizontalSliderSize)}_updateSlider(e,t){this.slider.setWidth(e),this.slider.setLeft(t)}_renderDomNode(e,t){this.domNode.setWidth(e),this.domNode.setHeight(t),this.domNode.setLeft(0),this.domNode.setBottom(0)}onDidScroll(e){return this._shouldRender=this._onElementScrollSize(e.scrollWidth)||this._shouldRender,this._shouldRender=this._onElementScrollPosition(e.scrollLeft)||this._shouldRender,this._shouldRender=this._onElementSize(e.width)||this._shouldRender,this._shouldRender}_pointerDownRelativePosition(e,t){return e}_sliderPointerPosition(e){return e.pageX}_sliderOrthogonalPointerPosition(e){return e.pageY}_updateScrollbarSize(e){this.slider.setHeight(e)}writeScrollPosition(e,t){e.scrollLeft=t}updateOptions(e){this.updateScrollbarSize(e.horizontal===2?0:e.horizontalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(e.vertical===2?0:e.verticalScrollbarSize),this._visibilityController.setVisibility(e.horizontal),this._scrollByPage=e.scrollByPage}},nE=class extends Hv{constructor(e,t,i){let r=e.getScrollDimensions(),s=e.getCurrentScrollPosition();if(super({lazyRender:t.lazyRender,host:i,scrollbarState:new Xv(t.verticalHasArrows?t.arrowSize:0,t.vertical===2?0:t.verticalScrollbarSize,0,r.height,r.scrollHeight,s.scrollTop),visibility:t.vertical,extraScrollbarClassName:"vertical",scrollable:e,scrollByPage:t.scrollByPage}),t.verticalHasArrows)throw new Error("horizontalHasArrows is not supported in xterm.js");this._createSlider(0,Math.floor((t.verticalScrollbarSize-t.verticalSliderSize)/2),t.verticalSliderSize,void 0)}_updateSlider(e,t){this.slider.setHeight(e),this.slider.setTop(t)}_renderDomNode(e,t){this.domNode.setWidth(t),this.domNode.setHeight(e),this.domNode.setRight(0),this.domNode.setTop(0)}onDidScroll(e){return this._shouldRender=this._onElementScrollSize(e.scrollHeight)||this._shouldRender,this._shouldRender=this._onElementScrollPosition(e.scrollTop)||this._shouldRender,this._shouldRender=this._onElementSize(e.height)||this._shouldRender,this._shouldRender}_pointerDownRelativePosition(e,t){return t}_sliderPointerPosition(e){return e.pageY}_sliderOrthogonalPointerPosition(e){return e.pageX}_updateScrollbarSize(e){this.slider.setWidth(e)}writeScrollPosition(e,t){e.scrollTop=t}updateOptions(e){this.updateScrollbarSize(e.vertical===2?0:e.verticalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(0),this._visibilityController.setVisibility(e.vertical),this._scrollByPage=e.scrollByPage}},oE=500,Lm=50,Dm=!0,aE=class{constructor(e,t,i){this.timestamp=e,this.deltaX=t,this.deltaY=i,this.score=0}},Au=class{constructor(){this._capacity=5,this._memory=[],this._front=-1,this._rear=-1}isPhysicalMouseWheel(){if(this._front===-1&&this._rear===-1)return!1;let t=1,i=0,r=1,s=this._rear;do{let n=s===this._front?t:Math.pow(2,-r);if(t-=n,i+=this._memory[s].score*n,s===this._front)break;s=(this._capacity+s-1)%this._capacity,r++}while(!0);return i<=.5}acceptStandardWheelEvent(t){if(zu){let i=ti(t.browserEvent),r=ek(i);this.accept(Date.now(),t.deltaX*r,t.deltaY*r)}else this.accept(Date.now(),t.deltaX,t.deltaY)}accept(t,i,r){let s=null,n=new aE(t,i,r);this._front===-1&&this._rear===-1?(this._memory[0]=n,this._front=0,this._rear=0):(s=this._memory[this._rear],this._rear=(this._rear+1)%this._capacity,this._rear===this._front&&(this._front=(this._front+1)%this._capacity),this._memory[this._rear]=n),n.score=this._computeScore(n,s)}_computeScore(t,i){if(Math.abs(t.deltaX)>0&&Math.abs(t.deltaY)>0)return 1;let r=.5;if((!this._isAlmostInt(t.deltaX)||!this._isAlmostInt(t.deltaY))&&(r+=.25),i){let s=Math.abs(t.deltaX),n=Math.abs(t.deltaY),o=Math.abs(i.deltaX),a=Math.abs(i.deltaY),h=Math.max(Math.min(s,o),1),l=Math.max(Math.min(n,a),1),c=Math.max(s,o),u=Math.max(n,a);c%h===0&&u%l===0&&(r-=.5)}return Math.min(Math.max(r,0),1)}_isAlmostInt(t){return Math.abs(Math.round(t)-t)<.01}};Au.INSTANCE=new Au;var lE=Au,hE=class extends ju{constructor(e,t,i){super(),this._onScroll=this._register(new Y),this.onScroll=this._onScroll.event,this._onWillScroll=this._register(new Y),this.onWillScroll=this._onWillScroll.event,this._options=uE(t),this._scrollable=i,this._register(this._scrollable.onScroll(s=>{this._onWillScroll.fire(s),this._onDidScroll(s),this._onScroll.fire(s)}));let r={onMouseWheel:s=>this._onMouseWheel(s),onDragStart:()=>this._onDragStart(),onDragEnd:()=>this._onDragEnd()};this._verticalScrollbar=this._register(new nE(this._scrollable,this._options,r)),this._horizontalScrollbar=this._register(new sE(this._scrollable,this._options,r)),this._domNode=document.createElement("div"),this._domNode.className="xterm-scrollable-element "+this._options.className,this._domNode.setAttribute("role","presentation"),this._domNode.style.position="relative",this._domNode.appendChild(e),this._domNode.appendChild(this._horizontalScrollbar.domNode.domNode),this._domNode.appendChild(this._verticalScrollbar.domNode.domNode),this._options.useShadows?(this._leftShadowDomNode=Un(document.createElement("div")),this._leftShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._leftShadowDomNode.domNode),this._topShadowDomNode=Un(document.createElement("div")),this._topShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._topShadowDomNode.domNode),this._topLeftShadowDomNode=Un(document.createElement("div")),this._topLeftShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._topLeftShadowDomNode.domNode)):(this._leftShadowDomNode=null,this._topShadowDomNode=null,this._topLeftShadowDomNode=null),this._listenOnDomNode=this._options.listenOnDomNode||this._domNode,this._mouseWheelToDispose=[],this._setListeningToMouseWheel(this._options.handleMouseWheel),this.onmouseover(this._listenOnDomNode,s=>this._onMouseOver(s)),this.onmouseleave(this._listenOnDomNode,s=>this._onMouseLeave(s)),this._hideTimeout=this._register(new $u),this._isDragging=!1,this._mouseIsOver=!1,this._shouldRender=!0,this._revealOnScroll=!0}get options(){return this._options}dispose(){this._mouseWheelToDispose=jr(this._mouseWheelToDispose),super.dispose()}getDomNode(){return this._domNode}getOverviewRulerLayoutInfo(){return{parent:this._domNode,insertBefore:this._verticalScrollbar.domNode.domNode}}delegateVerticalScrollbarPointerDown(e){this._verticalScrollbar.delegatePointerDown(e)}getScrollDimensions(){return this._scrollable.getScrollDimensions()}setScrollDimensions(e){this._scrollable.setScrollDimensions(e,!1)}updateClassName(e){this._options.className=e,gi&&(this._options.className+=" mac"),this._domNode.className="xterm-scrollable-element "+this._options.className}updateOptions(e){typeof e.handleMouseWheel<"u"&&(this._options.handleMouseWheel=e.handleMouseWheel,this._setListeningToMouseWheel(this._options.handleMouseWheel)),typeof e.mouseWheelScrollSensitivity<"u"&&(this._options.mouseWheelScrollSensitivity=e.mouseWheelScrollSensitivity),typeof e.fastScrollSensitivity<"u"&&(this._options.fastScrollSensitivity=e.fastScrollSensitivity),typeof e.scrollPredominantAxis<"u"&&(this._options.scrollPredominantAxis=e.scrollPredominantAxis),typeof e.horizontal<"u"&&(this._options.horizontal=e.horizontal),typeof e.vertical<"u"&&(this._options.vertical=e.vertical),typeof e.horizontalScrollbarSize<"u"&&(this._options.horizontalScrollbarSize=e.horizontalScrollbarSize),typeof e.verticalScrollbarSize<"u"&&(this._options.verticalScrollbarSize=e.verticalScrollbarSize),typeof e.scrollByPage<"u"&&(this._options.scrollByPage=e.scrollByPage),this._horizontalScrollbar.updateOptions(this._options),this._verticalScrollbar.updateOptions(this._options),this._options.lazyRender||this._render()}setRevealOnScroll(e){this._revealOnScroll=e}delegateScrollFromMouseWheelEvent(e){this._onMouseWheel(new ym(e))}_setListeningToMouseWheel(e){if(this._mouseWheelToDispose.length>0!==e&&(this._mouseWheelToDispose=jr(this._mouseWheelToDispose),e)){let t=i=>{this._onMouseWheel(new ym(i))};this._mouseWheelToDispose.push(se(this._listenOnDomNode,qe.MOUSE_WHEEL,t,{passive:!1}))}}_onMouseWheel(e){if(e.browserEvent?.defaultPrevented)return;let t=lE.INSTANCE;Dm&&t.acceptStandardWheelEvent(e);let i=!1;if(e.deltaY||e.deltaX){let s=e.deltaY*this._options.mouseWheelScrollSensitivity,n=e.deltaX*this._options.mouseWheelScrollSensitivity;this._options.scrollPredominantAxis&&(this._options.scrollYToX&&n+s===0?n=s=0:Math.abs(s)>=Math.abs(n)?n=0:s=0),this._options.flipAxes&&([s,n]=[n,s]);let o=!gi&&e.browserEvent&&e.browserEvent.shiftKey;(this._options.scrollYToX||o)&&!n&&(n=s,s=0),e.browserEvent&&e.browserEvent.altKey&&(n=n*this._options.fastScrollSensitivity,s=s*this._options.fastScrollSensitivity);let a=this._scrollable.getFutureScrollPosition(),h={};if(s){let l=Lm*s,c=a.scrollTop-(l<0?Math.floor(l):Math.ceil(l));this._verticalScrollbar.writeScrollPosition(h,c)}if(n){let l=Lm*n,c=a.scrollLeft-(l<0?Math.floor(l):Math.ceil(l));this._horizontalScrollbar.writeScrollPosition(h,c)}h=this._scrollable.validateScrollPosition(h),(a.scrollLeft!==h.scrollLeft||a.scrollTop!==h.scrollTop)&&(Dm&&this._options.mouseWheelSmoothScroll&&t.isPhysicalMouseWheel()?this._scrollable.setScrollPositionSmooth(h):this._scrollable.setScrollPositionNow(h),i=!0)}let r=i;!r&&this._options.alwaysConsumeMouseWheel&&(r=!0),!r&&this._options.consumeMouseWheelIfScrollbarIsNeeded&&(this._verticalScrollbar.isNeeded()||this._horizontalScrollbar.isNeeded())&&(r=!0),r&&(e.preventDefault(),e.stopPropagation())}_onDidScroll(e){this._shouldRender=this._horizontalScrollbar.onDidScroll(e)||this._shouldRender,this._shouldRender=this._verticalScrollbar.onDidScroll(e)||this._shouldRender,this._options.useShadows&&(this._shouldRender=!0),this._revealOnScroll&&this._reveal(),this._options.lazyRender||this._render()}renderNow(){if(!this._options.lazyRender)throw new Error("Please use `lazyRender` together with `renderNow`!");this._render()}_render(){if(this._shouldRender&&(this._shouldRender=!1,this._horizontalScrollbar.render(),this._verticalScrollbar.render(),this._options.useShadows)){let e=this._scrollable.getCurrentScrollPosition(),t=e.scrollTop>0,i=e.scrollLeft>0,r=i?" left":"",s=t?" top":"",n=i||t?" top-left-corner":"";this._leftShadowDomNode.setClassName(`shadow${r}`),this._topShadowDomNode.setClassName(`shadow${s}`),this._topLeftShadowDomNode.setClassName(`shadow${n}${s}${r}`)}}_onDragStart(){this._isDragging=!0,this._reveal()}_onDragEnd(){this._isDragging=!1,this._hide()}_onMouseLeave(e){this._mouseIsOver=!1,this._hide()}_onMouseOver(e){this._mouseIsOver=!0,this._reveal()}_reveal(){this._verticalScrollbar.beginReveal(),this._horizontalScrollbar.beginReveal(),this._scheduleHide()}_hide(){!this._mouseIsOver&&!this._isDragging&&(this._verticalScrollbar.beginHide(),this._horizontalScrollbar.beginHide())}_scheduleHide(){!this._mouseIsOver&&!this._isDragging&&this._hideTimeout.cancelAndSet(()=>this._hide(),oE)}},cE=class extends hE{constructor(e,t,i){super(e,t,i)}setScrollPosition(e){e.reuseAnimation?this._scrollable.setScrollPositionSmooth(e,e.reuseAnimation):this._scrollable.setScrollPositionNow(e)}getScrollPosition(){return this._scrollable.getCurrentScrollPosition()}};function uE(e){let t={lazyRender:typeof e.lazyRender<"u"?e.lazyRender:!1,className:typeof e.className<"u"?e.className:"",useShadows:typeof e.useShadows<"u"?e.useShadows:!0,handleMouseWheel:typeof e.handleMouseWheel<"u"?e.handleMouseWheel:!0,flipAxes:typeof e.flipAxes<"u"?e.flipAxes:!1,consumeMouseWheelIfScrollbarIsNeeded:typeof e.consumeMouseWheelIfScrollbarIsNeeded<"u"?e.consumeMouseWheelIfScrollbarIsNeeded:!1,alwaysConsumeMouseWheel:typeof e.alwaysConsumeMouseWheel<"u"?e.alwaysConsumeMouseWheel:!1,scrollYToX:typeof e.scrollYToX<"u"?e.scrollYToX:!1,mouseWheelScrollSensitivity:typeof e.mouseWheelScrollSensitivity<"u"?e.mouseWheelScrollSensitivity:1,fastScrollSensitivity:typeof e.fastScrollSensitivity<"u"?e.fastScrollSensitivity:5,scrollPredominantAxis:typeof e.scrollPredominantAxis<"u"?e.scrollPredominantAxis:!0,mouseWheelSmoothScroll:typeof e.mouseWheelSmoothScroll<"u"?e.mouseWheelSmoothScroll:!0,arrowSize:typeof e.arrowSize<"u"?e.arrowSize:11,listenOnDomNode:typeof e.listenOnDomNode<"u"?e.listenOnDomNode:null,horizontal:typeof e.horizontal<"u"?e.horizontal:1,horizontalScrollbarSize:typeof e.horizontalScrollbarSize<"u"?e.horizontalScrollbarSize:10,horizontalSliderSize:typeof e.horizontalSliderSize<"u"?e.horizontalSliderSize:0,horizontalHasArrows:typeof e.horizontalHasArrows<"u"?e.horizontalHasArrows:!1,vertical:typeof e.vertical<"u"?e.vertical:1,verticalScrollbarSize:typeof e.verticalScrollbarSize<"u"?e.verticalScrollbarSize:10,verticalHasArrows:typeof e.verticalHasArrows<"u"?e.verticalHasArrows:!1,verticalSliderSize:typeof e.verticalSliderSize<"u"?e.verticalSliderSize:0,scrollByPage:typeof e.scrollByPage<"u"?e.scrollByPage:!1};return t.horizontalSliderSize=typeof e.horizontalSliderSize<"u"?e.horizontalSliderSize:t.horizontalScrollbarSize,t.verticalSliderSize=typeof e.verticalSliderSize<"u"?e.verticalSliderSize:t.verticalScrollbarSize,gi&&(t.className+=" mac"),t}var xu=class extends oe{constructor(e,t,i,r,s,n,o,a){super(),this._bufferService=i,this._optionsService=o,this._renderService=a,this._onRequestScrollLines=this._register(new Y),this.onRequestScrollLines=this._onRequestScrollLines.event,this._isSyncing=!1,this._isHandlingScroll=!1,this._suppressOnScrollHandler=!1;let h=this._register(new Jk({forceIntegerValues:!1,smoothScrollDuration:this._optionsService.rawOptions.smoothScrollDuration,scheduleAtNextAnimationFrame:l=>Ya(r.window,l)}));this._register(this._optionsService.onSpecificOptionChange("smoothScrollDuration",()=>{h.setSmoothScrollDuration(this._optionsService.rawOptions.smoothScrollDuration)})),this._scrollableElement=this._register(new cE(t,{vertical:1,horizontal:2,useShadows:!1,mouseWheelSmoothScroll:!0,...this._getChangeOptions()},h)),this._register(this._optionsService.onMultipleOptionChange(["scrollSensitivity","fastScrollSensitivity","overviewRuler"],()=>this._scrollableElement.updateOptions(this._getChangeOptions()))),this._register(s.onProtocolChange(l=>{this._scrollableElement.updateOptions({handleMouseWheel:!(l&16)})})),this._scrollableElement.setScrollDimensions({height:0,scrollHeight:0}),this._register(ot.runAndSubscribe(n.onChangeColors,()=>{this._scrollableElement.getDomNode().style.backgroundColor=n.colors.background.css})),e.appendChild(this._scrollableElement.getDomNode()),this._register(Ae(()=>this._scrollableElement.getDomNode().remove())),this._styleElement=r.mainDocument.createElement("style"),t.appendChild(this._styleElement),this._register(Ae(()=>this._styleElement.remove())),this._register(ot.runAndSubscribe(n.onChangeColors,()=>{this._styleElement.textContent=[".xterm .xterm-scrollable-element > .scrollbar > .slider {",`  background: ${n.colors.scrollbarSliderBackground.css};`,"}",".xterm .xterm-scrollable-element > .scrollbar > .slider:hover {",`  background: ${n.colors.scrollbarSliderHoverBackground.css};`,"}",".xterm .xterm-scrollable-element > .scrollbar > .slider.active {",`  background: ${n.colors.scrollbarSliderActiveBackground.css};`,"}"].join(`
`)})),this._register(this._bufferService.onResize(()=>this.queueSync())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._latestYDisp=void 0,this.queueSync()})),this._register(this._bufferService.onScroll(()=>this._sync())),this._register(this._scrollableElement.onScroll(l=>this._handleScroll(l)))}scrollLines(e){let t=this._scrollableElement.getScrollPosition();this._scrollableElement.setScrollPosition({reuseAnimation:!0,scrollTop:t.scrollTop+e*this._renderService.dimensions.css.cell.height})}scrollToLine(e,t){t&&(this._latestYDisp=e),this._scrollableElement.setScrollPosition({reuseAnimation:!t,scrollTop:e*this._renderService.dimensions.css.cell.height})}_getChangeOptions(){return{mouseWheelScrollSensitivity:this._optionsService.rawOptions.scrollSensitivity,fastScrollSensitivity:this._optionsService.rawOptions.fastScrollSensitivity,verticalScrollbarSize:this._optionsService.rawOptions.overviewRuler?.width||14}}queueSync(e){e!==void 0&&(this._latestYDisp=e),this._queuedAnimationFrame===void 0&&(this._queuedAnimationFrame=this._renderService.addRefreshCallback(()=>{this._queuedAnimationFrame=void 0,this._sync(this._latestYDisp)}))}_sync(e=this._bufferService.buffer.ydisp){!this._renderService||this._isSyncing||(this._isSyncing=!0,this._suppressOnScrollHandler=!0,this._scrollableElement.setScrollDimensions({height:this._renderService.dimensions.css.canvas.height,scrollHeight:this._renderService.dimensions.css.cell.height*this._bufferService.buffer.lines.length}),this._suppressOnScrollHandler=!1,e!==this._latestYDisp&&this._scrollableElement.setScrollPosition({scrollTop:e*this._renderService.dimensions.css.cell.height}),this._isSyncing=!1)}_handleScroll(e){if(!this._renderService||this._isHandlingScroll||this._suppressOnScrollHandler)return;this._isHandlingScroll=!0;let t=Math.round(e.scrollTop/this._renderService.dimensions.css.cell.height),i=t-this._bufferService.buffer.ydisp;i!==0&&(this._latestYDisp=t,this._onRequestScrollLines.fire(i)),this._isHandlingScroll=!1}};xu=Me([Z(2,vt),Z(3,Pi),Z(4,fv),Z(5,Cs),Z(6,yt),Z(7,Oi)],xu);var Su=class extends oe{constructor(e,t,i,r,s){super(),this._screenElement=e,this._bufferService=t,this._coreBrowserService=i,this._decorationService=r,this._renderService=s,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this._register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this._register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this._register(this._coreBrowserService.onDprChange(()=>this._queueRefresh())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this._register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this._register(this._decorationService.onDecorationRemoved(n=>this._removeDecoration(n))),this._register(Ae(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(let e of this._decorationService.decorations)this._renderDecoration(e);this._dimensionsChanged=!1}_renderDecoration(e){this._refreshStyle(e),this._dimensionsChanged&&this._refreshXPosition(e)}_createElement(e){let t=this._coreBrowserService.mainDocument.createElement("div");t.classList.add("xterm-decoration"),t.classList.toggle("xterm-decoration-top-layer",e?.options?.layer==="top"),t.style.width=`${Math.round((e.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,t.style.height=`${(e.options.height||1)*this._renderService.dimensions.css.cell.height}px`,t.style.top=`${(e.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height}px`,t.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;let i=e.options.x??0;return i&&i>this._bufferService.cols&&(t.style.display="none"),this._refreshXPosition(e,t),t}_refreshStyle(e){let t=e.marker.line-this._bufferService.buffers.active.ydisp;if(t<0||t>=this._bufferService.rows)e.element&&(e.element.style.display="none",e.onRenderEmitter.fire(e.element));else{let i=this._decorationElements.get(e);i||(i=this._createElement(e),e.element=i,this._decorationElements.set(e,i),this._container.appendChild(i),e.onDispose(()=>{this._decorationElements.delete(e),i.remove()})),i.style.display=this._altBufferIsActive?"none":"block",this._altBufferIsActive||(i.style.width=`${Math.round((e.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,i.style.height=`${(e.options.height||1)*this._renderService.dimensions.css.cell.height}px`,i.style.top=`${t*this._renderService.dimensions.css.cell.height}px`,i.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`),e.onRenderEmitter.fire(i)}}_refreshXPosition(e,t=e.element){if(!t)return;let i=e.options.x??0;(e.options.anchor||"left")==="right"?t.style.right=i?`${i*this._renderService.dimensions.css.cell.width}px`:"":t.style.left=i?`${i*this._renderService.dimensions.css.cell.width}px`:""}_removeDecoration(e){this._decorationElements.get(e)?.remove(),this._decorationElements.delete(e),e.dispose()}};Su=Me([Z(1,vt),Z(2,Pi),Z(3,qn),Z(4,Oi)],Su);var dE=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(e){if(e.options.overviewRulerOptions){for(let t of this._zones)if(t.color===e.options.overviewRulerOptions.color&&t.position===e.options.overviewRulerOptions.position){if(this._lineIntersectsZone(t,e.marker.line))return;if(this._lineAdjacentToZone(t,e.marker.line,e.options.overviewRulerOptions.position)){this._addLineToZone(t,e.marker.line);return}}if(this._zonePoolIndex<this._zonePool.length){this._zonePool[this._zonePoolIndex].color=e.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=e.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=e.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=e.marker.line,this._zones.push(this._zonePool[this._zonePoolIndex++]);return}this._zones.push({color:e.options.overviewRulerOptions.color,position:e.options.overviewRulerOptions.position,startBufferLine:e.marker.line,endBufferLine:e.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(e){this._linePadding=e}_lineIntersectsZone(e,t){return t>=e.startBufferLine&&t<=e.endBufferLine}_lineAdjacentToZone(e,t,i){return t>=e.startBufferLine-this._linePadding[i||"full"]&&t<=e.endBufferLine+this._linePadding[i||"full"]}_addLineToZone(e,t){e.startBufferLine=Math.min(e.startBufferLine,t),e.endBufferLine=Math.max(e.endBufferLine,t)}},fi={full:0,left:0,center:0,right:0},gr={full:0,left:0,center:0,right:0},Dn={full:0,left:0,center:0,right:0},Ja=class extends oe{constructor(e,t,i,r,s,n,o,a){super(),this._viewportElement=e,this._screenElement=t,this._bufferService=i,this._decorationService=r,this._renderService=s,this._optionsService=n,this._themeService=o,this._coreBrowserService=a,this._colorZoneStore=new dE,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),this._viewportElement.parentElement?.insertBefore(this._canvas,this._viewportElement),this._register(Ae(()=>this._canvas?.remove()));let h=this._canvas.getContext("2d");if(h)this._ctx=h;else throw new Error("Ctx cannot be null");this._register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this._register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0))),this._register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this._register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())})),this._register(this._renderService.onRender(()=>{(!this._containerHeight||this._containerHeight!==this._screenElement.clientHeight)&&(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this._register(this._coreBrowserService.onDprChange(()=>this._queueRefresh(!0))),this._register(this._optionsService.onSpecificOptionChange("overviewRuler",()=>this._queueRefresh(!0))),this._register(this._themeService.onChangeColors(()=>this._queueRefresh())),this._queueRefresh(!0)}get _width(){return this._optionsService.options.overviewRuler?.width||0}_refreshDrawConstants(){let e=Math.floor((this._canvas.width-1)/3),t=Math.ceil((this._canvas.width-1)/3);gr.full=this._canvas.width,gr.left=e,gr.center=t,gr.right=e,this._refreshDrawHeightConstants(),Dn.full=1,Dn.left=1,Dn.center=1+gr.left,Dn.right=1+gr.left+gr.center}_refreshDrawHeightConstants(){fi.full=Math.round(2*this._coreBrowserService.dpr);let e=this._canvas.height/this._bufferService.buffer.lines.length,t=Math.round(Math.max(Math.min(e,12),6)*this._coreBrowserService.dpr);fi.left=t,fi.center=t,fi.right=t}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*fi.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*fi.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*fi.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*fi.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(let t of this._decorationService.decorations)this._colorZoneStore.addDecoration(t);this._ctx.lineWidth=1,this._renderRulerOutline();let e=this._colorZoneStore.zones;for(let t of e)t.position!=="full"&&this._renderColorZone(t);for(let t of e)t.position==="full"&&this._renderColorZone(t);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderRulerOutline(){this._ctx.fillStyle=this._themeService.colors.overviewRulerBorder.css,this._ctx.fillRect(0,0,1,this._canvas.height),this._optionsService.rawOptions.overviewRuler.showTopBorder&&this._ctx.fillRect(1,0,this._canvas.width-1,1),this._optionsService.rawOptions.overviewRuler.showBottomBorder&&this._ctx.fillRect(1,this._canvas.height-1,this._canvas.width-1,this._canvas.height)}_renderColorZone(e){this._ctx.fillStyle=e.color,this._ctx.fillRect(Dn[e.position||"full"],Math.round((this._canvas.height-1)*(e.startBufferLine/this._bufferService.buffers.active.lines.length)-fi[e.position||"full"]/2),gr[e.position||"full"],Math.round((this._canvas.height-1)*((e.endBufferLine-e.startBufferLine)/this._bufferService.buffers.active.lines.length)+fi[e.position||"full"]))}_queueRefresh(e,t){this._shouldUpdateDimensions=e||this._shouldUpdateDimensions,this._shouldUpdateAnchor=t||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};Ja=Me([Z(2,vt),Z(3,qn),Z(4,Oi),Z(5,yt),Z(6,Cs),Z(7,Pi)],Ja);var j;(e=>(e.NUL="\0",e.SOH="",e.STX="",e.ETX="",e.EOT="",e.ENQ="",e.ACK="",e.BEL="\x07",e.BS="\b",e.HT="	",e.LF=`
`,e.VT="\v",e.FF="\f",e.CR="\r",e.SO="",e.SI="",e.DLE="",e.DC1="",e.DC2="",e.DC3="",e.DC4="",e.NAK="",e.SYN="",e.ETB="",e.CAN="",e.EM="",e.SUB="",e.ESC="\x1B",e.FS="",e.GS="",e.RS="",e.US="",e.SP=" ",e.DEL="\x7F"))(j||={});var Wa;(e=>(e.PAD="\x80",e.HOP="\x81",e.BPH="\x82",e.NBH="\x83",e.IND="\x84",e.NEL="\x85",e.SSA="\x86",e.ESA="\x87",e.HTS="\x88",e.HTJ="\x89",e.VTS="\x8A",e.PLD="\x8B",e.PLU="\x8C",e.RI="\x8D",e.SS2="\x8E",e.SS3="\x8F",e.DCS="\x90",e.PU1="\x91",e.PU2="\x92",e.STS="\x93",e.CCH="\x94",e.MW="\x95",e.SPA="\x96",e.EPA="\x97",e.SOS="\x98",e.SGCI="\x99",e.SCI="\x9A",e.CSI="\x9B",e.ST="\x9C",e.OSC="\x9D",e.PM="\x9E",e.APC="\x9F"))(Wa||={});var Uv;(e=>e.ST=`${j.ESC}\\`)(Uv||={});var Cu=class{constructor(e,t,i,r,s,n){this._textarea=e,this._compositionView=t,this._bufferService=i,this._optionsService=r,this._coreService=s,this._renderService=n,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}get isComposing(){return this._isComposing}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(e){this._compositionView.textContent=e.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown(e){if(this._isComposing||this._isSendingComposition){if(e.keyCode===20||e.keyCode===229||e.keyCode===16||e.keyCode===17||e.keyCode===18)return!1;this._finalizeComposition(!1)}return e.keyCode===229?(this._handleAnyTextareaChanges(),!1):!0}_finalizeComposition(e){if(this._compositionView.classList.remove("active"),this._isComposing=!1,e){let t={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){this._isSendingComposition=!1;let i;t.start+=this._dataAlreadySent.length,this._isComposing?i=this._textarea.value.substring(t.start,this._compositionPosition.start):i=this._textarea.value.substring(t.start),i.length>0&&this._coreService.triggerDataEvent(i,!0)}},0)}else{this._isSendingComposition=!1;let t=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(t,!0)}}_handleAnyTextareaChanges(){let e=this._textarea.value;setTimeout(()=>{if(!this._isComposing){let t=this._textarea.value,i=t.replace(e,"");this._dataAlreadySent=i,t.length>e.length?this._coreService.triggerDataEvent(i,!0):t.length<e.length?this._coreService.triggerDataEvent(`${j.DEL}`,!0):t.length===e.length&&t!==e&&this._coreService.triggerDataEvent(t,!0)}},0)}updateCompositionElements(e){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){let t=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),i=this._renderService.dimensions.css.cell.height,r=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,s=t*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=s+"px",this._compositionView.style.top=r+"px",this._compositionView.style.height=i+"px",this._compositionView.style.lineHeight=i+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";let n=this._compositionView.getBoundingClientRect();this._textarea.style.left=s+"px",this._textarea.style.top=r+"px",this._textarea.style.width=Math.max(n.width,1)+"px",this._textarea.style.height=Math.max(n.height,1)+"px",this._textarea.style.lineHeight=n.height+"px"}e||setTimeout(()=>this.updateCompositionElements(!0),0)}}};Cu=Me([Z(2,vt),Z(3,yt),Z(4,Vr),Z(5,Oi)],Cu);var Ve=0,Ye=0,Je=0,Ie=0,Im={css:"#00000000",rgba:0},Qe;(e=>{function t(s,n,o,a){return a!==void 0?`#${Ur(s)}${Ur(n)}${Ur(o)}${Ur(a)}`:`#${Ur(s)}${Ur(n)}${Ur(o)}`}e.toCss=t;function i(s,n,o,a=255){return(s<<24|n<<16|o<<8|a)>>>0}e.toRgba=i;function r(s,n,o,a){return{css:e.toCss(s,n,o,a),rgba:e.toRgba(s,n,o,a)}}e.toColor=r})(Qe||={});var we;(e=>{function t(h,l){if(Ie=(l.rgba&255)/255,Ie===1)return{css:l.css,rgba:l.rgba};let c=l.rgba>>24&255,u=l.rgba>>16&255,g=l.rgba>>8&255,_=h.rgba>>24&255,m=h.rgba>>16&255,v=h.rgba>>8&255;Ve=_+Math.round((c-_)*Ie),Ye=m+Math.round((u-m)*Ie),Je=v+Math.round((g-v)*Ie);let x=Qe.toCss(Ve,Ye,Je),E=Qe.toRgba(Ve,Ye,Je);return{css:x,rgba:E}}e.blend=t;function i(h){return(h.rgba&255)===255}e.isOpaque=i;function r(h,l,c){let u=$a.ensureContrastRatio(h.rgba,l.rgba,c);if(u)return Qe.toColor(u>>24&255,u>>16&255,u>>8&255)}e.ensureContrastRatio=r;function s(h){let l=(h.rgba|255)>>>0;return[Ve,Ye,Je]=$a.toChannels(l),{css:Qe.toCss(Ve,Ye,Je),rgba:l}}e.opaque=s;function n(h,l){return Ie=Math.round(l*255),[Ve,Ye,Je]=$a.toChannels(h.rgba),{css:Qe.toCss(Ve,Ye,Je,Ie),rgba:Qe.toRgba(Ve,Ye,Je,Ie)}}e.opacity=n;function o(h,l){return Ie=h.rgba&255,n(h,Ie*l/255)}e.multiplyOpacity=o;function a(h){return[h.rgba>>24&255,h.rgba>>16&255,h.rgba>>8&255]}e.toColorRGB=a})(we||={});var Le;(e=>{let t,i;try{let s=document.createElement("canvas");s.width=1,s.height=1;let n=s.getContext("2d",{willReadFrequently:!0});n&&(t=n,t.globalCompositeOperation="copy",i=t.createLinearGradient(0,0,1,1))}catch{}function r(s){if(s.match(/#[\da-f]{3,8}/i))switch(s.length){case 4:return Ve=parseInt(s.slice(1,2).repeat(2),16),Ye=parseInt(s.slice(2,3).repeat(2),16),Je=parseInt(s.slice(3,4).repeat(2),16),Qe.toColor(Ve,Ye,Je);case 5:return Ve=parseInt(s.slice(1,2).repeat(2),16),Ye=parseInt(s.slice(2,3).repeat(2),16),Je=parseInt(s.slice(3,4).repeat(2),16),Ie=parseInt(s.slice(4,5).repeat(2),16),Qe.toColor(Ve,Ye,Je,Ie);case 7:return{css:s,rgba:(parseInt(s.slice(1),16)<<8|255)>>>0};case 9:return{css:s,rgba:parseInt(s.slice(1),16)>>>0}}let n=s.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(n)return Ve=parseInt(n[1]),Ye=parseInt(n[2]),Je=parseInt(n[3]),Ie=Math.round((n[5]===void 0?1:parseFloat(n[5]))*255),Qe.toColor(Ve,Ye,Je,Ie);if(!t||!i)throw new Error("css.toColor: Unsupported css format");if(t.fillStyle=i,t.fillStyle=s,typeof t.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(t.fillRect(0,0,1,1),[Ve,Ye,Je,Ie]=t.getImageData(0,0,1,1).data,Ie!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:Qe.toRgba(Ve,Ye,Je,Ie),css:s}}e.toColor=r})(Le||={});var mt;(e=>{function t(r){return i(r>>16&255,r>>8&255,r&255)}e.relativeLuminance=t;function i(r,s,n){let o=r/255,a=s/255,h=n/255,l=o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4),c=a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4),u=h<=.03928?h/12.92:Math.pow((h+.055)/1.055,2.4);return l*.2126+c*.7152+u*.0722}e.relativeLuminance2=i})(mt||={});var $a;(e=>{function t(o,a){if(Ie=(a&255)/255,Ie===1)return a;let h=a>>24&255,l=a>>16&255,c=a>>8&255,u=o>>24&255,g=o>>16&255,_=o>>8&255;return Ve=u+Math.round((h-u)*Ie),Ye=g+Math.round((l-g)*Ie),Je=_+Math.round((c-_)*Ie),Qe.toRgba(Ve,Ye,Je)}e.blend=t;function i(o,a,h){let l=mt.relativeLuminance(o>>8),c=mt.relativeLuminance(a>>8);if(Mi(l,c)<h){if(c<l){let _=r(o,a,h),m=Mi(l,mt.relativeLuminance(_>>8));if(m<h){let v=s(o,a,h),x=Mi(l,mt.relativeLuminance(v>>8));return m>x?_:v}return _}let u=s(o,a,h),g=Mi(l,mt.relativeLuminance(u>>8));if(g<h){let _=r(o,a,h),m=Mi(l,mt.relativeLuminance(_>>8));return g>m?u:_}return u}}e.ensureContrastRatio=i;function r(o,a,h){let l=o>>24&255,c=o>>16&255,u=o>>8&255,g=a>>24&255,_=a>>16&255,m=a>>8&255,v=Mi(mt.relativeLuminance2(g,_,m),mt.relativeLuminance2(l,c,u));for(;v<h&&(g>0||_>0||m>0);)g-=Math.max(0,Math.ceil(g*.1)),_-=Math.max(0,Math.ceil(_*.1)),m-=Math.max(0,Math.ceil(m*.1)),v=Mi(mt.relativeLuminance2(g,_,m),mt.relativeLuminance2(l,c,u));return(g<<24|_<<16|m<<8|255)>>>0}e.reduceLuminance=r;function s(o,a,h){let l=o>>24&255,c=o>>16&255,u=o>>8&255,g=a>>24&255,_=a>>16&255,m=a>>8&255,v=Mi(mt.relativeLuminance2(g,_,m),mt.relativeLuminance2(l,c,u));for(;v<h&&(g<255||_<255||m<255);)g=Math.min(255,g+Math.ceil((255-g)*.1)),_=Math.min(255,_+Math.ceil((255-_)*.1)),m=Math.min(255,m+Math.ceil((255-m)*.1)),v=Mi(mt.relativeLuminance2(g,_,m),mt.relativeLuminance2(l,c,u));return(g<<24|_<<16|m<<8|255)>>>0}e.increaseLuminance=s;function n(o){return[o>>24&255,o>>16&255,o>>8&255,o&255]}e.toChannels=n})($a||={});function Ur(e){let t=e.toString(16);return t.length<2?"0"+t:t}function Mi(e,t){return e<t?(t+.05)/(e+.05):(e+.05)/(t+.05)}var fE=class extends jn{constructor(e,t,i){super(),this.content=0,this.combinedData="",this.fg=e.fg,this.bg=e.bg,this.combinedData=t,this._width=i}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(e){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},Za=class{constructor(e){this._bufferService=e,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new $t}register(e){let t={id:this._nextCharacterJoinerId++,handler:e};return this._characterJoiners.push(t),t.id}deregister(e){for(let t=0;t<this._characterJoiners.length;t++)if(this._characterJoiners[t].id===e)return this._characterJoiners.splice(t,1),!0;return!1}getJoinedCharacters(e){if(this._characterJoiners.length===0)return[];let t=this._bufferService.buffer.lines.get(e);if(!t||t.length===0)return[];let i=[],r=t.translateToString(!0),s=0,n=0,o=0,a=t.getFg(0),h=t.getBg(0);for(let l=0;l<t.getTrimmedLength();l++)if(t.loadCell(l,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==a||this._workCell.bg!==h){if(l-s>1){let c=this._getJoinedRanges(r,o,n,t,s);for(let u=0;u<c.length;u++)i.push(c[u])}s=l,o=n,a=this._workCell.fg,h=this._workCell.bg}n+=this._workCell.getChars().length||yr.length}if(this._bufferService.cols-s>1){let l=this._getJoinedRanges(r,o,n,t,s);for(let c=0;c<l.length;c++)i.push(l[c])}return i}_getJoinedRanges(e,t,i,r,s){let n=e.substring(t,i),o=[];try{o=this._characterJoiners[0].handler(n)}catch(a){console.error(a)}for(let a=1;a<this._characterJoiners.length;a++)try{let h=this._characterJoiners[a].handler(n);for(let l=0;l<h.length;l++)Za._mergeRanges(o,h[l])}catch(h){console.error(h)}return this._stringRangesToCellRanges(o,r,s),o}_stringRangesToCellRanges(e,t,i){let r=0,s=!1,n=0,o=e[r];if(o){for(let a=i;a<this._bufferService.cols;a++){let h=t.getWidth(a),l=t.getString(a).length||yr.length;if(h!==0){if(!s&&o[0]<=n&&(o[0]=a,s=!0),o[1]<=n){if(o[1]=a,o=e[++r],!o)break;o[0]<=n?(o[0]=a,s=!0):s=!1}n+=l}}o&&(o[1]=this._bufferService.cols)}}static _mergeRanges(e,t){let i=!1;for(let r=0;r<e.length;r++){let s=e[r];if(i){if(t[1]<=s[0])return e[r-1][1]=t[1],e;if(t[1]<=s[1])return e[r-1][1]=Math.max(t[1],s[1]),e.splice(r,1),e;e.splice(r,1),r--}else{if(t[1]<=s[0])return e.splice(r,0,t),e;if(t[1]<=s[1])return s[0]=Math.min(t[0],s[0]),e;t[0]<s[1]&&(s[0]=Math.min(t[0],s[0]),i=!0);continue}}return i?e[e.length-1][1]=t[1]:e.push(t),e}};Za=Me([Z(0,vt)],Za);function _E(e){return 57508<=e&&e<=57558}function pE(e){return 9472<=e&&e<=9631}function gE(e){return _E(e)||pE(e)}function mE(){return{css:{canvas:Ra(),cell:Ra()},device:{canvas:Ra(),cell:Ra(),char:{width:0,height:0,left:0,top:0}}}}function Ra(){return{width:0,height:0}}var ku=class{constructor(e,t,i,r,s,n,o){this._document=e,this._characterJoinerService=t,this._optionsService=i,this._coreBrowserService=r,this._coreService=s,this._decorationService=n,this._themeService=o,this._workCell=new $t,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(e,t,i){this._selectionStart=e,this._selectionEnd=t,this._columnSelectMode=i}createRow(e,t,i,r,s,n,o,a,h,l,c){let u=[],g=this._characterJoinerService.getJoinedCharacters(t),_=this._themeService.colors,m=e.getNoBgTrimmedLength();i&&m<n+1&&(m=n+1);let v,x=0,E="",M=0,D=0,b=0,L=0,I=!1,R=0,G=!1,W=0,V=0,q=[],ne=l!==-1&&c!==-1;for(let C=0;C<m;C++){e.loadCell(C,this._workCell);let w=this._workCell.getWidth();if(w===0)continue;let k=!1,f=C>=V,d=C,p=this._workCell;if(g.length>0&&C===g[0][0]&&f){let fe=g.shift(),Ji=this._isCellInSelection(fe[0],t);for(M=fe[0]+1;M<fe[1];M++)f&&=Ji===this._isCellInSelection(M,t);f&&=!i||n<fe[0]||n>=fe[1],f?(k=!0,p=new fE(this._workCell,e.translateToString(!0,fe[0],fe[1]),fe[1]-fe[0]),d=fe[1]-1,w=p.getWidth()):V=fe[1]}let y=this._isCellInSelection(C,t),A=i&&C===n,S=ne&&C>=l&&C<=c,F=!1;this._decorationService.forEachDecorationAtCell(C,t,void 0,fe=>{F=!0});let U=p.getChars()||yr;if(U===" "&&(p.isUnderline()||p.isOverline())&&(U="\xA0"),W=w*a-h.get(U,p.isBold(),p.isItalic()),!v)v=this._document.createElement("span");else if(x&&(y&&G||!y&&!G&&p.bg===D)&&(y&&G&&_.selectionForeground||p.fg===b)&&p.extended.ext===L&&S===I&&W===R&&!A&&!k&&!F&&f){p.isInvisible()?E+=yr:E+=U,x++;continue}else x&&(v.textContent=E),v=this._document.createElement("span"),x=0,E="";if(D=p.bg,b=p.fg,L=p.extended.ext,I=S,R=W,G=y,k&&n>=C&&n<=d&&(n=C),!this._coreService.isCursorHidden&&A&&this._coreService.isCursorInitialized){if(q.push("xterm-cursor"),this._coreBrowserService.isFocused)o&&q.push("xterm-cursor-blink"),q.push(r==="bar"?"xterm-cursor-bar":r==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(s)switch(s){case"outline":q.push("xterm-cursor-outline");break;case"block":q.push("xterm-cursor-block");break;case"bar":q.push("xterm-cursor-bar");break;case"underline":q.push("xterm-cursor-underline");break;default:break}}if(p.isBold()&&q.push("xterm-bold"),p.isItalic()&&q.push("xterm-italic"),p.isDim()&&q.push("xterm-dim"),p.isInvisible()?E=yr:E=p.getChars()||yr,p.isUnderline()&&(q.push(`xterm-underline-${p.extended.underlineStyle}`),E===" "&&(E="\xA0"),!p.isUnderlineColorDefault()))if(p.isUnderlineColorRGB())v.style.textDecorationColor=`rgb(${jn.toColorRGB(p.getUnderlineColor()).join(",")})`;else{let fe=p.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&p.isBold()&&fe<8&&(fe+=8),v.style.textDecorationColor=_.ansi[fe].css}p.isOverline()&&(q.push("xterm-overline"),E===" "&&(E="\xA0")),p.isStrikethrough()&&q.push("xterm-strikethrough"),S&&(v.style.textDecoration="underline");let $=p.getFgColor(),z=p.getFgColorMode(),J=p.getBgColor(),ee=p.getBgColorMode(),de=!!p.isInverse();if(de){let fe=$;$=J,J=fe;let Ji=z;z=ee,ee=Ji}let De,Yi,ri=!1;this._decorationService.forEachDecorationAtCell(C,t,void 0,fe=>{fe.options.layer!=="top"&&ri||(fe.backgroundColorRGB&&(ee=50331648,J=fe.backgroundColorRGB.rgba>>8&16777215,De=fe.backgroundColorRGB),fe.foregroundColorRGB&&(z=50331648,$=fe.foregroundColorRGB.rgba>>8&16777215,Yi=fe.foregroundColorRGB),ri=fe.options.layer==="top")}),!ri&&y&&(De=this._coreBrowserService.isFocused?_.selectionBackgroundOpaque:_.selectionInactiveBackgroundOpaque,J=De.rgba>>8&16777215,ee=50331648,ri=!0,_.selectionForeground&&(z=50331648,$=_.selectionForeground.rgba>>8&16777215,Yi=_.selectionForeground)),ri&&q.push("xterm-decoration-top");let Et;switch(ee){case 16777216:case 33554432:Et=_.ansi[J],q.push(`xterm-bg-${J}`);break;case 50331648:Et=Qe.toColor(J>>16,J>>8&255,J&255),this._addStyle(v,`background-color:#${Mm((J>>>0).toString(16),"0",6)}`);break;case 0:default:de?(Et=_.foreground,q.push("xterm-bg-257")):Et=_.background}switch(De||p.isDim()&&(De=we.multiplyOpacity(Et,.5)),z){case 16777216:case 33554432:p.isBold()&&$<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&($+=8),this._applyMinimumContrast(v,Et,_.ansi[$],p,De,void 0)||q.push(`xterm-fg-${$}`);break;case 50331648:let fe=Qe.toColor($>>16&255,$>>8&255,$&255);this._applyMinimumContrast(v,Et,fe,p,De,Yi)||this._addStyle(v,`color:#${Mm($.toString(16),"0",6)}`);break;case 0:default:this._applyMinimumContrast(v,Et,_.foreground,p,De,Yi)||de&&q.push("xterm-fg-257")}q.length&&(v.className=q.join(" "),q.length=0),!A&&!k&&!F&&f?x++:v.textContent=E,W!==this.defaultSpacing&&(v.style.letterSpacing=`${W}px`),u.push(v),C=d}return v&&x&&(v.textContent=E),u}_applyMinimumContrast(e,t,i,r,s,n){if(this._optionsService.rawOptions.minimumContrastRatio===1||gE(r.getCode()))return!1;let o=this._getContrastCache(r),a;if(!s&&!n&&(a=o.getColor(t.rgba,i.rgba)),a===void 0){let h=this._optionsService.rawOptions.minimumContrastRatio/(r.isDim()?2:1);a=we.ensureContrastRatio(s||t,n||i,h),o.setColor((s||t).rgba,(n||i).rgba,a??null)}return a?(this._addStyle(e,`color:${a.css}`),!0):!1}_getContrastCache(e){return e.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(e,t){e.setAttribute("style",`${e.getAttribute("style")||""}${t};`)}_isCellInSelection(e,t){let i=this._selectionStart,r=this._selectionEnd;return!i||!r?!1:this._columnSelectMode?i[0]<=r[0]?e>=i[0]&&t>=i[1]&&e<r[0]&&t<=r[1]:e<i[0]&&t>=i[1]&&e>=r[0]&&t<=r[1]:t>i[1]&&t<r[1]||i[1]===r[1]&&t===i[1]&&e>=i[0]&&e<r[0]||i[1]<r[1]&&t===r[1]&&e<r[0]||i[1]<r[1]&&t===i[1]&&e>=i[0]}};ku=Me([Z(1,gv),Z(2,yt),Z(3,Pi),Z(4,Vr),Z(5,qn),Z(6,Cs)],ku);function Mm(e,t,i){for(;e.length<i;)e=t+e;return e}var vE=class{constructor(e,t){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=e.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";let i=e.createElement("span");i.classList.add("xterm-char-measure-element");let r=e.createElement("span");r.classList.add("xterm-char-measure-element"),r.style.fontWeight="bold";let s=e.createElement("span");s.classList.add("xterm-char-measure-element"),s.style.fontStyle="italic";let n=e.createElement("span");n.classList.add("xterm-char-measure-element"),n.style.fontWeight="bold",n.style.fontStyle="italic",this._measureElements=[i,r,s,n],this._container.appendChild(i),this._container.appendChild(r),this._container.appendChild(s),this._container.appendChild(n),t.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(e,t,i,r){e===this._font&&t===this._fontSize&&i===this._weight&&r===this._weightBold||(this._font=e,this._fontSize=t,this._weight=i,this._weightBold=r,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${i}`,this._measureElements[1].style.fontWeight=`${r}`,this._measureElements[2].style.fontWeight=`${i}`,this._measureElements[3].style.fontWeight=`${r}`,this.clear())}get(e,t,i){let r=0;if(!t&&!i&&e.length===1&&(r=e.charCodeAt(0))<256){if(this._flat[r]!==-9999)return this._flat[r];let o=this._measure(e,0);return o>0&&(this._flat[r]=o),o}let s=e;t&&(s+="B"),i&&(s+="I");let n=this._holey.get(s);if(n===void 0){let o=0;t&&(o|=1),i&&(o|=2),n=this._measure(e,o),n>0&&this._holey.set(s,n)}return n}_measure(e,t){let i=this._measureElements[t];return i.textContent=e.repeat(32),i.offsetWidth/32}},yE=class{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(e,t,i,r=!1){if(this.selectionStart=t,this.selectionEnd=i,!t||!i||t[0]===i[0]&&t[1]===i[1]){this.clear();return}let s=e.buffers.active.ydisp,n=t[1]-s,o=i[1]-s,a=Math.max(n,0),h=Math.min(o,e.rows-1);if(a>=e.rows||h<0){this.clear();return}this.hasSelection=!0,this.columnSelectMode=r,this.viewportStartRow=n,this.viewportEndRow=o,this.viewportCappedStartRow=a,this.viewportCappedEndRow=h,this.startCol=t[0],this.endCol=i[0]}isCellSelected(e,t,i){return this.hasSelection?(i-=e.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?t>=this.startCol&&i>=this.viewportCappedStartRow&&t<this.endCol&&i<=this.viewportCappedEndRow:t<this.startCol&&i>=this.viewportCappedStartRow&&t>=this.endCol&&i<=this.viewportCappedEndRow:i>this.viewportStartRow&&i<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&i===this.viewportStartRow&&t>=this.startCol&&t<this.endCol||this.viewportStartRow<this.viewportEndRow&&i===this.viewportEndRow&&t<this.endCol||this.viewportStartRow<this.viewportEndRow&&i===this.viewportStartRow&&t>=this.startCol):!1}};function bE(){return new yE}var qc="xterm-dom-renderer-owner-",Ut="xterm-rows",Fa="xterm-fg-",Tm="xterm-bg-",In="xterm-focus",Pa="xterm-selection",wE=1,Eu=class extends oe{constructor(e,t,i,r,s,n,o,a,h,l,c,u,g,_){super(),this._terminal=e,this._document=t,this._element=i,this._screenElement=r,this._viewportElement=s,this._helperContainer=n,this._linkifier2=o,this._charSizeService=h,this._optionsService=l,this._bufferService=c,this._coreService=u,this._coreBrowserService=g,this._themeService=_,this._terminalClass=wE++,this._rowElements=[],this._selectionRenderModel=bE(),this.onRequestRedraw=this._register(new Y).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(Ut),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add(Pa),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=mE(),this._updateDimensions(),this._register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this._register(this._themeService.onChangeColors(m=>this._injectCss(m))),this._injectCss(this._themeService.colors),this._rowFactory=a.createInstance(ku,document),this._element.classList.add(qc+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this._register(this._linkifier2.onShowLinkUnderline(m=>this._handleLinkHover(m))),this._register(this._linkifier2.onHideLinkUnderline(m=>this._handleLinkLeave(m))),this._register(Ae(()=>{this._element.classList.remove(qc+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()})),this._widthCache=new vE(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){let e=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*e,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*e),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/e),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/e),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(let i of this._rowElements)i.style.width=`${this.dimensions.css.canvas.width}px`,i.style.height=`${this.dimensions.css.cell.height}px`,i.style.lineHeight=`${this.dimensions.css.cell.height}px`,i.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));let t=`${this._terminalSelector} .${Ut} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=t,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(e){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let t=`${this._terminalSelector} .${Ut} { pointer-events: none; color: ${e.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;t+=`${this._terminalSelector} .${Ut} .xterm-dim { color: ${we.multiplyOpacity(e.foreground,.5).css};}`,t+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;let i=`blink_underline_${this._terminalClass}`,r=`blink_bar_${this._terminalClass}`,s=`blink_block_${this._terminalClass}`;t+=`@keyframes ${i} { 50% {  border-bottom-style: hidden; }}`,t+=`@keyframes ${r} { 50% {  box-shadow: none; }}`,t+=`@keyframes ${s} { 0% {  background-color: ${e.cursor.css};  color: ${e.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${e.cursor.css}; }}`,t+=`${this._terminalSelector} .${Ut}.${In} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${i} 1s step-end infinite;}${this._terminalSelector} .${Ut}.${In} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${r} 1s step-end infinite;}${this._terminalSelector} .${Ut}.${In} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${s} 1s step-end infinite;}${this._terminalSelector} .${Ut} .xterm-cursor.xterm-cursor-block { background-color: ${e.cursor.css}; color: ${e.cursorAccent.css};}${this._terminalSelector} .${Ut} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${e.cursor.css} !important; color: ${e.cursorAccent.css} !important;}${this._terminalSelector} .${Ut} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${e.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${Ut} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${e.cursor.css} inset;}${this._terminalSelector} .${Ut} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${e.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,t+=`${this._terminalSelector} .${Pa} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${Pa} div { position: absolute; background-color: ${e.selectionBackgroundOpaque.css};}${this._terminalSelector} .${Pa} div { position: absolute; background-color: ${e.selectionInactiveBackgroundOpaque.css};}`;for(let[n,o]of e.ansi.entries())t+=`${this._terminalSelector} .${Fa}${n} { color: ${o.css}; }${this._terminalSelector} .${Fa}${n}.xterm-dim { color: ${we.multiplyOpacity(o,.5).css}; }${this._terminalSelector} .${Tm}${n} { background-color: ${o.css}; }`;t+=`${this._terminalSelector} .${Fa}257 { color: ${we.opaque(e.background).css}; }${this._terminalSelector} .${Fa}257.xterm-dim { color: ${we.multiplyOpacity(we.opaque(e.background),.5).css}; }${this._terminalSelector} .${Tm}257 { background-color: ${e.foreground.css}; }`,this._themeStyleElement.textContent=t}_setDefaultSpacing(){let e=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${e}px`,this._rowFactory.defaultSpacing=e}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(e,t){for(let i=this._rowElements.length;i<=t;i++){let r=this._document.createElement("div");this._rowContainer.appendChild(r),this._rowElements.push(r)}for(;this._rowElements.length>t;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(e,t){this._refreshRowElements(e,t),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(In),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(In),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(e,t,i){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(e,t,i),this.renderRows(0,this._bufferService.rows-1),!e||!t||(this._selectionRenderModel.update(this._terminal,e,t,i),!this._selectionRenderModel.hasSelection))return;let r=this._selectionRenderModel.viewportStartRow,s=this._selectionRenderModel.viewportEndRow,n=this._selectionRenderModel.viewportCappedStartRow,o=this._selectionRenderModel.viewportCappedEndRow,a=this._document.createDocumentFragment();if(i){let h=e[0]>t[0];a.appendChild(this._createSelectionElement(n,h?t[0]:e[0],h?e[0]:t[0],o-n+1))}else{let h=r===n?e[0]:0,l=n===s?t[0]:this._bufferService.cols;a.appendChild(this._createSelectionElement(n,h,l));let c=o-n-1;if(a.appendChild(this._createSelectionElement(n+1,0,this._bufferService.cols,c)),n!==o){let u=s===o?t[0]:this._bufferService.cols;a.appendChild(this._createSelectionElement(o,0,u))}}this._selectionContainer.appendChild(a)}_createSelectionElement(e,t,i,r=1){let s=this._document.createElement("div"),n=t*this.dimensions.css.cell.width,o=this.dimensions.css.cell.width*(i-t);return n+o>this.dimensions.css.canvas.width&&(o=this.dimensions.css.canvas.width-n),s.style.height=`${r*this.dimensions.css.cell.height}px`,s.style.top=`${e*this.dimensions.css.cell.height}px`,s.style.left=`${n}px`,s.style.width=`${o}px`,s}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(let e of this._rowElements)e.replaceChildren()}renderRows(e,t){let i=this._bufferService.buffer,r=i.ybase+i.y,s=Math.min(i.x,this._bufferService.cols-1),n=this._coreService.decPrivateModes.cursorBlink??this._optionsService.rawOptions.cursorBlink,o=this._coreService.decPrivateModes.cursorStyle??this._optionsService.rawOptions.cursorStyle,a=this._optionsService.rawOptions.cursorInactiveStyle;for(let h=e;h<=t;h++){let l=h+i.ydisp,c=this._rowElements[h],u=i.lines.get(l);if(!c||!u)break;c.replaceChildren(...this._rowFactory.createRow(u,l,l===r,o,a,s,n,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${qc}${this._terminalClass}`}_handleLinkHover(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!0)}_handleLinkLeave(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!1)}_setCellUnderline(e,t,i,r,s,n){i<0&&(e=0),r<0&&(t=0);let o=this._bufferService.rows-1;i=Math.max(Math.min(i,o),0),r=Math.max(Math.min(r,o),0),s=Math.min(s,this._bufferService.cols);let a=this._bufferService.buffer,h=a.ybase+a.y,l=Math.min(a.x,s-1),c=this._optionsService.rawOptions.cursorBlink,u=this._optionsService.rawOptions.cursorStyle,g=this._optionsService.rawOptions.cursorInactiveStyle;for(let _=i;_<=r;++_){let m=_+a.ydisp,v=this._rowElements[_],x=a.lines.get(m);if(!v||!x)break;v.replaceChildren(...this._rowFactory.createRow(x,m,m===h,u,g,l,c,this.dimensions.css.cell.width,this._widthCache,n?_===i?e:0:-1,n?(_===r?t:s)-1:-1))}}};Eu=Me([Z(7,Hu),Z(8,sl),Z(9,yt),Z(10,vt),Z(11,Vr),Z(12,Pi),Z(13,Cs)],Eu);var Bu=class extends oe{constructor(e,t,i){super(),this._optionsService=i,this.width=0,this.height=0,this._onCharSizeChange=this._register(new Y),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this._register(new xE(this._optionsService))}catch{this._measureStrategy=this._register(new AE(e,t,this._optionsService))}this._register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}get hasValidSize(){return this.width>0&&this.height>0}measure(){let e=this._measureStrategy.measure();(e.width!==this.width||e.height!==this.height)&&(this.width=e.width,this.height=e.height,this._onCharSizeChange.fire())}};Bu=Me([Z(2,yt)],Bu);var zv=class extends oe{constructor(){super(...arguments),this._result={width:0,height:0}}_validateAndSet(e,t){e!==void 0&&e>0&&t!==void 0&&t>0&&(this._result.width=e,this._result.height=t)}},AE=class extends zv{constructor(e,t,i){super(),this._document=e,this._parentElement=t,this._optionsService=i,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}},xE=class extends zv{constructor(e){super(),this._optionsService=e,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");let t=this._ctx.measureText("W");if(!("width"in t&&"fontBoundingBoxAscent"in t&&"fontBoundingBoxDescent"in t))throw new Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;let e=this._ctx.measureText("W");return this._validateAndSet(e.width,e.fontBoundingBoxAscent+e.fontBoundingBoxDescent),this._result}},SE=class extends oe{constructor(e,t,i){super(),this._textarea=e,this._window=t,this.mainDocument=i,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=this._register(new CE(this._window)),this._onDprChange=this._register(new Y),this.onDprChange=this._onDprChange.event,this._onWindowChange=this._register(new Y),this.onWindowChange=this._onWindowChange.event,this._register(this.onWindowChange(r=>this._screenDprMonitor.setWindow(r))),this._register(ot.forward(this._screenDprMonitor.onDprChange,this._onDprChange)),this._register(se(this._textarea,"focus",()=>this._isFocused=!0)),this._register(se(this._textarea,"blur",()=>this._isFocused=!1))}get window(){return this._window}set window(e){this._window!==e&&(this._window=e,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}},CE=class extends oe{constructor(e){super(),this._parentWindow=e,this._windowResizeListener=this._register(new Ss),this._onDprChange=this._register(new Y),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this._register(Ae(()=>this.clearListener()))}setWindow(e){this._parentWindow=e,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=se(this._parentWindow,"resize",()=>this._setDprAndFireIfDiffers())}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){this._outerListener&&(this._resolutionMediaMatchList?.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){!this._resolutionMediaMatchList||!this._outerListener||(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}},kE=class extends oe{constructor(){super(),this.linkProviders=[],this._register(Ae(()=>this.linkProviders.length=0))}registerLinkProvider(e){return this.linkProviders.push(e),{dispose:()=>{let t=this.linkProviders.indexOf(e);t!==-1&&this.linkProviders.splice(t,1)}}}};function qu(e,t,i){let r=i.getBoundingClientRect(),s=e.getComputedStyle(i),n=parseInt(s.getPropertyValue("padding-left")),o=parseInt(s.getPropertyValue("padding-top"));return[t.clientX-r.left-n,t.clientY-r.top-o]}function EE(e,t,i,r,s,n,o,a,h){if(!n)return;let l=qu(e,t,i);if(l)return l[0]=Math.ceil((l[0]+(h?o/2:0))/o),l[1]=Math.ceil(l[1]/a),l[0]=Math.min(Math.max(l[0],1),r+(h?1:0)),l[1]=Math.min(Math.max(l[1],1),s),l}var Lu=class{constructor(e,t){this._renderService=e,this._charSizeService=t}getCoords(e,t,i,r,s){return EE(window,e,t,i,r,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,s)}getMouseReportCoords(e,t){let i=qu(window,e,t);if(this._charSizeService.hasValidSize)return i[0]=Math.min(Math.max(i[0],0),this._renderService.dimensions.css.canvas.width-1),i[1]=Math.min(Math.max(i[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(i[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(i[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(i[0]),y:Math.floor(i[1])}}};Lu=Me([Z(0,Oi),Z(1,sl)],Lu);var BE=class{constructor(e,t){this._renderCallback=e,this._coreBrowserService=t,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(e){return this._refreshCallbacks.push(e),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(e,t,i){this._rowCount=i,e=e!==void 0?e:0,t=t!==void 0?t:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,e):e,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,t):t,!this._animationFrame&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0){this._runRefreshCallbacks();return}let e=Math.max(this._rowStart,0),t=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(e,t),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(let e of this._refreshCallbacks)e(0);this._refreshCallbacks=[]}},Wv={};u5(Wv,{getSafariVersion:()=>DE,isChromeOS:()=>qv,isFirefox:()=>$v,isIpad:()=>IE,isIphone:()=>ME,isLegacyEdge:()=>LE,isLinux:()=>Vu,isMac:()=>el,isNode:()=>al,isSafari:()=>Gv,isWindows:()=>jv});var al=typeof process<"u"&&"title"in process,Vn=al?"node":navigator.userAgent,Yn=al?"node":navigator.platform,$v=Vn.includes("Firefox"),LE=Vn.includes("Edge"),Gv=/^((?!chrome|android).)*safari/i.test(Vn);function DE(){if(!Gv)return 0;let e=Vn.match(/Version\/(\d+)/);return e===null||e.length<2?0:parseInt(e[1])}var el=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(Yn),IE=Yn==="iPad",ME=Yn==="iPhone",jv=["Windows","Win16","Win32","WinCE"].includes(Yn),Vu=Yn.indexOf("Linux")>=0,qv=/\bCrOS\b/.test(Vn),Vv=class{constructor(){this._tasks=[],this._i=0}enqueue(e){this._tasks.push(e),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(e){this._idleCallback=void 0;let t=0,i=0,r=e.timeRemaining(),s=0;for(;this._i<this._tasks.length;){if(t=performance.now(),this._tasks[this._i]()||this._i++,t=Math.max(1,performance.now()-t),i=Math.max(t,i),s=e.timeRemaining(),i*1.5>s){r-t<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(r-t))}ms`),this._start();return}r=s}this.clear()}},TE=class extends Vv{_requestCallback(e){return setTimeout(()=>e(this._createDeadline(16)))}_cancelCallback(e){clearTimeout(e)}_createDeadline(e){let t=performance.now()+e;return{timeRemaining:()=>Math.max(0,t-performance.now())}}},RE=class extends Vv{_requestCallback(e){return requestIdleCallback(e)}_cancelCallback(e){cancelIdleCallback(e)}},tl=!al&&"requestIdleCallback"in window?RE:TE,FE=class{constructor(){this._queue=new tl}set(e){this._queue.clear(),this._queue.enqueue(e)}flush(){this._queue.flush()}},Du=class extends oe{constructor(e,t,i,r,s,n,o,a,h){super(),this._rowCount=e,this._optionsService=i,this._charSizeService=r,this._coreService=s,this._coreBrowserService=a,this._renderer=this._register(new Ss),this._pausedResizeTask=new FE,this._observerDisposable=this._register(new Ss),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this._register(new Y),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this._register(new Y),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this._register(new Y),this.onRender=this._onRender.event,this._onRefreshRequest=this._register(new Y),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new BE((l,c)=>this._renderRows(l,c),this._coreBrowserService),this._register(this._renderDebouncer),this._syncOutputHandler=new PE(this._coreBrowserService,this._coreService,()=>this._fullRefresh()),this._register(Ae(()=>this._syncOutputHandler.dispose())),this._register(this._coreBrowserService.onDprChange(()=>this.handleDevicePixelRatioChange())),this._register(o.onResize(()=>this._fullRefresh())),this._register(o.buffers.onBufferActivate(()=>this._renderer.value?.clear())),this._register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this._register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this._register(n.onDecorationRegistered(()=>this._fullRefresh())),this._register(n.onDecorationRemoved(()=>this._fullRefresh())),this._register(this._optionsService.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],()=>{this.clear(),this.handleResize(o.cols,o.rows),this._fullRefresh()})),this._register(this._optionsService.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(o.buffer.y,o.buffer.y,!0))),this._register(h.onChangeColors(()=>this._fullRefresh())),this._registerIntersectionObserver(this._coreBrowserService.window,t),this._register(this._coreBrowserService.onWindowChange(l=>this._registerIntersectionObserver(l,t)))}get dimensions(){return this._renderer.value.dimensions}_registerIntersectionObserver(e,t){if("IntersectionObserver"in e){let i=new e.IntersectionObserver(r=>this._handleIntersectionChange(r[r.length-1]),{threshold:0});i.observe(t),this._observerDisposable.value=Ae(()=>i.disconnect())}}_handleIntersectionChange(e){this._isPaused=e.isIntersecting===void 0?e.intersectionRatio===0:!e.isIntersecting,!this._isPaused&&!this._charSizeService.hasValidSize&&this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(e,t,i=!1){if(this._isPaused){this._needsFullRefresh=!0;return}if(this._coreService.decPrivateModes.synchronizedOutput){this._syncOutputHandler.bufferRows(e,t);return}let r=this._syncOutputHandler.flush();r&&(e=Math.min(e,r.start),t=Math.max(t,r.end)),i||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(e,t,this._rowCount)}_renderRows(e,t){if(this._renderer.value){if(this._coreService.decPrivateModes.synchronizedOutput){this._syncOutputHandler.bufferRows(e,t);return}e=Math.min(e,this._rowCount-1),t=Math.min(t,this._rowCount-1),this._renderer.value.renderRows(e,t),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:e,end:t}),this._onRender.fire({start:e,end:t}),this._isNextRenderRedrawOnly=!0}}resize(e,t){this._rowCount=t,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(e){this._renderer.value=e,this._renderer.value&&(this._renderer.value.onRequestRedraw(t=>this.refreshRows(t.start,t.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback(e){return this._renderDebouncer.addRefreshCallback(e)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){this._renderer.value&&(this._renderer.value.clearTextureAtlas?.(),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(e,t){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(()=>this._renderer.value?.handleResize(e,t)):this._renderer.value.handleResize(e,t),this._fullRefresh())}handleCharSizeChanged(){this._renderer.value?.handleCharSizeChanged()}handleBlur(){this._renderer.value?.handleBlur()}handleFocus(){this._renderer.value?.handleFocus()}handleSelectionChanged(e,t,i){this._selectionState.start=e,this._selectionState.end=t,this._selectionState.columnSelectMode=i,this._renderer.value?.handleSelectionChanged(e,t,i)}handleCursorMove(){this._renderer.value?.handleCursorMove()}clear(){this._renderer.value?.clear()}};Du=Me([Z(2,yt),Z(3,sl),Z(4,Vr),Z(5,qn),Z(6,vt),Z(7,Pi),Z(8,Cs)],Du);var PE=class{constructor(e,t,i){this._coreBrowserService=e,this._coreService=t,this._onTimeout=i,this._start=0,this._end=0,this._isBuffering=!1}bufferRows(e,t){this._isBuffering?(this._start=Math.min(this._start,e),this._end=Math.max(this._end,t)):(this._start=e,this._end=t,this._isBuffering=!0),this._timeout===void 0&&(this._timeout=this._coreBrowserService.window.setTimeout(()=>{this._timeout=void 0,this._coreService.decPrivateModes.synchronizedOutput=!1,this._onTimeout()},1e3))}flush(){if(this._timeout!==void 0&&(this._coreBrowserService.window.clearTimeout(this._timeout),this._timeout=void 0),!this._isBuffering)return;let e={start:this._start,end:this._end};return this._isBuffering=!1,e}dispose(){this._timeout!==void 0&&(this._coreBrowserService.window.clearTimeout(this._timeout),this._timeout=void 0)}};function OE(e,t,i,r){let s=i.buffer.x,n=i.buffer.y;if(!i.buffer.hasScrollback)return QE(s,n,e,t,i,r)+ll(n,t,i,r)+HE(s,n,e,t,i,r);let o;if(n===t)return o=s>e?"D":"C",$n(Math.abs(s-e),Wn(o,r));o=n>t?"D":"C";let a=Math.abs(n-t),h=NE(n>t?e:s,i)+(a-1)*i.cols+1+KE(n>t?s:e,i);return $n(h,Wn(o,r))}function KE(e,t){return e-1}function NE(e,t){return t.cols-e}function QE(e,t,i,r,s,n){return ll(t,r,s,n).length===0?"":$n(Jv(e,t,e,t-qr(t,s),!1,s).length,Wn("D",n))}function ll(e,t,i,r){let s=e-qr(e,i),n=t-qr(t,i),o=Math.abs(s-n)-XE(e,t,i);return $n(o,Wn(Yv(e,t),r))}function HE(e,t,i,r,s,n){let o;ll(t,r,s,n).length>0?o=r-qr(r,s):o=t;let a=r,h=UE(e,t,i,r,s,n);return $n(Jv(e,o,i,a,h==="C",s).length,Wn(h,n))}function XE(e,t,i){let r=0,s=e-qr(e,i),n=t-qr(t,i);for(let o=0;o<Math.abs(s-n);o++){let a=Yv(e,t)==="A"?-1:1;i.buffer.lines.get(s+a*o)?.isWrapped&&r++}return r}function qr(e,t){let i=0,r=t.buffer.lines.get(e),s=r?.isWrapped;for(;s&&e>=0&&e<t.rows;)i++,r=t.buffer.lines.get(--e),s=r?.isWrapped;return i}function UE(e,t,i,r,s,n){let o;return ll(i,r,s,n).length>0?o=r-qr(r,s):o=t,e<i&&o<=r||e>=i&&o<r?"C":"D"}function Yv(e,t){return e>t?"A":"B"}function Jv(e,t,i,r,s,n){let o=e,a=t,h="";for(;(o!==i||a!==r)&&a>=0&&a<n.buffer.lines.length;)o+=s?1:-1,s&&o>n.cols-1?(h+=n.buffer.translateBufferLineToString(a,!1,e,o),o=0,e=0,a++):!s&&o<0&&(h+=n.buffer.translateBufferLineToString(a,!1,0,e+1),o=n.cols-1,e=o,a--);return h+n.buffer.translateBufferLineToString(a,!1,e,o)}function Wn(e,t){let i=t?"O":"[";return j.ESC+i+e}function $n(e,t){e=Math.floor(e);let i="";for(let r=0;r<e;r++)i+=t;return i}var zE=class{constructor(e){this._bufferService=e,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:!this.selectionEnd||!this.selectionStart?this.selectionStart:this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){let e=this.selectionStart[0]+this.selectionStartLength;return e>this._bufferService.cols?e%this._bufferService.cols===0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)-1]:[e%this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)]:[e,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){let e=this.selectionStart[0]+this.selectionStartLength;return e>this._bufferService.cols?[e%this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)]:[Math.max(e,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){let e=this.selectionStart,t=this.selectionEnd;return!e||!t?!1:e[1]>t[1]||e[1]===t[1]&&e[0]>t[0]}handleTrim(e){return this.selectionStart&&(this.selectionStart[1]-=e),this.selectionEnd&&(this.selectionEnd[1]-=e),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}};function Rm(e,t){if(e.start.y>e.end.y)throw new Error(`Buffer range end (${e.end.x}, ${e.end.y}) cannot be before start (${e.start.x}, ${e.start.y})`);return t*(e.end.y-e.start.y)+(e.end.x-e.start.x+1)}var Vc=50,WE=15,$E=50,GE=500,jE="\xA0",qE=new RegExp(jE,"g"),Iu=class extends oe{constructor(e,t,i,r,s,n,o,a,h){super(),this._element=e,this._screenElement=t,this._linkifier=i,this._bufferService=r,this._coreService=s,this._mouseService=n,this._optionsService=o,this._renderService=a,this._coreBrowserService=h,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new $t,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this._register(new Y),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this._register(new Y),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this._register(new Y),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this._register(new Y),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=l=>this._handleMouseMove(l),this._mouseUpListener=l=>this._handleMouseUp(l),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim(l=>this._handleTrim(l)),this._register(this._bufferService.buffers.onBufferActivate(l=>this._handleBufferActivate(l))),this.enable(),this._model=new zE(this._bufferService),this._activeSelectionMode=0,this._register(Ae(()=>{this._removeMouseDownListeners()})),this._register(this._bufferService.onResize(l=>{l.rowsChanged&&this.clearSelection()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){let e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd;return!e||!t?!1:e[0]!==t[0]||e[1]!==t[1]}get selectionText(){let e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd;if(!e||!t)return"";let i=this._bufferService.buffer,r=[];if(this._activeSelectionMode===3){if(e[0]===t[0])return"";let s=e[0]<t[0]?e[0]:t[0],n=e[0]<t[0]?t[0]:e[0];for(let o=e[1];o<=t[1];o++){let a=i.translateBufferLineToString(o,!0,s,n);r.push(a)}}else{let s=e[1]===t[1]?t[0]:void 0;r.push(i.translateBufferLineToString(e[1],!0,e[0],s));for(let n=e[1]+1;n<=t[1]-1;n++){let o=i.lines.get(n),a=i.translateBufferLineToString(n,!0);o?.isWrapped?r[r.length-1]+=a:r.push(a)}if(e[1]!==t[1]){let n=i.lines.get(t[1]),o=i.translateBufferLineToString(t[1],!0,0,t[0]);n&&n.isWrapped?r[r.length-1]+=o:r.push(o)}}return r.map(s=>s.replace(qE," ")).join(jv?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(e){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),Vu&&e&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(e){let t=this._getMouseBufferCoords(e),i=this._model.finalSelectionStart,r=this._model.finalSelectionEnd;return!i||!r||!t?!1:this._areCoordsInSelection(t,i,r)}isCellInSelection(e,t){let i=this._model.finalSelectionStart,r=this._model.finalSelectionEnd;return!i||!r?!1:this._areCoordsInSelection([e,t],i,r)}_areCoordsInSelection(e,t,i){return e[1]>t[1]&&e[1]<i[1]||t[1]===i[1]&&e[1]===t[1]&&e[0]>=t[0]&&e[0]<i[0]||t[1]<i[1]&&e[1]===i[1]&&e[0]<i[0]||t[1]<i[1]&&e[1]===t[1]&&e[0]>=t[0]}_selectWordAtCursor(e,t){let i=this._linkifier.currentLink?.link?.range;if(i)return this._model.selectionStart=[i.start.x-1,i.start.y-1],this._model.selectionStartLength=Rm(i,this._bufferService.cols),this._model.selectionEnd=void 0,!0;let r=this._getMouseBufferCoords(e);return r?(this._selectWordAt(r,t),this._model.selectionEnd=void 0,!0):!1}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(e,t){this._model.clearSelection(),e=Math.max(e,0),t=Math.min(t,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,e],this._model.selectionEnd=[this._bufferService.cols,t],this.refresh(),this._onSelectionChange.fire()}_handleTrim(e){this._model.handleTrim(e)&&this.refresh()}_getMouseBufferCoords(e){let t=this._mouseService.getCoords(e,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(t)return t[0]--,t[1]--,t[1]+=this._bufferService.buffer.ydisp,t}_getMouseEventScrollAmount(e){let t=qu(this._coreBrowserService.window,e,this._screenElement)[1],i=this._renderService.dimensions.css.canvas.height;return t>=0&&t<=i?0:(t>i&&(t-=i),t=Math.min(Math.max(t,-Vc),Vc),t/=Vc,t/Math.abs(t)+Math.round(t*(WE-1)))}shouldForceSelection(e){return el?e.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:e.shiftKey}handleMouseDown(e){if(this._mouseDownTimeStamp=e.timeStamp,!(e.button===2&&this.hasSelection)&&e.button===0){if(!this._enabled){if(!this.shouldForceSelection(e))return;e.stopPropagation()}e.preventDefault(),this._dragScrollAmount=0,this._enabled&&e.shiftKey?this._handleIncrementalClick(e):e.detail===1?this._handleSingleClick(e):e.detail===2?this._handleDoubleClick(e):e.detail===3&&this._handleTripleClick(e),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),$E)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(e){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(e))}_handleSingleClick(e){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(e)?3:0,this._model.selectionStart=this._getMouseBufferCoords(e),!this._model.selectionStart)return;this._model.selectionEnd=void 0;let t=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);t&&t.length!==this._model.selectionStart[0]&&t.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(e){this._selectWordAtCursor(e,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(e){let t=this._getMouseBufferCoords(e);t&&(this._activeSelectionMode=2,this._selectLineAt(t[1]))}shouldColumnSelect(e){return e.altKey&&!(el&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(e){if(e.stopImmediatePropagation(),!this._model.selectionStart)return;let t=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(e),!this._model.selectionEnd){this.refresh(!0);return}this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(e),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));let i=this._bufferService.buffer;if(this._model.selectionEnd[1]<i.lines.length){let r=i.lines.get(this._model.selectionEnd[1]);r&&r.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}(!t||t[0]!==this._model.selectionEnd[0]||t[1]!==this._model.selectionEnd[1])&&this.refresh(!0)}_dragScroll(){if(!(!this._model.selectionEnd||!this._model.selectionStart)&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});let e=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(e.ydisp+this._bufferService.rows,e.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=e.ydisp),this.refresh()}}_handleMouseUp(e){let t=e.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&t<GE&&e.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){let i=this._mouseService.getCoords(e,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(i&&i[0]!==void 0&&i[1]!==void 0){let r=OE(i[0]-1,i[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(r,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){let e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd,i=!!e&&!!t&&(e[0]!==t[0]||e[1]!==t[1]);if(!i){this._oldHasSelection&&this._fireOnSelectionChange(e,t,i);return}!e||!t||(!this._oldSelectionStart||!this._oldSelectionEnd||e[0]!==this._oldSelectionStart[0]||e[1]!==this._oldSelectionStart[1]||t[0]!==this._oldSelectionEnd[0]||t[1]!==this._oldSelectionEnd[1])&&this._fireOnSelectionChange(e,t,i)}_fireOnSelectionChange(e,t,i){this._oldSelectionStart=e,this._oldSelectionEnd=t,this._oldHasSelection=i,this._onSelectionChange.fire()}_handleBufferActivate(e){this.clearSelection(),this._trimListener.dispose(),this._trimListener=e.activeBuffer.lines.onTrim(t=>this._handleTrim(t))}_convertViewportColToCharacterIndex(e,t){let i=t;for(let r=0;t>=r;r++){let s=e.loadCell(r,this._workCell).getChars().length;this._workCell.getWidth()===0?i--:s>1&&t!==r&&(i+=s-1)}return i}setSelection(e,t,i){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[e,t],this._model.selectionStartLength=i,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(e){this._isClickInSelection(e)||(this._selectWordAtCursor(e,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(e,t,i=!0,r=!0){if(e[0]>=this._bufferService.cols)return;let s=this._bufferService.buffer,n=s.lines.get(e[1]);if(!n)return;let o=s.translateBufferLineToString(e[1],!1),a=this._convertViewportColToCharacterIndex(n,e[0]),h=a,l=e[0]-a,c=0,u=0,g=0,_=0;if(o.charAt(a)===" "){for(;a>0&&o.charAt(a-1)===" ";)a--;for(;h<o.length&&o.charAt(h+1)===" ";)h++}else{let x=e[0],E=e[0];n.getWidth(x)===0&&(c++,x--),n.getWidth(E)===2&&(u++,E++);let M=n.getString(E).length;for(M>1&&(_+=M-1,h+=M-1);x>0&&a>0&&!this._isCharWordSeparator(n.loadCell(x-1,this._workCell));){n.loadCell(x-1,this._workCell);let D=this._workCell.getChars().length;this._workCell.getWidth()===0?(c++,x--):D>1&&(g+=D-1,a-=D-1),a--,x--}for(;E<n.length&&h+1<o.length&&!this._isCharWordSeparator(n.loadCell(E+1,this._workCell));){n.loadCell(E+1,this._workCell);let D=this._workCell.getChars().length;this._workCell.getWidth()===2?(u++,E++):D>1&&(_+=D-1,h+=D-1),h++,E++}}h++;let m=a+l-c+g,v=Math.min(this._bufferService.cols,h-a+c+u-g-_);if(!(!t&&o.slice(a,h).trim()==="")){if(i&&m===0&&n.getCodePoint(0)!==32){let x=s.lines.get(e[1]-1);if(x&&n.isWrapped&&x.getCodePoint(this._bufferService.cols-1)!==32){let E=this._getWordAt([this._bufferService.cols-1,e[1]-1],!1,!0,!1);if(E){let M=this._bufferService.cols-E.start;m-=M,v+=M}}}if(r&&m+v===this._bufferService.cols&&n.getCodePoint(this._bufferService.cols-1)!==32){let x=s.lines.get(e[1]+1);if(x?.isWrapped&&x.getCodePoint(0)!==32){let E=this._getWordAt([0,e[1]+1],!1,!1,!0);E&&(v+=E.length)}}return{start:m,length:v}}}_selectWordAt(e,t){let i=this._getWordAt(e,t);if(i){for(;i.start<0;)i.start+=this._bufferService.cols,e[1]--;this._model.selectionStart=[i.start,e[1]],this._model.selectionStartLength=i.length}}_selectToWordAt(e){let t=this._getWordAt(e,!0);if(t){let i=e[1];for(;t.start<0;)t.start+=this._bufferService.cols,i--;if(!this._model.areSelectionValuesReversed())for(;t.start+t.length>this._bufferService.cols;)t.length-=this._bufferService.cols,i++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?t.start:t.start+t.length,i]}}_isCharWordSeparator(e){return e.getWidth()===0?!1:this._optionsService.rawOptions.wordSeparator.indexOf(e.getChars())>=0}_selectLineAt(e){let t=this._bufferService.buffer.getWrappedRangeForLine(e),i={start:{x:0,y:t.first},end:{x:this._bufferService.cols-1,y:t.last}};this._model.selectionStart=[0,t.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=Rm(i,this._bufferService.cols)}};Iu=Me([Z(3,vt),Z(4,Vr),Z(5,Xu),Z(6,yt),Z(7,Oi),Z(8,Pi)],Iu);var Fm=class{constructor(){this._data={}}set(e,t,i){this._data[e]||(this._data[e]={}),this._data[e][t]=i}get(e,t){return this._data[e]?this._data[e][t]:void 0}clear(){this._data={}}},Pm=class{constructor(){this._color=new Fm,this._css=new Fm}setCss(e,t,i){this._css.set(e,t,i)}getCss(e,t){return this._css.get(e,t)}setColor(e,t,i){this._color.set(e,t,i)}getColor(e,t){return this._color.get(e,t)}clear(){this._color.clear(),this._css.clear()}},We=Object.freeze((()=>{let e=[Le.toColor("#2e3436"),Le.toColor("#cc0000"),Le.toColor("#4e9a06"),Le.toColor("#c4a000"),Le.toColor("#3465a4"),Le.toColor("#75507b"),Le.toColor("#06989a"),Le.toColor("#d3d7cf"),Le.toColor("#555753"),Le.toColor("#ef2929"),Le.toColor("#8ae234"),Le.toColor("#fce94f"),Le.toColor("#729fcf"),Le.toColor("#ad7fa8"),Le.toColor("#34e2e2"),Le.toColor("#eeeeec")],t=[0,95,135,175,215,255];for(let i=0;i<216;i++){let r=t[i/36%6|0],s=t[i/6%6|0],n=t[i%6];e.push({css:Qe.toCss(r,s,n),rgba:Qe.toRgba(r,s,n)})}for(let i=0;i<24;i++){let r=8+i*10;e.push({css:Qe.toCss(r,r,r),rgba:Qe.toRgba(r,r,r)})}return e})()),zr=Le.toColor("#ffffff"),Kn=Le.toColor("#000000"),Om=Le.toColor("#ffffff"),Km=Kn,Mn={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117},VE=zr,Mu=class extends oe{constructor(e){super(),this._optionsService=e,this._contrastCache=new Pm,this._halfContrastCache=new Pm,this._onChangeColors=this._register(new Y),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:zr,background:Kn,cursor:Om,cursorAccent:Km,selectionForeground:void 0,selectionBackgroundTransparent:Mn,selectionBackgroundOpaque:we.blend(Kn,Mn),selectionInactiveBackgroundTransparent:Mn,selectionInactiveBackgroundOpaque:we.blend(Kn,Mn),scrollbarSliderBackground:we.opacity(zr,.2),scrollbarSliderHoverBackground:we.opacity(zr,.4),scrollbarSliderActiveBackground:we.opacity(zr,.5),overviewRulerBorder:zr,ansi:We.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this._register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this._register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}get colors(){return this._colors}_setTheme(e={}){let t=this._colors;if(t.foreground=ge(e.foreground,zr),t.background=ge(e.background,Kn),t.cursor=we.blend(t.background,ge(e.cursor,Om)),t.cursorAccent=we.blend(t.background,ge(e.cursorAccent,Km)),t.selectionBackgroundTransparent=ge(e.selectionBackground,Mn),t.selectionBackgroundOpaque=we.blend(t.background,t.selectionBackgroundTransparent),t.selectionInactiveBackgroundTransparent=ge(e.selectionInactiveBackground,t.selectionBackgroundTransparent),t.selectionInactiveBackgroundOpaque=we.blend(t.background,t.selectionInactiveBackgroundTransparent),t.selectionForeground=e.selectionForeground?ge(e.selectionForeground,Im):void 0,t.selectionForeground===Im&&(t.selectionForeground=void 0),we.isOpaque(t.selectionBackgroundTransparent)&&(t.selectionBackgroundTransparent=we.opacity(t.selectionBackgroundTransparent,.3)),we.isOpaque(t.selectionInactiveBackgroundTransparent)&&(t.selectionInactiveBackgroundTransparent=we.opacity(t.selectionInactiveBackgroundTransparent,.3)),t.scrollbarSliderBackground=ge(e.scrollbarSliderBackground,we.opacity(t.foreground,.2)),t.scrollbarSliderHoverBackground=ge(e.scrollbarSliderHoverBackground,we.opacity(t.foreground,.4)),t.scrollbarSliderActiveBackground=ge(e.scrollbarSliderActiveBackground,we.opacity(t.foreground,.5)),t.overviewRulerBorder=ge(e.overviewRulerBorder,VE),t.ansi=We.slice(),t.ansi[0]=ge(e.black,We[0]),t.ansi[1]=ge(e.red,We[1]),t.ansi[2]=ge(e.green,We[2]),t.ansi[3]=ge(e.yellow,We[3]),t.ansi[4]=ge(e.blue,We[4]),t.ansi[5]=ge(e.magenta,We[5]),t.ansi[6]=ge(e.cyan,We[6]),t.ansi[7]=ge(e.white,We[7]),t.ansi[8]=ge(e.brightBlack,We[8]),t.ansi[9]=ge(e.brightRed,We[9]),t.ansi[10]=ge(e.brightGreen,We[10]),t.ansi[11]=ge(e.brightYellow,We[11]),t.ansi[12]=ge(e.brightBlue,We[12]),t.ansi[13]=ge(e.brightMagenta,We[13]),t.ansi[14]=ge(e.brightCyan,We[14]),t.ansi[15]=ge(e.brightWhite,We[15]),e.extendedAnsi){let i=Math.min(t.ansi.length-16,e.extendedAnsi.length);for(let r=0;r<i;r++)t.ansi[r+16]=ge(e.extendedAnsi[r],We[r+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(e){this._restoreColor(e),this._onChangeColors.fire(this.colors)}_restoreColor(e){if(e===void 0){for(let t=0;t<this._restoreColors.ansi.length;++t)this._colors.ansi[t]=this._restoreColors.ansi[t];return}switch(e){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[e]=this._restoreColors.ansi[e]}}modifyColors(e){e(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};Mu=Me([Z(0,yt)],Mu);function ge(e,t){if(e!==void 0)try{return Le.toColor(e)}catch{}return t}var YE=class{constructor(...e){this._entries=new Map;for(let[t,i]of e)this.set(t,i)}set(e,t){let i=this._entries.get(e);return this._entries.set(e,t),i}forEach(e){for(let[t,i]of this._entries.entries())e(t,i)}has(e){return this._entries.has(e)}get(e){return this._entries.get(e)}},JE=class{constructor(){this._services=new YE,this._services.set(Hu,this)}setService(e,t){this._services.set(e,t)}getService(e){return this._services.get(e)}createInstance(e,...t){let i=v5(e).sort((n,o)=>n.index-o.index),r=[];for(let n of i){let o=this._services.get(n.id);if(!o)throw new Error(`[createInstance] ${e.name} depends on UNKNOWN service ${n.id._id}.`);r.push(o)}let s=i.length>0?i[0].index:t.length;if(t.length!==s)throw new Error(`[createInstance] First service dependency of ${e.name} at position ${s+1} conflicts with ${t.length} static arguments`);return new e(...t,...r)}},ZE={trace:0,debug:1,info:2,warn:3,error:4,off:5},e3="xterm.js: ",Tu=class extends oe{constructor(e){super(),this._optionsService=e,this._logLevel=5,this._updateLogLevel(),this._register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),t3=this}get logLevel(){return this._logLevel}_updateLogLevel(){this._logLevel=ZE[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(e){for(let t=0;t<e.length;t++)typeof e[t]=="function"&&(e[t]=e[t]())}_log(e,t,i){this._evalLazyOptionalParams(i),e.call(console,(this._optionsService.options.logger?"":e3)+t,...i)}trace(e,...t){this._logLevel<=0&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,e,t)}debug(e,...t){this._logLevel<=1&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,e,t)}info(e,...t){this._logLevel<=2&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,e,t)}warn(e,...t){this._logLevel<=3&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,e,t)}error(e,...t){this._logLevel<=4&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,e,t)}};Tu=Me([Z(0,yt)],Tu);var t3,Nm=class extends oe{constructor(e){super(),this._maxLength=e,this.onDeleteEmitter=this._register(new Y),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this._register(new Y),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this._register(new Y),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(e){if(this._maxLength===e)return;let t=new Array(e);for(let i=0;i<Math.min(e,this.length);i++)t[i]=this._array[this._getCyclicIndex(i)];this._array=t,this._maxLength=e,this._startIndex=0}get length(){return this._length}set length(e){if(e>this._length)for(let t=this._length;t<e;t++)this._array[t]=void 0;this._length=e}get(e){return this._array[this._getCyclicIndex(e)]}set(e,t){this._array[this._getCyclicIndex(e)]=t}push(e){this._array[this._getCyclicIndex(this._length)]=e,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(e,t,...i){if(t){for(let r=e;r<this._length-t;r++)this._array[this._getCyclicIndex(r)]=this._array[this._getCyclicIndex(r+t)];this._length-=t,this.onDeleteEmitter.fire({index:e,amount:t})}for(let r=this._length-1;r>=e;r--)this._array[this._getCyclicIndex(r+i.length)]=this._array[this._getCyclicIndex(r)];for(let r=0;r<i.length;r++)this._array[this._getCyclicIndex(e+r)]=i[r];if(i.length&&this.onInsertEmitter.fire({index:e,amount:i.length}),this._length+i.length>this._maxLength){let r=this._length+i.length-this._maxLength;this._startIndex+=r,this._length=this._maxLength,this.onTrimEmitter.fire(r)}else this._length+=i.length}trimStart(e){e>this._length&&(e=this._length),this._startIndex+=e,this._length-=e,this.onTrimEmitter.fire(e)}shiftElements(e,t,i){if(!(t<=0)){if(e<0||e>=this._length)throw new Error("start argument out of range");if(e+i<0)throw new Error("Cannot shift elements in list beyond index 0");if(i>0){for(let s=t-1;s>=0;s--)this.set(e+s+i,this.get(e+s));let r=e+t+i-this._length;if(r>0)for(this._length+=r;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let r=0;r<t;r++)this.set(e+r+i,this.get(e+r))}}_getCyclicIndex(e){return(this._startIndex+e)%this._maxLength}},ae=3,Ne=Object.freeze(new jn),Oa=0,Yc=2,Nn=class Zv{constructor(t,i,r=!1){this.isWrapped=r,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(t*ae);let s=i||$t.fromCharData([0,hv,1,0]);for(let n=0;n<t;++n)this.setCell(n,s);this.length=t}get(t){let i=this._data[t*ae+0],r=i&2097151;return[this._data[t*ae+1],i&2097152?this._combined[t]:r?vr(r):"",i>>22,i&2097152?this._combined[t].charCodeAt(this._combined[t].length-1):r]}set(t,i){this._data[t*ae+1]=i[0],i[1].length>1?(this._combined[t]=i[1],this._data[t*ae+0]=t|2097152|i[2]<<22):this._data[t*ae+0]=i[1].charCodeAt(0)|i[2]<<22}getWidth(t){return this._data[t*ae+0]>>22}hasWidth(t){return this._data[t*ae+0]&12582912}getFg(t){return this._data[t*ae+1]}getBg(t){return this._data[t*ae+2]}hasContent(t){return this._data[t*ae+0]&4194303}getCodePoint(t){let i=this._data[t*ae+0];return i&2097152?this._combined[t].charCodeAt(this._combined[t].length-1):i&2097151}isCombined(t){return this._data[t*ae+0]&2097152}getString(t){let i=this._data[t*ae+0];return i&2097152?this._combined[t]:i&2097151?vr(i&2097151):""}isProtected(t){return this._data[t*ae+2]&536870912}loadCell(t,i){return Oa=t*ae,i.content=this._data[Oa+0],i.fg=this._data[Oa+1],i.bg=this._data[Oa+2],i.content&2097152&&(i.combinedData=this._combined[t]),i.bg&268435456&&(i.extended=this._extendedAttrs[t]),i}setCell(t,i){i.content&2097152&&(this._combined[t]=i.combinedData),i.bg&268435456&&(this._extendedAttrs[t]=i.extended),this._data[t*ae+0]=i.content,this._data[t*ae+1]=i.fg,this._data[t*ae+2]=i.bg}setCellFromCodepoint(t,i,r,s){s.bg&268435456&&(this._extendedAttrs[t]=s.extended),this._data[t*ae+0]=i|r<<22,this._data[t*ae+1]=s.fg,this._data[t*ae+2]=s.bg}addCodepointToCell(t,i,r){let s=this._data[t*ae+0];s&2097152?this._combined[t]+=vr(i):s&2097151?(this._combined[t]=vr(s&2097151)+vr(i),s&=-2097152,s|=2097152):s=i|1<<22,r&&(s&=-12582913,s|=r<<22),this._data[t*ae+0]=s}insertCells(t,i,r){if(t%=this.length,t&&this.getWidth(t-1)===2&&this.setCellFromCodepoint(t-1,0,1,r),i<this.length-t){let s=new $t;for(let n=this.length-t-i-1;n>=0;--n)this.setCell(t+i+n,this.loadCell(t+n,s));for(let n=0;n<i;++n)this.setCell(t+n,r)}else for(let s=t;s<this.length;++s)this.setCell(s,r);this.getWidth(this.length-1)===2&&this.setCellFromCodepoint(this.length-1,0,1,r)}deleteCells(t,i,r){if(t%=this.length,i<this.length-t){let s=new $t;for(let n=0;n<this.length-t-i;++n)this.setCell(t+n,this.loadCell(t+i+n,s));for(let n=this.length-i;n<this.length;++n)this.setCell(n,r)}else for(let s=t;s<this.length;++s)this.setCell(s,r);t&&this.getWidth(t-1)===2&&this.setCellFromCodepoint(t-1,0,1,r),this.getWidth(t)===0&&!this.hasContent(t)&&this.setCellFromCodepoint(t,0,1,r)}replaceCells(t,i,r,s=!1){if(s){for(t&&this.getWidth(t-1)===2&&!this.isProtected(t-1)&&this.setCellFromCodepoint(t-1,0,1,r),i<this.length&&this.getWidth(i-1)===2&&!this.isProtected(i)&&this.setCellFromCodepoint(i,0,1,r);t<i&&t<this.length;)this.isProtected(t)||this.setCell(t,r),t++;return}for(t&&this.getWidth(t-1)===2&&this.setCellFromCodepoint(t-1,0,1,r),i<this.length&&this.getWidth(i-1)===2&&this.setCellFromCodepoint(i,0,1,r);t<i&&t<this.length;)this.setCell(t++,r)}resize(t,i){if(t===this.length)return this._data.length*4*Yc<this._data.buffer.byteLength;let r=t*ae;if(t>this.length){if(this._data.buffer.byteLength>=r*4)this._data=new Uint32Array(this._data.buffer,0,r);else{let s=new Uint32Array(r);s.set(this._data),this._data=s}for(let s=this.length;s<t;++s)this.setCell(s,i)}else{this._data=this._data.subarray(0,r);let s=Object.keys(this._combined);for(let o=0;o<s.length;o++){let a=parseInt(s[o],10);a>=t&&delete this._combined[a]}let n=Object.keys(this._extendedAttrs);for(let o=0;o<n.length;o++){let a=parseInt(n[o],10);a>=t&&delete this._extendedAttrs[a]}}return this.length=t,r*4*Yc<this._data.buffer.byteLength}cleanupMemory(){if(this._data.length*4*Yc<this._data.buffer.byteLength){let t=new Uint32Array(this._data.length);return t.set(this._data),this._data=t,1}return 0}fill(t,i=!1){if(i){for(let r=0;r<this.length;++r)this.isProtected(r)||this.setCell(r,t);return}this._combined={},this._extendedAttrs={};for(let r=0;r<this.length;++r)this.setCell(r,t)}copyFrom(t){this.length!==t.length?this._data=new Uint32Array(t._data):this._data.set(t._data),this.length=t.length,this._combined={};for(let i in t._combined)this._combined[i]=t._combined[i];this._extendedAttrs={};for(let i in t._extendedAttrs)this._extendedAttrs[i]=t._extendedAttrs[i];this.isWrapped=t.isWrapped}clone(){let t=new Zv(0);t._data=new Uint32Array(this._data),t.length=this.length;for(let i in this._combined)t._combined[i]=this._combined[i];for(let i in this._extendedAttrs)t._extendedAttrs[i]=this._extendedAttrs[i];return t.isWrapped=this.isWrapped,t}getTrimmedLength(){for(let t=this.length-1;t>=0;--t)if(this._data[t*ae+0]&4194303)return t+(this._data[t*ae+0]>>22);return 0}getNoBgTrimmedLength(){for(let t=this.length-1;t>=0;--t)if(this._data[t*ae+0]&4194303||this._data[t*ae+2]&50331648)return t+(this._data[t*ae+0]>>22);return 0}copyCellsFrom(t,i,r,s,n){let o=t._data;if(n)for(let h=s-1;h>=0;h--){for(let l=0;l<ae;l++)this._data[(r+h)*ae+l]=o[(i+h)*ae+l];o[(i+h)*ae+2]&268435456&&(this._extendedAttrs[r+h]=t._extendedAttrs[i+h])}else for(let h=0;h<s;h++){for(let l=0;l<ae;l++)this._data[(r+h)*ae+l]=o[(i+h)*ae+l];o[(i+h)*ae+2]&268435456&&(this._extendedAttrs[r+h]=t._extendedAttrs[i+h])}let a=Object.keys(t._combined);for(let h=0;h<a.length;h++){let l=parseInt(a[h],10);l>=i&&(this._combined[l-i+r]=t._combined[l])}}translateToString(t,i,r,s){i=i??0,r=r??this.length,t&&(r=Math.min(r,this.getTrimmedLength())),s&&(s.length=0);let n="";for(;i<r;){let o=this._data[i*ae+0],a=o&2097151,h=o&2097152?this._combined[i]:a?vr(a):yr;if(n+=h,s)for(let l=0;l<h.length;++l)s.push(i);i+=o>>22||1}return s&&s.push(i),n}};function i3(e,t,i,r,s,n){let o=[];for(let a=0;a<e.length-1;a++){let h=a,l=e.get(++h);if(!l.isWrapped)continue;let c=[e.get(a)];for(;h<e.length&&l.isWrapped;)c.push(l),l=e.get(++h);if(!n&&r>=a&&r<h){a+=c.length-1;continue}let u=0,g=Gn(c,u,t),_=1,m=0;for(;_<c.length;){let x=Gn(c,_,t),E=x-m,M=i-g,D=Math.min(E,M);c[u].copyCellsFrom(c[_],m,g,D,!1),g+=D,g===i&&(u++,g=0),m+=D,m===x&&(_++,m=0),g===0&&u!==0&&c[u-1].getWidth(i-1)===2&&(c[u].copyCellsFrom(c[u-1],i-1,g++,1,!1),c[u-1].setCell(i-1,s))}c[u].replaceCells(g,i,s);let v=0;for(let x=c.length-1;x>0&&(x>u||c[x].getTrimmedLength()===0);x--)v++;v>0&&(o.push(a+c.length-v),o.push(v)),a+=c.length-1}return o}function r3(e,t){let i=[],r=0,s=t[r],n=0;for(let o=0;o<e.length;o++)if(s===o){let a=t[++r];e.onDeleteEmitter.fire({index:o-n,amount:a}),o+=a-1,n+=a,s=t[++r]}else i.push(o);return{layout:i,countRemoved:n}}function s3(e,t){let i=[];for(let r=0;r<t.length;r++)i.push(e.get(t[r]));for(let r=0;r<i.length;r++)e.set(r,i[r]);e.length=t.length}function n3(e,t,i){let r=[],s=e.map((h,l)=>Gn(e,l,t)).reduce((h,l)=>h+l),n=0,o=0,a=0;for(;a<s;){if(s-a<i){r.push(s-a);break}n+=i;let h=Gn(e,o,t);n>h&&(n-=h,o++);let l=e[o].getWidth(n-1)===2;l&&n--;let c=l?i-1:i;r.push(c),a+=c}return r}function Gn(e,t,i){if(t===e.length-1)return e[t].getTrimmedLength();let r=!e[t].hasContent(i-1)&&e[t].getWidth(i-1)===1,s=e[t+1].getWidth(0)===2;return r&&s?i-1:i}var e1=class t1{constructor(t){this.line=t,this.isDisposed=!1,this._disposables=[],this._id=t1._nextId++,this._onDispose=this.register(new Y),this.onDispose=this._onDispose.event}get id(){return this._id}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),jr(this._disposables),this._disposables.length=0)}register(t){return this._disposables.push(t),t}};e1._nextId=1;var o3=e1,Ge={},Wr=Ge.B;Ge[0]={"`":"\u25C6",a:"\u2592",b:"\u2409",c:"\u240C",d:"\u240D",e:"\u240A",f:"\xB0",g:"\xB1",h:"\u2424",i:"\u240B",j:"\u2518",k:"\u2510",l:"\u250C",m:"\u2514",n:"\u253C",o:"\u23BA",p:"\u23BB",q:"\u2500",r:"\u23BC",s:"\u23BD",t:"\u251C",u:"\u2524",v:"\u2534",w:"\u252C",x:"\u2502",y:"\u2264",z:"\u2265","{":"\u03C0","|":"\u2260","}":"\xA3","~":"\xB7"};Ge.A={"#":"\xA3"};Ge.B=void 0;Ge[4]={"#":"\xA3","@":"\xBE","[":"ij","\\":"\xBD","]":"|","{":"\xA8","|":"f","}":"\xBC","~":"\xB4"};Ge.C=Ge[5]={"[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"};Ge.R={"#":"\xA3","@":"\xE0","[":"\xB0","\\":"\xE7","]":"\xA7","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xA8"};Ge.Q={"@":"\xE0","[":"\xE2","\\":"\xE7","]":"\xEA","^":"\xEE","`":"\xF4","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xFB"};Ge.K={"@":"\xA7","[":"\xC4","\\":"\xD6","]":"\xDC","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xDF"};Ge.Y={"#":"\xA3","@":"\xA7","[":"\xB0","\\":"\xE7","]":"\xE9","`":"\xF9","{":"\xE0","|":"\xF2","}":"\xE8","~":"\xEC"};Ge.E=Ge[6]={"@":"\xC4","[":"\xC6","\\":"\xD8","]":"\xC5","^":"\xDC","`":"\xE4","{":"\xE6","|":"\xF8","}":"\xE5","~":"\xFC"};Ge.Z={"#":"\xA3","@":"\xA7","[":"\xA1","\\":"\xD1","]":"\xBF","{":"\xB0","|":"\xF1","}":"\xE7"};Ge.H=Ge[7]={"@":"\xC9","[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"};Ge["="]={"#":"\xF9","@":"\xE0","[":"\xE9","\\":"\xE7","]":"\xEA","^":"\xEE",_:"\xE8","`":"\xF4","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xFB"};var Qm=4294967295,Hm=class{constructor(e,t,i){this._hasScrollback=e,this._optionsService=t,this._bufferService=i,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=Ne.clone(),this.savedCharset=Wr,this.markers=[],this._nullCell=$t.fromCharData([0,hv,1,0]),this._whitespaceCell=$t.fromCharData([0,yr,1,32]),this._isClearing=!1,this._memoryCleanupQueue=new tl,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new Nm(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(e){return e?(this._nullCell.fg=e.fg,this._nullCell.bg=e.bg,this._nullCell.extended=e.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new ja),this._nullCell}getWhitespaceCell(e){return e?(this._whitespaceCell.fg=e.fg,this._whitespaceCell.bg=e.bg,this._whitespaceCell.extended=e.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new ja),this._whitespaceCell}getBlankLine(e,t){return new Nn(this._bufferService.cols,this.getNullCell(e),t)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){let e=this.ybase+this.y-this.ydisp;return e>=0&&e<this._rows}_getCorrectBufferLength(e){if(!this._hasScrollback)return e;let t=e+this._optionsService.rawOptions.scrollback;return t>Qm?Qm:t}fillViewportRows(e){if(this.lines.length===0){e===void 0&&(e=Ne);let t=this._rows;for(;t--;)this.lines.push(this.getBlankLine(e))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new Nm(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(e,t){let i=this.getNullCell(Ne),r=0,s=this._getCorrectBufferLength(t);if(s>this.lines.maxLength&&(this.lines.maxLength=s),this.lines.length>0){if(this._cols<e)for(let o=0;o<this.lines.length;o++)r+=+this.lines.get(o).resize(e,i);let n=0;if(this._rows<t)for(let o=this._rows;o<t;o++)this.lines.length<t+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new Nn(e,i)):this.ybase>0&&this.lines.length<=this.ybase+this.y+n+1?(this.ybase--,n++,this.ydisp>0&&this.ydisp--):this.lines.push(new Nn(e,i)));else for(let o=this._rows;o>t;o--)this.lines.length>t+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(s<this.lines.maxLength){let o=this.lines.length-s;o>0&&(this.lines.trimStart(o),this.ybase=Math.max(this.ybase-o,0),this.ydisp=Math.max(this.ydisp-o,0),this.savedY=Math.max(this.savedY-o,0)),this.lines.maxLength=s}this.x=Math.min(this.x,e-1),this.y=Math.min(this.y,t-1),n&&(this.y+=n),this.savedX=Math.min(this.savedX,e-1),this.scrollTop=0}if(this.scrollBottom=t-1,this._isReflowEnabled&&(this._reflow(e,t),this._cols>e))for(let n=0;n<this.lines.length;n++)r+=+this.lines.get(n).resize(e,i);this._cols=e,this._rows=t,this._memoryCleanupQueue.clear(),r>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let e=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,e=!1);let t=0;for(;this._memoryCleanupPosition<this.lines.length;)if(t+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),t>100)return!0;return e}get _isReflowEnabled(){let e=this._optionsService.rawOptions.windowsPty;return e&&e.buildNumber?this._hasScrollback&&e.backend==="conpty"&&e.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(e,t){this._cols!==e&&(e>this._cols?this._reflowLarger(e,t):this._reflowSmaller(e,t))}_reflowLarger(e,t){let i=this._optionsService.rawOptions.reflowCursorLine,r=i3(this.lines,this._cols,e,this.ybase+this.y,this.getNullCell(Ne),i);if(r.length>0){let s=r3(this.lines,r);s3(this.lines,s.layout),this._reflowLargerAdjustViewport(e,t,s.countRemoved)}}_reflowLargerAdjustViewport(e,t,i){let r=this.getNullCell(Ne),s=i;for(;s-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<t&&this.lines.push(new Nn(e,r))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-i,0)}_reflowSmaller(e,t){let i=this._optionsService.rawOptions.reflowCursorLine,r=this.getNullCell(Ne),s=[],n=0;for(let o=this.lines.length-1;o>=0;o--){let a=this.lines.get(o);if(!a||!a.isWrapped&&a.getTrimmedLength()<=e)continue;let h=[a];for(;a.isWrapped&&o>0;)a=this.lines.get(--o),h.unshift(a);if(!i){let D=this.ybase+this.y;if(D>=o&&D<o+h.length)continue}let l=h[h.length-1].getTrimmedLength(),c=n3(h,this._cols,e),u=c.length-h.length,g;this.ybase===0&&this.y!==this.lines.length-1?g=Math.max(0,this.y-this.lines.maxLength+u):g=Math.max(0,this.lines.length-this.lines.maxLength+u);let _=[];for(let D=0;D<u;D++){let b=this.getBlankLine(Ne,!0);_.push(b)}_.length>0&&(s.push({start:o+h.length+n,newLines:_}),n+=_.length),h.push(..._);let m=c.length-1,v=c[m];v===0&&(m--,v=c[m]);let x=h.length-u-1,E=l;for(;x>=0;){let D=Math.min(E,v);if(h[m]===void 0)break;if(h[m].copyCellsFrom(h[x],E-D,v-D,D,!0),v-=D,v===0&&(m--,v=c[m]),E-=D,E===0){x--;let b=Math.max(x,0);E=Gn(h,b,this._cols)}}for(let D=0;D<h.length;D++)c[D]<e&&h[D].setCell(c[D],r);let M=u-g;for(;M-- >0;)this.ybase===0?this.y<t-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+n)-t&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+u,this.ybase+t-1)}if(s.length>0){let o=[],a=[];for(let v=0;v<this.lines.length;v++)a.push(this.lines.get(v));let h=this.lines.length,l=h-1,c=0,u=s[c];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+n);let g=0;for(let v=Math.min(this.lines.maxLength-1,h+n-1);v>=0;v--)if(u&&u.start>l+g){for(let x=u.newLines.length-1;x>=0;x--)this.lines.set(v--,u.newLines[x]);v++,o.push({index:l+1,amount:u.newLines.length}),g+=u.newLines.length,u=s[++c]}else this.lines.set(v,a[l--]);let _=0;for(let v=o.length-1;v>=0;v--)o[v].index+=_,this.lines.onInsertEmitter.fire(o[v]),_+=o[v].amount;let m=Math.max(0,h+n-this.lines.maxLength);m>0&&this.lines.onTrimEmitter.fire(m)}}translateBufferLineToString(e,t,i=0,r){let s=this.lines.get(e);return s?s.translateToString(t,i,r):""}getWrappedRangeForLine(e){let t=e,i=e;for(;t>0&&this.lines.get(t).isWrapped;)t--;for(;i+1<this.lines.length&&this.lines.get(i+1).isWrapped;)i++;return{first:t,last:i}}setupTabStops(e){for(e!=null?this.tabs[e]||(e=this.prevStop(e)):(this.tabs={},e=0);e<this._cols;e+=this._optionsService.rawOptions.tabStopWidth)this.tabs[e]=!0}prevStop(e){for(e==null&&(e=this.x);!this.tabs[--e]&&e>0;);return e>=this._cols?this._cols-1:e<0?0:e}nextStop(e){for(e==null&&(e=this.x);!this.tabs[++e]&&e<this._cols;);return e>=this._cols?this._cols-1:e<0?0:e}clearMarkers(e){this._isClearing=!0;for(let t=0;t<this.markers.length;t++)this.markers[t].line===e&&(this.markers[t].dispose(),this.markers.splice(t--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let e=0;e<this.markers.length;e++)this.markers[e].dispose();this.markers.length=0,this._isClearing=!1}addMarker(e){let t=new o3(e);return this.markers.push(t),t.register(this.lines.onTrim(i=>{t.line-=i,t.line<0&&t.dispose()})),t.register(this.lines.onInsert(i=>{t.line>=i.index&&(t.line+=i.amount)})),t.register(this.lines.onDelete(i=>{t.line>=i.index&&t.line<i.index+i.amount&&t.dispose(),t.line>i.index&&(t.line-=i.amount)})),t.register(t.onDispose(()=>this._removeMarker(t))),t}_removeMarker(e){this._isClearing||this.markers.splice(this.markers.indexOf(e),1)}},a3=class extends oe{constructor(e,t){super(),this._optionsService=e,this._bufferService=t,this._onBufferActivate=this._register(new Y),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this._register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this._register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new Hm(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new Hm(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(e){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(e),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(e,t){this._normal.resize(e,t),this._alt.resize(e,t),this.setupTabStops(e)}setupTabStops(e){this._normal.setupTabStops(e),this._alt.setupTabStops(e)}},i1=2,r1=1,Ru=class extends oe{constructor(e){super(),this.isUserScrolling=!1,this._onResize=this._register(new Y),this.onResize=this._onResize.event,this._onScroll=this._register(new Y),this.onScroll=this._onScroll.event,this.cols=Math.max(e.rawOptions.cols||0,i1),this.rows=Math.max(e.rawOptions.rows||0,r1),this.buffers=this._register(new a3(e,this)),this._register(this.buffers.onBufferActivate(t=>{this._onScroll.fire(t.activeBuffer.ydisp)}))}get buffer(){return this.buffers.active}resize(e,t){let i=this.cols!==e,r=this.rows!==t;this.cols=e,this.rows=t,this.buffers.resize(e,t),this._onResize.fire({cols:e,rows:t,colsChanged:i,rowsChanged:r})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(e,t=!1){let i=this.buffer,r;r=this._cachedBlankLine,(!r||r.length!==this.cols||r.getFg(0)!==e.fg||r.getBg(0)!==e.bg)&&(r=i.getBlankLine(e,t),this._cachedBlankLine=r),r.isWrapped=t;let s=i.ybase+i.scrollTop,n=i.ybase+i.scrollBottom;if(i.scrollTop===0){let o=i.lines.isFull;n===i.lines.length-1?o?i.lines.recycle().copyFrom(r):i.lines.push(r.clone()):i.lines.splice(n+1,0,r.clone()),o?this.isUserScrolling&&(i.ydisp=Math.max(i.ydisp-1,0)):(i.ybase++,this.isUserScrolling||i.ydisp++)}else{let o=n-s+1;i.lines.shiftElements(s+1,o-1,-1),i.lines.set(n,r.clone())}this.isUserScrolling||(i.ydisp=i.ybase),this._onScroll.fire(i.ydisp)}scrollLines(e,t){let i=this.buffer;if(e<0){if(i.ydisp===0)return;this.isUserScrolling=!0}else e+i.ydisp>=i.ybase&&(this.isUserScrolling=!1);let r=i.ydisp;i.ydisp=Math.max(Math.min(i.ydisp+e,i.ybase),0),r!==i.ydisp&&(t||this._onScroll.fire(i.ydisp))}};Ru=Me([Z(0,yt)],Ru);var As={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnEraseInDisplay:!1,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},reflowCursorLine:!1,rescaleOverlappingGlyphs:!1,rightClickSelectsWord:el,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRuler:{}},l3=["normal","bold","100","200","300","400","500","600","700","800","900"],h3=class extends oe{constructor(e){super(),this._onOptionChange=this._register(new Y),this.onOptionChange=this._onOptionChange.event;let t={...As};for(let i in e)if(i in t)try{let r=e[i];t[i]=this._sanitizeAndValidateOption(i,r)}catch(r){console.error(r)}this.rawOptions=t,this.options={...t},this._setupOptions(),this._register(Ae(()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null}))}onSpecificOptionChange(e,t){return this.onOptionChange(i=>{i===e&&t(this.rawOptions[e])})}onMultipleOptionChange(e,t){return this.onOptionChange(i=>{e.indexOf(i)!==-1&&t()})}_setupOptions(){let e=i=>{if(!(i in As))throw new Error(`No option with key "${i}"`);return this.rawOptions[i]},t=(i,r)=>{if(!(i in As))throw new Error(`No option with key "${i}"`);r=this._sanitizeAndValidateOption(i,r),this.rawOptions[i]!==r&&(this.rawOptions[i]=r,this._onOptionChange.fire(i))};for(let i in this.rawOptions){let r={get:e.bind(this,i),set:t.bind(this,i)};Object.defineProperty(this.options,i,r)}}_sanitizeAndValidateOption(e,t){switch(e){case"cursorStyle":if(t||(t=As[e]),!c3(t))throw new Error(`"${t}" is not a valid value for ${e}`);break;case"wordSeparator":t||(t=As[e]);break;case"fontWeight":case"fontWeightBold":if(typeof t=="number"&&1<=t&&t<=1e3)break;t=l3.includes(t)?t:As[e];break;case"cursorWidth":t=Math.floor(t);case"lineHeight":case"tabStopWidth":if(t<1)throw new Error(`${e} cannot be less than 1, value: ${t}`);break;case"minimumContrastRatio":t=Math.max(1,Math.min(21,Math.round(t*10)/10));break;case"scrollback":if(t=Math.min(t,4294967295),t<0)throw new Error(`${e} cannot be less than 0, value: ${t}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(t<=0)throw new Error(`${e} cannot be less than or equal to 0, value: ${t}`);break;case"rows":case"cols":if(!t&&t!==0)throw new Error(`${e} must be numeric, value: ${t}`);break;case"windowsPty":t=t??{};break}return t}};function c3(e){return e==="block"||e==="underline"||e==="bar"}function Qn(e,t=5){if(typeof e!="object")return e;let i=Array.isArray(e)?[]:{};for(let r in e)i[r]=t<=1?e[r]:e[r]&&Qn(e[r],t-1);return i}var Xm=Object.freeze({insertMode:!1}),Um=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,cursorBlink:void 0,cursorStyle:void 0,origin:!1,reverseWraparound:!1,sendFocus:!1,synchronizedOutput:!1,wraparound:!0}),Fu=class extends oe{constructor(e,t,i){super(),this._bufferService=e,this._logService=t,this._optionsService=i,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this._register(new Y),this.onData=this._onData.event,this._onUserInput=this._register(new Y),this.onUserInput=this._onUserInput.event,this._onBinary=this._register(new Y),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this._register(new Y),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=Qn(Xm),this.decPrivateModes=Qn(Um)}reset(){this.modes=Qn(Xm),this.decPrivateModes=Qn(Um)}triggerDataEvent(e,t=!1){if(this._optionsService.rawOptions.disableStdin)return;let i=this._bufferService.buffer;t&&this._optionsService.rawOptions.scrollOnUserInput&&i.ybase!==i.ydisp&&this._onRequestScrollToBottom.fire(),t&&this._onUserInput.fire(),this._logService.debug(`sending data "${e}"`),this._logService.trace("sending data (codes)",()=>e.split("").map(r=>r.charCodeAt(0))),this._onData.fire(e)}triggerBinaryEvent(e){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${e}"`),this._logService.trace("sending binary (codes)",()=>e.split("").map(t=>t.charCodeAt(0))),this._onBinary.fire(e))}};Fu=Me([Z(0,vt),Z(1,_v),Z(2,yt)],Fu);var zm={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:e=>e.button===4||e.action!==1?!1:(e.ctrl=!1,e.alt=!1,e.shift=!1,!0)},VT200:{events:19,restrict:e=>e.action!==32},DRAG:{events:23,restrict:e=>!(e.action===32&&e.button===3)},ANY:{events:31,restrict:e=>!0}};function Jc(e,t){let i=(e.ctrl?16:0)|(e.shift?4:0)|(e.alt?8:0);return e.button===4?(i|=64,i|=e.action):(i|=e.button&3,e.button&4&&(i|=64),e.button&8&&(i|=128),e.action===32?i|=32:e.action===0&&!t&&(i|=3)),i}var Zc=String.fromCharCode,Wm={DEFAULT:e=>{let t=[Jc(e,!1)+32,e.col+32,e.row+32];return t[0]>255||t[1]>255||t[2]>255?"":`\x1B[M${Zc(t[0])}${Zc(t[1])}${Zc(t[2])}`},SGR:e=>{let t=e.action===0&&e.button!==4?"m":"M";return`\x1B[<${Jc(e,!0)};${e.col};${e.row}${t}`},SGR_PIXELS:e=>{let t=e.action===0&&e.button!==4?"m":"M";return`\x1B[<${Jc(e,!0)};${e.x};${e.y}${t}`}},Pu=class extends oe{constructor(e,t,i){super(),this._bufferService=e,this._coreService=t,this._optionsService=i,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._wheelPartialScroll=0,this._onProtocolChange=this._register(new Y),this.onProtocolChange=this._onProtocolChange.event;for(let r of Object.keys(zm))this.addProtocol(r,zm[r]);for(let r of Object.keys(Wm))this.addEncoding(r,Wm[r]);this.reset()}addProtocol(e,t){this._protocols[e]=t}addEncoding(e,t){this._encodings[e]=t}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(e){if(!this._protocols[e])throw new Error(`unknown protocol "${e}"`);this._activeProtocol=e,this._onProtocolChange.fire(this._protocols[e].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(e){if(!this._encodings[e])throw new Error(`unknown encoding "${e}"`);this._activeEncoding=e}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null,this._wheelPartialScroll=0}consumeWheelEvent(e,t,i){if(e.deltaY===0||e.shiftKey||t===void 0||i===void 0)return 0;let r=t/i,s=this._applyScrollModifier(e.deltaY,e);return e.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(s/=r+0,Math.abs(e.deltaY)<50&&(s*=.3),this._wheelPartialScroll+=s,s=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):e.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(s*=this._bufferService.rows),s}_applyScrollModifier(e,t){return t.altKey||t.ctrlKey||t.shiftKey?e*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:e*this._optionsService.rawOptions.scrollSensitivity}triggerMouseEvent(e){if(e.col<0||e.col>=this._bufferService.cols||e.row<0||e.row>=this._bufferService.rows||e.button===4&&e.action===32||e.button===3&&e.action!==32||e.button!==4&&(e.action===2||e.action===3)||(e.col++,e.row++,e.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,e,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(e))return!1;let t=this._encodings[this._activeEncoding](e);return t&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(t):this._coreService.triggerDataEvent(t,!0)),this._lastEvent=e,!0}explainEvents(e){return{down:!!(e&1),up:!!(e&2),drag:!!(e&4),move:!!(e&8),wheel:!!(e&16)}}_equalEvents(e,t,i){if(i){if(e.x!==t.x||e.y!==t.y)return!1}else if(e.col!==t.col||e.row!==t.row)return!1;return!(e.button!==t.button||e.action!==t.action||e.ctrl!==t.ctrl||e.alt!==t.alt||e.shift!==t.shift)}};Pu=Me([Z(0,vt),Z(1,Vr),Z(2,yt)],Pu);var eu=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],u3=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],$e;function d3(e,t){let i=0,r=t.length-1,s;if(e<t[0][0]||e>t[r][1])return!1;for(;r>=i;)if(s=i+r>>1,e>t[s][1])i=s+1;else if(e<t[s][0])r=s-1;else return!0;return!1}var f3=class{constructor(){if(this.version="6",!$e){$e=new Uint8Array(65536),$e.fill(1),$e[0]=0,$e.fill(0,1,32),$e.fill(0,127,160),$e.fill(2,4352,4448),$e[9001]=2,$e[9002]=2,$e.fill(2,11904,42192),$e[12351]=1,$e.fill(2,44032,55204),$e.fill(2,63744,64256),$e.fill(2,65040,65050),$e.fill(2,65072,65136),$e.fill(2,65280,65377),$e.fill(2,65504,65511);for(let e=0;e<eu.length;++e)$e.fill(0,eu[e][0],eu[e][1]+1)}}wcwidth(e){return e<32?0:e<127?1:e<65536?$e[e]:d3(e,u3)?0:e>=131072&&e<=196605||e>=196608&&e<=262141?2:1}charProperties(e,t){let i=this.wcwidth(e),r=i===0&&t!==0;if(r){let s=$r.extractWidth(t);s===0?r=!1:s>i&&(i=s)}return $r.createPropertyValue(0,i,r)}},$r=class Ga{constructor(){this._providers=Object.create(null),this._active="",this._onChange=new Y,this.onChange=this._onChange.event;let t=new f3;this.register(t),this._active=t.version,this._activeProvider=t}static extractShouldJoin(t){return(t&1)!==0}static extractWidth(t){return t>>1&3}static extractCharKind(t){return t>>3}static createPropertyValue(t,i,r=!1){return(t&16777215)<<3|(i&3)<<1|(r?1:0)}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(t){if(!this._providers[t])throw new Error(`unknown Unicode version "${t}"`);this._active=t,this._activeProvider=this._providers[t],this._onChange.fire(t)}register(t){this._providers[t.version]=t}wcwidth(t){return this._activeProvider.wcwidth(t)}getStringCellWidth(t){let i=0,r=0,s=t.length;for(let n=0;n<s;++n){let o=t.charCodeAt(n);if(55296<=o&&o<=56319){if(++n>=s)return i+this.wcwidth(o);let l=t.charCodeAt(n);56320<=l&&l<=57343?o=(o-55296)*1024+l-56320+65536:i+=this.wcwidth(l)}let a=this.charProperties(o,r),h=Ga.extractWidth(a);Ga.extractShouldJoin(a)&&(h-=Ga.extractWidth(r)),i+=h,r=a}return i}charProperties(t,i){return this._activeProvider.charProperties(t,i)}},_3=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(e){this.glevel=e,this.charset=this._charsets[e]}setgCharset(e,t){this._charsets[e]=t,this.glevel===e&&(this.charset=t)}};function $m(e){let t=e.buffer.lines.get(e.buffer.ybase+e.buffer.y-1)?.get(e.cols-1),i=e.buffer.lines.get(e.buffer.ybase+e.buffer.y);i&&t&&(i.isWrapped=t[3]!==0&&t[3]!==32)}var Tn=2147483647,p3=256,s1=class Ou{constructor(t=32,i=32){if(this.maxLength=t,this.maxSubParamsLength=i,i>p3)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(t),this.length=0,this._subParams=new Int32Array(i),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(t),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}static fromArray(t){let i=new Ou;if(!t.length)return i;for(let r=Array.isArray(t[0])?1:0;r<t.length;++r){let s=t[r];if(Array.isArray(s))for(let n=0;n<s.length;++n)i.addSubParam(s[n]);else i.addParam(s)}return i}clone(){let t=new Ou(this.maxLength,this.maxSubParamsLength);return t.params.set(this.params),t.length=this.length,t._subParams.set(this._subParams),t._subParamsLength=this._subParamsLength,t._subParamsIdx.set(this._subParamsIdx),t._rejectDigits=this._rejectDigits,t._rejectSubDigits=this._rejectSubDigits,t._digitIsSub=this._digitIsSub,t}toArray(){let t=[];for(let i=0;i<this.length;++i){t.push(this.params[i]);let r=this._subParamsIdx[i]>>8,s=this._subParamsIdx[i]&255;s-r>0&&t.push(Array.prototype.slice.call(this._subParams,r,s))}return t}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(t){if(this._digitIsSub=!1,this.length>=this.maxLength){this._rejectDigits=!0;return}if(t<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=t>Tn?Tn:t}addSubParam(t){if(this._digitIsSub=!0,!!this.length){if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength){this._rejectSubDigits=!0;return}if(t<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=t>Tn?Tn:t,this._subParamsIdx[this.length-1]++}}hasSubParams(t){return(this._subParamsIdx[t]&255)-(this._subParamsIdx[t]>>8)>0}getSubParams(t){let i=this._subParamsIdx[t]>>8,r=this._subParamsIdx[t]&255;return r-i>0?this._subParams.subarray(i,r):null}getSubParamsAll(){let t={};for(let i=0;i<this.length;++i){let r=this._subParamsIdx[i]>>8,s=this._subParamsIdx[i]&255;s-r>0&&(t[i]=this._subParams.slice(r,s))}return t}addDigit(t){let i;if(this._rejectDigits||!(i=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;let r=this._digitIsSub?this._subParams:this.params,s=r[i-1];r[i-1]=~s?Math.min(s*10+t,Tn):t}},Rn=[],g3=class{constructor(){this._state=0,this._active=Rn,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(e,t){this._handlers[e]===void 0&&(this._handlers[e]=[]);let i=this._handlers[e];return i.push(t),{dispose:()=>{let r=i.indexOf(t);r!==-1&&i.splice(r,1)}}}clearHandler(e){this._handlers[e]&&delete this._handlers[e]}setHandlerFallback(e){this._handlerFb=e}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=Rn}reset(){if(this._state===2)for(let e=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;e>=0;--e)this._active[e].end(!1);this._stack.paused=!1,this._active=Rn,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||Rn,!this._active.length)this._handlerFb(this._id,"START");else for(let e=this._active.length-1;e>=0;e--)this._active[e].start()}_put(e,t,i){if(!this._active.length)this._handlerFb(this._id,"PUT",rl(e,t,i));else for(let r=this._active.length-1;r>=0;r--)this._active[r].put(e,t,i)}start(){this.reset(),this._state=1}put(e,t,i){if(this._state!==3){if(this._state===1)for(;t<i;){let r=e[t++];if(r===59){this._state=2,this._start();break}if(r<48||57<r){this._state=3;return}this._id===-1&&(this._id=0),this._id=this._id*10+r-48}this._state===2&&i-t>0&&this._put(e,t,i)}}end(e,t=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),!this._active.length)this._handlerFb(this._id,"END",e);else{let i=!1,r=this._active.length-1,s=!1;if(this._stack.paused&&(r=this._stack.loopPosition-1,i=t,s=this._stack.fallThrough,this._stack.paused=!1),!s&&i===!1){for(;r>=0&&(i=this._active[r].end(e),i!==!0);r--)if(i instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!1,i;r--}for(;r>=0;r--)if(i=this._active[r].end(!1),i instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!0,i}this._active=Rn,this._id=-1,this._state=0}}},It=class{constructor(e){this._handler=e,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(e,t,i){this._hitLimit||(this._data+=rl(e,t,i),this._data.length>1e7&&(this._data="",this._hitLimit=!0))}end(e){let t=!1;if(this._hitLimit)t=!1;else if(e&&(t=this._handler(this._data),t instanceof Promise))return t.then(i=>(this._data="",this._hitLimit=!1,i));return this._data="",this._hitLimit=!1,t}},Fn=[],m3=class{constructor(){this._handlers=Object.create(null),this._active=Fn,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=Fn}registerHandler(e,t){this._handlers[e]===void 0&&(this._handlers[e]=[]);let i=this._handlers[e];return i.push(t),{dispose:()=>{let r=i.indexOf(t);r!==-1&&i.splice(r,1)}}}clearHandler(e){this._handlers[e]&&delete this._handlers[e]}setHandlerFallback(e){this._handlerFb=e}reset(){if(this._active.length)for(let e=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;e>=0;--e)this._active[e].unhook(!1);this._stack.paused=!1,this._active=Fn,this._ident=0}hook(e,t){if(this.reset(),this._ident=e,this._active=this._handlers[e]||Fn,!this._active.length)this._handlerFb(this._ident,"HOOK",t);else for(let i=this._active.length-1;i>=0;i--)this._active[i].hook(t)}put(e,t,i){if(!this._active.length)this._handlerFb(this._ident,"PUT",rl(e,t,i));else for(let r=this._active.length-1;r>=0;r--)this._active[r].put(e,t,i)}unhook(e,t=!0){if(!this._active.length)this._handlerFb(this._ident,"UNHOOK",e);else{let i=!1,r=this._active.length-1,s=!1;if(this._stack.paused&&(r=this._stack.loopPosition-1,i=t,s=this._stack.fallThrough,this._stack.paused=!1),!s&&i===!1){for(;r>=0&&(i=this._active[r].unhook(e),i!==!0);r--)if(i instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!1,i;r--}for(;r>=0;r--)if(i=this._active[r].unhook(!1),i instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!0,i}this._active=Fn,this._ident=0}},Hn=new s1;Hn.addParam(0);var Gm=class{constructor(e){this._handler=e,this._data="",this._params=Hn,this._hitLimit=!1}hook(e){this._params=e.length>1||e.params[0]?e.clone():Hn,this._data="",this._hitLimit=!1}put(e,t,i){this._hitLimit||(this._data+=rl(e,t,i),this._data.length>1e7&&(this._data="",this._hitLimit=!0))}unhook(e){let t=!1;if(this._hitLimit)t=!1;else if(e&&(t=this._handler(this._data,this._params),t instanceof Promise))return t.then(i=>(this._params=Hn,this._data="",this._hitLimit=!1,i));return this._params=Hn,this._data="",this._hitLimit=!1,t}},v3=class{constructor(e){this.table=new Uint8Array(e)}setDefault(e,t){this.table.fill(e<<4|t)}add(e,t,i,r){this.table[t<<8|e]=i<<4|r}addMany(e,t,i,r){for(let s=0;s<e.length;s++)this.table[t<<8|e[s]]=i<<4|r}},Wt=160,y3=function(){let e=new v3(4095),t=Array.apply(null,Array(256)).map((a,h)=>h),i=(a,h)=>t.slice(a,h),r=i(32,127),s=i(0,24);s.push(25),s.push.apply(s,i(28,32));let n=i(0,14),o;e.setDefault(1,0),e.addMany(r,0,2,0);for(o in n)e.addMany([24,26,153,154],o,3,0),e.addMany(i(128,144),o,3,0),e.addMany(i(144,152),o,3,0),e.add(156,o,0,0),e.add(27,o,11,1),e.add(157,o,4,8),e.addMany([152,158,159],o,0,7),e.add(155,o,11,3),e.add(144,o,11,9);return e.addMany(s,0,3,0),e.addMany(s,1,3,1),e.add(127,1,0,1),e.addMany(s,8,0,8),e.addMany(s,3,3,3),e.add(127,3,0,3),e.addMany(s,4,3,4),e.add(127,4,0,4),e.addMany(s,6,3,6),e.addMany(s,5,3,5),e.add(127,5,0,5),e.addMany(s,2,3,2),e.add(127,2,0,2),e.add(93,1,4,8),e.addMany(r,8,5,8),e.add(127,8,5,8),e.addMany([156,27,24,26,7],8,6,0),e.addMany(i(28,32),8,0,8),e.addMany([88,94,95],1,0,7),e.addMany(r,7,0,7),e.addMany(s,7,0,7),e.add(156,7,0,0),e.add(127,7,0,7),e.add(91,1,11,3),e.addMany(i(64,127),3,7,0),e.addMany(i(48,60),3,8,4),e.addMany([60,61,62,63],3,9,4),e.addMany(i(48,60),4,8,4),e.addMany(i(64,127),4,7,0),e.addMany([60,61,62,63],4,0,6),e.addMany(i(32,64),6,0,6),e.add(127,6,0,6),e.addMany(i(64,127),6,0,0),e.addMany(i(32,48),3,9,5),e.addMany(i(32,48),5,9,5),e.addMany(i(48,64),5,0,6),e.addMany(i(64,127),5,7,0),e.addMany(i(32,48),4,9,5),e.addMany(i(32,48),1,9,2),e.addMany(i(32,48),2,9,2),e.addMany(i(48,127),2,10,0),e.addMany(i(48,80),1,10,0),e.addMany(i(81,88),1,10,0),e.addMany([89,90,92],1,10,0),e.addMany(i(96,127),1,10,0),e.add(80,1,11,9),e.addMany(s,9,0,9),e.add(127,9,0,9),e.addMany(i(28,32),9,0,9),e.addMany(i(32,48),9,9,12),e.addMany(i(48,60),9,8,10),e.addMany([60,61,62,63],9,9,10),e.addMany(s,11,0,11),e.addMany(i(32,128),11,0,11),e.addMany(i(28,32),11,0,11),e.addMany(s,10,0,10),e.add(127,10,0,10),e.addMany(i(28,32),10,0,10),e.addMany(i(48,60),10,8,10),e.addMany([60,61,62,63],10,0,11),e.addMany(i(32,48),10,9,12),e.addMany(s,12,0,12),e.add(127,12,0,12),e.addMany(i(28,32),12,0,12),e.addMany(i(32,48),12,9,12),e.addMany(i(48,64),12,0,11),e.addMany(i(64,127),12,12,13),e.addMany(i(64,127),10,12,13),e.addMany(i(64,127),9,12,13),e.addMany(s,13,13,13),e.addMany(r,13,13,13),e.add(127,13,0,13),e.addMany([27,156,24,26],13,14,0),e.add(Wt,0,2,0),e.add(Wt,8,5,8),e.add(Wt,6,0,6),e.add(Wt,11,0,11),e.add(Wt,13,13,13),e}(),b3=class extends oe{constructor(e=y3){super(),this._transitions=e,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new s1,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(t,i,r)=>{},this._executeHandlerFb=t=>{},this._csiHandlerFb=(t,i)=>{},this._escHandlerFb=t=>{},this._errorHandlerFb=t=>t,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this._register(Ae(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this._register(new g3),this._dcsParser=this._register(new m3),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(e,t=[64,126]){let i=0;if(e.prefix){if(e.prefix.length>1)throw new Error("only one byte as prefix supported");if(i=e.prefix.charCodeAt(0),i&&60>i||i>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(e.intermediates){if(e.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let s=0;s<e.intermediates.length;++s){let n=e.intermediates.charCodeAt(s);if(32>n||n>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");i<<=8,i|=n}}if(e.final.length!==1)throw new Error("final must be a single byte");let r=e.final.charCodeAt(0);if(t[0]>r||r>t[1])throw new Error(`final must be in range ${t[0]} .. ${t[1]}`);return i<<=8,i|=r,i}identToString(e){let t=[];for(;e;)t.push(String.fromCharCode(e&255)),e>>=8;return t.reverse().join("")}setPrintHandler(e){this._printHandler=e}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(e,t){let i=this._identifier(e,[48,126]);this._escHandlers[i]===void 0&&(this._escHandlers[i]=[]);let r=this._escHandlers[i];return r.push(t),{dispose:()=>{let s=r.indexOf(t);s!==-1&&r.splice(s,1)}}}clearEscHandler(e){this._escHandlers[this._identifier(e,[48,126])]&&delete this._escHandlers[this._identifier(e,[48,126])]}setEscHandlerFallback(e){this._escHandlerFb=e}setExecuteHandler(e,t){this._executeHandlers[e.charCodeAt(0)]=t}clearExecuteHandler(e){this._executeHandlers[e.charCodeAt(0)]&&delete this._executeHandlers[e.charCodeAt(0)]}setExecuteHandlerFallback(e){this._executeHandlerFb=e}registerCsiHandler(e,t){let i=this._identifier(e);this._csiHandlers[i]===void 0&&(this._csiHandlers[i]=[]);let r=this._csiHandlers[i];return r.push(t),{dispose:()=>{let s=r.indexOf(t);s!==-1&&r.splice(s,1)}}}clearCsiHandler(e){this._csiHandlers[this._identifier(e)]&&delete this._csiHandlers[this._identifier(e)]}setCsiHandlerFallback(e){this._csiHandlerFb=e}registerDcsHandler(e,t){return this._dcsParser.registerHandler(this._identifier(e),t)}clearDcsHandler(e){this._dcsParser.clearHandler(this._identifier(e))}setDcsHandlerFallback(e){this._dcsParser.setHandlerFallback(e)}registerOscHandler(e,t){return this._oscParser.registerHandler(e,t)}clearOscHandler(e){this._oscParser.clearHandler(e)}setOscHandlerFallback(e){this._oscParser.setHandlerFallback(e)}setErrorHandler(e){this._errorHandler=e}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(e,t,i,r,s){this._parseStack.state=e,this._parseStack.handlers=t,this._parseStack.handlerPos=i,this._parseStack.transition=r,this._parseStack.chunkPos=s}parse(e,t,i){let r=0,s=0,n=0,o;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,n=this._parseStack.chunkPos+1;else{if(i===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");let a=this._parseStack.handlers,h=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(i===!1&&h>-1){for(;h>=0&&(o=a[h](this._params),o!==!0);h--)if(o instanceof Promise)return this._parseStack.handlerPos=h,o}this._parseStack.handlers=[];break;case 4:if(i===!1&&h>-1){for(;h>=0&&(o=a[h](),o!==!0);h--)if(o instanceof Promise)return this._parseStack.handlerPos=h,o}this._parseStack.handlers=[];break;case 6:if(r=e[this._parseStack.chunkPos],o=this._dcsParser.unhook(r!==24&&r!==26,i),o)return o;r===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(r=e[this._parseStack.chunkPos],o=this._oscParser.end(r!==24&&r!==26,i),o)return o;r===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break}this._parseStack.state=0,n=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=this._parseStack.transition&15}for(let a=n;a<t;++a){switch(r=e[a],s=this._transitions.table[this.currentState<<8|(r<160?r:Wt)],s>>4){case 2:for(let g=a+1;;++g){if(g>=t||(r=e[g])<32||r>126&&r<Wt){this._printHandler(e,a,g),a=g-1;break}if(++g>=t||(r=e[g])<32||r>126&&r<Wt){this._printHandler(e,a,g),a=g-1;break}if(++g>=t||(r=e[g])<32||r>126&&r<Wt){this._printHandler(e,a,g),a=g-1;break}if(++g>=t||(r=e[g])<32||r>126&&r<Wt){this._printHandler(e,a,g),a=g-1;break}}break;case 3:this._executeHandlers[r]?this._executeHandlers[r]():this._executeHandlerFb(r),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:a,code:r,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:let h=this._csiHandlers[this._collect<<8|r],l=h?h.length-1:-1;for(;l>=0&&(o=h[l](this._params),o!==!0);l--)if(o instanceof Promise)return this._preserveStack(3,h,l,s,a),o;l<0&&this._csiHandlerFb(this._collect<<8|r,this._params),this.precedingJoinState=0;break;case 8:do switch(r){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(r-48)}while(++a<t&&(r=e[a])>47&&r<60);a--;break;case 9:this._collect<<=8,this._collect|=r;break;case 10:let c=this._escHandlers[this._collect<<8|r],u=c?c.length-1:-1;for(;u>=0&&(o=c[u](),o!==!0);u--)if(o instanceof Promise)return this._preserveStack(4,c,u,s,a),o;u<0&&this._escHandlerFb(this._collect<<8|r),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|r,this._params);break;case 13:for(let g=a+1;;++g)if(g>=t||(r=e[g])===24||r===26||r===27||r>127&&r<Wt){this._dcsParser.put(e,a,g),a=g-1;break}break;case 14:if(o=this._dcsParser.unhook(r!==24&&r!==26),o)return this._preserveStack(6,[],0,s,a),o;r===27&&(s|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let g=a+1;;g++)if(g>=t||(r=e[g])<32||r>127&&r<Wt){this._oscParser.put(e,a,g),a=g-1;break}break;case 6:if(o=this._oscParser.end(r!==24&&r!==26),o)return this._preserveStack(5,[],0,s,a),o;r===27&&(s|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break}this.currentState=s&15}}},w3=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,A3=/^[\da-f]+$/;function jm(e){if(!e)return;let t=e.toLowerCase();if(t.indexOf("rgb:")===0){t=t.slice(4);let i=w3.exec(t);if(i){let r=i[1]?15:i[4]?255:i[7]?4095:65535;return[Math.round(parseInt(i[1]||i[4]||i[7]||i[10],16)/r*255),Math.round(parseInt(i[2]||i[5]||i[8]||i[11],16)/r*255),Math.round(parseInt(i[3]||i[6]||i[9]||i[12],16)/r*255)]}}else if(t.indexOf("#")===0&&(t=t.slice(1),A3.exec(t)&&[3,6,9,12].includes(t.length))){let i=t.length/3,r=[0,0,0];for(let s=0;s<3;++s){let n=parseInt(t.slice(i*s,i*s+i),16);r[s]=i===1?n<<4:i===2?n:i===3?n>>4:n>>8}return r}}function tu(e,t){let i=e.toString(16),r=i.length<2?"0"+i:i;switch(t){case 4:return i[0];case 8:return r;case 12:return(r+r).slice(0,3);default:return r+r}}function x3(e,t=16){let[i,r,s]=e;return`rgb:${tu(i,t)}/${tu(r,t)}/${tu(s,t)}`}var S3={"(":0,")":1,"*":2,"+":3,"-":1,".":2},mr=131072,qm=10;function Vm(e,t){if(e>24)return t.setWinLines||!1;switch(e){case 1:return!!t.restoreWin;case 2:return!!t.minimizeWin;case 3:return!!t.setWinPosition;case 4:return!!t.setWinSizePixels;case 5:return!!t.raiseWin;case 6:return!!t.lowerWin;case 7:return!!t.refreshWin;case 8:return!!t.setWinSizeChars;case 9:return!!t.maximizeWin;case 10:return!!t.fullscreenWin;case 11:return!!t.getWinState;case 13:return!!t.getWinPosition;case 14:return!!t.getWinSizePixels;case 15:return!!t.getScreenSizePixels;case 16:return!!t.getCellSizePixels;case 18:return!!t.getWinSizeChars;case 19:return!!t.getScreenSizeChars;case 20:return!!t.getIconTitle;case 21:return!!t.getWinTitle;case 22:return!!t.pushTitle;case 23:return!!t.popTitle;case 24:return!!t.setWinLines}return!1}var Ym=5e3,Jm=0,C3=class extends oe{constructor(e,t,i,r,s,n,o,a,h=new b3){super(),this._bufferService=e,this._charsetService=t,this._coreService=i,this._logService=r,this._optionsService=s,this._oscLinkService=n,this._coreMouseService=o,this._unicodeService=a,this._parser=h,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new g5,this._utf8Decoder=new m5,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=Ne.clone(),this._eraseAttrDataInternal=Ne.clone(),this._onRequestBell=this._register(new Y),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this._register(new Y),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this._register(new Y),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this._register(new Y),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this._register(new Y),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this._register(new Y),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this._register(new Y),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this._register(new Y),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this._register(new Y),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this._register(new Y),this.onLineFeed=this._onLineFeed.event,this._onScroll=this._register(new Y),this.onScroll=this._onScroll.event,this._onTitleChange=this._register(new Y),this.onTitleChange=this._onTitleChange.event,this._onColor=this._register(new Y),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this._register(this._parser),this._dirtyRowTracker=new Ku(this._bufferService),this._activeBuffer=this._bufferService.buffer,this._register(this._bufferService.buffers.onBufferActivate(l=>this._activeBuffer=l.activeBuffer)),this._parser.setCsiHandlerFallback((l,c)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(l),params:c.toArray()})}),this._parser.setEscHandlerFallback(l=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(l)})}),this._parser.setExecuteHandlerFallback(l=>{this._logService.debug("Unknown EXECUTE code: ",{code:l})}),this._parser.setOscHandlerFallback((l,c,u)=>{this._logService.debug("Unknown OSC code: ",{identifier:l,action:c,data:u})}),this._parser.setDcsHandlerFallback((l,c,u)=>{c==="HOOK"&&(u=u.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(l),action:c,payload:u})}),this._parser.setPrintHandler((l,c,u)=>this.print(l,c,u)),this._parser.registerCsiHandler({final:"@"},l=>this.insertChars(l)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},l=>this.scrollLeft(l)),this._parser.registerCsiHandler({final:"A"},l=>this.cursorUp(l)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},l=>this.scrollRight(l)),this._parser.registerCsiHandler({final:"B"},l=>this.cursorDown(l)),this._parser.registerCsiHandler({final:"C"},l=>this.cursorForward(l)),this._parser.registerCsiHandler({final:"D"},l=>this.cursorBackward(l)),this._parser.registerCsiHandler({final:"E"},l=>this.cursorNextLine(l)),this._parser.registerCsiHandler({final:"F"},l=>this.cursorPrecedingLine(l)),this._parser.registerCsiHandler({final:"G"},l=>this.cursorCharAbsolute(l)),this._parser.registerCsiHandler({final:"H"},l=>this.cursorPosition(l)),this._parser.registerCsiHandler({final:"I"},l=>this.cursorForwardTab(l)),this._parser.registerCsiHandler({final:"J"},l=>this.eraseInDisplay(l,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},l=>this.eraseInDisplay(l,!0)),this._parser.registerCsiHandler({final:"K"},l=>this.eraseInLine(l,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},l=>this.eraseInLine(l,!0)),this._parser.registerCsiHandler({final:"L"},l=>this.insertLines(l)),this._parser.registerCsiHandler({final:"M"},l=>this.deleteLines(l)),this._parser.registerCsiHandler({final:"P"},l=>this.deleteChars(l)),this._parser.registerCsiHandler({final:"S"},l=>this.scrollUp(l)),this._parser.registerCsiHandler({final:"T"},l=>this.scrollDown(l)),this._parser.registerCsiHandler({final:"X"},l=>this.eraseChars(l)),this._parser.registerCsiHandler({final:"Z"},l=>this.cursorBackwardTab(l)),this._parser.registerCsiHandler({final:"`"},l=>this.charPosAbsolute(l)),this._parser.registerCsiHandler({final:"a"},l=>this.hPositionRelative(l)),this._parser.registerCsiHandler({final:"b"},l=>this.repeatPrecedingCharacter(l)),this._parser.registerCsiHandler({final:"c"},l=>this.sendDeviceAttributesPrimary(l)),this._parser.registerCsiHandler({prefix:">",final:"c"},l=>this.sendDeviceAttributesSecondary(l)),this._parser.registerCsiHandler({final:"d"},l=>this.linePosAbsolute(l)),this._parser.registerCsiHandler({final:"e"},l=>this.vPositionRelative(l)),this._parser.registerCsiHandler({final:"f"},l=>this.hVPosition(l)),this._parser.registerCsiHandler({final:"g"},l=>this.tabClear(l)),this._parser.registerCsiHandler({final:"h"},l=>this.setMode(l)),this._parser.registerCsiHandler({prefix:"?",final:"h"},l=>this.setModePrivate(l)),this._parser.registerCsiHandler({final:"l"},l=>this.resetMode(l)),this._parser.registerCsiHandler({prefix:"?",final:"l"},l=>this.resetModePrivate(l)),this._parser.registerCsiHandler({final:"m"},l=>this.charAttributes(l)),this._parser.registerCsiHandler({final:"n"},l=>this.deviceStatus(l)),this._parser.registerCsiHandler({prefix:"?",final:"n"},l=>this.deviceStatusPrivate(l)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},l=>this.softReset(l)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},l=>this.setCursorStyle(l)),this._parser.registerCsiHandler({final:"r"},l=>this.setScrollRegion(l)),this._parser.registerCsiHandler({final:"s"},l=>this.saveCursor(l)),this._parser.registerCsiHandler({final:"t"},l=>this.windowOptions(l)),this._parser.registerCsiHandler({final:"u"},l=>this.restoreCursor(l)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},l=>this.insertColumns(l)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},l=>this.deleteColumns(l)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},l=>this.selectProtected(l)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},l=>this.requestMode(l,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},l=>this.requestMode(l,!1)),this._parser.setExecuteHandler(j.BEL,()=>this.bell()),this._parser.setExecuteHandler(j.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(j.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(j.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(j.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(j.BS,()=>this.backspace()),this._parser.setExecuteHandler(j.HT,()=>this.tab()),this._parser.setExecuteHandler(j.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(j.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(Wa.IND,()=>this.index()),this._parser.setExecuteHandler(Wa.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(Wa.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new It(l=>(this.setTitle(l),this.setIconName(l),!0))),this._parser.registerOscHandler(1,new It(l=>this.setIconName(l))),this._parser.registerOscHandler(2,new It(l=>this.setTitle(l))),this._parser.registerOscHandler(4,new It(l=>this.setOrReportIndexedColor(l))),this._parser.registerOscHandler(8,new It(l=>this.setHyperlink(l))),this._parser.registerOscHandler(10,new It(l=>this.setOrReportFgColor(l))),this._parser.registerOscHandler(11,new It(l=>this.setOrReportBgColor(l))),this._parser.registerOscHandler(12,new It(l=>this.setOrReportCursorColor(l))),this._parser.registerOscHandler(104,new It(l=>this.restoreIndexedColor(l))),this._parser.registerOscHandler(110,new It(l=>this.restoreFgColor(l))),this._parser.registerOscHandler(111,new It(l=>this.restoreBgColor(l))),this._parser.registerOscHandler(112,new It(l=>this.restoreCursorColor(l))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(let l in Ge)this._parser.registerEscHandler({intermediates:"(",final:l},()=>this.selectCharset("("+l)),this._parser.registerEscHandler({intermediates:")",final:l},()=>this.selectCharset(")"+l)),this._parser.registerEscHandler({intermediates:"*",final:l},()=>this.selectCharset("*"+l)),this._parser.registerEscHandler({intermediates:"+",final:l},()=>this.selectCharset("+"+l)),this._parser.registerEscHandler({intermediates:"-",final:l},()=>this.selectCharset("-"+l)),this._parser.registerEscHandler({intermediates:".",final:l},()=>this.selectCharset("."+l)),this._parser.registerEscHandler({intermediates:"/",final:l},()=>this.selectCharset("/"+l));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler(l=>(this._logService.error("Parsing error: ",l),l)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new Gm((l,c)=>this.requestStatusString(l,c)))}getAttrData(){return this._curAttrData}_preserveStack(e,t,i,r){this._parseStack.paused=!0,this._parseStack.cursorStartX=e,this._parseStack.cursorStartY=t,this._parseStack.decodedLength=i,this._parseStack.position=r}_logSlowResolvingAsync(e){this._logService.logLevel<=3&&Promise.race([e,new Promise((t,i)=>setTimeout(()=>i("#SLOW_TIMEOUT"),Ym))]).catch(t=>{if(t!=="#SLOW_TIMEOUT")throw t;console.warn(`async parser handler taking longer than ${Ym} ms`)})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(e,t){let i,r=this._activeBuffer.x,s=this._activeBuffer.y,n=0,o=this._parseStack.paused;if(o){if(i=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,t))return this._logSlowResolvingAsync(i),i;r=this._parseStack.cursorStartX,s=this._parseStack.cursorStartY,this._parseStack.paused=!1,e.length>mr&&(n=this._parseStack.position+mr)}if(this._logService.logLevel<=1&&this._logService.debug(`parsing data ${typeof e=="string"?` "${e}"`:` "${Array.prototype.map.call(e,l=>String.fromCharCode(l)).join("")}"`}`),this._logService.logLevel===0&&this._logService.trace("parsing data (codes)",typeof e=="string"?e.split("").map(l=>l.charCodeAt(0)):e),this._parseBuffer.length<e.length&&this._parseBuffer.length<mr&&(this._parseBuffer=new Uint32Array(Math.min(e.length,mr))),o||this._dirtyRowTracker.clearRange(),e.length>mr)for(let l=n;l<e.length;l+=mr){let c=l+mr<e.length?l+mr:e.length,u=typeof e=="string"?this._stringDecoder.decode(e.substring(l,c),this._parseBuffer):this._utf8Decoder.decode(e.subarray(l,c),this._parseBuffer);if(i=this._parser.parse(this._parseBuffer,u))return this._preserveStack(r,s,u,l),this._logSlowResolvingAsync(i),i}else if(!o){let l=typeof e=="string"?this._stringDecoder.decode(e,this._parseBuffer):this._utf8Decoder.decode(e,this._parseBuffer);if(i=this._parser.parse(this._parseBuffer,l))return this._preserveStack(r,s,l,0),this._logSlowResolvingAsync(i),i}(this._activeBuffer.x!==r||this._activeBuffer.y!==s)&&this._onCursorMove.fire();let a=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),h=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);h<this._bufferService.rows&&this._onRequestRefreshRows.fire({start:Math.min(h,this._bufferService.rows-1),end:Math.min(a,this._bufferService.rows-1)})}print(e,t,i){let r,s,n=this._charsetService.charset,o=this._optionsService.rawOptions.screenReaderMode,a=this._bufferService.cols,h=this._coreService.decPrivateModes.wraparound,l=this._coreService.modes.insertMode,c=this._curAttrData,u=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&i-t>0&&u.getWidth(this._activeBuffer.x-1)===2&&u.setCellFromCodepoint(this._activeBuffer.x-1,0,1,c);let g=this._parser.precedingJoinState;for(let _=t;_<i;++_){if(r=e[_],r<127&&n){let E=n[String.fromCharCode(r)];E&&(r=E.charCodeAt(0))}let m=this._unicodeService.charProperties(r,g);s=$r.extractWidth(m);let v=$r.extractShouldJoin(m),x=v?$r.extractWidth(g):0;if(g=m,o&&this._onA11yChar.fire(vr(r)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+s-x>a){if(h){let E=u,M=this._activeBuffer.x-x;for(this._activeBuffer.x=x,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),u=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),x>0&&u instanceof Nn&&u.copyCellsFrom(E,M,0,x,!1);M<a;)E.setCellFromCodepoint(M++,0,1,c)}else if(this._activeBuffer.x=a-1,s===2)continue}if(v&&this._activeBuffer.x){let E=u.getWidth(this._activeBuffer.x-1)?1:2;u.addCodepointToCell(this._activeBuffer.x-E,r,s);for(let M=s-x;--M>=0;)u.setCellFromCodepoint(this._activeBuffer.x++,0,0,c);continue}if(l&&(u.insertCells(this._activeBuffer.x,s-x,this._activeBuffer.getNullCell(c)),u.getWidth(a-1)===2&&u.setCellFromCodepoint(a-1,0,1,c)),u.setCellFromCodepoint(this._activeBuffer.x++,r,s,c),s>0)for(;--s;)u.setCellFromCodepoint(this._activeBuffer.x++,0,0,c)}this._parser.precedingJoinState=g,this._activeBuffer.x<a&&i-t>0&&u.getWidth(this._activeBuffer.x)===0&&!u.hasContent(this._activeBuffer.x)&&u.setCellFromCodepoint(this._activeBuffer.x,0,1,c),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(e,t){return e.final==="t"&&!e.prefix&&!e.intermediates?this._parser.registerCsiHandler(e,i=>Vm(i.params[0],this._optionsService.rawOptions.windowOptions)?t(i):!0):this._parser.registerCsiHandler(e,t)}registerDcsHandler(e,t){return this._parser.registerDcsHandler(e,new Gm(t))}registerEscHandler(e,t){return this._parser.registerEscHandler(e,t)}registerOscHandler(e,t){return this._parser.registerOscHandler(e,new It(t))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)?.isWrapped){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;let e=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);e.hasWidth(this._activeBuffer.x)&&!e.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let e=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-e),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(e=this._bufferService.cols-1){this._activeBuffer.x=Math.min(e,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(e,t){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=e,this._activeBuffer.y=this._activeBuffer.scrollTop+t):(this._activeBuffer.x=e,this._activeBuffer.y=t),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(e,t){this._restrictCursor(),this._setCursor(this._activeBuffer.x+e,this._activeBuffer.y+t)}cursorUp(e){let t=this._activeBuffer.y-this._activeBuffer.scrollTop;return t>=0?this._moveCursor(0,-Math.min(t,e.params[0]||1)):this._moveCursor(0,-(e.params[0]||1)),!0}cursorDown(e){let t=this._activeBuffer.scrollBottom-this._activeBuffer.y;return t>=0?this._moveCursor(0,Math.min(t,e.params[0]||1)):this._moveCursor(0,e.params[0]||1),!0}cursorForward(e){return this._moveCursor(e.params[0]||1,0),!0}cursorBackward(e){return this._moveCursor(-(e.params[0]||1),0),!0}cursorNextLine(e){return this.cursorDown(e),this._activeBuffer.x=0,!0}cursorPrecedingLine(e){return this.cursorUp(e),this._activeBuffer.x=0,!0}cursorCharAbsolute(e){return this._setCursor((e.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(e){return this._setCursor(e.length>=2?(e.params[1]||1)-1:0,(e.params[0]||1)-1),!0}charPosAbsolute(e){return this._setCursor((e.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(e){return this._moveCursor(e.params[0]||1,0),!0}linePosAbsolute(e){return this._setCursor(this._activeBuffer.x,(e.params[0]||1)-1),!0}vPositionRelative(e){return this._moveCursor(0,e.params[0]||1),!0}hVPosition(e){return this.cursorPosition(e),!0}tabClear(e){let t=e.params[0];return t===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:t===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(e){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let t=e.params[0]||1;for(;t--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(e){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let t=e.params[0]||1;for(;t--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(e){let t=e.params[0];return t===1&&(this._curAttrData.bg|=536870912),(t===2||t===0)&&(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(e,t,i,r=!1,s=!1){let n=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);n.replaceCells(t,i,this._activeBuffer.getNullCell(this._eraseAttrData()),s),r&&(n.isWrapped=!1)}_resetBufferLine(e,t=!1){let i=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);i&&(i.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),t),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+e),i.isWrapped=!1)}eraseInDisplay(e,t=!1){this._restrictCursor(this._bufferService.cols);let i;switch(e.params[0]){case 0:for(i=this._activeBuffer.y,this._dirtyRowTracker.markDirty(i),this._eraseInBufferLine(i++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,t);i<this._bufferService.rows;i++)this._resetBufferLine(i,t);this._dirtyRowTracker.markDirty(i);break;case 1:for(i=this._activeBuffer.y,this._dirtyRowTracker.markDirty(i),this._eraseInBufferLine(i,0,this._activeBuffer.x+1,!0,t),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(i+1).isWrapped=!1);i--;)this._resetBufferLine(i,t);this._dirtyRowTracker.markDirty(0);break;case 2:if(this._optionsService.rawOptions.scrollOnEraseInDisplay){for(i=this._bufferService.rows,this._dirtyRowTracker.markRangeDirty(0,i-1);i--&&!this._activeBuffer.lines.get(this._activeBuffer.ybase+i)?.getTrimmedLength(););for(;i>=0;i--)this._bufferService.scroll(this._eraseAttrData())}else{for(i=this._bufferService.rows,this._dirtyRowTracker.markDirty(i-1);i--;)this._resetBufferLine(i,t);this._dirtyRowTracker.markDirty(0)}break;case 3:let r=this._activeBuffer.lines.length-this._bufferService.rows;r>0&&(this._activeBuffer.lines.trimStart(r),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-r,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-r,0),this._onScroll.fire(0));break}return!0}eraseInLine(e,t=!1){switch(this._restrictCursor(this._bufferService.cols),e.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,t);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,t);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,t);break}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(e){this._restrictCursor();let t=e.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let i=this._activeBuffer.ybase+this._activeBuffer.y,r=this._bufferService.rows-1-this._activeBuffer.scrollBottom,s=this._bufferService.rows-1+this._activeBuffer.ybase-r+1;for(;t--;)this._activeBuffer.lines.splice(s-1,1),this._activeBuffer.lines.splice(i,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(e){this._restrictCursor();let t=e.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let i=this._activeBuffer.ybase+this._activeBuffer.y,r;for(r=this._bufferService.rows-1-this._activeBuffer.scrollBottom,r=this._bufferService.rows-1+this._activeBuffer.ybase-r;t--;)this._activeBuffer.lines.splice(i,1),this._activeBuffer.lines.splice(r,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(e){this._restrictCursor();let t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.insertCells(this._activeBuffer.x,e.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(e){this._restrictCursor();let t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.deleteCells(this._activeBuffer.x,e.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(e){let t=e.params[0]||1;for(;t--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(e){let t=e.params[0]||1;for(;t--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(Ne));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let t=e.params[0]||1;for(let i=this._activeBuffer.scrollTop;i<=this._activeBuffer.scrollBottom;++i){let r=this._activeBuffer.lines.get(this._activeBuffer.ybase+i);r.deleteCells(0,t,this._activeBuffer.getNullCell(this._eraseAttrData())),r.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let t=e.params[0]||1;for(let i=this._activeBuffer.scrollTop;i<=this._activeBuffer.scrollBottom;++i){let r=this._activeBuffer.lines.get(this._activeBuffer.ybase+i);r.insertCells(0,t,this._activeBuffer.getNullCell(this._eraseAttrData())),r.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let t=e.params[0]||1;for(let i=this._activeBuffer.scrollTop;i<=this._activeBuffer.scrollBottom;++i){let r=this._activeBuffer.lines.get(this._activeBuffer.ybase+i);r.insertCells(this._activeBuffer.x,t,this._activeBuffer.getNullCell(this._eraseAttrData())),r.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let t=e.params[0]||1;for(let i=this._activeBuffer.scrollTop;i<=this._activeBuffer.scrollBottom;++i){let r=this._activeBuffer.lines.get(this._activeBuffer.ybase+i);r.deleteCells(this._activeBuffer.x,t,this._activeBuffer.getNullCell(this._eraseAttrData())),r.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(e){this._restrictCursor();let t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(e.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(e){let t=this._parser.precedingJoinState;if(!t)return!0;let i=e.params[0]||1,r=$r.extractWidth(t),s=this._activeBuffer.x-r,n=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(s),o=new Uint32Array(n.length*i),a=0;for(let l=0;l<n.length;){let c=n.codePointAt(l)||0;o[a++]=c,l+=c>65535?2:1}let h=a;for(let l=1;l<i;++l)o.copyWithin(h,0,a),h+=a;return this.print(o,0,h),!0}sendDeviceAttributesPrimary(e){return e.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(j.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(j.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(e){return e.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(j.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(j.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(e.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(j.ESC+"[>83;40003;0c")),!0}_is(e){return(this._optionsService.rawOptions.termName+"").indexOf(e)===0}setMode(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0;break}return!0}setModePrivate(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,Wr),this._charsetService.setgCharset(1,Wr),this._charsetService.setgCharset(2,Wr),this._charsetService.setgCharset(3,Wr);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(void 0),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0;break;case 2026:this._coreService.decPrivateModes.synchronizedOutput=!0;break}return!0}resetMode(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1;break}return!0}resetModePrivate(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),e.params[t]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(void 0),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1;break;case 2026:this._coreService.decPrivateModes.synchronizedOutput=!1,this._onRequestRefreshRows.fire(void 0);break}return!0}requestMode(e,t){let i;(v=>(v[v.NOT_RECOGNIZED=0]="NOT_RECOGNIZED",v[v.SET=1]="SET",v[v.RESET=2]="RESET",v[v.PERMANENTLY_SET=3]="PERMANENTLY_SET",v[v.PERMANENTLY_RESET=4]="PERMANENTLY_RESET"))(i||={});let r=this._coreService.decPrivateModes,{activeProtocol:s,activeEncoding:n}=this._coreMouseService,o=this._coreService,{buffers:a,cols:h}=this._bufferService,{active:l,alt:c}=a,u=this._optionsService.rawOptions,g=(v,x)=>(o.triggerDataEvent(`${j.ESC}[${t?"":"?"}${v};${x}$y`),!0),_=v=>v?1:2,m=e.params[0];return t?m===2?g(m,4):m===4?g(m,_(o.modes.insertMode)):m===12?g(m,3):m===20?g(m,_(u.convertEol)):g(m,0):m===1?g(m,_(r.applicationCursorKeys)):m===3?g(m,u.windowOptions.setWinLines?h===80?2:h===132?1:0:0):m===6?g(m,_(r.origin)):m===7?g(m,_(r.wraparound)):m===8?g(m,3):m===9?g(m,_(s==="X10")):m===12?g(m,_(u.cursorBlink)):m===25?g(m,_(!o.isCursorHidden)):m===45?g(m,_(r.reverseWraparound)):m===66?g(m,_(r.applicationKeypad)):m===67?g(m,4):m===1e3?g(m,_(s==="VT200")):m===1002?g(m,_(s==="DRAG")):m===1003?g(m,_(s==="ANY")):m===1004?g(m,_(r.sendFocus)):m===1005?g(m,4):m===1006?g(m,_(n==="SGR")):m===1015?g(m,4):m===1016?g(m,_(n==="SGR_PIXELS")):m===1048?g(m,1):m===47||m===1047||m===1049?g(m,_(l===c)):m===2004?g(m,_(r.bracketedPasteMode)):m===2026?g(m,_(r.synchronizedOutput)):g(m,0)}_updateAttrColor(e,t,i,r,s){return t===2?(e|=50331648,e&=-16777216,e|=jn.fromColorRGB([i,r,s])):t===5&&(e&=-50331904,e|=33554432|i&255),e}_extractColor(e,t,i){let r=[0,0,-1,0,0,0],s=0,n=0;do{if(r[n+s]=e.params[t+n],e.hasSubParams(t+n)){let o=e.getSubParams(t+n),a=0;do r[1]===5&&(s=1),r[n+a+1+s]=o[a];while(++a<o.length&&a+n+1+s<r.length);break}if(r[1]===5&&n+s>=2||r[1]===2&&n+s>=5)break;r[1]&&(s=1)}while(++n+t<e.length&&n+s<r.length);for(let o=2;o<r.length;++o)r[o]===-1&&(r[o]=0);switch(r[0]){case 38:i.fg=this._updateAttrColor(i.fg,r[1],r[3],r[4],r[5]);break;case 48:i.bg=this._updateAttrColor(i.bg,r[1],r[3],r[4],r[5]);break;case 58:i.extended=i.extended.clone(),i.extended.underlineColor=this._updateAttrColor(i.extended.underlineColor,r[1],r[3],r[4],r[5])}return n}_processUnderline(e,t){t.extended=t.extended.clone(),(!~e||e>5)&&(e=1),t.extended.underlineStyle=e,t.fg|=268435456,e===0&&(t.fg&=-268435457),t.updateExtended()}_processSGR0(e){e.fg=Ne.fg,e.bg=Ne.bg,e.extended=e.extended.clone(),e.extended.underlineStyle=0,e.extended.underlineColor&=-67108864,e.updateExtended()}charAttributes(e){if(e.length===1&&e.params[0]===0)return this._processSGR0(this._curAttrData),!0;let t=e.length,i,r=this._curAttrData;for(let s=0;s<t;s++)i=e.params[s],i>=30&&i<=37?(r.fg&=-50331904,r.fg|=16777216|i-30):i>=40&&i<=47?(r.bg&=-50331904,r.bg|=16777216|i-40):i>=90&&i<=97?(r.fg&=-50331904,r.fg|=16777216|i-90|8):i>=100&&i<=107?(r.bg&=-50331904,r.bg|=16777216|i-100|8):i===0?this._processSGR0(r):i===1?r.fg|=134217728:i===3?r.bg|=67108864:i===4?(r.fg|=268435456,this._processUnderline(e.hasSubParams(s)?e.getSubParams(s)[0]:1,r)):i===5?r.fg|=536870912:i===7?r.fg|=67108864:i===8?r.fg|=1073741824:i===9?r.fg|=2147483648:i===2?r.bg|=134217728:i===21?this._processUnderline(2,r):i===22?(r.fg&=-134217729,r.bg&=-134217729):i===23?r.bg&=-67108865:i===24?(r.fg&=-268435457,this._processUnderline(0,r)):i===25?r.fg&=-536870913:i===27?r.fg&=-67108865:i===28?r.fg&=-1073741825:i===29?r.fg&=2147483647:i===39?(r.fg&=-67108864,r.fg|=Ne.fg&16777215):i===49?(r.bg&=-67108864,r.bg|=Ne.bg&16777215):i===38||i===48||i===58?s+=this._extractColor(e,s,r):i===53?r.bg|=1073741824:i===55?r.bg&=-1073741825:i===59?(r.extended=r.extended.clone(),r.extended.underlineColor=-1,r.updateExtended()):i===100?(r.fg&=-67108864,r.fg|=Ne.fg&16777215,r.bg&=-67108864,r.bg|=Ne.bg&16777215):this._logService.debug("Unknown SGR attribute: %d.",i);return!0}deviceStatus(e){switch(e.params[0]){case 5:this._coreService.triggerDataEvent(`${j.ESC}[0n`);break;case 6:let t=this._activeBuffer.y+1,i=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${j.ESC}[${t};${i}R`);break}return!0}deviceStatusPrivate(e){switch(e.params[0]){case 6:let t=this._activeBuffer.y+1,i=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${j.ESC}[?${t};${i}R`);break;case 15:break;case 25:break;case 26:break;case 53:break}return!0}softReset(e){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=Ne.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(e){let t=e.length===0?1:e.params[0];if(t===0)this._coreService.decPrivateModes.cursorStyle=void 0,this._coreService.decPrivateModes.cursorBlink=void 0;else{switch(t){case 1:case 2:this._coreService.decPrivateModes.cursorStyle="block";break;case 3:case 4:this._coreService.decPrivateModes.cursorStyle="underline";break;case 5:case 6:this._coreService.decPrivateModes.cursorStyle="bar";break}let i=t%2===1;this._coreService.decPrivateModes.cursorBlink=i}return!0}setScrollRegion(e){let t=e.params[0]||1,i;return(e.length<2||(i=e.params[1])>this._bufferService.rows||i===0)&&(i=this._bufferService.rows),i>t&&(this._activeBuffer.scrollTop=t-1,this._activeBuffer.scrollBottom=i-1,this._setCursor(0,0)),!0}windowOptions(e){if(!Vm(e.params[0],this._optionsService.rawOptions.windowOptions))return!0;let t=e.length>1?e.params[1]:0;switch(e.params[0]){case 14:t!==2&&this._onRequestWindowsOptionsReport.fire(0);break;case 16:this._onRequestWindowsOptionsReport.fire(1);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${j.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:(t===0||t===2)&&(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>qm&&this._windowTitleStack.shift()),(t===0||t===1)&&(this._iconNameStack.push(this._iconName),this._iconNameStack.length>qm&&this._iconNameStack.shift());break;case 23:(t===0||t===2)&&this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),(t===0||t===1)&&this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop());break}return!0}saveCursor(e){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(e){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(e){return this._windowTitle=e,this._onTitleChange.fire(e),!0}setIconName(e){return this._iconName=e,!0}setOrReportIndexedColor(e){let t=[],i=e.split(";");for(;i.length>1;){let r=i.shift(),s=i.shift();if(/^\d+$/.exec(r)){let n=parseInt(r);if(Zm(n))if(s==="?")t.push({type:0,index:n});else{let o=jm(s);o&&t.push({type:1,index:n,color:o})}}}return t.length&&this._onColor.fire(t),!0}setHyperlink(e){let t=e.indexOf(";");if(t===-1)return!0;let i=e.slice(0,t).trim(),r=e.slice(t+1);return r?this._createHyperlink(i,r):i.trim()?!1:this._finishHyperlink()}_createHyperlink(e,t){this._getCurrentLinkId()&&this._finishHyperlink();let i=e.split(":"),r,s=i.findIndex(n=>n.startsWith("id="));return s!==-1&&(r=i[s].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:r,uri:t}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(e,t){let i=e.split(";");for(let r=0;r<i.length&&!(t>=this._specialColors.length);++r,++t)if(i[r]==="?")this._onColor.fire([{type:0,index:this._specialColors[t]}]);else{let s=jm(i[r]);s&&this._onColor.fire([{type:1,index:this._specialColors[t],color:s}])}return!0}setOrReportFgColor(e){return this._setOrReportSpecialColor(e,0)}setOrReportBgColor(e){return this._setOrReportSpecialColor(e,1)}setOrReportCursorColor(e){return this._setOrReportSpecialColor(e,2)}restoreIndexedColor(e){if(!e)return this._onColor.fire([{type:2}]),!0;let t=[],i=e.split(";");for(let r=0;r<i.length;++r)if(/^\d+$/.exec(i[r])){let s=parseInt(i[r]);Zm(s)&&t.push({type:2,index:s})}return t.length&&this._onColor.fire(t),!0}restoreFgColor(e){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(e){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(e){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,Wr),!0}selectCharset(e){return e.length!==2?(this.selectDefaultCharset(),!0):(e[0]==="/"||this._charsetService.setgCharset(S3[e[0]],Ge[e[1]]||Wr),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){let e=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,e,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=Ne.clone(),this._eraseAttrDataInternal=Ne.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=this._curAttrData.bg&67108863,this._eraseAttrDataInternal}setgLevel(e){return this._charsetService.setgLevel(e),!0}screenAlignmentPattern(){let e=new $t;e.content=1<<22|69,e.fg=this._curAttrData.fg,e.bg=this._curAttrData.bg,this._setCursor(0,0);for(let t=0;t<this._bufferService.rows;++t){let i=this._activeBuffer.ybase+this._activeBuffer.y+t,r=this._activeBuffer.lines.get(i);r&&(r.fill(e),r.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(e,t){let i=o=>(this._coreService.triggerDataEvent(`${j.ESC}${o}${j.ESC}\\`),!0),r=this._bufferService.buffer,s=this._optionsService.rawOptions;return i(e==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:e==='"p'?'P1$r61;1"p':e==="r"?`P1$r${r.scrollTop+1};${r.scrollBottom+1}r`:e==="m"?"P1$r0m":e===" q"?`P1$r${{block:2,underline:4,bar:6}[s.cursorStyle]-(s.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(e,t){this._dirtyRowTracker.markRangeDirty(e,t)}},Ku=class{constructor(e){this._bufferService=e,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(e){e<this.start?this.start=e:e>this.end&&(this.end=e)}markRangeDirty(e,t){e>t&&(Jm=e,e=t,t=Jm),e<this.start&&(this.start=e),t>this.end&&(this.end=t)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};Ku=Me([Z(0,vt)],Ku);function Zm(e){return 0<=e&&e<256}var k3=5e7,ev=12,E3=50,B3=class extends oe{constructor(e){super(),this._action=e,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this._register(new Y),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(e,t){if(t!==void 0&&this._syncCalls>t){this._syncCalls=0;return}if(this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;this._isSyncWriting=!0;let i;for(;i=this._writeBuffer.shift();){this._action(i);let r=this._callbacks.shift();r&&r()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(e,t){if(this._pendingData>k3)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput){this._didUserInput=!1,this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(t),this._innerWrite();return}setTimeout(()=>this._innerWrite())}this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(t)}_innerWrite(e=0,t=!0){let i=e||performance.now();for(;this._writeBuffer.length>this._bufferOffset;){let r=this._writeBuffer[this._bufferOffset],s=this._action(r,t);if(s){let o=a=>performance.now()-i>=ev?setTimeout(()=>this._innerWrite(0,a)):this._innerWrite(i,a);s.catch(a=>(queueMicrotask(()=>{throw a}),Promise.resolve(!1))).then(o);return}let n=this._callbacks[this._bufferOffset];if(n&&n(),this._bufferOffset++,this._pendingData-=r.length,performance.now()-i>=ev)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>E3&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}},Nu=class{constructor(e){this._bufferService=e,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(e){let t=this._bufferService.buffer;if(e.id===void 0){let a=t.addMarker(t.ybase+t.y),h={data:e,id:this._nextId++,lines:[a]};return a.onDispose(()=>this._removeMarkerFromLink(h,a)),this._dataByLinkId.set(h.id,h),h.id}let i=e,r=this._getEntryIdKey(i),s=this._entriesWithId.get(r);if(s)return this.addLineToLink(s.id,t.ybase+t.y),s.id;let n=t.addMarker(t.ybase+t.y),o={id:this._nextId++,key:this._getEntryIdKey(i),data:i,lines:[n]};return n.onDispose(()=>this._removeMarkerFromLink(o,n)),this._entriesWithId.set(o.key,o),this._dataByLinkId.set(o.id,o),o.id}addLineToLink(e,t){let i=this._dataByLinkId.get(e);if(i&&i.lines.every(r=>r.line!==t)){let r=this._bufferService.buffer.addMarker(t);i.lines.push(r),r.onDispose(()=>this._removeMarkerFromLink(i,r))}}getLinkData(e){return this._dataByLinkId.get(e)?.data}_getEntryIdKey(e){return`${e.id};;${e.uri}`}_removeMarkerFromLink(e,t){let i=e.lines.indexOf(t);i!==-1&&(e.lines.splice(i,1),e.lines.length===0&&(e.data.id!==void 0&&this._entriesWithId.delete(e.key),this._dataByLinkId.delete(e.id)))}};Nu=Me([Z(0,vt)],Nu);var tv=!1,L3=class extends oe{constructor(e){super(),this._windowsWrappingHeuristics=this._register(new Ss),this._onBinary=this._register(new Y),this.onBinary=this._onBinary.event,this._onData=this._register(new Y),this.onData=this._onData.event,this._onLineFeed=this._register(new Y),this.onLineFeed=this._onLineFeed.event,this._onResize=this._register(new Y),this.onResize=this._onResize.event,this._onWriteParsed=this._register(new Y),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this._register(new Y),this._instantiationService=new JE,this.optionsService=this._register(new h3(e)),this._instantiationService.setService(yt,this.optionsService),this._bufferService=this._register(this._instantiationService.createInstance(Ru)),this._instantiationService.setService(vt,this._bufferService),this._logService=this._register(this._instantiationService.createInstance(Tu)),this._instantiationService.setService(_v,this._logService),this.coreService=this._register(this._instantiationService.createInstance(Fu)),this._instantiationService.setService(Vr,this.coreService),this.coreMouseService=this._register(this._instantiationService.createInstance(Pu)),this._instantiationService.setService(fv,this.coreMouseService),this.unicodeService=this._register(this._instantiationService.createInstance($r)),this._instantiationService.setService(w5,this.unicodeService),this._charsetService=this._instantiationService.createInstance(_3),this._instantiationService.setService(b5,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(Nu),this._instantiationService.setService(pv,this._oscLinkService),this._inputHandler=this._register(new C3(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this._register(ot.forward(this._inputHandler.onLineFeed,this._onLineFeed)),this._register(this._inputHandler),this._register(ot.forward(this._bufferService.onResize,this._onResize)),this._register(ot.forward(this.coreService.onData,this._onData)),this._register(ot.forward(this.coreService.onBinary,this._onBinary)),this._register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom(!0))),this._register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this._register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this._register(this._bufferService.onScroll(()=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this._register(new B3((t,i)=>this._inputHandler.parse(t,i))),this._register(ot.forward(this._writeBuffer.onWriteParsed,this._onWriteParsed))}get onScroll(){return this._onScrollApi||(this._onScrollApi=this._register(new Y),this._onScroll.event(e=>{this._onScrollApi?.fire(e.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(e){for(let t in e)this.optionsService.options[t]=e[t]}write(e,t){this._writeBuffer.write(e,t)}writeSync(e,t){this._logService.logLevel<=3&&!tv&&(this._logService.warn("writeSync is unreliable and will be removed soon."),tv=!0),this._writeBuffer.writeSync(e,t)}input(e,t=!0){this.coreService.triggerDataEvent(e,t)}resize(e,t){isNaN(e)||isNaN(t)||(e=Math.max(e,i1),t=Math.max(t,r1),this._bufferService.resize(e,t))}scroll(e,t=!1){this._bufferService.scroll(e,t)}scrollLines(e,t){this._bufferService.scrollLines(e,t)}scrollPages(e){this.scrollLines(e*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(e){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(e){let t=e-this._bufferService.buffer.ydisp;t!==0&&this.scrollLines(t)}registerEscHandler(e,t){return this._inputHandler.registerEscHandler(e,t)}registerDcsHandler(e,t){return this._inputHandler.registerDcsHandler(e,t)}registerCsiHandler(e,t){return this._inputHandler.registerCsiHandler(e,t)}registerOscHandler(e,t){return this._inputHandler.registerOscHandler(e,t)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let e=!1,t=this.optionsService.rawOptions.windowsPty;t&&t.buildNumber!==void 0&&t.buildNumber!==void 0?e=t.backend==="conpty"&&t.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(e=!0),e?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){let e=[];e.push(this.onLineFeed($m.bind(null,this._bufferService))),e.push(this.registerCsiHandler({final:"H"},()=>($m(this._bufferService),!1))),this._windowsWrappingHeuristics.value=Ae(()=>{for(let t of e)t.dispose()})}}},D3={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};function I3(e,t,i,r){let s={type:0,cancel:!1,key:void 0},n=(e.shiftKey?1:0)|(e.altKey?2:0)|(e.ctrlKey?4:0)|(e.metaKey?8:0);switch(e.keyCode){case 0:e.key==="UIKeyInputUpArrow"?t?s.key=j.ESC+"OA":s.key=j.ESC+"[A":e.key==="UIKeyInputLeftArrow"?t?s.key=j.ESC+"OD":s.key=j.ESC+"[D":e.key==="UIKeyInputRightArrow"?t?s.key=j.ESC+"OC":s.key=j.ESC+"[C":e.key==="UIKeyInputDownArrow"&&(t?s.key=j.ESC+"OB":s.key=j.ESC+"[B");break;case 8:s.key=e.ctrlKey?"\b":j.DEL,e.altKey&&(s.key=j.ESC+s.key);break;case 9:if(e.shiftKey){s.key=j.ESC+"[Z";break}s.key=j.HT,s.cancel=!0;break;case 13:s.key=e.altKey?j.ESC+j.CR:j.CR,s.cancel=!0;break;case 27:s.key=j.ESC,e.altKey&&(s.key=j.ESC+j.ESC),s.cancel=!0;break;case 37:if(e.metaKey)break;n?s.key=j.ESC+"[1;"+(n+1)+"D":t?s.key=j.ESC+"OD":s.key=j.ESC+"[D";break;case 39:if(e.metaKey)break;n?s.key=j.ESC+"[1;"+(n+1)+"C":t?s.key=j.ESC+"OC":s.key=j.ESC+"[C";break;case 38:if(e.metaKey)break;n?s.key=j.ESC+"[1;"+(n+1)+"A":t?s.key=j.ESC+"OA":s.key=j.ESC+"[A";break;case 40:if(e.metaKey)break;n?s.key=j.ESC+"[1;"+(n+1)+"B":t?s.key=j.ESC+"OB":s.key=j.ESC+"[B";break;case 45:!e.shiftKey&&!e.ctrlKey&&(s.key=j.ESC+"[2~");break;case 46:n?s.key=j.ESC+"[3;"+(n+1)+"~":s.key=j.ESC+"[3~";break;case 36:n?s.key=j.ESC+"[1;"+(n+1)+"H":t?s.key=j.ESC+"OH":s.key=j.ESC+"[H";break;case 35:n?s.key=j.ESC+"[1;"+(n+1)+"F":t?s.key=j.ESC+"OF":s.key=j.ESC+"[F";break;case 33:e.shiftKey?s.type=2:e.ctrlKey?s.key=j.ESC+"[5;"+(n+1)+"~":s.key=j.ESC+"[5~";break;case 34:e.shiftKey?s.type=3:e.ctrlKey?s.key=j.ESC+"[6;"+(n+1)+"~":s.key=j.ESC+"[6~";break;case 112:n?s.key=j.ESC+"[1;"+(n+1)+"P":s.key=j.ESC+"OP";break;case 113:n?s.key=j.ESC+"[1;"+(n+1)+"Q":s.key=j.ESC+"OQ";break;case 114:n?s.key=j.ESC+"[1;"+(n+1)+"R":s.key=j.ESC+"OR";break;case 115:n?s.key=j.ESC+"[1;"+(n+1)+"S":s.key=j.ESC+"OS";break;case 116:n?s.key=j.ESC+"[15;"+(n+1)+"~":s.key=j.ESC+"[15~";break;case 117:n?s.key=j.ESC+"[17;"+(n+1)+"~":s.key=j.ESC+"[17~";break;case 118:n?s.key=j.ESC+"[18;"+(n+1)+"~":s.key=j.ESC+"[18~";break;case 119:n?s.key=j.ESC+"[19;"+(n+1)+"~":s.key=j.ESC+"[19~";break;case 120:n?s.key=j.ESC+"[20;"+(n+1)+"~":s.key=j.ESC+"[20~";break;case 121:n?s.key=j.ESC+"[21;"+(n+1)+"~":s.key=j.ESC+"[21~";break;case 122:n?s.key=j.ESC+"[23;"+(n+1)+"~":s.key=j.ESC+"[23~";break;case 123:n?s.key=j.ESC+"[24;"+(n+1)+"~":s.key=j.ESC+"[24~";break;default:if(e.ctrlKey&&!e.shiftKey&&!e.altKey&&!e.metaKey)e.keyCode>=65&&e.keyCode<=90?s.key=String.fromCharCode(e.keyCode-64):e.keyCode===32?s.key=j.NUL:e.keyCode>=51&&e.keyCode<=55?s.key=String.fromCharCode(e.keyCode-51+27):e.keyCode===56?s.key=j.DEL:e.keyCode===219?s.key=j.ESC:e.keyCode===220?s.key=j.FS:e.keyCode===221&&(s.key=j.GS);else if((!i||r)&&e.altKey&&!e.metaKey){let o=D3[e.keyCode]?.[e.shiftKey?1:0];if(o)s.key=j.ESC+o;else if(e.keyCode>=65&&e.keyCode<=90){let a=e.ctrlKey?e.keyCode-64:e.keyCode+32,h=String.fromCharCode(a);e.shiftKey&&(h=h.toUpperCase()),s.key=j.ESC+h}else if(e.keyCode===32)s.key=j.ESC+(e.ctrlKey?j.NUL:" ");else if(e.key==="Dead"&&e.code.startsWith("Key")){let a=e.code.slice(3,4);e.shiftKey||(a=a.toLowerCase()),s.key=j.ESC+a,s.cancel=!0}}else i&&!e.altKey&&!e.ctrlKey&&!e.shiftKey&&e.metaKey?e.keyCode===65&&(s.type=1):e.key&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&e.keyCode>=48&&e.key.length===1?s.key=e.key:e.key&&e.ctrlKey&&(e.key==="_"&&(s.key=j.US),e.key==="@"&&(s.key=j.NUL));break}return s}var Pe=0,M3=class{constructor(e){this._getKey=e,this._array=[],this._insertedValues=[],this._flushInsertedTask=new tl,this._isFlushingInserted=!1,this._deletedIndices=[],this._flushDeletedTask=new tl,this._isFlushingDeleted=!1}clear(){this._array.length=0,this._insertedValues.length=0,this._flushInsertedTask.clear(),this._isFlushingInserted=!1,this._deletedIndices.length=0,this._flushDeletedTask.clear(),this._isFlushingDeleted=!1}insert(e){this._flushCleanupDeleted(),this._insertedValues.length===0&&this._flushInsertedTask.enqueue(()=>this._flushInserted()),this._insertedValues.push(e)}_flushInserted(){let e=this._insertedValues.sort((s,n)=>this._getKey(s)-this._getKey(n)),t=0,i=0,r=new Array(this._array.length+this._insertedValues.length);for(let s=0;s<r.length;s++)i>=this._array.length||this._getKey(e[t])<=this._getKey(this._array[i])?(r[s]=e[t],t++):r[s]=this._array[i++];this._array=r,this._insertedValues.length=0}_flushCleanupInserted(){!this._isFlushingInserted&&this._insertedValues.length>0&&this._flushInsertedTask.flush()}delete(e){if(this._flushCleanupInserted(),this._array.length===0)return!1;let t=this._getKey(e);if(t===void 0||(Pe=this._search(t),Pe===-1)||this._getKey(this._array[Pe])!==t)return!1;do if(this._array[Pe]===e)return this._deletedIndices.length===0&&this._flushDeletedTask.enqueue(()=>this._flushDeleted()),this._deletedIndices.push(Pe),!0;while(++Pe<this._array.length&&this._getKey(this._array[Pe])===t);return!1}_flushDeleted(){this._isFlushingDeleted=!0;let e=this._deletedIndices.sort((s,n)=>s-n),t=0,i=new Array(this._array.length-e.length),r=0;for(let s=0;s<this._array.length;s++)e[t]===s?t++:i[r++]=this._array[s];this._array=i,this._deletedIndices.length=0,this._isFlushingDeleted=!1}_flushCleanupDeleted(){!this._isFlushingDeleted&&this._deletedIndices.length>0&&this._flushDeletedTask.flush()}*getKeyIterator(e){if(this._flushCleanupInserted(),this._flushCleanupDeleted(),this._array.length!==0&&(Pe=this._search(e),!(Pe<0||Pe>=this._array.length)&&this._getKey(this._array[Pe])===e))do yield this._array[Pe];while(++Pe<this._array.length&&this._getKey(this._array[Pe])===e)}forEachByKey(e,t){if(this._flushCleanupInserted(),this._flushCleanupDeleted(),this._array.length!==0&&(Pe=this._search(e),!(Pe<0||Pe>=this._array.length)&&this._getKey(this._array[Pe])===e))do t(this._array[Pe]);while(++Pe<this._array.length&&this._getKey(this._array[Pe])===e)}values(){return this._flushCleanupInserted(),this._flushCleanupDeleted(),[...this._array].values()}_search(e){let t=0,i=this._array.length-1;for(;i>=t;){let r=t+i>>1,s=this._getKey(this._array[r]);if(s>e)i=r-1;else if(s<e)t=r+1;else{for(;r>0&&this._getKey(this._array[r-1])===e;)r--;return r}}return t}},iu=0,iv=0,T3=class extends oe{constructor(){super(),this._decorations=new M3(e=>e?.marker.line),this._onDecorationRegistered=this._register(new Y),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this._register(new Y),this.onDecorationRemoved=this._onDecorationRemoved.event,this._register(Ae(()=>this.reset()))}get decorations(){return this._decorations.values()}registerDecoration(e){if(e.marker.isDisposed)return;let t=new R3(e);if(t){let i=t.marker.onDispose(()=>t.dispose()),r=t.onDispose(()=>{r.dispose(),t&&(this._decorations.delete(t)&&this._onDecorationRemoved.fire(t),i.dispose())});this._decorations.insert(t),this._onDecorationRegistered.fire(t)}return t}reset(){for(let e of this._decorations.values())e.dispose();this._decorations.clear()}*getDecorationsAtCell(e,t,i){let r=0,s=0;for(let n of this._decorations.getKeyIterator(t))r=n.options.x??0,s=r+(n.options.width??1),e>=r&&e<s&&(!i||(n.options.layer??"bottom")===i)&&(yield n)}forEachDecorationAtCell(e,t,i,r){this._decorations.forEachByKey(t,s=>{iu=s.options.x??0,iv=iu+(s.options.width??1),e>=iu&&e<iv&&(!i||(s.options.layer??"bottom")===i)&&r(s)})}},R3=class extends br{constructor(e){super(),this.options=e,this.onRenderEmitter=this.add(new Y),this.onRender=this.onRenderEmitter.event,this._onDispose=this.add(new Y),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=e.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=Le.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=Le.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}dispose(){this._onDispose.fire(),super.dispose()}},F3=1e3,P3=class{constructor(e,t=F3){this._renderCallback=e,this._debounceThresholdMS=t,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(e,t,i){this._rowCount=i,e=e!==void 0?e:0,t=t!==void 0?t:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,e):e,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,t):t;let r=performance.now();if(r-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=r,this._innerRefresh();else if(!this._additionalRefreshRequested){let s=r-this._lastRefreshMs,n=this._debounceThresholdMS-s;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=performance.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},n)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;let e=Math.max(this._rowStart,0),t=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(e,t)}},rv=20,sv=!1,il=class extends oe{constructor(e,t,i,r){super(),this._terminal=e,this._coreBrowserService=i,this._renderService=r,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="";let s=this._coreBrowserService.mainDocument;this._accessibilityContainer=s.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=s.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let n=0;n<this._terminal.rows;n++)this._rowElements[n]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[n]);if(this._topBoundaryFocusListener=n=>this._handleBoundaryFocus(n,0),this._bottomBoundaryFocusListener=n=>this._handleBoundaryFocus(n,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=s.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this._register(new P3(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");sv?(this._accessibilityContainer.classList.add("debug"),this._rowContainer.classList.add("debug"),this._debugRootContainer=s.createElement("div"),this._debugRootContainer.classList.add("xterm"),this._debugRootContainer.appendChild(s.createTextNode("------start a11y------")),this._debugRootContainer.appendChild(this._accessibilityContainer),this._debugRootContainer.appendChild(s.createTextNode("------end a11y------")),this._terminal.element.insertAdjacentElement("afterend",this._debugRootContainer)):this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this._register(this._terminal.onResize(n=>this._handleResize(n.rows))),this._register(this._terminal.onRender(n=>this._refreshRows(n.start,n.end))),this._register(this._terminal.onScroll(()=>this._refreshRows())),this._register(this._terminal.onA11yChar(n=>this._handleChar(n))),this._register(this._terminal.onLineFeed(()=>this._handleChar(`
`))),this._register(this._terminal.onA11yTab(n=>this._handleTab(n))),this._register(this._terminal.onKey(n=>this._handleKey(n.key))),this._register(this._terminal.onBlur(()=>this._clearLiveRegion())),this._register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this._register(se(s,"selectionchange",()=>this._handleSelectionChange())),this._register(this._coreBrowserService.onDprChange(()=>this._refreshRowsDimensions())),this._refreshRowsDimensions(),this._refreshRows(),this._register(Ae(()=>{sv?this._debugRootContainer.remove():this._accessibilityContainer.remove(),this._rowElements.length=0}))}_handleTab(e){for(let t=0;t<e;t++)this._handleChar(" ")}_handleChar(e){this._liveRegionLineCount<rv+1&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==e&&(this._charsToAnnounce+=e):this._charsToAnnounce+=e,e===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===rv+1&&(this._liveRegion.textContent+=su.get())))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey(e){this._clearLiveRegion(),/\p{Control}/u.test(e)||this._charsToConsume.push(e)}_refreshRows(e,t){this._liveRegionDebouncer.refresh(e,t,this._terminal.rows)}_renderRows(e,t){let i=this._terminal.buffer,r=i.lines.length.toString();for(let s=e;s<=t;s++){let n=i.lines.get(i.ydisp+s),o=[],a=n?.translateToString(!0,void 0,void 0,o)||"",h=(i.ydisp+s+1).toString(),l=this._rowElements[s];l&&(a.length===0?(l.textContent="\xA0",this._rowColumns.set(l,[0,1])):(l.textContent=a,this._rowColumns.set(l,o)),l.setAttribute("aria-posinset",h),l.setAttribute("aria-setsize",r),this._alignRowWidth(l))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(e,t){let i=e.target,r=this._rowElements[t===0?1:this._rowElements.length-2],s=i.getAttribute("aria-posinset"),n=t===0?"1":`${this._terminal.buffer.lines.length}`;if(s===n||e.relatedTarget!==r)return;let o,a;if(t===0?(o=i,a=this._rowElements.pop(),this._rowContainer.removeChild(a)):(o=this._rowElements.shift(),a=i,this._rowContainer.removeChild(o)),o.removeEventListener("focus",this._topBoundaryFocusListener),a.removeEventListener("focus",this._bottomBoundaryFocusListener),t===0){let h=this._createAccessibilityTreeNode();this._rowElements.unshift(h),this._rowContainer.insertAdjacentElement("afterbegin",h)}else{let h=this._createAccessibilityTreeNode();this._rowElements.push(h),this._rowContainer.appendChild(h)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(t===0?-1:1),this._rowElements[t===0?1:this._rowElements.length-2].focus(),e.preventDefault(),e.stopImmediatePropagation()}_handleSelectionChange(){if(this._rowElements.length===0)return;let e=this._coreBrowserService.mainDocument.getSelection();if(!e)return;if(e.isCollapsed){this._rowContainer.contains(e.anchorNode)&&this._terminal.clearSelection();return}if(!e.anchorNode||!e.focusNode){console.error("anchorNode and/or focusNode are null");return}let t={node:e.anchorNode,offset:e.anchorOffset},i={node:e.focusNode,offset:e.focusOffset};if((t.node.compareDocumentPosition(i.node)&Node.DOCUMENT_POSITION_PRECEDING||t.node===i.node&&t.offset>i.offset)&&([t,i]=[i,t]),t.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(t={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(t.node))return;let r=this._rowElements.slice(-1)[0];if(i.node.compareDocumentPosition(r)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(i={node:r,offset:r.textContent?.length??0}),!this._rowContainer.contains(i.node))return;let s=({node:a,offset:h})=>{let l=a instanceof Text?a.parentNode:a,c=parseInt(l?.getAttribute("aria-posinset"),10)-1;if(isNaN(c))return console.warn("row is invalid. Race condition?"),null;let u=this._rowColumns.get(l);if(!u)return console.warn("columns is null. Race condition?"),null;let g=h<u.length?u[h]:u.slice(-1)[0]+1;return g>=this._terminal.cols&&(++c,g=0),{row:c,column:g}},n=s(t),o=s(i);if(!(!n||!o)){if(n.row>o.row||n.row===o.row&&n.column>=o.column)throw new Error("invalid range");this._terminal.select(n.column,n.row,(o.row-n.row)*this._terminal.cols-n.column+o.column)}}_handleResize(e){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let t=this._rowContainer.children.length;t<this._terminal.rows;t++)this._rowElements[t]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[t]);for(;this._rowElements.length>e;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){let e=this._coreBrowserService.mainDocument.createElement("div");return e.setAttribute("role","listitem"),e.tabIndex=-1,this._refreshRowDimensions(e),e}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){Object.assign(this._accessibilityContainer.style,{width:`${this._renderService.dimensions.css.canvas.width}px`,fontSize:`${this._terminal.options.fontSize}px`}),this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let e=0;e<this._terminal.rows;e++)this._refreshRowDimensions(this._rowElements[e]),this._alignRowWidth(this._rowElements[e])}}_refreshRowDimensions(e){e.style.height=`${this._renderService.dimensions.css.cell.height}px`}_alignRowWidth(e){e.style.transform="";let t=e.getBoundingClientRect().width,i=this._rowColumns.get(e)?.slice(-1)?.[0];if(!i)return;let r=i*this._renderService.dimensions.css.cell.width;e.style.transform=`scaleX(${r/t})`}};il=Me([Z(1,Hu),Z(2,Pi),Z(3,Oi)],il);var Qu=class extends oe{constructor(e,t,i,r,s){super(),this._element=e,this._mouseService=t,this._renderService=i,this._bufferService=r,this._linkProviderService=s,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this._register(new Y),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this._register(new Y),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this._register(Ae(()=>{jr(this._linkCacheDisposables),this._linkCacheDisposables.length=0,this._lastMouseEvent=void 0,this._activeProviderReplies?.clear()})),this._register(this._bufferService.onResize(()=>{this._clearCurrentLink(),this._wasResized=!0})),this._register(se(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this._register(se(this._element,"mousemove",this._handleMouseMove.bind(this))),this._register(se(this._element,"mousedown",this._handleMouseDown.bind(this))),this._register(se(this._element,"mouseup",this._handleMouseUp.bind(this)))}get currentLink(){return this._currentLink}_handleMouseMove(e){this._lastMouseEvent=e;let t=this._positionFromMouseEvent(e,this._element,this._mouseService);if(!t)return;this._isMouseOut=!1;let i=e.composedPath();for(let r=0;r<i.length;r++){let s=i[r];if(s.classList.contains("xterm"))break;if(s.classList.contains("xterm-hover"))return}(!this._lastBufferCell||t.x!==this._lastBufferCell.x||t.y!==this._lastBufferCell.y)&&(this._handleHover(t),this._lastBufferCell=t)}_handleHover(e){if(this._activeLine!==e.y||this._wasResized){this._clearCurrentLink(),this._askForLink(e,!1),this._wasResized=!1;return}this._currentLink&&this._linkAtPosition(this._currentLink.link,e)||(this._clearCurrentLink(),this._askForLink(e,!0))}_askForLink(e,t){(!this._activeProviderReplies||!t)&&(this._activeProviderReplies?.forEach(r=>{r?.forEach(s=>{s.link.dispose&&s.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=e.y);let i=!1;for(let[r,s]of this._linkProviderService.linkProviders.entries())t?this._activeProviderReplies?.get(r)&&(i=this._checkLinkProviderResult(r,e,i)):s.provideLinks(e.y,n=>{if(this._isMouseOut)return;let o=n?.map(a=>({link:a}));this._activeProviderReplies?.set(r,o),i=this._checkLinkProviderResult(r,e,i),this._activeProviderReplies?.size===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks(e.y,this._activeProviderReplies)})}_removeIntersectingLinks(e,t){let i=new Set;for(let r=0;r<t.size;r++){let s=t.get(r);if(s)for(let n=0;n<s.length;n++){let o=s[n],a=o.link.range.start.y<e?0:o.link.range.start.x,h=o.link.range.end.y>e?this._bufferService.cols:o.link.range.end.x;for(let l=a;l<=h;l++){if(i.has(l)){s.splice(n--,1);break}i.add(l)}}}}_checkLinkProviderResult(e,t,i){if(!this._activeProviderReplies)return i;let r=this._activeProviderReplies.get(e),s=!1;for(let n=0;n<e;n++)(!this._activeProviderReplies.has(n)||this._activeProviderReplies.get(n))&&(s=!0);if(!s&&r){let n=r.find(o=>this._linkAtPosition(o.link,t));n&&(i=!0,this._handleNewLink(n))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!i)for(let n=0;n<this._activeProviderReplies.size;n++){let o=this._activeProviderReplies.get(n)?.find(a=>this._linkAtPosition(a.link,t));if(o){i=!0,this._handleNewLink(o);break}}return i}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(e){if(!this._currentLink)return;let t=this._positionFromMouseEvent(e,this._element,this._mouseService);t&&this._mouseDownLink&&O3(this._mouseDownLink.link,this._currentLink.link)&&this._linkAtPosition(this._currentLink.link,t)&&this._currentLink.link.activate(e,this._currentLink.link.text)}_clearCurrentLink(e,t){!this._currentLink||!this._lastMouseEvent||(!e||!t||this._currentLink.link.range.start.y>=e&&this._currentLink.link.range.end.y<=t)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,jr(this._linkCacheDisposables),this._linkCacheDisposables.length=0)}_handleNewLink(e){if(!this._lastMouseEvent)return;let t=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);t&&this._linkAtPosition(e.link,t)&&(this._currentLink=e,this._currentLink.state={decorations:{underline:e.link.decorations===void 0?!0:e.link.decorations.underline,pointerCursor:e.link.decorations===void 0?!0:e.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,e.link,this._lastMouseEvent),e.link.decorations={},Object.defineProperties(e.link.decorations,{pointerCursor:{get:()=>this._currentLink?.state?.decorations.pointerCursor,set:i=>{this._currentLink?.state&&this._currentLink.state.decorations.pointerCursor!==i&&(this._currentLink.state.decorations.pointerCursor=i,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",i))}},underline:{get:()=>this._currentLink?.state?.decorations.underline,set:i=>{this._currentLink?.state&&this._currentLink?.state?.decorations.underline!==i&&(this._currentLink.state.decorations.underline=i,this._currentLink.state.isHovered&&this._fireUnderlineEvent(e.link,i))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange(i=>{if(!this._currentLink)return;let r=i.start===0?0:i.start+1+this._bufferService.buffer.ydisp,s=this._bufferService.buffer.ydisp+1+i.end;if(this._currentLink.link.range.start.y>=r&&this._currentLink.link.range.end.y<=s&&(this._clearCurrentLink(r,s),this._lastMouseEvent)){let n=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);n&&this._askForLink(n,!1)}})))}_linkHover(e,t,i){this._currentLink?.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(t,!0),this._currentLink.state.decorations.pointerCursor&&e.classList.add("xterm-cursor-pointer")),t.hover&&t.hover(i,t.text)}_fireUnderlineEvent(e,t){let i=e.range,r=this._bufferService.buffer.ydisp,s=this._createLinkUnderlineEvent(i.start.x-1,i.start.y-r-1,i.end.x,i.end.y-r-1,void 0);(t?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(s)}_linkLeave(e,t,i){this._currentLink?.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(t,!1),this._currentLink.state.decorations.pointerCursor&&e.classList.remove("xterm-cursor-pointer")),t.leave&&t.leave(i,t.text)}_linkAtPosition(e,t){let i=e.range.start.y*this._bufferService.cols+e.range.start.x,r=e.range.end.y*this._bufferService.cols+e.range.end.x,s=t.y*this._bufferService.cols+t.x;return i<=s&&s<=r}_positionFromMouseEvent(e,t,i){let r=i.getCoords(e,t,this._bufferService.cols,this._bufferService.rows);if(r)return{x:r[0],y:r[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(e,t,i,r,s){return{x1:e,y1:t,x2:i,y2:r,cols:this._bufferService.cols,fg:s}}};Qu=Me([Z(1,Xu),Z(2,Oi),Z(3,vt),Z(4,mv)],Qu);function O3(e,t){return e.text===t.text&&e.range.start.x===t.range.start.x&&e.range.start.y===t.range.start.y&&e.range.end.x===t.range.end.x&&e.range.end.y===t.range.end.y}var K3=class extends L3{constructor(e={}){super(e),this._linkifier=this._register(new Ss),this.browser=Wv,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this._register(new Ss),this._onCursorMove=this._register(new Y),this.onCursorMove=this._onCursorMove.event,this._onKey=this._register(new Y),this.onKey=this._onKey.event,this._onRender=this._register(new Y),this.onRender=this._onRender.event,this._onSelectionChange=this._register(new Y),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this._register(new Y),this.onTitleChange=this._onTitleChange.event,this._onBell=this._register(new Y),this.onBell=this._onBell.event,this._onFocus=this._register(new Y),this._onBlur=this._register(new Y),this._onA11yCharEmitter=this._register(new Y),this._onA11yTabEmitter=this._register(new Y),this._onWillOpen=this._register(new Y),this._setup(),this._decorationService=this._instantiationService.createInstance(T3),this._instantiationService.setService(qn,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(kE),this._instantiationService.setService(mv,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(ou)),this._register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this._register(this._inputHandler.onRequestRefreshRows(t=>this.refresh(t?.start??0,t?.end??this.rows-1))),this._register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this._register(this._inputHandler.onRequestReset(()=>this.reset())),this._register(this._inputHandler.onRequestWindowsOptionsReport(t=>this._reportWindowsOptions(t))),this._register(this._inputHandler.onColor(t=>this._handleColorEvent(t))),this._register(ot.forward(this._inputHandler.onCursorMove,this._onCursorMove)),this._register(ot.forward(this._inputHandler.onTitleChange,this._onTitleChange)),this._register(ot.forward(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this._register(ot.forward(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this._register(this._bufferService.onResize(t=>this._afterResize(t.cols,t.rows))),this._register(Ae(()=>{this._customKeyEventHandler=void 0,this.element?.parentNode?.removeChild(this.element)}))}get linkifier(){return this._linkifier.value}get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}_handleColorEvent(e){if(this._themeService)for(let t of e){let i,r="";switch(t.index){case 256:i="foreground",r="10";break;case 257:i="background",r="11";break;case 258:i="cursor",r="12";break;default:i="ansi",r="4;"+t.index}switch(t.type){case 0:let s=we.toColorRGB(i==="ansi"?this._themeService.colors.ansi[t.index]:this._themeService.colors[i]);this.coreService.triggerDataEvent(`${j.ESC}]${r};${x3(s)}${Uv.ST}`);break;case 1:if(i==="ansi")this._themeService.modifyColors(n=>n.ansi[t.index]=Qe.toColor(...t.color));else{let n=i;this._themeService.modifyColors(o=>o[n]=Qe.toColor(...t.color))}break;case 2:this._themeService.restoreColor(t.index);break}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(e){e?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(il,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(e){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(j.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){return this.textarea?.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(j.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;let e=this.buffer.ybase+this.buffer.y,t=this.buffer.lines.get(e);if(!t)return;let i=Math.min(this.buffer.x,this.cols-1),r=this._renderService.dimensions.css.cell.height,s=t.getWidth(i),n=this._renderService.dimensions.css.cell.width*s,o=this.buffer.y*this._renderService.dimensions.css.cell.height,a=i*this._renderService.dimensions.css.cell.width;this.textarea.style.left=a+"px",this.textarea.style.top=o+"px",this.textarea.style.width=n+"px",this.textarea.style.height=r+"px",this.textarea.style.lineHeight=r+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this._register(se(this.element,"copy",t=>{this.hasSelection()&&_5(t,this._selectionService)}));let e=t=>p5(t,this.textarea,this.coreService,this.optionsService);this._register(se(this.textarea,"paste",e)),this._register(se(this.element,"paste",e)),$v?this._register(se(this.element,"mousedown",t=>{t.button===2&&nm(t,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this._register(se(this.element,"contextmenu",t=>{nm(t,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),Vu&&this._register(se(this.element,"auxclick",t=>{t.button===1&&lv(t,this.textarea,this.screenElement)}))}_bindKeys(){this._register(se(this.textarea,"keyup",e=>this._keyUp(e),!0)),this._register(se(this.textarea,"keydown",e=>this._keyDown(e),!0)),this._register(se(this.textarea,"keypress",e=>this._keyPress(e),!0)),this._register(se(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this._register(se(this.textarea,"compositionupdate",e=>this._compositionHelper.compositionupdate(e))),this._register(se(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this._register(se(this.textarea,"input",e=>this._inputEvent(e),!0)),this._register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(e){if(!e)throw new Error("Terminal requires a parent element.");if(e.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this.element?.ownerDocument.defaultView&&this._coreBrowserService){this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView);return}this._document=e.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),e.appendChild(this.element);let t=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),t.appendChild(this._viewportElement),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._register(se(this.screenElement,"mousemove",s=>this.updateCursorStyle(s))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),t.appendChild(this.screenElement);let i=this.textarea=this._document.createElement("textarea");this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",ru.get()),qv||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._register(this.optionsService.onSpecificOptionChange("disableStdin",()=>i.readOnly=this.optionsService.rawOptions.disableStdin)),this.textarea.readOnly=this.optionsService.rawOptions.disableStdin,this._coreBrowserService=this._register(this._instantiationService.createInstance(SE,this.textarea,e.ownerDocument.defaultView??window,this._document??typeof window<"u"?window.document:null)),this._instantiationService.setService(Pi,this._coreBrowserService),this._register(se(this.textarea,"focus",s=>this._handleTextAreaFocus(s))),this._register(se(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(Bu,this._document,this._helperContainer),this._instantiationService.setService(sl,this._charSizeService),this._themeService=this._instantiationService.createInstance(Mu),this._instantiationService.setService(Cs,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(Za),this._instantiationService.setService(gv,this._characterJoinerService),this._renderService=this._register(this._instantiationService.createInstance(Du,this.rows,this.screenElement)),this._instantiationService.setService(Oi,this._renderService),this._register(this._renderService.onRenderedViewportChange(s=>this._onRender.fire(s))),this.onResize(s=>this._renderService.resize(s.cols,s.rows)),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(Cu,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(Lu),this._instantiationService.setService(Xu,this._mouseService);let r=this._linkifier.value=this._register(this._instantiationService.createInstance(Qu,this.screenElement));this.element.appendChild(t);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this._register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this._register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this._register(this.onBlur(()=>this._renderService.handleBlur())),this._register(this.onFocus(()=>this._renderService.handleFocus())),this._viewport=this._register(this._instantiationService.createInstance(xu,this.element,this.screenElement)),this._register(this._viewport.onRequestScrollLines(s=>{super.scrollLines(s,!1),this.refresh(0,this.rows-1)})),this._selectionService=this._register(this._instantiationService.createInstance(Iu,this.element,this.screenElement,r)),this._instantiationService.setService(x5,this._selectionService),this._register(this._selectionService.onRequestScrollLines(s=>this.scrollLines(s.amount,s.suppressScrollEvent))),this._register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this._register(this._selectionService.onRequestRedraw(s=>this._renderService.handleSelectionChanged(s.start,s.end,s.columnSelectMode))),this._register(this._selectionService.onLinuxMouseSelection(s=>{this.textarea.value=s,this.textarea.focus(),this.textarea.select()})),this._register(ot.any(this._onScroll.event,this._inputHandler.onScroll)(()=>{this._selectionService.refresh(),this._viewport?.queueSync()})),this._register(this._instantiationService.createInstance(Su,this.screenElement)),this._register(se(this.element,"mousedown",s=>this._selectionService.handleMouseDown(s))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(il,this)),this._register(this.optionsService.onSpecificOptionChange("screenReaderMode",s=>this._handleScreenReaderModeOptionChange(s))),this.options.overviewRuler.width&&(this._overviewRulerRenderer=this._register(this._instantiationService.createInstance(Ja,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRuler",s=>{!this._overviewRulerRenderer&&s&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this._register(this._instantiationService.createInstance(Ja,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(Eu,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){let e=this,t=this.element;function i(n){let o=e._mouseService.getMouseReportCoords(n,e.screenElement);if(!o)return!1;let a,h;switch(n.overrideType||n.type){case"mousemove":h=32,n.buttons===void 0?(a=3,n.button!==void 0&&(a=n.button<3?n.button:3)):a=n.buttons&1?0:n.buttons&4?1:n.buttons&2?2:3;break;case"mouseup":h=0,a=n.button<3?n.button:3;break;case"mousedown":h=1,a=n.button<3?n.button:3;break;case"wheel":if(e._customWheelEventHandler&&e._customWheelEventHandler(n)===!1)return!1;let l=n.deltaY;if(l===0||e.coreMouseService.consumeWheelEvent(n,e._renderService?.dimensions?.device?.cell?.height,e._coreBrowserService?.dpr)===0)return!1;h=l<0?0:1,a=4;break;default:return!1}return h===void 0||a===void 0||a>4?!1:e.coreMouseService.triggerMouseEvent({col:o.col,row:o.row,x:o.x,y:o.y,button:a,action:h,ctrl:n.ctrlKey,alt:n.altKey,shift:n.shiftKey})}let r={mouseup:null,wheel:null,mousedrag:null,mousemove:null},s={mouseup:n=>(i(n),n.buttons||(this._document.removeEventListener("mouseup",r.mouseup),r.mousedrag&&this._document.removeEventListener("mousemove",r.mousedrag)),this.cancel(n)),wheel:n=>(i(n),this.cancel(n,!0)),mousedrag:n=>{n.buttons&&i(n)},mousemove:n=>{n.buttons||i(n)}};this._register(this.coreMouseService.onProtocolChange(n=>{n?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(n)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),n&8?r.mousemove||(t.addEventListener("mousemove",s.mousemove),r.mousemove=s.mousemove):(t.removeEventListener("mousemove",r.mousemove),r.mousemove=null),n&16?r.wheel||(t.addEventListener("wheel",s.wheel,{passive:!1}),r.wheel=s.wheel):(t.removeEventListener("wheel",r.wheel),r.wheel=null),n&2?r.mouseup||(r.mouseup=s.mouseup):(this._document.removeEventListener("mouseup",r.mouseup),r.mouseup=null),n&4?r.mousedrag||(r.mousedrag=s.mousedrag):(this._document.removeEventListener("mousemove",r.mousedrag),r.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this._register(se(t,"mousedown",n=>{if(n.preventDefault(),this.focus(),!(!this.coreMouseService.areMouseEventsActive||this._selectionService.shouldForceSelection(n)))return i(n),r.mouseup&&this._document.addEventListener("mouseup",r.mouseup),r.mousedrag&&this._document.addEventListener("mousemove",r.mousedrag),this.cancel(n)})),this._register(se(t,"wheel",n=>{if(!r.wheel){if(this._customWheelEventHandler&&this._customWheelEventHandler(n)===!1)return!1;if(!this.buffer.hasScrollback){if(n.deltaY===0)return!1;if(e.coreMouseService.consumeWheelEvent(n,e._renderService?.dimensions?.device?.cell?.height,e._coreBrowserService?.dpr)===0)return this.cancel(n,!0);let o=j.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(n.deltaY<0?"A":"B");return this.coreService.triggerDataEvent(o,!0),this.cancel(n,!0)}}},{passive:!1}))}refresh(e,t){this._renderService?.refreshRows(e,t)}updateCursorStyle(e){this._selectionService?.shouldColumnSelect(e)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(e,t){this._viewport?this._viewport.scrollLines(e):super.scrollLines(e,t),this.refresh(0,this.rows-1)}scrollPages(e){this.scrollLines(e*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(e){e&&this._viewport?this._viewport.scrollToLine(this.buffer.ybase,!0):this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(e){let t=e-this._bufferService.buffer.ydisp;t!==0&&this.scrollLines(t)}paste(e){av(e,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(e){this._customKeyEventHandler=e}attachCustomWheelEventHandler(e){this._customWheelEventHandler=e}registerLinkProvider(e){return this._linkProviderService.registerLinkProvider(e)}registerCharacterJoiner(e){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");let t=this._characterJoinerService.register(e);return this.refresh(0,this.rows-1),t}deregisterCharacterJoiner(e){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(e)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(e){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+e)}registerDecoration(e){return this._decorationService.registerDecoration(e)}hasSelection(){return this._selectionService?this._selectionService.hasSelection:!1}select(e,t,i){this._selectionService.setSelection(e,t,i)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(!(!this._selectionService||!this._selectionService.hasSelection))return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){this._selectionService?.clearSelection()}selectAll(){this._selectionService?.selectAll()}selectLines(e,t){this._selectionService?.selectLines(e,t)}_keyDown(e){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(e)===!1)return!1;let t=this.browser.isMac&&this.options.macOptionIsMeta&&e.altKey;if(!t&&!this._compositionHelper.keydown(e))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(!0),!1;!t&&(e.key==="Dead"||e.key==="AltGraph")&&(this._unprocessedDeadKey=!0);let i=I3(e,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(e),i.type===3||i.type===2){let r=this.rows-1;return this.scrollLines(i.type===2?-r:r),this.cancel(e,!0)}if(i.type===1&&this.selectAll(),this._isThirdLevelShift(this.browser,e)||(i.cancel&&this.cancel(e,!0),!i.key)||e.key&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&e.key.length===1&&e.key.charCodeAt(0)>=65&&e.key.charCodeAt(0)<=90)return!0;if(this._unprocessedDeadKey)return this._unprocessedDeadKey=!1,!0;if((i.key===j.ETX||i.key===j.CR)&&(this.textarea.value=""),this._onKey.fire({key:i.key,domEvent:e}),this._showCursor(),this.coreService.triggerDataEvent(i.key,!0),!this.optionsService.rawOptions.screenReaderMode||e.altKey||e.ctrlKey)return this.cancel(e,!0);this._keyDownHandled=!0}_isThirdLevelShift(e,t){let i=e.isMac&&!this.options.macOptionIsMeta&&t.altKey&&!t.ctrlKey&&!t.metaKey||e.isWindows&&t.altKey&&t.ctrlKey&&!t.metaKey||e.isWindows&&t.getModifierState("AltGraph");return t.type==="keypress"?i:i&&(!t.keyCode||t.keyCode>47)}_keyUp(e){this._keyDownSeen=!1,!(this._customKeyEventHandler&&this._customKeyEventHandler(e)===!1)&&(N3(e)||this.focus(),this.updateCursorStyle(e),this._keyPressHandled=!1)}_keyPress(e){let t;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(e)===!1)return!1;if(this.cancel(e),e.charCode)t=e.charCode;else if(e.which===null||e.which===void 0)t=e.keyCode;else if(e.which!==0&&e.charCode!==0)t=e.which;else return!1;return!t||(e.altKey||e.ctrlKey||e.metaKey)&&!this._isThirdLevelShift(this.browser,e)?!1:(t=String.fromCharCode(t),this._onKey.fire({key:t,domEvent:e}),this._showCursor(),this.coreService.triggerDataEvent(t,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,!0)}_inputEvent(e){if(e.data&&e.inputType==="insertText"&&(!e.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;let t=e.data;return this.coreService.triggerDataEvent(t,!0),this.cancel(e),!0}return!1}resize(e,t){if(e===this.cols&&t===this.rows){this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure();return}super.resize(e,t)}_afterResize(e,t){this._charSizeService?.measure()}clear(){if(!(this.buffer.ybase===0&&this.buffer.y===0)){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let e=1;e<this.rows;e++)this.buffer.lines.push(this.buffer.getBlankLine(Ne));this._onScroll.fire({position:this.buffer.ydisp}),this.refresh(0,this.rows-1)}}reset(){this.options.rows=this.rows,this.options.cols=this.cols;let e=this._customKeyEventHandler;this._setup(),super.reset(),this._selectionService?.reset(),this._decorationService.reset(),this._customKeyEventHandler=e,this.refresh(0,this.rows-1)}clearTextureAtlas(){this._renderService?.clearTextureAtlas()}_reportFocus(){this.element?.classList.contains("focus")?this.coreService.triggerDataEvent(j.ESC+"[I"):this.coreService.triggerDataEvent(j.ESC+"[O")}_reportWindowsOptions(e){if(this._renderService)switch(e){case 0:let t=this._renderService.dimensions.css.canvas.width.toFixed(0),i=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${j.ESC}[4;${i};${t}t`);break;case 1:let r=this._renderService.dimensions.css.cell.width.toFixed(0),s=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${j.ESC}[6;${s};${r}t`);break}}cancel(e,t){if(!(!this.options.cancelEvents&&!t))return e.preventDefault(),e.stopPropagation(),!1}};function N3(e){return e.keyCode===16||e.keyCode===17||e.keyCode===18}var Q3=class{constructor(){this._addons=[]}dispose(){for(let e=this._addons.length-1;e>=0;e--)this._addons[e].instance.dispose()}loadAddon(e,t){let i={instance:t,dispose:t.dispose,isDisposed:!1};this._addons.push(i),t.dispose=()=>this._wrappedAddonDispose(i),t.activate(e)}_wrappedAddonDispose(e){if(e.isDisposed)return;let t=-1;for(let i=0;i<this._addons.length;i++)if(this._addons[i]===e){t=i;break}if(t===-1)throw new Error("Could not dispose an addon that has not been loaded");e.isDisposed=!0,e.dispose.apply(e.instance),this._addons.splice(t,1)}},H3=class{constructor(e){this._line=e}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(e,t){if(!(e<0||e>=this._line.length))return t?(this._line.loadCell(e,t),t):this._line.loadCell(e,new $t)}translateToString(e,t,i){return this._line.translateToString(e,t,i)}},nv=class{constructor(e,t){this._buffer=e,this.type=t}init(e){return this._buffer=e,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(e){let t=this._buffer.lines.get(e);if(t)return new H3(t)}getNullCell(){return new $t}},X3=class extends oe{constructor(e){super(),this._core=e,this._onBufferChange=this._register(new Y),this.onBufferChange=this._onBufferChange.event,this._normal=new nv(this._core.buffers.normal,"normal"),this._alternate=new nv(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}},U3=class{constructor(e){this._core=e}registerCsiHandler(e,t){return this._core.registerCsiHandler(e,i=>t(i.toArray()))}addCsiHandler(e,t){return this.registerCsiHandler(e,t)}registerDcsHandler(e,t){return this._core.registerDcsHandler(e,(i,r)=>t(i,r.toArray()))}addDcsHandler(e,t){return this.registerDcsHandler(e,t)}registerEscHandler(e,t){return this._core.registerEscHandler(e,t)}addEscHandler(e,t){return this.registerEscHandler(e,t)}registerOscHandler(e,t){return this._core.registerOscHandler(e,t)}addOscHandler(e,t){return this.registerOscHandler(e,t)}},z3=class{constructor(e){this._core=e}register(e){this._core.unicodeService.register(e)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(e){this._core.unicodeService.activeVersion=e}},W3=["cols","rows"],_i=0,n1=class extends oe{constructor(e){super(),this._core=this._register(new K3(e)),this._addonManager=this._register(new Q3),this._publicOptions={...this._core.options};let t=r=>this._core.options[r],i=(r,s)=>{this._checkReadonlyOptions(r),this._core.options[r]=s};for(let r in this._core.options){let s={get:t.bind(this,r),set:i.bind(this,r)};Object.defineProperty(this._publicOptions,r,s)}}_checkReadonlyOptions(e){if(W3.includes(e))throw new Error(`Option "${e}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new U3(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new z3(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this._register(new X3(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){let e=this._core.coreService.decPrivateModes,t="none";switch(this._core.coreMouseService.activeProtocol){case"X10":t="x10";break;case"VT200":t="vt200";break;case"DRAG":t="drag";break;case"ANY":t="any";break}return{applicationCursorKeysMode:e.applicationCursorKeys,applicationKeypadMode:e.applicationKeypad,bracketedPasteMode:e.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:t,originMode:e.origin,reverseWraparoundMode:e.reverseWraparound,sendFocusMode:e.sendFocus,synchronizedOutputMode:e.synchronizedOutput,wraparoundMode:e.wraparound}}get options(){return this._publicOptions}set options(e){for(let t in e)this._publicOptions[t]=e[t]}blur(){this._core.blur()}focus(){this._core.focus()}input(e,t=!0){this._core.input(e,t)}resize(e,t){this._verifyIntegers(e,t),this._core.resize(e,t)}open(e){this._core.open(e)}attachCustomKeyEventHandler(e){this._core.attachCustomKeyEventHandler(e)}attachCustomWheelEventHandler(e){this._core.attachCustomWheelEventHandler(e)}registerLinkProvider(e){return this._core.registerLinkProvider(e)}registerCharacterJoiner(e){return this._checkProposedApi(),this._core.registerCharacterJoiner(e)}deregisterCharacterJoiner(e){this._checkProposedApi(),this._core.deregisterCharacterJoiner(e)}registerMarker(e=0){return this._verifyIntegers(e),this._core.registerMarker(e)}registerDecoration(e){return this._checkProposedApi(),this._verifyPositiveIntegers(e.x??0,e.width??0,e.height??0),this._core.registerDecoration(e)}hasSelection(){return this._core.hasSelection()}select(e,t,i){this._verifyIntegers(e,t,i),this._core.select(e,t,i)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(e,t){this._verifyIntegers(e,t),this._core.selectLines(e,t)}dispose(){super.dispose()}scrollLines(e){this._verifyIntegers(e),this._core.scrollLines(e)}scrollPages(e){this._verifyIntegers(e),this._core.scrollPages(e)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(e){this._verifyIntegers(e),this._core.scrollToLine(e)}clear(){this._core.clear()}write(e,t){this._core.write(e,t)}writeln(e,t){this._core.write(e),this._core.write(`\r
`,t)}paste(e){this._core.paste(e)}refresh(e,t){this._verifyIntegers(e,t),this._core.refresh(e,t)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(e){this._addonManager.loadAddon(this,e)}static get strings(){return{get promptLabel(){return ru.get()},set promptLabel(e){ru.set(e)},get tooMuchOutput(){return su.get()},set tooMuchOutput(e){su.set(e)}}}_verifyIntegers(...e){for(_i of e)if(_i===1/0||isNaN(_i)||_i%1!==0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...e){for(_i of e)if(_i&&(_i===1/0||isNaN(_i)||_i%1!==0||_i<0))throw new Error("This API only accepts positive integers")}};var $3=2,G3=1,o1=class{activate(e){this._terminal=e}dispose(){}fit(){let e=this.proposeDimensions();if(!e||!this._terminal||isNaN(e.cols)||isNaN(e.rows))return;let t=this._terminal._core;(this._terminal.rows!==e.rows||this._terminal.cols!==e.cols)&&(t._renderService.clear(),this._terminal.resize(e.cols,e.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;let e=this._terminal._core._renderService.dimensions;if(e.css.cell.width===0||e.css.cell.height===0)return;let t=this._terminal.options.scrollback===0?0:this._terminal.options.overviewRuler?.width||14,i=window.getComputedStyle(this._terminal.element.parentElement),r=parseInt(i.getPropertyValue("height")),s=Math.max(0,parseInt(i.getPropertyValue("width"))),n=window.getComputedStyle(this._terminal.element),o={top:parseInt(n.getPropertyValue("padding-top")),bottom:parseInt(n.getPropertyValue("padding-bottom")),right:parseInt(n.getPropertyValue("padding-right")),left:parseInt(n.getPropertyValue("padding-left"))},a=o.top+o.bottom,h=o.right+o.left,l=r-a,c=s-h-t;return{cols:Math.max($3,Math.floor(c/e.css.cell.width)),rows:Math.max(G3,Math.floor(l/e.css.cell.height))}}};var j3=Object.defineProperty,q3=Object.getOwnPropertyDescriptor,V3=(e,t,i,r)=>{for(var s=r>1?void 0:r?q3(t,i):t,n=e.length-1,o;n>=0;n--)(o=e[n])&&(s=(r?o(t,i,s):o(s))||s);return r&&s&&j3(t,i,s),s},Y3=(e,t)=>(i,r)=>t(i,r,e),J3=class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(e){setTimeout(()=>{throw e.stack?a1.isErrorNoTelemetry(e)?new a1(e.message+`

`+e.stack):new Error(e.message+`

`+e.stack):e},0)}}addListener(e){return this.listeners.push(e),()=>{this._removeListener(e)}}emit(e){this.listeners.forEach(t=>{t(e)})}_removeListener(e){this.listeners.splice(this.listeners.indexOf(e),1)}setUnexpectedErrorHandler(e){this.unexpectedErrorHandler=e}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(e){this.unexpectedErrorHandler(e),this.emit(e)}onUnexpectedExternalError(e){this.unexpectedErrorHandler(e)}},Z3=new J3;function fl(e){e6(e)||Z3.onUnexpectedError(e)}var ud="Canceled";function e6(e){return e instanceof t6?!0:e instanceof Error&&e.name===ud&&e.message===ud}var t6=class extends Error{constructor(){super(ud),this.name=this.message}},a1=class dd extends Error{constructor(t){super(t),this.name="CodeExpectedError"}static fromError(t){if(t instanceof dd)return t;let i=new dd;return i.message=t.message,i.stack=t.stack,i}static isErrorNoTelemetry(t){return t.name==="CodeExpectedError"}};function i6(e,t,i=0,r=e.length){let s=i,n=r;for(;s<n;){let o=Math.floor((s+n)/2);t(e[o])?s=o+1:n=o}return s-1}var r6=class z1{constructor(t){this._array=t,this._findLastMonotonousLastIdx=0}findLastMonotonous(t){if(z1.assertInvariants){if(this._prevFindLastPredicate){for(let r of this._array)if(this._prevFindLastPredicate(r)&&!t(r))throw new Error("MonotonousArray: current predicate must be weaker than (or equal to) the previous predicate.")}this._prevFindLastPredicate=t}let i=i6(this._array,t,this._findLastMonotonousLastIdx);return this._findLastMonotonousLastIdx=i+1,i===-1?void 0:this._array[i]}};r6.assertInvariants=!1;var W1;(e=>{function t(n){return n<0}e.isLessThan=t;function i(n){return n<=0}e.isLessThanOrEqual=i;function r(n){return n>0}e.isGreaterThan=r;function s(n){return n===0}e.isNeitherLessOrGreaterThan=s,e.greaterThan=1,e.lessThan=-1,e.neitherLessOrGreaterThan=0})(W1||={});function s6(e,t){return(i,r)=>t(e(i),e(r))}var n6=(e,t)=>e-t,l1=class fd{constructor(t){this.iterate=t}forEach(t){this.iterate(i=>(t(i),!0))}toArray(){let t=[];return this.iterate(i=>(t.push(i),!0)),t}filter(t){return new fd(i=>this.iterate(r=>t(r)?i(r):!0))}map(t){return new fd(i=>this.iterate(r=>i(t(r))))}some(t){let i=!1;return this.iterate(r=>(i=t(r),!i)),i}findFirst(t){let i;return this.iterate(r=>t(r)?(i=r,!1):!0),i}findLast(t){let i;return this.iterate(r=>(t(r)&&(i=r),!0)),i}findLastMaxBy(t){let i,r=!0;return this.iterate(s=>((r||W1.isGreaterThan(t(s,i)))&&(r=!1,i=s),!0)),i}};l1.empty=new l1(e=>{});function o6(e,t){let i=Object.create(null);for(let r of e){let s=t(r),n=i[s];n||(n=i[s]=[]),n.push(r)}return i}var h1,c1,aR=class{constructor(e,t){this.toKey=t,this._map=new Map,this[h1]="SetWithKey";for(let i of e)this.add(i)}get size(){return this._map.size}add(e){let t=this.toKey(e);return this._map.set(t,e),this}delete(e){return this._map.delete(this.toKey(e))}has(e){return this._map.has(this.toKey(e))}*entries(){for(let e of this._map.values())yield[e,e]}keys(){return this.values()}*values(){for(let e of this._map.values())yield e}clear(){this._map.clear()}forEach(e,t){this._map.forEach(i=>e.call(t,i,i,this))}[(c1=Symbol.iterator,h1=Symbol.toStringTag,c1)](){return this.values()}},a6=class{constructor(){this.map=new Map}add(e,t){let i=this.map.get(e);i||(i=new Set,this.map.set(e,i)),i.add(t)}delete(e,t){let i=this.map.get(e);i&&(i.delete(t),i.size===0&&this.map.delete(e))}forEach(e,t){let i=this.map.get(e);i&&i.forEach(t)}get(e){return this.map.get(e)||new Set}};function l6(e,t){let i=this,r=!1,s;return function(){if(r)return s;if(r=!0,t)try{s=e.apply(i,arguments)}finally{t()}else s=e.apply(i,arguments);return s}}var $1;(e=>{function t(b){return b&&typeof b=="object"&&typeof b[Symbol.iterator]=="function"}e.is=t;let i=Object.freeze([]);function r(){return i}e.empty=r;function*s(b){yield b}e.single=s;function n(b){return t(b)?b:s(b)}e.wrap=n;function o(b){return b||i}e.from=o;function*a(b){for(let L=b.length-1;L>=0;L--)yield b[L]}e.reverse=a;function h(b){return!b||b[Symbol.iterator]().next().done===!0}e.isEmpty=h;function l(b){return b[Symbol.iterator]().next().value}e.first=l;function c(b,L){let I=0;for(let R of b)if(L(R,I++))return!0;return!1}e.some=c;function u(b,L){for(let I of b)if(L(I))return I}e.find=u;function*g(b,L){for(let I of b)L(I)&&(yield I)}e.filter=g;function*_(b,L){let I=0;for(let R of b)yield L(R,I++)}e.map=_;function*m(b,L){let I=0;for(let R of b)yield*L(R,I++)}e.flatMap=m;function*v(...b){for(let L of b)yield*L}e.concat=v;function x(b,L,I){let R=I;for(let G of b)R=L(R,G);return R}e.reduce=x;function*E(b,L,I=b.length){for(L<0&&(L+=b.length),I<0?I+=b.length:I>b.length&&(I=b.length);L<I;L++)yield b[L]}e.slice=E;function M(b,L=Number.POSITIVE_INFINITY){let I=[];if(L===0)return[I,b];let R=b[Symbol.iterator]();for(let G=0;G<L;G++){let W=R.next();if(W.done)return[I,e.empty()];I.push(W.value)}return[I,{[Symbol.iterator](){return R}}]}e.consume=M;async function D(b){let L=[];for await(let I of b)L.push(I);return Promise.resolve(L)}e.asyncToArray=D})($1||={});var h6=!1,Ms=null,c6=class G1{constructor(){this.livingDisposables=new Map}getDisposableData(t){let i=this.livingDisposables.get(t);return i||(i={parent:null,source:null,isSingleton:!1,value:t,idx:G1.idx++},this.livingDisposables.set(t,i)),i}trackDisposable(t){let i=this.getDisposableData(t);i.source||(i.source=new Error().stack)}setParent(t,i){let r=this.getDisposableData(t);r.parent=i}markAsDisposed(t){this.livingDisposables.delete(t)}markAsSingleton(t){this.getDisposableData(t).isSingleton=!0}getRootParent(t,i){let r=i.get(t);if(r)return r;let s=t.parent?this.getRootParent(this.getDisposableData(t.parent),i):t;return i.set(t,s),s}getTrackedDisposables(){let t=new Map;return[...this.livingDisposables.entries()].filter(([,i])=>i.source!==null&&!this.getRootParent(i,t).isSingleton).flatMap(([i])=>i)}computeLeakingDisposables(t=10,i){let r;if(i)r=i;else{let h=new Map,l=[...this.livingDisposables.values()].filter(u=>u.source!==null&&!this.getRootParent(u,h).isSingleton);if(l.length===0)return;let c=new Set(l.map(u=>u.value));if(r=l.filter(u=>!(u.parent&&c.has(u.parent))),r.length===0)throw new Error("There are cyclic diposable chains!")}if(!r)return;function s(h){function l(u,g){for(;u.length>0&&g.some(_=>typeof _=="string"?_===u[0]:u[0].match(_));)u.shift()}let c=h.source.split(`
`).map(u=>u.trim().replace("at ","")).filter(u=>u!=="");return l(c,["Error",/^trackDisposable \(.*\)$/,/^DisposableTracker.trackDisposable \(.*\)$/]),c.reverse()}let n=new a6;for(let h of r){let l=s(h);for(let c=0;c<=l.length;c++)n.add(l.slice(0,c).join(`
`),h)}r.sort(s6(h=>h.idx,n6));let o="",a=0;for(let h of r.slice(0,t)){a++;let l=s(h),c=[];for(let u=0;u<l.length;u++){let g=l[u];g=`(shared with ${n.get(l.slice(0,u+1).join(`
`)).size}/${r.length} leaks) at ${g}`;let _=n.get(l.slice(0,u).join(`
`)),m=o6([..._].map(v=>s(v)[u]),v=>v);delete m[l[u]];for(let[v,x]of Object.entries(m))c.unshift(`    - stacktraces of ${x.length} other leaks continue with ${v}`);c.unshift(g)}o+=`


==================== Leaking disposable ${a}/${r.length}: ${h.value.constructor.name} ====================
${c.join(`
`)}
============================================================

`}return r.length>t&&(o+=`


... and ${r.length-t} more leaking disposables

`),{leaks:r,details:o}}};c6.idx=0;function u6(e){Ms=e}if(h6){let e="__is_disposable_tracked__";u6(new class{trackDisposable(t){let i=new Error("Potentially leaked disposable").stack;setTimeout(()=>{t[e]||console.log(i)},3e3)}setParent(t,i){if(t&&t!==Ft.None)try{t[e]=!0}catch{}}markAsDisposed(t){if(t&&t!==Ft.None)try{t[e]=!0}catch{}}markAsSingleton(t){}})}function xl(e){return Ms?.trackDisposable(e),e}function Sl(e){Ms?.markAsDisposed(e)}function so(e,t){Ms?.setParent(e,t)}function d6(e,t){if(Ms)for(let i of e)Ms.setParent(i,t)}function j1(e){if($1.is(e)){let t=[];for(let i of e)if(i)try{i.dispose()}catch(r){t.push(r)}if(t.length===1)throw t[0];if(t.length>1)throw new AggregateError(t,"Encountered errors while disposing of store");return Array.isArray(e)?[]:e}else if(e)return e.dispose(),e}function q1(...e){let t=lt(()=>j1(e));return d6(e,t),t}function lt(e){let t=xl({dispose:l6(()=>{Sl(t),e()})});return t}var V1=class Y1{constructor(){this._toDispose=new Set,this._isDisposed=!1,xl(this)}dispose(){this._isDisposed||(Sl(this),this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{j1(this._toDispose)}finally{this._toDispose.clear()}}add(t){if(!t)return t;if(t===this)throw new Error("Cannot register a disposable on itself!");return so(t,this),this._isDisposed?Y1.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(t),t}delete(t){if(t){if(t===this)throw new Error("Cannot dispose a disposable on itself!");this._toDispose.delete(t),t.dispose()}}deleteAndLeak(t){t&&this._toDispose.has(t)&&(this._toDispose.delete(t),so(t,null))}};V1.DISABLE_DISPOSED_WARNING=!1;var Is=V1,Ft=class{constructor(){this._store=new Is,xl(this),so(this._store,this)}dispose(){Sl(this),this._store.dispose()}_register(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}};Ft.None=Object.freeze({dispose(){}});var Jn=class{constructor(){this._isDisposed=!1,xl(this)}get value(){return this._isDisposed?void 0:this._value}set value(e){this._isDisposed||e===this._value||(this._value?.dispose(),e&&so(e,this),this._value=e)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,Sl(this),this._value?.dispose(),this._value=void 0}clearAndLeak(){let e=this._value;return this._value=void 0,e&&so(e,null),e}},Ad=typeof process<"u"&&"title"in process,oo=Ad?"node":navigator.userAgent,xd=Ad?"node":navigator.platform,f6=oo.includes("Firefox"),_6=oo.includes("Edge"),J1=/^((?!chrome|android).)*safari/i.test(oo);function p6(){if(!J1)return 0;let e=oo.match(/Version\/(\d+)/);return e===null||e.length<2?0:parseInt(e[1])}var lR=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(xd),hR=["Windows","Win16","Win32","WinCE"].includes(xd),cR=xd.indexOf("Linux")>=0,uR=/\bCrOS\b/.test(oo),g6="",tt=0,it=0,rt=0,Re=0,Gt={css:"#00000000",rgba:0},wt;(e=>{function t(s,n,o,a){return a!==void 0?`#${Yr(s)}${Yr(n)}${Yr(o)}${Yr(a)}`:`#${Yr(s)}${Yr(n)}${Yr(o)}`}e.toCss=t;function i(s,n,o,a=255){return(s<<24|n<<16|o<<8|a)>>>0}e.toRgba=i;function r(s,n,o,a){return{css:e.toCss(s,n,o,a),rgba:e.toRgba(s,n,o,a)}}e.toColor=r})(wt||={});var ro;(e=>{function t(h,l){if(Re=(l.rgba&255)/255,Re===1)return{css:l.css,rgba:l.rgba};let c=l.rgba>>24&255,u=l.rgba>>16&255,g=l.rgba>>8&255,_=h.rgba>>24&255,m=h.rgba>>16&255,v=h.rgba>>8&255;tt=_+Math.round((c-_)*Re),it=m+Math.round((u-m)*Re),rt=v+Math.round((g-v)*Re);let x=wt.toCss(tt,it,rt),E=wt.toRgba(tt,it,rt);return{css:x,rgba:E}}e.blend=t;function i(h){return(h.rgba&255)===255}e.isOpaque=i;function r(h,l,c){let u=Jr.ensureContrastRatio(h.rgba,l.rgba,c);if(u)return wt.toColor(u>>24&255,u>>16&255,u>>8&255)}e.ensureContrastRatio=r;function s(h){let l=(h.rgba|255)>>>0;return[tt,it,rt]=Jr.toChannels(l),{css:wt.toCss(tt,it,rt),rgba:l}}e.opaque=s;function n(h,l){return Re=Math.round(l*255),[tt,it,rt]=Jr.toChannels(h.rgba),{css:wt.toCss(tt,it,rt,Re),rgba:wt.toRgba(tt,it,rt,Re)}}e.opacity=n;function o(h,l){return Re=h.rgba&255,n(h,Re*l/255)}e.multiplyOpacity=o;function a(h){return[h.rgba>>24&255,h.rgba>>16&255,h.rgba>>8&255]}e.toColorRGB=a})(ro||={});var m6;(e=>{let t,i;try{let s=document.createElement("canvas");s.width=1,s.height=1;let n=s.getContext("2d",{willReadFrequently:!0});n&&(t=n,t.globalCompositeOperation="copy",i=t.createLinearGradient(0,0,1,1))}catch{}function r(s){if(s.match(/#[\da-f]{3,8}/i))switch(s.length){case 4:return tt=parseInt(s.slice(1,2).repeat(2),16),it=parseInt(s.slice(2,3).repeat(2),16),rt=parseInt(s.slice(3,4).repeat(2),16),wt.toColor(tt,it,rt);case 5:return tt=parseInt(s.slice(1,2).repeat(2),16),it=parseInt(s.slice(2,3).repeat(2),16),rt=parseInt(s.slice(3,4).repeat(2),16),Re=parseInt(s.slice(4,5).repeat(2),16),wt.toColor(tt,it,rt,Re);case 7:return{css:s,rgba:(parseInt(s.slice(1),16)<<8|255)>>>0};case 9:return{css:s,rgba:parseInt(s.slice(1),16)>>>0}}let n=s.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(n)return tt=parseInt(n[1]),it=parseInt(n[2]),rt=parseInt(n[3]),Re=Math.round((n[5]===void 0?1:parseFloat(n[5]))*255),wt.toColor(tt,it,rt,Re);if(!t||!i)throw new Error("css.toColor: Unsupported css format");if(t.fillStyle=i,t.fillStyle=s,typeof t.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(t.fillRect(0,0,1,1),[tt,it,rt,Re]=t.getImageData(0,0,1,1).data,Re!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:wt.toRgba(tt,it,rt,Re),css:s}}e.toColor=r})(m6||={});var bt;(e=>{function t(r){return i(r>>16&255,r>>8&255,r&255)}e.relativeLuminance=t;function i(r,s,n){let o=r/255,a=s/255,h=n/255,l=o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4),c=a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4),u=h<=.03928?h/12.92:Math.pow((h+.055)/1.055,2.4);return l*.2126+c*.7152+u*.0722}e.relativeLuminance2=i})(bt||={});var Jr;(e=>{function t(o,a){if(Re=(a&255)/255,Re===1)return a;let h=a>>24&255,l=a>>16&255,c=a>>8&255,u=o>>24&255,g=o>>16&255,_=o>>8&255;return tt=u+Math.round((h-u)*Re),it=g+Math.round((l-g)*Re),rt=_+Math.round((c-_)*Re),wt.toRgba(tt,it,rt)}e.blend=t;function i(o,a,h){let l=bt.relativeLuminance(o>>8),c=bt.relativeLuminance(a>>8);if(Ki(l,c)<h){if(c<l){let _=r(o,a,h),m=Ki(l,bt.relativeLuminance(_>>8));if(m<h){let v=s(o,a,h),x=Ki(l,bt.relativeLuminance(v>>8));return m>x?_:v}return _}let u=s(o,a,h),g=Ki(l,bt.relativeLuminance(u>>8));if(g<h){let _=r(o,a,h),m=Ki(l,bt.relativeLuminance(_>>8));return g>m?u:_}return u}}e.ensureContrastRatio=i;function r(o,a,h){let l=o>>24&255,c=o>>16&255,u=o>>8&255,g=a>>24&255,_=a>>16&255,m=a>>8&255,v=Ki(bt.relativeLuminance2(g,_,m),bt.relativeLuminance2(l,c,u));for(;v<h&&(g>0||_>0||m>0);)g-=Math.max(0,Math.ceil(g*.1)),_-=Math.max(0,Math.ceil(_*.1)),m-=Math.max(0,Math.ceil(m*.1)),v=Ki(bt.relativeLuminance2(g,_,m),bt.relativeLuminance2(l,c,u));return(g<<24|_<<16|m<<8|255)>>>0}e.reduceLuminance=r;function s(o,a,h){let l=o>>24&255,c=o>>16&255,u=o>>8&255,g=a>>24&255,_=a>>16&255,m=a>>8&255,v=Ki(bt.relativeLuminance2(g,_,m),bt.relativeLuminance2(l,c,u));for(;v<h&&(g<255||_<255||m<255);)g=Math.min(255,g+Math.ceil((255-g)*.1)),_=Math.min(255,_+Math.ceil((255-_)*.1)),m=Math.min(255,m+Math.ceil((255-m)*.1)),v=Ki(bt.relativeLuminance2(g,_,m),bt.relativeLuminance2(l,c,u));return(g<<24|_<<16|m<<8|255)>>>0}e.increaseLuminance=s;function n(o){return[o>>24&255,o>>16&255,o>>8&255,o&255]}e.toChannels=n})(Jr||={});function Yr(e){let t=e.toString(16);return t.length<2?"0"+t:t}function Ki(e,t){return e<t?(t+.05)/(e+.05):(e+.05)/(t+.05)}function He(e){if(!e)throw new Error("value must not be falsy");return e}function Sd(e){return 57508<=e&&e<=57558}function v6(e){return 57520<=e&&e<=57527}function y6(e){return 57344<=e&&e<=63743}function b6(e){return 9472<=e&&e<=9631}function w6(e){return e>=128512&&e<=128591||e>=127744&&e<=128511||e>=128640&&e<=128767||e>=9728&&e<=9983||e>=9984&&e<=10175||e>=65024&&e<=65039||e>=129280&&e<=129535||e>=127462&&e<=127487}function A6(e,t,i,r){return t===1&&i>Math.ceil(r*1.5)&&e!==void 0&&e>255&&!w6(e)&&!Sd(e)&&!y6(e)}function Z1(e){return Sd(e)||b6(e)}function x6(){return{css:{canvas:hl(),cell:hl()},device:{canvas:hl(),cell:hl(),char:{width:0,height:0,left:0,top:0}}}}function hl(){return{width:0,height:0}}function S6(e,t,i=0){return(e-(Math.round(t)*2-i))%(Math.round(t)*2)}var at=0,et=0,vi=!1,Ni=!1,cl=!1,Ct,Yu=0,C6=class{constructor(e,t,i,r,s,n){this._terminal=e,this._optionService=t,this._selectionRenderModel=i,this._decorationService=r,this._coreBrowserService=s,this._themeService=n,this.result={fg:0,bg:0,ext:0}}resolve(e,t,i,r){if(this.result.bg=e.bg,this.result.fg=e.fg,this.result.ext=e.bg&268435456?e.extended.ext:0,et=0,at=0,Ni=!1,vi=!1,cl=!1,Ct=this._themeService.colors,Yu=0,e.getCode()!==0&&e.extended.underlineStyle===4){let s=Math.max(1,Math.floor(this._optionService.rawOptions.fontSize*this._coreBrowserService.dpr/15));Yu=t*r%(Math.round(s)*2)}if(this._decorationService.forEachDecorationAtCell(t,i,"bottom",s=>{s.backgroundColorRGB&&(et=s.backgroundColorRGB.rgba>>8&16777215,Ni=!0),s.foregroundColorRGB&&(at=s.foregroundColorRGB.rgba>>8&16777215,vi=!0)}),cl=this._selectionRenderModel.isCellSelected(this._terminal,t,i),cl){if(this.result.fg&67108864||(this.result.bg&50331648)!==0){if(this.result.fg&67108864)switch(this.result.fg&50331648){case 16777216:case 33554432:et=this._themeService.colors.ansi[this.result.fg&255].rgba;break;case 50331648:et=(this.result.fg&16777215)<<8|255;break;case 0:default:et=this._themeService.colors.foreground.rgba}else switch(this.result.bg&50331648){case 16777216:case 33554432:et=this._themeService.colors.ansi[this.result.bg&255].rgba;break;case 50331648:et=(this.result.bg&16777215)<<8|255;break}et=Jr.blend(et,(this._coreBrowserService.isFocused?Ct.selectionBackgroundOpaque:Ct.selectionInactiveBackgroundOpaque).rgba&4294967040|128)>>8&16777215}else et=(this._coreBrowserService.isFocused?Ct.selectionBackgroundOpaque:Ct.selectionInactiveBackgroundOpaque).rgba>>8&16777215;if(Ni=!0,Ct.selectionForeground&&(at=Ct.selectionForeground.rgba>>8&16777215,vi=!0),Z1(e.getCode())){if(this.result.fg&67108864&&(this.result.bg&50331648)===0)at=(this._coreBrowserService.isFocused?Ct.selectionBackgroundOpaque:Ct.selectionInactiveBackgroundOpaque).rgba>>8&16777215;else{if(this.result.fg&67108864)switch(this.result.bg&50331648){case 16777216:case 33554432:at=this._themeService.colors.ansi[this.result.bg&255].rgba;break;case 50331648:at=(this.result.bg&16777215)<<8|255;break}else switch(this.result.fg&50331648){case 16777216:case 33554432:at=this._themeService.colors.ansi[this.result.fg&255].rgba;break;case 50331648:at=(this.result.fg&16777215)<<8|255;break;case 0:default:at=this._themeService.colors.foreground.rgba}at=Jr.blend(at,(this._coreBrowserService.isFocused?Ct.selectionBackgroundOpaque:Ct.selectionInactiveBackgroundOpaque).rgba&4294967040|128)>>8&16777215}vi=!0}}this._decorationService.forEachDecorationAtCell(t,i,"top",s=>{s.backgroundColorRGB&&(et=s.backgroundColorRGB.rgba>>8&16777215,Ni=!0),s.foregroundColorRGB&&(at=s.foregroundColorRGB.rgba>>8&16777215,vi=!0)}),Ni&&(cl?et=e.bg&-16777216&-134217729|et|50331648:et=e.bg&-16777216|et|50331648),vi&&(at=e.fg&-16777216&-67108865|at|50331648),this.result.fg&67108864&&(Ni&&!vi&&((this.result.bg&50331648)===0?at=this.result.fg&-134217728|Ct.background.rgba>>8&16777215&16777215|50331648:at=this.result.fg&-134217728|this.result.bg&67108863,vi=!0),!Ni&&vi&&((this.result.fg&50331648)===0?et=this.result.bg&-67108864|Ct.foreground.rgba>>8&16777215&16777215|50331648:et=this.result.bg&-67108864|this.result.fg&67108863,Ni=!0)),Ct=void 0,this.result.bg=Ni?et:this.result.bg,this.result.fg=vi?at:this.result.fg,this.result.ext&=536870911,this.result.ext|=Yu<<29&3758096384}},k6=.5,ey=f6||_6?"bottom":"ideographic",E6={"\u2580":[{x:0,y:0,w:8,h:4}],"\u2581":[{x:0,y:7,w:8,h:1}],"\u2582":[{x:0,y:6,w:8,h:2}],"\u2583":[{x:0,y:5,w:8,h:3}],"\u2584":[{x:0,y:4,w:8,h:4}],"\u2585":[{x:0,y:3,w:8,h:5}],"\u2586":[{x:0,y:2,w:8,h:6}],"\u2587":[{x:0,y:1,w:8,h:7}],"\u2588":[{x:0,y:0,w:8,h:8}],"\u2589":[{x:0,y:0,w:7,h:8}],"\u258A":[{x:0,y:0,w:6,h:8}],"\u258B":[{x:0,y:0,w:5,h:8}],"\u258C":[{x:0,y:0,w:4,h:8}],"\u258D":[{x:0,y:0,w:3,h:8}],"\u258E":[{x:0,y:0,w:2,h:8}],"\u258F":[{x:0,y:0,w:1,h:8}],"\u2590":[{x:4,y:0,w:4,h:8}],"\u2594":[{x:0,y:0,w:8,h:1}],"\u2595":[{x:7,y:0,w:1,h:8}],"\u2596":[{x:0,y:4,w:4,h:4}],"\u2597":[{x:4,y:4,w:4,h:4}],"\u2598":[{x:0,y:0,w:4,h:4}],"\u2599":[{x:0,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"\u259A":[{x:0,y:0,w:4,h:4},{x:4,y:4,w:4,h:4}],"\u259B":[{x:0,y:0,w:4,h:8},{x:4,y:0,w:4,h:4}],"\u259C":[{x:0,y:0,w:8,h:4},{x:4,y:0,w:4,h:8}],"\u259D":[{x:4,y:0,w:4,h:4}],"\u259E":[{x:4,y:0,w:4,h:4},{x:0,y:4,w:4,h:4}],"\u259F":[{x:4,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"\u{1FB70}":[{x:1,y:0,w:1,h:8}],"\u{1FB71}":[{x:2,y:0,w:1,h:8}],"\u{1FB72}":[{x:3,y:0,w:1,h:8}],"\u{1FB73}":[{x:4,y:0,w:1,h:8}],"\u{1FB74}":[{x:5,y:0,w:1,h:8}],"\u{1FB75}":[{x:6,y:0,w:1,h:8}],"\u{1FB76}":[{x:0,y:1,w:8,h:1}],"\u{1FB77}":[{x:0,y:2,w:8,h:1}],"\u{1FB78}":[{x:0,y:3,w:8,h:1}],"\u{1FB79}":[{x:0,y:4,w:8,h:1}],"\u{1FB7A}":[{x:0,y:5,w:8,h:1}],"\u{1FB7B}":[{x:0,y:6,w:8,h:1}],"\u{1FB7C}":[{x:0,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"\u{1FB7D}":[{x:0,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"\u{1FB7E}":[{x:7,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"\u{1FB7F}":[{x:7,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"\u{1FB80}":[{x:0,y:0,w:8,h:1},{x:0,y:7,w:8,h:1}],"\u{1FB81}":[{x:0,y:0,w:8,h:1},{x:0,y:2,w:8,h:1},{x:0,y:4,w:8,h:1},{x:0,y:7,w:8,h:1}],"\u{1FB82}":[{x:0,y:0,w:8,h:2}],"\u{1FB83}":[{x:0,y:0,w:8,h:3}],"\u{1FB84}":[{x:0,y:0,w:8,h:5}],"\u{1FB85}":[{x:0,y:0,w:8,h:6}],"\u{1FB86}":[{x:0,y:0,w:8,h:7}],"\u{1FB87}":[{x:6,y:0,w:2,h:8}],"\u{1FB88}":[{x:5,y:0,w:3,h:8}],"\u{1FB89}":[{x:3,y:0,w:5,h:8}],"\u{1FB8A}":[{x:2,y:0,w:6,h:8}],"\u{1FB8B}":[{x:1,y:0,w:7,h:8}],"\u{1FB95}":[{x:0,y:0,w:2,h:2},{x:4,y:0,w:2,h:2},{x:2,y:2,w:2,h:2},{x:6,y:2,w:2,h:2},{x:0,y:4,w:2,h:2},{x:4,y:4,w:2,h:2},{x:2,y:6,w:2,h:2},{x:6,y:6,w:2,h:2}],"\u{1FB96}":[{x:2,y:0,w:2,h:2},{x:6,y:0,w:2,h:2},{x:0,y:2,w:2,h:2},{x:4,y:2,w:2,h:2},{x:2,y:4,w:2,h:2},{x:6,y:4,w:2,h:2},{x:0,y:6,w:2,h:2},{x:4,y:6,w:2,h:2}],"\u{1FB97}":[{x:0,y:2,w:8,h:2},{x:0,y:6,w:8,h:2}]},B6={"\u2591":[[1,0,0,0],[0,0,0,0],[0,0,1,0],[0,0,0,0]],"\u2592":[[1,0],[0,0],[0,1],[0,0]],"\u2593":[[0,1],[1,1],[1,0],[1,1]]},L6={"\u2500":{1:"M0,.5 L1,.5"},"\u2501":{3:"M0,.5 L1,.5"},"\u2502":{1:"M.5,0 L.5,1"},"\u2503":{3:"M.5,0 L.5,1"},"\u250C":{1:"M0.5,1 L.5,.5 L1,.5"},"\u250F":{3:"M0.5,1 L.5,.5 L1,.5"},"\u2510":{1:"M0,.5 L.5,.5 L.5,1"},"\u2513":{3:"M0,.5 L.5,.5 L.5,1"},"\u2514":{1:"M.5,0 L.5,.5 L1,.5"},"\u2517":{3:"M.5,0 L.5,.5 L1,.5"},"\u2518":{1:"M.5,0 L.5,.5 L0,.5"},"\u251B":{3:"M.5,0 L.5,.5 L0,.5"},"\u251C":{1:"M.5,0 L.5,1 M.5,.5 L1,.5"},"\u2523":{3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"\u2524":{1:"M.5,0 L.5,1 M.5,.5 L0,.5"},"\u252B":{3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"\u252C":{1:"M0,.5 L1,.5 M.5,.5 L.5,1"},"\u2533":{3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"\u2534":{1:"M0,.5 L1,.5 M.5,.5 L.5,0"},"\u253B":{3:"M0,.5 L1,.5 M.5,.5 L.5,0"},"\u253C":{1:"M0,.5 L1,.5 M.5,0 L.5,1"},"\u254B":{3:"M0,.5 L1,.5 M.5,0 L.5,1"},"\u2574":{1:"M.5,.5 L0,.5"},"\u2578":{3:"M.5,.5 L0,.5"},"\u2575":{1:"M.5,.5 L.5,0"},"\u2579":{3:"M.5,.5 L.5,0"},"\u2576":{1:"M.5,.5 L1,.5"},"\u257A":{3:"M.5,.5 L1,.5"},"\u2577":{1:"M.5,.5 L.5,1"},"\u257B":{3:"M.5,.5 L.5,1"},"\u2550":{1:(e,t)=>`M0,${.5-t} L1,${.5-t} M0,${.5+t} L1,${.5+t}`},"\u2551":{1:(e,t)=>`M${.5-e},0 L${.5-e},1 M${.5+e},0 L${.5+e},1`},"\u2552":{1:(e,t)=>`M.5,1 L.5,${.5-t} L1,${.5-t} M.5,${.5+t} L1,${.5+t}`},"\u2553":{1:(e,t)=>`M${.5-e},1 L${.5-e},.5 L1,.5 M${.5+e},.5 L${.5+e},1`},"\u2554":{1:(e,t)=>`M1,${.5-t} L${.5-e},${.5-t} L${.5-e},1 M1,${.5+t} L${.5+e},${.5+t} L${.5+e},1`},"\u2555":{1:(e,t)=>`M0,${.5-t} L.5,${.5-t} L.5,1 M0,${.5+t} L.5,${.5+t}`},"\u2556":{1:(e,t)=>`M${.5+e},1 L${.5+e},.5 L0,.5 M${.5-e},.5 L${.5-e},1`},"\u2557":{1:(e,t)=>`M0,${.5+t} L${.5-e},${.5+t} L${.5-e},1 M0,${.5-t} L${.5+e},${.5-t} L${.5+e},1`},"\u2558":{1:(e,t)=>`M.5,0 L.5,${.5+t} L1,${.5+t} M.5,${.5-t} L1,${.5-t}`},"\u2559":{1:(e,t)=>`M1,.5 L${.5-e},.5 L${.5-e},0 M${.5+e},.5 L${.5+e},0`},"\u255A":{1:(e,t)=>`M1,${.5-t} L${.5+e},${.5-t} L${.5+e},0 M1,${.5+t} L${.5-e},${.5+t} L${.5-e},0`},"\u255B":{1:(e,t)=>`M0,${.5+t} L.5,${.5+t} L.5,0 M0,${.5-t} L.5,${.5-t}`},"\u255C":{1:(e,t)=>`M0,.5 L${.5+e},.5 L${.5+e},0 M${.5-e},.5 L${.5-e},0`},"\u255D":{1:(e,t)=>`M0,${.5-t} L${.5-e},${.5-t} L${.5-e},0 M0,${.5+t} L${.5+e},${.5+t} L${.5+e},0`},"\u255E":{1:(e,t)=>`M.5,0 L.5,1 M.5,${.5-t} L1,${.5-t} M.5,${.5+t} L1,${.5+t}`},"\u255F":{1:(e,t)=>`M${.5-e},0 L${.5-e},1 M${.5+e},0 L${.5+e},1 M${.5+e},.5 L1,.5`},"\u2560":{1:(e,t)=>`M${.5-e},0 L${.5-e},1 M1,${.5+t} L${.5+e},${.5+t} L${.5+e},1 M1,${.5-t} L${.5+e},${.5-t} L${.5+e},0`},"\u2561":{1:(e,t)=>`M.5,0 L.5,1 M0,${.5-t} L.5,${.5-t} M0,${.5+t} L.5,${.5+t}`},"\u2562":{1:(e,t)=>`M0,.5 L${.5-e},.5 M${.5-e},0 L${.5-e},1 M${.5+e},0 L${.5+e},1`},"\u2563":{1:(e,t)=>`M${.5+e},0 L${.5+e},1 M0,${.5+t} L${.5-e},${.5+t} L${.5-e},1 M0,${.5-t} L${.5-e},${.5-t} L${.5-e},0`},"\u2564":{1:(e,t)=>`M0,${.5-t} L1,${.5-t} M0,${.5+t} L1,${.5+t} M.5,${.5+t} L.5,1`},"\u2565":{1:(e,t)=>`M0,.5 L1,.5 M${.5-e},.5 L${.5-e},1 M${.5+e},.5 L${.5+e},1`},"\u2566":{1:(e,t)=>`M0,${.5-t} L1,${.5-t} M0,${.5+t} L${.5-e},${.5+t} L${.5-e},1 M1,${.5+t} L${.5+e},${.5+t} L${.5+e},1`},"\u2567":{1:(e,t)=>`M.5,0 L.5,${.5-t} M0,${.5-t} L1,${.5-t} M0,${.5+t} L1,${.5+t}`},"\u2568":{1:(e,t)=>`M0,.5 L1,.5 M${.5-e},.5 L${.5-e},0 M${.5+e},.5 L${.5+e},0`},"\u2569":{1:(e,t)=>`M0,${.5+t} L1,${.5+t} M0,${.5-t} L${.5-e},${.5-t} L${.5-e},0 M1,${.5-t} L${.5+e},${.5-t} L${.5+e},0`},"\u256A":{1:(e,t)=>`M.5,0 L.5,1 M0,${.5-t} L1,${.5-t} M0,${.5+t} L1,${.5+t}`},"\u256B":{1:(e,t)=>`M0,.5 L1,.5 M${.5-e},0 L${.5-e},1 M${.5+e},0 L${.5+e},1`},"\u256C":{1:(e,t)=>`M0,${.5+t} L${.5-e},${.5+t} L${.5-e},1 M1,${.5+t} L${.5+e},${.5+t} L${.5+e},1 M0,${.5-t} L${.5-e},${.5-t} L${.5-e},0 M1,${.5-t} L${.5+e},${.5-t} L${.5+e},0`},"\u2571":{1:"M1,0 L0,1"},"\u2572":{1:"M0,0 L1,1"},"\u2573":{1:"M1,0 L0,1 M0,0 L1,1"},"\u257C":{1:"M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"\u257D":{1:"M.5,.5 L.5,0",3:"M.5,.5 L.5,1"},"\u257E":{1:"M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u257F":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"\u250D":{1:"M.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"\u250E":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2511":{1:"M.5,.5 L.5,1",3:"M.5,.5 L0,.5"},"\u2512":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"\u2515":{1:"M.5,.5 L.5,0",3:"M.5,.5 L1,.5"},"\u2516":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"\u2519":{1:"M.5,.5 L.5,0",3:"M.5,.5 L0,.5"},"\u251A":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,0"},"\u251D":{1:"M.5,0 L.5,1",3:"M.5,.5 L1,.5"},"\u251E":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"\u251F":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2520":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1"},"\u2521":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"\u2522":{1:"M.5,.5 L.5,0",3:"M0.5,1 L.5,.5 L1,.5"},"\u2525":{1:"M.5,0 L.5,1",3:"M.5,.5 L0,.5"},"\u2526":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"\u2527":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"\u2528":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1"},"\u2529":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L0,.5"},"\u252A":{1:"M.5,.5 L.5,0",3:"M0,.5 L.5,.5 L.5,1"},"\u252D":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u252E":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"\u252F":{1:"M.5,.5 L.5,1",3:"M0,.5 L1,.5"},"\u2530":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2531":{1:"M.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"\u2532":{1:"M.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"\u2535":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u2536":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"\u2537":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5"},"\u2538":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,0"},"\u2539":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"\u253A":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,.5 L1,.5"},"\u253D":{1:"M.5,0 L.5,1 M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u253E":{1:"M.5,0 L.5,1 M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"\u253F":{1:"M.5,0 L.5,1",3:"M0,.5 L1,.5"},"\u2540":{1:"M0,.5 L1,.5 M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"\u2541":{1:"M.5,.5 L.5,0 M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2542":{1:"M0,.5 L1,.5",3:"M.5,0 L.5,1"},"\u2543":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"\u2544":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"\u2545":{1:"M.5,0 L.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"\u2546":{1:"M.5,0 L.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"\u2547":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0 M0,.5 L1,.5"},"\u2548":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"\u2549":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"\u254A":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"\u254C":{1:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"\u254D":{3:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"\u2504":{1:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"\u2505":{3:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"\u2508":{1:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"\u2509":{3:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"\u254E":{1:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"\u254F":{3:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"\u2506":{1:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"\u2507":{3:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"\u250A":{1:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"\u250B":{3:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"\u256D":{1:(e,t)=>`M.5,1 L.5,${.5+t/.15*.5} C.5,${.5+t/.15*.5},.5,.5,1,.5`},"\u256E":{1:(e,t)=>`M.5,1 L.5,${.5+t/.15*.5} C.5,${.5+t/.15*.5},.5,.5,0,.5`},"\u256F":{1:(e,t)=>`M.5,0 L.5,${.5-t/.15*.5} C.5,${.5-t/.15*.5},.5,.5,0,.5`},"\u2570":{1:(e,t)=>`M.5,0 L.5,${.5-t/.15*.5} C.5,${.5-t/.15*.5},.5,.5,1,.5`}},no={"\uE0A0":{d:"M.3,1 L.03,1 L.03,.88 C.03,.82,.06,.78,.11,.73 C.15,.7,.2,.68,.28,.65 L.43,.6 C.49,.58,.53,.56,.56,.53 C.59,.5,.6,.47,.6,.43 L.6,.27 L.4,.27 L.69,.1 L.98,.27 L.78,.27 L.78,.46 C.78,.52,.76,.56,.72,.61 C.68,.66,.63,.67,.56,.7 L.48,.72 C.42,.74,.38,.76,.35,.78 C.32,.8,.31,.84,.31,.88 L.31,1 M.3,.5 L.03,.59 L.03,.09 L.3,.09 L.3,.655",type:0},"\uE0A1":{d:"M.7,.4 L.7,.47 L.2,.47 L.2,.03 L.355,.03 L.355,.4 L.705,.4 M.7,.5 L.86,.5 L.86,.95 L.69,.95 L.44,.66 L.46,.86 L.46,.95 L.3,.95 L.3,.49 L.46,.49 L.71,.78 L.69,.565 L.69,.5",type:0},"\uE0A2":{d:"M.25,.94 C.16,.94,.11,.92,.11,.87 L.11,.53 C.11,.48,.15,.455,.23,.45 L.23,.3 C.23,.25,.26,.22,.31,.19 C.36,.16,.43,.15,.51,.15 C.59,.15,.66,.16,.71,.19 C.77,.22,.79,.26,.79,.3 L.79,.45 C.87,.45,.91,.48,.91,.53 L.91,.87 C.91,.92,.86,.94,.77,.94 L.24,.94 M.53,.2 C.49,.2,.45,.21,.42,.23 C.39,.25,.38,.27,.38,.3 L.38,.45 L.68,.45 L.68,.3 C.68,.27,.67,.25,.64,.23 C.61,.21,.58,.2,.53,.2 M.58,.82 L.58,.66 C.63,.65,.65,.63,.65,.6 C.65,.58,.64,.57,.61,.56 C.58,.55,.56,.54,.52,.54 C.48,.54,.46,.55,.43,.56 C.4,.57,.39,.59,.39,.6 C.39,.63,.41,.64,.46,.66 L.46,.82 L.57,.82",type:0},"\uE0B0":{d:"M0,0 L1,.5 L0,1",type:0,rightPadding:2},"\uE0B1":{d:"M-1,-.5 L1,.5 L-1,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0B2":{d:"M1,0 L0,.5 L1,1",type:0,leftPadding:2},"\uE0B3":{d:"M2,-.5 L0,.5 L2,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0B4":{d:"M0,0 L0,1 C0.552,1,1,0.776,1,.5 C1,0.224,0.552,0,0,0",type:0,rightPadding:1},"\uE0B5":{d:"M.2,1 C.422,1,.8,.826,.78,.5 C.8,.174,0.422,0,.2,0",type:1,rightPadding:1},"\uE0B6":{d:"M1,0 L1,1 C0.448,1,0,0.776,0,.5 C0,0.224,0.448,0,1,0",type:0,leftPadding:1},"\uE0B7":{d:"M.8,1 C0.578,1,0.2,.826,.22,.5 C0.2,0.174,0.578,0,0.8,0",type:1,leftPadding:1},"\uE0B8":{d:"M-.5,-.5 L1.5,1.5 L-.5,1.5",type:0},"\uE0B9":{d:"M-.5,-.5 L1.5,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0BA":{d:"M1.5,-.5 L-.5,1.5 L1.5,1.5",type:0},"\uE0BC":{d:"M1.5,-.5 L-.5,1.5 L-.5,-.5",type:0},"\uE0BD":{d:"M1.5,-.5 L-.5,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0BE":{d:"M-.5,-.5 L1.5,1.5 L1.5,-.5",type:0}};no["\uE0BB"]=no["\uE0BD"];no["\uE0BF"]=no["\uE0B9"];function D6(e,t,i,r,s,n,o,a){let h=E6[t];if(h)return I6(e,h,i,r,s,n),!0;let l=B6[t];if(l)return M6(e,l,i,r,s,n),!0;let c=L6[t];if(c)return T6(e,c,i,r,s,n,a),!0;let u=no[t];return u?(R6(e,u,i,r,s,n,o,a),!0):!1}function I6(e,t,i,r,s,n){for(let o=0;o<t.length;o++){let a=t[o],h=s/8,l=n/8;e.fillRect(i+a.x*h,r+a.y*l,a.w*h,a.h*l)}}var u1=new Map;function M6(e,t,i,r,s,n){let o=u1.get(t);o||(o=new Map,u1.set(t,o));let a=e.fillStyle;if(typeof a!="string")throw new Error(`Unexpected fillStyle type "${a}"`);let h=o.get(a);if(!h){let l=t[0].length,c=t.length,u=e.canvas.ownerDocument.createElement("canvas");u.width=l,u.height=c;let g=He(u.getContext("2d")),_=new ImageData(l,c),m,v,x,E;if(a.startsWith("#"))m=parseInt(a.slice(1,3),16),v=parseInt(a.slice(3,5),16),x=parseInt(a.slice(5,7),16),E=a.length>7&&parseInt(a.slice(7,9),16)||1;else if(a.startsWith("rgba"))[m,v,x,E]=a.substring(5,a.length-1).split(",").map(M=>parseFloat(M));else throw new Error(`Unexpected fillStyle color format "${a}" when drawing pattern glyph`);for(let M=0;M<c;M++)for(let D=0;D<l;D++)_.data[(M*l+D)*4]=m,_.data[(M*l+D)*4+1]=v,_.data[(M*l+D)*4+2]=x,_.data[(M*l+D)*4+3]=t[M][D]*(E*255);g.putImageData(_,0,0),h=He(e.createPattern(u,null)),o.set(a,h)}e.fillStyle=h,e.fillRect(i,r,s,n)}function T6(e,t,i,r,s,n,o){e.strokeStyle=e.fillStyle;for(let[a,h]of Object.entries(t)){e.beginPath(),e.lineWidth=o*Number.parseInt(a);let l;if(typeof h=="function"){let c=.15/n*s;l=h(.15,c)}else l=h;for(let c of l.split(" ")){let u=c[0],g=ty[u];if(!g){console.error(`Could not find drawing instructions for "${u}"`);continue}let _=c.substring(1).split(",");!_[0]||!_[1]||g(e,iy(_,s,n,i,r,!0,o))}e.stroke(),e.closePath()}}function R6(e,t,i,r,s,n,o,a){let h=new Path2D;h.rect(i,r,s,n),e.clip(h),e.beginPath();let l=o/12;e.lineWidth=a*l;for(let c of t.d.split(" ")){let u=c[0],g=ty[u];if(!g){console.error(`Could not find drawing instructions for "${u}"`);continue}let _=c.substring(1).split(",");!_[0]||!_[1]||g(e,iy(_,s,n,i,r,!1,a,(t.leftPadding??0)*(l/2),(t.rightPadding??0)*(l/2)))}t.type===1?(e.strokeStyle=e.fillStyle,e.stroke()):e.fill(),e.closePath()}function d1(e,t,i=0){return Math.max(Math.min(e,t),i)}var ty={C:(e,t)=>e.bezierCurveTo(t[0],t[1],t[2],t[3],t[4],t[5]),L:(e,t)=>e.lineTo(t[0],t[1]),M:(e,t)=>e.moveTo(t[0],t[1])};function iy(e,t,i,r,s,n,o,a=0,h=0){let l=e.map(c=>parseFloat(c)||parseInt(c));if(l.length<2)throw new Error("Too few arguments for instruction");for(let c=0;c<l.length;c+=2)l[c]*=t-a*o-h*o,n&&l[c]!==0&&(l[c]=d1(Math.round(l[c]+.5)-.5,t,0)),l[c]+=r+a*o;for(let c=1;c<l.length;c+=2)l[c]*=i,n&&l[c]!==0&&(l[c]=d1(Math.round(l[c]+.5)-.5,i,0)),l[c]+=s;return l}var f1=class{constructor(){this._data={}}set(e,t,i){this._data[e]||(this._data[e]={}),this._data[e][t]=i}get(e,t){return this._data[e]?this._data[e][t]:void 0}clear(){this._data={}}},_1=class{constructor(){this._data=new f1}set(e,t,i,r,s){this._data.get(e,t)||this._data.set(e,t,new f1),this._data.get(e,t).set(i,r,s)}get(e,t,i,r){return this._data.get(e,t)?.get(i,r)}clear(){this._data.clear()}},ry=class{constructor(){this._tasks=[],this._i=0}enqueue(e){this._tasks.push(e),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(e){this._idleCallback=void 0;let t=0,i=0,r=e.timeRemaining(),s=0;for(;this._i<this._tasks.length;){if(t=performance.now(),this._tasks[this._i]()||this._i++,t=Math.max(1,performance.now()-t),i=Math.max(t,i),s=e.timeRemaining(),i*1.5>s){r-t<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(r-t))}ms`),this._start();return}r=s}this.clear()}},F6=class extends ry{_requestCallback(e){return setTimeout(()=>e(this._createDeadline(16)))}_cancelCallback(e){clearTimeout(e)}_createDeadline(e){let t=performance.now()+e;return{timeRemaining:()=>Math.max(0,t-performance.now())}}},P6=class extends ry{_requestCallback(e){return requestIdleCallback(e)}_cancelCallback(e){cancelIdleCallback(e)}},O6=!Ad&&"requestIdleCallback"in window?P6:F6,Ls=class sy{constructor(){this.fg=0,this.bg=0,this.extended=new ny}static toColorRGB(t){return[t>>>16&255,t>>>8&255,t&255]}static fromColorRGB(t){return(t[0]&255)<<16|(t[1]&255)<<8|t[2]&255}clone(){let t=new sy;return t.fg=this.fg,t.bg=this.bg,t.extended=this.extended.clone(),t}isInverse(){return this.fg&67108864}isBold(){return this.fg&134217728}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:this.fg&268435456}isBlink(){return this.fg&536870912}isInvisible(){return this.fg&1073741824}isItalic(){return this.bg&67108864}isDim(){return this.bg&134217728}isStrikethrough(){return this.fg&2147483648}isProtected(){return this.bg&536870912}isOverline(){return this.bg&1073741824}getFgColorMode(){return this.fg&50331648}getBgColorMode(){return this.bg&50331648}isFgRGB(){return(this.fg&50331648)===50331648}isBgRGB(){return(this.bg&50331648)===50331648}isFgPalette(){return(this.fg&50331648)===16777216||(this.fg&50331648)===33554432}isBgPalette(){return(this.bg&50331648)===16777216||(this.bg&50331648)===33554432}isFgDefault(){return(this.fg&50331648)===0}isBgDefault(){return(this.bg&50331648)===0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(this.fg&50331648){case 16777216:case 33554432:return this.fg&255;case 50331648:return this.fg&16777215;default:return-1}}getBgColor(){switch(this.bg&50331648){case 16777216:case 33554432:return this.bg&255;case 50331648:return this.bg&16777215;default:return-1}}hasExtendedAttrs(){return this.bg&268435456}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(this.bg&268435456&&~this.extended.underlineColor)switch(this.extended.underlineColor&50331648){case 16777216:case 33554432:return this.extended.underlineColor&255;case 50331648:return this.extended.underlineColor&16777215;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return this.bg&268435456&&~this.extended.underlineColor?this.extended.underlineColor&50331648:this.getFgColorMode()}isUnderlineColorRGB(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===50331648:this.isFgRGB()}isUnderlineColorPalette(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===16777216||(this.extended.underlineColor&50331648)===33554432:this.isFgPalette()}isUnderlineColorDefault(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===0:this.isFgDefault()}getUnderlineStyle(){return this.fg&268435456?this.bg&268435456?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}},ny=class oy{constructor(t=0,i=0){this._ext=0,this._urlId=0,this._ext=t,this._urlId=i}get ext(){return this._urlId?this._ext&-469762049|this.underlineStyle<<26:this._ext}set ext(t){this._ext=t}get underlineStyle(){return this._urlId?5:(this._ext&469762048)>>26}set underlineStyle(t){this._ext&=-469762049,this._ext|=t<<26&469762048}get underlineColor(){return this._ext&67108863}set underlineColor(t){this._ext&=-67108864,this._ext|=t&67108863}get urlId(){return this._urlId}set urlId(t){this._urlId=t}get underlineVariantOffset(){let t=(this._ext&3758096384)>>29;return t<0?t^4294967288:t}set underlineVariantOffset(t){this._ext&=536870911,this._ext|=t<<29&3758096384}clone(){return new oy(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}},p1=class _d{constructor(t){this.element=t,this.next=_d.Undefined,this.prev=_d.Undefined}};p1.Undefined=new p1(void 0);var K6=globalThis.performance&&typeof globalThis.performance.now=="function",N6=class ay{static create(t){return new ay(t)}constructor(t){this._now=K6&&t===!1?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}},Q6=!1,g1=!1,H6=!1,Ui;(e=>{e.None=()=>Ft.None;function t(C){if(H6){let{onDidAddListener:w}=C,k=md.create(),f=0;C.onDidAddListener=()=>{++f===2&&(console.warn("snapshotted emitter LIKELY used public and SHOULD HAVE BEEN created with DisposableStore. snapshotted here"),k.print()),w?.()}}}function i(C,w){return g(C,()=>{},0,void 0,!0,void 0,w)}e.defer=i;function r(C){return(w,k=null,f)=>{let d=!1,p;return p=C(y=>{if(!d)return p?p.dispose():d=!0,w.call(k,y)},null,f),d&&p.dispose(),p}}e.once=r;function s(C,w,k){return c((f,d=null,p)=>C(y=>f.call(d,w(y)),null,p),k)}e.map=s;function n(C,w,k){return c((f,d=null,p)=>C(y=>{w(y),f.call(d,y)},null,p),k)}e.forEach=n;function o(C,w,k){return c((f,d=null,p)=>C(y=>w(y)&&f.call(d,y),null,p),k)}e.filter=o;function a(C){return C}e.signal=a;function h(...C){return(w,k=null,f)=>{let d=q1(...C.map(p=>p(y=>w.call(k,y))));return u(d,f)}}e.any=h;function l(C,w,k,f){let d=k;return s(C,p=>(d=w(d,p),d),f)}e.reduce=l;function c(C,w){let k,f={onWillAddFirstListener(){k=C(d.fire,d)},onDidRemoveLastListener(){k?.dispose()}};w||t(f);let d=new ve(f);return w?.add(d),d.event}function u(C,w){return w instanceof Array?w.push(C):w&&w.add(C),C}function g(C,w,k=100,f=!1,d=!1,p,y){let A,S,F,U=0,$,z={leakWarningThreshold:p,onWillAddFirstListener(){A=C(ee=>{U++,S=w(S,ee),f&&!F&&(J.fire(S),S=void 0),$=()=>{let de=S;S=void 0,F=void 0,(!f||U>1)&&J.fire(de),U=0},typeof k=="number"?(clearTimeout(F),F=setTimeout($,k)):F===void 0&&(F=0,queueMicrotask($))})},onWillRemoveListener(){d&&U>0&&$?.()},onDidRemoveLastListener(){$=void 0,A.dispose()}};y||t(z);let J=new ve(z);return y?.add(J),J.event}e.debounce=g;function _(C,w=0,k){return e.debounce(C,(f,d)=>f?(f.push(d),f):[d],w,void 0,!0,void 0,k)}e.accumulate=_;function m(C,w=(f,d)=>f===d,k){let f=!0,d;return o(C,p=>{let y=f||!w(p,d);return f=!1,d=p,y},k)}e.latch=m;function v(C,w,k){return[e.filter(C,w,k),e.filter(C,f=>!w(f),k)]}e.split=v;function x(C,w=!1,k=[],f){let d=k.slice(),p=C(S=>{d?d.push(S):A.fire(S)});f&&f.add(p);let y=()=>{d?.forEach(S=>A.fire(S)),d=null},A=new ve({onWillAddFirstListener(){p||(p=C(S=>A.fire(S)),f&&f.add(p))},onDidAddFirstListener(){d&&(w?setTimeout(y):y())},onDidRemoveLastListener(){p&&p.dispose(),p=null}});return f&&f.add(A),A.event}e.buffer=x;function E(C,w){return(k,f,d)=>{let p=w(new D);return C(function(y){let A=p.evaluate(y);A!==M&&k.call(f,A)},void 0,d)}}e.chain=E;let M=Symbol("HaltChainable");class D{constructor(){this.steps=[]}map(w){return this.steps.push(w),this}forEach(w){return this.steps.push(k=>(w(k),k)),this}filter(w){return this.steps.push(k=>w(k)?k:M),this}reduce(w,k){let f=k;return this.steps.push(d=>(f=w(f,d),f)),this}latch(w=(k,f)=>k===f){let k=!0,f;return this.steps.push(d=>{let p=k||!w(d,f);return k=!1,f=d,p?d:M}),this}evaluate(w){for(let k of this.steps)if(w=k(w),w===M)break;return w}}function b(C,w,k=f=>f){let f=(...A)=>y.fire(k(...A)),d=()=>C.on(w,f),p=()=>C.removeListener(w,f),y=new ve({onWillAddFirstListener:d,onDidRemoveLastListener:p});return y.event}e.fromNodeEventEmitter=b;function L(C,w,k=f=>f){let f=(...A)=>y.fire(k(...A)),d=()=>C.addEventListener(w,f),p=()=>C.removeEventListener(w,f),y=new ve({onWillAddFirstListener:d,onDidRemoveLastListener:p});return y.event}e.fromDOMEventEmitter=L;function I(C){return new Promise(w=>r(C)(w))}e.toPromise=I;function R(C){let w=new ve;return C.then(k=>{w.fire(k)},()=>{w.fire(void 0)}).finally(()=>{w.dispose()}),w.event}e.fromPromise=R;function G(C,w){return C(k=>w.fire(k))}e.forward=G;function W(C,w,k){return w(k),C(f=>w(f))}e.runAndSubscribe=W;class V{constructor(w,k){this._observable=w,this._counter=0,this._hasChanged=!1;let f={onWillAddFirstListener:()=>{w.addObserver(this)},onDidRemoveLastListener:()=>{w.removeObserver(this)}};k||t(f),this.emitter=new ve(f),k&&k.add(this.emitter)}beginUpdate(w){this._counter++}handlePossibleChange(w){}handleChange(w,k){this._hasChanged=!0}endUpdate(w){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}function q(C,w){return new V(C,w).emitter.event}e.fromObservable=q;function ne(C){return(w,k,f)=>{let d=0,p=!1,y={beginUpdate(){d++},endUpdate(){d--,d===0&&(C.reportChanges(),p&&(p=!1,w.call(k)))},handlePossibleChange(){},handleChange(){p=!0}};C.addObserver(y),C.reportChanges();let A={dispose(){C.removeObserver(y)}};return f instanceof Is?f.add(A):Array.isArray(f)&&f.push(A),A}}e.fromObservableLight=ne})(Ui||={});var pd=class gd{constructor(t){this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name=`${t}_${gd._idPool++}`,gd.all.add(this)}start(t){this._stopWatch=new N6,this.listenerCount=t}stop(){if(this._stopWatch){let t=this._stopWatch.elapsed();this.durations.push(t),this.elapsedOverall+=t,this.invocationCount+=1,this._stopWatch=void 0}}};pd.all=new Set,pd._idPool=0;var X6=pd,m1=-1,ly=class hy{constructor(t,i,r=(hy._idPool++).toString(16).padStart(3,"0")){this._errorHandler=t,this.threshold=i,this.name=r,this._warnCountdown=0}dispose(){this._stacks?.clear()}check(t,i){let r=this.threshold;if(r<=0||i<r)return;this._stacks||(this._stacks=new Map);let s=this._stacks.get(t.value)||0;if(this._stacks.set(t.value,s+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=r*.5;let[n,o]=this.getMostFrequentStack(),a=`[${this.name}] potential listener LEAK detected, having ${i} listeners already. MOST frequent listener (${o}):`;console.warn(a),console.warn(n);let h=new z6(a,n);this._errorHandler(h)}return()=>{let n=this._stacks.get(t.value)||0;this._stacks.set(t.value,n-1)}}getMostFrequentStack(){if(!this._stacks)return;let t,i=0;for(let[r,s]of this._stacks)(!t||i<s)&&(t=[r,s],i=s);return t}};ly._idPool=1;var U6=ly,md=class cy{constructor(t){this.value=t}static create(){let t=new Error;return new cy(t.stack??"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},z6=class extends Error{constructor(e,t){super(e),this.name="ListenerLeakError",this.stack=t}},W6=class extends Error{constructor(e,t){super(e),this.name="ListenerRefusalError",this.stack=t}},$6=0,_l=class{constructor(e){this.value=e,this.id=$6++}},G6=2,j6=(e,t)=>{if(e instanceof _l)t(e);else for(let i=0;i<e.length;i++){let r=e[i];r&&t(r)}},pl;if(Q6){let e=[];setInterval(()=>{e.length!==0&&(console.warn("[LEAKING LISTENERS] GC'ed these listeners that were NOT yet disposed:"),console.warn(e.join(`
`)),e.length=0)},3e3),pl=new FinalizationRegistry(t=>{typeof t=="string"&&e.push(t)})}var ve=class{constructor(e){this._size=0,this._options=e,this._leakageMon=m1>0||this._options?.leakWarningThreshold?new U6(e?.onListenerError??fl,this._options?.leakWarningThreshold??m1):void 0,this._perfMon=this._options?._profName?new X6(this._options._profName):void 0,this._deliveryQueue=this._options?.deliveryQueue}dispose(){if(!this._disposed){if(this._disposed=!0,this._deliveryQueue?.current===this&&this._deliveryQueue.reset(),this._listeners){if(g1){let e=this._listeners;queueMicrotask(()=>{j6(e,t=>t.stack?.print())})}this._listeners=void 0,this._size=0}this._options?.onDidRemoveLastListener?.(),this._leakageMon?.dispose()}}get event(){return this._event??=(e,t,i)=>{if(this._leakageMon&&this._size>this._leakageMon.threshold**2){let a=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(a);let h=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],l=new W6(`${a}. HINT: Stack shows most frequent listener (${h[1]}-times)`,h[0]);return(this._options?.onListenerError||fl)(l),Ft.None}if(this._disposed)return Ft.None;t&&(e=e.bind(t));let r=new _l(e),s,n;this._leakageMon&&this._size>=Math.ceil(this._leakageMon.threshold*.2)&&(r.stack=md.create(),s=this._leakageMon.check(r.stack,this._size+1)),g1&&(r.stack=n??md.create()),this._listeners?this._listeners instanceof _l?(this._deliveryQueue??=new q6,this._listeners=[this._listeners,r]):this._listeners.push(r):(this._options?.onWillAddFirstListener?.(this),this._listeners=r,this._options?.onDidAddFirstListener?.(this)),this._size++;let o=lt(()=>{pl?.unregister(o),s?.(),this._removeListener(r)});if(i instanceof Is?i.add(o):Array.isArray(i)&&i.push(o),pl){let a=new Error().stack.split(`
`).slice(2,3).join(`
`).trim(),h=/(file:|vscode-file:\/\/vscode-app)?(\/[^:]*:\d+:\d+)/.exec(a);pl.register(o,h?.[2]??a,o)}return o},this._event}_removeListener(e){if(this._options?.onWillRemoveListener?.(this),!this._listeners)return;if(this._size===1){this._listeners=void 0,this._options?.onDidRemoveLastListener?.(this),this._size=0;return}let t=this._listeners,i=t.indexOf(e);if(i===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),new Error("Attempted to dispose unknown listener");this._size--,t[i]=void 0;let r=this._deliveryQueue.current===this;if(this._size*G6<=t.length){let s=0;for(let n=0;n<t.length;n++)t[n]?t[s++]=t[n]:r&&(this._deliveryQueue.end--,s<this._deliveryQueue.i&&this._deliveryQueue.i--);t.length=s}}_deliver(e,t){if(!e)return;let i=this._options?.onListenerError||fl;if(!i){e.value(t);return}try{e.value(t)}catch(r){i(r)}}_deliverQueue(e){let t=e.current._listeners;for(;e.i<e.end;)this._deliver(t[e.i++],e.value);e.reset()}fire(e){if(this._deliveryQueue?.current&&(this._deliverQueue(this._deliveryQueue),this._perfMon?.stop()),this._perfMon?.start(this._size),this._listeners)if(this._listeners instanceof _l)this._deliver(this._listeners,e);else{let t=this._deliveryQueue;t.enqueue(this,e,this._listeners.length),this._deliverQueue(t)}this._perfMon?.stop()}hasListeners(){return this._size>0}},q6=class{constructor(){this.i=-1,this.end=0}enqueue(e,t,i){this.i=0,this.end=i,this.current=e,this.value=t}reset(){this.i=this.end,this.current=void 0,this.value=void 0}},v1={texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},offset:{x:0,y:0},size:{x:0,y:0},sizeClipSpace:{x:0,y:0}},Zn=2,eo,xr=class Bs{constructor(t,i,r){this._document=t,this._config=i,this._unicodeService=r,this._didWarmUp=!1,this._cacheMap=new _1,this._cacheMapCombined=new _1,this._pages=[],this._activePages=[],this._workBoundingBox={top:0,left:0,bottom:0,right:0},this._workAttributeData=new Ls,this._textureSize=512,this._onAddTextureAtlasCanvas=new ve,this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=new ve,this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._requestClearModel=!1,this._createNewPage(),this._tmpCanvas=uy(t,this._config.deviceCellWidth*4+Zn*2,this._config.deviceCellHeight+Zn*2),this._tmpCtx=He(this._tmpCanvas.getContext("2d",{alpha:this._config.allowTransparency,willReadFrequently:!0}))}get pages(){return this._pages}dispose(){this._tmpCanvas.remove();for(let t of this.pages)t.canvas.remove();this._onAddTextureAtlasCanvas.dispose()}warmUp(){this._didWarmUp||(this._doWarmUp(),this._didWarmUp=!0)}_doWarmUp(){let t=new O6;for(let i=33;i<126;i++)t.enqueue(()=>{if(!this._cacheMap.get(i,0,0,0)){let r=this._drawToCache(i,0,0,0,!1,void 0);this._cacheMap.set(i,0,0,0,r)}})}beginFrame(){return this._requestClearModel}clearTexture(){if(!(this._pages[0].currentRow.x===0&&this._pages[0].currentRow.y===0)){for(let t of this._pages)t.clear();this._cacheMap.clear(),this._cacheMapCombined.clear(),this._didWarmUp=!1}}_createNewPage(){if(Bs.maxAtlasPages&&this._pages.length>=Math.max(4,Bs.maxAtlasPages)){let i=this._pages.filter(l=>l.canvas.width*2<=(Bs.maxTextureSize||4096)).sort((l,c)=>c.canvas.width!==l.canvas.width?c.canvas.width-l.canvas.width:c.percentageUsed-l.percentageUsed),r=-1,s=0;for(let l=0;l<i.length;l++)if(i[l].canvas.width!==s)r=l,s=i[l].canvas.width;else if(l-r===3)break;let n=i.slice(r,r+4),o=n.map(l=>l.glyphs[0].texturePage).sort((l,c)=>l>c?1:-1),a=this.pages.length-n.length,h=this._mergePages(n,a);h.version++;for(let l=o.length-1;l>=0;l--)this._deletePage(o[l]);this.pages.push(h),this._requestClearModel=!0,this._onAddTextureAtlasCanvas.fire(h.canvas)}let t=new Ju(this._document,this._textureSize);return this._pages.push(t),this._activePages.push(t),this._onAddTextureAtlasCanvas.fire(t.canvas),t}_mergePages(t,i){let r=t[0].canvas.width*2,s=new Ju(this._document,r,t);for(let[n,o]of t.entries()){let a=n*o.canvas.width%r,h=Math.floor(n/2)*o.canvas.height;s.ctx.drawImage(o.canvas,a,h);for(let c of o.glyphs)c.texturePage=i,c.sizeClipSpace.x=c.size.x/r,c.sizeClipSpace.y=c.size.y/r,c.texturePosition.x+=a,c.texturePosition.y+=h,c.texturePositionClipSpace.x=c.texturePosition.x/r,c.texturePositionClipSpace.y=c.texturePosition.y/r;this._onRemoveTextureAtlasCanvas.fire(o.canvas);let l=this._activePages.indexOf(o);l!==-1&&this._activePages.splice(l,1)}return s}_deletePage(t){this._pages.splice(t,1);for(let i=t;i<this._pages.length;i++){let r=this._pages[i];for(let s of r.glyphs)s.texturePage--;r.version++}}getRasterizedGlyphCombinedChar(t,i,r,s,n,o){return this._getFromCacheMap(this._cacheMapCombined,t,i,r,s,n,o)}getRasterizedGlyph(t,i,r,s,n,o){return this._getFromCacheMap(this._cacheMap,t,i,r,s,n,o)}_getFromCacheMap(t,i,r,s,n,o,a){return eo=t.get(i,r,s,n),eo||(eo=this._drawToCache(i,r,s,n,o,a),t.set(i,r,s,n,eo)),eo}_getColorFromAnsiIndex(t){if(t>=this._config.colors.ansi.length)throw new Error("No color found for idx "+t);return this._config.colors.ansi[t]}_getBackgroundColor(t,i,r,s){if(this._config.allowTransparency)return Gt;let n;switch(t){case 16777216:case 33554432:n=this._getColorFromAnsiIndex(i);break;case 50331648:let o=Ls.toColorRGB(i);n=wt.toColor(o[0],o[1],o[2]);break;case 0:default:r?n=ro.opaque(this._config.colors.foreground):n=this._config.colors.background;break}return this._config.allowTransparency||(n=ro.opaque(n)),n}_getForegroundColor(t,i,r,s,n,o,a,h,l,c){let u=this._getMinimumContrastColor(t,i,r,s,n,o,a,l,h,c);if(u)return u;let g;switch(n){case 16777216:case 33554432:this._config.drawBoldTextInBrightColors&&l&&o<8&&(o+=8),g=this._getColorFromAnsiIndex(o);break;case 50331648:let _=Ls.toColorRGB(o);g=wt.toColor(_[0],_[1],_[2]);break;case 0:default:a?g=this._config.colors.background:g=this._config.colors.foreground}return this._config.allowTransparency&&(g=ro.opaque(g)),h&&(g=ro.multiplyOpacity(g,k6)),g}_resolveBackgroundRgba(t,i,r){switch(t){case 16777216:case 33554432:return this._getColorFromAnsiIndex(i).rgba;case 50331648:return i<<8;case 0:default:return r?this._config.colors.foreground.rgba:this._config.colors.background.rgba}}_resolveForegroundRgba(t,i,r,s){switch(t){case 16777216:case 33554432:return this._config.drawBoldTextInBrightColors&&s&&i<8&&(i+=8),this._getColorFromAnsiIndex(i).rgba;case 50331648:return i<<8;case 0:default:return r?this._config.colors.background.rgba:this._config.colors.foreground.rgba}}_getMinimumContrastColor(t,i,r,s,n,o,a,h,l,c){if(this._config.minimumContrastRatio===1||c)return;let u=this._getContrastCache(l),g=u.getColor(t,s);if(g!==void 0)return g||void 0;let _=this._resolveBackgroundRgba(i,r,a),m=this._resolveForegroundRgba(n,o,a,h),v=Jr.ensureContrastRatio(_,m,this._config.minimumContrastRatio/(l?2:1));if(!v){u.setColor(t,s,null);return}let x=wt.toColor(v>>24&255,v>>16&255,v>>8&255);return u.setColor(t,s,x),x}_getContrastCache(t){return t?this._config.colors.halfContrastCache:this._config.colors.contrastCache}_drawToCache(t,i,r,s,n,o){let a=typeof t=="number"?String.fromCharCode(t):t;o&&this._tmpCanvas.parentElement!==o&&(this._tmpCanvas.style.display="none",o.append(this._tmpCanvas));let h=Math.min(this._config.deviceCellWidth*Math.max(a.length,2)+Zn*2,this._config.deviceMaxTextureSize);this._tmpCanvas.width<h&&(this._tmpCanvas.width=h);let l=Math.min(this._config.deviceCellHeight+Zn*4,this._textureSize);if(this._tmpCanvas.height<l&&(this._tmpCanvas.height=l),this._tmpCtx.save(),this._workAttributeData.fg=r,this._workAttributeData.bg=i,this._workAttributeData.extended.ext=s,!!this._workAttributeData.isInvisible())return v1;let c=!!this._workAttributeData.isBold(),u=!!this._workAttributeData.isInverse(),g=!!this._workAttributeData.isDim(),_=!!this._workAttributeData.isItalic(),m=!!this._workAttributeData.isUnderline(),v=!!this._workAttributeData.isStrikethrough(),x=!!this._workAttributeData.isOverline(),E=this._workAttributeData.getFgColor(),M=this._workAttributeData.getFgColorMode(),D=this._workAttributeData.getBgColor(),b=this._workAttributeData.getBgColorMode();if(u){let A=E;E=D,D=A;let S=M;M=b,b=S}let L=this._getBackgroundColor(b,D,u,g);this._tmpCtx.globalCompositeOperation="copy",this._tmpCtx.fillStyle=L.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.globalCompositeOperation="source-over";let I=c?this._config.fontWeightBold:this._config.fontWeight,R=_?"italic":"";this._tmpCtx.font=`${R} ${I} ${this._config.fontSize*this._config.devicePixelRatio}px ${this._config.fontFamily}`,this._tmpCtx.textBaseline=ey;let G=a.length===1&&Sd(a.charCodeAt(0)),W=a.length===1&&v6(a.charCodeAt(0)),V=this._getForegroundColor(i,b,D,r,M,E,u,g,c,Z1(a.charCodeAt(0)));this._tmpCtx.fillStyle=V.css;let q=W?0:Zn*2,ne=!1;this._config.customGlyphs!==!1&&(ne=D6(this._tmpCtx,a,q,q,this._config.deviceCellWidth,this._config.deviceCellHeight,this._config.fontSize,this._config.devicePixelRatio));let C=!G,w;if(typeof t=="number"?w=this._unicodeService.wcwidth(t):w=this._unicodeService.getStringCellWidth(t),m){this._tmpCtx.save();let A=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),S=A%2===1?.5:0;if(this._tmpCtx.lineWidth=A,this._workAttributeData.isUnderlineColorDefault())this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle;else if(this._workAttributeData.isUnderlineColorRGB())C=!1,this._tmpCtx.strokeStyle=`rgb(${Ls.toColorRGB(this._workAttributeData.getUnderlineColor()).join(",")})`;else{C=!1;let ee=this._workAttributeData.getUnderlineColor();this._config.drawBoldTextInBrightColors&&this._workAttributeData.isBold()&&ee<8&&(ee+=8),this._tmpCtx.strokeStyle=this._getColorFromAnsiIndex(ee).css}this._tmpCtx.beginPath();let F=q,U=Math.ceil(q+this._config.deviceCharHeight)-S-(n?A*2:0),$=U+A,z=U+A*2,J=this._workAttributeData.getUnderlineVariantOffset();for(let ee=0;ee<w;ee++){this._tmpCtx.save();let de=F+ee*this._config.deviceCellWidth,De=F+(ee+1)*this._config.deviceCellWidth,Yi=de+this._config.deviceCellWidth/2;switch(this._workAttributeData.extended.underlineStyle){case 2:this._tmpCtx.moveTo(de,U),this._tmpCtx.lineTo(De,U),this._tmpCtx.moveTo(de,z),this._tmpCtx.lineTo(De,z);break;case 3:let ri=A<=1?z:Math.ceil(q+this._config.deviceCharHeight-A/2)-S,Et=A<=1?U:Math.ceil(q+this._config.deviceCharHeight+A/2)-S,fe=new Path2D;fe.rect(de,U,this._config.deviceCellWidth,z-U),this._tmpCtx.clip(fe),this._tmpCtx.moveTo(de-this._config.deviceCellWidth/2,$),this._tmpCtx.bezierCurveTo(de-this._config.deviceCellWidth/2,Et,de,Et,de,$),this._tmpCtx.bezierCurveTo(de,ri,Yi,ri,Yi,$),this._tmpCtx.bezierCurveTo(Yi,Et,De,Et,De,$),this._tmpCtx.bezierCurveTo(De,ri,De+this._config.deviceCellWidth/2,ri,De+this._config.deviceCellWidth/2,$);break;case 4:let Ji=J===0?0:J>=A?A*2-J:A-J;J>=A||Ji===0?(this._tmpCtx.setLineDash([Math.round(A),Math.round(A)]),this._tmpCtx.moveTo(de+Ji,U),this._tmpCtx.lineTo(De,U)):(this._tmpCtx.setLineDash([Math.round(A),Math.round(A)]),this._tmpCtx.moveTo(de,U),this._tmpCtx.lineTo(de+Ji,U),this._tmpCtx.moveTo(de+Ji+A,U),this._tmpCtx.lineTo(De,U)),J=S6(De-de,A,J);break;case 5:let sw=.6,nw=.3,ql=De-de,bf=Math.floor(sw*ql),wf=Math.floor(nw*ql),ow=ql-bf-wf;this._tmpCtx.setLineDash([bf,wf,ow]),this._tmpCtx.moveTo(de,U),this._tmpCtx.lineTo(De,U);break;case 1:default:this._tmpCtx.moveTo(de,U),this._tmpCtx.lineTo(De,U);break}this._tmpCtx.stroke(),this._tmpCtx.restore()}if(this._tmpCtx.restore(),!ne&&this._config.fontSize>=12&&!this._config.allowTransparency&&a!==" "){this._tmpCtx.save(),this._tmpCtx.textBaseline="alphabetic";let ee=this._tmpCtx.measureText(a);if(this._tmpCtx.restore(),"actualBoundingBoxDescent"in ee&&ee.actualBoundingBoxDescent>0){this._tmpCtx.save();let de=new Path2D;de.rect(F,U-Math.ceil(A/2),this._config.deviceCellWidth*w,z-U+Math.ceil(A/2)),this._tmpCtx.clip(de),this._tmpCtx.lineWidth=this._config.devicePixelRatio*3,this._tmpCtx.strokeStyle=L.css,this._tmpCtx.strokeText(a,q,q+this._config.deviceCharHeight),this._tmpCtx.restore()}}}if(x){let A=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),S=A%2===1?.5:0;this._tmpCtx.lineWidth=A,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(q,q+S),this._tmpCtx.lineTo(q+this._config.deviceCharWidth*w,q+S),this._tmpCtx.stroke()}if(ne||this._tmpCtx.fillText(a,q,q+this._config.deviceCharHeight),a==="_"&&!this._config.allowTransparency){let A=Zu(this._tmpCtx.getImageData(q,q,this._config.deviceCellWidth,this._config.deviceCellHeight),L,V,C);if(A)for(let S=1;S<=5&&(this._tmpCtx.save(),this._tmpCtx.fillStyle=L.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.restore(),this._tmpCtx.fillText(a,q,q+this._config.deviceCharHeight-S),A=Zu(this._tmpCtx.getImageData(q,q,this._config.deviceCellWidth,this._config.deviceCellHeight),L,V,C),!!A);S++);}if(v){let A=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/10)),S=this._tmpCtx.lineWidth%2===1?.5:0;this._tmpCtx.lineWidth=A,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(q,q+Math.floor(this._config.deviceCharHeight/2)-S),this._tmpCtx.lineTo(q+this._config.deviceCharWidth*w,q+Math.floor(this._config.deviceCharHeight/2)-S),this._tmpCtx.stroke()}this._tmpCtx.restore();let k=this._tmpCtx.getImageData(0,0,this._tmpCanvas.width,this._tmpCanvas.height),f;if(this._config.allowTransparency?f=V6(k):f=Zu(k,L,V,C),f)return v1;let d=this._findGlyphBoundingBox(k,this._workBoundingBox,h,W,ne,q),p,y;for(;;){if(this._activePages.length===0){let A=this._createNewPage();p=A,y=A.currentRow,y.height=d.size.y;break}p=this._activePages[this._activePages.length-1],y=p.currentRow;for(let A of this._activePages)d.size.y<=A.currentRow.height&&(p=A,y=A.currentRow);for(let A=this._activePages.length-1;A>=0;A--)for(let S of this._activePages[A].fixedRows)S.height<=y.height&&d.size.y<=S.height&&(p=this._activePages[A],y=S);if(d.size.x>this._textureSize){this._overflowSizePage||(this._overflowSizePage=new Ju(this._document,this._config.deviceMaxTextureSize),this.pages.push(this._overflowSizePage),this._requestClearModel=!0,this._onAddTextureAtlasCanvas.fire(this._overflowSizePage.canvas)),p=this._overflowSizePage,y=this._overflowSizePage.currentRow,y.x+d.size.x>=p.canvas.width&&(y.x=0,y.y+=y.height,y.height=0);break}if(y.y+d.size.y>=p.canvas.height||y.height>d.size.y+2){let A=!1;if(p.currentRow.y+p.currentRow.height+d.size.y>=p.canvas.height){let S;for(let F of this._activePages)if(F.currentRow.y+F.currentRow.height+d.size.y<F.canvas.height){S=F;break}if(S)p=S;else if(Bs.maxAtlasPages&&this._pages.length>=Bs.maxAtlasPages&&y.y+d.size.y<=p.canvas.height&&y.height>=d.size.y&&y.x+d.size.x<=p.canvas.width)A=!0;else{let F=this._createNewPage();p=F,y=F.currentRow,y.height=d.size.y,A=!0}}A||(p.currentRow.height>0&&p.fixedRows.push(p.currentRow),y={x:0,y:p.currentRow.y+p.currentRow.height,height:d.size.y},p.fixedRows.push(y),p.currentRow={x:0,y:y.y+y.height,height:0})}if(y.x+d.size.x<=p.canvas.width)break;y===p.currentRow?(y.x=0,y.y+=y.height,y.height=0):p.fixedRows.splice(p.fixedRows.indexOf(y),1)}return d.texturePage=this._pages.indexOf(p),d.texturePosition.x=y.x,d.texturePosition.y=y.y,d.texturePositionClipSpace.x=y.x/p.canvas.width,d.texturePositionClipSpace.y=y.y/p.canvas.height,d.sizeClipSpace.x/=p.canvas.width,d.sizeClipSpace.y/=p.canvas.height,y.height=Math.max(y.height,d.size.y),y.x+=d.size.x,p.ctx.putImageData(k,d.texturePosition.x-this._workBoundingBox.left,d.texturePosition.y-this._workBoundingBox.top,this._workBoundingBox.left,this._workBoundingBox.top,d.size.x,d.size.y),p.addGlyph(d),p.version++,d}_findGlyphBoundingBox(t,i,r,s,n,o){i.top=0;let a=s?this._config.deviceCellHeight:this._tmpCanvas.height,h=s?this._config.deviceCellWidth:r,l=!1;for(let c=0;c<a;c++){for(let u=0;u<h;u++){let g=c*this._tmpCanvas.width*4+u*4+3;if(t.data[g]!==0){i.top=c,l=!0;break}}if(l)break}i.left=0,l=!1;for(let c=0;c<o+h;c++){for(let u=0;u<a;u++){let g=u*this._tmpCanvas.width*4+c*4+3;if(t.data[g]!==0){i.left=c,l=!0;break}}if(l)break}i.right=h,l=!1;for(let c=o+h-1;c>=o;c--){for(let u=0;u<a;u++){let g=u*this._tmpCanvas.width*4+c*4+3;if(t.data[g]!==0){i.right=c,l=!0;break}}if(l)break}i.bottom=a,l=!1;for(let c=a-1;c>=0;c--){for(let u=0;u<h;u++){let g=c*this._tmpCanvas.width*4+u*4+3;if(t.data[g]!==0){i.bottom=c,l=!0;break}}if(l)break}return{texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},size:{x:i.right-i.left+1,y:i.bottom-i.top+1},sizeClipSpace:{x:i.right-i.left+1,y:i.bottom-i.top+1},offset:{x:-i.left+o+(s||n?Math.floor((this._config.deviceCellWidth-this._config.deviceCharWidth)/2):0),y:-i.top+o+(s||n?this._config.lineHeight===1?0:Math.round((this._config.deviceCellHeight-this._config.deviceCharHeight)/2):0)}}}},Ju=class{constructor(e,t,i){if(this._usedPixels=0,this._glyphs=[],this.version=0,this.currentRow={x:0,y:0,height:0},this.fixedRows=[],i)for(let r of i)this._glyphs.push(...r.glyphs),this._usedPixels+=r._usedPixels;this.canvas=uy(e,t,t),this.ctx=He(this.canvas.getContext("2d",{alpha:!0}))}get percentageUsed(){return this._usedPixels/(this.canvas.width*this.canvas.height)}get glyphs(){return this._glyphs}addGlyph(e){this._glyphs.push(e),this._usedPixels+=e.size.x*e.size.y}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.currentRow.x=0,this.currentRow.y=0,this.currentRow.height=0,this.fixedRows.length=0,this.version++}};function Zu(e,t,i,r){let s=t.rgba>>>24,n=t.rgba>>>16&255,o=t.rgba>>>8&255,a=i.rgba>>>24,h=i.rgba>>>16&255,l=i.rgba>>>8&255,c=Math.floor((Math.abs(s-a)+Math.abs(n-h)+Math.abs(o-l))/12),u=!0;for(let g=0;g<e.data.length;g+=4)e.data[g]===s&&e.data[g+1]===n&&e.data[g+2]===o||r&&Math.abs(e.data[g]-s)+Math.abs(e.data[g+1]-n)+Math.abs(e.data[g+2]-o)<c?e.data[g+3]=0:u=!1;return u}function V6(e){for(let t=0;t<e.data.length;t+=4)if(e.data[t+3]>0)return!1;return!0}function uy(e,t,i){let r=e.createElement("canvas");return r.width=t,r.height=i,r}function Y6(e,t,i,r,s,n,o,a){let h={foreground:n.foreground,background:n.background,cursor:Gt,cursorAccent:Gt,selectionForeground:Gt,selectionBackgroundTransparent:Gt,selectionBackgroundOpaque:Gt,selectionInactiveBackgroundTransparent:Gt,selectionInactiveBackgroundOpaque:Gt,overviewRulerBorder:Gt,scrollbarSliderBackground:Gt,scrollbarSliderHoverBackground:Gt,scrollbarSliderActiveBackground:Gt,ansi:n.ansi.slice(),contrastCache:n.contrastCache,halfContrastCache:n.halfContrastCache};return{customGlyphs:s.customGlyphs,devicePixelRatio:o,deviceMaxTextureSize:a,letterSpacing:s.letterSpacing,lineHeight:s.lineHeight,deviceCellWidth:e,deviceCellHeight:t,deviceCharWidth:i,deviceCharHeight:r,fontFamily:s.fontFamily,fontSize:s.fontSize,fontWeight:s.fontWeight,fontWeightBold:s.fontWeightBold,allowTransparency:s.allowTransparency,drawBoldTextInBrightColors:s.drawBoldTextInBrightColors,minimumContrastRatio:s.minimumContrastRatio,colors:h}}function y1(e,t){for(let i=0;i<e.colors.ansi.length;i++)if(e.colors.ansi[i].rgba!==t.colors.ansi[i].rgba)return!1;return e.devicePixelRatio===t.devicePixelRatio&&e.customGlyphs===t.customGlyphs&&e.lineHeight===t.lineHeight&&e.letterSpacing===t.letterSpacing&&e.fontFamily===t.fontFamily&&e.fontSize===t.fontSize&&e.fontWeight===t.fontWeight&&e.fontWeightBold===t.fontWeightBold&&e.allowTransparency===t.allowTransparency&&e.deviceCharWidth===t.deviceCharWidth&&e.deviceCharHeight===t.deviceCharHeight&&e.drawBoldTextInBrightColors===t.drawBoldTextInBrightColors&&e.minimumContrastRatio===t.minimumContrastRatio&&e.colors.foreground.rgba===t.colors.foreground.rgba&&e.colors.background.rgba===t.colors.background.rgba}function J6(e){return(e&50331648)===16777216||(e&50331648)===33554432}var qt=[];function dy(e,t,i,r,s,n,o,a,h){let l=Y6(r,s,n,o,t,i,a,h);for(let g=0;g<qt.length;g++){let _=qt[g],m=_.ownedBy.indexOf(e);if(m>=0){if(y1(_.config,l))return _.atlas;_.ownedBy.length===1?(_.atlas.dispose(),qt.splice(g,1)):_.ownedBy.splice(m,1);break}}for(let g=0;g<qt.length;g++){let _=qt[g];if(y1(_.config,l))return _.ownedBy.push(e),_.atlas}let c=e._core,u={atlas:new xr(document,l,c.unicodeService),config:l,ownedBy:[e]};return qt.push(u),u.atlas}function b1(e){for(let t=0;t<qt.length;t++){let i=qt[t].ownedBy.indexOf(e);if(i!==-1){qt[t].ownedBy.length===1?(qt[t].atlas.dispose(),qt.splice(t,1)):qt[t].ownedBy.splice(i,1);break}}}var ul=600,Z6=class{constructor(e,t){this._renderCallback=e,this._coreBrowserService=t,this.isCursorVisible=!0,this._coreBrowserService.isFocused&&this._restartInterval()}get isPaused(){return!(this._blinkStartTimeout||this._blinkInterval)}dispose(){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}restartBlinkAnimation(){this.isPaused||(this._animationTimeRestarted=Date.now(),this.isCursorVisible=!0,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})))}_restartInterval(e=ul){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout=this._coreBrowserService.window.setTimeout(()=>{if(this._animationTimeRestarted){let t=ul-(Date.now()-this._animationTimeRestarted);if(this._animationTimeRestarted=void 0,t>0){this._restartInterval(t);return}}this.isCursorVisible=!1,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0}),this._blinkInterval=this._coreBrowserService.window.setInterval(()=>{if(this._animationTimeRestarted){let t=ul-(Date.now()-this._animationTimeRestarted);this._animationTimeRestarted=void 0,this._restartInterval(t);return}this.isCursorVisible=!this.isCursorVisible,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})},ul)},e)}pause(){this.isCursorVisible=!0,this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}resume(){this.pause(),this._animationTimeRestarted=void 0,this._restartInterval(),this.restartBlinkAnimation()}};function w1(e,t,i){let r=new t.ResizeObserver(s=>{let n=s.find(h=>h.target===e);if(!n)return;if(!("devicePixelContentBoxSize"in n)){r?.disconnect(),r=void 0;return}let o=n.devicePixelContentBoxSize[0].inlineSize,a=n.devicePixelContentBoxSize[0].blockSize;o>0&&a>0&&i(o,a)});try{r.observe(e,{box:["device-pixel-content-box"]})}catch{r.disconnect(),r=void 0}return lt(()=>r?.disconnect())}function eB(e){return e>65535?(e-=65536,String.fromCharCode((e>>10)+55296)+String.fromCharCode(e%1024+56320)):String.fromCharCode(e)}var A1=class fy extends Ls{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new ny,this.combinedData=""}static fromCharData(t){let i=new fy;return i.setFromCharData(t),i}isCombined(){return this.content&2097152}getWidth(){return this.content>>22}getChars(){return this.content&2097152?this.combinedData:this.content&2097151?eB(this.content&2097151):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):this.content&2097151}setFromCharData(t){this.fg=t[0],this.bg=0;let i=!1;if(t[1].length>2)i=!0;else if(t[1].length===2){let r=t[1].charCodeAt(0);if(55296<=r&&r<=56319){let s=t[1].charCodeAt(1);56320<=s&&s<=57343?this.content=(r-55296)*1024+s-56320+65536|t[2]<<22:i=!0}else i=!0}else this.content=t[1].charCodeAt(0)|t[2]<<22;i&&(this.combinedData=t[1],this.content=2097152|t[2]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},_y=new Float32Array([2,0,0,0,0,-2,0,0,0,0,1,0,-1,1,0,1]);function py(e,t,i){let r=He(e.createProgram());if(e.attachShader(r,He(x1(e,e.VERTEX_SHADER,t))),e.attachShader(r,He(x1(e,e.FRAGMENT_SHADER,i))),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS))return r;console.error(e.getProgramInfoLog(r)),e.deleteProgram(r)}function x1(e,t,i){let r=He(e.createShader(t));if(e.shaderSource(r,i),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS))return r;console.error(e.getShaderInfoLog(r)),e.deleteShader(r)}function tB(e,t){let i=Math.min(e.length*2,t),r=new Float32Array(i);for(let s=0;s<e.length;s++)r[s]=e[s];return r}var iB=class{constructor(e){this.texture=e,this.version=-1}},rB=`#version 300 es
layout (location = 0) in vec2 a_unitquad;
layout (location = 1) in vec2 a_cellpos;
layout (location = 2) in vec2 a_offset;
layout (location = 3) in vec2 a_size;
layout (location = 4) in float a_texpage;
layout (location = 5) in vec2 a_texcoord;
layout (location = 6) in vec2 a_texsize;

uniform mat4 u_projection;
uniform vec2 u_resolution;

out vec2 v_texcoord;
flat out int v_texpage;

void main() {
  vec2 zeroToOne = (a_offset / u_resolution) + a_cellpos + (a_unitquad * a_size);
  gl_Position = u_projection * vec4(zeroToOne, 0.0, 1.0);
  v_texpage = int(a_texpage);
  v_texcoord = a_texcoord + a_unitquad * a_texsize;
}`;function sB(e){let t="";for(let i=1;i<e;i++)t+=` else if (v_texpage == ${i}) { outColor = texture(u_texture[${i}], v_texcoord); }`;return`#version 300 es
precision lowp float;

in vec2 v_texcoord;
flat in int v_texpage;

uniform sampler2D u_texture[${e}];

out vec4 outColor;

void main() {
  if (v_texpage == 0) {
    outColor = texture(u_texture[0], v_texcoord);
  } ${t}
}`}var Sr=11,Es=Sr*Float32Array.BYTES_PER_ELEMENT,nB=2,Te=0,xe,ed=0,to=0,oB=class extends Ft{constructor(e,t,i,r){super(),this._terminal=e,this._gl=t,this._dimensions=i,this._optionsService=r,this._activeBuffer=0,this._vertices={count:0,attributes:new Float32Array(0),attributesBuffers:[new Float32Array(0),new Float32Array(0)]};let s=this._gl;xr.maxAtlasPages===void 0&&(xr.maxAtlasPages=Math.min(32,He(s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS))),xr.maxTextureSize=He(s.getParameter(s.MAX_TEXTURE_SIZE))),this._program=He(py(s,rB,sB(xr.maxAtlasPages))),this._register(lt(()=>s.deleteProgram(this._program))),this._projectionLocation=He(s.getUniformLocation(this._program,"u_projection")),this._resolutionLocation=He(s.getUniformLocation(this._program,"u_resolution")),this._textureLocation=He(s.getUniformLocation(this._program,"u_texture")),this._vertexArrayObject=s.createVertexArray(),s.bindVertexArray(this._vertexArrayObject);let n=new Float32Array([0,0,1,0,0,1,1,1]),o=s.createBuffer();this._register(lt(()=>s.deleteBuffer(o))),s.bindBuffer(s.ARRAY_BUFFER,o),s.bufferData(s.ARRAY_BUFFER,n,s.STATIC_DRAW),s.enableVertexAttribArray(0),s.vertexAttribPointer(0,2,this._gl.FLOAT,!1,0,0);let a=new Uint8Array([0,1,2,3]),h=s.createBuffer();this._register(lt(()=>s.deleteBuffer(h))),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,h),s.bufferData(s.ELEMENT_ARRAY_BUFFER,a,s.STATIC_DRAW),this._attributesBuffer=He(s.createBuffer()),this._register(lt(()=>s.deleteBuffer(this._attributesBuffer))),s.bindBuffer(s.ARRAY_BUFFER,this._attributesBuffer),s.enableVertexAttribArray(2),s.vertexAttribPointer(2,2,s.FLOAT,!1,Es,0),s.vertexAttribDivisor(2,1),s.enableVertexAttribArray(3),s.vertexAttribPointer(3,2,s.FLOAT,!1,Es,2*Float32Array.BYTES_PER_ELEMENT),s.vertexAttribDivisor(3,1),s.enableVertexAttribArray(4),s.vertexAttribPointer(4,1,s.FLOAT,!1,Es,4*Float32Array.BYTES_PER_ELEMENT),s.vertexAttribDivisor(4,1),s.enableVertexAttribArray(5),s.vertexAttribPointer(5,2,s.FLOAT,!1,Es,5*Float32Array.BYTES_PER_ELEMENT),s.vertexAttribDivisor(5,1),s.enableVertexAttribArray(6),s.vertexAttribPointer(6,2,s.FLOAT,!1,Es,7*Float32Array.BYTES_PER_ELEMENT),s.vertexAttribDivisor(6,1),s.enableVertexAttribArray(1),s.vertexAttribPointer(1,2,s.FLOAT,!1,Es,9*Float32Array.BYTES_PER_ELEMENT),s.vertexAttribDivisor(1,1),s.useProgram(this._program);let l=new Int32Array(xr.maxAtlasPages);for(let c=0;c<xr.maxAtlasPages;c++)l[c]=c;s.uniform1iv(this._textureLocation,l),s.uniformMatrix4fv(this._projectionLocation,!1,_y),this._atlasTextures=[];for(let c=0;c<xr.maxAtlasPages;c++){let u=new iB(He(s.createTexture()));this._register(lt(()=>s.deleteTexture(u.texture))),s.activeTexture(s.TEXTURE0+c),s.bindTexture(s.TEXTURE_2D,u.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,new Uint8Array([255,0,0,255])),this._atlasTextures[c]=u}s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA),this.handleResize()}beginFrame(){return this._atlas?this._atlas.beginFrame():!0}updateCell(e,t,i,r,s,n,o,a,h){this._updateCell(this._vertices.attributes,e,t,i,r,s,n,o,a,h)}_updateCell(e,t,i,r,s,n,o,a,h,l){if(Te=(i*this._terminal.cols+t)*Sr,r===0||r===void 0){e.fill(0,Te,Te+Sr-1-nB);return}this._atlas&&(a&&a.length>1?xe=this._atlas.getRasterizedGlyphCombinedChar(a,s,n,o,!1,this._terminal.element):xe=this._atlas.getRasterizedGlyph(r,s,n,o,!1,this._terminal.element),ed=Math.floor((this._dimensions.device.cell.width-this._dimensions.device.char.width)/2),s!==l&&xe.offset.x>ed?(to=xe.offset.x-ed,e[Te]=-(xe.offset.x-to)+this._dimensions.device.char.left,e[Te+1]=-xe.offset.y+this._dimensions.device.char.top,e[Te+2]=(xe.size.x-to)/this._dimensions.device.canvas.width,e[Te+3]=xe.size.y/this._dimensions.device.canvas.height,e[Te+4]=xe.texturePage,e[Te+5]=xe.texturePositionClipSpace.x+to/this._atlas.pages[xe.texturePage].canvas.width,e[Te+6]=xe.texturePositionClipSpace.y,e[Te+7]=xe.sizeClipSpace.x-to/this._atlas.pages[xe.texturePage].canvas.width,e[Te+8]=xe.sizeClipSpace.y):(e[Te]=-xe.offset.x+this._dimensions.device.char.left,e[Te+1]=-xe.offset.y+this._dimensions.device.char.top,e[Te+2]=xe.size.x/this._dimensions.device.canvas.width,e[Te+3]=xe.size.y/this._dimensions.device.canvas.height,e[Te+4]=xe.texturePage,e[Te+5]=xe.texturePositionClipSpace.x,e[Te+6]=xe.texturePositionClipSpace.y,e[Te+7]=xe.sizeClipSpace.x,e[Te+8]=xe.sizeClipSpace.y),this._optionsService.rawOptions.rescaleOverlappingGlyphs&&A6(r,h,xe.size.x,this._dimensions.device.cell.width)&&(e[Te+2]=(this._dimensions.device.cell.width-1)/this._dimensions.device.canvas.width))}clear(){let e=this._terminal,t=e.cols*e.rows*Sr;this._vertices.count!==t?this._vertices.attributes=new Float32Array(t):this._vertices.attributes.fill(0);let i=0;for(;i<this._vertices.attributesBuffers.length;i++)this._vertices.count!==t?this._vertices.attributesBuffers[i]=new Float32Array(t):this._vertices.attributesBuffers[i].fill(0);this._vertices.count=t,i=0;for(let r=0;r<e.rows;r++)for(let s=0;s<e.cols;s++)this._vertices.attributes[i+9]=s/e.cols,this._vertices.attributes[i+10]=r/e.rows,i+=Sr}handleResize(){let e=this._gl;e.useProgram(this._program),e.viewport(0,0,e.canvas.width,e.canvas.height),e.uniform2f(this._resolutionLocation,e.canvas.width,e.canvas.height),this.clear()}render(e){if(!this._atlas)return;let t=this._gl;t.useProgram(this._program),t.bindVertexArray(this._vertexArrayObject),this._activeBuffer=(this._activeBuffer+1)%2;let i=this._vertices.attributesBuffers[this._activeBuffer],r=0;for(let s=0;s<e.lineLengths.length;s++){let n=s*this._terminal.cols*Sr,o=this._vertices.attributes.subarray(n,n+e.lineLengths[s]*Sr);i.set(o,r),r+=o.length}t.bindBuffer(t.ARRAY_BUFFER,this._attributesBuffer),t.bufferData(t.ARRAY_BUFFER,i.subarray(0,r),t.STREAM_DRAW);for(let s=0;s<this._atlas.pages.length;s++)this._atlas.pages[s].version!==this._atlasTextures[s].version&&this._bindAtlasPageTexture(t,this._atlas,s);t.drawElementsInstanced(t.TRIANGLE_STRIP,4,t.UNSIGNED_BYTE,0,r/Sr)}setAtlas(e){this._atlas=e;for(let t of this._atlasTextures)t.version=-1}_bindAtlasPageTexture(e,t,i){e.activeTexture(e.TEXTURE0+i),e.bindTexture(e.TEXTURE_2D,this._atlasTextures[i].texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t.pages[i].canvas),e.generateMipmap(e.TEXTURE_2D),this._atlasTextures[i].version=t.pages[i].version}setDimensions(e){this._dimensions=e}},aB=class{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(e,t,i,r=!1){if(this.selectionStart=t,this.selectionEnd=i,!t||!i||t[0]===i[0]&&t[1]===i[1]){this.clear();return}let s=e.buffers.active.ydisp,n=t[1]-s,o=i[1]-s,a=Math.max(n,0),h=Math.min(o,e.rows-1);if(a>=e.rows||h<0){this.clear();return}this.hasSelection=!0,this.columnSelectMode=r,this.viewportStartRow=n,this.viewportEndRow=o,this.viewportCappedStartRow=a,this.viewportCappedEndRow=h,this.startCol=t[0],this.endCol=i[0]}isCellSelected(e,t,i){return this.hasSelection?(i-=e.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?t>=this.startCol&&i>=this.viewportCappedStartRow&&t<this.endCol&&i<=this.viewportCappedEndRow:t<this.startCol&&i>=this.viewportCappedStartRow&&t>=this.endCol&&i<=this.viewportCappedEndRow:i>this.viewportStartRow&&i<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&i===this.viewportStartRow&&t>=this.startCol&&t<this.endCol||this.viewportStartRow<this.viewportEndRow&&i===this.viewportEndRow&&t<this.endCol||this.viewportStartRow<this.viewportEndRow&&i===this.viewportStartRow&&t>=this.startCol):!1}};function lB(){return new aB}var Al=4,gl=1,ml=2,td=3,hB=2147483648,cB=class{constructor(){this.cells=new Uint32Array(0),this.lineLengths=new Uint32Array(0),this.selection=lB()}resize(e,t){let i=e*t*Al;i!==this.cells.length&&(this.cells=new Uint32Array(i),this.lineLengths=new Uint32Array(t))}clear(){this.cells.fill(0,0),this.lineLengths.fill(0,0)}},uB=`#version 300 es
layout (location = 0) in vec2 a_position;
layout (location = 1) in vec2 a_size;
layout (location = 2) in vec4 a_color;
layout (location = 3) in vec2 a_unitquad;

uniform mat4 u_projection;

out vec4 v_color;

void main() {
  vec2 zeroToOne = a_position + (a_unitquad * a_size);
  gl_Position = u_projection * vec4(zeroToOne, 0.0, 1.0);
  v_color = a_color;
}`,dB=`#version 300 es
precision lowp float;

in vec4 v_color;

out vec4 outColor;

void main() {
  outColor = v_color;
}`,Xi=8,id=Xi*Float32Array.BYTES_PER_ELEMENT,fB=20*Xi,S1=class{constructor(){this.attributes=new Float32Array(fB),this.count=0}},Qi=0,C1=0,k1=0,E1=0,B1=0,L1=0,D1=0,_B=class extends Ft{constructor(e,t,i,r){super(),this._terminal=e,this._gl=t,this._dimensions=i,this._themeService=r,this._vertices=new S1,this._verticesCursor=new S1;let s=this._gl;this._program=He(py(s,uB,dB)),this._register(lt(()=>s.deleteProgram(this._program))),this._projectionLocation=He(s.getUniformLocation(this._program,"u_projection")),this._vertexArrayObject=s.createVertexArray(),s.bindVertexArray(this._vertexArrayObject);let n=new Float32Array([0,0,1,0,0,1,1,1]),o=s.createBuffer();this._register(lt(()=>s.deleteBuffer(o))),s.bindBuffer(s.ARRAY_BUFFER,o),s.bufferData(s.ARRAY_BUFFER,n,s.STATIC_DRAW),s.enableVertexAttribArray(3),s.vertexAttribPointer(3,2,this._gl.FLOAT,!1,0,0);let a=new Uint8Array([0,1,2,3]),h=s.createBuffer();this._register(lt(()=>s.deleteBuffer(h))),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,h),s.bufferData(s.ELEMENT_ARRAY_BUFFER,a,s.STATIC_DRAW),this._attributesBuffer=He(s.createBuffer()),this._register(lt(()=>s.deleteBuffer(this._attributesBuffer))),s.bindBuffer(s.ARRAY_BUFFER,this._attributesBuffer),s.enableVertexAttribArray(0),s.vertexAttribPointer(0,2,s.FLOAT,!1,id,0),s.vertexAttribDivisor(0,1),s.enableVertexAttribArray(1),s.vertexAttribPointer(1,2,s.FLOAT,!1,id,2*Float32Array.BYTES_PER_ELEMENT),s.vertexAttribDivisor(1,1),s.enableVertexAttribArray(2),s.vertexAttribPointer(2,4,s.FLOAT,!1,id,4*Float32Array.BYTES_PER_ELEMENT),s.vertexAttribDivisor(2,1),this._updateCachedColors(r.colors),this._register(this._themeService.onChangeColors(l=>{this._updateCachedColors(l),this._updateViewportRectangle()}))}renderBackgrounds(){this._renderVertices(this._vertices)}renderCursor(){this._renderVertices(this._verticesCursor)}_renderVertices(e){let t=this._gl;t.useProgram(this._program),t.bindVertexArray(this._vertexArrayObject),t.uniformMatrix4fv(this._projectionLocation,!1,_y),t.bindBuffer(t.ARRAY_BUFFER,this._attributesBuffer),t.bufferData(t.ARRAY_BUFFER,e.attributes,t.DYNAMIC_DRAW),t.drawElementsInstanced(this._gl.TRIANGLE_STRIP,4,t.UNSIGNED_BYTE,0,e.count)}handleResize(){this._updateViewportRectangle()}setDimensions(e){this._dimensions=e}_updateCachedColors(e){this._bgFloat=this._colorToFloat32Array(e.background),this._cursorFloat=this._colorToFloat32Array(e.cursor)}_updateViewportRectangle(){this._addRectangleFloat(this._vertices.attributes,0,0,0,this._terminal.cols*this._dimensions.device.cell.width,this._terminal.rows*this._dimensions.device.cell.height,this._bgFloat)}updateBackgrounds(e){let t=this._terminal,i=this._vertices,r=1,s,n,o,a,h,l,c,u,g,_,m;for(s=0;s<t.rows;s++){for(o=-1,a=0,h=0,l=!1,n=0;n<t.cols;n++)c=(s*t.cols+n)*Al,u=e.cells[c+gl],g=e.cells[c+ml],_=!!(g&67108864),(u!==a||g!==h&&(l||_))&&((a!==0||l&&h!==0)&&(m=r++*Xi,this._updateRectangle(i,m,h,a,o,n,s)),o=n,a=u,h=g,l=_);(a!==0||l&&h!==0)&&(m=r++*Xi,this._updateRectangle(i,m,h,a,o,t.cols,s))}i.count=r}updateCursor(e){let t=this._verticesCursor,i=e.cursor;if(!i||i.style==="block"){t.count=0;return}let r,s=0;(i.style==="bar"||i.style==="outline")&&(r=s++*Xi,this._addRectangleFloat(t.attributes,r,i.x*this._dimensions.device.cell.width,i.y*this._dimensions.device.cell.height,i.style==="bar"?i.dpr*i.cursorWidth:i.dpr,this._dimensions.device.cell.height,this._cursorFloat)),(i.style==="underline"||i.style==="outline")&&(r=s++*Xi,this._addRectangleFloat(t.attributes,r,i.x*this._dimensions.device.cell.width,(i.y+1)*this._dimensions.device.cell.height-i.dpr,i.width*this._dimensions.device.cell.width,i.dpr,this._cursorFloat)),i.style==="outline"&&(r=s++*Xi,this._addRectangleFloat(t.attributes,r,i.x*this._dimensions.device.cell.width,i.y*this._dimensions.device.cell.height,i.width*this._dimensions.device.cell.width,i.dpr,this._cursorFloat),r=s++*Xi,this._addRectangleFloat(t.attributes,r,(i.x+i.width)*this._dimensions.device.cell.width-i.dpr,i.y*this._dimensions.device.cell.height,i.dpr,this._dimensions.device.cell.height,this._cursorFloat)),t.count=s}_updateRectangle(e,t,i,r,s,n,o){if(i&67108864)switch(i&50331648){case 16777216:case 33554432:Qi=this._themeService.colors.ansi[i&255].rgba;break;case 50331648:Qi=(i&16777215)<<8;break;case 0:default:Qi=this._themeService.colors.foreground.rgba}else switch(r&50331648){case 16777216:case 33554432:Qi=this._themeService.colors.ansi[r&255].rgba;break;case 50331648:Qi=(r&16777215)<<8;break;case 0:default:Qi=this._themeService.colors.background.rgba}e.attributes.length<t+4&&(e.attributes=tB(e.attributes,this._terminal.rows*this._terminal.cols*Xi)),C1=s*this._dimensions.device.cell.width,k1=o*this._dimensions.device.cell.height,E1=(Qi>>24&255)/255,B1=(Qi>>16&255)/255,L1=(Qi>>8&255)/255,D1=1,this._addRectangle(e.attributes,t,C1,k1,(n-s)*this._dimensions.device.cell.width,this._dimensions.device.cell.height,E1,B1,L1,D1)}_addRectangle(e,t,i,r,s,n,o,a,h,l){e[t]=i/this._dimensions.device.canvas.width,e[t+1]=r/this._dimensions.device.canvas.height,e[t+2]=s/this._dimensions.device.canvas.width,e[t+3]=n/this._dimensions.device.canvas.height,e[t+4]=o,e[t+5]=a,e[t+6]=h,e[t+7]=l}_addRectangleFloat(e,t,i,r,s,n,o){e[t]=i/this._dimensions.device.canvas.width,e[t+1]=r/this._dimensions.device.canvas.height,e[t+2]=s/this._dimensions.device.canvas.width,e[t+3]=n/this._dimensions.device.canvas.height,e[t+4]=o[0],e[t+5]=o[1],e[t+6]=o[2],e[t+7]=o[3]}_colorToFloat32Array(e){return new Float32Array([(e.rgba>>24&255)/255,(e.rgba>>16&255)/255,(e.rgba>>8&255)/255,(e.rgba&255)/255])}},pB=class extends Ft{constructor(e,t,i,r,s,n,o,a){super(),this._container=t,this._alpha=s,this._coreBrowserService=n,this._optionsService=o,this._themeService=a,this._deviceCharWidth=0,this._deviceCharHeight=0,this._deviceCellWidth=0,this._deviceCellHeight=0,this._deviceCharLeft=0,this._deviceCharTop=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add(`xterm-${i}-layer`),this._canvas.style.zIndex=r.toString(),this._initCanvas(),this._container.appendChild(this._canvas),this._register(this._themeService.onChangeColors(h=>{this._refreshCharAtlas(e,h),this.reset(e)})),this._register(lt(()=>{this._canvas.remove()}))}_initCanvas(){this._ctx=He(this._canvas.getContext("2d",{alpha:this._alpha})),this._alpha||this._clearAll()}handleBlur(e){}handleFocus(e){}handleCursorMove(e){}handleGridChanged(e,t,i){}handleSelectionChanged(e,t,i,r=!1){}_setTransparency(e,t){if(t===this._alpha)return;let i=this._canvas;this._alpha=t,this._canvas=this._canvas.cloneNode(),this._initCanvas(),this._container.replaceChild(this._canvas,i),this._refreshCharAtlas(e,this._themeService.colors),this.handleGridChanged(e,0,e.rows-1)}_refreshCharAtlas(e,t){this._deviceCharWidth<=0&&this._deviceCharHeight<=0||(this._charAtlas=dy(e,this._optionsService.rawOptions,t,this._deviceCellWidth,this._deviceCellHeight,this._deviceCharWidth,this._deviceCharHeight,this._coreBrowserService.dpr,2048),this._charAtlas.warmUp())}resize(e,t){this._deviceCellWidth=t.device.cell.width,this._deviceCellHeight=t.device.cell.height,this._deviceCharWidth=t.device.char.width,this._deviceCharHeight=t.device.char.height,this._deviceCharLeft=t.device.char.left,this._deviceCharTop=t.device.char.top,this._canvas.width=t.device.canvas.width,this._canvas.height=t.device.canvas.height,this._canvas.style.width=`${t.css.canvas.width}px`,this._canvas.style.height=`${t.css.canvas.height}px`,this._alpha||this._clearAll(),this._refreshCharAtlas(e,this._themeService.colors)}_fillBottomLineAtCells(e,t,i=1){this._ctx.fillRect(e*this._deviceCellWidth,(t+1)*this._deviceCellHeight-this._coreBrowserService.dpr-1,i*this._deviceCellWidth,this._coreBrowserService.dpr)}_clearAll(){this._alpha?this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height))}_clearCells(e,t,i,r){this._alpha?this._ctx.clearRect(e*this._deviceCellWidth,t*this._deviceCellHeight,i*this._deviceCellWidth,r*this._deviceCellHeight):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(e*this._deviceCellWidth,t*this._deviceCellHeight,i*this._deviceCellWidth,r*this._deviceCellHeight))}_fillCharTrueColor(e,t,i,r){this._ctx.font=this._getFont(e,!1,!1),this._ctx.textBaseline=ey,this._clipCell(i,r,t.getWidth()),this._ctx.fillText(t.getChars(),i*this._deviceCellWidth+this._deviceCharLeft,r*this._deviceCellHeight+this._deviceCharTop+this._deviceCharHeight)}_clipCell(e,t,i){this._ctx.beginPath(),this._ctx.rect(e*this._deviceCellWidth,t*this._deviceCellHeight,i*this._deviceCellWidth,this._deviceCellHeight),this._ctx.clip()}_getFont(e,t,i){let r=t?e.options.fontWeightBold:e.options.fontWeight;return`${i?"italic":""} ${r} ${e.options.fontSize*this._coreBrowserService.dpr}px ${e.options.fontFamily}`}},gB=class extends pB{constructor(e,t,i,r,s,n,o){super(i,e,"link",t,!0,s,n,o),this._register(r.onShowLinkUnderline(a=>this._handleShowLinkUnderline(a))),this._register(r.onHideLinkUnderline(a=>this._handleHideLinkUnderline(a)))}resize(e,t){super.resize(e,t),this._state=void 0}reset(e){this._clearCurrentLink()}_clearCurrentLink(){if(this._state){this._clearCells(this._state.x1,this._state.y1,this._state.cols-this._state.x1,1);let e=this._state.y2-this._state.y1-1;e>0&&this._clearCells(0,this._state.y1+1,this._state.cols,e),this._clearCells(0,this._state.y2,this._state.x2,1),this._state=void 0}}_handleShowLinkUnderline(e){if(e.fg===257?this._ctx.fillStyle=this._themeService.colors.background.css:e.fg!==void 0&&J6(e.fg)?this._ctx.fillStyle=this._themeService.colors.ansi[e.fg].css:this._ctx.fillStyle=this._themeService.colors.foreground.css,e.y1===e.y2)this._fillBottomLineAtCells(e.x1,e.y1,e.x2-e.x1);else{this._fillBottomLineAtCells(e.x1,e.y1,e.cols-e.x1);for(let t=e.y1+1;t<e.y2;t++)this._fillBottomLineAtCells(0,t,e.cols);this._fillBottomLineAtCells(0,e.y2,e.x2)}this._state=e}_handleHideLinkUnderline(e){this._clearCurrentLink()}},ii=typeof window=="object"?window:globalThis,vd=class{constructor(){this.mapWindowIdToZoomLevel=new Map,this._onDidChangeZoomLevel=new ve,this.onDidChangeZoomLevel=this._onDidChangeZoomLevel.event,this.mapWindowIdToZoomFactor=new Map,this._onDidChangeFullscreen=new ve,this.onDidChangeFullscreen=this._onDidChangeFullscreen.event,this.mapWindowIdToFullScreen=new Map}getZoomLevel(t){return this.mapWindowIdToZoomLevel.get(this.getWindowId(t))??0}setZoomLevel(t,i){if(this.getZoomLevel(i)===t)return;let r=this.getWindowId(i);this.mapWindowIdToZoomLevel.set(r,t),this._onDidChangeZoomLevel.fire(r)}getZoomFactor(t){return this.mapWindowIdToZoomFactor.get(this.getWindowId(t))??1}setZoomFactor(t,i){this.mapWindowIdToZoomFactor.set(this.getWindowId(i),t)}setFullscreen(t,i){if(this.isFullscreen(i)===t)return;let r=this.getWindowId(i);this.mapWindowIdToFullScreen.set(r,t),this._onDidChangeFullscreen.fire(r)}isFullscreen(t){return!!this.mapWindowIdToFullScreen.get(this.getWindowId(t))}getWindowId(t){return t.vscodeWindowId}};vd.INSTANCE=new vd;var gy=vd;function mB(e,t,i){typeof t=="string"&&(t=e.matchMedia(t)),t.addEventListener("change",i)}var fR=gy.INSTANCE.onDidChangeZoomLevel,_R=gy.INSTANCE.onDidChangeFullscreen,Ts=typeof navigator=="object"?navigator.userAgent:"",pR=Ts.indexOf("Firefox")>=0,rd=Ts.indexOf("AppleWebKit")>=0,vB=Ts.indexOf("Chrome")>=0,yB=!vB&&Ts.indexOf("Safari")>=0,gR=Ts.indexOf("Electron/")>=0,mR=Ts.indexOf("Android")>=0,vl=!1;if(typeof ii.matchMedia=="function"){let e=ii.matchMedia("(display-mode: standalone) or (display-mode: window-controls-overlay)"),t=ii.matchMedia("(display-mode: fullscreen)");vl=e.matches,mB(ii,e,({matches:i})=>{vl&&t.matches||(vl=i)})}function bB(){return vl}var Ds="en",yd=!1,bd=!1,yl=!1,wB=!1,my=!1,vy=!1,AB=!1,xB=!1,SB=!1,CB=!1,dl,bl=Ds,I1=Ds,kB,Hi,Wi=globalThis,Rt;typeof Wi.vscode<"u"&&typeof Wi.vscode.process<"u"?Rt=Wi.vscode.process:typeof process<"u"&&typeof process?.versions?.node=="string"&&(Rt=process);var yy=typeof Rt?.versions?.electron=="string",EB=yy&&Rt?.type==="renderer";if(typeof Rt=="object"){yd=Rt.platform==="win32",bd=Rt.platform==="darwin",yl=Rt.platform==="linux",wB=yl&&!!Rt.env.SNAP&&!!Rt.env.SNAP_REVISION,AB=yy,SB=!!Rt.env.CI||!!Rt.env.BUILD_ARTIFACTSTAGINGDIRECTORY,dl=Ds,bl=Ds;let e=Rt.env.VSCODE_NLS_CONFIG;if(e)try{let t=JSON.parse(e);dl=t.userLocale,I1=t.osLocale,bl=t.resolvedLanguage||Ds,kB=t.languagePack?.translationsConfigFile}catch{}my=!0}else typeof navigator=="object"&&!EB?(Hi=navigator.userAgent,yd=Hi.indexOf("Windows")>=0,bd=Hi.indexOf("Macintosh")>=0,xB=(Hi.indexOf("Macintosh")>=0||Hi.indexOf("iPad")>=0||Hi.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,yl=Hi.indexOf("Linux")>=0,CB=Hi?.indexOf("Mobi")>=0,vy=!0,bl=globalThis._VSCODE_NLS_LANGUAGE||Ds,dl=navigator.language.toLowerCase(),I1=dl):console.error("Unable to resolve platform.");var sd=0;bd?sd=1:yd?sd=3:yl&&(sd=2);var nd=my,BB=vy&&typeof Wi.importScripts=="function",vR=BB?Wi.origin:void 0,yi=Hi,wr=bl,LB;(e=>{function t(){return wr}e.value=t;function i(){return wr.length===2?wr==="en":wr.length>=3?wr[0]==="e"&&wr[1]==="n"&&wr[2]==="-":!1}e.isDefaultVariant=i;function r(){return wr==="en"}e.isDefault=r})(LB||={});var DB=typeof Wi.postMessage=="function"&&!Wi.importScripts,IB=(()=>{if(DB){let e=[];Wi.addEventListener("message",i=>{if(i.data&&i.data.vscodeScheduleAsyncWork)for(let r=0,s=e.length;r<s;r++){let n=e[r];if(n.id===i.data.vscodeScheduleAsyncWork){e.splice(r,1),n.callback();return}}});let t=0;return i=>{let r=++t;e.push({id:r,callback:i}),Wi.postMessage({vscodeScheduleAsyncWork:r},"*")}}return e=>setTimeout(e)})(),MB=!!(yi&&yi.indexOf("Chrome")>=0),yR=!!(yi&&yi.indexOf("Firefox")>=0),bR=!!(!MB&&yi&&yi.indexOf("Safari")>=0),wR=!!(yi&&yi.indexOf("Edg/")>=0),AR=!!(yi&&yi.indexOf("Android")>=0),Ar=typeof navigator=="object"?navigator:{},xR={clipboard:{writeText:nd||document.queryCommandSupported&&document.queryCommandSupported("copy")||!!(Ar&&Ar.clipboard&&Ar.clipboard.writeText),readText:nd||!!(Ar&&Ar.clipboard&&Ar.clipboard.readText)},keyboard:nd||bB()?0:Ar.keyboard||yB?1:2,touch:"ontouchstart"in ii||Ar.maxTouchPoints>0,pointerEvents:ii.PointerEvent&&("ontouchstart"in ii||navigator.maxTouchPoints>0)},Cd=class{constructor(){this._keyCodeToStr=[],this._strToKeyCode=Object.create(null)}define(e,t){this._keyCodeToStr[e]=t,this._strToKeyCode[t.toLowerCase()]=e}keyCodeToStr(e){return this._keyCodeToStr[e]}strToKeyCode(e){return this._strToKeyCode[e.toLowerCase()]||0}},od=new Cd,M1=new Cd,T1=new Cd,SR=new Array(230),TB;(e=>{function t(a){return od.keyCodeToStr(a)}e.toString=t;function i(a){return od.strToKeyCode(a)}e.fromString=i;function r(a){return M1.keyCodeToStr(a)}e.toUserSettingsUS=r;function s(a){return T1.keyCodeToStr(a)}e.toUserSettingsGeneral=s;function n(a){return M1.strToKeyCode(a)||T1.strToKeyCode(a)}e.fromUserSettings=n;function o(a){if(a>=98&&a<=113)return null;switch(a){case 16:return"Up";case 18:return"Down";case 15:return"Left";case 17:return"Right"}return od.keyCodeToStr(a)}e.toElectronAccelerator=o})(TB||={});var by=Object.freeze(function(e,t){let i=setTimeout(e.bind(t),0);return{dispose(){clearTimeout(i)}}}),RB;(e=>{function t(i){return i===e.None||i===e.Cancelled||i instanceof FB?!0:!i||typeof i!="object"?!1:typeof i.isCancellationRequested=="boolean"&&typeof i.onCancellationRequested=="function"}e.isCancellationToken=t,e.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:Ui.None}),e.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:by})})(RB||={});var FB=class{constructor(){this._isCancelled=!1,this._emitter=null}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?by:(this._emitter||(this._emitter=new ve),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}},CR=Symbol("MicrotaskDelay"),PB,ad;(function(){typeof globalThis.requestIdleCallback!="function"||typeof globalThis.cancelIdleCallback!="function"?ad=(e,t)=>{IB(()=>{if(i)return;let r=Date.now()+15;t(Object.freeze({didTimeout:!0,timeRemaining(){return Math.max(0,r-Date.now())}}))});let i=!1;return{dispose(){i||(i=!0)}}}:ad=(e,t,i)=>{let r=e.requestIdleCallback(t,typeof i=="number"?{timeout:i}:void 0),s=!1;return{dispose(){s||(s=!0,e.cancelIdleCallback(r))}}},PB=e=>ad(globalThis,e)})();var OB;(e=>{async function t(r){let s,n=await Promise.all(r.map(o=>o.then(a=>a,a=>{s||(s=a)})));if(typeof s<"u")throw s;return n}e.settled=t;function i(r){return new Promise(async(s,n)=>{try{await r(s,n)}catch(o){n(o)}})}e.withAsyncBody=i})(OB||={});var R1=class jt{static fromArray(t){return new jt(i=>{i.emitMany(t)})}static fromPromise(t){return new jt(async i=>{i.emitMany(await t)})}static fromPromises(t){return new jt(async i=>{await Promise.all(t.map(async r=>i.emitOne(await r)))})}static merge(t){return new jt(async i=>{await Promise.all(t.map(async r=>{for await(let s of r)i.emitOne(s)}))})}constructor(t,i){this._state=0,this._results=[],this._error=null,this._onReturn=i,this._onStateChanged=new ve,queueMicrotask(async()=>{let r={emitOne:s=>this.emitOne(s),emitMany:s=>this.emitMany(s),reject:s=>this.reject(s)};try{await Promise.resolve(t(r)),this.resolve()}catch(s){this.reject(s)}finally{r.emitOne=void 0,r.emitMany=void 0,r.reject=void 0}})}[Symbol.asyncIterator](){let t=0;return{next:async()=>{do{if(this._state===2)throw this._error;if(t<this._results.length)return{done:!1,value:this._results[t++]};if(this._state===1)return{done:!0,value:void 0};await Ui.toPromise(this._onStateChanged.event)}while(!0)},return:async()=>(this._onReturn?.(),{done:!0,value:void 0})}}static map(t,i){return new jt(async r=>{for await(let s of t)r.emitOne(i(s))})}map(t){return jt.map(this,t)}static filter(t,i){return new jt(async r=>{for await(let s of t)i(s)&&r.emitOne(s)})}filter(t){return jt.filter(this,t)}static coalesce(t){return jt.filter(t,i=>!!i)}coalesce(){return jt.coalesce(this)}static async toPromise(t){let i=[];for await(let r of t)i.push(r);return i}toPromise(){return jt.toPromise(this)}emitOne(t){this._state===0&&(this._results.push(t),this._onStateChanged.fire())}emitMany(t){this._state===0&&(this._results=this._results.concat(t),this._onStateChanged.fire())}resolve(){this._state===0&&(this._state=1,this._onStateChanged.fire())}reject(t){this._state===0&&(this._state=2,this._error=t,this._onStateChanged.fire())}};R1.EMPTY=R1.fromArray([]);function KB(e){return 55296<=e&&e<=56319}function F1(e){return 56320<=e&&e<=57343}function NB(e,t){return(e-55296<<10)+(t-56320)+65536}function QB(e){return kd(e,0)}function kd(e,t){switch(typeof e){case"object":return e===null?zi(349,t):Array.isArray(e)?XB(e,t):UB(e,t);case"string":return wy(e,t);case"boolean":return HB(e,t);case"number":return zi(e,t);case"undefined":return zi(937,t);default:return zi(617,t)}}function zi(e,t){return(t<<5)-t+e|0}function HB(e,t){return zi(e?433:863,t)}function wy(e,t){t=zi(149417,t);for(let i=0,r=e.length;i<r;i++)t=zi(e.charCodeAt(i),t);return t}function XB(e,t){return t=zi(104579,t),e.reduce((i,r)=>kd(r,i),t)}function UB(e,t){return t=zi(181387,t),Object.keys(e).sort().reduce((i,r)=>(i=wy(r,i),kd(e[r],i)),t)}function ld(e,t,i=32){let r=i-t,s=~((1<<r)-1);return(e<<t|(s&e)>>>r)>>>0}function P1(e,t=0,i=e.byteLength,r=0){for(let s=0;s<i;s++)e[t+s]=r}function zB(e,t,i="0"){for(;e.length<t;)e=i+e;return e}function io(e,t=32){return e instanceof ArrayBuffer?Array.from(new Uint8Array(e)).map(i=>i.toString(16).padStart(2,"0")).join(""):zB((e>>>0).toString(16),t/4)}var WB=class Ay{constructor(){this._h0=1732584193,this._h1=4023233417,this._h2=2562383102,this._h3=271733878,this._h4=3285377520,this._buff=new Uint8Array(67),this._buffDV=new DataView(this._buff.buffer),this._buffLen=0,this._totalLen=0,this._leftoverHighSurrogate=0,this._finished=!1}update(t){let i=t.length;if(i===0)return;let r=this._buff,s=this._buffLen,n=this._leftoverHighSurrogate,o,a;for(n!==0?(o=n,a=-1,n=0):(o=t.charCodeAt(0),a=0);;){let h=o;if(KB(o))if(a+1<i){let l=t.charCodeAt(a+1);F1(l)?(a++,h=NB(o,l)):h=65533}else{n=o;break}else F1(o)&&(h=65533);if(s=this._push(r,s,h),a++,a<i)o=t.charCodeAt(a);else break}this._buffLen=s,this._leftoverHighSurrogate=n}_push(t,i,r){return r<128?t[i++]=r:r<2048?(t[i++]=192|(r&1984)>>>6,t[i++]=128|(r&63)>>>0):r<65536?(t[i++]=224|(r&61440)>>>12,t[i++]=128|(r&4032)>>>6,t[i++]=128|(r&63)>>>0):(t[i++]=240|(r&1835008)>>>18,t[i++]=128|(r&258048)>>>12,t[i++]=128|(r&4032)>>>6,t[i++]=128|(r&63)>>>0),i>=64&&(this._step(),i-=64,this._totalLen+=64,t[0]=t[64],t[1]=t[65],t[2]=t[66]),i}digest(){return this._finished||(this._finished=!0,this._leftoverHighSurrogate&&(this._leftoverHighSurrogate=0,this._buffLen=this._push(this._buff,this._buffLen,65533)),this._totalLen+=this._buffLen,this._wrapUp()),io(this._h0)+io(this._h1)+io(this._h2)+io(this._h3)+io(this._h4)}_wrapUp(){this._buff[this._buffLen++]=128,P1(this._buff,this._buffLen),this._buffLen>56&&(this._step(),P1(this._buff));let t=8*this._totalLen;this._buffDV.setUint32(56,Math.floor(t/4294967296),!1),this._buffDV.setUint32(60,t%4294967296,!1),this._step()}_step(){let t=Ay._bigBlock32,i=this._buffDV;for(let u=0;u<64;u+=4)t.setUint32(u,i.getUint32(u,!1),!1);for(let u=64;u<320;u+=4)t.setUint32(u,ld(t.getUint32(u-12,!1)^t.getUint32(u-32,!1)^t.getUint32(u-56,!1)^t.getUint32(u-64,!1),1),!1);let r=this._h0,s=this._h1,n=this._h2,o=this._h3,a=this._h4,h,l,c;for(let u=0;u<80;u++)u<20?(h=s&n|~s&o,l=1518500249):u<40?(h=s^n^o,l=1859775393):u<60?(h=s&n|s&o|n&o,l=2400959708):(h=s^n^o,l=3395469782),c=ld(r,5)+h+a+l+t.getUint32(u*4,!1)&4294967295,a=o,o=n,n=ld(s,30),s=r,r=c;this._h0=this._h0+r&4294967295,this._h1=this._h1+s&4294967295,this._h2=this._h2+n&4294967295,this._h3=this._h3+o&4294967295,this._h4=this._h4+a&4294967295}};WB._bigBlock32=new DataView(new ArrayBuffer(320));var{registerWindow:kR,getWindow:$B,getDocument:ER,getWindows:BR,getWindowsCount:LR,getWindowId:O1,getWindowById:DR,hasWindow:IR,onDidRegisterWindow:MR,onWillUnregisterWindow:TR,onDidUnregisterWindow:RR}=function(){let e=new Map,t={window:ii,disposables:new Is};e.set(ii.vscodeWindowId,t);let i=new ve,r=new ve,s=new ve;function n(o,a){return(typeof o=="number"?e.get(o):void 0)??(a?t:void 0)}return{onDidRegisterWindow:i.event,onWillUnregisterWindow:s.event,onDidUnregisterWindow:r.event,registerWindow(o){if(e.has(o.vscodeWindowId))return Ft.None;let a=new Is,h={window:o,disposables:a.add(new Is)};return e.set(o.vscodeWindowId,h),a.add(lt(()=>{e.delete(o.vscodeWindowId),r.fire(o)})),a.add(wd(o,qB.BEFORE_UNLOAD,()=>{s.fire(o)})),i.fire(h),a},getWindows(){return e.values()},getWindowsCount(){return e.size},getWindowId(o){return o.vscodeWindowId},hasWindow(o){return e.has(o)},getWindowById:n,getWindow(o){let a=o;if(a?.ownerDocument?.defaultView)return a.ownerDocument.defaultView.window;let h=o;return h?.view?h.view.window:ii},getDocument(o){return $B(o).document}}}(),GB=class{constructor(e,t,i,r){this._node=e,this._type=t,this._handler=i,this._options=r||!1,this._node.addEventListener(this._type,this._handler,this._options)}dispose(){this._handler&&(this._node.removeEventListener(this._type,this._handler,this._options),this._node=null,this._handler=null)}};function wd(e,t,i,r){return new GB(e,t,i,r)}var jB,K1,hd=class{constructor(e,t=0){this._runner=e,this.priority=t,this._canceled=!1}dispose(){this._canceled=!0}execute(){if(!this._canceled)try{this._runner()}catch(e){fl(e)}}static sort(e,t){return t.priority-e.priority}};(function(){let e=new Map,t=new Map,i=new Map,r=new Map,s=n=>{i.set(n,!1);let o=e.get(n)??[];for(t.set(n,o),e.set(n,[]),r.set(n,!0);o.length>0;)o.sort(hd.sort),o.shift().execute();r.set(n,!1)};K1=(n,o,a=0)=>{let h=O1(n),l=new hd(o,a),c=e.get(h);return c||(c=[],e.set(h,c)),c.push(l),i.get(h)||(i.set(h,!0),n.requestAnimationFrame(()=>s(h))),l},jB=(n,o,a)=>{let h=O1(n);if(r.get(h)){let l=new hd(o,a),c=t.get(h);return c||(c=[],t.set(h,c)),c.push(l),l}else return K1(n,o,a)}})();var N1=class wl{constructor(t,i){this.width=t,this.height=i}with(t=this.width,i=this.height){return t!==this.width||i!==this.height?new wl(t,i):this}static is(t){return typeof t=="object"&&typeof t.height=="number"&&typeof t.width=="number"}static lift(t){return t instanceof wl?t:new wl(t.width,t.height)}static equals(t,i){return t===i?!0:!t||!i?!1:t.width===i.width&&t.height===i.height}};N1.None=new N1(0,0);var FR=new class{constructor(){this.mutationObservers=new Map}observe(e,t,i){let r=this.mutationObservers.get(e);r||(r=new Map,this.mutationObservers.set(e,r));let s=QB(i),n=r.get(s);if(n)n.users+=1;else{let o=new ve,a=new MutationObserver(l=>o.fire(l));a.observe(e,i);let h=n={users:1,observer:a,onDidMutate:o.event};t.add(lt(()=>{h.users-=1,h.users===0&&(o.dispose(),a.disconnect(),r?.delete(s),r?.size===0&&this.mutationObservers.delete(e))})),r.set(s,n)}return n.onDidMutate}},qB={CLICK:"click",AUXCLICK:"auxclick",DBLCLICK:"dblclick",MOUSE_UP:"mouseup",MOUSE_DOWN:"mousedown",MOUSE_OVER:"mouseover",MOUSE_MOVE:"mousemove",MOUSE_OUT:"mouseout",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_WHEEL:"wheel",POINTER_UP:"pointerup",POINTER_DOWN:"pointerdown",POINTER_MOVE:"pointermove",POINTER_LEAVE:"pointerleave",CONTEXT_MENU:"contextmenu",WHEEL:"wheel",KEY_DOWN:"keydown",KEY_PRESS:"keypress",KEY_UP:"keyup",LOAD:"load",BEFORE_UNLOAD:"beforeunload",UNLOAD:"unload",PAGE_SHOW:"pageshow",PAGE_HIDE:"pagehide",PASTE:"paste",ABORT:"abort",ERROR:"error",RESIZE:"resize",SCROLL:"scroll",FULLSCREEN_CHANGE:"fullscreenchange",WK_FULLSCREEN_CHANGE:"webkitfullscreenchange",SELECT:"select",CHANGE:"change",SUBMIT:"submit",RESET:"reset",FOCUS:"focus",FOCUS_IN:"focusin",FOCUS_OUT:"focusout",BLUR:"blur",INPUT:"input",STORAGE:"storage",DRAG_START:"dragstart",DRAG:"drag",DRAG_ENTER:"dragenter",DRAG_LEAVE:"dragleave",DRAG_OVER:"dragover",DROP:"drop",DRAG_END:"dragend",ANIMATION_START:rd?"webkitAnimationStart":"animationstart",ANIMATION_END:rd?"webkitAnimationEnd":"animationend",ANIMATION_ITERATION:rd?"webkitAnimationIteration":"animationiteration"},VB=/([\w\-]+)?(#([\w\-]+))?((\.([\w\-]+))*)/;function xy(e,t,i,...r){let s=VB.exec(t);if(!s)throw new Error("Bad use of emmet");let n=s[1]||"div",o;return e!=="http://www.w3.org/1999/xhtml"?o=document.createElementNS(e,n):o=document.createElement(n),s[3]&&(o.id=s[3]),s[4]&&(o.className=s[4].replace(/\./g," ").trim()),i&&Object.entries(i).forEach(([a,h])=>{typeof h>"u"||(/^on\w+$/.test(a)?o[a]=h:a==="selected"?h&&o.setAttribute(a,"true"):o.setAttribute(a,h))}),o.append(...r),o}function YB(e,t,...i){return xy("http://www.w3.org/1999/xhtml",e,t,...i)}YB.SVG=function(e,t,...i){return xy("http://www.w3.org/2000/svg",e,t,...i)};var JB=class extends Ft{constructor(e,t,i,r,s,n,o,a,h){super(),this._terminal=e,this._characterJoinerService=t,this._charSizeService=i,this._coreBrowserService=r,this._coreService=s,this._decorationService=n,this._optionsService=o,this._themeService=a,this._cursorBlinkStateManager=new Jn,this._charAtlasDisposable=this._register(new Jn),this._observerDisposable=this._register(new Jn),this._model=new cB,this._workCell=new A1,this._workCell2=new A1,this._rectangleRenderer=this._register(new Jn),this._glyphRenderer=this._register(new Jn),this._onChangeTextureAtlas=this._register(new ve),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this._register(new ve),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=this._register(new ve),this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._onRequestRedraw=this._register(new ve),this.onRequestRedraw=this._onRequestRedraw.event,this._onContextLoss=this._register(new ve),this.onContextLoss=this._onContextLoss.event,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas");let l={antialias:!1,depth:!1,preserveDrawingBuffer:h};if(this._gl=this._canvas.getContext("webgl2",l),!this._gl)throw new Error("WebGL2 not supported "+this._gl);this._register(this._themeService.onChangeColors(()=>this._handleColorChange())),this._cellColorResolver=new C6(this._terminal,this._optionsService,this._model.selection,this._decorationService,this._coreBrowserService,this._themeService),this._core=this._terminal._core,this._renderLayers=[new gB(this._core.screenElement,2,this._terminal,this._core.linkifier,this._coreBrowserService,o,this._themeService)],this.dimensions=x6(),this._devicePixelRatio=this._coreBrowserService.dpr,this._updateDimensions(),this._updateCursorBlink(),this._register(o.onOptionChange(()=>this._handleOptionsChanged())),this._deviceMaxTextureSize=this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),this._register(wd(this._canvas,"webglcontextlost",c=>{console.log("webglcontextlost event received"),c.preventDefault(),this._contextRestorationTimeout=setTimeout(()=>{this._contextRestorationTimeout=void 0,console.warn("webgl context not restored; firing onContextLoss"),this._onContextLoss.fire(c)},3e3)})),this._register(wd(this._canvas,"webglcontextrestored",c=>{console.warn("webglcontextrestored event received"),clearTimeout(this._contextRestorationTimeout),this._contextRestorationTimeout=void 0,b1(this._terminal),this._initializeWebGLState(),this._requestRedrawViewport()})),this._observerDisposable.value=w1(this._canvas,this._coreBrowserService.window,(c,u)=>this._setCanvasDevicePixelDimensions(c,u)),this._register(this._coreBrowserService.onWindowChange(c=>{this._observerDisposable.value=w1(this._canvas,c,(u,g)=>this._setCanvasDevicePixelDimensions(u,g))})),this._core.screenElement.appendChild(this._canvas),[this._rectangleRenderer.value,this._glyphRenderer.value]=this._initializeWebGLState(),this._isAttached=this._core.screenElement.isConnected,this._register(lt(()=>{for(let c of this._renderLayers)c.dispose();this._canvas.parentElement?.removeChild(this._canvas),b1(this._terminal)}))}get textureAtlas(){return this._charAtlas?.pages[0].canvas}_handleColorChange(){this._refreshCharAtlas(),this._clearModel(!0)}handleDevicePixelRatioChange(){this._devicePixelRatio!==this._coreBrowserService.dpr&&(this._devicePixelRatio=this._coreBrowserService.dpr,this.handleResize(this._terminal.cols,this._terminal.rows))}handleResize(e,t){this._updateDimensions(),this._model.resize(this._terminal.cols,this._terminal.rows);for(let i of this._renderLayers)i.resize(this._terminal,this.dimensions);this._canvas.width=this.dimensions.device.canvas.width,this._canvas.height=this.dimensions.device.canvas.height,this._canvas.style.width=`${this.dimensions.css.canvas.width}px`,this._canvas.style.height=`${this.dimensions.css.canvas.height}px`,this._core.screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._core.screenElement.style.height=`${this.dimensions.css.canvas.height}px`,this._rectangleRenderer.value?.setDimensions(this.dimensions),this._rectangleRenderer.value?.handleResize(),this._glyphRenderer.value?.setDimensions(this.dimensions),this._glyphRenderer.value?.handleResize(),this._refreshCharAtlas(),this._clearModel(!1)}handleCharSizeChanged(){this.handleResize(this._terminal.cols,this._terminal.rows)}handleBlur(){for(let e of this._renderLayers)e.handleBlur(this._terminal);this._cursorBlinkStateManager.value?.pause(),this._requestRedrawViewport()}handleFocus(){for(let e of this._renderLayers)e.handleFocus(this._terminal);this._cursorBlinkStateManager.value?.resume(),this._requestRedrawViewport()}handleSelectionChanged(e,t,i){for(let r of this._renderLayers)r.handleSelectionChanged(this._terminal,e,t,i);this._model.selection.update(this._core,e,t,i),this._requestRedrawViewport()}handleCursorMove(){for(let e of this._renderLayers)e.handleCursorMove(this._terminal);this._cursorBlinkStateManager.value?.restartBlinkAnimation()}_handleOptionsChanged(){this._updateDimensions(),this._refreshCharAtlas(),this._updateCursorBlink()}_initializeWebGLState(){return this._rectangleRenderer.value=new _B(this._terminal,this._gl,this.dimensions,this._themeService),this._glyphRenderer.value=new oB(this._terminal,this._gl,this.dimensions,this._optionsService),this.handleCharSizeChanged(),[this._rectangleRenderer.value,this._glyphRenderer.value]}_refreshCharAtlas(){if(this.dimensions.device.char.width<=0&&this.dimensions.device.char.height<=0){this._isAttached=!1;return}let e=dy(this._terminal,this._optionsService.rawOptions,this._themeService.colors,this.dimensions.device.cell.width,this.dimensions.device.cell.height,this.dimensions.device.char.width,this.dimensions.device.char.height,this._coreBrowserService.dpr,this._deviceMaxTextureSize);this._charAtlas!==e&&(this._onChangeTextureAtlas.fire(e.pages[0].canvas),this._charAtlasDisposable.value=q1(Ui.forward(e.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas),Ui.forward(e.onRemoveTextureAtlasCanvas,this._onRemoveTextureAtlasCanvas))),this._charAtlas=e,this._charAtlas.warmUp(),this._glyphRenderer.value?.setAtlas(this._charAtlas)}_clearModel(e){this._model.clear(),e&&this._glyphRenderer.value?.clear()}clearTextureAtlas(){this._charAtlas?.clearTexture(),this._clearModel(!0),this._requestRedrawViewport()}clear(){this._clearModel(!0);for(let e of this._renderLayers)e.reset(this._terminal);this._cursorBlinkStateManager.value?.restartBlinkAnimation(),this._updateCursorBlink()}renderRows(e,t){if(!this._isAttached)if(this._core.screenElement?.isConnected&&this._charSizeService.width&&this._charSizeService.height)this._updateDimensions(),this._refreshCharAtlas(),this._isAttached=!0;else return;for(let i of this._renderLayers)i.handleGridChanged(this._terminal,e,t);!this._glyphRenderer.value||!this._rectangleRenderer.value||(this._glyphRenderer.value.beginFrame()?(this._clearModel(!0),this._updateModel(0,this._terminal.rows-1)):this._updateModel(e,t),this._rectangleRenderer.value.renderBackgrounds(),this._glyphRenderer.value.render(this._model),(!this._cursorBlinkStateManager.value||this._cursorBlinkStateManager.value.isCursorVisible)&&this._rectangleRenderer.value.renderCursor())}_updateCursorBlink(){this._coreService.decPrivateModes.cursorBlink??this._terminal.options.cursorBlink?this._cursorBlinkStateManager.value=new Z6(()=>{this._requestRedrawCursor()},this._coreBrowserService):this._cursorBlinkStateManager.clear(),this._requestRedrawCursor()}_updateModel(e,t){let i=this._core,r=this._workCell,s,n,o,a,h,l,c=0,u=!0,g,_,m,v,x,E,M,D,b;e=Q1(e,i.rows-1,0),t=Q1(t,i.rows-1,0);let L=this._coreService.decPrivateModes.cursorStyle??i.options.cursorStyle??"block",I=this._terminal.buffer.active.baseY+this._terminal.buffer.active.cursorY,R=I-i.buffer.ydisp,G=Math.min(this._terminal.buffer.active.cursorX,i.cols-1),W=-1,V=this._coreService.isCursorInitialized&&!this._coreService.isCursorHidden&&(!this._cursorBlinkStateManager.value||this._cursorBlinkStateManager.value.isCursorVisible);this._model.cursor=void 0;let q=!1;for(n=e;n<=t;n++)for(o=n+i.buffer.ydisp,a=i.buffer.lines.get(o),this._model.lineLengths[n]=0,m=I===o,c=0,h=this._characterJoinerService.getJoinedCharacters(o),D=0;D<i.cols;D++){if(s=this._cellColorResolver.result.bg,a.loadCell(D,r),D===0&&(s=this._cellColorResolver.result.bg),l=!1,u=D>=c,g=D,h.length>0&&D===h[0][0]&&u){_=h.shift();let ne=this._model.selection.isCellSelected(this._terminal,_[0],o);for(M=_[0]+1;M<_[1];M++)u&&=ne===this._model.selection.isCellSelected(this._terminal,M,o);u&&=!m||G<_[0]||G>=_[1],u?(l=!0,r=new ZB(r,a.translateToString(!0,_[0],_[1]),_[1]-_[0]),g=_[1]-1):c=_[1]}if(v=r.getChars(),x=r.getCode(),M=(n*i.cols+D)*Al,this._cellColorResolver.resolve(r,D,o,this.dimensions.device.cell.width),V&&o===I&&(D===G&&(this._model.cursor={x:G,y:R,width:r.getWidth(),style:this._coreBrowserService.isFocused?L:i.options.cursorInactiveStyle,cursorWidth:i.options.cursorWidth,dpr:this._devicePixelRatio},W=G+r.getWidth()-1),D>=G&&D<=W&&(this._coreBrowserService.isFocused&&L==="block"||this._coreBrowserService.isFocused===!1&&i.options.cursorInactiveStyle==="block")&&(this._cellColorResolver.result.fg=50331648|this._themeService.colors.cursorAccent.rgba>>8&16777215,this._cellColorResolver.result.bg=50331648|this._themeService.colors.cursor.rgba>>8&16777215)),x!==0&&(this._model.lineLengths[n]=D+1),!(this._model.cells[M]===x&&this._model.cells[M+gl]===this._cellColorResolver.result.bg&&this._model.cells[M+ml]===this._cellColorResolver.result.fg&&this._model.cells[M+td]===this._cellColorResolver.result.ext)&&(q=!0,v.length>1&&(x|=hB),this._model.cells[M]=x,this._model.cells[M+gl]=this._cellColorResolver.result.bg,this._model.cells[M+ml]=this._cellColorResolver.result.fg,this._model.cells[M+td]=this._cellColorResolver.result.ext,E=r.getWidth(),this._glyphRenderer.value.updateCell(D,n,x,this._cellColorResolver.result.bg,this._cellColorResolver.result.fg,this._cellColorResolver.result.ext,v,E,s),l)){for(r=this._workCell,D++;D<=g;D++)b=(n*i.cols+D)*Al,this._glyphRenderer.value.updateCell(D,n,0,0,0,0,g6,0,0),this._model.cells[b]=0,this._model.cells[b+gl]=this._cellColorResolver.result.bg,this._model.cells[b+ml]=this._cellColorResolver.result.fg,this._model.cells[b+td]=this._cellColorResolver.result.ext;D--}}q&&this._rectangleRenderer.value.updateBackgrounds(this._model),this._rectangleRenderer.value.updateCursor(this._model)}_updateDimensions(){!this._charSizeService.width||!this._charSizeService.height||(this.dimensions.device.char.width=Math.floor(this._charSizeService.width*this._devicePixelRatio),this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*this._devicePixelRatio),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.top=this._optionsService.rawOptions.lineHeight===1?0:Math.round((this.dimensions.device.cell.height-this.dimensions.device.char.height)/2),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.char.left=Math.floor(this._optionsService.rawOptions.letterSpacing/2),this.dimensions.device.canvas.height=this._terminal.rows*this.dimensions.device.cell.height,this.dimensions.device.canvas.width=this._terminal.cols*this.dimensions.device.cell.width,this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/this._devicePixelRatio),this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/this._devicePixelRatio),this.dimensions.css.cell.height=this.dimensions.device.cell.height/this._devicePixelRatio,this.dimensions.css.cell.width=this.dimensions.device.cell.width/this._devicePixelRatio)}_setCanvasDevicePixelDimensions(e,t){this._canvas.width===e&&this._canvas.height===t||(this._canvas.width=e,this._canvas.height=t,this._requestRedrawViewport())}_requestRedrawViewport(){this._onRequestRedraw.fire({start:0,end:this._terminal.rows-1})}_requestRedrawCursor(){let e=this._terminal.buffer.active.cursorY;this._onRequestRedraw.fire({start:e,end:e})}},ZB=class extends Ls{constructor(e,t,i){super(),this.content=0,this.combinedData="",this.fg=e.fg,this.bg=e.bg,this.combinedData=t,this._width=i}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(e){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}};function Q1(e,t,i=0){return Math.max(Math.min(e,t),i)}var H1="di$target",X1="di$dependencies",cd=new Map;function bi(e){if(cd.has(e))return cd.get(e);let t=function(i,r,s){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");eL(t,i,s)};return t._id=e,cd.set(e,t),t}function eL(e,t,i){t[H1]===t?t[X1].push({id:e,index:i}):(t[X1]=[{id:e,index:i}],t[H1]=t)}var PR=bi("BufferService"),OR=bi("CoreMouseService"),KR=bi("CoreService"),NR=bi("CharsetService"),QR=bi("InstantiationService"),HR=bi("LogService"),tL=bi("OptionsService"),XR=bi("OscLinkService"),UR=bi("UnicodeService"),zR=bi("DecorationService"),iL={trace:0,debug:1,info:2,warn:3,error:4,off:5},rL="xterm.js: ",U1=class extends Ft{constructor(e){super(),this._optionsService=e,this._logLevel=5,this._updateLogLevel(),this._register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),Sy=this}get logLevel(){return this._logLevel}_updateLogLevel(){this._logLevel=iL[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(e){for(let t=0;t<e.length;t++)typeof e[t]=="function"&&(e[t]=e[t]())}_log(e,t,i){this._evalLazyOptionalParams(i),e.call(console,(this._optionsService.options.logger?"":rL)+t,...i)}trace(e,...t){this._logLevel<=0&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,e,t)}debug(e,...t){this._logLevel<=1&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,e,t)}info(e,...t){this._logLevel<=2&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,e,t)}warn(e,...t){this._logLevel<=3&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,e,t)}error(e,...t){this._logLevel<=4&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,e,t)}};U1=V3([Y3(0,tL)],U1);var Sy;function sL(e){Sy=e}var Cy=class extends Ft{constructor(e){if(J1&&p6()<16){let t={antialias:!1,depth:!1,preserveDrawingBuffer:!0};if(!document.createElement("canvas").getContext("webgl2",t))throw new Error("Webgl2 is only supported on Safari 16 and above")}super(),this._preserveDrawingBuffer=e,this._onChangeTextureAtlas=this._register(new ve),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this._register(new ve),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=this._register(new ve),this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._onContextLoss=this._register(new ve),this.onContextLoss=this._onContextLoss.event}activate(e){let t=e._core;if(!e.element){this._register(t.onWillOpen(()=>this.activate(e)));return}this._terminal=e;let i=t.coreService,r=t.optionsService,s=t,n=s._renderService,o=s._characterJoinerService,a=s._charSizeService,h=s._coreBrowserService,l=s._decorationService,c=s._logService,u=s._themeService;sL(c),this._renderer=this._register(new JB(e,o,a,h,i,l,r,u,this._preserveDrawingBuffer)),this._register(Ui.forward(this._renderer.onContextLoss,this._onContextLoss)),this._register(Ui.forward(this._renderer.onChangeTextureAtlas,this._onChangeTextureAtlas)),this._register(Ui.forward(this._renderer.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas)),this._register(Ui.forward(this._renderer.onRemoveTextureAtlasCanvas,this._onRemoveTextureAtlasCanvas)),n.setRenderer(this._renderer),this._register(lt(()=>{if(this._terminal._core._store._isDisposed)return;let g=this._terminal._core._renderService;g.setRenderer(this._terminal._core._createRenderer()),g.handleResize(e.cols,e.rows)}))}get textureAtlas(){return this._renderer?.textureAtlas}clearTextureAtlas(){this._renderer?.clearTextureAtlas()}};var nL=class{constructor(e,t,i,r={}){this._terminal=e,this._regex=t,this._handler=i,this._options=r}provideLinks(e,t){let i=aL.computeLink(e,this._regex,this._terminal,this._handler);t(this._addCallbacks(i))}_addCallbacks(e){return e.map(t=>(t.leave=this._options.leave,t.hover=(i,r)=>{if(this._options.hover){let{range:s}=t;this._options.hover(i,r,s)}},t))}};function oL(e){try{let t=new URL(e),i=t.password&&t.username?`${t.protocol}//${t.username}:${t.password}@${t.host}`:t.username?`${t.protocol}//${t.username}@${t.host}`:`${t.protocol}//${t.host}`;return e.toLocaleLowerCase().startsWith(i.toLocaleLowerCase())}catch{return!1}}var aL=class Cl{static computeLink(t,i,r,s){let n=new RegExp(i.source,(i.flags||"")+"g"),[o,a]=Cl._getWindowedLineStrings(t-1,r),h=o.join(""),l,c=[];for(;l=n.exec(h);){let u=l[0];if(!oL(u))continue;let[g,_]=Cl._mapStrIdx(r,a,0,l.index),[m,v]=Cl._mapStrIdx(r,g,_,u.length);if(g===-1||_===-1||m===-1||v===-1)continue;let x={start:{x:_+1,y:g+1},end:{x:v,y:m+1}};c.push({range:x,text:u,activate:s})}return c}static _getWindowedLineStrings(t,i){let r,s=t,n=t,o=0,a="",h=[];if(r=i.buffer.active.getLine(t)){let l=r.translateToString(!0);if(r.isWrapped&&l[0]!==" "){for(o=0;(r=i.buffer.active.getLine(--s))&&o<2048&&(a=r.translateToString(!0),o+=a.length,h.push(a),!(!r.isWrapped||a.indexOf(" ")!==-1)););h.reverse()}for(h.push(l),o=0;(r=i.buffer.active.getLine(++n))&&r.isWrapped&&o<2048&&(a=r.translateToString(!0),o+=a.length,h.push(a),a.indexOf(" ")===-1););}return[h,s]}static _mapStrIdx(t,i,r,s){let n=t.buffer.active,o=n.getNullCell(),a=r;for(;s;){let h=n.getLine(i);if(!h)return[-1,-1];for(let l=a;l<h.length;++l){h.getCell(l,o);let c=o.getChars();if(o.getWidth()&&(s-=c.length||1,l===h.length-1&&c==="")){let u=n.getLine(i+1);u&&u.isWrapped&&(u.getCell(0,o),o.getWidth()===2&&(s+=1))}if(s<0)return[i,l]}i++,a=0}return[i,a]}},lL=/(https?|HTTPS?):[/]{2}[^\s"'!*(){}|\\\^<>`]*[^\s"':,.!?{}|\\\^~\[\]`()<>]/;function hL(e,t){let i=window.open();if(i){try{i.opener=null}catch{}i.location.href=t}else console.warn("Opening link blocked as opener could not be cleared")}var ky=class{constructor(e=hL,t={}){this._handler=e,this._options=t}activate(e){this._terminal=e;let t=this._options,i=t.urlRegex||lL;this._linkProvider=this._terminal.registerLinkProvider(new nL(this._terminal,i,this._handler,t))}dispose(){this._linkProvider?.dispose()}};var Ed=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],cL=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],je;function uL(e,t){let i=0,r=t.length-1,s;if(e<t[0][0]||e>t[r][1])return!1;for(;r>=i;)if(s=i+r>>1,e>t[s][1])i=s+1;else if(e<t[s][0])r=s-1;else return!0;return!1}var dL=class{constructor(){if(this.version="6",!je){je=new Uint8Array(65536),je.fill(1),je[0]=0,je.fill(0,1,32),je.fill(0,127,160),je.fill(2,4352,4448),je[9001]=2,je[9002]=2,je.fill(2,11904,42192),je[12351]=1,je.fill(2,44032,55204),je.fill(2,63744,64256),je.fill(2,65040,65050),je.fill(2,65072,65136),je.fill(2,65280,65377),je.fill(2,65504,65511);for(let e=0;e<Ed.length;++e)je.fill(0,Ed[e][0],Ed[e][1]+1)}}wcwidth(e){return e<32?0:e<127?1:e<65536?je[e]:uL(e,cL)?0:e>=131072&&e<=196605||e>=196608&&e<=262141?2:1}charProperties(e,t){let i=this.wcwidth(e),r=i===0&&t!==0;if(r){let s=Ll.extractWidth(t);s===0?r=!1:s>i&&(i=s)}return Ll.createPropertyValue(0,i,r)}},fL=class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(e){setTimeout(()=>{throw e.stack?Ey.isErrorNoTelemetry(e)?new Ey(e.message+`

`+e.stack):new Error(e.message+`

`+e.stack):e},0)}}addListener(e){return this.listeners.push(e),()=>{this._removeListener(e)}}emit(e){this.listeners.forEach(t=>{t(e)})}_removeListener(e){this.listeners.splice(this.listeners.indexOf(e),1)}setUnexpectedErrorHandler(e){this.unexpectedErrorHandler=e}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(e){this.unexpectedErrorHandler(e),this.emit(e)}onUnexpectedExternalError(e){this.unexpectedErrorHandler(e)}},_L=new fL;function Bd(e){pL(e)||_L.onUnexpectedError(e)}var Id="Canceled";function pL(e){return e instanceof gL?!0:e instanceof Error&&e.name===Id&&e.message===Id}var gL=class extends Error{constructor(){super(Id),this.name=this.message}},Ey=class Md extends Error{constructor(t){super(t),this.name="CodeExpectedError"}static fromError(t){if(t instanceof Md)return t;let i=new Md;return i.message=t.message,i.stack=t.stack,i}static isErrorNoTelemetry(t){return t.name==="CodeExpectedError"}};function mL(e,t){let i=this,r=!1,s;return function(){if(r)return s;if(r=!0,t)try{s=e.apply(i,arguments)}finally{t()}else s=e.apply(i,arguments);return s}}function vL(e,t,i=0,r=e.length){let s=i,n=r;for(;s<n;){let o=Math.floor((s+n)/2);t(e[o])?s=o+1:n=o}return s-1}var yL=class Fy{constructor(t){this._array=t,this._findLastMonotonousLastIdx=0}findLastMonotonous(t){if(Fy.assertInvariants){if(this._prevFindLastPredicate){for(let r of this._array)if(this._prevFindLastPredicate(r)&&!t(r))throw new Error("MonotonousArray: current predicate must be weaker than (or equal to) the previous predicate.")}this._prevFindLastPredicate=t}let i=vL(this._array,t,this._findLastMonotonousLastIdx);return this._findLastMonotonousLastIdx=i+1,i===-1?void 0:this._array[i]}};yL.assertInvariants=!1;var Py;(e=>{function t(n){return n<0}e.isLessThan=t;function i(n){return n<=0}e.isLessThanOrEqual=i;function r(n){return n>0}e.isGreaterThan=r;function s(n){return n===0}e.isNeitherLessOrGreaterThan=s,e.greaterThan=1,e.lessThan=-1,e.neitherLessOrGreaterThan=0})(Py||={});function bL(e,t){return(i,r)=>t(e(i),e(r))}var wL=(e,t)=>e-t,By=class Td{constructor(t){this.iterate=t}forEach(t){this.iterate(i=>(t(i),!0))}toArray(){let t=[];return this.iterate(i=>(t.push(i),!0)),t}filter(t){return new Td(i=>this.iterate(r=>t(r)?i(r):!0))}map(t){return new Td(i=>this.iterate(r=>i(t(r))))}some(t){let i=!1;return this.iterate(r=>(i=t(r),!i)),i}findFirst(t){let i;return this.iterate(r=>t(r)?(i=r,!1):!0),i}findLast(t){let i;return this.iterate(r=>(t(r)&&(i=r),!0)),i}findLastMaxBy(t){let i,r=!0;return this.iterate(s=>((r||Py.isGreaterThan(t(s,i)))&&(r=!1,i=s),!0)),i}};By.empty=new By(e=>{});function AL(e,t){let i=Object.create(null);for(let r of e){let s=t(r),n=i[s];n||(n=i[s]=[]),n.push(r)}return i}var Ly,Dy,MF=class{constructor(e,t){this.toKey=t,this._map=new Map,this[Ly]="SetWithKey";for(let i of e)this.add(i)}get size(){return this._map.size}add(e){let t=this.toKey(e);return this._map.set(t,e),this}delete(e){return this._map.delete(this.toKey(e))}has(e){return this._map.has(this.toKey(e))}*entries(){for(let e of this._map.values())yield[e,e]}keys(){return this.values()}*values(){for(let e of this._map.values())yield e}clear(){this._map.clear()}forEach(e,t){this._map.forEach(i=>e.call(t,i,i,this))}[(Dy=Symbol.iterator,Ly=Symbol.toStringTag,Dy)](){return this.values()}},xL=class{constructor(){this.map=new Map}add(e,t){let i=this.map.get(e);i||(i=new Set,this.map.set(e,i)),i.add(t)}delete(e,t){let i=this.map.get(e);i&&(i.delete(t),i.size===0&&this.map.delete(e))}forEach(e,t){let i=this.map.get(e);i&&i.forEach(t)}get(e){return this.map.get(e)||new Set}},Oy;(e=>{function t(b){return b&&typeof b=="object"&&typeof b[Symbol.iterator]=="function"}e.is=t;let i=Object.freeze([]);function r(){return i}e.empty=r;function*s(b){yield b}e.single=s;function n(b){return t(b)?b:s(b)}e.wrap=n;function o(b){return b||i}e.from=o;function*a(b){for(let L=b.length-1;L>=0;L--)yield b[L]}e.reverse=a;function h(b){return!b||b[Symbol.iterator]().next().done===!0}e.isEmpty=h;function l(b){return b[Symbol.iterator]().next().value}e.first=l;function c(b,L){let I=0;for(let R of b)if(L(R,I++))return!0;return!1}e.some=c;function u(b,L){for(let I of b)if(L(I))return I}e.find=u;function*g(b,L){for(let I of b)L(I)&&(yield I)}e.filter=g;function*_(b,L){let I=0;for(let R of b)yield L(R,I++)}e.map=_;function*m(b,L){let I=0;for(let R of b)yield*L(R,I++)}e.flatMap=m;function*v(...b){for(let L of b)yield*L}e.concat=v;function x(b,L,I){let R=I;for(let G of b)R=L(R,G);return R}e.reduce=x;function*E(b,L,I=b.length){for(L<0&&(L+=b.length),I<0?I+=b.length:I>b.length&&(I=b.length);L<I;L++)yield b[L]}e.slice=E;function M(b,L=Number.POSITIVE_INFINITY){let I=[];if(L===0)return[I,b];let R=b[Symbol.iterator]();for(let G=0;G<L;G++){let W=R.next();if(W.done)return[I,e.empty()];I.push(W.value)}return[I,{[Symbol.iterator](){return R}}]}e.consume=M;async function D(b){let L=[];for await(let I of b)L.push(I);return Promise.resolve(L)}e.asyncToArray=D})(Oy||={});var SL=!1,Rs=null,CL=class Ky{constructor(){this.livingDisposables=new Map}getDisposableData(t){let i=this.livingDisposables.get(t);return i||(i={parent:null,source:null,isSingleton:!1,value:t,idx:Ky.idx++},this.livingDisposables.set(t,i)),i}trackDisposable(t){let i=this.getDisposableData(t);i.source||(i.source=new Error().stack)}setParent(t,i){let r=this.getDisposableData(t);r.parent=i}markAsDisposed(t){this.livingDisposables.delete(t)}markAsSingleton(t){this.getDisposableData(t).isSingleton=!0}getRootParent(t,i){let r=i.get(t);if(r)return r;let s=t.parent?this.getRootParent(this.getDisposableData(t.parent),i):t;return i.set(t,s),s}getTrackedDisposables(){let t=new Map;return[...this.livingDisposables.entries()].filter(([,i])=>i.source!==null&&!this.getRootParent(i,t).isSingleton).flatMap(([i])=>i)}computeLeakingDisposables(t=10,i){let r;if(i)r=i;else{let h=new Map,l=[...this.livingDisposables.values()].filter(u=>u.source!==null&&!this.getRootParent(u,h).isSingleton);if(l.length===0)return;let c=new Set(l.map(u=>u.value));if(r=l.filter(u=>!(u.parent&&c.has(u.parent))),r.length===0)throw new Error("There are cyclic diposable chains!")}if(!r)return;function s(h){function l(u,g){for(;u.length>0&&g.some(_=>typeof _=="string"?_===u[0]:u[0].match(_));)u.shift()}let c=h.source.split(`
`).map(u=>u.trim().replace("at ","")).filter(u=>u!=="");return l(c,["Error",/^trackDisposable \(.*\)$/,/^DisposableTracker.trackDisposable \(.*\)$/]),c.reverse()}let n=new xL;for(let h of r){let l=s(h);for(let c=0;c<=l.length;c++)n.add(l.slice(0,c).join(`
`),h)}r.sort(bL(h=>h.idx,wL));let o="",a=0;for(let h of r.slice(0,t)){a++;let l=s(h),c=[];for(let u=0;u<l.length;u++){let g=l[u];g=`(shared with ${n.get(l.slice(0,u+1).join(`
`)).size}/${r.length} leaks) at ${g}`;let _=n.get(l.slice(0,u).join(`
`)),m=AL([..._].map(v=>s(v)[u]),v=>v);delete m[l[u]];for(let[v,x]of Object.entries(m))c.unshift(`    - stacktraces of ${x.length} other leaks continue with ${v}`);c.unshift(g)}o+=`


==================== Leaking disposable ${a}/${r.length}: ${h.value.constructor.name} ====================
${c.join(`
`)}
============================================================

`}return r.length>t&&(o+=`


... and ${r.length-t} more leaking disposables

`),{leaks:r,details:o}}};CL.idx=0;function kL(e){Rs=e}if(SL){let e="__is_disposable_tracked__";kL(new class{trackDisposable(t){let i=new Error("Potentially leaked disposable").stack;setTimeout(()=>{t[e]||console.log(i)},3e3)}setParent(t,i){if(t&&t!==Fs.None)try{t[e]=!0}catch{}}markAsDisposed(t){if(t&&t!==Fs.None)try{t[e]=!0}catch{}}markAsSingleton(t){}})}function Nd(e){return Rs?.trackDisposable(e),e}function Qd(e){Rs?.markAsDisposed(e)}function Rd(e,t){Rs?.setParent(e,t)}function EL(e,t){if(Rs)for(let i of e)Rs.setParent(i,t)}function Ny(e){if(Oy.is(e)){let t=[];for(let i of e)if(i)try{i.dispose()}catch(r){t.push(r)}if(t.length===1)throw t[0];if(t.length>1)throw new AggregateError(t,"Encountered errors while disposing of store");return Array.isArray(e)?[]:e}else if(e)return e.dispose(),e}function BL(...e){let t=Qy(()=>Ny(e));return EL(e,t),t}function Qy(e){let t=Nd({dispose:mL(()=>{Qd(t),e()})});return t}var Hy=class Xy{constructor(){this._toDispose=new Set,this._isDisposed=!1,Nd(this)}dispose(){this._isDisposed||(Qd(this),this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{Ny(this._toDispose)}finally{this._toDispose.clear()}}add(t){if(!t)return t;if(t===this)throw new Error("Cannot register a disposable on itself!");return Rd(t,this),this._isDisposed?Xy.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(t),t}delete(t){if(t){if(t===this)throw new Error("Cannot dispose a disposable on itself!");this._toDispose.delete(t),t.dispose()}}deleteAndLeak(t){t&&this._toDispose.has(t)&&(this._toDispose.delete(t),Rd(t,null))}};Hy.DISABLE_DISPOSED_WARNING=!1;var Hd=Hy,Fs=class{constructor(){this._store=new Hd,Nd(this),Rd(this._store,this)}dispose(){Qd(this),this._store.dispose()}_register(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}};Fs.None=Object.freeze({dispose(){}});var Iy=class Fd{constructor(t){this.element=t,this.next=Fd.Undefined,this.prev=Fd.Undefined}};Iy.Undefined=new Iy(void 0);var LL=globalThis.performance&&typeof globalThis.performance.now=="function",DL=class Uy{static create(t){return new Uy(t)}constructor(t){this._now=LL&&t===!1?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}},IL=!1,My=!1,ML=!1,TL;(e=>{e.None=()=>Fs.None;function t(C){if(ML){let{onDidAddListener:w}=C,k=Kd.create(),f=0;C.onDidAddListener=()=>{++f===2&&(console.warn("snapshotted emitter LIKELY used public and SHOULD HAVE BEEN created with DisposableStore. snapshotted here"),k.print()),w?.()}}}function i(C,w){return g(C,()=>{},0,void 0,!0,void 0,w)}e.defer=i;function r(C){return(w,k=null,f)=>{let d=!1,p;return p=C(y=>{if(!d)return p?p.dispose():d=!0,w.call(k,y)},null,f),d&&p.dispose(),p}}e.once=r;function s(C,w,k){return c((f,d=null,p)=>C(y=>f.call(d,w(y)),null,p),k)}e.map=s;function n(C,w,k){return c((f,d=null,p)=>C(y=>{w(y),f.call(d,y)},null,p),k)}e.forEach=n;function o(C,w,k){return c((f,d=null,p)=>C(y=>w(y)&&f.call(d,y),null,p),k)}e.filter=o;function a(C){return C}e.signal=a;function h(...C){return(w,k=null,f)=>{let d=BL(...C.map(p=>p(y=>w.call(k,y))));return u(d,f)}}e.any=h;function l(C,w,k,f){let d=k;return s(C,p=>(d=w(d,p),d),f)}e.reduce=l;function c(C,w){let k,f={onWillAddFirstListener(){k=C(d.fire,d)},onDidRemoveLastListener(){k?.dispose()}};w||t(f);let d=new Cr(f);return w?.add(d),d.event}function u(C,w){return w instanceof Array?w.push(C):w&&w.add(C),C}function g(C,w,k=100,f=!1,d=!1,p,y){let A,S,F,U=0,$,z={leakWarningThreshold:p,onWillAddFirstListener(){A=C(ee=>{U++,S=w(S,ee),f&&!F&&(J.fire(S),S=void 0),$=()=>{let de=S;S=void 0,F=void 0,(!f||U>1)&&J.fire(de),U=0},typeof k=="number"?(clearTimeout(F),F=setTimeout($,k)):F===void 0&&(F=0,queueMicrotask($))})},onWillRemoveListener(){d&&U>0&&$?.()},onDidRemoveLastListener(){$=void 0,A.dispose()}};y||t(z);let J=new Cr(z);return y?.add(J),J.event}e.debounce=g;function _(C,w=0,k){return e.debounce(C,(f,d)=>f?(f.push(d),f):[d],w,void 0,!0,void 0,k)}e.accumulate=_;function m(C,w=(f,d)=>f===d,k){let f=!0,d;return o(C,p=>{let y=f||!w(p,d);return f=!1,d=p,y},k)}e.latch=m;function v(C,w,k){return[e.filter(C,w,k),e.filter(C,f=>!w(f),k)]}e.split=v;function x(C,w=!1,k=[],f){let d=k.slice(),p=C(S=>{d?d.push(S):A.fire(S)});f&&f.add(p);let y=()=>{d?.forEach(S=>A.fire(S)),d=null},A=new Cr({onWillAddFirstListener(){p||(p=C(S=>A.fire(S)),f&&f.add(p))},onDidAddFirstListener(){d&&(w?setTimeout(y):y())},onDidRemoveLastListener(){p&&p.dispose(),p=null}});return f&&f.add(A),A.event}e.buffer=x;function E(C,w){return(k,f,d)=>{let p=w(new D);return C(function(y){let A=p.evaluate(y);A!==M&&k.call(f,A)},void 0,d)}}e.chain=E;let M=Symbol("HaltChainable");class D{constructor(){this.steps=[]}map(w){return this.steps.push(w),this}forEach(w){return this.steps.push(k=>(w(k),k)),this}filter(w){return this.steps.push(k=>w(k)?k:M),this}reduce(w,k){let f=k;return this.steps.push(d=>(f=w(f,d),f)),this}latch(w=(k,f)=>k===f){let k=!0,f;return this.steps.push(d=>{let p=k||!w(d,f);return k=!1,f=d,p?d:M}),this}evaluate(w){for(let k of this.steps)if(w=k(w),w===M)break;return w}}function b(C,w,k=f=>f){let f=(...A)=>y.fire(k(...A)),d=()=>C.on(w,f),p=()=>C.removeListener(w,f),y=new Cr({onWillAddFirstListener:d,onDidRemoveLastListener:p});return y.event}e.fromNodeEventEmitter=b;function L(C,w,k=f=>f){let f=(...A)=>y.fire(k(...A)),d=()=>C.addEventListener(w,f),p=()=>C.removeEventListener(w,f),y=new Cr({onWillAddFirstListener:d,onDidRemoveLastListener:p});return y.event}e.fromDOMEventEmitter=L;function I(C){return new Promise(w=>r(C)(w))}e.toPromise=I;function R(C){let w=new Cr;return C.then(k=>{w.fire(k)},()=>{w.fire(void 0)}).finally(()=>{w.dispose()}),w.event}e.fromPromise=R;function G(C,w){return C(k=>w.fire(k))}e.forward=G;function W(C,w,k){return w(k),C(f=>w(f))}e.runAndSubscribe=W;class V{constructor(w,k){this._observable=w,this._counter=0,this._hasChanged=!1;let f={onWillAddFirstListener:()=>{w.addObserver(this)},onDidRemoveLastListener:()=>{w.removeObserver(this)}};k||t(f),this.emitter=new Cr(f),k&&k.add(this.emitter)}beginUpdate(w){this._counter++}handlePossibleChange(w){}handleChange(w,k){this._hasChanged=!0}endUpdate(w){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}function q(C,w){return new V(C,w).emitter.event}e.fromObservable=q;function ne(C){return(w,k,f)=>{let d=0,p=!1,y={beginUpdate(){d++},endUpdate(){d--,d===0&&(C.reportChanges(),p&&(p=!1,w.call(k)))},handlePossibleChange(){},handleChange(){p=!0}};C.addObserver(y),C.reportChanges();let A={dispose(){C.removeObserver(y)}};return f instanceof Hd?f.add(A):Array.isArray(f)&&f.push(A),A}}e.fromObservableLight=ne})(TL||={});var Pd=class Od{constructor(t){this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name=`${t}_${Od._idPool++}`,Od.all.add(this)}start(t){this._stopWatch=new DL,this.listenerCount=t}stop(){if(this._stopWatch){let t=this._stopWatch.elapsed();this.durations.push(t),this.elapsedOverall+=t,this.invocationCount+=1,this._stopWatch=void 0}}};Pd.all=new Set,Pd._idPool=0;var RL=Pd,Ty=-1,zy=class Wy{constructor(t,i,r=(Wy._idPool++).toString(16).padStart(3,"0")){this._errorHandler=t,this.threshold=i,this.name=r,this._warnCountdown=0}dispose(){this._stacks?.clear()}check(t,i){let r=this.threshold;if(r<=0||i<r)return;this._stacks||(this._stacks=new Map);let s=this._stacks.get(t.value)||0;if(this._stacks.set(t.value,s+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=r*.5;let[n,o]=this.getMostFrequentStack(),a=`[${this.name}] potential listener LEAK detected, having ${i} listeners already. MOST frequent listener (${o}):`;console.warn(a),console.warn(n);let h=new PL(a,n);this._errorHandler(h)}return()=>{let n=this._stacks.get(t.value)||0;this._stacks.set(t.value,n-1)}}getMostFrequentStack(){if(!this._stacks)return;let t,i=0;for(let[r,s]of this._stacks)(!t||i<s)&&(t=[r,s],i=s);return t}};zy._idPool=1;var FL=zy,Kd=class $y{constructor(t){this.value=t}static create(){let t=new Error;return new $y(t.stack??"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},PL=class extends Error{constructor(e,t){super(e),this.name="ListenerLeakError",this.stack=t}},OL=class extends Error{constructor(e,t){super(e),this.name="ListenerRefusalError",this.stack=t}},KL=0,kl=class{constructor(e){this.value=e,this.id=KL++}},NL=2,QL=(e,t)=>{if(e instanceof kl)t(e);else for(let i=0;i<e.length;i++){let r=e[i];r&&t(r)}},El;if(IL){let e=[];setInterval(()=>{e.length!==0&&(console.warn("[LEAKING LISTENERS] GC'ed these listeners that were NOT yet disposed:"),console.warn(e.join(`
`)),e.length=0)},3e3),El=new FinalizationRegistry(t=>{typeof t=="string"&&e.push(t)})}var Cr=class{constructor(e){this._size=0,this._options=e,this._leakageMon=Ty>0||this._options?.leakWarningThreshold?new FL(e?.onListenerError??Bd,this._options?.leakWarningThreshold??Ty):void 0,this._perfMon=this._options?._profName?new RL(this._options._profName):void 0,this._deliveryQueue=this._options?.deliveryQueue}dispose(){if(!this._disposed){if(this._disposed=!0,this._deliveryQueue?.current===this&&this._deliveryQueue.reset(),this._listeners){if(My){let e=this._listeners;queueMicrotask(()=>{QL(e,t=>t.stack?.print())})}this._listeners=void 0,this._size=0}this._options?.onDidRemoveLastListener?.(),this._leakageMon?.dispose()}}get event(){return this._event??=(e,t,i)=>{if(this._leakageMon&&this._size>this._leakageMon.threshold**2){let a=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(a);let h=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],l=new OL(`${a}. HINT: Stack shows most frequent listener (${h[1]}-times)`,h[0]);return(this._options?.onListenerError||Bd)(l),Fs.None}if(this._disposed)return Fs.None;t&&(e=e.bind(t));let r=new kl(e),s,n;this._leakageMon&&this._size>=Math.ceil(this._leakageMon.threshold*.2)&&(r.stack=Kd.create(),s=this._leakageMon.check(r.stack,this._size+1)),My&&(r.stack=n??Kd.create()),this._listeners?this._listeners instanceof kl?(this._deliveryQueue??=new HL,this._listeners=[this._listeners,r]):this._listeners.push(r):(this._options?.onWillAddFirstListener?.(this),this._listeners=r,this._options?.onDidAddFirstListener?.(this)),this._size++;let o=Qy(()=>{El?.unregister(o),s?.(),this._removeListener(r)});if(i instanceof Hd?i.add(o):Array.isArray(i)&&i.push(o),El){let a=new Error().stack.split(`
`).slice(2,3).join(`
`).trim(),h=/(file:|vscode-file:\/\/vscode-app)?(\/[^:]*:\d+:\d+)/.exec(a);El.register(o,h?.[2]??a,o)}return o},this._event}_removeListener(e){if(this._options?.onWillRemoveListener?.(this),!this._listeners)return;if(this._size===1){this._listeners=void 0,this._options?.onDidRemoveLastListener?.(this),this._size=0;return}let t=this._listeners,i=t.indexOf(e);if(i===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),new Error("Attempted to dispose unknown listener");this._size--,t[i]=void 0;let r=this._deliveryQueue.current===this;if(this._size*NL<=t.length){let s=0;for(let n=0;n<t.length;n++)t[n]?t[s++]=t[n]:r&&(this._deliveryQueue.end--,s<this._deliveryQueue.i&&this._deliveryQueue.i--);t.length=s}}_deliver(e,t){if(!e)return;let i=this._options?.onListenerError||Bd;if(!i){e.value(t);return}try{e.value(t)}catch(r){i(r)}}_deliverQueue(e){let t=e.current._listeners;for(;e.i<e.end;)this._deliver(t[e.i++],e.value);e.reset()}fire(e){if(this._deliveryQueue?.current&&(this._deliverQueue(this._deliveryQueue),this._perfMon?.stop()),this._perfMon?.start(this._size),this._listeners)if(this._listeners instanceof kl)this._deliver(this._listeners,e);else{let t=this._deliveryQueue;t.enqueue(this,e,this._listeners.length),this._deliverQueue(t)}this._perfMon?.stop()}hasListeners(){return this._size>0}},HL=class{constructor(){this.i=-1,this.end=0}enqueue(e,t,i){this.i=0,this.end=i,this.current=e,this.value=t}reset(){this.i=this.end,this.current=void 0,this.value=void 0}},Ll=class Bl{constructor(){this._providers=Object.create(null),this._active="",this._onChange=new Cr,this.onChange=this._onChange.event;let t=new dL;this.register(t),this._active=t.version,this._activeProvider=t}static extractShouldJoin(t){return(t&1)!==0}static extractWidth(t){return t>>1&3}static extractCharKind(t){return t>>3}static createPropertyValue(t,i,r=!1){return(t&16777215)<<3|(i&3)<<1|(r?1:0)}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(t){if(!this._providers[t])throw new Error(`unknown Unicode version "${t}"`);this._active=t,this._activeProvider=this._providers[t],this._onChange.fire(t)}register(t){this._providers[t.version]=t}wcwidth(t){return this._activeProvider.wcwidth(t)}getStringCellWidth(t){let i=0,r=0,s=t.length;for(let n=0;n<s;++n){let o=t.charCodeAt(n);if(55296<=o&&o<=56319){if(++n>=s)return i+this.wcwidth(o);let l=t.charCodeAt(n);56320<=l&&l<=57343?o=(o-55296)*1024+l-56320+65536:i+=this.wcwidth(l)}let a=this.charProperties(o,r),h=Bl.extractWidth(a);Bl.extractShouldJoin(a)&&(h-=Bl.extractWidth(r)),i+=h,r=a}return i}charProperties(t,i){return this._activeProvider.charProperties(t,i)}},Ld=[[768,879],[1155,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1541],[1552,1562],[1564,1564],[1611,1631],[1648,1648],[1750,1757],[1759,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2045,2045],[2070,2073],[2075,2083],[2085,2087],[2089,2093],[2137,2139],[2259,2306],[2362,2362],[2364,2364],[2369,2376],[2381,2381],[2385,2391],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2558,2558],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2641,2641],[2672,2673],[2677,2677],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2810,2815],[2817,2817],[2876,2876],[2879,2879],[2881,2884],[2893,2893],[2902,2902],[2914,2915],[2946,2946],[3008,3008],[3021,3021],[3072,3072],[3076,3076],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3170,3171],[3201,3201],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3328,3329],[3387,3388],[3393,3396],[3405,3405],[3426,3427],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3981,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4151],[4153,4154],[4157,4158],[4184,4185],[4190,4192],[4209,4212],[4226,4226],[4229,4230],[4237,4237],[4253,4253],[4448,4607],[4957,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6158],[6277,6278],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6683,6683],[6742,6742],[6744,6750],[6752,6752],[6754,6754],[6757,6764],[6771,6780],[6783,6783],[6832,6846],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7040,7041],[7074,7077],[7080,7081],[7083,7085],[7142,7142],[7144,7145],[7149,7149],[7151,7153],[7212,7219],[7222,7223],[7376,7378],[7380,7392],[7394,7400],[7405,7405],[7412,7412],[7416,7417],[7616,7673],[7675,7679],[8203,8207],[8234,8238],[8288,8292],[8294,8303],[8400,8432],[11503,11505],[11647,11647],[11744,11775],[12330,12333],[12441,12442],[42607,42610],[42612,42621],[42654,42655],[42736,42737],[43010,43010],[43014,43014],[43019,43019],[43045,43046],[43204,43205],[43232,43249],[43263,43263],[43302,43309],[43335,43345],[43392,43394],[43443,43443],[43446,43449],[43452,43453],[43493,43493],[43561,43566],[43569,43570],[43573,43574],[43587,43587],[43596,43596],[43644,43644],[43696,43696],[43698,43700],[43703,43704],[43710,43711],[43713,43713],[43756,43757],[43766,43766],[44005,44005],[44008,44008],[44013,44013],[64286,64286],[65024,65039],[65056,65071],[65279,65279],[65529,65531]],XL=[[66045,66045],[66272,66272],[66422,66426],[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[68325,68326],[68900,68903],[69446,69456],[69633,69633],[69688,69702],[69759,69761],[69811,69814],[69817,69818],[69821,69821],[69837,69837],[69888,69890],[69927,69931],[69933,69940],[70003,70003],[70016,70017],[70070,70078],[70089,70092],[70191,70193],[70196,70196],[70198,70199],[70206,70206],[70367,70367],[70371,70378],[70400,70401],[70459,70460],[70464,70464],[70502,70508],[70512,70516],[70712,70719],[70722,70724],[70726,70726],[70750,70750],[70835,70840],[70842,70842],[70847,70848],[70850,70851],[71090,71093],[71100,71101],[71103,71104],[71132,71133],[71219,71226],[71229,71229],[71231,71232],[71339,71339],[71341,71341],[71344,71349],[71351,71351],[71453,71455],[71458,71461],[71463,71467],[71727,71735],[71737,71738],[72148,72151],[72154,72155],[72160,72160],[72193,72202],[72243,72248],[72251,72254],[72263,72263],[72273,72278],[72281,72283],[72330,72342],[72344,72345],[72752,72758],[72760,72765],[72767,72767],[72850,72871],[72874,72880],[72882,72883],[72885,72886],[73009,73014],[73018,73018],[73020,73021],[73023,73029],[73031,73031],[73104,73105],[73109,73109],[73111,73111],[73459,73460],[78896,78904],[92912,92916],[92976,92982],[94031,94031],[94095,94098],[113821,113822],[113824,113827],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[121344,121398],[121403,121452],[121461,121461],[121476,121476],[121499,121503],[121505,121519],[122880,122886],[122888,122904],[122907,122913],[122915,122916],[122918,122922],[123184,123190],[123628,123631],[125136,125142],[125252,125258],[917505,917505],[917536,917631],[917760,917999]],Dd=[[4352,4447],[8986,8987],[9001,9002],[9193,9196],[9200,9200],[9203,9203],[9725,9726],[9748,9749],[9800,9811],[9855,9855],[9875,9875],[9889,9889],[9898,9899],[9917,9918],[9924,9925],[9934,9934],[9940,9940],[9962,9962],[9970,9971],[9973,9973],[9978,9978],[9981,9981],[9989,9989],[9994,9995],[10024,10024],[10060,10060],[10062,10062],[10067,10069],[10071,10071],[10133,10135],[10160,10160],[10175,10175],[11035,11036],[11088,11088],[11093,11093],[11904,11929],[11931,12019],[12032,12245],[12272,12283],[12288,12329],[12334,12350],[12353,12438],[12443,12543],[12549,12591],[12593,12686],[12688,12730],[12736,12771],[12784,12830],[12832,12871],[12880,19903],[19968,42124],[42128,42182],[43360,43388],[44032,55203],[63744,64255],[65040,65049],[65072,65106],[65108,65126],[65128,65131],[65281,65376],[65504,65510]],UL=[[94176,94179],[94208,100343],[100352,101106],[110592,110878],[110928,110930],[110948,110951],[110960,111355],[126980,126980],[127183,127183],[127374,127374],[127377,127386],[127488,127490],[127504,127547],[127552,127560],[127568,127569],[127584,127589],[127744,127776],[127789,127797],[127799,127868],[127870,127891],[127904,127946],[127951,127955],[127968,127984],[127988,127988],[127992,128062],[128064,128064],[128066,128252],[128255,128317],[128331,128334],[128336,128359],[128378,128378],[128405,128406],[128420,128420],[128507,128591],[128640,128709],[128716,128716],[128720,128722],[128725,128725],[128747,128748],[128756,128762],[128992,129003],[129293,129393],[129395,129398],[129402,129442],[129445,129450],[129454,129482],[129485,129535],[129648,129651],[129656,129658],[129664,129666],[129680,129685],[131072,196605],[196608,262141]],$i;function Ry(e,t){let i=0,r=t.length-1,s;if(e<t[0][0]||e>t[r][1])return!1;for(;r>=i;)if(s=i+r>>1,e>t[s][1])i=s+1;else if(e<t[s][0])r=s-1;else return!0;return!1}var zL=class{constructor(){if(this.version="11",!$i){$i=new Uint8Array(65536),$i.fill(1),$i[0]=0,$i.fill(0,1,32),$i.fill(0,127,160);for(let e=0;e<Ld.length;++e)$i.fill(0,Ld[e][0],Ld[e][1]+1);for(let e=0;e<Dd.length;++e)$i.fill(2,Dd[e][0],Dd[e][1]+1)}}wcwidth(e){return e<32?0:e<127?1:e<65536?$i[e]:Ry(e,XL)?0:Ry(e,UL)?2:1}charProperties(e,t){let i=this.wcwidth(e),r=i===0&&t!==0;if(r){let s=Ll.extractWidth(t);s===0?r=!1:s>i&&(i=s)}return Ll.createPropertyValue(0,i,r)}},Gy=class{activate(e){e.unicode.register(new zL)}dispose(){}};var jy=class{constructor(e,t){this._disposables=[],this._socket=e,this._socket.binaryType="arraybuffer",this._bidirectional=!(t&&t.bidirectional===!1)}activate(e){this._disposables.push(Xd(this._socket,"message",t=>{let i=t.data;e.write(typeof i=="string"?i:new Uint8Array(i))})),this._bidirectional&&(this._disposables.push(e.onData(t=>this._sendData(t))),this._disposables.push(e.onBinary(t=>this._sendBinary(t)))),this._disposables.push(Xd(this._socket,"close",()=>this.dispose())),this._disposables.push(Xd(this._socket,"error",()=>this.dispose()))}dispose(){for(let e of this._disposables)e.dispose()}_sendData(e){this._checkOpenSocket()&&this._socket.send(e)}_sendBinary(e){if(!this._checkOpenSocket())return;let t=new Uint8Array(e.length);for(let i=0;i<e.length;++i)t[i]=e.charCodeAt(i)&255;this._socket.send(t)}_checkOpenSocket(){switch(this._socket.readyState){case WebSocket.OPEN:return!0;case WebSocket.CONNECTING:throw new Error("Attach addon was loaded before socket was open");case WebSocket.CLOSING:return console.warn("Attach addon socket is closing"),!1;case WebSocket.CLOSED:throw new Error("Attach addon socket is closed");default:throw new Error("Unexpected socket state")}}};function Xd(e,t,i){return e.addEventListener(t,i),{dispose:()=>{i&&e.removeEventListener(t,i)}}}var WL=class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(e){setTimeout(()=>{throw e.stack?qy.isErrorNoTelemetry(e)?new qy(e.message+`

`+e.stack):new Error(e.message+`

`+e.stack):e},0)}}addListener(e){return this.listeners.push(e),()=>{this._removeListener(e)}}emit(e){this.listeners.forEach(t=>{t(e)})}_removeListener(e){this.listeners.splice(this.listeners.indexOf(e),1)}setUnexpectedErrorHandler(e){this.unexpectedErrorHandler=e}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(e){this.unexpectedErrorHandler(e),this.emit(e)}onUnexpectedExternalError(e){this.unexpectedErrorHandler(e)}},$L=new WL;function Ud(e){GL(e)||$L.onUnexpectedError(e)}var $d="Canceled";function GL(e){return e instanceof jL?!0:e instanceof Error&&e.name===$d&&e.message===$d}var jL=class extends Error{constructor(){super($d),this.name=this.message}},qy=class Gd extends Error{constructor(t){super(t),this.name="CodeExpectedError"}static fromError(t){if(t instanceof Gd)return t;let i=new Gd;return i.message=t.message,i.stack=t.stack,i}static isErrorNoTelemetry(t){return t.name==="CodeExpectedError"}};function qL(e,t,i=0,r=e.length){let s=i,n=r;for(;s<n;){let o=Math.floor((s+n)/2);t(e[o])?s=o+1:n=o}return s-1}var VL=class sb{constructor(t){this._array=t,this._findLastMonotonousLastIdx=0}findLastMonotonous(t){if(sb.assertInvariants){if(this._prevFindLastPredicate){for(let r of this._array)if(this._prevFindLastPredicate(r)&&!t(r))throw new Error("MonotonousArray: current predicate must be weaker than (or equal to) the previous predicate.")}this._prevFindLastPredicate=t}let i=qL(this._array,t,this._findLastMonotonousLastIdx);return this._findLastMonotonousLastIdx=i+1,i===-1?void 0:this._array[i]}};VL.assertInvariants=!1;var nb;(e=>{function t(n){return n<0}e.isLessThan=t;function i(n){return n<=0}e.isLessThanOrEqual=i;function r(n){return n>0}e.isGreaterThan=r;function s(n){return n===0}e.isNeitherLessOrGreaterThan=s,e.greaterThan=1,e.lessThan=-1,e.neitherLessOrGreaterThan=0})(nb||={});function YL(e,t){return(i,r)=>t(e(i),e(r))}var JL=(e,t)=>e-t,Vy=class jd{constructor(t){this.iterate=t}forEach(t){this.iterate(i=>(t(i),!0))}toArray(){let t=[];return this.iterate(i=>(t.push(i),!0)),t}filter(t){return new jd(i=>this.iterate(r=>t(r)?i(r):!0))}map(t){return new jd(i=>this.iterate(r=>i(t(r))))}some(t){let i=!1;return this.iterate(r=>(i=t(r),!i)),i}findFirst(t){let i;return this.iterate(r=>t(r)?(i=r,!1):!0),i}findLast(t){let i;return this.iterate(r=>(t(r)&&(i=r),!0)),i}findLastMaxBy(t){let i,r=!0;return this.iterate(s=>((r||nb.isGreaterThan(t(s,i)))&&(r=!1,i=s),!0)),i}};Vy.empty=new Vy(e=>{});function ZL(e,t){let i=Object.create(null);for(let r of e){let s=t(r),n=i[s];n||(n=i[s]=[]),n.push(r)}return i}var Yy,Jy,VF=class{constructor(e,t){this.toKey=t,this._map=new Map,this[Yy]="SetWithKey";for(let i of e)this.add(i)}get size(){return this._map.size}add(e){let t=this.toKey(e);return this._map.set(t,e),this}delete(e){return this._map.delete(this.toKey(e))}has(e){return this._map.has(this.toKey(e))}*entries(){for(let e of this._map.values())yield[e,e]}keys(){return this.values()}*values(){for(let e of this._map.values())yield e}clear(){this._map.clear()}forEach(e,t){this._map.forEach(i=>e.call(t,i,i,this))}[(Jy=Symbol.iterator,Yy=Symbol.toStringTag,Jy)](){return this.values()}},e8=class{constructor(){this.map=new Map}add(e,t){let i=this.map.get(e);i||(i=new Set,this.map.set(e,i)),i.add(t)}delete(e,t){let i=this.map.get(e);i&&(i.delete(t),i.size===0&&this.map.delete(e))}forEach(e,t){let i=this.map.get(e);i&&i.forEach(t)}get(e){return this.map.get(e)||new Set}};function t8(e,t){let i=this,r=!1,s;return function(){if(r)return s;if(r=!0,t)try{s=e.apply(i,arguments)}finally{t()}else s=e.apply(i,arguments);return s}}var ob;(e=>{function t(b){return b&&typeof b=="object"&&typeof b[Symbol.iterator]=="function"}e.is=t;let i=Object.freeze([]);function r(){return i}e.empty=r;function*s(b){yield b}e.single=s;function n(b){return t(b)?b:s(b)}e.wrap=n;function o(b){return b||i}e.from=o;function*a(b){for(let L=b.length-1;L>=0;L--)yield b[L]}e.reverse=a;function h(b){return!b||b[Symbol.iterator]().next().done===!0}e.isEmpty=h;function l(b){return b[Symbol.iterator]().next().value}e.first=l;function c(b,L){let I=0;for(let R of b)if(L(R,I++))return!0;return!1}e.some=c;function u(b,L){for(let I of b)if(L(I))return I}e.find=u;function*g(b,L){for(let I of b)L(I)&&(yield I)}e.filter=g;function*_(b,L){let I=0;for(let R of b)yield L(R,I++)}e.map=_;function*m(b,L){let I=0;for(let R of b)yield*L(R,I++)}e.flatMap=m;function*v(...b){for(let L of b)yield*L}e.concat=v;function x(b,L,I){let R=I;for(let G of b)R=L(R,G);return R}e.reduce=x;function*E(b,L,I=b.length){for(L<0&&(L+=b.length),I<0?I+=b.length:I>b.length&&(I=b.length);L<I;L++)yield b[L]}e.slice=E;function M(b,L=Number.POSITIVE_INFINITY){let I=[];if(L===0)return[I,b];let R=b[Symbol.iterator]();for(let G=0;G<L;G++){let W=R.next();if(W.done)return[I,e.empty()];I.push(W.value)}return[I,{[Symbol.iterator](){return R}}]}e.consume=M;async function D(b){let L=[];for await(let I of b)L.push(I);return Promise.resolve(L)}e.asyncToArray=D})(ob||={});var i8=!1,Os=null,r8=class ab{constructor(){this.livingDisposables=new Map}getDisposableData(t){let i=this.livingDisposables.get(t);return i||(i={parent:null,source:null,isSingleton:!1,value:t,idx:ab.idx++},this.livingDisposables.set(t,i)),i}trackDisposable(t){let i=this.getDisposableData(t);i.source||(i.source=new Error().stack)}setParent(t,i){let r=this.getDisposableData(t);r.parent=i}markAsDisposed(t){this.livingDisposables.delete(t)}markAsSingleton(t){this.getDisposableData(t).isSingleton=!0}getRootParent(t,i){let r=i.get(t);if(r)return r;let s=t.parent?this.getRootParent(this.getDisposableData(t.parent),i):t;return i.set(t,s),s}getTrackedDisposables(){let t=new Map;return[...this.livingDisposables.entries()].filter(([,i])=>i.source!==null&&!this.getRootParent(i,t).isSingleton).flatMap(([i])=>i)}computeLeakingDisposables(t=10,i){let r;if(i)r=i;else{let h=new Map,l=[...this.livingDisposables.values()].filter(u=>u.source!==null&&!this.getRootParent(u,h).isSingleton);if(l.length===0)return;let c=new Set(l.map(u=>u.value));if(r=l.filter(u=>!(u.parent&&c.has(u.parent))),r.length===0)throw new Error("There are cyclic diposable chains!")}if(!r)return;function s(h){function l(u,g){for(;u.length>0&&g.some(_=>typeof _=="string"?_===u[0]:u[0].match(_));)u.shift()}let c=h.source.split(`
`).map(u=>u.trim().replace("at ","")).filter(u=>u!=="");return l(c,["Error",/^trackDisposable \(.*\)$/,/^DisposableTracker.trackDisposable \(.*\)$/]),c.reverse()}let n=new e8;for(let h of r){let l=s(h);for(let c=0;c<=l.length;c++)n.add(l.slice(0,c).join(`
`),h)}r.sort(YL(h=>h.idx,JL));let o="",a=0;for(let h of r.slice(0,t)){a++;let l=s(h),c=[];for(let u=0;u<l.length;u++){let g=l[u];g=`(shared with ${n.get(l.slice(0,u+1).join(`
`)).size}/${r.length} leaks) at ${g}`;let _=n.get(l.slice(0,u).join(`
`)),m=ZL([..._].map(v=>s(v)[u]),v=>v);delete m[l[u]];for(let[v,x]of Object.entries(m))c.unshift(`    - stacktraces of ${x.length} other leaks continue with ${v}`);c.unshift(g)}o+=`


==================== Leaking disposable ${a}/${r.length}: ${h.value.constructor.name} ====================
${c.join(`
`)}
============================================================

`}return r.length>t&&(o+=`


... and ${r.length-t} more leaking disposables

`),{leaks:r,details:o}}};r8.idx=0;function s8(e){Os=e}if(i8){let e="__is_disposable_tracked__";s8(new class{trackDisposable(t){let i=new Error("Potentially leaked disposable").stack;setTimeout(()=>{t[e]||console.log(i)},3e3)}setParent(t,i){if(t&&t!==Ai.None)try{t[e]=!0}catch{}}markAsDisposed(t){if(t&&t!==Ai.None)try{t[e]=!0}catch{}}markAsSingleton(t){}})}function Pl(e){return Os?.trackDisposable(e),e}function Ol(e){Os?.markAsDisposed(e)}function lo(e,t){Os?.setParent(e,t)}function n8(e,t){if(Os)for(let i of e)Os.setParent(i,t)}function ao(e){if(ob.is(e)){let t=[];for(let i of e)if(i)try{i.dispose()}catch(r){t.push(r)}if(t.length===1)throw t[0];if(t.length>1)throw new AggregateError(t,"Encountered errors while disposing of store");return Array.isArray(e)?[]:e}else if(e)return e.dispose(),e}function lb(...e){let t=Ks(()=>ao(e));return n8(e,t),t}function Ks(e){let t=Pl({dispose:t8(()=>{Ol(t),e()})});return t}var hb=class cb{constructor(){this._toDispose=new Set,this._isDisposed=!1,Pl(this)}dispose(){this._isDisposed||(Ol(this),this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{ao(this._toDispose)}finally{this._toDispose.clear()}}add(t){if(!t)return t;if(t===this)throw new Error("Cannot register a disposable on itself!");return lo(t,this),this._isDisposed?cb.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(t),t}delete(t){if(t){if(t===this)throw new Error("Cannot dispose a disposable on itself!");this._toDispose.delete(t),t.dispose()}}deleteAndLeak(t){t&&this._toDispose.has(t)&&(this._toDispose.delete(t),lo(t,null))}};hb.DISABLE_DISPOSED_WARNING=!1;var tf=hb,Ai=class{constructor(){this._store=new tf,Pl(this),lo(this._store,this)}dispose(){Ol(this),this._store.dispose()}_register(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}};Ai.None=Object.freeze({dispose(){}});var Fl=class{constructor(){this._isDisposed=!1,Pl(this)}get value(){return this._isDisposed?void 0:this._value}set value(e){this._isDisposed||e===this._value||(this._value?.dispose(),e&&lo(e,this),this._value=e)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,Ol(this),this._value?.dispose(),this._value=void 0}clearAndLeak(){let e=this._value;return this._value=void 0,e&&lo(e,null),e}},Zy=class qd{constructor(t){this.element=t,this.next=qd.Undefined,this.prev=qd.Undefined}};Zy.Undefined=new Zy(void 0);var o8=globalThis.performance&&typeof globalThis.performance.now=="function",a8=class ub{static create(t){return new ub(t)}constructor(t){this._now=o8&&t===!1?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}},l8=!1,eb=!1,h8=!1,rf;(e=>{e.None=()=>Ai.None;function t(C){if(h8){let{onDidAddListener:w}=C,k=Jd.create(),f=0;C.onDidAddListener=()=>{++f===2&&(console.warn("snapshotted emitter LIKELY used public and SHOULD HAVE BEEN created with DisposableStore. snapshotted here"),k.print()),w?.()}}}function i(C,w){return g(C,()=>{},0,void 0,!0,void 0,w)}e.defer=i;function r(C){return(w,k=null,f)=>{let d=!1,p;return p=C(y=>{if(!d)return p?p.dispose():d=!0,w.call(k,y)},null,f),d&&p.dispose(),p}}e.once=r;function s(C,w,k){return c((f,d=null,p)=>C(y=>f.call(d,w(y)),null,p),k)}e.map=s;function n(C,w,k){return c((f,d=null,p)=>C(y=>{w(y),f.call(d,y)},null,p),k)}e.forEach=n;function o(C,w,k){return c((f,d=null,p)=>C(y=>w(y)&&f.call(d,y),null,p),k)}e.filter=o;function a(C){return C}e.signal=a;function h(...C){return(w,k=null,f)=>{let d=lb(...C.map(p=>p(y=>w.call(k,y))));return u(d,f)}}e.any=h;function l(C,w,k,f){let d=k;return s(C,p=>(d=w(d,p),d),f)}e.reduce=l;function c(C,w){let k,f={onWillAddFirstListener(){k=C(d.fire,d)},onDidRemoveLastListener(){k?.dispose()}};w||t(f);let d=new wi(f);return w?.add(d),d.event}function u(C,w){return w instanceof Array?w.push(C):w&&w.add(C),C}function g(C,w,k=100,f=!1,d=!1,p,y){let A,S,F,U=0,$,z={leakWarningThreshold:p,onWillAddFirstListener(){A=C(ee=>{U++,S=w(S,ee),f&&!F&&(J.fire(S),S=void 0),$=()=>{let de=S;S=void 0,F=void 0,(!f||U>1)&&J.fire(de),U=0},typeof k=="number"?(clearTimeout(F),F=setTimeout($,k)):F===void 0&&(F=0,queueMicrotask($))})},onWillRemoveListener(){d&&U>0&&$?.()},onDidRemoveLastListener(){$=void 0,A.dispose()}};y||t(z);let J=new wi(z);return y?.add(J),J.event}e.debounce=g;function _(C,w=0,k){return e.debounce(C,(f,d)=>f?(f.push(d),f):[d],w,void 0,!0,void 0,k)}e.accumulate=_;function m(C,w=(f,d)=>f===d,k){let f=!0,d;return o(C,p=>{let y=f||!w(p,d);return f=!1,d=p,y},k)}e.latch=m;function v(C,w,k){return[e.filter(C,w,k),e.filter(C,f=>!w(f),k)]}e.split=v;function x(C,w=!1,k=[],f){let d=k.slice(),p=C(S=>{d?d.push(S):A.fire(S)});f&&f.add(p);let y=()=>{d?.forEach(S=>A.fire(S)),d=null},A=new wi({onWillAddFirstListener(){p||(p=C(S=>A.fire(S)),f&&f.add(p))},onDidAddFirstListener(){d&&(w?setTimeout(y):y())},onDidRemoveLastListener(){p&&p.dispose(),p=null}});return f&&f.add(A),A.event}e.buffer=x;function E(C,w){return(k,f,d)=>{let p=w(new D);return C(function(y){let A=p.evaluate(y);A!==M&&k.call(f,A)},void 0,d)}}e.chain=E;let M=Symbol("HaltChainable");class D{constructor(){this.steps=[]}map(w){return this.steps.push(w),this}forEach(w){return this.steps.push(k=>(w(k),k)),this}filter(w){return this.steps.push(k=>w(k)?k:M),this}reduce(w,k){let f=k;return this.steps.push(d=>(f=w(f,d),f)),this}latch(w=(k,f)=>k===f){let k=!0,f;return this.steps.push(d=>{let p=k||!w(d,f);return k=!1,f=d,p?d:M}),this}evaluate(w){for(let k of this.steps)if(w=k(w),w===M)break;return w}}function b(C,w,k=f=>f){let f=(...A)=>y.fire(k(...A)),d=()=>C.on(w,f),p=()=>C.removeListener(w,f),y=new wi({onWillAddFirstListener:d,onDidRemoveLastListener:p});return y.event}e.fromNodeEventEmitter=b;function L(C,w,k=f=>f){let f=(...A)=>y.fire(k(...A)),d=()=>C.addEventListener(w,f),p=()=>C.removeEventListener(w,f),y=new wi({onWillAddFirstListener:d,onDidRemoveLastListener:p});return y.event}e.fromDOMEventEmitter=L;function I(C){return new Promise(w=>r(C)(w))}e.toPromise=I;function R(C){let w=new wi;return C.then(k=>{w.fire(k)},()=>{w.fire(void 0)}).finally(()=>{w.dispose()}),w.event}e.fromPromise=R;function G(C,w){return C(k=>w.fire(k))}e.forward=G;function W(C,w,k){return w(k),C(f=>w(f))}e.runAndSubscribe=W;class V{constructor(w,k){this._observable=w,this._counter=0,this._hasChanged=!1;let f={onWillAddFirstListener:()=>{w.addObserver(this)},onDidRemoveLastListener:()=>{w.removeObserver(this)}};k||t(f),this.emitter=new wi(f),k&&k.add(this.emitter)}beginUpdate(w){this._counter++}handlePossibleChange(w){}handleChange(w,k){this._hasChanged=!0}endUpdate(w){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}function q(C,w){return new V(C,w).emitter.event}e.fromObservable=q;function ne(C){return(w,k,f)=>{let d=0,p=!1,y={beginUpdate(){d++},endUpdate(){d--,d===0&&(C.reportChanges(),p&&(p=!1,w.call(k)))},handlePossibleChange(){},handleChange(){p=!0}};C.addObserver(y),C.reportChanges();let A={dispose(){C.removeObserver(y)}};return f instanceof tf?f.add(A):Array.isArray(f)&&f.push(A),A}}e.fromObservableLight=ne})(rf||={});var Vd=class Yd{constructor(t){this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name=`${t}_${Yd._idPool++}`,Yd.all.add(this)}start(t){this._stopWatch=new a8,this.listenerCount=t}stop(){if(this._stopWatch){let t=this._stopWatch.elapsed();this.durations.push(t),this.elapsedOverall+=t,this.invocationCount+=1,this._stopWatch=void 0}}};Vd.all=new Set,Vd._idPool=0;var c8=Vd,tb=-1,db=class fb{constructor(t,i,r=(fb._idPool++).toString(16).padStart(3,"0")){this._errorHandler=t,this.threshold=i,this.name=r,this._warnCountdown=0}dispose(){this._stacks?.clear()}check(t,i){let r=this.threshold;if(r<=0||i<r)return;this._stacks||(this._stacks=new Map);let s=this._stacks.get(t.value)||0;if(this._stacks.set(t.value,s+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=r*.5;let[n,o]=this.getMostFrequentStack(),a=`[${this.name}] potential listener LEAK detected, having ${i} listeners already. MOST frequent listener (${o}):`;console.warn(a),console.warn(n);let h=new d8(a,n);this._errorHandler(h)}return()=>{let n=this._stacks.get(t.value)||0;this._stacks.set(t.value,n-1)}}getMostFrequentStack(){if(!this._stacks)return;let t,i=0;for(let[r,s]of this._stacks)(!t||i<s)&&(t=[r,s],i=s);return t}};db._idPool=1;var u8=db,Jd=class _b{constructor(t){this.value=t}static create(){let t=new Error;return new _b(t.stack??"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},d8=class extends Error{constructor(e,t){super(e),this.name="ListenerLeakError",this.stack=t}},f8=class extends Error{constructor(e,t){super(e),this.name="ListenerRefusalError",this.stack=t}},_8=0,Il=class{constructor(e){this.value=e,this.id=_8++}},p8=2,g8=(e,t)=>{if(e instanceof Il)t(e);else for(let i=0;i<e.length;i++){let r=e[i];r&&t(r)}},Ml;if(l8){let e=[];setInterval(()=>{e.length!==0&&(console.warn("[LEAKING LISTENERS] GC'ed these listeners that were NOT yet disposed:"),console.warn(e.join(`
`)),e.length=0)},3e3),Ml=new FinalizationRegistry(t=>{typeof t=="string"&&e.push(t)})}var wi=class{constructor(e){this._size=0,this._options=e,this._leakageMon=tb>0||this._options?.leakWarningThreshold?new u8(e?.onListenerError??Ud,this._options?.leakWarningThreshold??tb):void 0,this._perfMon=this._options?._profName?new c8(this._options._profName):void 0,this._deliveryQueue=this._options?.deliveryQueue}dispose(){if(!this._disposed){if(this._disposed=!0,this._deliveryQueue?.current===this&&this._deliveryQueue.reset(),this._listeners){if(eb){let e=this._listeners;queueMicrotask(()=>{g8(e,t=>t.stack?.print())})}this._listeners=void 0,this._size=0}this._options?.onDidRemoveLastListener?.(),this._leakageMon?.dispose()}}get event(){return this._event??=(e,t,i)=>{if(this._leakageMon&&this._size>this._leakageMon.threshold**2){let a=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(a);let h=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],l=new f8(`${a}. HINT: Stack shows most frequent listener (${h[1]}-times)`,h[0]);return(this._options?.onListenerError||Ud)(l),Ai.None}if(this._disposed)return Ai.None;t&&(e=e.bind(t));let r=new Il(e),s,n;this._leakageMon&&this._size>=Math.ceil(this._leakageMon.threshold*.2)&&(r.stack=Jd.create(),s=this._leakageMon.check(r.stack,this._size+1)),eb&&(r.stack=n??Jd.create()),this._listeners?this._listeners instanceof Il?(this._deliveryQueue??=new m8,this._listeners=[this._listeners,r]):this._listeners.push(r):(this._options?.onWillAddFirstListener?.(this),this._listeners=r,this._options?.onDidAddFirstListener?.(this)),this._size++;let o=Ks(()=>{Ml?.unregister(o),s?.(),this._removeListener(r)});if(i instanceof tf?i.add(o):Array.isArray(i)&&i.push(o),Ml){let a=new Error().stack.split(`
`).slice(2,3).join(`
`).trim(),h=/(file:|vscode-file:\/\/vscode-app)?(\/[^:]*:\d+:\d+)/.exec(a);Ml.register(o,h?.[2]??a,o)}return o},this._event}_removeListener(e){if(this._options?.onWillRemoveListener?.(this),!this._listeners)return;if(this._size===1){this._listeners=void 0,this._options?.onDidRemoveLastListener?.(this),this._size=0;return}let t=this._listeners,i=t.indexOf(e);if(i===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),new Error("Attempted to dispose unknown listener");this._size--,t[i]=void 0;let r=this._deliveryQueue.current===this;if(this._size*p8<=t.length){let s=0;for(let n=0;n<t.length;n++)t[n]?t[s++]=t[n]:r&&(this._deliveryQueue.end--,s<this._deliveryQueue.i&&this._deliveryQueue.i--);t.length=s}}_deliver(e,t){if(!e)return;let i=this._options?.onListenerError||Ud;if(!i){e.value(t);return}try{e.value(t)}catch(r){i(r)}}_deliverQueue(e){let t=e.current._listeners;for(;e.i<e.end;)this._deliver(t[e.i++],e.value);e.reset()}fire(e){if(this._deliveryQueue?.current&&(this._deliverQueue(this._deliveryQueue),this._perfMon?.stop()),this._perfMon?.start(this._size),this._listeners)if(this._listeners instanceof Il)this._deliver(this._listeners,e);else{let t=this._deliveryQueue;t.enqueue(this,e,this._listeners.length),this._deliverQueue(t)}this._perfMon?.stop()}hasListeners(){return this._size>0}},m8=class{constructor(){this.i=-1,this.end=0}enqueue(e,t,i){this.i=0,this.end=i,this.current=e,this.value=t}reset(){this.i=this.end,this.current=void 0,this.value=void 0}},pb=Object.freeze(function(e,t){let i=setTimeout(e.bind(t),0);return{dispose(){clearTimeout(i)}}}),v8;(e=>{function t(i){return i===e.None||i===e.Cancelled||i instanceof y8?!0:!i||typeof i!="object"?!1:typeof i.isCancellationRequested=="boolean"&&typeof i.onCancellationRequested=="function"}e.isCancellationToken=t,e.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:rf.None}),e.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:pb})})(v8||={});var y8=class{constructor(){this._isCancelled=!1,this._emitter=null}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?pb:(this._emitter||(this._emitter=new wi),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}},Ps="en",Zd=!1,ef=!1,Tl=!1,b8=!1,w8=!1,gb=!1,A8=!1,x8=!1,S8=!1,C8=!1,Dl,Rl=Ps,ib=Ps,k8,Gi,ji=globalThis,Pt;typeof ji.vscode<"u"&&typeof ji.vscode.process<"u"?Pt=ji.vscode.process:typeof process<"u"&&typeof process?.versions?.node=="string"&&(Pt=process);var mb=typeof Pt?.versions?.electron=="string",E8=mb&&Pt?.type==="renderer";if(typeof Pt=="object"){Zd=Pt.platform==="win32",ef=Pt.platform==="darwin",Tl=Pt.platform==="linux",b8=Tl&&!!Pt.env.SNAP&&!!Pt.env.SNAP_REVISION,A8=mb,S8=!!Pt.env.CI||!!Pt.env.BUILD_ARTIFACTSTAGINGDIRECTORY,Dl=Ps,Rl=Ps;let e=Pt.env.VSCODE_NLS_CONFIG;if(e)try{let t=JSON.parse(e);Dl=t.userLocale,ib=t.osLocale,Rl=t.resolvedLanguage||Ps,k8=t.languagePack?.translationsConfigFile}catch{}w8=!0}else typeof navigator=="object"&&!E8?(Gi=navigator.userAgent,Zd=Gi.indexOf("Windows")>=0,ef=Gi.indexOf("Macintosh")>=0,x8=(Gi.indexOf("Macintosh")>=0||Gi.indexOf("iPad")>=0||Gi.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,Tl=Gi.indexOf("Linux")>=0,C8=Gi?.indexOf("Mobi")>=0,gb=!0,Rl=globalThis._VSCODE_NLS_LANGUAGE||Ps,Dl=navigator.language.toLowerCase(),ib=Dl):console.error("Unable to resolve platform.");var zd=0;ef?zd=1:Zd?zd=3:Tl&&(zd=2);var B8=gb&&typeof ji.importScripts=="function",YF=B8?ji.origin:void 0,xi=Gi,kr=Rl,L8;(e=>{function t(){return kr}e.value=t;function i(){return kr.length===2?kr==="en":kr.length>=3?kr[0]==="e"&&kr[1]==="n"&&kr[2]==="-":!1}e.isDefaultVariant=i;function r(){return kr==="en"}e.isDefault=r})(L8||={});var D8=typeof ji.postMessage=="function"&&!ji.importScripts,I8=(()=>{if(D8){let e=[];ji.addEventListener("message",i=>{if(i.data&&i.data.vscodeScheduleAsyncWork)for(let r=0,s=e.length;r<s;r++){let n=e[r];if(n.id===i.data.vscodeScheduleAsyncWork){e.splice(r,1),n.callback();return}}});let t=0;return i=>{let r=++t;e.push({id:r,callback:i}),ji.postMessage({vscodeScheduleAsyncWork:r},"*")}}return e=>setTimeout(e)})(),M8=!!(xi&&xi.indexOf("Chrome")>=0),JF=!!(xi&&xi.indexOf("Firefox")>=0),ZF=!!(!M8&&xi&&xi.indexOf("Safari")>=0),eP=!!(xi&&xi.indexOf("Edg/")>=0),tP=!!(xi&&xi.indexOf("Android")>=0),iP=Symbol("MicrotaskDelay");function vb(e,t=0,i){let r=setTimeout(()=>{e(),i&&s.dispose()},t),s=Ks(()=>{clearTimeout(r),i?.deleteAndLeak(s)});return i?.add(s),s}var T8,Wd;(function(){typeof globalThis.requestIdleCallback!="function"||typeof globalThis.cancelIdleCallback!="function"?Wd=(e,t)=>{I8(()=>{if(i)return;let r=Date.now()+15;t(Object.freeze({didTimeout:!0,timeRemaining(){return Math.max(0,r-Date.now())}}))});let i=!1;return{dispose(){i||(i=!0)}}}:Wd=(e,t,i)=>{let r=e.requestIdleCallback(t,typeof i=="number"?{timeout:i}:void 0),s=!1;return{dispose(){s||(s=!0,e.cancelIdleCallback(r))}}},T8=e=>Wd(globalThis,e)})();var R8;(e=>{async function t(r){let s,n=await Promise.all(r.map(o=>o.then(a=>a,a=>{s||(s=a)})));if(typeof s<"u")throw s;return n}e.settled=t;function i(r){return new Promise(async(s,n)=>{try{await r(s,n)}catch(o){n(o)}})}e.withAsyncBody=i})(R8||={});var rb=class Vt{static fromArray(t){return new Vt(i=>{i.emitMany(t)})}static fromPromise(t){return new Vt(async i=>{i.emitMany(await t)})}static fromPromises(t){return new Vt(async i=>{await Promise.all(t.map(async r=>i.emitOne(await r)))})}static merge(t){return new Vt(async i=>{await Promise.all(t.map(async r=>{for await(let s of r)i.emitOne(s)}))})}constructor(t,i){this._state=0,this._results=[],this._error=null,this._onReturn=i,this._onStateChanged=new wi,queueMicrotask(async()=>{let r={emitOne:s=>this.emitOne(s),emitMany:s=>this.emitMany(s),reject:s=>this.reject(s)};try{await Promise.resolve(t(r)),this.resolve()}catch(s){this.reject(s)}finally{r.emitOne=void 0,r.emitMany=void 0,r.reject=void 0}})}[Symbol.asyncIterator](){let t=0;return{next:async()=>{do{if(this._state===2)throw this._error;if(t<this._results.length)return{done:!1,value:this._results[t++]};if(this._state===1)return{done:!0,value:void 0};await rf.toPromise(this._onStateChanged.event)}while(!0)},return:async()=>(this._onReturn?.(),{done:!0,value:void 0})}}static map(t,i){return new Vt(async r=>{for await(let s of t)r.emitOne(i(s))})}map(t){return Vt.map(this,t)}static filter(t,i){return new Vt(async r=>{for await(let s of t)i(s)&&r.emitOne(s)})}filter(t){return Vt.filter(this,t)}static coalesce(t){return Vt.filter(t,i=>!!i)}coalesce(){return Vt.coalesce(this)}static async toPromise(t){let i=[];for await(let r of t)i.push(r);return i}toPromise(){return Vt.toPromise(this)}emitOne(t){this._state===0&&(this._results.push(t),this._onStateChanged.fire())}emitMany(t){this._state===0&&(this._results=this._results.concat(t),this._onStateChanged.fire())}resolve(){this._state===0&&(this._state=1,this._onStateChanged.fire())}reject(t){this._state===0&&(this._state=2,this._error=t,this._onStateChanged.fire())}};rb.EMPTY=rb.fromArray([]);var F8=class extends Ai{constructor(e){super(),this._terminal=e,this._linesCacheTimeout=this._register(new Fl),this._linesCacheDisposables=this._register(new Fl),this._register(Ks(()=>this._destroyLinesCache()))}initLinesCache(){this._linesCache||(this._linesCache=new Array(this._terminal.buffer.active.length),this._linesCacheDisposables.value=lb(this._terminal.onLineFeed(()=>this._destroyLinesCache()),this._terminal.onCursorMove(()=>this._destroyLinesCache()),this._terminal.onResize(()=>this._destroyLinesCache()))),this._linesCacheTimeout.value=vb(()=>this._destroyLinesCache(),15e3)}_destroyLinesCache(){this._linesCache=void 0,this._linesCacheDisposables.clear(),this._linesCacheTimeout.clear()}getLineFromCache(e){return this._linesCache?.[e]}setLineInCache(e,t){this._linesCache&&(this._linesCache[e]=t)}translateBufferLineToStringWithWrap(e,t){let i=[],r=[0],s=this._terminal.buffer.active.getLine(e);for(;s;){let n=this._terminal.buffer.active.getLine(e+1),o=n?n.isWrapped:!1,a=s.translateToString(!o&&t);if(o&&n){let h=s.getCell(s.length-1);h&&h.getCode()===0&&h.getWidth()===1&&n.getCell(0)?.getWidth()===2&&(a=a.slice(0,-1))}if(i.push(a),o)r.push(r[r.length-1]+a.length);else break;e++,s=n}return[i.join(""),r]}},P8=class{get cachedSearchTerm(){return this._cachedSearchTerm}set cachedSearchTerm(e){this._cachedSearchTerm=e}get lastSearchOptions(){return this._lastSearchOptions}set lastSearchOptions(e){this._lastSearchOptions=e}isValidSearchTerm(e){return!!(e&&e.length>0)}didOptionsChange(e){return this._lastSearchOptions?e?this._lastSearchOptions.caseSensitive!==e.caseSensitive||this._lastSearchOptions.regex!==e.regex||this._lastSearchOptions.wholeWord!==e.wholeWord:!1:!0}shouldUpdateHighlighting(e,t){return t?.decorations?this._cachedSearchTerm===void 0||e!==this._cachedSearchTerm||this.didOptionsChange(t):!1}clearCachedTerm(){this._cachedSearchTerm=void 0}reset(){this._cachedSearchTerm=void 0,this._lastSearchOptions=void 0}},O8=class{constructor(e,t){this._terminal=e,this._lineCache=t}find(e,t,i,r){if(!e||e.length===0){this._terminal.clearSelection();return}if(i>this._terminal.cols)throw new Error(`Invalid col: ${i} to search in terminal of ${this._terminal.cols} cols`);this._lineCache.initLinesCache();let s={startRow:t,startCol:i},n=this._findInLine(e,s,r);if(!n)for(let o=t+1;o<this._terminal.buffer.active.baseY+this._terminal.rows&&(s.startRow=o,s.startCol=0,n=this._findInLine(e,s,r),!n);o++);return n}findNextWithSelection(e,t,i){if(!e||e.length===0){this._terminal.clearSelection();return}let r=this._terminal.getSelectionPosition();this._terminal.clearSelection();let s=0,n=0;r&&(i===e?(s=r.end.x,n=r.end.y):(s=r.start.x,n=r.start.y)),this._lineCache.initLinesCache();let o={startRow:n,startCol:s},a=this._findInLine(e,o,t);if(!a)for(let h=n+1;h<this._terminal.buffer.active.baseY+this._terminal.rows&&(o.startRow=h,o.startCol=0,a=this._findInLine(e,o,t),!a);h++);if(!a&&n!==0)for(let h=0;h<n&&(o.startRow=h,o.startCol=0,a=this._findInLine(e,o,t),!a);h++);return!a&&r&&(o.startRow=r.start.y,o.startCol=0,a=this._findInLine(e,o,t)),a}findPreviousWithSelection(e,t,i){if(!e||e.length===0){this._terminal.clearSelection();return}let r=this._terminal.getSelectionPosition();this._terminal.clearSelection();let s=this._terminal.buffer.active.baseY+this._terminal.rows-1,n=this._terminal.cols,o=!0;this._lineCache.initLinesCache();let a={startRow:s,startCol:n},h;if(r&&(a.startRow=s=r.start.y,a.startCol=n=r.start.x,i!==e&&(h=this._findInLine(e,a,t,!1),h||(a.startRow=s=r.end.y,a.startCol=n=r.end.x))),h||(h=this._findInLine(e,a,t,o)),!h){a.startCol=Math.max(a.startCol,this._terminal.cols);for(let l=s-1;l>=0&&(a.startRow=l,h=this._findInLine(e,a,t,o),!h);l--);}if(!h&&s!==this._terminal.buffer.active.baseY+this._terminal.rows-1)for(let l=this._terminal.buffer.active.baseY+this._terminal.rows-1;l>=s&&(a.startRow=l,h=this._findInLine(e,a,t,o),!h);l--);return h}_isWholeWord(e,t,i){return(e===0||" ~!@#$%^&*()+`-=[]{}|\\;:\"',./<>?".includes(t[e-1]))&&(e+i.length===t.length||" ~!@#$%^&*()+`-=[]{}|\\;:\"',./<>?".includes(t[e+i.length]))}_findInLine(e,t,i={},r=!1){let s=t.startRow,n=t.startCol;if(this._terminal.buffer.active.getLine(s)?.isWrapped){if(r){t.startCol+=this._terminal.cols;return}return t.startRow--,t.startCol+=this._terminal.cols,this._findInLine(e,t,i)}let o=this._lineCache.getLineFromCache(s);o||(o=this._lineCache.translateBufferLineToStringWithWrap(s,!0),this._lineCache.setLineInCache(s,o));let[a,h]=o,l=this._bufferColsToStringOffset(s,n),c=e,u=a;i.regex||(c=i.caseSensitive?e:e.toLowerCase(),u=i.caseSensitive?a:a.toLowerCase());let g=-1;if(i.regex){let _=RegExp(c,i.caseSensitive?"g":"gi"),m;if(r)for(;m=_.exec(u.slice(0,l));)g=_.lastIndex-m[0].length,e=m[0],_.lastIndex-=e.length-1;else m=_.exec(u.slice(l)),m&&m[0].length>0&&(g=l+(_.lastIndex-m[0].length),e=m[0])}else r?l-c.length>=0&&(g=u.lastIndexOf(c,l-c.length)):g=u.indexOf(c,l);if(g>=0){if(i.wholeWord&&!this._isWholeWord(g,u,e))return;let _=0;for(;_<h.length-1&&g>=h[_+1];)_++;let m=_;for(;m<h.length-1&&g+e.length>=h[m+1];)m++;let v=g-h[_],x=g+e.length-h[m],E=this._stringLengthToBufferSize(s+_,v),M=this._stringLengthToBufferSize(s+m,x)-E+this._terminal.cols*(m-_);return{term:e,col:E,row:s+_,size:M}}}_stringLengthToBufferSize(e,t){let i=this._terminal.buffer.active.getLine(e);if(!i)return 0;for(let r=0;r<t;r++){let s=i.getCell(r);if(!s)break;let n=s.getChars();n.length>1&&(t-=n.length-1);let o=i.getCell(r+1);o&&o.getWidth()===0&&t++}return t}_bufferColsToStringOffset(e,t){let i=e,r=0,s=this._terminal.buffer.active.getLine(i);for(;t>0&&s;){for(let n=0;n<t&&n<this._terminal.cols;n++){let o=s.getCell(n);if(!o)break;o.getWidth()&&(r+=o.getCode()===0?1:o.getChars().length)}if(i++,s=this._terminal.buffer.active.getLine(i),s&&!s.isWrapped)break;t-=this._terminal.cols}return r}},K8=class extends Ai{constructor(e){super(),this._terminal=e,this._highlightDecorations=[],this._highlightedLines=new Set,this._register(Ks(()=>this.clearHighlightDecorations()))}createHighlightDecorations(e,t){this.clearHighlightDecorations();for(let i of e){let r=this._createResultDecorations(i,t,!1);if(r)for(let s of r)this._storeDecoration(s,i)}}createActiveDecoration(e,t){let i=this._createResultDecorations(e,t,!0);if(i)return{decorations:i,match:e,dispose(){ao(i)}}}clearHighlightDecorations(){ao(this._highlightDecorations),this._highlightDecorations=[],this._highlightedLines.clear()}_storeDecoration(e,t){this._highlightedLines.add(e.marker.line),this._highlightDecorations.push({decoration:e,match:t,dispose(){e.dispose()}})}_applyStyles(e,t,i){e.classList.contains("xterm-find-result-decoration")||(e.classList.add("xterm-find-result-decoration"),t&&(e.style.outline=`1px solid ${t}`)),i&&e.classList.add("xterm-find-active-result-decoration")}_createResultDecorations(e,t,i){let r=[],s=e.col,n=e.size,o=-this._terminal.buffer.active.baseY-this._terminal.buffer.active.cursorY+e.row;for(;n>0;){let h=Math.min(this._terminal.cols-s,n);r.push([o,s,h]),s=0,n-=h,o++}let a=[];for(let h of r){let l=this._terminal.registerMarker(h[0]),c=this._terminal.registerDecoration({marker:l,x:h[1],width:h[2],backgroundColor:i?t.activeMatchBackground:t.matchBackground,overviewRulerOptions:this._highlightedLines.has(l.line)?void 0:{color:i?t.activeMatchColorOverviewRuler:t.matchOverviewRuler,position:"center"}});if(c){let u=[];u.push(l),u.push(c.onRender(g=>this._applyStyles(g,i?t.activeMatchBorder:t.matchBorder,!1))),u.push(c.onDispose(()=>ao(u))),a.push(c)}}return a.length===0?void 0:a}},N8=class extends Ai{constructor(){super(...arguments),this._searchResults=[],this._onDidChangeResults=this._register(new wi)}get onDidChangeResults(){return this._onDidChangeResults.event}get searchResults(){return this._searchResults}get selectedDecoration(){return this._selectedDecoration}set selectedDecoration(e){this._selectedDecoration=e}updateResults(e,t){this._searchResults=e.slice(0,t)}clearResults(){this._searchResults=[]}clearSelectedDecoration(){this._selectedDecoration&&(this._selectedDecoration.dispose(),this._selectedDecoration=void 0)}findResultIndex(e){for(let t=0;t<this._searchResults.length;t++){let i=this._searchResults[t];if(i.row===e.row&&i.col===e.col&&i.size===e.size)return t}return-1}fireResultsChanged(e){if(!e)return;let t=-1;this._selectedDecoration&&(t=this.findResultIndex(this._selectedDecoration.match)),this._onDidChangeResults.fire({resultIndex:t,resultCount:this._searchResults.length})}reset(){this.clearSelectedDecoration(),this.clearResults()}},yb=class extends Ai{constructor(e){super(),this._highlightTimeout=this._register(new Fl),this._lineCache=this._register(new Fl),this._state=new P8,this._resultTracker=this._register(new N8),this._highlightLimit=e?.highlightLimit??1e3}get onDidChangeResults(){return this._resultTracker.onDidChangeResults}activate(e){this._terminal=e,this._lineCache.value=new F8(e),this._engine=new O8(e,this._lineCache.value),this._decorationManager=new K8(e),this._register(this._terminal.onWriteParsed(()=>this._updateMatches())),this._register(this._terminal.onResize(()=>this._updateMatches())),this._register(Ks(()=>this.clearDecorations()))}_updateMatches(){this._highlightTimeout.clear(),this._state.cachedSearchTerm&&this._state.lastSearchOptions?.decorations&&(this._highlightTimeout.value=vb(()=>{let e=this._state.cachedSearchTerm;this._state.clearCachedTerm(),this.findPrevious(e,{...this._state.lastSearchOptions,incremental:!0},{noScroll:!0})},200))}clearDecorations(e){this._resultTracker.clearSelectedDecoration(),this._decorationManager?.clearHighlightDecorations(),this._resultTracker.clearResults(),e||this._state.clearCachedTerm()}clearActiveDecoration(){this._resultTracker.clearSelectedDecoration()}findNext(e,t,i){if(!this._terminal||!this._engine)throw new Error("Cannot use addon until it has been loaded");this._state.lastSearchOptions=t,this._state.shouldUpdateHighlighting(e,t)&&this._highlightAllMatches(e,t);let r=this._findNextAndSelect(e,t,i);return this._fireResults(t),this._state.cachedSearchTerm=e,r}_highlightAllMatches(e,t){if(!this._terminal||!this._engine||!this._decorationManager)throw new Error("Cannot use addon until it has been loaded");if(!this._state.isValidSearchTerm(e)){this.clearDecorations();return}this.clearDecorations(!0);let i=[],r,s=this._engine.find(e,0,0,t);for(;s&&(r?.row!==s.row||r?.col!==s.col)&&!(i.length>=this._highlightLimit);)r=s,i.push(r),s=this._engine.find(e,r.col+r.term.length>=this._terminal.cols?r.row+1:r.row,r.col+r.term.length>=this._terminal.cols?0:r.col+1,t);this._resultTracker.updateResults(i,this._highlightLimit),t.decorations&&this._decorationManager.createHighlightDecorations(i,t.decorations)}_findNextAndSelect(e,t,i){if(!this._terminal||!this._engine)return!1;if(!this._state.isValidSearchTerm(e))return this._terminal.clearSelection(),this.clearDecorations(),!1;let r=this._engine.findNextWithSelection(e,t,this._state.cachedSearchTerm);return this._selectResult(r,t?.decorations,i?.noScroll)}findPrevious(e,t,i){if(!this._terminal||!this._engine)throw new Error("Cannot use addon until it has been loaded");this._state.lastSearchOptions=t,this._state.shouldUpdateHighlighting(e,t)&&this._highlightAllMatches(e,t);let r=this._findPreviousAndSelect(e,t,i);return this._fireResults(t),this._state.cachedSearchTerm=e,r}_fireResults(e){this._resultTracker.fireResultsChanged(!!e?.decorations)}_findPreviousAndSelect(e,t,i){if(!this._terminal||!this._engine)return!1;if(!this._state.isValidSearchTerm(e))return this._terminal.clearSelection(),this.clearDecorations(),!1;let r=this._engine.findPreviousWithSelection(e,t,this._state.cachedSearchTerm);return this._selectResult(r,t?.decorations,i?.noScroll)}_selectResult(e,t,i){if(!this._terminal||!this._decorationManager)return!1;if(this._resultTracker.clearSelectedDecoration(),!e)return this._terminal.clearSelection(),!1;if(this._terminal.select(e.col,e.row,e.size),t){let r=this._decorationManager.createActiveDecoration(e,t);r&&(this._resultTracker.selectedDecoration=r)}if(!i&&(e.row>=this._terminal.buffer.active.viewportY+this._terminal.rows||e.row<this._terminal.buffer.active.viewportY)){let r=e.row-this._terminal.buffer.active.viewportY;r-=Math.floor(this._terminal.rows/2),this._terminal.scrollLines(r)}return!0}};var Q8=Object.create,Db=Object.defineProperty,H8=Object.getOwnPropertyDescriptor,X8=Object.getOwnPropertyNames,U8=Object.getPrototypeOf,z8=Object.prototype.hasOwnProperty,_o=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),W8=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of X8(t))!z8.call(e,s)&&s!==i&&Db(e,s,{get:()=>t[s],enumerable:!(r=H8(t,s))||r.enumerable});return e},Xl=(e,t,i)=>(i=e!=null?Q8(U8(e)):{},W8(t||!e||!e.__esModule?Db(i,"default",{value:e,enumerable:!0}):i,e)),df=_o(e=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_FOREGROUND=e.DEFAULT_BACKGROUND=e.PALETTE_ANSI_256=e.PALETTE_VT340_GREY=e.PALETTE_VT340_COLOR=e.normalizeHLS=e.normalizeRGB=e.nearestColorIndex=e.fromRGBA8888=e.toRGBA8888=e.alpha=e.blue=e.green=e.red=e.BIG_ENDIAN=void 0,e.BIG_ENDIAN=new Uint8Array(new Uint32Array([4278190080]).buffer)[0]===255,e.BIG_ENDIAN&&console.warn("BE platform detected. This version of node-sixel works only on LE properly.");function t(_){return _&255}e.red=t;function i(_){return _>>>8&255}e.green=i;function r(_){return _>>>16&255}e.blue=r;function s(_){return _>>>24&255}e.alpha=s;function n(_,m,v,x=255){return((x&255)<<24|(v&255)<<16|(m&255)<<8|_&255)>>>0}e.toRGBA8888=n;function o(_){return[_&255,_>>8&255,_>>16&255,_>>>24]}e.fromRGBA8888=o;function a(_,m){let v=t(_),x=i(_),E=r(_),M=Number.MAX_SAFE_INTEGER,D=-1;for(let b=0;b<m.length;++b){let L=v-m[b][0],I=x-m[b][1],R=E-m[b][2],G=L*L+I*I+R*R;if(!G)return b;G<M&&(M=G,D=b)}return D}e.nearestColorIndex=a;function h(_,m,v){return Math.max(_,Math.min(v,m))}function l(_,m,v){return v<0&&(v+=1),v>1&&(v-=1),v*6<1?m+(_-m)*6*v:v*2<1?_:v*3<2?m+(_-m)*(4-v*6):m}function c(_,m,v){if(!v){let M=Math.round(m*255);return n(M,M,M)}let x=m<.5?m*(1+v):m+v-m*v,E=2*m-x;return n(h(0,255,Math.round(l(x,E,_+1/3)*255)),h(0,255,Math.round(l(x,E,_)*255)),h(0,255,Math.round(l(x,E,_-1/3)*255)))}function u(_,m,v){return(4278190080|Math.round(v/100*255)<<16|Math.round(m/100*255)<<8|Math.round(_/100*255))>>>0}e.normalizeRGB=u;function g(_,m,v){return c((_+240%360)/360,m/100,v/100)}e.normalizeHLS=g,e.PALETTE_VT340_COLOR=new Uint32Array([u(0,0,0),u(20,20,80),u(80,13,13),u(20,80,20),u(80,20,80),u(20,80,80),u(80,80,20),u(53,53,53),u(26,26,26),u(33,33,60),u(60,26,26),u(33,60,33),u(60,33,60),u(33,60,60),u(60,60,33),u(80,80,80)]),e.PALETTE_VT340_GREY=new Uint32Array([u(0,0,0),u(13,13,13),u(26,26,26),u(40,40,40),u(6,6,6),u(20,20,20),u(33,33,33),u(46,46,46),u(0,0,0),u(13,13,13),u(26,26,26),u(40,40,40),u(6,6,6),u(20,20,20),u(33,33,33),u(46,46,46)]),e.PALETTE_ANSI_256=(()=>{let _=[n(0,0,0),n(205,0,0),n(0,205,0),n(205,205,0),n(0,0,238),n(205,0,205),n(0,250,205),n(229,229,229),n(127,127,127),n(255,0,0),n(0,255,0),n(255,255,0),n(92,92,255),n(255,0,255),n(0,255,255),n(255,255,255)],m=[0,95,135,175,215,255];for(let v=0;v<6;++v)for(let x=0;x<6;++x)for(let E=0;E<6;++E)_.push(n(m[v],m[x],m[E]));for(let v=8;v<=238;v+=10)_.push(n(v,v,v));return new Uint32Array(_)})(),e.DEFAULT_BACKGROUND=n(0,0,0,255),e.DEFAULT_FOREGROUND=n(255,255,255,255)}),$8=_o(e=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.InWasm=void 0;function t(r){if(typeof Buffer<"u")return Buffer.from(r,"base64");let s=atob(r),n=new Uint8Array(s.length);for(let o=0;o<n.length;++o)n[o]=s.charCodeAt(o);return n}function i(r){if(r.d){let{t:s,s:n,d:o}=r,a,h,l=WebAssembly;return s===2?n?()=>a||(a=t(o)):()=>Promise.resolve(a||(a=t(o))):s===1?n?()=>h||(h=new l.Module(a||(a=t(o)))):()=>h?Promise.resolve(h):l.compile(a||(a=t(o))).then(c=>h=c):n?c=>new l.Instance(h||(h=new l.Module(a||(a=t(o)))),c):c=>h?l.instantiate(h,c):l.instantiate(a||(a=t(o)),c).then(u=>(h=u.module)&&u.instance)}if(typeof _wasmCtx>"u")throw new Error('must run "inwasm"');_wasmCtx.add(r)}e.InWasm=i}),G8=_o(e=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t=$8(),i=(0,t.InWasm)({s:1,t:0,d:"AGFzbQEAAAABBQFgAAF/Ag8BA2VudgZtZW1vcnkCAAEDAwIAAAcNAgNkZWMAAANlbmQAAQqxAwKuAQEFf0GIKCgCAEGgKGohAUGEKCgCACIAQYAoKAIAQQFrQXxxIgJIBEAgAkGgKGohAyAAQaAoaiEAA0AgAC0AA0ECdCgCgCAgAC0AAkECdCgCgBggAC0AAUECdCgCgBAgAC0AAEECdCgCgAhycnIiBEH///8HSwRAQQEPCyABIAQ2AgAgAUEDaiEBIABBBGoiACADSQ0ACwtBhCggAjYCAEGIKCABQaAoazYCAEEAC/4BAQZ/AkBBgCgoAgAiAUGEKCgCACIAa0EFTgRAQQEhAxAADQFBgCgoAgAhAUGEKCgCACEAC0EBIQMgASAAayIEQQJIDQAgAEGhKGotAABBAnQoAoAQIABBoChqLQAAQQJ0KAKACHIhAQJAIARBAkYEQEEBIQIMAQtBASECIAAtAKIoIgVBPUcEQEECIQIgBUECdCgCgBggAXIhAQsgBEEERw0AIAAtAKMoIgBBPUYNACACQQFqIQIgAEECdCgCgCAgAXIhAQsgAUH///8HSw0AQYgoKAIAQaAoaiABNgIAQYgoQYgoKAIAIAJqIgA2AgAgAEGQKCgCAEchAwsgAwsAdglwcm9kdWNlcnMBDHByb2Nlc3NlZC1ieQEFY2xhbmdWMTguMC4wIChodHRwczovL2dpdGh1Yi5jb20vbGx2bS9sbHZtLXByb2plY3QgZDFlNjg1ZGY0NWRjNTk0NGI0M2QyNTQ3ZDAxMzhjZDRhM2VlNGVmZSkALA90YXJnZXRfZmVhdHVyZXMCKw9tdXRhYmxlLWdsb2JhbHMrCHNpZ24tZXh0"}),r=new Uint8Array("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("").map(a=>a.charCodeAt(0))),s=new Uint32Array(1024);s.fill(4278190080);for(let a=0;a<r.length;++a)s[r[a]]=a<<2;for(let a=0;a<r.length;++a)s[256+r[a]]=a>>4|(a<<4&255)<<8;for(let a=0;a<r.length;++a)s[512+r[a]]=a>>2<<8|(a<<6&255)<<16;for(let a=0;a<r.length;++a)s[768+r[a]]=a<<16;var n=new Uint8Array(0),o=class{constructor(a){this.keepSize=a}get data8(){return this._inst?this._d.subarray(0,this._m32[1282]):n}release(){this._inst&&(this._mem.buffer.byteLength>this.keepSize?this._inst=this._m32=this._d=this._mem=null:(this._m32[1280]=0,this._m32[1281]=0,this._m32[1282]=0))}init(a){let h=this._m32,l=(Math.ceil(a/3)+1288)*4;this._inst?this._mem.buffer.byteLength<l&&(this._mem.grow(Math.ceil((l-this._mem.buffer.byteLength)/65536)),h=new Uint32Array(this._mem.buffer,0),this._d=new Uint8Array(this._mem.buffer,1288*4)):(this._mem=new WebAssembly.Memory({initial:Math.ceil(l/65536)}),this._inst=i({env:{memory:this._mem}}),h=new Uint32Array(this._mem.buffer,0),h.set(s,256),this._d=new Uint8Array(this._mem.buffer,1288*4)),h[1284]=a,h[1283]=Math.ceil(a/3)*4,h[1280]=0,h[1281]=0,h[1282]=0,this._m32=h}put(a,h,l){if(!this._inst)return 1;let c=this._m32;return l-h+c[1280]>c[1283]?1:(this._d.set(a.subarray(h,l),c[1280]),c[1280]+=l-h,c[1280]-c[1281]>=131072?this._inst.exports.dec():0)}end(){return this._inst?this._inst.exports.end():1}};e.default=o}),j8=_o(e=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LIMITS=void 0,e.LIMITS={CHUNK_SIZE:16384,PALETTE_SIZE:4096,MAX_WIDTH:16384,BYTES:"AGFzbQEAAAABJAdgAAF/YAJ/fwBgA39/fwF/YAF/AX9gAABgBH9/f38AYAF/AAIlAgNlbnYLaGFuZGxlX2JhbmQAAwNlbnYLbW9kZV9wYXJzZWQAAwMTEgQAAAAAAQQBAQUBAAACAgAGAwQFAXABBwcFBAEBBwcGCAF/AUGAihoLB9wBDgZtZW1vcnkCABFnZXRfc3RhdGVfYWRkcmVzcwADEWdldF9jaHVua19hZGRyZXNzAAQOZ2V0X3AwX2FkZHJlc3MABRNnZXRfcGFsZXR0ZV9hZGRyZXNzAAYEaW5pdAALBmRlY29kZQAMDWN1cnJlbnRfd2lkdGgADQ5jdXJyZW50X2hlaWdodAAOGV9faW5kaXJlY3RfZnVuY3Rpb25fdGFibGUBAAtfaW5pdGlhbGl6ZQACCXN0YWNrU2F2ZQARDHN0YWNrUmVzdG9yZQASCnN0YWNrQWxsb2MAEwkMAQBBAQsGCgcJDxACDAEBCq5UEgMAAQsFAEGgCAsGAEGQiQELBgBBsIkCCwUAQZAJC+okAQh/QeQIKAIAIQVB4AgoAgAhA0HoCCgCACEIIAFBkIkBaiIJQf8BOgAAIAAgAUgEQCAAQZCJAWohBgNAIAMhBCAGQQFqIQECQCAGLQAAQf8AcSIDQTBrQQlLBEAgASEGDAELQewIKAIAQQJ0QewIaiICKAIAIQADQCACIAMgAEEKbGpBMGsiADYCACABLQAAIQMgAUEBaiIGIQEgA0H/AHEiA0Ewa0EKSQ0ACwsCQAJAAkACQAJAAkACQAJ/AkACQCADQT9rIgBBP00EQCAERQ0BIARBIUYEQAJAQfAIKAIAIgFBASABGyIHIAhqIgFB1AgoAgAiA0gNACADQf//AEoNAANAIANBAnQiAkGgiQJqIgRBoAgpAwA3AwAgAkGoiQJqQaAIKQMANwMAIAJBsIkCakGgCCkDADcDACACQbiJAmpBoAgpAwA3AwAgAkHAiQJqQaAIKQMANwMAIAJByIkCakGgCCkDADcDACACQdCJAmpBoAgpAwA3AwAgAkHYiQJqQaAIKQMANwMAIAJB4IkCakGgCCkDADcDACACQeiJAmpBoAgpAwA3AwAgAkHwiQJqQaAIKQMANwMAIAJB+IkCakGgCCkDADcDACACQYCKAmpBoAgpAwA3AwAgAkGIigJqQaAIKQMANwMAIAJBkIoCakGgCCkDADcDACACQZiKAmpBoAgpAwA3AwAgAkGgigJqQaAIKQMANwMAIAJBqIoCakGgCCkDADcDACACQbCKAmpBoAgpAwA3AwAgAkG4igJqQaAIKQMANwMAIAJBwIoCakGgCCkDADcDACACQciKAmpBoAgpAwA3AwAgAkHQigJqQaAIKQMANwMAIAJB2IoCakGgCCkDADcDACACQeCKAmpBoAgpAwA3AwAgAkHoigJqQaAIKQMANwMAIAJB8IoCakGgCCkDADcDACACQfiKAmpBoAgpAwA3AwAgAkGAiwJqQaAIKQMANwMAIAJBiIsCakGgCCkDADcDACACQZCLAmpBoAgpAwA3AwAgAkGYiwJqQaAIKQMANwMAIAJBoIsCakGgCCkDADcDACACQaiLAmpBoAgpAwA3AwAgAkGwiwJqQaAIKQMANwMAIAJBuIsCakGgCCkDADcDACACQcCLAmpBoAgpAwA3AwAgAkHIiwJqQaAIKQMANwMAIAJB0IsCakGgCCkDADcDACACQdiLAmpBoAgpAwA3AwAgAkHgiwJqQaAIKQMANwMAIAJB6IsCakGgCCkDADcDACACQfCLAmpBoAgpAwA3AwAgAkH4iwJqQaAIKQMANwMAIAJBgIwCakGgCCkDADcDACACQYiMAmpBoAgpAwA3AwAgAkGQjAJqQaAIKQMANwMAIAJBmIwCakGgCCkDADcDACACQaCMAmpBoAgpAwA3AwAgAkGojAJqQaAIKQMANwMAIAJBsIwCakGgCCkDADcDACACQbiMAmpBoAgpAwA3AwAgAkHAjAJqQaAIKQMANwMAIAJByIwCakGgCCkDADcDACACQdCMAmpBoAgpAwA3AwAgAkHYjAJqQaAIKQMANwMAIAJB4IwCakGgCCkDADcDACACQeiMAmpBoAgpAwA3AwAgAkHwjAJqQaAIKQMANwMAIAJB+IwCakGgCCkDADcDACACQYCNAmpBoAgpAwA3AwAgAkGIjQJqQaAIKQMANwMAIAJBkI0CakGgCCkDADcDACACQZiNAmpBoAgpAwA3AwAgAkGwiQZqIARBgAT8CgAAQdQIKAIAQQJ0QcCJCmogBEGABPwKAABB1AgoAgBBAnRB0IkOaiAEQYAE/AoAAEHUCCgCAEECdEHgiRJqIARBgAT8CgAAQdQIKAIAQQJ0QfCJFmogBEGABPwKAABB1AhB1AgoAgAiAkGAAWoiAzYCACABIANIDQEgAkGA/wBIDQALCwJAIABFDQAgCEH//wBLDQBBgIABIAhrIAcgAUH//wBLGyECAkAgAEEBcUUNACACRQ0AIAhBAnRBoIkCaiEDIAIhBCACQQdxIgcEQANAIAMgBTYCACADQQRqIQMgBEEBayEEIAdBAWsiBw0ACwsgAkEBa0EHSQ0AA0AgAyAFNgIcIAMgBTYCGCADIAU2AhQgAyAFNgIQIAMgBTYCDCADIAU2AgggAyAFNgIEIAMgBTYCACADQSBqIQMgBEEIayIEDQALCwJAIABBAnFFDQAgAkUNACAIQQJ0QbCJBmohAyACIQQgAkEHcSIHBEADQCADIAU2AgAgA0EEaiEDIARBAWshBCAHQQFrIgcNAAsLIAJBAWtBB0kNAANAIAMgBTYCHCADIAU2AhggAyAFNgIUIAMgBTYCECADIAU2AgwgAyAFNgIIIAMgBTYCBCADIAU2AgAgA0EgaiEDIARBCGsiBA0ACwsCQCAAQQRxRQ0AIAJFDQAgCEECdEHAiQpqIQMgAiEEIAJBB3EiBwRAA0AgAyAFNgIAIANBBGohAyAEQQFrIQQgB0EBayIHDQALCyACQQFrQQdJDQADQCADIAU2AhwgAyAFNgIYIAMgBTYCFCADIAU2AhAgAyAFNgIMIAMgBTYCCCADIAU2AgQgAyAFNgIAIANBIGohAyAEQQhrIgQNAAsLAkAgAEEIcUUNACACRQ0AIAhBAnRB0IkOaiEDIAIhBCACQQdxIgcEQANAIAMgBTYCACADQQRqIQMgBEEBayEEIAdBAWsiBw0ACwsgAkEBa0EHSQ0AA0AgAyAFNgIcIAMgBTYCGCADIAU2AhQgAyAFNgIQIAMgBTYCDCADIAU2AgggAyAFNgIEIAMgBTYCACADQSBqIQMgBEEIayIEDQALCwJAIABBEHFFDQAgAkUNACAIQQJ0QeCJEmohAyACIQQgAkEHcSIHBEADQCADIAU2AgAgA0EEaiEDIARBAWshBCAHQQFrIgcNAAsLIAJBAWtBB0kNAANAIAMgBTYCHCADIAU2AhggAyAFNgIUIAMgBTYCECADIAU2AgwgAyAFNgIIIAMgBTYCBCADIAU2AgAgA0EgaiEDIARBCGsiBA0ACwsgAEEgcUUNACACRQ0AIAJBAWshByAIQQJ0QfCJFmohAyACQQdxIgQEQANAIAMgBTYCACADQQRqIQMgAkEBayECIARBAWsiBA0ACwsgB0EHSQ0AA0AgAyAFNgIcIAMgBTYCGCADIAU2AhQgAyAFNgIQIAMgBTYCDCADIAU2AgggAyAFNgIEIAMgBTYCACADQSBqIQMgAkEIayICDQALC0HcCEHcCCgCACAAcjYCACAGQQFqIgIgBi0AAEH/AHEiA0E/ayIAQT9LDQQaDAMLAkBB7AgoAgAiBEEBRgRAQfAIKAIAIgNBzAgoAgAiAUkNASADIAFwIQMMAQtB+AgoAgAhAkH0CCgCACEBAkACQCAEQQVHDQAgAUEBRw0AIAJB6QJODQQMAQsgAkHkAEoNA0H8CCgCAEHkAEoNA0GACSgCAEHkAEoNAwsCQCABRQ0AIAFBAkoNACACQfwIKAIAQYAJKAIAIAFBAnRBiAhqKAIAEQIAIQFB8AgoAgAiA0HMCCgCACICTwR/IAMgAnAFIAMLQQJ0QZAJaiABNgIAC0HwCCgCACIDQcwIKAIAIgFJDQAgAyABcCEDCyADQQJ0QZAJaigCACEFDAELIANB/QBxQSFHBEAgCCEBIAYhAgwECyAEQSNHDQQCQEHsCCgCACICQQFGBEBB8AgoAgAiAUHMCCgCACIASQ0BIAEgAHAhAQwBC0H4CCgCACEBQfQIKAIAIQACQAJAIAJBBUcNACAAQQFHDQAgAUHpAkgNAQwHCyABQeQASg0GQfwIKAIAQeQASg0GQYAJKAIAQeQASg0GCwJAIABFDQAgAEECSg0AIAFB/AgoAgBBgAkoAgAgAEECdEGICGooAgARAgAhAEHwCCgCACIBQcwIKAIAIgJPBH8gASACcAUgAQtBAnRBkAlqIAA2AgALQfAIKAIAIgFBzAgoAgAiAEkNACABIABwIQELIAFBAnRBkAlqKAIAIQUMBAsgCCEBIAYhAgtB1AgoAgAhBgNAAkAgASAGSA0AIAZB//8ASg0AIAZBAnQiBEGgiQJqIgZBoAgpAwA3AwAgBEGoiQJqQaAIKQMANwMAIARBsIkCakGgCCkDADcDACAEQbiJAmpBoAgpAwA3AwAgBEHAiQJqQaAIKQMANwMAIARByIkCakGgCCkDADcDACAEQdCJAmpBoAgpAwA3AwAgBEHYiQJqQaAIKQMANwMAIARB4IkCakGgCCkDADcDACAEQeiJAmpBoAgpAwA3AwAgBEHwiQJqQaAIKQMANwMAIARB+IkCakGgCCkDADcDACAEQYCKAmpBoAgpAwA3AwAgBEGIigJqQaAIKQMANwMAIARBkIoCakGgCCkDADcDACAEQZiKAmpBoAgpAwA3AwAgBEGgigJqQaAIKQMANwMAIARBqIoCakGgCCkDADcDACAEQbCKAmpBoAgpAwA3AwAgBEG4igJqQaAIKQMANwMAIARBwIoCakGgCCkDADcDACAEQciKAmpBoAgpAwA3AwAgBEHQigJqQaAIKQMANwMAIARB2IoCakGgCCkDADcDACAEQeCKAmpBoAgpAwA3AwAgBEHoigJqQaAIKQMANwMAIARB8IoCakGgCCkDADcDACAEQfiKAmpBoAgpAwA3AwAgBEGAiwJqQaAIKQMANwMAIARBiIsCakGgCCkDADcDACAEQZCLAmpBoAgpAwA3AwAgBEGYiwJqQaAIKQMANwMAIARBoIsCakGgCCkDADcDACAEQaiLAmpBoAgpAwA3AwAgBEGwiwJqQaAIKQMANwMAIARBuIsCakGgCCkDADcDACAEQcCLAmpBoAgpAwA3AwAgBEHIiwJqQaAIKQMANwMAIARB0IsCakGgCCkDADcDACAEQdiLAmpBoAgpAwA3AwAgBEHgiwJqQaAIKQMANwMAIARB6IsCakGgCCkDADcDACAEQfCLAmpBoAgpAwA3AwAgBEH4iwJqQaAIKQMANwMAIARBgIwCakGgCCkDADcDACAEQYiMAmpBoAgpAwA3AwAgBEGQjAJqQaAIKQMANwMAIARBmIwCakGgCCkDADcDACAEQaCMAmpBoAgpAwA3AwAgBEGojAJqQaAIKQMANwMAIARBsIwCakGgCCkDADcDACAEQbiMAmpBoAgpAwA3AwAgBEHAjAJqQaAIKQMANwMAIARByIwCakGgCCkDADcDACAEQdCMAmpBoAgpAwA3AwAgBEHYjAJqQaAIKQMANwMAIARB4IwCakGgCCkDADcDACAEQeiMAmpBoAgpAwA3AwAgBEHwjAJqQaAIKQMANwMAIARB+IwCakGgCCkDADcDACAEQYCNAmpBoAgpAwA3AwAgBEGIjQJqQaAIKQMANwMAIARBkI0CakGgCCkDADcDACAEQZiNAmpBoAgpAwA3AwAgBEGwiQZqIAZBgAT8CgAAQdQIKAIAQQJ0QcCJCmogBkGABPwKAABB1AgoAgBBAnRB0IkOaiAGQYAE/AoAAEHUCCgCAEECdEHgiRJqIAZBgAT8CgAAQdQIKAIAQQJ0QfCJFmogBkGABPwKAABB1AhB1AgoAgBBgAFqIgY2AgALIAFB//8ATQRAIABBAXEgAWxBAnRBoIkCaiAFNgIAIABBAXZBAXEgAWxBAnRBsIkGaiAFNgIAIABBAnZBAXEgAWxBAnRBwIkKaiAFNgIAIABBA3ZBAXEgAWxBAnRB0IkOaiAFNgIAIABBBHZBAXEgAWxBAnRB4IkSaiAFNgIAIABBBXYgAWxBAnRB8IkWaiAFNgIAQdQIKAIAIQYLIAFBAWohAUHcCEHcCCgCACAAcjYCACACLQAAIQAgAkEBaiIEIQIgAEH/AHEiA0E/ayIAQcAASQ0ACyAECyECQQAhBCACIQYgASEIIANB/QBxQSFGDQELIANBJGsOCgEDAwMDAwMDAwIDC0HsCEIBNwIADAQLQdgIIAFB2AgoAgAiACAAIAFIGyIAQYCAASAAQYCAAUgbNgIADAILQegIIAFB2AgoAgAiACAAIAFIGyIAQYCAASAAQYCAAUgbIgA2AgBB2AggADYCACAAQQRrEAAEQEHoCEEENgIAQdgIQQQ2AgBB0AhBATYCAA8LEAgMAQsCQCADQTtHDQBB7AgoAgAiAEEHSg0AQewIIABBAWo2AgAgAEECdEHwCGpBADYCAAsgAiEGIAQhAyABIQgMAQtBBCEIIAIhBiAEIQMLIAYgCUkNAAsLQeQIIAU2AgBB4AggAzYCAEHoCCAINgIAC9ELAgF+CH9B2AhCBDcDAEGojQJBoAgpAwAiADcDAEGgjQIgADcDAEGYjQIgADcDAEGQjQIgADcDAEGIjQIgADcDAEGAjQIgADcDAEH4jAIgADcDAEHwjAIgADcDAEHojAIgADcDAEHgjAIgADcDAEHYjAIgADcDAEHQjAIgADcDAEHIjAIgADcDAEHAjAIgADcDAEG4jAIgADcDAEGwjAIgADcDAEGojAIgADcDAEGgjAIgADcDAEGYjAIgADcDAEGQjAIgADcDAEGIjAIgADcDAEGAjAIgADcDAEH4iwIgADcDAEHwiwIgADcDAEHoiwIgADcDAEHgiwIgADcDAEHYiwIgADcDAEHQiwIgADcDAEHIiwIgADcDAEHAiwIgADcDAEG4iwIgADcDAEGwiwIgADcDAEGoiwIgADcDAEGgiwIgADcDAEGYiwIgADcDAEGQiwIgADcDAEGIiwIgADcDAEGAiwIgADcDAEH4igIgADcDAEHwigIgADcDAEHoigIgADcDAEHgigIgADcDAEHYigIgADcDAEHQigIgADcDAEHIigIgADcDAEHAigIgADcDAEG4igIgADcDAEGwigIgADcDAEGoigIgADcDAEGgigIgADcDAEGYigIgADcDAEGQigIgADcDAEGIigIgADcDAEGAigIgADcDAEH4iQIgADcDAEHwiQIgADcDAEHoiQIgADcDAEHgiQIgADcDAEHYiQIgADcDAEHQiQIgADcDAEHIiQIgADcDAEHAiQIgADcDAEG4iQIgADcDAEGwiQIgADcDAEGoCCgCACIEQf8AakGAAW0hCAJAIARBgQFIDQBBASEBIAhBAiAIQQJKG0EBayICQQFxIQMgBEGBAk4EQCACQX5xIQIDQCABQQl0IgdBEHJBoIkCakGwiQJBgAT8CgAAIAdBsI0CakGwiQJBgAT8CgAAIAFBAmohASACQQJrIgINAAsLIANFDQAgAUEJdEEQckGgiQJqQbCJAkGABPwKAAALAkAgBEEBSA0AIAhBASAIQQFKGyIDQQFxIQUCQCADQQFrIgdFBEBBACEBDAELIANB/v///wdxIQJBACEBA0AgAUEJdCIGQRByQbCJBmpBsIkCQYAE/AoAACAGQZAEckGwiQZqQbCJAkGABPwKAAAgAUECaiEBIAJBAmsiAg0ACwsgBQRAIAFBCXRBEHJBsIkGakGwiQJBgAT8CgAACyAEQQFIDQAgA0EBcSEFIAcEfyADQf7///8HcSECQQAhAQNAIAFBCXQiBkEQckHAiQpqQbCJAkGABPwKAAAgBkGQBHJBwIkKakGwiQJBgAT8CgAAIAFBAmohASACQQJrIgINAAsgAUEHdEEEcgVBBAshASAFBEAgAUECdEHAiQpqQbCJAkGABPwKAAALIARBAUgNACADQQFxIQUgBwR/IANB/v///wdxIQJBACEBA0AgAUEJdCIGQRByQdCJDmpBsIkCQYAE/AoAACAGQZAEckHQiQ5qQbCJAkGABPwKAAAgAUECaiEBIAJBAmsiAg0ACyABQQd0QQRyBUEECyEBIAUEQCABQQJ0QdCJDmpBsIkCQYAE/AoAAAsgBEEBSA0AIANBAXEhBSAHBH8gA0H+////B3EhAkEAIQEDQCABQQl0IgZBEHJB4IkSakGwiQJBgAT8CgAAIAZBkARyQeCJEmpBsIkCQYAE/AoAACABQQJqIQEgAkECayICDQALIAFBB3RBBHIFQQQLIQEgBQRAIAFBAnRB4IkSakGwiQJBgAT8CgAACyAEQQFIDQAgA0EBcSEEIAcEfyADQf7///8HcSECQQAhAQNAIAFBCXQiA0EQckHwiRZqQbCJAkGABPwKAAAgA0GQBHJB8IkWakGwiQJBgAT8CgAAIAFBAmohASACQQJrIgINAAsgAUEHdEEEcgVBBAshASAERQ0AIAFBAnRB8IkWakGwiQJBgAT8CgAAC0HUCCAIQQd0QQRyNgIAC58TAgh/AX5B5AgoAgAhA0HgCCgCACECQegIKAIAIQcgAUGQiQFqIglB/wE6AAAgACABSARAIABBkIkBaiEIA0AgAiEEIAhBAWohAQJAIAgtAABB/wBxIgJBMGtBCUsEQCABIQgMAQtB7AgoAgBBAnRB7AhqIgUoAgAhAANAIAUgAiAAQQpsakEwayIANgIAIAEtAAAhAiABQQFqIgghASACQf8AcSICQTBrQQpJDQALCwJAAkACQAJAAkACQAJ/AkAgAkE/ayIAQT9NBEAgBEUNASAEQSFGBEBB8AgoAgAiAUEBIAEbIgQgB2ohAQJAIABFDQAgB0H//wBLDQBBgIABIAdrIAQgAUH//wBLGyEFAkAgAEEBcUUNACAHQQJ0QaCJAmohAiAFIgRBB3EiBgRAA0AgAiADNgIAIAJBBGohAiAEQQFrIQQgBkEBayIGDQALCyAFQQFrQQdJDQADQCACIAM2AhwgAiADNgIYIAIgAzYCFCACIAM2AhAgAiADNgIMIAIgAzYCCCACIAM2AgQgAiADNgIAIAJBIGohAiAEQQhrIgQNAAsLAkAgAEECcUUNACAHQQJ0QbCJBmohAiAFIgRBB3EiBgRAA0AgAiADNgIAIAJBBGohAiAEQQFrIQQgBkEBayIGDQALCyAFQQFrQQdJDQADQCACIAM2AhwgAiADNgIYIAIgAzYCFCACIAM2AhAgAiADNgIMIAIgAzYCCCACIAM2AgQgAiADNgIAIAJBIGohAiAEQQhrIgQNAAsLAkAgAEEEcUUNACAHQQJ0QcCJCmohAiAFIgRBB3EiBgRAA0AgAiADNgIAIAJBBGohAiAEQQFrIQQgBkEBayIGDQALCyAFQQFrQQdJDQADQCACIAM2AhwgAiADNgIYIAIgAzYCFCACIAM2AhAgAiADNgIMIAIgAzYCCCACIAM2AgQgAiADNgIAIAJBIGohAiAEQQhrIgQNAAsLAkAgAEEIcUUNACAHQQJ0QdCJDmohAiAFIgRBB3EiBgRAA0AgAiADNgIAIAJBBGohAiAEQQFrIQQgBkEBayIGDQALCyAFQQFrQQdJDQADQCACIAM2AhwgAiADNgIYIAIgAzYCFCACIAM2AhAgAiADNgIMIAIgAzYCCCACIAM2AgQgAiADNgIAIAJBIGohAiAEQQhrIgQNAAsLAkAgAEEQcUUNACAHQQJ0QeCJEmohAiAFIgRBB3EiBgRAA0AgAiADNgIAIAJBBGohAiAEQQFrIQQgBkEBayIGDQALCyAFQQFrQQdJDQADQCACIAM2AhwgAiADNgIYIAIgAzYCFCACIAM2AhAgAiADNgIMIAIgAzYCCCACIAM2AgQgAiADNgIAIAJBIGohAiAEQQhrIgQNAAsLIABBIHFFDQAgBUEBayEEIAdBAnRB8IkWaiEAIAVBB3EiAgRAA0AgACADNgIAIABBBGohACAFQQFrIQUgAkEBayICDQALCyAEQQdJDQADQCAAIAM2AhwgACADNgIYIAAgAzYCFCAAIAM2AhAgACADNgIMIAAgAzYCCCAAIAM2AgQgACADNgIAIABBIGohACAFQQhrIgUNAAsLIAhBAWoiBSAILQAAQf8AcSICQT9rIgBBP00NAxoMBAsCQEHsCCgCACIFQQFGBEBB8AgoAgAiAUHMCCgCACIESQ0BIAEgBHAhAQwBC0H4CCgCACEEQfQIKAIAIQECQAJAIAVBBUcNACABQQFHDQAgBEHpAk4NBAwBCyAEQeQASg0DQfwIKAIAQeQASg0DQYAJKAIAQeQASg0DCwJAIAFFDQAgAUECSg0AIARB/AgoAgBBgAkoAgAgAUECdEGICGooAgARAgAhBEHwCCgCACIBQcwIKAIAIgVPBH8gASAFcAUgAQtBAnRBkAlqIAQ2AgALQfAIKAIAIgFBzAgoAgAiBEkNACABIARwIQELIAFBAnRBkAlqKAIAIQMMAQsgAkH9AHFBIUcEQCAHIQEgAiEADAQLIARBI0cNBAJAQewIKAIAIgRBAUYEQEHwCCgCACIBQcwIKAIAIgBJDQEgASAAcCEBDAELQfgIKAIAIQFB9AgoAgAhAAJAAkAgBEEFRw0AIABBAUcNACABQekCSA0BDAcLIAFB5ABKDQZB/AgoAgBB5ABKDQZBgAkoAgBB5ABKDQYLAkAgAEUNACAAQQJKDQAgAUH8CCgCAEGACSgCACAAQQJ0QYgIaigCABECACEAQfAIKAIAIgFBzAgoAgAiBE8EfyABIARwBSABC0ECdEGQCWogADYCAAtB8AgoAgAiAUHMCCgCACIASQ0AIAEgAHAhAQsgAUECdEGQCWooAgAhAwwECyAHIQEgCAshBQNAIAFB//8ATQRAIABBAXEgAWxBAnRBoIkCaiADNgIAIABBAXZBAXEgAWxBAnRBsIkGaiADNgIAIABBAnZBAXEgAWxBAnRBwIkKaiADNgIAIABBA3ZBAXEgAWxBAnRB0IkOaiADNgIAIABBBHZBAXEgAWxBAnRB4IkSaiADNgIAIABBBXYgAWxBAnRB8IkWaiADNgIACyABQQFqIQEgBS0AACEAIAVBAWoiBCEFIABB/wBxIgJBP2siAEHAAEkNAAsgBCEFC0EAIQQgBSEIIAEhByACIQAgAkH9AHFBIUYNAQtBBCEHIAQhAiAAQSRrDgoDAgICAgICAgIBAgtB7AhCATcCAAwCC0GoCCgCAEEEaxAABEBB0AhBATYCAA8LAkBBqAgoAgAiBkEFSA0AQaAIKQMAIQogBkEDa0EBdiIBQQdxIQJBACEAIAFBAWtBB08EQCABQfj///8HcSEFA0AgAEEDdCIBQbCJAmogCjcDACABQQhyQbCJAmogCjcDACABQRByQbCJAmogCjcDACABQRhyQbCJAmogCjcDACABQSByQbCJAmogCjcDACABQShyQbCJAmogCjcDACABQTByQbCJAmogCjcDACABQThyQbCJAmogCjcDACAAQQhqIQAgBUEIayIFDQALCyACRQ0AA0AgAEEDdEGwiQJqIAo3AwAgAEEBaiEAIAJBAWsiAg0ACwtBwIkGQbCJAiAGQQJ0IgD8CgAAQdCJCkGwiQIgAPwKAABB4IkOQbCJAiAA/AoAAEHwiRJBsIkCIAD8CgAAQYCKFkGwiQIgAPwKAAAgBCECDAELAkAgAEE7Rw0AQewIKAIAIgBBB0oNAEHsCCAAQQFqNgIAIABBAnRB8AhqQQA2AgALIAEhBwsgCCAJSQ0ACwtB5AggAzYCAEHgCCACNgIAQegIIAc2AgAL4gcCBX8BfgJAQdAIAn8CQAJAIAAgAU4NACABQZCJAWohBiAAQZCJAWohBQNAIAUtAAAiA0H/AHEhAgJAAkACQAJAAkACQAJAQeAIKAIAIgRBIkcEQCAEDQcgAkEiRgRAQewIQgE3AgBB4AhBIjYCAAwICyACQT9rQcAASQ0GIANBIWsiAkEMTQ0BDAULAkAgAkEwayIEQQlNBEBB7AgoAgBBAnRB7AhqIgIgBCACKAIAQQpsajYCAAwBC0HsCCgCACEEIAJBO0YEQCAEQQdKDQFB7AggBEEBajYCACAEQQJ0QfAIakEANgIADAELIARBBEYEQEHECEECNgIAQbAIQfAIKQMANwMAQbgIQfgIKAIAIgI2AgBBvAhB/AgoAgAiBDYCAEHICEECQQFBwAgoAgAiAxs2AgBBrAggBEEAIAMbNgIAQagIIAJBgIABIAJBgIABSBtBBGpBACADGzYCAEHgCEEANgIADAoLIAJBP2tBwABJDQQLIANBIWsiAkEMTQ0BDAILQQEgAnRBjSBxRQ0DDAQLQQEgAnRBjSBxDQELIANBoQFrIgJBDEsNA0EBIAJ0QY0gcUUNAwtBxAhCgYCAgBA3AgBBsAhB8AgoAgBBAEHsCCgCACICQQBKGzYCAEG0CEH0CCgCAEEAIAJBAUobNgIAQbgIQfgIKAIAQQAgAkECShs2AgBB4AhBADYCAEG8CEEANgIADAQLIANBoQFrIgJBDEsNAUEBIAJ0QY0gcUUNAQtBxAhCgYCAgBA3AgBBsAhCADcDAEG4CEIANwMADAMLIAVBAWoiBSAGSQ0ACwsCQEHICCgCAA4DAwEAAQsCQEGoCCgCACIFQQVIDQBBoAgpAwAhByAFQQNrQQF2IgNBB3EhBEEAIQIgA0EBa0EHTwRAIANB+P///wdxIQYDQCACQQN0IgNBsIkCaiAHNwMAIANBCHJBsIkCaiAHNwMAIANBEHJBsIkCaiAHNwMAIANBGHJBsIkCaiAHNwMAIANBIHJBsIkCaiAHNwMAIANBKHJBsIkCaiAHNwMAIANBMHJBsIkCaiAHNwMAIANBOHJBsIkCaiAHNwMAIAJBCGohAiAGQQhrIgYNAAsLIARFDQADQCACQQN0QbCJAmogBzcDACACQQFqIQIgBEEBayIEDQALC0HAiQZBsIkCIAVBAnQiA/wKAABB0IkKQbCJAiAD/AoAAEHgiQ5BsIkCIAP8CgAAQfCJEkGwiQIgA/wKAABBgIoWQbCJAiAD/AoAAEECDAELEAhByAgoAgALEAEiAjYCACACDQAgACABQcgIKAIAQQJ0QYAIaigCABEBAAsLdABB6AhBBDYCAEHkCCAANgIAQewIQgE3AgBBxAhCADcCAEHACCADNgIAQdwIQgA3AgBBqAhCADcDAEGwCEIANwMAQbgIQgA3AwBBzAggAkGAICACQYAgSRs2AgBBoAggAa1CgYCAgBB+NwMAQdAIQQA2AgALIwBB0AgoAgBFBEAgACABQcgIKAIAQQJ0QYAIaigCABEBAAsLWgECfwJAAkACQEHICCgCAEEBaw4CAAECC0HYCEHoCCgCACIAQdgIKAIAIgEgACABShsiAEGAgAEgAEGAgAFIGyIANgIAIABBBGsPC0GoCCgCAEEEayEACyAAC0IBAX8Cf0EGQdwIKAIAIgBBIHENABpBBSAAQRBxDQAaQQQgAEEIcQ0AGkEDIABBBHENABpBAiAAQQFxIABBAnEbCwu9BQEFfQJ/IAJFBEAgAUH/AWxBMmpB5ABtIgBBCHQgAHIgAEEQdHIMAQsgArJDAADIQpUhBiAAQfABarJDAAC0Q5UhBQJ9IAGyQwAAyEKVIgNDAAAAP10EQCADIAZDAACAP5KUDAELIAYgA0MAAIA/IAaTlJILIQcgAyADkiEGAkAgBUOrqqo+kiIEQwAAAABdBEAgBEMAAIA/kiEEDAELIARDAACAP15FDQAgBEMAAIC/kiEECyAGIAeTIQMgBUMAAAAAXSEAAn8CfSADIAcgA5NDAADAQJQgBJSSIARDq6oqPl0NABogByAEQwAAAD9dDQAaIAMgBEOrqio/XUUNABogAyAHIAOTIARDAADAwJRDAACAQJKUkgtDAAB/Q5RDAAAAP5IiBkMAAIBPXSAGQwAAAABgcQRAIAapDAELQQALIQECQCAABEAgBUMAAIA/kiEEDAELIAUiBEMAAIA/XkUNACAFQwAAgL+SIQQLIAVDq6qqvpIiBUMAAAAAXSECAn8CfSADIAcgA5NDAADAQJQgBJSSIARDq6oqPl0NABogByAEQwAAAD9dDQAaIAMgBEOrqio/XUUNABogAyAHIAOTIARDAADAwJRDAACAQJKUkgtDAAB/Q5RDAAAAP5IiBkMAAIBPXSAGQwAAAABgcQRAIAapDAELQQALIQACQCACBEAgBUMAAIA/kiEFDAELIAVDAACAP15FDQAgBUMAAIC/kiEFCwJAIAVDq6oqPl0EQCADIAcgA5NDAADAQJQgBZSSIQcMAQsgBUMAAAA/XQ0AIAVDq6oqP11FBEAgAyEHDAELIAMgByADkyAFQwAAwMCUQwAAgECSlJIhBwsgAEEIdAJ/IAdDAAB/Q5RDAAAAP5IiBkMAAIBPXSAGQwAAAABgcQRAIAapDAELQQALQRB0ciABcgtBgICAeHILNwAgAEH/AWxBMmpB5ABtIAFB/wFsQTJqQeQAbUEIdHIgAkH/AWxBMmpB5ABtQRB0ckGAgIB4cgsEACMACwYAIAAkAAsQACMAIABrQXBxIgAkACAACwsYAQBBgAgLEQEAAAACAAAAAwAAAAQAAAAF"}}),q8=_o(e=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.decodeAsync=e.decode=e.Decoder=e.DecoderAsync=void 0;var t=df(),i=j8();function r(_){if(typeof Buffer<"u")return Buffer.from(_,"base64");let m=atob(_),v=new Uint8Array(m.length);for(let x=0;x<v.length;++x)v[x]=m.charCodeAt(x);return v}var s=r(i.LIMITS.BYTES),n,o=new Uint32Array,a=class{constructor(){this.bandHandler=_=>1,this.modeHandler=_=>1}handle_band(_){return this.bandHandler(_)}mode_parsed(_){return this.modeHandler(_)}},h={memoryLimit:2048*65536,sixelColor:t.DEFAULT_FOREGROUND,fillColor:t.DEFAULT_BACKGROUND,palette:t.PALETTE_VT340_COLOR,paletteLimit:i.LIMITS.PALETTE_SIZE,truncate:!0};function l(_){let m=new a,v={env:{handle_band:m.handle_band.bind(m),mode_parsed:m.mode_parsed.bind(m)}};return WebAssembly.instantiate(n||s,v).then(x=>(n=n||x.module,new c(_,x.instance||x,m)))}e.DecoderAsync=l;var c=class{constructor(_,m,v){if(this._PIXEL_OFFSET=i.LIMITS.MAX_WIDTH+4,this._canvas=o,this._bandWidths=[],this._maxWidth=0,this._minWidth=i.LIMITS.MAX_WIDTH,this._lastOffset=0,this._currentHeight=0,this._opts=Object.assign({},h,_),this._opts.paletteLimit>i.LIMITS.PALETTE_SIZE)throw new Error(`DecoderOptions.paletteLimit must not exceed ${i.LIMITS.PALETTE_SIZE}`);if(m)v.bandHandler=this._handle_band.bind(this),v.modeHandler=this._initCanvas.bind(this);else{let x=n||(n=new WebAssembly.Module(s));m=new WebAssembly.Instance(x,{env:{handle_band:this._handle_band.bind(this),mode_parsed:this._initCanvas.bind(this)}})}this._instance=m,this._wasm=this._instance.exports,this._chunk=new Uint8Array(this._wasm.memory.buffer,this._wasm.get_chunk_address(),i.LIMITS.CHUNK_SIZE),this._states=new Uint32Array(this._wasm.memory.buffer,this._wasm.get_state_address(),12),this._palette=new Uint32Array(this._wasm.memory.buffer,this._wasm.get_palette_address(),i.LIMITS.PALETTE_SIZE),this._palette.set(this._opts.palette),this._pSrc=new Uint32Array(this._wasm.memory.buffer,this._wasm.get_p0_address()),this._wasm.init(t.DEFAULT_FOREGROUND,0,this._opts.paletteLimit,0)}get _fillColor(){return this._states[0]}get _truncate(){return this._states[8]}get _rasterWidth(){return this._states[6]}get _rasterHeight(){return this._states[7]}get _width(){return this._states[2]?this._states[2]-4:0}get _height(){return this._states[3]}get _level(){return this._states[9]}get _mode(){return this._states[10]}get _paletteLimit(){return this._states[11]}_initCanvas(_){if(_===2){let m=this.width*this.height;if(m>this._canvas.length){if(this._opts.memoryLimit&&m*4>this._opts.memoryLimit)throw this.release(),new Error("image exceeds memory limit");this._canvas=new Uint32Array(m)}this._maxWidth=this._width}else if(_===1)if(this._level===2){let m=Math.min(this._rasterWidth,i.LIMITS.MAX_WIDTH)*this._rasterHeight;if(m>this._canvas.length){if(this._opts.memoryLimit&&m*4>this._opts.memoryLimit)throw this.release(),new Error("image exceeds memory limit");this._canvas=new Uint32Array(m)}}else this._canvas.length<65536&&(this._canvas=new Uint32Array(65536));return 0}_realloc(_,m){let v=_+m;if(v>this._canvas.length){if(this._opts.memoryLimit&&v*4>this._opts.memoryLimit)throw this.release(),new Error("image exceeds memory limit");let x=new Uint32Array(Math.ceil(v/65536)*65536);x.set(this._canvas),this._canvas=x}}_handle_band(_){let m=this._PIXEL_OFFSET,v=this._lastOffset;if(this._mode===2){let x=this.height-this._currentHeight,E=0;for(;E<6&&x>0;)this._canvas.set(this._pSrc.subarray(m*E,m*E+_),v+_*E),E++,x--;this._lastOffset+=_*E,this._currentHeight+=E}else if(this._mode===1){this._realloc(v,_*6),this._maxWidth=Math.max(this._maxWidth,_),this._minWidth=Math.min(this._minWidth,_);for(let x=0;x<6;++x)this._canvas.set(this._pSrc.subarray(m*x,m*x+_),v+_*x);this._bandWidths.push(_),this._lastOffset+=_*6,this._currentHeight+=6}return 0}get width(){return this._mode!==1?this._width:Math.max(this._maxWidth,this._wasm.current_width())}get height(){return this._mode!==1?this._height:this._wasm.current_width()?this._bandWidths.length*6+this._wasm.current_height():this._bandWidths.length*6}get palette(){return this._palette.subarray(0,this._paletteLimit)}get memoryUsage(){return this._canvas.byteLength+this._wasm.memory.buffer.byteLength+8*this._bandWidths.length}get properties(){return{width:this.width,height:this.height,mode:this._mode,level:this._level,truncate:!!this._truncate,paletteLimit:this._paletteLimit,fillColor:this._fillColor,memUsage:this.memoryUsage,rasterAttributes:{numerator:this._states[4],denominator:this._states[5],width:this._rasterWidth,height:this._rasterHeight}}}init(_=this._opts.fillColor,m=this._opts.palette,v=this._opts.paletteLimit,x=this._opts.truncate){this._wasm.init(this._opts.sixelColor,_,v,x?1:0),m&&this._palette.set(m.subarray(0,i.LIMITS.PALETTE_SIZE)),this._bandWidths.length=0,this._maxWidth=0,this._minWidth=i.LIMITS.MAX_WIDTH,this._lastOffset=0,this._currentHeight=0}decode(_,m=0,v=_.length){let x=m;for(;x<v;){let E=Math.min(v-x,i.LIMITS.CHUNK_SIZE);this._chunk.set(_.subarray(x,x+=E)),this._wasm.decode(0,E)}}decodeString(_,m=0,v=_.length){let x=m;for(;x<v;){let E=Math.min(v-x,i.LIMITS.CHUNK_SIZE);for(let M=0,D=x;M<E;++M,++D)this._chunk[M]=_.charCodeAt(D);x+=E,this._wasm.decode(0,E)}}get data32(){if(this._mode===0||!this.width||!this.height)return o;let _=this._wasm.current_width();if(this._mode===2){let m=this.height-this._currentHeight;if(m>0){let v=this._PIXEL_OFFSET,x=this._lastOffset,E=0;for(;E<6&&m>0;)this._canvas.set(this._pSrc.subarray(v*E,v*E+_),x+_*E),E++,m--;m&&this._canvas.fill(this._fillColor,x+_*E)}return this._canvas.subarray(0,this.width*this.height)}if(this._mode===1){if(this._minWidth===this._maxWidth){let E=!1;if(_)if(_!==this._minWidth)E=!0;else{let M=this._PIXEL_OFFSET,D=this._lastOffset;this._realloc(D,_*6);for(let b=0;b<6;++b)this._canvas.set(this._pSrc.subarray(M*b,M*b+_),D+_*b)}if(!E)return this._canvas.subarray(0,this.width*this.height)}let m=new Uint32Array(this.width*this.height);m.fill(this._fillColor);let v=0,x=0;for(let E=0;E<this._bandWidths.length;++E){let M=this._bandWidths[E];for(let D=0;D<6;++D)m.set(this._canvas.subarray(x,x+=M),v),v+=this.width}if(_){let E=this._PIXEL_OFFSET,M=this._wasm.current_height();for(let D=0;D<M;++D)m.set(this._pSrc.subarray(E*D,E*D+_),v+this.width*D)}return m}return o}get data8(){return new Uint8ClampedArray(this.data32.buffer,0,this.width*this.height*4)}release(){this._canvas=o,this._bandWidths.length=0,this._maxWidth=0,this._minWidth=i.LIMITS.MAX_WIDTH,this._wasm.init(t.DEFAULT_FOREGROUND,0,this._opts.paletteLimit,0)}};e.Decoder=c;function u(_,m){let v=new c(m);return v.init(),typeof _=="string"?v.decodeString(_):v.decode(_),{width:v.width,height:v.height,data32:v.data32,data8:v.data8}}e.decode=u;async function g(_,m){let v=await l(m);return v.init(),typeof _=="string"?v.decodeString(_):v.decode(_),{width:v.width,height:v.height,data32:v.data32,data8:v.data8}}e.decodeAsync=g}),bb=Xl(df()),V8=class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(e){setTimeout(()=>{throw e.stack?wb.isErrorNoTelemetry(e)?new wb(e.message+`

`+e.stack):new Error(e.message+`

`+e.stack):e},0)}}addListener(e){return this.listeners.push(e),()=>{this._removeListener(e)}}emit(e){this.listeners.forEach(t=>{t(e)})}_removeListener(e){this.listeners.splice(this.listeners.indexOf(e),1)}setUnexpectedErrorHandler(e){this.unexpectedErrorHandler=e}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(e){this.unexpectedErrorHandler(e),this.emit(e)}onUnexpectedExternalError(e){this.unexpectedErrorHandler(e)}},xP=new V8,wb=class lf extends Error{constructor(t){super(t),this.name="CodeExpectedError"}static fromError(t){if(t instanceof lf)return t;let i=new lf;return i.message=t.message,i.stack=t.stack,i}static isErrorNoTelemetry(t){return t.name==="CodeExpectedError"}};function Y8(e,t,i=0,r=e.length){let s=i,n=r;for(;s<n;){let o=Math.floor((s+n)/2);t(e[o])?s=o+1:n=o}return s-1}var J8=class Ib{constructor(t){this._array=t,this._findLastMonotonousLastIdx=0}findLastMonotonous(t){if(Ib.assertInvariants){if(this._prevFindLastPredicate){for(let r of this._array)if(this._prevFindLastPredicate(r)&&!t(r))throw new Error("MonotonousArray: current predicate must be weaker than (or equal to) the previous predicate.")}this._prevFindLastPredicate=t}let i=Y8(this._array,t,this._findLastMonotonousLastIdx);return this._findLastMonotonousLastIdx=i+1,i===-1?void 0:this._array[i]}};J8.assertInvariants=!1;var Mb;(e=>{function t(n){return n<0}e.isLessThan=t;function i(n){return n<=0}e.isLessThanOrEqual=i;function r(n){return n>0}e.isGreaterThan=r;function s(n){return n===0}e.isNeitherLessOrGreaterThan=s,e.greaterThan=1,e.lessThan=-1,e.neitherLessOrGreaterThan=0})(Mb||={});function Z8(e,t){return(i,r)=>t(e(i),e(r))}var e4=(e,t)=>e-t,Ab=class hf{constructor(t){this.iterate=t}forEach(t){this.iterate(i=>(t(i),!0))}toArray(){let t=[];return this.iterate(i=>(t.push(i),!0)),t}filter(t){return new hf(i=>this.iterate(r=>t(r)?i(r):!0))}map(t){return new hf(i=>this.iterate(r=>i(t(r))))}some(t){let i=!1;return this.iterate(r=>(i=t(r),!i)),i}findFirst(t){let i;return this.iterate(r=>t(r)?(i=r,!1):!0),i}findLast(t){let i;return this.iterate(r=>(t(r)&&(i=r),!0)),i}findLastMaxBy(t){let i,r=!0;return this.iterate(s=>((r||Mb.isGreaterThan(t(s,i)))&&(r=!1,i=s),!0)),i}};Ab.empty=new Ab(e=>{});function t4(e,t){let i=Object.create(null);for(let r of e){let s=t(r),n=i[s];n||(n=i[s]=[]),n.push(r)}return i}var xb,Sb,SP=class{constructor(e,t){this.toKey=t,this._map=new Map,this[xb]="SetWithKey";for(let i of e)this.add(i)}get size(){return this._map.size}add(e){let t=this.toKey(e);return this._map.set(t,e),this}delete(e){return this._map.delete(this.toKey(e))}has(e){return this._map.has(this.toKey(e))}*entries(){for(let e of this._map.values())yield[e,e]}keys(){return this.values()}*values(){for(let e of this._map.values())yield e}clear(){this._map.clear()}forEach(e,t){this._map.forEach(i=>e.call(t,i,i,this))}[(Sb=Symbol.iterator,xb=Symbol.toStringTag,Sb)](){return this.values()}},i4=class{constructor(){this.map=new Map}add(e,t){let i=this.map.get(e);i||(i=new Set,this.map.set(e,i)),i.add(t)}delete(e,t){let i=this.map.get(e);i&&(i.delete(t),i.size===0&&this.map.delete(e))}forEach(e,t){let i=this.map.get(e);i&&i.forEach(t)}get(e){return this.map.get(e)||new Set}};function r4(e,t){let i=this,r=!1,s;return function(){if(r)return s;if(r=!0,t)try{s=e.apply(i,arguments)}finally{t()}else s=e.apply(i,arguments);return s}}var Tb;(e=>{function t(b){return b&&typeof b=="object"&&typeof b[Symbol.iterator]=="function"}e.is=t;let i=Object.freeze([]);function r(){return i}e.empty=r;function*s(b){yield b}e.single=s;function n(b){return t(b)?b:s(b)}e.wrap=n;function o(b){return b||i}e.from=o;function*a(b){for(let L=b.length-1;L>=0;L--)yield b[L]}e.reverse=a;function h(b){return!b||b[Symbol.iterator]().next().done===!0}e.isEmpty=h;function l(b){return b[Symbol.iterator]().next().value}e.first=l;function c(b,L){let I=0;for(let R of b)if(L(R,I++))return!0;return!1}e.some=c;function u(b,L){for(let I of b)if(L(I))return I}e.find=u;function*g(b,L){for(let I of b)L(I)&&(yield I)}e.filter=g;function*_(b,L){let I=0;for(let R of b)yield L(R,I++)}e.map=_;function*m(b,L){let I=0;for(let R of b)yield*L(R,I++)}e.flatMap=m;function*v(...b){for(let L of b)yield*L}e.concat=v;function x(b,L,I){let R=I;for(let G of b)R=L(R,G);return R}e.reduce=x;function*E(b,L,I=b.length){for(L<0&&(L+=b.length),I<0?I+=b.length:I>b.length&&(I=b.length);L<I;L++)yield b[L]}e.slice=E;function M(b,L=Number.POSITIVE_INFINITY){let I=[];if(L===0)return[I,b];let R=b[Symbol.iterator]();for(let G=0;G<L;G++){let W=R.next();if(W.done)return[I,e.empty()];I.push(W.value)}return[I,{[Symbol.iterator](){return R}}]}e.consume=M;async function D(b){let L=[];for await(let I of b)L.push(I);return Promise.resolve(L)}e.asyncToArray=D})(Tb||={});var s4=!1,Ul=null,n4=class Rb{constructor(){this.livingDisposables=new Map}getDisposableData(t){let i=this.livingDisposables.get(t);return i||(i={parent:null,source:null,isSingleton:!1,value:t,idx:Rb.idx++},this.livingDisposables.set(t,i)),i}trackDisposable(t){let i=this.getDisposableData(t);i.source||(i.source=new Error().stack)}setParent(t,i){let r=this.getDisposableData(t);r.parent=i}markAsDisposed(t){this.livingDisposables.delete(t)}markAsSingleton(t){this.getDisposableData(t).isSingleton=!0}getRootParent(t,i){let r=i.get(t);if(r)return r;let s=t.parent?this.getRootParent(this.getDisposableData(t.parent),i):t;return i.set(t,s),s}getTrackedDisposables(){let t=new Map;return[...this.livingDisposables.entries()].filter(([,i])=>i.source!==null&&!this.getRootParent(i,t).isSingleton).flatMap(([i])=>i)}computeLeakingDisposables(t=10,i){let r;if(i)r=i;else{let h=new Map,l=[...this.livingDisposables.values()].filter(u=>u.source!==null&&!this.getRootParent(u,h).isSingleton);if(l.length===0)return;let c=new Set(l.map(u=>u.value));if(r=l.filter(u=>!(u.parent&&c.has(u.parent))),r.length===0)throw new Error("There are cyclic diposable chains!")}if(!r)return;function s(h){function l(u,g){for(;u.length>0&&g.some(_=>typeof _=="string"?_===u[0]:u[0].match(_));)u.shift()}let c=h.source.split(`
`).map(u=>u.trim().replace("at ","")).filter(u=>u!=="");return l(c,["Error",/^trackDisposable \(.*\)$/,/^DisposableTracker.trackDisposable \(.*\)$/]),c.reverse()}let n=new i4;for(let h of r){let l=s(h);for(let c=0;c<=l.length;c++)n.add(l.slice(0,c).join(`
`),h)}r.sort(Z8(h=>h.idx,e4));let o="",a=0;for(let h of r.slice(0,t)){a++;let l=s(h),c=[];for(let u=0;u<l.length;u++){let g=l[u];g=`(shared with ${n.get(l.slice(0,u+1).join(`
`)).size}/${r.length} leaks) at ${g}`;let _=n.get(l.slice(0,u).join(`
`)),m=t4([..._].map(v=>s(v)[u]),v=>v);delete m[l[u]];for(let[v,x]of Object.entries(m))c.unshift(`    - stacktraces of ${x.length} other leaks continue with ${v}`);c.unshift(g)}o+=`


==================== Leaking disposable ${a}/${r.length}: ${h.value.constructor.name} ====================
${c.join(`
`)}
============================================================

`}return r.length>t&&(o+=`


... and ${r.length-t} more leaking disposables

`),{leaks:r,details:o}}};n4.idx=0;function o4(e){Ul=e}if(s4){let e="__is_disposable_tracked__";o4(new class{trackDisposable(t){let i=new Error("Potentially leaked disposable").stack;setTimeout(()=>{t[e]||console.log(i)},3e3)}setParent(t,i){if(t&&t!==Nl.None)try{t[e]=!0}catch{}}markAsDisposed(t){if(t&&t!==Nl.None)try{t[e]=!0}catch{}}markAsSingleton(t){}})}function zl(e){return Ul?.trackDisposable(e),e}function Wl(e){Ul?.markAsDisposed(e)}function co(e,t){Ul?.setParent(e,t)}function a4(e){if(Tb.is(e)){let t=[];for(let i of e)if(i)try{i.dispose()}catch(r){t.push(r)}if(t.length===1)throw t[0];if(t.length>1)throw new AggregateError(t,"Encountered errors while disposing of store");return Array.isArray(e)?[]:e}else if(e)return e.dispose(),e}function l4(e){let t=zl({dispose:r4(()=>{Wl(t),e()})});return t}var Fb=class Pb{constructor(){this._toDispose=new Set,this._isDisposed=!1,zl(this)}dispose(){this._isDisposed||(Wl(this),this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{a4(this._toDispose)}finally{this._toDispose.clear()}}add(t){if(!t)return t;if(t===this)throw new Error("Cannot register a disposable on itself!");return co(t,this),this._isDisposed?Pb.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(t),t}delete(t){if(t){if(t===this)throw new Error("Cannot dispose a disposable on itself!");this._toDispose.delete(t),t.dispose()}}deleteAndLeak(t){t&&this._toDispose.has(t)&&(this._toDispose.delete(t),co(t,null))}};Fb.DISABLE_DISPOSED_WARNING=!1;var h4=Fb,Nl=class{constructor(){this._store=new h4,zl(this),co(this._store,this)}dispose(){Wl(this),this._store.dispose()}_register(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}};Nl.None=Object.freeze({dispose(){}});var c4=class{constructor(){this._isDisposed=!1,zl(this)}get value(){return this._isDisposed?void 0:this._value}set value(e){this._isDisposed||e===this._value||(this._value?.dispose(),e&&co(e,this),this._value=e)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,Wl(this),this._value?.dispose(),this._value=void 0}clearAndLeak(){let e=this._value;return this._value=void 0,e&&co(e,null),e}},u4=4096,sf=24,$l=class Er extends Nl{constructor(t){super(),this._terminal=t,this._optionsRefresh=this._register(new c4),this._oldOpen=this._terminal._core.open,this._terminal._core.open=i=>{this._oldOpen?.call(this._terminal._core,i),this._open()},this._terminal._core.screenElement&&this._open(),this._optionsRefresh.value=this._terminal._core.optionsService.onOptionChange(i=>{i==="fontSize"&&(this.rescaleCanvas(),this._renderService?.refreshRows(0,this._terminal.rows))}),this._register(l4(()=>{this.removeLayerFromDom(),this._terminal._core&&this._oldOpen&&(this._terminal._core.open=this._oldOpen,this._oldOpen=void 0),this._renderService&&this._oldSetRenderer&&(this._renderService.setRenderer=this._oldSetRenderer,this._oldSetRenderer=void 0),this._renderService=void 0,this.canvas=void 0,this._ctx=void 0,this._placeholderBitmap?.close(),this._placeholderBitmap=void 0,this._placeholder=void 0}))}static createCanvas(t,i,r){let s=(t||document).createElement("canvas");return s.width=i|0,s.height=r|0,s}static createImageData(t,i,r,s){if(typeof ImageData!="function"){let n=t.createImageData(i,r);return s&&n.data.set(new Uint8ClampedArray(s,0,i*r*4)),n}return s?new ImageData(new Uint8ClampedArray(s,0,i*r*4),i,r):new ImageData(i,r)}static createImageBitmap(t){return typeof createImageBitmap!="function"?Promise.resolve(void 0):createImageBitmap(t)}showPlaceholder(t){t?!this._placeholder&&this.cellSize.height!==-1&&this._createPlaceHolder(Math.max(this.cellSize.height+1,sf)):(this._placeholderBitmap?.close(),this._placeholderBitmap=void 0,this._placeholder=void 0),this._renderService?.refreshRows(0,this._terminal.rows)}get dimensions(){return this._renderService?.dimensions}get cellSize(){return{width:this.dimensions?.css.cell.width||-1,height:this.dimensions?.css.cell.height||-1}}clearLines(t,i){this._ctx?.clearRect(0,t*(this.dimensions?.css.cell.height||0),this.dimensions?.css.canvas.width||0,(++i-t)*(this.dimensions?.css.cell.height||0))}clearAll(){this._ctx?.clearRect(0,0,this.canvas?.width||0,this.canvas?.height||0)}draw(t,i,r,s,n=1){if(!this._ctx)return;let{width:o,height:a}=this.cellSize;if(o===-1||a===-1)return;this._rescaleImage(t,o,a);let h=t.actual,l=Math.ceil(h.width/o),c=i%l*o,u=Math.floor(i/l)*a,g=r*o,_=s*a,m=n*o+c>h.width?h.width-c:n*o,v=u+a>h.height?h.height-u:a;this._ctx.drawImage(h,Math.floor(c),Math.floor(u),Math.ceil(m),Math.ceil(v),Math.floor(g),Math.floor(_),Math.ceil(m),Math.ceil(v))}extractTile(t,i){let{width:r,height:s}=this.cellSize;if(r===-1||s===-1)return;this._rescaleImage(t,r,s);let n=t.actual,o=Math.ceil(n.width/r),a=i%o*r,h=Math.floor(i/o)*s,l=r+a>n.width?n.width-a:r,c=h+s>n.height?n.height-h:s,u=Er.createCanvas(this.document,l,c),g=u.getContext("2d");if(g)return g.drawImage(n,Math.floor(a),Math.floor(h),Math.floor(l),Math.floor(c),0,0,Math.floor(l),Math.floor(c)),u}drawPlaceholder(t,i,r=1){if(this._ctx){let{width:s,height:n}=this.cellSize;if(s===-1||n===-1||(this._placeholder?n>=this._placeholder.height&&this._createPlaceHolder(n+1):this._createPlaceHolder(Math.max(n+1,sf)),!this._placeholder))return;this._ctx.drawImage(this._placeholderBitmap||this._placeholder,t*s,i*n%2?0:1,s*r,n,t*s,i*n,s*r,n)}}rescaleCanvas(){this.canvas&&(this.canvas.width!==this.dimensions.css.canvas.width||this.canvas.height!==this.dimensions.css.canvas.height)&&(this.canvas.width=this.dimensions.css.canvas.width||0,this.canvas.height=this.dimensions.css.canvas.height||0)}_rescaleImage(t,i,r){if(i===t.actualCellSize.width&&r===t.actualCellSize.height)return;let{width:s,height:n}=t.origCellSize;if(i===s&&r===n){t.actual=t.orig,t.actualCellSize.width=s,t.actualCellSize.height=n;return}let o=Er.createCanvas(this.document,Math.ceil(t.orig.width*i/s),Math.ceil(t.orig.height*r/n)),a=o.getContext("2d");a&&(a.drawImage(t.orig,0,0,o.width,o.height),t.actual=o,t.actualCellSize.width=i,t.actualCellSize.height=r)}_open(){this._renderService=this._terminal._core._renderService,this._oldSetRenderer=this._renderService.setRenderer.bind(this._renderService),this._renderService.setRenderer=t=>{this.removeLayerFromDom(),this._oldSetRenderer?.call(this._renderService,t)}}insertLayerToDom(){this.document&&this._terminal._core.screenElement?this.canvas||(this.canvas=Er.createCanvas(this.document,this.dimensions?.css.canvas.width||0,this.dimensions?.css.canvas.height||0),this.canvas.classList.add("xterm-image-layer"),this._terminal._core.screenElement.appendChild(this.canvas),this._ctx=this.canvas.getContext("2d",{alpha:!0,desynchronized:!0}),this.clearAll()):console.warn("image addon: cannot insert output canvas to DOM, missing document or screenElement")}removeLayerFromDom(){this.canvas&&(this._ctx=void 0,this.canvas.remove(),this.canvas=void 0)}_createPlaceHolder(t=sf){this._placeholderBitmap?.close(),this._placeholderBitmap=void 0;let i=32,r=Er.createCanvas(this.document,i,t),s=r.getContext("2d",{alpha:!1});if(!s)return;let n=Er.createImageData(s,i,t),o=new Uint32Array(n.data.buffer),a=(0,bb.toRGBA8888)(0,0,0),h=(0,bb.toRGBA8888)(255,255,255);o.fill(a);for(let u=0;u<t;++u){let g=u%2,_=u*i;for(let m=0;m<i;m+=2)o[_+m+g]=h}s.putImageData(n,0,0);let l=screen.width+i-1&~(i-1)||u4;this._placeholder=Er.createCanvas(this.document,l,t);let c=this._placeholder.getContext("2d",{alpha:!1});if(!c){this._placeholder=void 0;return}for(let u=0;u<l;u+=i)c.drawImage(r,u,0);Er.createImageBitmap(this._placeholder).then(u=>this._placeholderBitmap=u)}get document(){return this._terminal._core._coreBrowserService?.window.document}},uo={width:7,height:14},cf=class Ob{constructor(t=0,i=0,r=-1,s=-1){this.imageId=r,this.tileId=s,this._ext=0,this._urlId=0,this._ext=t,this._urlId=i}get ext(){return this._urlId?this._ext&-469762049|this.underlineStyle<<26:this._ext}set ext(t){this._ext=t}get underlineStyle(){return this._urlId?5:(this._ext&469762048)>>26}set underlineStyle(t){this._ext&=-469762049,this._ext|=t<<26&469762048}get underlineColor(){return this._ext&67108863}set underlineColor(t){this._ext&=-67108864,this._ext|=t&67108863}get underlineVariantOffset(){let t=(this._ext&3758096384)>>29;return t<0?t^4294967288:t}set underlineVariantOffset(t){this._ext&=536870911,this._ext|=t<<29&3758096384}get urlId(){return this._urlId}set urlId(t){this._urlId=t}clone(){return new Ob(this._ext,this._urlId,this.imageId,this.tileId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0&&this.imageId===-1}},ho=new cf,d4=class{constructor(e,t,i){this._terminal=e,this._renderer=t,this._opts=i,this._images=new Map,this._lastId=0,this._lowestId=0,this._fullyCleared=!1,this._needsFullClear=!1,this._pixelLimit=25e5;try{this.setLimit(this._opts.storageLimit)}catch(r){console.error(r.message),console.warn(`storageLimit is set to ${this.getLimit()} MB`)}this._viewportMetrics={cols:this._terminal.cols,rows:this._terminal.rows}}dispose(){this.reset()}reset(){for(let e of this._images.values())e.marker?.dispose();this._images.clear(),this._renderer.clearAll()}getLimit(){return this._pixelLimit*4/1e6}setLimit(e){if(e<.5||e>1e3)throw RangeError("invalid storageLimit, should be at least 0.5 MB and not exceed 1G");this._pixelLimit=e/4*1e6>>>0,this._evictOldest(0)}getUsage(){return this._getStoredPixels()*4/1e6}_getStoredPixels(){let e=0;for(let t of this._images.values())t.orig&&(e+=t.orig.width*t.orig.height,t.actual&&t.actual!==t.orig&&(e+=t.actual.width*t.actual.height));return e}_delImg(e){let t=this._images.get(e);this._images.delete(e),t&&window.ImageBitmap&&t.orig instanceof ImageBitmap&&t.orig.close()}wipeAlternate(){let e=[];for(let[t,i]of this._images.entries())i.bufferType==="alternate"&&(i.marker?.dispose(),e.push(t));for(let t of e)this._delImg(t);this._needsFullClear=!0,this._fullyCleared=!1}advanceCursor(e){if(this._opts.sixelScrolling){let t=this._renderer.cellSize;(t.width===-1||t.height===-1)&&(t=uo);let i=Math.ceil(e/t.height);for(let r=1;r<i;++r)this._terminal._core._inputHandler.lineFeed()}}addImage(e){this._evictOldest(e.width*e.height);let t=this._renderer.cellSize;(t.width===-1||t.height===-1)&&(t=uo);let i=Math.ceil(e.width/t.width),r=Math.ceil(e.height/t.height),s=++this._lastId,n=this._terminal._core.buffer,o=this._terminal.cols,a=this._terminal.rows,h=n.x,l=n.y,c=h,u=0;this._opts.sixelScrolling||(n.x=0,n.y=0,c=0),this._terminal._core._inputHandler._dirtyRowTracker.markDirty(n.y);for(let v=0;v<r;++v){let x=n.lines.get(n.y+n.ybase);for(let E=0;E<i&&!(c+E>=o);++E)this._writeToCell(x,c+E,s,v*i+E),u++;if(this._opts.sixelScrolling)v<r-1&&this._terminal._core._inputHandler.lineFeed();else if(++n.y>=a)break;n.x=c}this._terminal._core._inputHandler._dirtyRowTracker.markDirty(n.y),this._opts.sixelScrolling?n.x=c:(n.x=h,n.y=l);let g=[];for(let[v,x]of this._images.entries())x.tileCount<1&&(x.marker?.dispose(),g.push(v));for(let v of g)this._delImg(v);let _=this._terminal.registerMarker(0);_?.onDispose(()=>{this._images.get(s)&&this._delImg(s)}),this._terminal.buffer.active.type==="alternate"&&this._evictOnAlternate();let m={orig:e,origCellSize:t,actual:e,actualCellSize:{...t},marker:_||void 0,tileCount:u,bufferType:this._terminal.buffer.active.type};this._images.set(s,m)}render(e){if(!this._renderer.canvas&&this._images.size&&(this._renderer.insertLayerToDom(),!this._renderer.canvas))return;if(this._renderer.rescaleCanvas(),!this._images.size){this._fullyCleared||(this._renderer.clearAll(),this._fullyCleared=!0,this._needsFullClear=!1),this._renderer.canvas&&this._renderer.removeLayerFromDom();return}this._needsFullClear&&(this._renderer.clearAll(),this._fullyCleared=!0,this._needsFullClear=!1);let{start:t,end:i}=e,r=this._terminal._core.buffer,s=this._terminal._core.cols;this._renderer.clearLines(t,i);for(let n=t;n<=i;++n){let o=r.lines.get(n+r.ydisp);if(!o)return;for(let a=0;a<s;++a)if(o.getBg(a)&268435456){let h=o._extendedAttrs[a]||ho,l=h.imageId;if(l===void 0||l===-1)continue;let c=this._images.get(l);if(h.tileId!==-1){let u=h.tileId,g=a,_=1;for(;++a<s&&o.getBg(a)&268435456&&(h=o._extendedAttrs[a]||ho)&&h.imageId===l&&h.tileId===u+_;)_++;a--,c?c.actual&&this._renderer.draw(c,u,g,n,_):this._opts.showPlaceholder&&this._renderer.drawPlaceholder(g,n,_),this._fullyCleared=!1}}}}viewportResize(e){if(!this._images.size){this._viewportMetrics=e;return}if(this._viewportMetrics.cols>=e.cols){this._viewportMetrics=e;return}let t=this._terminal._core.buffer,i=t.lines.length,r=this._viewportMetrics.cols-1;for(let s=0;s<i;++s){let n=t.lines.get(s);if(n.getBg(r)&268435456){let o=n._extendedAttrs[r]||ho,a=o.imageId;if(a===void 0||a===-1)continue;let h=this._images.get(a);if(!h)continue;let l=Math.ceil((h.actual?.width||0)/h.actualCellSize.width);if(o.tileId%l+1>=l)continue;let c=!1;for(let _=r+1;_>e.cols;++_)if(n._data[_*3+0]&4194303){c=!0;break}if(c)continue;let u=Math.min(e.cols,l-o.tileId%l+r),g=o.tileId;for(let _=r+1;_<u;++_)this._writeToCell(n,_,a,++g),h.tileCount++}}this._viewportMetrics=e}getImageAtBufferCell(e,t){let i=this._terminal._core.buffer.lines.get(t);if(i&&i.getBg(e)&268435456){let r=i._extendedAttrs[e]||ho;if(r.imageId&&r.imageId!==-1){let s=this._images.get(r.imageId)?.orig;if(window.ImageBitmap&&s instanceof ImageBitmap){let n=$l.createCanvas(window.document,s.width,s.height);return n.getContext("2d")?.drawImage(s,0,0,s.width,s.height),n}return s}}}extractTileAtBufferCell(e,t){let i=this._terminal._core.buffer.lines.get(t);if(i&&i.getBg(e)&268435456){let r=i._extendedAttrs[e]||ho;if(r.imageId&&r.imageId!==-1&&r.tileId!==-1){let s=this._images.get(r.imageId);if(s)return this._renderer.extractTile(s,r.tileId)}}}_evictOldest(e){let t=this._getStoredPixels(),i=t;for(;this._pixelLimit<i+e&&this._images.size;){let r=this._images.get(++this._lowestId);r&&r.orig&&(i-=r.orig.width*r.orig.height,r.actual&&r.orig!==r.actual&&(i-=r.actual.width*r.actual.height),r.marker?.dispose(),this._delImg(this._lowestId))}return t-i}_writeToCell(e,t,i,r){if(e._data[t*3+2]&268435456){let s=e._extendedAttrs[t];if(s){if(s.imageId!==void 0){let n=this._images.get(s.imageId);n&&n.tileCount--,s.imageId=i,s.tileId=r;return}e._extendedAttrs[t]=new cf(s.ext,s.urlId,i,r);return}}e._data[t*3+2]|=268435456,e._extendedAttrs[t]=new cf(0,0,i,r)}_evictOnAlternate(){for(let i of this._images.values())i.bufferType==="alternate"&&(i.tileCount=0);let e=this._terminal._core.buffer;for(let i=0;i<this._terminal.rows;++i){let r=e.lines.get(i);if(r){for(let s=0;s<this._terminal.cols;++s)if(r._data[s*3+2]&268435456){let n=r._extendedAttrs[s]?.imageId;if(n){let o=this._images.get(n);o&&o.tileCount++}}}}let t=[];for(let[i,r]of this._images.entries())r.bufferType==="alternate"&&!r.tileCount&&(r.marker?.dispose(),t.push(i));for(let i of t)this._delImg(i)}},f4=Xl(G8());function Ql(e){let t="";for(let i=0;i<e.length;++i)t+=String.fromCharCode(e[i]);return t}function nf(e){let t=0;for(let i=0;i<e.length;++i){if(e[i]<48||e[i]>57)throw new Error("illegal char");t=t*10+e[i]-48}return t}function Cb(e){let t=Ql(e);if(!t.match(/^((auto)|(\d+?((px)|(%)){0,1}))$/))throw new Error("illegal size");return t}function _4(e){if(typeof Buffer<"u")return Buffer.from(Ql(e),"base64").toString();let t=atob(Ql(e)),i=new Uint8Array(t.length);for(let r=0;r<i.length;++r)i[r]=t.charCodeAt(r);return new TextDecoder().decode(i)}var kb={inline:nf,size:nf,name:_4,width:Cb,height:Cb,preserveAspectRatio:nf},Eb=[70,105,108,101],of=1024,p4=class{constructor(){this.state=0,this._buffer=new Uint32Array(of),this._position=0,this._key="",this.fields={}}reset(){this._buffer.fill(0),this.state=0,this._position=0,this.fields={},this._key=""}parse(e,t,i){let r=this.state,s=this._position,n=this._buffer;if(r===1||r===4||r===0&&s>6)return-1;for(let o=t;o<i;++o){let a=e[o];switch(a){case 59:if(!this._storeValue(s))return this._a();r=2,s=0;break;case 61:if(r===0){for(let h=0;h<Eb.length;++h)if(n[h]!==Eb[h])return this._a();r=2,s=0}else if(r===2){if(!this._storeKey(s))return this._a();r=3,s=0}else if(r===3){if(s>=of)return this._a();n[s++]=a}break;case 58:return r===3&&!this._storeValue(s)?this._a():(this.state=4,o+1);default:if(s>=of)return this._a();n[s++]=a}}return this.state=r,this._position=s,-2}_a(){return this.state=1,-1}_storeKey(e){let t=Ql(this._buffer.subarray(0,e));return t?(this._key=t,this.fields[t]=null,!0):!1}_storeValue(e){if(this._key){try{let t=this._buffer.slice(0,e);this.fields[this._key]=kb[this._key]?kb[this._key](t):t}catch{return!1}return!0}return!1}},Hl={mime:"unsupported",width:0,height:0};function g4(e){if(e.length<24)return Hl;let t=new Uint32Array(e.buffer,e.byteOffset,6);if(t[0]===1196314761&&t[1]===169478669&&t[3]===1380206665)return{mime:"image/png",width:e[16]<<24|e[17]<<16|e[18]<<8|e[19],height:e[20]<<24|e[21]<<16|e[22]<<8|e[23]};if(e[0]===255&&e[1]===216&&e[2]===255){let[i,r]=m4(e);return{mime:"image/jpeg",width:i,height:r}}return t[0]===944130375&&(e[4]===55||e[4]===57)&&e[5]===97?{mime:"image/gif",width:e[7]<<8|e[6],height:e[9]<<8|e[8]}:Hl}function m4(e){let t=e.length,i=4,r=e[i]<<8|e[i+1];for(;;){if(i+=r,i>=t)return[0,0];if(e[i]!==255)return[0,0];if(e[i+1]===192||e[i+1]===194)return i+8<t?[e[i+7]<<8|e[i+8],e[i+5]<<8|e[i+6]]:[0,0];i+=2,r=e[i]<<8|e[i+1]}}var v4=4194304,af={name:"Unnamed file",size:0,width:"auto",height:"auto",preserveAspectRatio:1,inline:0},y4=class{constructor(e,t,i,r){this._opts=e,this._renderer=t,this._storage=i,this._coreTerminal=r,this._aborted=!1,this._hp=new p4,this._header=af,this._dec=new f4.default(v4),this._metrics=Hl}reset(){}start(){this._aborted=!1,this._header=af,this._metrics=Hl,this._hp.reset()}put(e,t,i){if(!this._aborted)if(this._hp.state===4)this._dec.put(e,t,i)&&(this._dec.release(),this._aborted=!0);else{let r=this._hp.parse(e,t,i);if(r===-1){this._aborted=!0;return}if(r>0){if(this._header=Object.assign({},af,this._hp.fields),!this._header.inline||!this._header.size||this._header.size>this._opts.iipSizeLimit){this._aborted=!0;return}this._dec.init(this._header.size),this._dec.put(e,r,i)&&(this._dec.release(),this._aborted=!0)}}}end(e){if(this._aborted)return!0;let t=0,i=0,r=!0;if((r=e)&&(r=!this._dec.end())&&(this._metrics=g4(this._dec.data8),(r=this._metrics.mime!=="unsupported")&&(t=this._metrics.width,i=this._metrics.height,(r=t&&i&&t*i<this._opts.pixelLimit)&&([t,i]=this._resize(t,i).map(Math.floor),r=t&&i&&t*i<this._opts.pixelLimit))),!r)return this._dec.release(),!0;let s=new Blob([this._dec.data8],{type:this._metrics.mime});if(this._dec.release(),!window.createImageBitmap){let n=URL.createObjectURL(s),o=new Image;return new Promise(a=>{o.addEventListener("load",()=>{URL.revokeObjectURL(n);let h=$l.createCanvas(window.document,t,i);h.getContext("2d")?.drawImage(o,0,0,t,i),this._storage.addImage(h),a(!0)}),o.src=n,setTimeout(()=>a(!0),1e3)})}return createImageBitmap(s,{resizeWidth:t,resizeHeight:i}).then(n=>(this._storage.addImage(n),!0))}_resize(e,t){let i=this._renderer.dimensions?.css.cell.width||uo.width,r=this._renderer.dimensions?.css.cell.height||uo.height,s=this._renderer.dimensions?.css.canvas.width||i*this._coreTerminal.cols,n=this._renderer.dimensions?.css.canvas.height||r*this._coreTerminal.rows,o=this._dim(this._header.width,s,i),a=this._dim(this._header.height,n,r);if(!o&&!a){let h=s/e,l=(n-r)/t,c=Math.min(h,l);return c<1?[e*c,t*c]:[e,t]}return o?this._header.preserveAspectRatio||!o||!a?[o,t*o/e]:[o,a]:[e*a/t,a]}_dim(e,t,i){return e==="auto"?0:e.endsWith("%")?parseInt(e.slice(0,-1))*t/100:e.endsWith("px")?parseInt(e.slice(0,-2)):parseInt(e)*i}},fo=Xl(df()),b4=Xl(q8()),w4=4194304,uf=fo.PALETTE_ANSI_256;uf.set(fo.PALETTE_VT340_COLOR);var A4=class{constructor(e,t,i){this._opts=e,this._storage=t,this._coreTerminal=i,this._size=0,this._aborted=!1,(0,b4.DecoderAsync)({memoryLimit:this._opts.pixelLimit*4,palette:uf,paletteLimit:this._opts.sixelPaletteLimit}).then(r=>this._dec=r)}reset(){this._dec&&(this._dec.release(),this._dec._palette.fill(0),this._dec.init(0,uf,this._opts.sixelPaletteLimit))}hook(e){if(this._size=0,this._aborted=!1,this._dec){let t=e.params[1]===1?0:x4(this._coreTerminal._core._inputHandler._curAttrData,this._coreTerminal._core._themeService?.colors);this._dec.init(t,null,this._opts.sixelPaletteLimit)}}put(e,t,i){if(!(this._aborted||!this._dec)){if(this._size+=i-t,this._size>this._opts.sixelSizeLimit){console.warn("SIXEL: too much data, aborting"),this._aborted=!0,this._dec.release();return}try{this._dec.decode(e,t,i)}catch(r){console.warn(`SIXEL: error while decoding image - ${r}`),this._aborted=!0,this._dec.release()}}}unhook(e){if(this._aborted||!e||!this._dec)return!0;let t=this._dec.width,i=this._dec.height;if(!t||!i)return i&&this._storage.advanceCursor(i),!0;let r=$l.createCanvas(void 0,t,i);return r.getContext("2d")?.putImageData(new ImageData(this._dec.data8,t,i),0,0),this._dec.memoryUsage>w4&&this._dec.release(),this._storage.addImage(r),!0}};function x4(e,t){let i=0;if(!t)return i;if(e.isInverse())if(e.isFgDefault())i=Kl(t.foreground.rgba);else if(e.isFgRGB()){let r=e.constructor.toColorRGB(e.getFgColor());i=(0,fo.toRGBA8888)(...r)}else i=Kl(t.ansi[e.getFgColor()].rgba);else if(e.isBgDefault())i=Kl(t.background.rgba);else if(e.isBgRGB()){let r=e.constructor.toColorRGB(e.getBgColor());i=(0,fo.toRGBA8888)(...r)}else i=Kl(t.ansi[e.getBgColor()].rgba);return i}function Kl(e){return fo.BIG_ENDIAN?e:(e&255)<<24|(e>>>8&255)<<16|(e>>>16&255)<<8|e>>>24&255}var Bb={enableSizeReports:!0,pixelLimit:16777216,sixelSupport:!0,sixelScrolling:!0,sixelPaletteLimit:256,sixelSizeLimit:25e6,storageLimit:128,showPlaceholder:!0,iipSupport:!0,iipSizeLimit:2e7},Lb=4096,ff=class{constructor(e){this._disposables=[],this._handlers=new Map,this._opts=Object.assign({},Bb,e),this._defaultOpts=Object.assign({},Bb,e)}dispose(){for(let e of this._disposables)e.dispose();this._disposables.length=0,this._handlers.clear()}_disposeLater(...e){for(let t of e)this._disposables.push(t)}activate(e){if(this._terminal=e,this._renderer=new $l(e),this._storage=new d4(e,this._renderer,this._opts),this._opts.enableSizeReports){let t=e.options.windowOptions||{};t.getWinSizePixels=!0,t.getCellSizePixels=!0,t.getWinSizeChars=!0,e.options.windowOptions=t}if(this._disposeLater(this._renderer,this._storage,e.parser.registerCsiHandler({prefix:"?",final:"h"},t=>this._decset(t)),e.parser.registerCsiHandler({prefix:"?",final:"l"},t=>this._decrst(t)),e.parser.registerCsiHandler({final:"c"},t=>this._da1(t)),e.parser.registerCsiHandler({prefix:"?",final:"S"},t=>this._xtermGraphicsAttributes(t)),e.onRender(t=>this._storage?.render(t)),e.parser.registerCsiHandler({intermediates:"!",final:"p"},()=>this.reset()),e.parser.registerEscHandler({final:"c"},()=>this.reset()),e._core._inputHandler.onRequestReset(()=>this.reset()),e.buffer.onBufferChange(()=>this._storage?.wipeAlternate()),e.onResize(t=>this._storage?.viewportResize(t))),this._opts.sixelSupport){let t=new A4(this._opts,this._storage,e);this._handlers.set("sixel",t),this._disposeLater(e._core._inputHandler._parser.registerDcsHandler({final:"q"},t))}if(this._opts.iipSupport){let t=new y4(this._opts,this._renderer,this._storage,e);this._handlers.set("iip",t),this._disposeLater(e._core._inputHandler._parser.registerOscHandler(1337,t))}}reset(){this._opts.sixelScrolling=this._defaultOpts.sixelScrolling,this._opts.sixelPaletteLimit=this._defaultOpts.sixelPaletteLimit,this._storage?.reset();for(let e of this._handlers.values())e.reset();return!1}get storageLimit(){return this._storage?.getLimit()||-1}set storageLimit(e){this._storage?.setLimit(e),this._opts.storageLimit=e}get storageUsage(){return this._storage?this._storage.getUsage():-1}get showPlaceholder(){return this._opts.showPlaceholder}set showPlaceholder(e){this._opts.showPlaceholder=e,this._renderer?.showPlaceholder(e)}getImageAtBufferCell(e,t){return this._storage?.getImageAtBufferCell(e,t)}extractTileAtBufferCell(e,t){return this._storage?.extractTileAtBufferCell(e,t)}_report(e){this._terminal?._core.coreService.triggerDataEvent(e)}_decset(e){for(let t=0;t<e.length;++t)switch(e[t]){case 80:this._opts.sixelScrolling=!1;break}return!1}_decrst(e){for(let t=0;t<e.length;++t)switch(e[t]){case 80:this._opts.sixelScrolling=!0;break}return!1}_da1(e){return e[0]?!0:this._opts.sixelSupport?(this._report("\x1B[?62;4;9;22c"),!0):!1}_xtermGraphicsAttributes(e){if(e.length<2)return!0;if(e[0]===1)switch(e[1]){case 1:return this._report(`\x1B[?${e[0]};0;${this._opts.sixelPaletteLimit}S`),!0;case 2:this._opts.sixelPaletteLimit=this._defaultOpts.sixelPaletteLimit,this._report(`\x1B[?${e[0]};0;${this._opts.sixelPaletteLimit}S`);for(let t of this._handlers.values())t.reset();return!0;case 3:return e.length>2&&!(e[2]instanceof Array)&&e[2]<=Lb?(this._opts.sixelPaletteLimit=e[2],this._report(`\x1B[?${e[0]};0;${this._opts.sixelPaletteLimit}S`)):this._report(`\x1B[?${e[0]};2S`),!0;case 4:return this._report(`\x1B[?${e[0]};0;${Lb}S`),!0;default:return this._report(`\x1B[?${e[0]};2S`),!0}if(e[0]===2)switch(e[1]){case 1:let t=this._renderer?.dimensions?.css.canvas.width,i=this._renderer?.dimensions?.css.canvas.height;if(!t||!i){let s=uo;t=(this._terminal?.cols||80)*s.width,i=(this._terminal?.rows||24)*s.height}if(t*i<this._opts.pixelLimit)this._report(`\x1B[?${e[0]};0;${t.toFixed(0)};${i.toFixed(0)}S`);else{let s=Math.floor(Math.sqrt(this._opts.pixelLimit));this._report(`\x1B[?${e[0]};0;${s};${s}S`)}return!0;case 4:let r=Math.floor(Math.sqrt(this._opts.pixelLimit));return this._report(`\x1B[?${e[0]};0;${r};${r}S`),!0;default:return this._report(`\x1B[?${e[0]};2S`),!0}return this._report(`\x1B[?${e[0]};1S`),!0}};var Ns=class{constructor(t={}){this._fallbackLigatures=t.fallbackLigatures||["<--","<---","<<-","<-","->","->>","-->","--->","<==","<===","<<=","<=","=>","=>>","==>","===>",">=",">>=","<->","<-->","<--->","<---->","<=>","<==>","<===>","<====>","<~~","<~","~>","~~>","::",":::","==","!=","===","!==",":=",":-",":+","<*","<*>","*>","<|","<|>","|>","+:","-:","=:",":>","++","+++","<!--","<!---","<***>"].sort((i,r)=>r.length-i.length),this._characterJoinerId=void 0,this._terminal=void 0}activate(t){this._terminal=t,this._characterJoinerId=t.registerCharacterJoiner(this._joinCharacters.bind(this)),t.element.style.fontFeatureSettings='"liga" on, "calt" on'}dispose(){this._characterJoinerId!==void 0&&(this._terminal?.deregisterCharacterJoiner(this._characterJoinerId),this._characterJoinerId=void 0),this._terminal?.element&&(this._terminal.element.style.fontFeatureSettings="")}_joinCharacters(t){return this._findLigatureRanges(t,this._fallbackLigatures)}_findLigatureRanges(t,i){let r=[];for(let s=0;s<t.length;s++)for(let n of i)if(t.startsWith(n,s)){r.push([s,s+n.length]),s+=n.length-1;break}return r}};var jl,kt,_f,Kb,pf=0,$b=[],Xe=me,Nb=Xe.__b,Qb=Xe.__r,Hb=Xe.diffed,Xb=Xe.__c,Ub=Xe.unmount,zb=Xe.__;function Gb(e,t){Xe.__h&&Xe.__h(kt,e,pf||t),pf=0;var i=kt.__H||(kt.__H={__:[],__h:[]});return e>=i.__.length&&i.__.push({}),i.__[e]}function mf(e,t){var i=Gb(jl++,3);!Xe.__s&&qb(i.__H,t)&&(i.__=e,i.u=t,kt.__H.__h.push(i))}function jb(e){return pf=5,S4(function(){return{current:e}},[])}function S4(e,t){var i=Gb(jl++,7);return qb(i.__H,t)&&(i.__=e(),i.__H=t,i.__h=e),i.__}function C4(){for(var e;e=$b.shift();){var t=e.__H;if(e.__P&&t)try{t.__h.some(Gl),t.__h.some(gf),t.__h=[]}catch(i){t.__h=[],Xe.__e(i,e.__v)}}}Xe.__b=function(e){kt=null,Nb&&Nb(e)},Xe.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),zb&&zb(e,t)},Xe.__r=function(e){Qb&&Qb(e),jl=0;var t=(kt=e.__c).__H;t&&(_f===kt?(t.__h=[],kt.__h=[],t.__.some(function(i){i.__N&&(i.__=i.__N),i.u=i.__N=void 0})):(t.__h.some(Gl),t.__h.some(gf),t.__h=[],jl=0)),_f=kt},Xe.diffed=function(e){Hb&&Hb(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&($b.push(t)!==1&&Kb===Xe.requestAnimationFrame||((Kb=Xe.requestAnimationFrame)||k4)(C4)),t.__H.__.some(function(i){i.u&&(i.__H=i.u),i.u=void 0})),_f=kt=null},Xe.__c=function(e,t){t.some(function(i){try{i.__h.some(Gl),i.__h=i.__h.filter(function(r){return!r.__||gf(r)})}catch(r){t.some(function(s){s.__h&&(s.__h=[])}),t=[],Xe.__e(r,i.__v)}}),Xb&&Xb(e,t)},Xe.unmount=function(e){Ub&&Ub(e);var t,i=e.__c;i&&i.__H&&(i.__H.__.some(function(r){try{Gl(r)}catch(s){t=s}}),i.__H=void 0,t&&Xe.__e(t,i.__v))};var Wb=typeof requestAnimationFrame=="function";function k4(e){var t,i=function(){clearTimeout(r),Wb&&cancelAnimationFrame(t),setTimeout(e)},r=setTimeout(i,35);Wb&&(t=requestAnimationFrame(i))}function Gl(e){var t=kt,i=e.__c;typeof i=="function"&&(e.__c=void 0,i()),kt=t}function gf(e){var t=kt;e.__c=e.__(),kt=t}function qb(e,t){return!e||e.length!==t.length||t.some(function(i,r){return i!==e[r]})}var E4={terminal:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 17 10 11 4 5"/><line x1="12" x2="20" y1="19" y2="19"/></svg>',findNext:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>',findPrevious:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>',close:'<svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" height="1.5em" width="1.5em"><path fill="currentColor" d="M24 26.1 13.5 36.6q-.45.45-1.05.45-.6 0-1.05-.45-.45-.45-.45-1.05 0-.6.45-1.05L21.9 24 11.4 13.5q-.45-.45-.45-1.05 0-.6.45-1.05.45-.45 1.05-.45.6 0 1.05.45L24 21.9l10.5-10.5q.45-.45 1.05-.45.6 0 1.05.45.45.45.45 1.05 0 .6-.45 1.05L26.1 24l10.5 10.5q.45.45.45 1.05 0 .6-.45 1.05-.45.45-1.05.45-.6 0-1.05-.45Z"/></svg>',minimise:'<svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" height="1.5em" width="1.5em"><path fill="currentColor" d="M24 24.75q-.3 0-.55-.1-.25-.1-.5-.35l-9.9-9.9q-.45-.45-.45-1.05 0-.6.45-1.05.45-.45 1.05-.45.6 0 1.05.45L24 21.15l8.85-8.85q.45-.45 1.05-.45.6 0 1.05.45.45.45.45 1.05 0 .6-.45 1.05l-9.9 9.9q-.25.25-.5.35-.25.1-.55.1Zm0 12.65q-.3 0-.55-.1-.25-.1-.5-.35l-9.9-9.9q-.45-.45-.45-1.05 0-.6.45-1.05.45-.45 1.05-.45.6 0 1.05.45L24 33.8l8.85-8.85q.45-.45 1.05-.45.6 0 1.05.45.45.45.45 1.05 0 .6-.45 1.05l-9.9 9.9q-.25.25-.5.35-.25.1-.55.1Z"/></svg>',folder:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M1 3.5A1.5 1.5 0 0 1 2.5 2h2.764c.958 0 1.76.56 2.311 1.184C7.985 3.648 8.48 4 9 4h4.5A1.5 1.5 0 0 1 15 5.5v.64c.57.265.94.876.856 1.546l-.64 5.124A2.5 2.5 0 0 1 12.733 15H3.266a2.5 2.5 0 0 1-2.481-2.19l-.64-5.124A1.5 1.5 0 0 1 1 6.14V3.5zM2 6h12v-.5a.5.5 0 0 0-.5-.5H9c-.964 0-1.71-.629-2.174-1.154C6.374 3.334 5.82 3 5.264 3H2.5a.5.5 0 0 0-.5.5V6zm-.367 1a.5.5 0 0 0-.496.562l.64 5.124A1.5 1.5 0 0 0 3.266 14h9.468a1.5 1.5 0 0 0 1.489-1.314l.64-5.124A.5.5 0 0 0 14.367 7H1.633z"/></svg>',search:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m13 13.5 2-2.5-2-2.5"/><path d="m21 21-4.3-4.3"/><path d="M9 8.5 7 11l2 2.5"/><circle cx="11" cy="11" r="8"/></svg>',plus:'<svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" height="1.5em" width="1.5em"><path fill="currentColor" d="M24 38q-.65 0-1.075-.425-.425-.425-.425-1.075v-11h-11q-.65 0-1.075-.425Q10 24.65 10 24q0-.65.425-1.075.425-.425 1.075-.425h11v-11q0-.65.425-1.075Q23.35 10 24 10q.65 0 1.075.425.425.425.425 1.075v11h11q.65 0 1.075.425Q38 23.35 38 24q0 .65-.425 1.075-.425.425-1.075.425h-11v11q0 .65-.425 1.075Q24.65 38 24 38Z"/></svg>',imagePlay:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m11 16-5 5"/><path d="M11 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v6.5"/><path d="M15.765 22a.5.5 0 0 1-.765-.424V13.38a.5.5 0 0 1 .765-.424l5.878 3.674a1 1 0 0 1 0 1.696z"/><circle cx="9" cy="9" r="2"/></svg>'},Yt=E4;function vf({markup:e}){return ue("span",{class:"icon-markup",dangerouslySetInnerHTML:{__html:e}})}function qi({className:e="",label:t,markup:i,onClick:r,hidden:s=!1,disabled:n=!1}){return ue("button",{type:"button",class:`action-button ${e}`.trim(),"aria-label":t,onClick:r,hidden:s,disabled:n},ue(vf,{markup:i}))}function Vb(){return ue("span",{class:"header-divider","aria-hidden":"true"})}function Yb({bindSearchInput:e,searchVisible:t,searchQuery:i,sessionName:r,enableGuiViewer:s,onSessionSelect:n,onCreateSession:o,onToggleSearch:a,onNavigateToDir:h,onMinimize:l,onClose:c,onOpenGuiViewer:u,onSearchChange:g,onSearchNext:_,onSearchPrevious:m}){let v=jb(null);return mf(()=>{e?.(v.current)},[e]),mf(()=>{t&&(v.current?.focus(),v.current?.select())},[t]),ue(ws,null,ue("div",{class:"left-section"},ue("div",{class:"session-info",role:"button",tabIndex:0,onClick:n,onKeyDown:x=>{(x.key==="Enter"||x.key===" ")&&(x.preventDefault(),n())}},ue("span",{class:"pointer-indicator","aria-hidden":"true"}),ue("h3",{class:"session-name"},r))),ue("div",{class:"btn-section"},!t&&ue("div",{class:"default-actions"},ue(qi,{className:"new-session",label:"New session",markup:Yt.plus,onClick:o}),s&&ue(qi,{className:"gui-viewer",label:"Open GUI viewer",markup:Yt.imagePlay,onClick:u}),ue(Vb,null),ue(qi,{className:"search-btn",label:"Search",markup:Yt.search,onClick:a}),ue(qi,{className:"folder-icon",label:"Navigate to active folder",markup:Yt.folder,onClick:h}),ue(Vb,null),ue(qi,{className:"minimize",label:"Minimize terminal",markup:Yt.minimise,onClick:l}),ue(qi,{className:"close",label:"Close terminal",markup:Yt.close,onClick:c})),t&&ue("div",{class:"search-bar"},ue("div",{class:"search-field"},ue("span",{class:"search-icon"},ue(vf,{markup:Yt.search})),ue("input",{ref:v,type:"text",value:i,placeholder:"Find in terminal...","aria-label":"Search input",onInput:x=>g(x.currentTarget.value),onKeyDown:x=>{x.key==="Escape"&&(x.preventDefault(),a())}})),ue("div",{class:"search-nav"},ue(qi,{className:"find-previous",label:"Find previous",markup:Yt.findPrevious,onClick:m,disabled:!i}),ue(qi,{className:"find-next",label:"Find next",markup:Yt.findNext,onClick:_,disabled:!i}),ue(qi,{className:"close-search",label:"Close search",markup:Yt.close,onClick:a})))))}function Jb(){return ue(vf,{markup:Yt.terminal})}var Zb=acode.require("confirm"),ke=acode.require("settings"),B4=acode.require("fsOperation"),L4=acode.require("toInternalUrl"),ew=acode.require("select"),Vi=acode.require("loader"),D4=acode.require("dialogBox"),I4=acode.require("page"),M4=acode.require("actionStack"),Qs=acode.require("fonts"),{clipboard:yf}=cordova.plugins,Ot="https://cdn.jsdelivr.net/gh/bajrangCoder/acode-plugin-acodex@main/fonts/",T4=[{name:"Fira Code Bold Nerd Font",url:`${Ot}Fira Code Bold Nerd Font.ttf`,format:"truetype",weight:"bold",style:"normal"},{name:"Fira Code Medium Nerd Font",url:`${Ot}Fira Code Medium Nerd Font Complete Mono.ttf`,format:"truetype",weight:"normal",style:"normal"},{name:"JetBrains Mono Bold Nerd Font",url:`${Ot}JetBrains Mono Bold Nerd Font Complete.ttf`,format:"truetype",weight:"bold",style:"normal"},{name:"JetBrains Mono Medium Nerd Font",url:`${Ot}JetBrains Mono Medium Nerd Font Complete.ttf`,format:"truetype",weight:"normal",style:"normal"},{name:"VictorMonoNerdFont Bold",url:`${Ot}VictorMonoNerdFont-Bold.ttf`,format:"truetype",weight:"bold",style:"normal"},{name:"VictorMonoNerdFont BoldItalic",url:`${Ot}VictorMonoNerdFont-BoldItalic.ttf`,format:"truetype",weight:"bold",style:"italic"},{name:"VictorMonoNerdFont Medium",url:`${Ot}VictorMonoNerdFont-Medium.ttf`,format:"truetype",weight:"normal",style:"normal"},{name:"VictorMonoNerdFont Italic",url:`${Ot}VictorMonoNerdFont-Italic.ttf`,format:"truetype",weight:"normal",style:"italic"},{name:"SauceCodeProNerdFont Bold",url:`${Ot}SauceCodeProNerdFont-Bold.ttf`,format:"truetype",weight:"bold",style:"normal"},{name:"SauceCodeProNerdFont Medium",url:`${Ot}SauceCodeProNerdFont-Medium.ttf`,format:"truetype",weight:"normal",style:"normal"},{name:"MesloLGS NF Bold Italic",url:`${Ot}MesloLGS NF Bold Italic.ttf`,format:"truetype",weight:"bold",style:"italic"},{name:"MesloLGS NF Bold",url:`${Ot}MesloLGS NF Bold.ttf`,format:"truetype",weight:"bold",style:"normal"},{name:"MesloLGS NF Italic",url:`${Ot}MesloLGS NF Italic.ttf`,format:"truetype",weight:"normal",style:"italic"}];function R4(){typeof Qs?.add=="function"&&T4.forEach(({name:e,url:t,format:i,weight:r,style:s})=>{if(Qs?.has?.(e))return;let n=encodeURI(t),o=`@font-face {
  font-family: '${e}';
  src: url('${n}') format('${i}');
  font-weight: ${r};
  font-style: ${s};
}`;Qs.add(e,o)})}var po=class{isDragging=!1;startY;startHeight;isFlotBtnDragging=!1;btnStartPosX;btnStartPosY;isTerminalMinimized=!1;isTerminalOpened=!1;previousTerminalHeight;pid;terminal=null;socket=null;$fitAddon=void 0;selectionManager=null;constructor(){ke.value[Si.id]?Object.prototype.hasOwnProperty.call(this.settings,"fontLigatures")||(delete ke.value[Si.id],ke.update(!1),this._saveSetting()):this._saveSetting(),typeof this.settings?.terminalPadding>"u"&&(this.settings.terminalPadding=dh,ke.update(!1)),this.uiState={sessionName:localStorage.getItem("AcodeX_Current_Session")||"AcodeX1",searchVisible:!1,searchQuery:""},this.handleResize=this.handleResize.bind(this),this.handleDrag=this.drag.bind(this),this.handleStopDragging=this.stopDragging.bind(this),this.handleStartDragging=this.startDragging.bind(this),this.handleDragFloatingBtn=this.dragFlotButton.bind(this),this.handleStopDraggingFloatingBtn=this.stopDraggingFlotBtn.bind(this),this.handleStartDraggingFloatingBtn=this.startDraggingFloatingBtn.bind(this),this.handleOpenTerminalCommand=this.handleOpenTerminalCommand.bind(this),this.handleCloseTerminalCommand=this.closeTerminal.bind(this),this.handleToggleTerminalCommand=this.handleToggleTerminalCommand.bind(this),this.handleMaximiseClick=this.maxmise.bind(this),this.handleSessionSelect=this.handleSessionSelect.bind(this),this.handleToggleSearch=this.handleToggleSearch.bind(this),this.handleSearchChange=this.handleSearchChange.bind(this),this.handleCreateSession=this.createSession.bind(this),this.handleOpenGuiViewer=this.openViewerPage.bind(this),this.handleNavigateToDir=this._cdToActiveDir.bind(this),this.handleBackButton=this.handleBackButton.bind(this)}renderUI(){!this.$terminalHeader||!this.$showTermBtn||(Bn(ue(Yb,{bindSearchInput:t=>{this.$searchInput=t},searchVisible:this.uiState.searchVisible,searchQuery:this.uiState.searchQuery,sessionName:this.uiState.sessionName,enableGuiViewer:this.settings.enableGuiViewer,onSessionSelect:this.handleSessionSelect,onCreateSession:this.handleCreateSession,onToggleSearch:this.handleToggleSearch,onNavigateToDir:this.handleNavigateToDir,onMinimize:this.minimise.bind(this),onClose:this.handleCloseTerminalCommand,onOpenGuiViewer:this.handleOpenGuiViewer,onSearchChange:this.handleSearchChange,onSearchNext:this._findNextMatchofSearch.bind(this),onSearchPrevious:this._findPreviousMatchofSearch.bind(this)}),this.$terminalHeader),Bn(ue(Jb,null),this.$showTermBtn),this.$showTermBtn.dataset.state=this.isTerminalMinimized?"minimized":"hidden")}setUiState(t){this.uiState={...this.uiState,...t},this.renderUI()}handleOpenTerminalCommand(){if(this.isTerminalOpened&&this.isTerminalMinimized){this.maxmise();return}this.openTerminalPanel(270,this.settings.port)}handleToggleTerminalCommand(){if(this.isTerminalOpened&&this.isTerminalMinimized){this.maxmise();return}this.minimise()}async handleSessionSelect(){let t,i=await this.$cacheFile.readFile("utf8"),r=i?JSON.parse(i):[];Array.isArray(r)?t=r.map(o=>o.name):t=[];let s={hideOnSelect:!0,default:localStorage.getItem("AcodeX_Current_Session")},n=await ew("AcodeX Sessions",t,s);n&&this.changeSession(n)}handleToggleSearch(){let t=!this.uiState.searchVisible;this.setUiState({searchVisible:t,searchQuery:t?this.uiState.searchQuery:""}),t||(this.$searchAddon?.clearDecorations(),this.$searchAddon?.clearActiveDecoration())}handleSearchChange(t){if(this.setUiState({searchQuery:t}),!t){this.$searchAddon?.clearDecorations(),this.$searchAddon?.clearActiveDecoration();return}this.$searchAddon?.findNext(t)}handleResize(){if(this.$terminalContainer&&!this.$terminalContainer.classList.contains("hide")){let i=document.querySelector("#root header")?.offsetHeight,r=document.querySelector("#root ul")?.offsetHeight||0,s=i+r,n=document.querySelector("#quick-tools")?.offsetHeight||0,o=window.innerHeight-(s+n),a=Number.parseInt(this.$terminalContainer.style.height);if(Number.isNaN(a))return;let h=Math.min(a,o);this.$terminalContainer.style.height=`${h}px`,localStorage.setItem("AcodeX_Terminal_Cont_Height",this.$terminalContainer.offsetHeight)}let t=this.$terminal?.getSelection();if(t&&t.length>0&&this.selectionManager?.updateHandles(),this.$showTermBtn&&this.settings.showTerminalBtn&&!this.$showTermBtn.classList.contains("hide")){let i=document.querySelector("#root header")?.offsetHeight,r=document.querySelector("#root ul")?.offsetHeight||0,s=i+r,n=window.innerHeight-s-this.$showTermBtn.offsetHeight,o=Number.parseInt(this.$showTermBtn.style.bottom);this.$showTermBtn.style.bottom=`${Math.max(0,Math.min(n,o))}px`}}handleBackButton(){!this.$page||!document.contains(this.$page)||(this.rfb?.disconnect(),this.$page.querySelector(".gui-viewer-canvas").innerHTML="",this.$page.hide())}async init(t,i,r){try{R4(),this.xtermCss=tag("link",{rel:"stylesheet",href:`${this.baseUrl}xterm.css`}),this.$style=tag("link",{rel:"stylesheet",href:`${this.baseUrl}main.css`}),this._loadCustomFontStyleSheet(),document.head.append(this.xtermCss,this.$style),editorManager.editor.commands.addCommand({name:"acodex:open_terminal",description:"Open Terminal",bindKey:{win:"Ctrl-K"},exec:this.handleOpenTerminalCommand}),editorManager.editor.commands.addCommand({name:"acodex:close_terminal",description:"Close Terminal",bindKey:{win:"Ctrl-J"},exec:this.handleCloseTerminalCommand}),editorManager.editor.commands.addCommand({name:"acodex:maximise_terminal",description:"Maximise Terminal",bindKey:{win:"Ctrl-Shift-T"},exec:this.handleToggleTerminalCommand}),this.$terminalContainer=tag("div",{className:"terminal-panel"}),this.$terminalHeader=tag("div",{className:"terminal-title-bar"}),this.$terminalContent=tag("div",{className:"terminal-content"}),this.$showTermBtn=tag("button",{className:"show-terminal-btn",ariaLabel:"Restore terminal"}),this.settings.enableGuiViewer&&this.setupGUIViewerPage(),this.$terminalHeader.addEventListener("mousedown",this.handleStartDragging),this.$terminalHeader.addEventListener("touchstart",this.handleStartDragging),this.$terminalContainer.append(this.$terminalHeader,this.$terminalContent),this.renderUI(),app.get("main")&&app.get("main").append(this.$terminalContainer,this.settings.showTerminalBtn?this.$showTermBtn:""),this.$showTermBtn?.classList.add("hide"),this.$terminalContainer?.classList.add("hide"),this.settings.showTerminalBtnSize&&this.settings.showTerminalBtn&&(this.$showTermBtn.style.height=`${this.settings.showTerminalBtnSize}px`,this.$showTermBtn.style.width=`${this.settings.showTerminalBtnSize}px`),this.$cacheFile=i,this.$showTermBtn.addEventListener("mousedown",this.handleStartDraggingFloatingBtn),this.$showTermBtn.addEventListener("touchstart",this.handleStartDraggingFloatingBtn),this.$showTermBtn.addEventListener("click",this.handleMaximiseClick),document.addEventListener("mousemove",this.handleDragFloatingBtn),document.addEventListener("mouseup",this.handleStopDraggingFloatingBtn),document.addEventListener("touchmove",this.handleDragFloatingBtn),document.addEventListener("touchend",this.handleStopDraggingFloatingBtn),window.addEventListener("mousemove",this.handleDrag),window.addEventListener("touchmove",this.handleDrag),window.addEventListener("mouseup",this.handleStopDragging),window.addEventListener("touchend",this.handleStopDragging),window.addEventListener("resize",this.handleResize),localStorage.getItem("AcodeX_Is_Opened")==="true"&&localStorage.getItem("AcodeX_Current_Session")&&await this.openTerminalPanel(localStorage.getItem("AcodeX_Terminal_Cont_Height")||270,this.settings.port),acode.define("acodex",{execute:(s,n=!0)=>{try{if(!this.isTerminalOpened)return;this.socket?.send(n?`${s}\r`:s)}catch(o){throw Error(o)}},isMinimized:()=>this.isTerminalMinimized,isTerminalOpened:()=>this.isTerminalOpened,maximiseTerminal:()=>{this.isTerminalOpened&&this.isTerminalMinimized&&this.maxmise()},openTerminal:async(s=270,n=this.settings.port)=>{if(!this.isTerminalOpened){let o=await this.openTerminalPanel(s,n);return{onmessage:a=>{o&&(o.onmessage=h=>a(typeof h.data=="string"?h.data:new Uint8Array(h.data)))},write:(a,h=!0)=>{let l=h?`${a}\r`:a;o.send(l)}}}},createSession:async()=>{if(this.isTerminalOpened){let s=await this.createSession();return{onmessage:n=>{s&&(s.onmessage=o=>n(typeof o.data=="string"?o.data:new Uint8Array(o.data)))},write:(n,o=!0)=>{let a=o?`${n}\r`:n;s.send(a)}}}},changeSession:async s=>{if(this.isTerminalOpened){let n=await this.changeSession(s);return{onmessage:o=>{n&&(n.onmessage=a=>o(typeof a.data=="string"?a.data:new Uint8Array(a.data)))},write:(o,a=!0)=>{let h=a?`${o}\r`:o;n.send(h)}}}},closeTerminal:()=>{this.isTerminalOpened&&this.closeTerminal()},convertAcodeUriToTermReadable:s=>go(s),addTheme:(s,n)=>{fh.push(s),Se[s]=n},applyTheme:s=>{this.settings.theme=s,ke.update()}})}catch(s){console.log(s)}}setupGUIViewerPage(){let t=tag("span",{className:"icon clearclose",dataset:{action:"close-btn"}});this.displayVar=tag("span",{textContent:"Display: ",dataset:{action:"copy-display-num"}}),this.displayVar.onclick=()=>{yf.copy(`export DISPLAY=${this.displayVariable};`),acode.alert("AcodeX","Copied the display, just execute the copied command in your current terminal session.")},this.$page=I4("AcodeX GUI Viewer",{lead:t,tail:this.displayVar}),this.$page.id="acodex-gui-viewer",this.$page.show=()=>{M4.push({id:Si.id,action:this.$page.hide}),app.append(this.$page),this.$page.querySelector(".gui-viewer-canvas").appendChild(this._hiddenInput)},t.onclick=()=>{this.rfb.disconnect(),r.innerHTML="",this.$page.hide()},document.addEventListener("backbutton",this.handleBackButton,!1);let i=tag("span",{className:"icon keyboard_hide",dataset:{action:"show-keyboard"}});this.$page.header.append(i);let r=tag("div",{className:"gui-viewer-canvas"});this.$page.body.append(r),this._hiddenInput=tag("textarea",{autocapitalize:"off",autocomplete:"off",spellcheck:"false",tabindex:"-1"}),this._hiddenInput.style.position="absolute",this._hiddenInput.style.opacity="0",this._hiddenInput.style.height="0px",this._hiddenInput.style.width="0px",this._hiddenInput.style.zIndex="-1",this._hiddenInput.style.imeMode="disabled",this.$page.querySelector(".gui-viewer-canvas").appendChild(this._hiddenInput),i.onclick=()=>{this._hiddenInput.focus()};function s(n){let o=n.target.value,a=n.target.dataset.lastValue||"",h;try{h=Math.max(n.target.selectionStart,o.length)}catch{h=o.length}let l=a.length,c=h-l,u=c<0?-c:0;for(let g=0;g<Math.min(l,h);g++)if(o.charAt(g)!==a.charAt(g)){c=h-g,u=l-g;break}for(let g=0;g<u;g++)this.rfb.sendKey(iw.default.XK_BackSpace,"Backspace");for(let g=h-c;g<h;g++){let _=o.charCodeAt(g),m=rw.default.lookup(_);m&&this.rfb.sendKey(m)}n.target.dataset.lastValue=o}this._hiddenInput.addEventListener("input",s.bind(this))}async openViewerPage(){Vi.showTitleLoader();let t=/(?:bash|zsh|sh|.*):(?:\s*line \d+:)?\s*\w+:? command not found|not found/;try{if(this.rfb)Vi?.removeTitleLoader(),this.$page.show();else{let i=await this.executeCommandOnPty("vncserver --help");if(t.test(i.output))Vi?.removeTitleLoader(),acode.alert("AcodeX Error","vncserver not found, First go head and read readme of acodex regarding 'Gui Setup'. To setup it");else{let r=await this.executeCommandOnPty("vncserver -list");if(/:\d+\s+\t+\d+/.test(r.output))this.displayVariable=r.output.match(/:(\d+)/)[0],this.connectVncServer(this.displayVariable);else if(/TigerVNC server sessions:\s+X DISPLAY #\tPROCESS ID/.test(r.output)){let s=await this.executeCommandOnPty("vncserver"),n=/New 'localhost:(\d+)/,o=s.output.match(n);o?(this.displayVariable=`:${o[1]}`,this.connectVncServer(this.displayVariable)):(Vi?.removeTitleLoader(),acode.alert("AcodeX Error","Failed to create new vnc server session, try creating it manually by executing: `vncserver` command"))}else throw new Error("Unexpected output from vncserver -list.")}}}catch(i){Vi?.removeTitleLoader(),console.error("Error executing command:",i),acode.alert("AcodeX Error",i.message)}}async connectVncServer(t){try{let i=/(?:bash|zsh|sh|.*):(?:\s*line \d+:)?\s*\w+:? command not found|not found/,r=await this.executeCommandOnPty("websockify_rs");if(i.test(r.output)&&acode.alert("AcodeX Warning","websockify_rs not found, which acts as a proxy. Go ahead and install it(Check readme for guide)."),(await this.executeCommandOnPty("ps aux | grep websockify_rs | grep -v grep")).output===""){let n=5900+Number.parseInt(t.split(":")[1]),o=localStorage.getItem("AcodeX_Current_Session");await(await this.createSession()).send(`websockify_rs localhost:6778 localhost:${n}\r`),await this.changeSession(o),await this.waitForWebsockifyToStart()}this.bindNoVnc()}catch(i){Vi?.removeTitleLoader(),console.error("Error in connecting to vnc server:",i),acode.alert("AcodeX Error",i.message)}}async waitForWebsockifyToStart(){let t=5,i=r=>new Promise(s=>setTimeout(s,r));for(;t>0;){if((await this.executeCommandOnPty("ps aux | grep websockify_rs | grep -v grep")).output!==""){console.log("AcodeX: Websockify_rs started successfully.");return}t--,console.log("AcodeX: Waiting for websockify_rs to start..."),await i(1e3)}throw new Error("AcodeX: Failed to start websockify_rs within the timeout period.")}async bindNoVnc(){try{this.rfb=new tw.default(this.$page.querySelector(".gui-viewer-canvas"),"ws://localhost:6778/"),this.rfb.scaleViewport=!0,this.rfb.clipViewport=!0;let i=getComputedStyle(document.documentElement).getPropertyValue("--secondary-color").trim();this.rfb.background=i||"",this.rfb.addEventListener("connect",()=>{this.$page.show(),Vi?.removeTitleLoader(),this.displayVar.textContent=`Display: ${this.displayVariable.split(":")[1]}`}),this.rfb.addEventListener("disconnect",()=>{this.rfb=void 0,this.$page?.hide(),Vi?.removeTitleLoader()}),this.rfb.addEventListener("credentialsrequired",async()=>{let r;if(localStorage.getItem("VNC_PASS"))r=localStorage.getItem("VNC_PASS");else{if(r=await acode.prompt("Enter vncserver password:","","text"),!r)return;localStorage.setItem("VNC_PASS",r)}this.rfb?.sendCredentials({password:r})}),this.rfb.addEventListener("securityfailure",r=>{acode.alert("AcodeX Error",`Security failure: ${r.detail.reason}`),console.error("Security failure:",r.detail),localStorage.removeItem("VNC_PASS")}),this.rfb.addEventListener("serververification",r=>{acode.alert("AcodeX Error",`Server verification failed: ${JSON.stringify(r.detail)}`),console.error("Server verification failed:",r)})}catch(t){Vi?.removeTitleLoader(),console.error("Error novnc:",t),acode.alert("AcodeX Error",t.message)}}async executeCommandOnPty(t){let i=await fetch(`http://${this.settings.serverHost}:${this.settings.port}/execute-command`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({command:t})});if(!i.ok)throw new Error(`Request failed with status: ${i.status}`);return await i.json()}async openTerminalPanel(t,i){if(!i)return;document.querySelector(".terminal-panel")||app.get("main").append(this.$terminalContainer,this.$showTermBtn),this.settings.port=i,ke.update(!1),this.$terminalContainer.classList.remove("hide"),this.isTerminalOpened=!0,this.$terminalContainer.style.height=`${t}px`,this.$terminalContent.style.width="100%",this.$terminalContent.style.height="100%",await Qs.loadFont(this.settings.fontFamily),this.settings.transparency?(this.$terminalContainer.style.background="transparent",this.$terminalContainer.style.backdropFilter=`blur(${this.settings.blurValue})`,this.$terminalHeader.style.background=xf(this.$terminalHeader),this.$terminalHeader.style.backdropFilter=`blur(${this.settings.blurValue})`):(this.$terminalContainer.style.background="var(--popup-background-color)",this.$terminalHeader.style.background="var(--primary-color)");let r;return localStorage.getItem("AcodeX_Current_Session")?r=await this.changeSession(localStorage.getItem("AcodeX_Current_Session"),!0):(this.$terminalContent.innerHTML="",r=await this.createSession()),r}async createXtermTerminal(t){if(this.$terminal=this.terminalObj,this.$fitAddon=new o1,this.$webglAddon=new Cy,this.$unicode11Addon=new Gy,this.$webLinkAddon=new ky(async(i,r)=>{await Zb("AcodeX Link",`Do you want to open ${r} in browser?`)&&system.openInBrowser(r)}),this.$searchAddon=new yb,this.settings.imageRendering&&(this.$imageAddon=new ff,this.$terminal.loadAddon(this.$imageAddon)),this.$terminal.loadAddon(this.$fitAddon),this.$terminal.loadAddon(this.$unicode11Addon),this.$terminal.loadAddon(this.$webLinkAddon),this.$terminal.loadAddon(this.$searchAddon),this.$webglAddon)try{this.$terminal.loadAddon(this.$webglAddon),this.$terminal.open(this.$terminalContent)}catch(i){window.toast(`error during loading webgl addon: ${i}`,4e3),this.$webglAddon.dispose(),this.$webglAddon=void 0}this.$terminal.element||this.$terminal.open(this.$terminalContent),this.$terminal.element&&(this._setTerminalPadding(this.settings.terminalPadding),this.fitTerminal()),this.settings.fontLigatures&&(this.$ligatureAddon=new Ns,this.$terminal.loadAddon(this.$ligatureAddon)),this.$terminal.focus(),this._updateTerminalHeight()}async attachSocketToXterm(t,i){this.$terminal.onResize(async n=>{if(!i)return;let o=n.cols.toString(),a=n.rows.toString(),h=`http://${this.settings.serverHost}:${t}/terminals/${i}/resize`;await fetch(h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cols:o,rows:a})})}),this.socket=new WebSocket(`ws://${this.settings.serverHost}:${t}/terminals/${i}`),this.socket.onopen=()=>{this.$attachAddon=new jy(this.socket),this.$terminal.loadAddon(this.$attachAddon),this.$terminal.unicode.activeVersion="11",this._updateTerminalHeight(),localStorage.setItem("AcodeX_Is_Opened",this.isTerminalOpened),localStorage.setItem("AcodeX_Terminal_Cont_Height",this.$terminalContainer.offsetHeight),localStorage.getItem("AcodeX_Terminal_Is_Minimised")==="true"&&this.minimise(),this._updateTerminalHeight();let n=Number(this.settings.fontSize)||ch,o=Math.max(1,n-10),a=Math.max(n+16,32);this.selectionManager=new Hs(this.$terminal,this.$terminalContainer,this.settings,{minFontSize:o,maxFontSize:a,onFontSizeChange:h=>this.applyTerminalFontSize(h)})},this.socket.onclose=async n=>{try{let o=await fetch(`http://${this.settings.serverHost}:${t}/`);o.ok||console.warn("Server responded with an error:",o.status,o.statusText);return}catch{this.removeTerminal(),acode.alert("AcodeX Server","Disconnected from server because server gets closed \u{1F61E}!")}},this.socket.onerror=n=>{acode.alert("AcodeX Error",JSON.stringify(n))},this.$terminal.attachCustomKeyEventHandler(async n=>{if(n.type==="keydown"){let o=await this.$cacheFile.readFile("utf8"),a=o?JSON.parse(o):[];if(n.ctrlKey&&(n.key==="N"||n.key==="n"))return this.createSession(),!1;if(n.ctrlKey&&(n.key==="W"||n.key==="w"))return this.closeTerminal(),!1;if(n.ctrlKey&&n.shiftKey&&(n.key==="T"||n.key==="t"))return this.isTerminalMinimized||this.minimise(),!1;if(n.ctrlKey&&n.shiftKey&&(n.key==="V"||n.key==="v"))return yf.paste(h=>{this.$terminal?.paste(h)}),!1;if(n.ctrlKey&&n.keyCode>=49&&n.keyCode<=53){let h=n.keyCode-49;if(a.length>h){let l=a[h];return this.changeSession(l.name),!1}}if(n.ctrlKey&&n.key==="ArrowLeft"){let h=a.findIndex(l=>l.name===localStorage.getItem("AcodeX_Current_Session"));if(h>0){let l=a[h-1];return this.changeSession(l.name),!1}}if(n.ctrlKey&&n.key==="ArrowRight"){let h=a.findIndex(l=>l.name===localStorage.getItem("AcodeX_Current_Session"));if(h<a.length-1){let l=a[h+1];return this.changeSession(l.name),!1}}if(n.ctrlKey&&n.key==="+"){let h=this.$terminal.options.fontSize+1;return this.applyTerminalFontSize(h),!1}if(n.ctrlKey&&n.key==="-"){let h=this.$terminal.options.fontSize-1;return h<1||this.applyTerminalFontSize(h),!1}if(n.ctrlKey&&n.shiftKey&&(n.key==="c"||n.key==="C")){if(!this.$terminal?.hasSelection())return;let h=this.$terminal?.getSelection();return h&&yf.copy(h),window.toast("Copied \u2705",3e3),this.$terminal.focus(),!1}if(n.ctrlKey&&n.shiftKey&&(n.key==="i"||n.key==="I"))return this.$terminal?.clear(),this.socket?.send("clear\r"),!1;if(n.ctrlKey&&(n.key==="a"||n.key==="A"))return this.$terminal?.selectAll(),!1}});let r="",s=!0;this.$terminal.onData(n=>{if(n==="\x7F"){r.trim()===""?s=!0:(r=r.slice(0,-1),s=r.trim()==="");return}let o=Sf(n);r+=o,o.startsWith("#")&&s&&this.openAIPromptPopup(),n==="\r"&&(r.trim().toLowerCase()==="exit"&&(console.log("Exiting current session..."),this.terminalCloseHandler()),r="",s=!0),s=r.trim()===""})}async getOllamaModel(t){let i=localStorage.getItem("ACODEX_LOCAL_LLM_MODEL");if(i)return i;try{let r=await t.getListOfOllamaModels();if(!Array.isArray(r))throw new Error("Failed to fetch Ollama models");let s=await ew("Select Local Model",r);return s?(localStorage.setItem("ACODEX_LOCAL_LLM_MODEL",s),s):null}catch(r){return console.error("Error getting Ollama models:",r),acode.alert("Error","Failed to fetch Ollama models"),null}}async openAIPromptPopup(){let t=new Ff(this.settings.aiModel===_h[3][0]?null:this.settings.aiApiKey),i;if(this.settings.aiModel==="local-llm"&&(i=await this.getOllamaModel(t),!i))return;let r=D4("\u26A1 Ask  AcodeX Ai",`<textarea id="acodeXAiPromptBox" rows="2" placeholder="for eg: delete sample.txt file"></textarea>
			<div class="ai-loader-container">
        <div class="wave"></div>
        <div class="wave"></div>
        <div class="wave"></div>
        <div class="wave"></div>
        <div class="wave"></div>
			</div>`,"Start Magic \u2728");r.ok(async()=>{let s=document.querySelector("#acodeXAiPromptBox"),n=document.querySelector(".ai-loader-container"),o=s?.value;if(!o){r.hide();return}n&&(n.style.display="flex"),window.toast("Wait! To see the magic of AcodeX AI \u2728",2e3);try{let a="";switch(this.settings.aiModel){case"deepseek":{let{response:h,error:l}=await t.generateDeepseekResponse(o);if(l){n&&(n.style.display="none"),r.hide(),acode.alert("AcodeX AI Error",l.toString()),console.error("AcodeX AI Error:",l);return}a=h.choices[0].message.content;break}case"chatgpt":{let{response:h,error:l}=await t.generateChatgptResponse(o);if(l){n&&(n.style.display="none"),r.hide(),acode.alert("AcodeX AI Error",l.toString()),console.error("AcodeX AI Error:",l);return}a=h.choices[0].message.content;break}case"gemini-pro":{let{response:h,error:l}=await t.generateGeminiResponse(o);if(l){n&&(n.style.display="none"),r.hide(),acode.alert("AcodeX AI Error",l.toString()),console.error("AcodeX AI Error:",l);return}a=h.candidates[0].content.parts[0].text;break}case"local-llm":{a=(await t.generateOllamaResponse(i,o)).response;break}}if(!a){n&&(n.style.display="none"),r.hide();return}this.socket?.send("\b"),this.socket?.send(a.trim()),n&&(n.style.display="none"),r.hide()}catch(a){n&&(n.style.display="none"),r?.hide(),console.error(a),acode.alert("AcodeX AI Error",JSON.stringify(a))}})}async createSession(){let t,i=await this.$cacheFile.readFile("utf8"),r=i?JSON.parse(i):[];if(r.length===0){if(await this.createXtermTerminal(this.settings.port),t=await this._generateProcessId(),!t)return;r=[{name:"AcodeX1",pid:t}]}else{this._hideTerminalSession();let o=`AcodeX${r.reduce((a,h)=>{let c=h.name.match(/^AcodeX(\d+)$/);if(c){let u=Number.parseInt(c[1],10);return Math.max(a,u)}return a},0)+1}`;if(await this.createXtermTerminal(this.settings.port),t=await this._generateProcessId(),!t)return;r.push({name:o,pid:t})}return await Promise.all([this.$cacheFile.writeFile(r),this.attachSocketToXterm(this.settings.port,t)]),this._updateTerminalHeight(),localStorage.setItem("AcodeX_Current_Session",r[r.length-1].name),this.setUiState({sessionName:r[r.length-1].name,searchVisible:!1,searchQuery:""}),window.toast(`Created Session: ${r[r.length-1].name}`,3e3),this.socket}_hideTerminalSession(){this.cleanupSelectionManager(),this.$attachAddon?.dispose(),this.$fitAddon?.dispose(),this.$unicode11Addon?.dispose(),this.$webLinkAddon?.dispose(),this.$searchAddon?.dispose(),this.$imageAddon?.dispose(),this.$ligatureAddon?.dispose(),this.$webglAddon?.dispose(),this.$terminal?.dispose(),this.socket?.close(),this.socket=null,this.$terminal=void 0,this.$attachAddon=void 0,this.$fitAddon=void 0,this.$unicode11Addon=void 0,this.$webLinkAddon=void 0,this.$searchAddon=void 0,this.$imageAddon=void 0,this.$ligatureAddon=void 0,this.$webglAddon=void 0,this.$terminalContent.innerHTML=""}async _generateProcessId(){try{let t=this.$terminal.cols.toString(),i=this.$terminal.rows.toString(),r=await fetch(`http://${this.settings.serverHost}:${this.settings.port}/terminals`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cols:t,rows:i})});if(!r.ok)throw new Error("Failed to create terminal");return await r.text()}catch{this.$terminalContainer.classList.contains("hide")||this.$terminalContainer.classList.add("hide"),this.$showTermBtn.classList.contains("hide")||this.$showTermBtn.classList.add("hide"),this.isTerminalMinimized=!1,this.isTerminalOpened=!1,localStorage.setItem("AcodeX_Terminal_Is_Minimised",this.isTerminalMinimized),localStorage.setItem("AcodeX_Is_Opened",this.isTerminalOpened),this.$terminalContainer.style.height=this.previousTerminalHeight,localStorage.setItem("AcodeX_Terminal_Cont_Height",this.$terminalContainer.offsetHeight),localStorage.removeItem("AcodeX_Current_Session"),window.toast("Start the acodex server in termux first!",4e3)}}async changeSession(t,i=!1){if(i){await this.createXtermTerminal(this.settings.port);let s=await this._getPidBySessionName(t);if(!s){this.$terminalContainer.classList.contains("hide")||this.$terminalContainer.classList.add("hide"),this.$showTermBtn.classList.contains("hide")||this.$showTermBtn.classList.add("hide"),this.isTerminalMinimized=!1,this.isTerminalOpened=!1,localStorage.setItem("AcodeX_Terminal_Is_Minimised",this.isTerminalMinimized),localStorage.setItem("AcodeX_Is_Opened",this.isTerminalOpened),this.$terminalContainer.style.height=this.previousTerminalHeight,localStorage.setItem("AcodeX_Terminal_Cont_Height",this.$terminalContainer.offsetHeight),localStorage.removeItem("AcodeX_Current_Session"),window.toast("Oops! Something went wrong in the Core \u{1F614}",4e3);return}return await this.attachSocketToXterm(this.settings.port,s),localStorage.setItem("AcodeX_Current_Session",t),this.setUiState({sessionName:t,searchVisible:!1,searchQuery:""}),this.socket}if(t===localStorage.getItem("AcodeX_Current_Session"))return;let r=await this._getPidBySessionName(t);if(r)return this._hideTerminalSession(),await this.createXtermTerminal(this.settings.port),await this.attachSocketToXterm(this.settings.port,r),localStorage.setItem("AcodeX_Current_Session",t),this.setUiState({sessionName:t,searchVisible:!1,searchQuery:""}),this.socket}async _getPidBySessionName(t){let i=await this.$cacheFile.readFile("utf8"),r=i?JSON.parse(i):[];if(Array.isArray(r)){let s=r.find(n=>n.name===t);return s?s.pid:(console.log(`Error: Session '${t}' not found in JSON file.`),null)}return console.log("Error: Sessions data is not an array in JSON file."),null}_saveSetting(){ke.value[Si.id]={port:8767,serverHost:"localhost",aiApiKey:"",aiModel:Gf,transparency:Kf,selectionHaptics:Nf,fontLigatures:Qf,enableGuiViewer:Pf,imageRendering:Of,showTerminalBtnSize:Wf,showTerminalBtn:$f,blurValue:"4px",cursorBlink:Hf,cursorStyle:lh[0],cursorInactiveStyle:hh[0],fontSize:ch,fontFamily:Xf,letterSpacing:0,terminalPadding:dh,fontWeight:uh[0],customFontStyleSheet:"",scrollBack:Uf,scrollSensitivity:zf,theme:Ee,background:Se[Ee].background,foreground:Se[Ee].foreground,cursor:Se[Ee].cursor||"",cursorAccent:Se[Ee].cursorAccent||"",selectionBackground:Se[Ee].selectionBackground,black:Se[Ee].black,blue:Se[Ee].blue,brightBlack:Se[Ee].brightBlack,brightBlue:Se[Ee].brightBlue,brightCyan:Se[Ee].brightCyan,brightGreen:Se[Ee].brightGreen,brightMagenta:Se[Ee].brightMagenta,brightRed:Se[Ee].brightWhite,brightWhite:Se[Ee].brightWhite,brightYellow:Se[Ee].brightYellow,cyan:Se[Ee].cyan,green:Se[Ee].green,magenta:Se[Ee].magenta,red:Se[Ee].red,white:Se[Ee].white,yellow:Se[Ee].yellow},ke.update(!1)}_loadCustomFontStyleSheet(){if(this.settings.customFontStyleSheet!=="")if(document.querySelector("#customFontAcodeXStyleSheet"))document.querySelector("#customFontAcodeXStyleSheet").href=this.settings.customFontStyleSheet;else{let t=tag("link",{href:this.settings.customFontStyleSheet,rel:"stylesheet",id:"customFontAcodeXStyleSheet"});document.head.append(t)}}_setTerminalPadding(t){if(!this.$terminal?.element)return;let i=Number(t),s=`${Number.isNaN(i)?0:Math.max(0,i)}px`,n=this.$terminal.element;n.style.boxSizing="border-box",n.style.padding=s,this.$fitAddon&&this.fitTerminal()}_updateTerminalHeight(){this.$terminalContent&&(this.$terminalContent.style.height="100%",localStorage.setItem("AcodeX_Terminal_Cont_Height",this.$terminalContainer.offsetHeight),this.fitTerminal())}fitTerminal(){if(!(!this.$fitAddon||!this.$terminal||!this.$terminal.element||!this.$terminalContent?.isConnected||this.$terminalContainer?.classList.contains("hide")))try{let t=this.$fitAddon.proposeDimensions();if(!t?.cols||!t?.rows)return;this.$terminal.resize(t.cols+2,t.rows+1)}catch(t){console.warn("AcodeX fitTerminal skipped:",t)}}applyTerminalFontSize(t){if(!this.$terminal)return;let i=Number(t);if(Number.isNaN(i))return;let s=Math.max(1,i);this.$terminal.options.fontSize!==s&&(this.$terminal.options.fontSize=s,typeof this.$terminal.refresh=="function"&&this.$terminal.refresh(0,this.$terminal.rows-1),this.settings.fontSize=s,ke.update(!1))}async _getLastSessionName(){try{let t=await this.$cacheFile.readFile("utf8"),i=t?JSON.parse(t):[];return Array.isArray(i)&&i.length>0?i[i.length-1].name:(console.error("Error: No sessions found in JSON file or sessions data is not an array."),null)}catch(t){return console.error("Error reading or parsing JSON file:",t),null}}async removeTerminal(){this.$terminalContainer.classList.contains("hide")||(this.$terminalContainer.style.opacity=1),this.$terminalContainer.classList.add("hide"),this.$showTermBtn.classList.contains("hide")||this.$showTermBtn.classList.add("hide"),this.isTerminalMinimized=!1,this.isTerminalOpened=!1,localStorage.setItem("AcodeX_Terminal_Is_Minimised",this.isTerminalMinimized),localStorage.setItem("AcodeX_Is_Opened",this.isTerminalOpened),this.$terminalContainer.style.height=this.previousTerminalHeight,localStorage.setItem("AcodeX_Terminal_Cont_Height",this.$terminalContainer.offsetHeight),localStorage.removeItem("AcodeX_Current_Session"),this.setUiState({sessionName:"AcodeX1",searchVisible:!1,searchQuery:""}),await this.$cacheFile.writeFile("")}async terminalCloseHandler(){let t=await this.$cacheFile.readFile("utf8"),i=t?JSON.parse(t):[];if(i=i.filter(r=>r.name!==localStorage.getItem("AcodeX_Current_Session")),await this.$cacheFile.writeFile(i),i.length>0){let r=await this._getLastSessionName();this.changeSession(r)}else this._hideTerminalSession(),this.$terminalContainer.classList.contains("hide")||this.$terminalContainer.classList.add("hide"),this.$showTermBtn.classList.contains("hide")||this.$showTermBtn.classList.add("hide"),this.isTerminalMinimized=!1,this.isTerminalOpened=!1,this.rfb?.disconnect(),this.rfb=void 0,localStorage.removeItem("AcodeX_Current_Session"),localStorage.setItem("AcodeX_Terminal_Is_Minimised",this.isTerminalMinimized),localStorage.setItem("AcodeX_Is_Opened",this.isTerminalOpened),this.$terminalContainer.style.height=this.previousTerminalHeight,localStorage.setItem("AcodeX_Terminal_Cont_Height",this.$terminalContainer.offsetHeight),this.setUiState({sessionName:"AcodeX1",searchVisible:!1,searchQuery:""});this.cleanupSelectionManager()}async closeTerminal(){if(await Zb("Warning","Are you sure ?")&&this.$terminal!=null&&localStorage.getItem("AcodeX_Current_Session")){let i=await this._getPidBySessionName(localStorage.getItem("AcodeX_Current_Session"));if(!i)return;fetch(`http://${this.settings.serverHost}:${this.settings.port}/terminals/${i}/terminate`,{method:"POST"}).then(async r=>{r.ok?this.terminalCloseHandler():(acode.alert("AcodeX Error",`Failed to close terminal ${this.pid}. Trying to force close it...`),this.removeTerminal())}).catch(async r=>{this.removeTerminal(),acode.alert("AcodeX Server","Disconnected from server because server gets closed \u{1F61E}!"),console.error(`Error while closing terminal ${this.pid}: ${r}`)})}}startDraggingFloatingBtn(t){try{this.isFlotBtnDragging=!0,this.$showTermBtn.style.border="2px solid #fff",t.type==="touchstart"?(this.btnStartPosX=t.touches[0].clientX,this.btnStartPosY=t.touches[0].clientY):(this.btnStartPosX=t.clientX,this.btnStartPosY=t.clientY)}catch(i){window.alert(i)}}dragFlotButton(t){try{if(!this.isFlotBtnDragging)return;t.preventDefault();let i,r;t.type==="touchmove"?(i=t.touches[0].clientX,r=t.touches[0].clientY):(i=t.clientX,r=t.clientY);let s=this.btnStartPosX-i,n=this.btnStartPosY-r;this.btnStartPosX=i,this.btnStartPosY=r;let o=window.innerHeight-(this.$showTermBtn.offsetTop+this.$showTermBtn.offsetHeight)+n,a=this.$showTermBtn.offsetLeft-s,h=document.querySelector("#root header")?.offsetHeight,l=document.querySelector("#root ul")?.offsetHeight||0,c=h+l,u=window.innerWidth-this.$showTermBtn.offsetWidth,g=window.innerHeight-c-this.$showTermBtn.offsetHeight;this.$showTermBtn.style.bottom=`${Math.max(0,Math.min(g,o))}px`,this.$showTermBtn.style.left=`${Math.max(0,Math.min(u,a))}px`}catch(i){window.alert(i)}}stopDraggingFlotBtn(){try{this.isFlotBtnDragging=!1,this.$showTermBtn.style.border="none"}catch(t){window.alert(t)}}startDragging(t){t.type==="touchstart"?this.startY=t.touches[0].clientY:(t.preventDefault(),this.startY=t.clientY),this.startHeight=this.$terminalContainer.clientHeight,this.isDragging=!0,this.$terminalContainer.style.borderTop="1px solid var(--link-text-color)"}drag(t){if(!this.isDragging)return;t.preventDefault();let i;t.type==="touchmove"?i=t.touches[0].clientY:i=t.clientY;let r=i-this.startY,s=this.startHeight-r,n=document.querySelector("#root header")?.offsetHeight,o=document.querySelector("#root ul")?.offsetHeight||0,a=n+o,h=document.querySelector("#quick-tools")?.offsetHeight||0,l=window.innerHeight-(a+h);s=Math.max(100,Math.min(s,l)),this.$terminalContainer.style.height=`${s}px`,localStorage.setItem("AcodeX_Terminal_Cont_Height",s),this._updateTerminalHeight();let u=this.$terminal?.getSelection();u&&u.length>0&&this.selectionManager?.updateHandles()}stopDragging(t){this.isDragging=!1,this.$terminalContainer.style.borderTop="1px solid var(--popup-border-color)"}minimise(){try{this.isTerminalMinimized||(this.previousTerminalHeight=window.getComputedStyle(this.$terminalContainer).height,localStorage.setItem("AcodeX_Terminal_Cont_Height",this.$terminalContainer.offsetHeight),this.$terminalContainer.style.height="0px",this.$terminalContainer.classList.add("hide"),this.isTerminalMinimized=!0,localStorage.setItem("AcodeX_Terminal_Is_Minimised",this.isTerminalMinimized),this.settings.showTerminalBtn&&this.$showTermBtn.classList.remove("hide"),this.$showTermBtn.dataset.state="minimized")}catch(t){window.alert(t)}}maxmise(){if(this.isTerminalMinimized){Number.parseInt(localStorage.getItem("AcodeX_Terminal_Cont_Height"))<=50?this.$terminalContainer.style.height="50px":this.$terminalContainer.style.height=`${localStorage.getItem("AcodeX_Terminal_Cont_Height")}px`,this.$terminalContainer.classList.remove("hide"),this.$terminalContent.style.height="100%",this.fitTerminal(),localStorage.setItem("AcodeX_Terminal_Cont_Height",this.$terminalContainer.offsetHeight),this.settings.showTerminalBtn&&this.$showTermBtn.classList.add("hide"),this.$showTermBtn.dataset.state="hidden",this.isTerminalMinimized=!1,localStorage.setItem("AcodeX_Terminal_Is_Minimised",this.isTerminalMinimized),this._updateTerminalHeight();let t=this.$terminal?.getSelection();t&&t.length>0&&this.selectionManager?.updateHandles()}}_findPreviousMatchofSearch(){let t=this.uiState.searchQuery;this.$searchAddon?.findPrevious(t)}_findNextMatchofSearch(){let t=this.uiState.searchQuery;this.$searchAddon?.findNext(t)}async _cdToActiveDir(){let{activeFile:t}=editorManager;if(t.uri){let i=go(t.uri);if(!i){navigator.vibrate(300),window.toast("unsupported path type.",3e3);return}this.socket.send(`cd "${i}"\r`)}}cleanupSelectionManager(){this.selectionManager&&(this.selectionManager.destroy(),this.selectionManager=null)}async destroy(){Bn(null,this.$terminalHeader),Bn(null,this.$showTermBtn),this.$style?.remove(),this.xtermCss?.remove(),this.$fontStyleSheet?.remove(),await B4(`${window.DATA_STORAGE}acodex_fonts`).delete(),editorManager.editor.commands.removeCommand("acodex:open_terminal"),editorManager.editor.commands.removeCommand("acodex:close_terminal"),editorManager.editor.commands.removeCommand("acodex:maximise_terminal"),this.cleanupSelectionManager(),this.$terminalContainer?.remove(),this.$showTermBtn?.remove(),document.removeEventListener("mousemove",this.handleDragFloatingBtn),document.removeEventListener("mouseup",this.handleStopDraggingFloatingBtn),document.removeEventListener("touchmove",this.handleDragFloatingBtn),document.removeEventListener("touchend",this.handleStopDraggingFloatingBtn),document.removeEventListener("backbutton",this.handleBackButton,!1),this.$showTermBtn?.removeEventListener("mousedown",this.handleStartDraggingFloatingBtn),this.$showTermBtn?.removeEventListener("touchstart",this.handleStartDraggingFloatingBtn),this.$showTermBtn?.removeEventListener("click",this.handleMaximiseClick),this.$terminalHeader?.removeEventListener("mousedown",this.handleStartDragging),this.$terminalHeader?.removeEventListener("touchstart",this.handleStartDragging),window.removeEventListener("mousemove",this.handleDrag),window.removeEventListener("touchmove",this.handleDrag),window.removeEventListener("mouseup",this.handleStopDragging),window.removeEventListener("touchend",this.handleStopDragging),window.removeEventListener("resize",this.handleResize),localStorage.removeItem("AcodeX_Terminal_Is_Minimised"),localStorage.removeItem("AcodeX_Current_Session"),localStorage.removeItem("AcodeX_Terminal_Cont_Height"),localStorage.removeItem("AcodeX_Is_Opened"),localStorage.getItem("ACODEX_LOCAL_LLM_MODEL")&&localStorage.removeItem("ACODEX_LOCAL_LLM_MODEL")}async setCustomFontFile(){let{url:t}=await acode.fileBrowser("file","select custom font stylesheet");if(!t)return;let i=go(t);if(i.startsWith("/sdcard"))i=i.replace("/sdcard","file:///storage/emulated/0");else if(i.startsWith("$HOME"))return;let r=t.split("/"),s=r[r.length-1];i=`${i}/${s}`;let n=await L4(i);this.settings.customFontStyleSheet=n,ke.update()}async applyTheme(t){let i=Se[t];this.settings.theme=t,this.settings.background=i.background,this.settings.foreground=i.foreground,this.settings.cursor=i.cursor||"#fff",this.settings.cursorAccent=i.cursorAccent||"#fff",this.settings.selectionBackground=i.selectionBackground,this.settings.black=i.black,this.settings.blue=i.blue,this.settings.brightBlack=i.brightBlack,this.settings.brightBlue=i.brightBlue,this.settings.brightCyan=i.brightCyan,this.settings.brightGreen=i.brightGreen,this.settings.brightMagenta=i.brightMagenta,this.settings.brightRed=i.brightRed,this.settings.brightWhite=i.brightWhite,this.settings.brightYellow=i.brightYellow,this.settings.cyan=i.cyan,this.settings.green=i.green,this.settings.magenta=i.magenta,this.settings.red=i.red,this.settings.white=i.white,this.settings.yellow=i.yellow,ke.update()}get terminalThemeObj(){return{background:this.settings.transparency?Cf(this.settings.background,.5):this.settings.background,foreground:this.settings.foreground,selectionBackground:this.settings.selectionBackground,cursor:this.settings.cursor,cursorAccent:this.settings.cursorAccent,black:this.settings.black,blue:this.settings.blue,brightBlack:this.settings.brightBlack,brightBlue:this.settings.brightBlue,brightCyan:this.settings.brightCyan,brightGreen:this.settings.brightGreen,brightMagenta:this.settings.brightMagenta,brightRed:this.settings.brightRed,brightWhite:this.settings.brightWhite,brightYellow:this.settings.brightYellow,cyan:this.settings.cyan,green:this.settings.green,magenta:this.settings.magenta,red:this.settings.red,white:this.settings.white,yellow:this.settings.yellow}}get terminalObj(){return new n1({allowTransparency:this.settings.transparency,allowProposedApi:!0,scrollOnUserInput:!0,cursorBlink:this.settings.cursorBlink,cursorStyle:this.settings.cursorStyle,cursorInactiveStyle:this.settings.cursorInactiveStyle,scrollBack:this.settings.scrollBack,scrollSensitivity:this.settings.scrollSensitivity,fontSize:this.settings.fontSize,fontFamily:`${this.settings.fontFamily}, Fira Code, monospace`,fontWeight:this.settings.fontWeight,letterSpacing:this.settings.letterSpacing,theme:this.terminalThemeObj})}async clearCache(){await this.$cacheFile.writeFile(""),window.toast("Cache cleared \u{1F525}",3e3)}get settingsObj(){return this.settings.theme==="custom"?{list:this.settingsList.concat(this.settingsListWithThemeColor),cb:(t,i)=>this.settingsSaveCallback(t,i)}:{list:this.settingsList,cb:(t,i)=>this.settingsSaveCallback(t,i)}}get settingsList(){return[{key:"port",text:"Server Port",value:this.settings.port,info:"Port which is displayed on termux when starting the server",prompt:"Server Port",promptType:"number",promptOption:[{required:!0}]},{key:"letterSpacing",text:"Letter Spacing",value:this.settings.letterSpacing,info:"The spacing in whole pixels between characters.",prompt:"Letter spacing",promptType:"number",promptOption:[{required:!0}]},{key:"terminalPadding",text:"Terminal Padding",value:this.settings.terminalPadding,info:"Padding around the terminal content in pixels.",prompt:"Terminal Padding",promptType:"number",promptOption:[{match:/^[0-9]+$/,required:!0}]},{key:"serverHost",text:"Server Host Name",value:this.settings.serverHost,info:"Hostname which is displayed on termux when starting the server",prompt:"Server Host Name",promptType:"text",promptOption:[{required:!0}]},{key:"aiApiKey",text:"AI API Key",value:this.settings.aiApiKey,info:"API key of your selected model, if your selected model doesn't need any api key then leave it empty. For how to get api key : check the readme of plugin",prompt:"AI API Key",promptType:"text",promptOption:[{required:!0}]},{key:"aiModel",text:"AI Model",value:this.settings.aiModel,info:"ai model to generate terminal suggestions and commands",select:_h},{key:"fontWeight",text:"Font Weight",value:this.settings.fontWeight,info:"The font weight used to render non-bold text.",select:uh},{key:"showTerminalBtnSize",text:"Show Terminal button size",value:this.settings.showTerminalBtnSize,info:"Size of terminal show button (in px)",prompt:"Show Terminal button size",promptType:"number",promptOption:[{required:!0}]},{key:"blurValue",text:"Blur Value(in px)",value:this.settings.blurValue,info:"Blur value for terminal in transparent mode",prompt:"Blur Value",promptType:"text",promptOption:[{required:!0}]},{key:"clearCache",text:"Clear Cache",info:"Helps in clearing cache which contains session details in case of any problems or bug"},{key:"transparency",text:"Allow Transparent Terminal",info:"Makes terminal transparent but it will also led to slightly performance decrement",checkbox:!!this.settings.transparency},{key:"imageRendering",text:"Image Rendering",info:"Enables image rendering inside the terminal but it can reduce performance",checkbox:!!this.settings.imageRendering},{key:"enableGuiViewer",text:"GUI Viewer",info:"Enables gui viewer, to view the output of graphical apps",checkbox:!!this.settings.enableGuiViewer},{key:"selectionHaptics",text:"Selection Haptics",info:"Enable/Disable vibration on selection",checkbox:!!this.settings.selectionHaptics},{key:"fontLigatures",text:"Font Ligatures",info:"Enable/Disable font ligatures in terminal",checkbox:!!this.settings.fontLigatures},{key:"showTerminalBtn",text:"Terminal Maximise Button",info:"Hide/Unhide terminal maximise button",checkbox:!!this.settings.showTerminalBtn},{index:7,key:"customFontStyleSheet",text:"Custom Font Stylesheet file",info:"Select css file in which you have to define about your custom font.",value:this.settings.customFontStyleSheet},{index:0,key:"cursorBlink",text:"Cursor Blink",info:"Whether the cursor blinks.",checkbox:!!this.settings.cursorBlink},{index:1,key:"cursorStyle",text:"Cursor Style",value:this.settings.cursorStyle,info:"The style of the cursor.",select:lh},{key:"cursorInactiveStyle",text:"Cursor Inactive Style",value:this.settings.cursorInactiveStyle,info:"The style of the cursor when the terminal is not focused.",select:hh},{index:2,key:"fontSize",text:"Font Size",value:this.settings.fontSize,info:"The font size used to render text.",prompt:"Font Size",promptType:"text",promptOption:[{match:/^[0-9]+$/,required:!0}]},{index:3,key:"fontFamily",text:"Font Family",value:this.settings.fontFamily,info:"The font family used to render text.",get select(){return Qs.getNames()}},{index:4,key:"scrollBack",text:"Scroll Back",value:this.settings.scrollBack,info:"The amount of scrollback in the terminal. Scrollback is the amount of rows that are retained when lines are scrolled beyond the initial viewport.",prompt:"Scroll Back",promptType:"number",promptOption:[{match:/^[0-9]+$/,required:!0}]},{index:5,key:"scrollSensitivity",text:"Scroll Sensitivity",value:this.settings.scrollSensitivity,info:"The scrolling speed multiplier used for adjusting normal scrolling speed.",prompt:"Scroll Sensitivity",promptType:"number",promptOption:[{match:/^[0-9]+$/,required:!0}]},{index:6,key:"theme",text:"Theme",value:this.settings.theme,info:"Theme of terminal.",select:fh}]}get settingsListWithThemeColor(){return[{index:8,key:"background",text:"Background Color",value:this.settings.background,color:this.settings.background},{index:9,key:"foreground",text:"Foreground Color",value:this.settings.foreground,color:this.settings.foreground},{index:10,key:"selectionBackground",text:"Selection Background Color",value:this.settings.selectionBackground,color:this.settings.selectionBackground},{index:11,key:"cursor",text:"Cursor Color",value:this.settings.cursor,color:this.settings.cursor},{index:12,key:"cursorAccent",text:"Cursor Accent Color",value:this.settings.cursorAccent,color:this.settings.cursorAccent},{index:13,key:"black",text:"Black Color",value:this.settings.black,color:this.settings.black},{index:14,key:"blue",text:"Blue Color",value:this.settings.blue,color:this.settings.blue},{index:15,key:"brightBlack",text:"Bright Black Color",value:this.settings.brightBlack,color:this.settings.brightBlack},{index:16,key:"brightBlue",text:"Bright Blue Color",value:this.settings.brightBlue,color:this.settings.brightBlue},{index:17,key:"brightCyan",text:"Bright Cyan Color",value:this.settings.brightCyan,color:this.settings.brightCyan},{index:18,key:"brightGreen",text:"Bright Green Color",value:this.settings.brightGreen,color:this.settings.brightGreen},{index:19,key:"brightMagenta",text:"Bright Magenta Color",value:this.settings.brightMagenta,color:this.settings.brightMagenta},{index:20,key:"brightRed",text:"Bright Red Color",value:this.settings.brightRed,color:this.settings.brightRed},{index:21,key:"brightWhite",text:"Bright White Color",value:this.settings.brightWhite,color:this.settings.brightWhite},{index:22,key:"brightYellow",text:"Bright Yellow Color",value:this.settings.brightYellow,color:this.settings.brightYellow},{index:23,key:"cyan",text:"Cyan Color",value:this.settings.cyan,color:this.settings.cyan},{index:24,key:"green",text:"Green Color",value:this.settings.green,color:this.settings.green},{index:25,key:"magenta",text:"Magenta Color",value:this.settings.magenta,color:this.settings.magenta},{index:26,key:"red",text:"Red Color",value:this.settings.red,color:this.settings.red},{index:27,key:"white",text:"White Color",value:this.settings.white,color:this.settings.white},{index:28,key:"yellow",text:"Yellow Color",value:this.settings.yellow,color:this.settings.yellow}]}async settingsSaveCallback(t,i){switch(t){case"customFontStyleSheet":this.setCustomFontFile();break;case"theme":this.applyTheme(i),i==="custom"&&acode.alert("AcodeX Warning","Restart the app please"),this.$terminal&&(this.$terminal.options.theme=this.terminalThemeObj);break;case"clearCache":this.clearCache();break;case"showTerminalBtnSize":this.$showTermBtn&&(this.$showTermBtn.style.height=`${i}px`,this.$showTermBtn.style.width=`${i}px`);break;case"fontSize":this.applyTerminalFontSize(i);break;case"fontFamily":try{await Qs.loadFont(i)}catch(r){console.warn(`Failed to load font ${i}:`,r)}this.$terminal&&(this.$terminal.options.fontFamily=i,this.$terminal.refresh(0,this.$terminal.rows-1)),this.settings[t]=i,ke.update();break;case"fontWeight":this.$terminal&&(this.$terminal.options.fontWeight=i),this.settings[t]=i,ke.update();break;case"letterSpacing":this.$terminal&&(this.$terminal.options.letterSpacing=i),this.settings[t]=i,ke.update();break;case"terminalPadding":{let r=Number(i);if(Number.isNaN(r))break;let s=Math.max(0,r);this.settings[t]=s,this.$terminal?.element&&this._setTerminalPadding(s),ke.update();break}case"cursorBlink":this.$terminal&&(this.$terminal.options.cursorBlink=i),this.settings[t]=i,ke.update();break;case"cursorStyle":this.$terminal&&(this.$terminal.options.cursorStyle=i),this.settings[t]=i,ke.update();break;case"cursorInactiveStyle":this.$terminal&&(this.$terminal.options.cursorInactiveStyle=i),this.settings[t]=i,ke.update();break;case"imageRendering":this.$terminal&&(i?(this.$imageAddon=new ff,this.$terminal.loadAddon(this.$imageAddon)):this.$imageAddon?.dispose()),this.settings[t]=i,ke.update();break;case"fontLigatures":this.$terminal&&(i?(this.$ligatureAddon=new Ns,this.$terminal.loadAddon(this.$ligatureAddon)):this.$ligatureAddon?.dispose()),this.settings[t]=i,ke.update();break;case"enableGuiViewer":this.settings[t]=i,ke.update(),i&&!this.$page&&this.setupGUIViewerPage(),this.renderUI();break;case"showTerminalBtn":this.settings[t]=i,ke.update(),this.$showTermBtn&&(i&&!document.contains(this.$showTermBtn)&&app.get("main")&&app.get("main").append(this.$showTermBtn),this.$showTermBtn.style.display=i?"":"none",i?this.isTerminalMinimized&&this.$showTermBtn.classList.remove("hide"):this.$showTermBtn.classList.add("hide"));break;default:this.settings[t]=i,t==="selectionHaptics"&&this.selectionManager&&(this.selectionManager.options.hapticFeedback=!!i),ke.update()}}get settings(){return ke.value[Si.id]}};if(window.acode){let e=new po;acode.setPluginInit(Si.id,async(t,i,{cacheFileUrl:r,cacheFile:s})=>{let n=t.endsWith("/")?t:`${t}/`;e.baseUrl=n,await e.init(i,s,r)},e.settingsObj),acode.setPluginUnmount(Si.id,()=>{e.destroy()})}})();
/*! Bundled license information:

@novnc/novnc/lib/crypto/aes.js:
  (*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE *)

@novnc/novnc/lib/crypto/rsa.js:
  (*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE *)

@novnc/novnc/lib/crypto/md5.js:
  (*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE *)

@novnc/novnc/lib/ra2.js:
  (*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE *)

@novnc/novnc/lib/rfb.js:
  (*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE *)

@xterm/xterm/lib/xterm.mjs:
  (**
   * Copyright (c) 2014-2024 The xterm.js authors. All rights reserved.
   * @license MIT
   *
   * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)
   * @license MIT
   *
   * Originally forked from (with the author's permission):
   *   Fabrice Bellard's javascript vt100 for jslinux:
   *   http://bellard.org/jslinux/
   *   Copyright (c) 2011 Fabrice Bellard
   *)

@xterm/addon-fit/lib/addon-fit.mjs:
  (**
   * Copyright (c) 2014-2024 The xterm.js authors. All rights reserved.
   * @license MIT
   *
   * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)
   * @license MIT
   *
   * Originally forked from (with the author's permission):
   *   Fabrice Bellard's javascript vt100 for jslinux:
   *   http://bellard.org/jslinux/
   *   Copyright (c) 2011 Fabrice Bellard
   *)

@xterm/addon-webgl/lib/addon-webgl.mjs:
  (**
   * Copyright (c) 2014-2024 The xterm.js authors. All rights reserved.
   * @license MIT
   *
   * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)
   * @license MIT
   *
   * Originally forked from (with the author's permission):
   *   Fabrice Bellard's javascript vt100 for jslinux:
   *   http://bellard.org/jslinux/
   *   Copyright (c) 2011 Fabrice Bellard
   *)

@xterm/addon-web-links/lib/addon-web-links.mjs:
  (**
   * Copyright (c) 2014-2024 The xterm.js authors. All rights reserved.
   * @license MIT
   *
   * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)
   * @license MIT
   *
   * Originally forked from (with the author's permission):
   *   Fabrice Bellard's javascript vt100 for jslinux:
   *   http://bellard.org/jslinux/
   *   Copyright (c) 2011 Fabrice Bellard
   *)

@xterm/addon-unicode11/lib/addon-unicode11.mjs:
  (**
   * Copyright (c) 2014-2024 The xterm.js authors. All rights reserved.
   * @license MIT
   *
   * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)
   * @license MIT
   *
   * Originally forked from (with the author's permission):
   *   Fabrice Bellard's javascript vt100 for jslinux:
   *   http://bellard.org/jslinux/
   *   Copyright (c) 2011 Fabrice Bellard
   *)

@xterm/addon-attach/lib/addon-attach.mjs:
  (**
   * Copyright (c) 2014-2024 The xterm.js authors. All rights reserved.
   * @license MIT
   *
   * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)
   * @license MIT
   *
   * Originally forked from (with the author's permission):
   *   Fabrice Bellard's javascript vt100 for jslinux:
   *   http://bellard.org/jslinux/
   *   Copyright (c) 2011 Fabrice Bellard
   *)

@xterm/addon-search/lib/addon-search.mjs:
  (**
   * Copyright (c) 2014-2024 The xterm.js authors. All rights reserved.
   * @license MIT
   *
   * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)
   * @license MIT
   *
   * Originally forked from (with the author's permission):
   *   Fabrice Bellard's javascript vt100 for jslinux:
   *   http://bellard.org/jslinux/
   *   Copyright (c) 2011 Fabrice Bellard
   *)

@xterm/addon-image/lib/addon-image.mjs:
  (**
   * Copyright (c) 2014-2024 The xterm.js authors. All rights reserved.
   * @license MIT
   *
   * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)
   * @license MIT
   *
   * Originally forked from (with the author's permission):
   *   Fabrice Bellard's javascript vt100 for jslinux:
   *   http://bellard.org/jslinux/
   *   Copyright (c) 2011 Fabrice Bellard
   *)
*/
