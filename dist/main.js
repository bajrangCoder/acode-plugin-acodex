"use strict";(()=>{var eb=Object.create;var Ud=Object.defineProperty;var tb=Object.getOwnPropertyDescriptor;var ib=Object.getOwnPropertyNames;var rb=Object.getPrototypeOf,sb=Object.prototype.hasOwnProperty;var ie=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var nb=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of ib(t))!sb.call(e,s)&&s!==i&&Ud(e,s,{get:()=>t[s],enumerable:!(r=tb(t,s))||r.enumerable});return e};var Dl=(e,t,i)=>(i=e!=null?eb(rb(e)):{},nb(t||!e||!e.__esModule?Ud(i,"default",{value:e,enumerable:!0}):i,e));var ql=ie(oo=>{"use strict";Object.defineProperty(oo,"__esModule",{value:!0});oo.toSigned32bit=Bb;oo.toUnsigned32bit=Eb;function Eb(e){return e>>>0}function Bb(e){return e|0}});var wi=ie(Fe=>{"use strict";Object.defineProperty(Fe,"__esModule",{value:!0});Fe.Warn=Fe.Info=Fe.Error=Fe.Debug=void 0;Fe.getLogging=Lb;Fe.initLogging=bf;var Vl="warn",pf=Fe.Debug=function(){},vf=Fe.Info=function(){},mf=Fe.Warn=function(){},yf=Fe.Error=function(){};function bf(e){if(typeof e>"u"?e=Vl:Vl=e,Fe.Debug=pf=Fe.Info=vf=Fe.Warn=mf=Fe.Error=yf=function(){},typeof window.console<"u")switch(e){case"debug":Fe.Debug=pf=console.debug.bind(window.console);case"info":Fe.Info=vf=console.info.bind(window.console);case"warn":Fe.Warn=mf=console.warn.bind(window.console);case"error":Fe.Error=yf=console.error.bind(window.console);case"none":break;default:throw new window.Error("invalid logging type '"+e+"'")}}function Lb(){return Vl}bf()});var Yl=ie(ao=>{"use strict";Object.defineProperty(ao,"__esModule",{value:!0});ao.decodeUTF8=Db;ao.encodeUTF8=Ib;function Db(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;try{return decodeURIComponent(escape(e))}catch(i){if(i instanceof URIError&&t)return e;throw i}}function Ib(e){return unescape(encodeURIComponent(e))}});var Ts=ie(ve=>{"use strict";function eh(e){"@babel/helpers - typeof";return eh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},eh(e)}Object.defineProperty(ve,"__esModule",{value:!0});ve.hasScrollbarGutter=ve.dragThreshold=void 0;ve.isAndroid=Ob;ve.isBlink=Gb;ve.isChrome=Hb;ve.isChromeOS=Kb;ve.isChromium=Xb;ve.isEdge=zb;ve.isFirefox=Qb;ve.isGecko=Wb;ve.isIOS=Pb;ve.isMac=Rb;ve.isOpera=Ub;ve.isSafari=Nb;ve.isTouchDevice=void 0;ve.isWebKit=$b;ve.isWindows=Fb;ve.supportsCursorURIs=void 0;var lo=Mb(wi());function Af(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(Af=function(s){return s?i:t})(e)}function Mb(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||eh(e)!="object"&&typeof e!="function")return{default:e};var i=Af(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&{}.hasOwnProperty.call(e,n)){var o=s?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}var Tb=ve.isTouchDevice="ontouchstart"in document.documentElement||document.ontouchstart!==void 0||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;window.addEventListener("touchstart",function e(){ve.isTouchDevice=Tb=!0,window.removeEventListener("touchstart",e,!1)},!1);var F8=ve.dragThreshold=10*(window.devicePixelRatio||1),xf=!1;try{Jl=document.createElement("canvas"),Jl.style.cursor='url("data:image/x-icon;base64,AAACAAEACAgAAAIAAgA4AQAAFgAAACgAAAAIAAAAEAAAAAEAIAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AAAAAAAAAAAAAAAAAAAAAA==") 2 2, default',Jl.style.cursor.indexOf("url")===0?(lo.Info("Data URI scheme cursor supported"),xf=!0):lo.Warn("Data URI scheme cursor not supported")}catch(e){lo.Error("Data URI scheme cursor test exception: "+e)}var Jl,P8=ve.supportsCursorURIs=xf,Sf=!0;try{Gi=document.createElement("div"),Gi.style.visibility="hidden",Gi.style.overflow="scroll",document.body.appendChild(Gi),Zl=document.createElement("div"),Gi.appendChild(Zl),wf=Gi.offsetWidth-Zl.offsetWidth,Gi.parentNode.removeChild(Gi),Sf=wf!=0}catch(e){lo.Error("Scrollbar test exception: "+e)}var Gi,Zl,wf,O8=ve.hasScrollbarGutter=Sf;function Rb(){return!!/mac/i.exec(navigator.platform)}function Fb(){return!!/win/i.exec(navigator.platform)}function Pb(){return!!/ipad/i.exec(navigator.platform)||!!/iphone/i.exec(navigator.platform)||!!/ipod/i.exec(navigator.platform)}function Ob(){return!!navigator.userAgent.match("Android ")}function Kb(){return!!navigator.userAgent.match(" CrOS ")}function Nb(){return!!navigator.userAgent.match("Safari/...")&&!navigator.userAgent.match("Chrome/...")&&!navigator.userAgent.match("Chromium/...")&&!navigator.userAgent.match("Epiphany/...")}function Qb(){return!!navigator.userAgent.match("Firefox/...")&&!navigator.userAgent.match("Seamonkey/...")}function Hb(){return!!navigator.userAgent.match("Chrome/...")&&!navigator.userAgent.match("Chromium/...")&&!navigator.userAgent.match("Edg/...")&&!navigator.userAgent.match("OPR/...")}function Xb(){return!!navigator.userAgent.match("Chromium/...")}function Ub(){return!!navigator.userAgent.match("OPR/...")}function zb(){return!!navigator.userAgent.match("Edg/...")}function Wb(){return!!navigator.userAgent.match("Gecko/...")}function $b(){return!!navigator.userAgent.match("AppleWebKit/...")&&!navigator.userAgent.match("Chrome/...")}function Gb(){return!!navigator.userAgent.match("Chrome/...")}});var Cf=ie(th=>{"use strict";Object.defineProperty(th,"__esModule",{value:!0});th.clientToElement=jb;function jb(e,t,i){var r=i.getBoundingClientRect(),s={x:0,y:0};return e<r.left?s.x=0:e>=r.right?s.x=r.width-1:s.x=e-r.left,t<r.top?s.y=0:t>=r.bottom?s.y=r.height-1:s.y=t-r.top,s}});var sh=ie(jr=>{"use strict";Object.defineProperty(jr,"__esModule",{value:!0});jr.getPointerEvent=qb;jr.releaseCapture=rh;jr.setCapture=Yb;jr.stopEvent=Vb;function qb(e){return e.changedTouches?e.changedTouches[0]:e.touches?e.touches[0]:e}function Vb(e){e.stopPropagation(),e.preventDefault()}var ih=!1,kf=null;document.captureElement=null;function Sr(e){if(!ih){var t=new e.constructor(e.type,e);ih=!0,document.captureElement?document.captureElement.dispatchEvent(t):kf.dispatchEvent(t),ih=!1,e.stopPropagation(),t.defaultPrevented&&e.preventDefault(),e.type==="mouseup"&&rh()}}function Ef(){var e=document.getElementById("noVNC_mouse_capture_elem");e.style.cursor=window.getComputedStyle(document.captureElement).cursor}var Bf=new MutationObserver(Ef);function Yb(e){if(e.setCapture)e.setCapture(),document.captureElement=e;else{rh();var t=document.getElementById("noVNC_mouse_capture_elem");t===null&&(t=document.createElement("div"),t.id="noVNC_mouse_capture_elem",t.style.position="fixed",t.style.top="0px",t.style.left="0px",t.style.width="100%",t.style.height="100%",t.style.zIndex=1e4,t.style.display="none",document.body.appendChild(t),t.addEventListener("contextmenu",Sr),t.addEventListener("mousemove",Sr),t.addEventListener("mouseup",Sr)),document.captureElement=e,Bf.observe(e,{attributes:!0}),Ef(),t.style.display="",window.addEventListener("mousemove",Sr),window.addEventListener("mouseup",Sr)}}function rh(){if(document.releaseCapture)document.releaseCapture(),document.captureElement=null;else{if(!document.captureElement)return;kf=document.captureElement,document.captureElement=null,Bf.disconnect();var e=document.getElementById("noVNC_mouse_capture_elem");e.style.display="none",window.removeEventListener("mousemove",Sr),window.removeEventListener("mouseup",Sr)}}});var nh=ie(ho=>{"use strict";Object.defineProperty(ho,"__esModule",{value:!0});ho.default=void 0;function Rs(e){"@babel/helpers - typeof";return Rs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rs(e)}function Jb(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Lf(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ew(r.key),r)}}function Zb(e,t,i){return t&&Lf(e.prototype,t),i&&Lf(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function ew(e){var t=tw(e,"string");return Rs(t)=="symbol"?t:t+""}function tw(e,t){if(Rs(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(Rs(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var H8=ho.default=function(){function e(){Jb(this,e),this._listeners=new Map}return Zb(e,[{key:"addEventListener",value:function(i,r){this._listeners.has(i)||this._listeners.set(i,new Set),this._listeners.get(i).add(r)}},{key:"removeEventListener",value:function(i,r){this._listeners.has(i)&&this._listeners.get(i).delete(r)}},{key:"dispatchEvent",value:function(i){var r=this;return this._listeners.has(i.type)?(this._listeners.get(i.type).forEach(function(s){return s.call(r,i)}),!i.defaultPrevented):!0}}])}()});var ah=ie(co=>{"use strict";function oh(e){"@babel/helpers - typeof";return oh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},oh(e)}Object.defineProperty(co,"__esModule",{value:!0});co.default=void 0;var iw=rw(wi());function Df(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(Df=function(s){return s?i:t})(e)}function rw(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||oh(e)!="object"&&typeof e!="function")return{default:e};var i=Df(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&{}.hasOwnProperty.call(e,n)){var o=s?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}var U8=co.default={toBase64Table:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split(""),base64Pad:"=",encode:function(t){"use strict";for(var i="",r=t.length,s=r%3,n=0;n<r-2;n+=3)i+=this.toBase64Table[t[n]>>2],i+=this.toBase64Table[((t[n]&3)<<4)+(t[n+1]>>4)],i+=this.toBase64Table[((t[n+1]&15)<<2)+(t[n+2]>>6)],i+=this.toBase64Table[t[n+2]&63];var o=r-s;return s===2?(i+=this.toBase64Table[t[o]>>2],i+=this.toBase64Table[((t[o]&3)<<4)+(t[o+1]>>4)],i+=this.toBase64Table[(t[o+1]&15)<<2],i+=this.toBase64Table[64]):s===1&&(i+=this.toBase64Table[t[o]>>2],i+=this.toBase64Table[(t[o]&3)<<4],i+=this.toBase64Table[64],i+=this.toBase64Table[64]),i},toBinaryTable:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],decode:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=t.indexOf("=")-i;r<0&&(r=t.length-i);for(var s=(r>>2)*3+Math.floor(r%4/1.5),n=new Array(s),o=0,a=0,h=0,l=i;l<t.length;l++){var c=this.toBinaryTable[t.charCodeAt(l)&127],u=t.charAt(l)===this.base64Pad;if(c===-1){iw.Error("Illegal character code "+t.charCodeAt(l)+" at position "+l);continue}a=a<<6|c,o+=6,o>=8&&(o-=8,u||(n[h++]=a>>o&255),a&=(1<<o)-1)}if(o){var p=new Error("Corrupted base64 string");throw p.name="Base64-Error",p}return n}}});var Rf=ie(uo=>{"use strict";Object.defineProperty(uo,"__esModule",{value:!0});uo.default=void 0;var qr=ow(wi()),sw=nw(ah()),If=ql();function nw(e){return e&&e.__esModule?e:{default:e}}function Tf(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(Tf=function(s){return s?i:t})(e)}function ow(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||Vr(e)!="object"&&typeof e!="function")return{default:e};var i=Tf(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&{}.hasOwnProperty.call(e,n)){var o=s?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}function Vr(e){"@babel/helpers - typeof";return Vr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vr(e)}function aw(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Mf(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,hw(r.key),r)}}function lw(e,t,i){return t&&Mf(e.prototype,t),i&&Mf(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function hw(e){var t=cw(e,"string");return Vr(t)=="symbol"?t:t+""}function cw(e,t){if(Vr(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(Vr(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var W8=uo.default=function(){function e(t){if(aw(this,e),this._drawCtx=null,this._renderQ=[],this._flushPromise=null,this._fbWidth=0,this._fbHeight=0,this._prevDrawStyle="",qr.Debug(">> Display.constructor"),this._target=t,!this._target)throw new Error("Target must be set");if(typeof this._target=="string")throw new Error("target must be a DOM element");if(!this._target.getContext)throw new Error("no getContext method");this._targetCtx=this._target.getContext("2d"),this._viewportLoc={x:0,y:0,w:this._target.width,h:this._target.height},this._backbuffer=document.createElement("canvas"),this._drawCtx=this._backbuffer.getContext("2d"),this._damageBounds={left:0,top:0,right:this._backbuffer.width,bottom:this._backbuffer.height},qr.Debug("User Agent: "+navigator.userAgent),qr.Debug("<< Display.constructor"),this._scale=1,this._clipViewport=!1}return lw(e,[{key:"scale",get:function(){return this._scale},set:function(i){this._rescale(i)}},{key:"clipViewport",get:function(){return this._clipViewport},set:function(i){this._clipViewport=i;var r=this._viewportLoc;this.viewportChangeSize(r.w,r.h),this.viewportChangePos(0,0)}},{key:"width",get:function(){return this._fbWidth}},{key:"height",get:function(){return this._fbHeight}},{key:"viewportChangePos",value:function(i,r){var s=this._viewportLoc;i=Math.floor(i),r=Math.floor(r),this._clipViewport||(i=-s.w,r=-s.h);var n=s.x+s.w-1,o=s.y+s.h-1;i<0&&s.x+i<0&&(i=-s.x),n+i>=this._fbWidth&&(i-=n+i-this._fbWidth+1),s.y+r<0&&(r=-s.y),o+r>=this._fbHeight&&(r-=o+r-this._fbHeight+1),!(i===0&&r===0)&&(qr.Debug("viewportChange deltaX: "+i+", deltaY: "+r),s.x+=i,s.y+=r,this._damage(s.x,s.y,s.w,s.h),this.flip())}},{key:"viewportChangeSize",value:function(i,r){(!this._clipViewport||typeof i>"u"||typeof r>"u")&&(qr.Debug("Setting viewport to full display region"),i=this._fbWidth,r=this._fbHeight),i=Math.floor(i),r=Math.floor(r),i>this._fbWidth&&(i=this._fbWidth),r>this._fbHeight&&(r=this._fbHeight);var s=this._viewportLoc;if(s.w!==i||s.h!==r){s.w=i,s.h=r;var n=this._target;n.width=i,n.height=r,this.viewportChangePos(0,0),this._damage(s.x,s.y,s.w,s.h),this.flip(),this._rescale(this._scale)}}},{key:"absX",value:function(i){return this._scale===0?0:(0,If.toSigned32bit)(i/this._scale+this._viewportLoc.x)}},{key:"absY",value:function(i){return this._scale===0?0:(0,If.toSigned32bit)(i/this._scale+this._viewportLoc.y)}},{key:"resize",value:function(i,r){this._prevDrawStyle="",this._fbWidth=i,this._fbHeight=r;var s=this._backbuffer;if(s.width!==i||s.height!==r){var n=null;s.width>0&&s.height>0&&(n=this._drawCtx.getImageData(0,0,s.width,s.height)),s.width!==i&&(s.width=i),s.height!==r&&(s.height=r),n&&this._drawCtx.putImageData(n,0,0)}var o=this._viewportLoc;this.viewportChangeSize(o.w,o.h),this.viewportChangePos(0,0)}},{key:"getImageData",value:function(){return this._drawCtx.getImageData(0,0,this.width,this.height)}},{key:"toDataURL",value:function(i,r){return this._backbuffer.toDataURL(i,r)}},{key:"toBlob",value:function(i,r,s){return this._backbuffer.toBlob(i,r,s)}},{key:"_damage",value:function(i,r,s,n){i<this._damageBounds.left&&(this._damageBounds.left=i),r<this._damageBounds.top&&(this._damageBounds.top=r),i+s>this._damageBounds.right&&(this._damageBounds.right=i+s),r+n>this._damageBounds.bottom&&(this._damageBounds.bottom=r+n)}},{key:"flip",value:function(i){if(this._renderQ.length!==0&&!i)this._renderQPush({type:"flip"});else{var r=this._damageBounds.left,s=this._damageBounds.top,n=this._damageBounds.right-r,o=this._damageBounds.bottom-s,a=r-this._viewportLoc.x,h=s-this._viewportLoc.y;a<0&&(n+=a,r-=a,a=0),h<0&&(o+=h,s-=h,h=0),a+n>this._viewportLoc.w&&(n=this._viewportLoc.w-a),h+o>this._viewportLoc.h&&(o=this._viewportLoc.h-h),n>0&&o>0&&this._targetCtx.drawImage(this._backbuffer,r,s,n,o,a,h,n,o),this._damageBounds.left=this._damageBounds.top=65535,this._damageBounds.right=this._damageBounds.bottom=0}}},{key:"pending",value:function(){return this._renderQ.length>0}},{key:"flush",value:function(){var i=this;return this._renderQ.length===0?Promise.resolve():(this._flushPromise===null&&(this._flushPromise=new Promise(function(r){i._flushResolve=r})),this._flushPromise)}},{key:"fillRect",value:function(i,r,s,n,o,a){this._renderQ.length!==0&&!a?this._renderQPush({type:"fill",x:i,y:r,width:s,height:n,color:o}):(this._setFillColor(o),this._drawCtx.fillRect(i,r,s,n),this._damage(i,r,s,n))}},{key:"copyImage",value:function(i,r,s,n,o,a,h){this._renderQ.length!==0&&!h?this._renderQPush({type:"copy",oldX:i,oldY:r,x:s,y:n,width:o,height:a}):(this._drawCtx.mozImageSmoothingEnabled=!1,this._drawCtx.webkitImageSmoothingEnabled=!1,this._drawCtx.msImageSmoothingEnabled=!1,this._drawCtx.imageSmoothingEnabled=!1,this._drawCtx.drawImage(this._backbuffer,i,r,o,a,s,n,o,a),this._damage(s,n,o,a))}},{key:"imageRect",value:function(i,r,s,n,o,a){if(!(s===0||n===0)){var h=new Image;h.src="data: "+o+";base64,"+sw.default.encode(a),this._renderQPush({type:"img",img:h,x:i,y:r,width:s,height:n})}}},{key:"blitImage",value:function(i,r,s,n,o,a,h){if(this._renderQ.length!==0&&!h){var l=new Uint8Array(s*n*4);l.set(new Uint8Array(o.buffer,0,l.length)),this._renderQPush({type:"blit",data:l,x:i,y:r,width:s,height:n})}else{var c=new Uint8ClampedArray(o.buffer,o.byteOffset+a,s*n*4),u=new ImageData(c,s,n);this._drawCtx.putImageData(u,i,r),this._damage(i,r,s,n)}}},{key:"drawImage",value:function(i,r,s){this._drawCtx.drawImage(i,r,s),this._damage(r,s,i.width,i.height)}},{key:"autoscale",value:function(i,r){var s;if(i===0||r===0)s=0;else{var n=this._viewportLoc,o=i/r,a=n.w/n.h;a>=o?s=i/n.w:s=r/n.h}this._rescale(s)}},{key:"_rescale",value:function(i){this._scale=i;var r=this._viewportLoc,s=i*r.w+"px",n=i*r.h+"px";(this._target.style.width!==s||this._target.style.height!==n)&&(this._target.style.width=s,this._target.style.height=n)}},{key:"_setFillColor",value:function(i){var r="rgb("+i[0]+","+i[1]+","+i[2]+")";r!==this._prevDrawStyle&&(this._drawCtx.fillStyle=r,this._prevDrawStyle=r)}},{key:"_renderQPush",value:function(i){this._renderQ.push(i),this._renderQ.length===1&&this._scanRenderQ()}},{key:"_resumeRenderQ",value:function(){this.removeEventListener("load",this._noVNCDisplay._resumeRenderQ),this._noVNCDisplay._scanRenderQ()}},{key:"_scanRenderQ",value:function(){for(var i=!0;i&&this._renderQ.length>0;){var r=this._renderQ[0];switch(r.type){case"flip":this.flip(!0);break;case"copy":this.copyImage(r.oldX,r.oldY,r.x,r.y,r.width,r.height,!0);break;case"fill":this.fillRect(r.x,r.y,r.width,r.height,r.color,!0);break;case"blit":this.blitImage(r.x,r.y,r.width,r.height,r.data,0,!0);break;case"img":if(r.img.complete){if(r.img.width!==r.width||r.img.height!==r.height){qr.Error("Decoded image has incorrect dimensions. Got "+r.img.width+"x"+r.img.height+". Expected "+r.width+"x"+r.height+".");return}this.drawImage(r.img,r.x,r.y)}else r.img._noVNCDisplay=this,r.img.addEventListener("load",this._resumeRenderQ),i=!1;break}i&&this._renderQ.shift()}this._renderQ.length===0&&this._flushPromise!==null&&(this._flushResolve(),this._flushPromise=null,this._flushResolve=null)}}])}()});var Fs=ie(Gt=>{"use strict";Object.defineProperty(Gt,"__esModule",{value:!0});Gt.Buf8=Gt.Buf32=Gt.Buf16=void 0;Gt.arraySet=dw;Gt.flattenChunks=fw;Gt.shrinkBuf=uw;function uw(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)}function dw(e,t,i,r,s){if(t.subarray&&e.subarray){e.set(t.subarray(i,i+r),s);return}for(var n=0;n<r;n++)e[s+n]=t[i+n]}function fw(e){var t,i,r,s,n,o;for(r=0,t=0,i=e.length;t<i;t++)r+=e[t].length;for(o=new Uint8Array(r),s=0,t=0,i=e.length;t<i;t++)n=e[t],o.set(n,s),s+=n.length;return o}var G8=Gt.Buf8=Uint8Array,j8=Gt.Buf16=Uint16Array,q8=Gt.Buf32=Int32Array});var hh=ie(lh=>{"use strict";Object.defineProperty(lh,"__esModule",{value:!0});lh.default=_w;function _w(e,t,i,r){for(var s=e&65535|0,n=e>>>16&65535|0,o=0;i!==0;){o=i>2e3?2e3:i,i-=o;do s=s+t[r++]|0,n=n+s|0;while(--o);s%=65521,n%=65521}return s|n<<16|0}});var uh=ie(ch=>{"use strict";Object.defineProperty(ch,"__esModule",{value:!0});ch.default=Ff;function Ff(){for(var e,t=[],i=0;i<256;i++){e=i;for(var r=0;r<8;r++)e=e&1?3988292384^e>>>1:e>>>1;t[i]=e}return t}var J8=Ff()});var Pf=ie(dh=>{"use strict";Object.defineProperty(dh,"__esModule",{value:!0});dh.default=pw;var fo=30,gw=12;function pw(e,t){var i,r,s,n,o,a,h,l,c,u,p,g,v,m,x,E,R,D,b,L,I,T,q,$,V;i=e.state,r=e.next_in,$=e.input,s=r+(e.avail_in-5),n=e.next_out,V=e.output,o=n-(t-e.avail_out),a=n+(e.avail_out-257),h=i.dmax,l=i.wsize,c=i.whave,u=i.wnext,p=i.window,g=i.hold,v=i.bits,m=i.lencode,x=i.distcode,E=(1<<i.lenbits)-1,R=(1<<i.distbits)-1;e:do{v<15&&(g+=$[r++]<<v,v+=8,g+=$[r++]<<v,v+=8),D=m[g&E];t:for(;;){if(b=D>>>24,g>>>=b,v-=b,b=D>>>16&255,b===0)V[n++]=D&65535;else if(b&16){L=D&65535,b&=15,b&&(v<b&&(g+=$[r++]<<v,v+=8),L+=g&(1<<b)-1,g>>>=b,v-=b),v<15&&(g+=$[r++]<<v,v+=8,g+=$[r++]<<v,v+=8),D=x[g&R];i:for(;;){if(b=D>>>24,g>>>=b,v-=b,b=D>>>16&255,b&16){if(I=D&65535,b&=15,v<b&&(g+=$[r++]<<v,v+=8,v<b&&(g+=$[r++]<<v,v+=8)),I+=g&(1<<b)-1,I>h){e.msg="invalid distance too far back",i.mode=fo;break e}if(g>>>=b,v-=b,b=n-o,I>b){if(b=I-b,b>c&&i.sane){e.msg="invalid distance too far back",i.mode=fo;break e}if(T=0,q=p,u===0){if(T+=l-b,b<L){L-=b;do V[n++]=p[T++];while(--b);T=n-I,q=V}}else if(u<b){if(T+=l+u-b,b-=u,b<L){L-=b;do V[n++]=p[T++];while(--b);if(T=0,u<L){b=u,L-=b;do V[n++]=p[T++];while(--b);T=n-I,q=V}}}else if(T+=u-b,b<L){L-=b;do V[n++]=p[T++];while(--b);T=n-I,q=V}for(;L>2;)V[n++]=q[T++],V[n++]=q[T++],V[n++]=q[T++],L-=3;L&&(V[n++]=q[T++],L>1&&(V[n++]=q[T++]))}else{T=n-I;do V[n++]=V[T++],V[n++]=V[T++],V[n++]=V[T++],L-=3;while(L>2);L&&(V[n++]=V[T++],L>1&&(V[n++]=V[T++]))}}else if((b&64)===0){D=x[(D&65535)+(g&(1<<b)-1)];continue i}else{e.msg="invalid distance code",i.mode=fo;break e}break}}else if((b&64)===0){D=m[(D&65535)+(g&(1<<b)-1)];continue t}else if(b&32){i.mode=gw;break e}else{e.msg="invalid literal/length code",i.mode=fo;break e}break}}while(r<s&&n<a);L=v>>3,r-=L,v-=L<<3,g&=(1<<v)-1,e.next_in=r,e.next_out=n,e.avail_in=r<s?5+(s-r):5-(r-s),e.avail_out=n<a?257+(a-n):257-(n-a),i.hold=g,i.bits=v}});var Uf=ie(gh=>{"use strict";function _h(e){"@babel/helpers - typeof";return _h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_h(e)}Object.defineProperty(gh,"__esModule",{value:!0});gh.default=Aw;var Of=vw(Fs());function Xf(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(Xf=function(s){return s?i:t})(e)}function vw(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||_h(e)!="object"&&typeof e!="function")return{default:e};var i=Xf(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&{}.hasOwnProperty.call(e,n)){var o=s?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}var Yr=15,Kf=852,Nf=592,Qf=0,fh=1,Hf=2,mw=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],yw=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],bw=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],ww=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function Aw(e,t,i,r,s,n,o,a){var h=a.bits,l=0,c=0,u=0,p=0,g=0,v=0,m=0,x=0,E=0,R=0,D,b,L,I,T,q=null,$=0,V,j=new Of.Buf16(Yr+1),ne=new Of.Buf16(Yr+1),C=null,w=0,k,f,d;for(l=0;l<=Yr;l++)j[l]=0;for(c=0;c<r;c++)j[t[i+c]]++;for(g=h,p=Yr;p>=1&&j[p]===0;p--);if(g>p&&(g=p),p===0)return s[n++]=1<<24|64<<16|0,s[n++]=1<<24|64<<16|0,a.bits=1,0;for(u=1;u<p&&j[u]===0;u++);for(g<u&&(g=u),x=1,l=1;l<=Yr;l++)if(x<<=1,x-=j[l],x<0)return-1;if(x>0&&(e===Qf||p!==1))return-1;for(ne[1]=0,l=1;l<Yr;l++)ne[l+1]=ne[l]+j[l];for(c=0;c<r;c++)t[i+c]!==0&&(o[ne[t[i+c]]++]=c);if(e===Qf?(q=C=o,V=19):e===fh?(q=mw,$-=257,C=yw,w-=257,V=256):(q=bw,C=ww,V=-1),R=0,c=0,l=u,T=n,v=g,m=0,L=-1,E=1<<g,I=E-1,e===fh&&E>Kf||e===Hf&&E>Nf)return 1;for(;;){k=l-m,o[c]<V?(f=0,d=o[c]):o[c]>V?(f=C[w+o[c]],d=q[$+o[c]]):(f=96,d=0),D=1<<l-m,b=1<<v,u=b;do b-=D,s[T+(R>>m)+b]=k<<24|f<<16|d|0;while(b!==0);for(D=1<<l-1;R&D;)D>>=1;if(D!==0?(R&=D-1,R+=D):R=0,c++,--j[l]===0){if(l===p)break;l=t[i+o[c]]}if(l>g&&(R&I)!==L){for(m===0&&(m=g),T+=u,v=l-m,x=1<<v;v+m<p&&(x-=j[v+m],!(x<=0));)v++,x<<=1;if(E+=1<<v,e===fh&&E>Kf||e===Hf&&E>Nf)return 1;L=R&I,s[L]=g<<24|v<<16|T-n|0}}return R!==0&&(s[T+R]=l-m<<24|64<<16|0),a.bits=g,0}});var C_=ie(he=>{"use strict";function wh(e){"@babel/helpers - typeof";return wh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wh(e)}Object.defineProperty(he,"__esModule",{value:!0});he.Z_TREES=he.Z_STREAM_ERROR=he.Z_STREAM_END=he.Z_OK=he.Z_NEED_DICT=he.Z_MEM_ERROR=he.Z_FINISH=he.Z_DEFLATED=he.Z_DATA_ERROR=he.Z_BUF_ERROR=he.Z_BLOCK=void 0;he.inflate=Kw;he.inflateEnd=Nw;he.inflateGetHeader=Qw;he.inflateInfo=void 0;he.inflateInit=Pw;he.inflateInit2=x_;he.inflateReset=w_;he.inflateReset2=A_;he.inflateResetKeep=b_;he.inflateSetDictionary=Hw;var St=Sw(Fs()),Ah=mo(hh()),ti=mo(uh()),xw=mo(Pf()),Ps=mo(Uf());function mo(e){return e&&e.__esModule?e:{default:e}}function g_(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(g_=function(s){return s?i:t})(e)}function Sw(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||wh(e)!="object"&&typeof e!="function")return{default:e};var i=g_(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&{}.hasOwnProperty.call(e,n)){var o=s?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}var Cw=0,p_=1,v_=2,zf=he.Z_FINISH=4,kw=he.Z_BLOCK=5,_o=he.Z_TREES=6,Cr=he.Z_OK=0,Ew=he.Z_STREAM_END=1,Bw=he.Z_NEED_DICT=2,Rt=he.Z_STREAM_ERROR=-2,m_=he.Z_DATA_ERROR=-3,xh=he.Z_MEM_ERROR=-4,Lw=he.Z_BUF_ERROR=-5,Wf=he.Z_DEFLATED=8,y_=1,$f=2,Gf=3,jf=4,qf=5,Vf=6,Yf=7,Jf=8,Zf=9,e_=10,vo=11,Ai=12,ph=13,t_=14,vh=15,i_=16,r_=17,s_=18,n_=19,go=20,po=21,o_=22,a_=23,l_=24,h_=25,c_=26,mh=27,u_=28,d_=29,xe=30,Sh=31,Dw=32,Iw=852,Mw=592,Tw=15,Rw=Tw;function f_(e){return(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24)}function Fw(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new St.Buf16(320),this.work=new St.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function b_(e){var t;return!e||!e.state?Rt:(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=t.wrap&1),t.mode=y_,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new St.Buf32(Iw),t.distcode=t.distdyn=new St.Buf32(Mw),t.sane=1,t.back=-1,Cr)}function w_(e){var t;return!e||!e.state?Rt:(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,b_(e))}function A_(e,t){var i,r;return!e||!e.state||(r=e.state,t<0?(i=0,t=-t):(i=(t>>4)+1,t<48&&(t&=15)),t&&(t<8||t>15))?Rt:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=i,r.wbits=t,w_(e))}function x_(e,t){var i,r;return e?(r=new Fw,e.state=r,r.window=null,i=A_(e,t),i!==Cr&&(e.state=null),i):Rt}function Pw(e){return x_(e,Rw)}var __=!0,yh,bh;function Ow(e){if(__){var t;for(yh=new St.Buf32(512),bh=new St.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for((0,Ps.default)(p_,e.lens,0,288,yh,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;(0,Ps.default)(v_,e.lens,0,32,bh,0,e.work,{bits:5}),__=!1}e.lencode=yh,e.lenbits=9,e.distcode=bh,e.distbits=5}function S_(e,t,i,r){var s,n=e.state;return n.window===null&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new St.Buf8(n.wsize)),r>=n.wsize?(St.arraySet(n.window,t,i-n.wsize,n.wsize,0),n.wnext=0,n.whave=n.wsize):(s=n.wsize-n.wnext,s>r&&(s=r),St.arraySet(n.window,t,i-r,s,n.wnext),r-=s,r?(St.arraySet(n.window,t,i-r,r,0),n.wnext=r,n.whave=n.wsize):(n.wnext+=s,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=s))),0}function Kw(e,t){var i,r,s,n,o,a,h,l,c,u,p,g,v,m,x=0,E,R,D,b,L,I,T,q,$=new St.Buf8(4),V,j,ne=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&e.avail_in!==0)return Rt;i=e.state,i.mode===Ai&&(i.mode=ph),o=e.next_out,s=e.output,h=e.avail_out,n=e.next_in,r=e.input,a=e.avail_in,l=i.hold,c=i.bits,u=a,p=h,q=Cr;e:for(;;)switch(i.mode){case y_:if(i.wrap===0){i.mode=ph;break}for(;c<16;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}if(i.wrap&2&&l===35615){i.check=0,$[0]=l&255,$[1]=l>>>8&255,i.check=(0,ti.default)(i.check,$,2,0),l=0,c=0,i.mode=$f;break}if(i.flags=0,i.head&&(i.head.done=!1),!(i.wrap&1)||(((l&255)<<8)+(l>>8))%31){e.msg="incorrect header check",i.mode=xe;break}if((l&15)!==Wf){e.msg="unknown compression method",i.mode=xe;break}if(l>>>=4,c-=4,T=(l&15)+8,i.wbits===0)i.wbits=T;else if(T>i.wbits){e.msg="invalid window size",i.mode=xe;break}i.dmax=1<<T,e.adler=i.check=1,i.mode=l&512?e_:Ai,l=0,c=0;break;case $f:for(;c<16;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}if(i.flags=l,(i.flags&255)!==Wf){e.msg="unknown compression method",i.mode=xe;break}if(i.flags&57344){e.msg="unknown header flags set",i.mode=xe;break}i.head&&(i.head.text=l>>8&1),i.flags&512&&($[0]=l&255,$[1]=l>>>8&255,i.check=(0,ti.default)(i.check,$,2,0)),l=0,c=0,i.mode=Gf;case Gf:for(;c<32;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}i.head&&(i.head.time=l),i.flags&512&&($[0]=l&255,$[1]=l>>>8&255,$[2]=l>>>16&255,$[3]=l>>>24&255,i.check=(0,ti.default)(i.check,$,4,0)),l=0,c=0,i.mode=jf;case jf:for(;c<16;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}i.head&&(i.head.xflags=l&255,i.head.os=l>>8),i.flags&512&&($[0]=l&255,$[1]=l>>>8&255,i.check=(0,ti.default)(i.check,$,2,0)),l=0,c=0,i.mode=qf;case qf:if(i.flags&1024){for(;c<16;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}i.length=l,i.head&&(i.head.extra_len=l),i.flags&512&&($[0]=l&255,$[1]=l>>>8&255,i.check=(0,ti.default)(i.check,$,2,0)),l=0,c=0}else i.head&&(i.head.extra=null);i.mode=Vf;case Vf:if(i.flags&1024&&(g=i.length,g>a&&(g=a),g&&(i.head&&(T=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),St.arraySet(i.head.extra,r,n,g,T)),i.flags&512&&(i.check=(0,ti.default)(i.check,r,g,n)),a-=g,n+=g,i.length-=g),i.length))break e;i.length=0,i.mode=Yf;case Yf:if(i.flags&2048){if(a===0)break e;g=0;do T=r[n+g++],i.head&&T&&i.length<65536&&(i.head.name+=String.fromCharCode(T));while(T&&g<a);if(i.flags&512&&(i.check=(0,ti.default)(i.check,r,g,n)),a-=g,n+=g,T)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=Jf;case Jf:if(i.flags&4096){if(a===0)break e;g=0;do T=r[n+g++],i.head&&T&&i.length<65536&&(i.head.comment+=String.fromCharCode(T));while(T&&g<a);if(i.flags&512&&(i.check=(0,ti.default)(i.check,r,g,n)),a-=g,n+=g,T)break e}else i.head&&(i.head.comment=null);i.mode=Zf;case Zf:if(i.flags&512){for(;c<16;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}if(l!==(i.check&65535)){e.msg="header crc mismatch",i.mode=xe;break}l=0,c=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=Ai;break;case e_:for(;c<32;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}e.adler=i.check=f_(l),l=0,c=0,i.mode=vo;case vo:if(i.havedict===0)return e.next_out=o,e.avail_out=h,e.next_in=n,e.avail_in=a,i.hold=l,i.bits=c,Bw;e.adler=i.check=1,i.mode=Ai;case Ai:if(t===kw||t===_o)break e;case ph:if(i.last){l>>>=c&7,c-=c&7,i.mode=mh;break}for(;c<3;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}switch(i.last=l&1,l>>>=1,c-=1,l&3){case 0:i.mode=t_;break;case 1:if(Ow(i),i.mode=go,t===_o){l>>>=2,c-=2;break e}break;case 2:i.mode=r_;break;case 3:e.msg="invalid block type",i.mode=xe}l>>>=2,c-=2;break;case t_:for(l>>>=c&7,c-=c&7;c<32;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}if((l&65535)!==(l>>>16^65535)){e.msg="invalid stored block lengths",i.mode=xe;break}if(i.length=l&65535,l=0,c=0,i.mode=vh,t===_o)break e;case vh:i.mode=i_;case i_:if(g=i.length,g){if(g>a&&(g=a),g>h&&(g=h),g===0)break e;St.arraySet(s,r,n,g,o),a-=g,n+=g,h-=g,o+=g,i.length-=g;break}i.mode=Ai;break;case r_:for(;c<14;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}if(i.nlen=(l&31)+257,l>>>=5,c-=5,i.ndist=(l&31)+1,l>>>=5,c-=5,i.ncode=(l&15)+4,l>>>=4,c-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=xe;break}i.have=0,i.mode=s_;case s_:for(;i.have<i.ncode;){for(;c<3;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}i.lens[ne[i.have++]]=l&7,l>>>=3,c-=3}for(;i.have<19;)i.lens[ne[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,V={bits:i.lenbits},q=(0,Ps.default)(Cw,i.lens,0,19,i.lencode,0,i.work,V),i.lenbits=V.bits,q){e.msg="invalid code lengths set",i.mode=xe;break}i.have=0,i.mode=n_;case n_:for(;i.have<i.nlen+i.ndist;){for(;x=i.lencode[l&(1<<i.lenbits)-1],E=x>>>24,R=x>>>16&255,D=x&65535,!(E<=c);){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}if(D<16)l>>>=E,c-=E,i.lens[i.have++]=D;else{if(D===16){for(j=E+2;c<j;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}if(l>>>=E,c-=E,i.have===0){e.msg="invalid bit length repeat",i.mode=xe;break}T=i.lens[i.have-1],g=3+(l&3),l>>>=2,c-=2}else if(D===17){for(j=E+3;c<j;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}l>>>=E,c-=E,T=0,g=3+(l&7),l>>>=3,c-=3}else{for(j=E+7;c<j;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}l>>>=E,c-=E,T=0,g=11+(l&127),l>>>=7,c-=7}if(i.have+g>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=xe;break}for(;g--;)i.lens[i.have++]=T}}if(i.mode===xe)break;if(i.lens[256]===0){e.msg="invalid code -- missing end-of-block",i.mode=xe;break}if(i.lenbits=9,V={bits:i.lenbits},q=(0,Ps.default)(p_,i.lens,0,i.nlen,i.lencode,0,i.work,V),i.lenbits=V.bits,q){e.msg="invalid literal/lengths set",i.mode=xe;break}if(i.distbits=6,i.distcode=i.distdyn,V={bits:i.distbits},q=(0,Ps.default)(v_,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,V),i.distbits=V.bits,q){e.msg="invalid distances set",i.mode=xe;break}if(i.mode=go,t===_o)break e;case go:i.mode=po;case po:if(a>=6&&h>=258){e.next_out=o,e.avail_out=h,e.next_in=n,e.avail_in=a,i.hold=l,i.bits=c,(0,xw.default)(e,p),o=e.next_out,s=e.output,h=e.avail_out,n=e.next_in,r=e.input,a=e.avail_in,l=i.hold,c=i.bits,i.mode===Ai&&(i.back=-1);break}for(i.back=0;x=i.lencode[l&(1<<i.lenbits)-1],E=x>>>24,R=x>>>16&255,D=x&65535,!(E<=c);){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}if(R&&(R&240)===0){for(b=E,L=R,I=D;x=i.lencode[I+((l&(1<<b+L)-1)>>b)],E=x>>>24,R=x>>>16&255,D=x&65535,!(b+E<=c);){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}l>>>=b,c-=b,i.back+=b}if(l>>>=E,c-=E,i.back+=E,i.length=D,R===0){i.mode=c_;break}if(R&32){i.back=-1,i.mode=Ai;break}if(R&64){e.msg="invalid literal/length code",i.mode=xe;break}i.extra=R&15,i.mode=o_;case o_:if(i.extra){for(j=i.extra;c<j;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}i.length+=l&(1<<i.extra)-1,l>>>=i.extra,c-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=a_;case a_:for(;x=i.distcode[l&(1<<i.distbits)-1],E=x>>>24,R=x>>>16&255,D=x&65535,!(E<=c);){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}if((R&240)===0){for(b=E,L=R,I=D;x=i.distcode[I+((l&(1<<b+L)-1)>>b)],E=x>>>24,R=x>>>16&255,D=x&65535,!(b+E<=c);){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}l>>>=b,c-=b,i.back+=b}if(l>>>=E,c-=E,i.back+=E,R&64){e.msg="invalid distance code",i.mode=xe;break}i.offset=D,i.extra=R&15,i.mode=l_;case l_:if(i.extra){for(j=i.extra;c<j;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}i.offset+=l&(1<<i.extra)-1,l>>>=i.extra,c-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=xe;break}i.mode=h_;case h_:if(h===0)break e;if(g=p-h,i.offset>g){if(g=i.offset-g,g>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=xe;break}g>i.wnext?(g-=i.wnext,v=i.wsize-g):v=i.wnext-g,g>i.length&&(g=i.length),m=i.window}else m=s,v=o-i.offset,g=i.length;g>h&&(g=h),h-=g,i.length-=g;do s[o++]=m[v++];while(--g);i.length===0&&(i.mode=po);break;case c_:if(h===0)break e;s[o++]=i.length,h--,i.mode=po;break;case mh:if(i.wrap){for(;c<32;){if(a===0)break e;a--,l|=r[n++]<<c,c+=8}if(p-=h,e.total_out+=p,i.total+=p,p&&(e.adler=i.check=i.flags?(0,ti.default)(i.check,s,p,o-p):(0,Ah.default)(i.check,s,p,o-p)),p=h,(i.flags?l:f_(l))!==i.check){e.msg="incorrect data check",i.mode=xe;break}l=0,c=0}i.mode=u_;case u_:if(i.wrap&&i.flags){for(;c<32;){if(a===0)break e;a--,l+=r[n++]<<c,c+=8}if(l!==(i.total&4294967295)){e.msg="incorrect length check",i.mode=xe;break}l=0,c=0}i.mode=d_;case d_:q=Ew;break e;case xe:q=m_;break e;case Sh:return xh;case Dw:default:return Rt}return e.next_out=o,e.avail_out=h,e.next_in=n,e.avail_in=a,i.hold=l,i.bits=c,(i.wsize||p!==e.avail_out&&i.mode<xe&&(i.mode<mh||t!==zf))&&S_(e,e.output,e.next_out,p-e.avail_out)?(i.mode=Sh,xh):(u-=e.avail_in,p-=e.avail_out,e.total_in+=u,e.total_out+=p,i.total+=p,i.wrap&&p&&(e.adler=i.check=i.flags?(0,ti.default)(i.check,s,p,e.next_out-p):(0,Ah.default)(i.check,s,p,e.next_out-p)),e.data_type=i.bits+(i.last?64:0)+(i.mode===Ai?128:0)+(i.mode===go||i.mode===vh?256:0),(u===0&&p===0||t===zf)&&q===Cr&&(q=Lw),q)}function Nw(e){if(!e||!e.state)return Rt;var t=e.state;return t.window&&(t.window=null),e.state=null,Cr}function Qw(e,t){var i;return!e||!e.state||(i=e.state,(i.wrap&2)===0)?Rt:(i.head=t,t.done=!1,Cr)}function Hw(e,t){var i=t.length,r,s,n;return!e||!e.state||(r=e.state,r.wrap!==0&&r.mode!==vo)?Rt:r.mode===vo&&(s=1,s=(0,Ah.default)(s,t,i,0),s!==r.check)?m_:(n=S_(e,t,i,i),n?(r.mode=Sh,xh):(r.havedict=1,Cr))}var i4=he.inflateInfo="pako inflate (from Nodeca project)"});var kh=ie(Ch=>{"use strict";Object.defineProperty(Ch,"__esModule",{value:!0});Ch.default=Xw;function Xw(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}});var bo=ie(yo=>{"use strict";Object.defineProperty(yo,"__esModule",{value:!0});yo.default=void 0;var Eh=C_(),Uw=zw(kh());function zw(e){return e&&e.__esModule?e:{default:e}}function Os(e){"@babel/helpers - typeof";return Os=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Os(e)}function Ww(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function k_(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Gw(r.key),r)}}function $w(e,t,i){return t&&k_(e.prototype,t),i&&k_(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function Gw(e){var t=jw(e,"string");return Os(t)=="symbol"?t:t+""}function jw(e,t){if(Os(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(Os(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var n4=yo.default=function(){function e(){Ww(this,e),this.strm=new Uw.default,this.chunkSize=1024*10*10,this.strm.output=new Uint8Array(this.chunkSize),(0,Eh.inflateInit)(this.strm)}return $w(e,[{key:"setInput",value:function(i){i?(this.strm.input=i,this.strm.avail_in=this.strm.input.length,this.strm.next_in=0):(this.strm.input=null,this.strm.avail_in=0,this.strm.next_in=0)}},{key:"inflate",value:function(i){i>this.chunkSize&&(this.chunkSize=i,this.strm.output=new Uint8Array(this.chunkSize)),this.strm.next_out=0,this.strm.avail_out=i;var r=(0,Eh.inflate)(this.strm,0);if(r<0)throw new Error("zlib inflate failed");if(this.strm.next_out!=i)throw new Error("Incomplete zlib block");return new Uint8Array(this.strm.output.buffer,0,this.strm.next_out)}},{key:"reset",value:function(){(0,Eh.inflateReset)(this.strm)}}])}()});var V_=ie(Er=>{"use strict";function Mh(e){"@babel/helpers - typeof";return Mh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mh(e)}Object.defineProperty(Er,"__esModule",{value:!0});Er._tr_align=_A;Er._tr_flush_block=gA;Er._tr_init=fA;Er._tr_stored_block=q_;Er._tr_tally=pA;var qw=Vw(Fs());function R_(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(R_=function(s){return s?i:t})(e)}function Vw(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||Mh(e)!="object"&&typeof e!="function")return{default:e};var i=R_(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&{}.hasOwnProperty.call(e,n)){var o=s?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}var Yw=4,E_=0,B_=1,Jw=2;function Zr(e){for(var t=e.length;--t>=0;)e[t]=0}var Zw=0,F_=1,eA=2,tA=3,iA=258,Fh=29,Us=256,Ns=Us+1+Fh,Jr=30,Ph=19,P_=2*Ns+1,kr=15,Bh=16,rA=7,Oh=256,O_=16,K_=17,N_=18,Th=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],wo=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],sA=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Q_=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],nA=512,xi=new Array((Ns+2)*2);Zr(xi);var Ks=new Array(Jr*2);Zr(Ks);var Qs=new Array(nA);Zr(Qs);var Hs=new Array(iA-tA+1);Zr(Hs);var Kh=new Array(Fh);Zr(Kh);var Ao=new Array(Jr);Zr(Ao);function Lh(e,t,i,r,s){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=r,this.max_length=s,this.has_stree=e&&e.length}var H_,X_,U_;function Dh(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function z_(e){return e<256?Qs[e]:Qs[256+(e>>>7)]}function Xs(e,t){e.pending_buf[e.pending++]=t&255,e.pending_buf[e.pending++]=t>>>8&255}function yt(e,t,i){e.bi_valid>Bh-i?(e.bi_buf|=t<<e.bi_valid&65535,Xs(e,e.bi_buf),e.bi_buf=t>>Bh-e.bi_valid,e.bi_valid+=i-Bh):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)}function ii(e,t,i){yt(e,i[t*2],i[t*2+1])}function W_(e,t){var i=0;do i|=e&1,e>>>=1,i<<=1;while(--t>0);return i>>>1}function oA(e){e.bi_valid===16?(Xs(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)}function aA(e,t){var i=t.dyn_tree,r=t.max_code,s=t.stat_desc.static_tree,n=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,a=t.stat_desc.extra_base,h=t.stat_desc.max_length,l,c,u,p,g,v,m=0;for(p=0;p<=kr;p++)e.bl_count[p]=0;for(i[e.heap[e.heap_max]*2+1]=0,l=e.heap_max+1;l<P_;l++)c=e.heap[l],p=i[i[c*2+1]*2+1]+1,p>h&&(p=h,m++),i[c*2+1]=p,!(c>r)&&(e.bl_count[p]++,g=0,c>=a&&(g=o[c-a]),v=i[c*2],e.opt_len+=v*(p+g),n&&(e.static_len+=v*(s[c*2+1]+g)));if(m!==0){do{for(p=h-1;e.bl_count[p]===0;)p--;e.bl_count[p]--,e.bl_count[p+1]+=2,e.bl_count[h]--,m-=2}while(m>0);for(p=h;p!==0;p--)for(c=e.bl_count[p];c!==0;)u=e.heap[--l],!(u>r)&&(i[u*2+1]!==p&&(e.opt_len+=(p-i[u*2+1])*i[u*2],i[u*2+1]=p),c--)}}function $_(e,t,i){var r=new Array(kr+1),s=0,n,o;for(n=1;n<=kr;n++)r[n]=s=s+i[n-1]<<1;for(o=0;o<=t;o++){var a=e[o*2+1];a!==0&&(e[o*2]=W_(r[a]++,a))}}function lA(){var e,t,i,r,s,n=new Array(kr+1);for(i=0,r=0;r<Fh-1;r++)for(Kh[r]=i,e=0;e<1<<Th[r];e++)Hs[i++]=r;for(Hs[i-1]=r,s=0,r=0;r<16;r++)for(Ao[r]=s,e=0;e<1<<wo[r];e++)Qs[s++]=r;for(s>>=7;r<Jr;r++)for(Ao[r]=s<<7,e=0;e<1<<wo[r]-7;e++)Qs[256+s++]=r;for(t=0;t<=kr;t++)n[t]=0;for(e=0;e<=143;)xi[e*2+1]=8,e++,n[8]++;for(;e<=255;)xi[e*2+1]=9,e++,n[9]++;for(;e<=279;)xi[e*2+1]=7,e++,n[7]++;for(;e<=287;)xi[e*2+1]=8,e++,n[8]++;for($_(xi,Ns+1,n),e=0;e<Jr;e++)Ks[e*2+1]=5,Ks[e*2]=W_(e,5);H_=new Lh(xi,Th,Us+1,Ns,kr),X_=new Lh(Ks,wo,0,Jr,kr),U_=new Lh(new Array(0),sA,0,Ph,rA)}function G_(e){var t;for(t=0;t<Ns;t++)e.dyn_ltree[t*2]=0;for(t=0;t<Jr;t++)e.dyn_dtree[t*2]=0;for(t=0;t<Ph;t++)e.bl_tree[t*2]=0;e.dyn_ltree[Oh*2]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function j_(e){e.bi_valid>8?Xs(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function hA(e,t,i,r){j_(e),r&&(Xs(e,i),Xs(e,~i)),qw.arraySet(e.pending_buf,e.window,t,i,e.pending),e.pending+=i}function L_(e,t,i,r){var s=t*2,n=i*2;return e[s]<e[n]||e[s]===e[n]&&r[t]<=r[i]}function Ih(e,t,i){for(var r=e.heap[i],s=i<<1;s<=e.heap_len&&(s<e.heap_len&&L_(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!L_(t,r,e.heap[s],e.depth));)e.heap[i]=e.heap[s],i=s,s<<=1;e.heap[i]=r}function D_(e,t,i){var r,s,n=0,o,a;if(e.last_lit!==0)do r=e.pending_buf[e.d_buf+n*2]<<8|e.pending_buf[e.d_buf+n*2+1],s=e.pending_buf[e.l_buf+n],n++,r===0?ii(e,s,t):(o=Hs[s],ii(e,o+Us+1,t),a=Th[o],a!==0&&(s-=Kh[o],yt(e,s,a)),r--,o=z_(r),ii(e,o,i),a=wo[o],a!==0&&(r-=Ao[o],yt(e,r,a)));while(n<e.last_lit);ii(e,Oh,t)}function Rh(e,t){var i=t.dyn_tree,r=t.stat_desc.static_tree,s=t.stat_desc.has_stree,n=t.stat_desc.elems,o,a,h=-1,l;for(e.heap_len=0,e.heap_max=P_,o=0;o<n;o++)i[o*2]!==0?(e.heap[++e.heap_len]=h=o,e.depth[o]=0):i[o*2+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=h<2?++h:0,i[l*2]=1,e.depth[l]=0,e.opt_len--,s&&(e.static_len-=r[l*2+1]);for(t.max_code=h,o=e.heap_len>>1;o>=1;o--)Ih(e,i,o);l=n;do o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Ih(e,i,1),a=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=a,i[l*2]=i[o*2]+i[a*2],e.depth[l]=(e.depth[o]>=e.depth[a]?e.depth[o]:e.depth[a])+1,i[o*2+1]=i[a*2+1]=l,e.heap[1]=l++,Ih(e,i,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],aA(e,t),$_(i,h,e.bl_count)}function I_(e,t,i){var r,s=-1,n,o=t[0*2+1],a=0,h=7,l=4;for(o===0&&(h=138,l=3),t[(i+1)*2+1]=65535,r=0;r<=i;r++)n=o,o=t[(r+1)*2+1],!(++a<h&&n===o)&&(a<l?e.bl_tree[n*2]+=a:n!==0?(n!==s&&e.bl_tree[n*2]++,e.bl_tree[O_*2]++):a<=10?e.bl_tree[K_*2]++:e.bl_tree[N_*2]++,a=0,s=n,o===0?(h=138,l=3):n===o?(h=6,l=3):(h=7,l=4))}function M_(e,t,i){var r,s=-1,n,o=t[0*2+1],a=0,h=7,l=4;for(o===0&&(h=138,l=3),r=0;r<=i;r++)if(n=o,o=t[(r+1)*2+1],!(++a<h&&n===o)){if(a<l)do ii(e,n,e.bl_tree);while(--a!==0);else n!==0?(n!==s&&(ii(e,n,e.bl_tree),a--),ii(e,O_,e.bl_tree),yt(e,a-3,2)):a<=10?(ii(e,K_,e.bl_tree),yt(e,a-3,3)):(ii(e,N_,e.bl_tree),yt(e,a-11,7));a=0,s=n,o===0?(h=138,l=3):n===o?(h=6,l=3):(h=7,l=4)}}function cA(e){var t;for(I_(e,e.dyn_ltree,e.l_desc.max_code),I_(e,e.dyn_dtree,e.d_desc.max_code),Rh(e,e.bl_desc),t=Ph-1;t>=3&&e.bl_tree[Q_[t]*2+1]===0;t--);return e.opt_len+=3*(t+1)+5+5+4,t}function uA(e,t,i,r){var s;for(yt(e,t-257,5),yt(e,i-1,5),yt(e,r-4,4),s=0;s<r;s++)yt(e,e.bl_tree[Q_[s]*2+1],3);M_(e,e.dyn_ltree,t-1),M_(e,e.dyn_dtree,i-1)}function dA(e){var t=4093624447,i;for(i=0;i<=31;i++,t>>>=1)if(t&1&&e.dyn_ltree[i*2]!==0)return E_;if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0)return B_;for(i=32;i<Us;i++)if(e.dyn_ltree[i*2]!==0)return B_;return E_}var T_=!1;function fA(e){T_||(lA(),T_=!0),e.l_desc=new Dh(e.dyn_ltree,H_),e.d_desc=new Dh(e.dyn_dtree,X_),e.bl_desc=new Dh(e.bl_tree,U_),e.bi_buf=0,e.bi_valid=0,G_(e)}function q_(e,t,i,r){yt(e,(Zw<<1)+(r?1:0),3),hA(e,t,i,!0)}function _A(e){yt(e,F_<<1,3),ii(e,Oh,xi),oA(e)}function gA(e,t,i,r){var s,n,o=0;e.level>0?(e.strm.data_type===Jw&&(e.strm.data_type=dA(e)),Rh(e,e.l_desc),Rh(e,e.d_desc),o=cA(e),s=e.opt_len+3+7>>>3,n=e.static_len+3+7>>>3,n<=s&&(s=n)):s=n=i+5,i+4<=s&&t!==-1?q_(e,t,i,r):e.strategy===Yw||n===s?(yt(e,(F_<<1)+(r?1:0),3),D_(e,xi,Ks)):(yt(e,(eA<<1)+(r?1:0),3),uA(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),D_(e,e.dyn_ltree,e.dyn_dtree)),G_(e),r&&j_(e)}function pA(e,t,i){return e.pending_buf[e.d_buf+e.last_lit*2]=t>>>8&255,e.pending_buf[e.d_buf+e.last_lit*2+1]=t&255,e.pending_buf[e.l_buf+e.last_lit]=i&255,e.last_lit++,t===0?e.dyn_ltree[i*2]++:(e.matches++,t--,e.dyn_ltree[(Hs[i]+Us+1)*2]++,e.dyn_dtree[z_(t)*2]++),e.last_lit===e.lit_bufsize-1}});var Y_=ie(xo=>{"use strict";Object.defineProperty(xo,"__esModule",{value:!0});xo.default=void 0;var l4=xo.default={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}});var l0=ie(re=>{"use strict";function Hh(e){"@babel/helpers - typeof";return Hh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hh(e)}Object.defineProperty(re,"__esModule",{value:!0});re.Z_UNKNOWN=re.Z_STREAM_ERROR=re.Z_STREAM_END=re.Z_RLE=re.Z_PARTIAL_FLUSH=re.Z_OK=re.Z_NO_FLUSH=re.Z_HUFFMAN_ONLY=re.Z_FULL_FLUSH=re.Z_FIXED=re.Z_FINISH=re.Z_FILTERED=re.Z_DEFLATED=re.Z_DEFAULT_STRATEGY=re.Z_DEFAULT_COMPRESSION=re.Z_DATA_ERROR=re.Z_BUF_ERROR=re.Z_BLOCK=void 0;re.deflate=$A;re.deflateEnd=GA;re.deflateInfo=void 0;re.deflateInit=WA;re.deflateInit2=a0;re.deflateReset=o0;re.deflateResetKeep=n0;re.deflateSetDictionary=jA;re.deflateSetHeader=zA;var dt=r0(Fs()),Ft=r0(V_()),t0=zh(hh()),ji=zh(uh()),vA=zh(Y_());function zh(e){return e&&e.__esModule?e:{default:e}}function i0(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(i0=function(s){return s?i:t})(e)}function r0(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||Hh(e)!="object"&&typeof e!="function")return{default:e};var i=i0(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&{}.hasOwnProperty.call(e,n)){var o=s?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}var Ir=re.Z_NO_FLUSH=0,mA=re.Z_PARTIAL_FLUSH=1,yA=re.Z_FULL_FLUSH=3,Zi=re.Z_FINISH=4,J_=re.Z_BLOCK=5,si=re.Z_OK=0,Z_=re.Z_STREAM_END=1,Pt=re.Z_STREAM_ERROR=-2,bA=re.Z_DATA_ERROR=-3,Nh=re.Z_BUF_ERROR=-5,wA=re.Z_DEFAULT_COMPRESSION=-1,AA=re.Z_FILTERED=1,So=re.Z_HUFFMAN_ONLY=2,xA=re.Z_RLE=3,SA=re.Z_FIXED=4,CA=re.Z_DEFAULT_STRATEGY=0,kA=re.Z_UNKNOWN=2,Bo=re.Z_DEFLATED=8,EA=9,BA=15,LA=8,DA=29,IA=256,Xh=IA+1+DA,MA=30,TA=19,RA=2*Xh+1,FA=15,ce=3,Yi=258,jt=Yi+ce+1,PA=32,Lo=42,Uh=69,Co=73,ko=91,Eo=103,Br=113,Ws=666,He=1,$s=2,Lr=3,is=4,OA=3;function Ji(e,t){return e.msg=vA.default[t],t}function e0(e){return(e<<1)-(e>4?9:0)}function Vi(e){for(var t=e.length;--t>=0;)e[t]=0}function qi(e){var t=e.state,i=t.pending;i>e.avail_out&&(i=e.avail_out),i!==0&&(dt.arraySet(e.output,t.pending_buf,t.pending_out,i,e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,t.pending===0&&(t.pending_out=0))}function it(e,t){Ft._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,qi(e.strm)}function fe(e,t){e.pending_buf[e.pending++]=t}function zs(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=t&255}function KA(e,t,i,r){var s=e.avail_in;return s>r&&(s=r),s===0?0:(e.avail_in-=s,dt.arraySet(t,e.input,e.next_in,s,i),e.state.wrap===1?e.adler=(0,t0.default)(e.adler,t,s,i):e.state.wrap===2&&(e.adler=(0,ji.default)(e.adler,t,s,i)),e.next_in+=s,e.total_in+=s,s)}function s0(e,t){var i=e.max_chain_length,r=e.strstart,s,n,o=e.prev_length,a=e.nice_match,h=e.strstart>e.w_size-jt?e.strstart-(e.w_size-jt):0,l=e.window,c=e.w_mask,u=e.prev,p=e.strstart+Yi,g=l[r+o-1],v=l[r+o];e.prev_length>=e.good_match&&(i>>=2),a>e.lookahead&&(a=e.lookahead);do if(s=t,!(l[s+o]!==v||l[s+o-1]!==g||l[s]!==l[r]||l[++s]!==l[r+1])){r+=2,s++;do;while(l[++r]===l[++s]&&l[++r]===l[++s]&&l[++r]===l[++s]&&l[++r]===l[++s]&&l[++r]===l[++s]&&l[++r]===l[++s]&&l[++r]===l[++s]&&l[++r]===l[++s]&&r<p);if(n=Yi-(p-r),r=p-Yi,n>o){if(e.match_start=t,o=n,n>=a)break;g=l[r+o-1],v=l[r+o]}}while((t=u[t&c])>h&&--i!==0);return o<=e.lookahead?o:e.lookahead}function Dr(e){var t=e.w_size,i,r,s,n,o;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-jt)){dt.arraySet(e.window,e.window,t,t,0),e.match_start-=t,e.strstart-=t,e.block_start-=t,r=e.hash_size,i=r;do s=e.head[--i],e.head[i]=s>=t?s-t:0;while(--r);r=t,i=r;do s=e.prev[--i],e.prev[i]=s>=t?s-t:0;while(--r);n+=t}if(e.strm.avail_in===0)break;if(r=KA(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=r,e.lookahead+e.insert>=ce)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+ce-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<ce)););}while(e.lookahead<jt&&e.strm.avail_in!==0)}function NA(e,t){var i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(Dr(e),e.lookahead===0&&t===Ir)return He;if(e.lookahead===0)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+i;if((e.strstart===0||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,it(e,!1),e.strm.avail_out===0)||e.strstart-e.block_start>=e.w_size-jt&&(it(e,!1),e.strm.avail_out===0))return He}return e.insert=0,t===Zi?(it(e,!0),e.strm.avail_out===0?Lr:is):(e.strstart>e.block_start&&(it(e,!1),e.strm.avail_out===0),He)}function Qh(e,t){for(var i,r;;){if(e.lookahead<jt){if(Dr(e),e.lookahead<jt&&t===Ir)return He;if(e.lookahead===0)break}if(i=0,e.lookahead>=ce&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ce-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),i!==0&&e.strstart-i<=e.w_size-jt&&(e.match_length=s0(e,i)),e.match_length>=ce)if(r=Ft._tr_tally(e,e.strstart-e.match_start,e.match_length-ce),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=ce){e.match_length--;do e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ce-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=Ft._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(it(e,!1),e.strm.avail_out===0))return He}return e.insert=e.strstart<ce-1?e.strstart:ce-1,t===Zi?(it(e,!0),e.strm.avail_out===0?Lr:is):e.last_lit&&(it(e,!1),e.strm.avail_out===0)?He:$s}function es(e,t){for(var i,r,s;;){if(e.lookahead<jt){if(Dr(e),e.lookahead<jt&&t===Ir)return He;if(e.lookahead===0)break}if(i=0,e.lookahead>=ce&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ce-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=ce-1,i!==0&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-jt&&(e.match_length=s0(e,i),e.match_length<=5&&(e.strategy===AA||e.match_length===ce&&e.strstart-e.match_start>4096)&&(e.match_length=ce-1)),e.prev_length>=ce&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-ce,r=Ft._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-ce),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=s&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ce-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=ce-1,e.strstart++,r&&(it(e,!1),e.strm.avail_out===0))return He}else if(e.match_available){if(r=Ft._tr_tally(e,0,e.window[e.strstart-1]),r&&it(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return He}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=Ft._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<ce-1?e.strstart:ce-1,t===Zi?(it(e,!0),e.strm.avail_out===0?Lr:is):e.last_lit&&(it(e,!1),e.strm.avail_out===0)?He:$s}function QA(e,t){for(var i,r,s,n,o=e.window;;){if(e.lookahead<=Yi){if(Dr(e),e.lookahead<=Yi&&t===Ir)return He;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=ce&&e.strstart>0&&(s=e.strstart-1,r=o[s],r===o[++s]&&r===o[++s]&&r===o[++s])){n=e.strstart+Yi;do;while(r===o[++s]&&r===o[++s]&&r===o[++s]&&r===o[++s]&&r===o[++s]&&r===o[++s]&&r===o[++s]&&r===o[++s]&&s<n);e.match_length=Yi-(n-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=ce?(i=Ft._tr_tally(e,1,e.match_length-ce),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=Ft._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(it(e,!1),e.strm.avail_out===0))return He}return e.insert=0,t===Zi?(it(e,!0),e.strm.avail_out===0?Lr:is):e.last_lit&&(it(e,!1),e.strm.avail_out===0)?He:$s}function HA(e,t){for(var i;;){if(e.lookahead===0&&(Dr(e),e.lookahead===0)){if(t===Ir)return He;break}if(e.match_length=0,i=Ft._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(it(e,!1),e.strm.avail_out===0))return He}return e.insert=0,t===Zi?(it(e,!0),e.strm.avail_out===0?Lr:is):e.last_lit&&(it(e,!1),e.strm.avail_out===0)?He:$s}function ri(e,t,i,r,s){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=r,this.func=s}var ts;ts=[new ri(0,0,0,0,NA),new ri(4,4,8,4,Qh),new ri(4,5,16,8,Qh),new ri(4,6,32,32,Qh),new ri(4,4,16,16,es),new ri(8,16,32,32,es),new ri(8,16,128,128,es),new ri(8,32,128,256,es),new ri(32,128,258,1024,es),new ri(32,258,258,4096,es)];function XA(e){e.window_size=2*e.w_size,Vi(e.head),e.max_lazy_match=ts[e.level].max_lazy,e.good_match=ts[e.level].good_length,e.nice_match=ts[e.level].nice_length,e.max_chain_length=ts[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=ce-1,e.match_available=0,e.ins_h=0}function UA(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Bo,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new dt.Buf16(RA*2),this.dyn_dtree=new dt.Buf16((2*MA+1)*2),this.bl_tree=new dt.Buf16((2*TA+1)*2),Vi(this.dyn_ltree),Vi(this.dyn_dtree),Vi(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new dt.Buf16(FA+1),this.heap=new dt.Buf16(2*Xh+1),Vi(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new dt.Buf16(2*Xh+1),Vi(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function n0(e){var t;return!e||!e.state?Ji(e,Pt):(e.total_in=e.total_out=0,e.data_type=kA,t=e.state,t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?Lo:Br,e.adler=t.wrap===2?0:1,t.last_flush=Ir,Ft._tr_init(t),si)}function o0(e){var t=n0(e);return t===si&&XA(e.state),t}function zA(e,t){return!e||!e.state||e.state.wrap!==2?Pt:(e.state.gzhead=t,si)}function a0(e,t,i,r,s,n){if(!e)return Pt;var o=1;if(t===wA&&(t=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),s<1||s>EA||i!==Bo||r<8||r>15||t<0||t>9||n<0||n>SA)return Ji(e,Pt);r===8&&(r=9);var a=new UA;return e.state=a,a.strm=e,a.wrap=o,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=s+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+ce-1)/ce),a.window=new dt.Buf8(a.w_size*2),a.head=new dt.Buf16(a.hash_size),a.prev=new dt.Buf16(a.w_size),a.lit_bufsize=1<<s+6,a.pending_buf_size=a.lit_bufsize*4,a.pending_buf=new dt.Buf8(a.pending_buf_size),a.d_buf=1*a.lit_bufsize,a.l_buf=3*a.lit_bufsize,a.level=t,a.strategy=n,a.method=i,o0(e)}function WA(e,t){return a0(e,t,Bo,BA,LA,CA)}function $A(e,t){var i,r,s,n;if(!e||!e.state||t>J_||t<0)return e?Ji(e,Pt):Pt;if(r=e.state,!e.output||!e.input&&e.avail_in!==0||r.status===Ws&&t!==Zi)return Ji(e,e.avail_out===0?Nh:Pt);if(r.strm=e,i=r.last_flush,r.last_flush=t,r.status===Lo)if(r.wrap===2)e.adler=0,fe(r,31),fe(r,139),fe(r,8),r.gzhead?(fe(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),fe(r,r.gzhead.time&255),fe(r,r.gzhead.time>>8&255),fe(r,r.gzhead.time>>16&255),fe(r,r.gzhead.time>>24&255),fe(r,r.level===9?2:r.strategy>=So||r.level<2?4:0),fe(r,r.gzhead.os&255),r.gzhead.extra&&r.gzhead.extra.length&&(fe(r,r.gzhead.extra.length&255),fe(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=(0,ji.default)(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=Uh):(fe(r,0),fe(r,0),fe(r,0),fe(r,0),fe(r,0),fe(r,r.level===9?2:r.strategy>=So||r.level<2?4:0),fe(r,OA),r.status=Br);else{var o=Bo+(r.w_bits-8<<4)<<8,a=-1;r.strategy>=So||r.level<2?a=0:r.level<6?a=1:r.level===6?a=2:a=3,o|=a<<6,r.strstart!==0&&(o|=PA),o+=31-o%31,r.status=Br,zs(r,o),r.strstart!==0&&(zs(r,e.adler>>>16),zs(r,e.adler&65535)),e.adler=1}if(r.status===Uh)if(r.gzhead.extra){for(s=r.pending;r.gzindex<(r.gzhead.extra.length&65535)&&!(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>s&&(e.adler=(0,ji.default)(e.adler,r.pending_buf,r.pending-s,s)),qi(e),s=r.pending,r.pending===r.pending_buf_size));)fe(r,r.gzhead.extra[r.gzindex]&255),r.gzindex++;r.gzhead.hcrc&&r.pending>s&&(e.adler=(0,ji.default)(e.adler,r.pending_buf,r.pending-s,s)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=Co)}else r.status=Co;if(r.status===Co)if(r.gzhead.name){s=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>s&&(e.adler=(0,ji.default)(e.adler,r.pending_buf,r.pending-s,s)),qi(e),s=r.pending,r.pending===r.pending_buf_size)){n=1;break}r.gzindex<r.gzhead.name.length?n=r.gzhead.name.charCodeAt(r.gzindex++)&255:n=0,fe(r,n)}while(n!==0);r.gzhead.hcrc&&r.pending>s&&(e.adler=(0,ji.default)(e.adler,r.pending_buf,r.pending-s,s)),n===0&&(r.gzindex=0,r.status=ko)}else r.status=ko;if(r.status===ko)if(r.gzhead.comment){s=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>s&&(e.adler=(0,ji.default)(e.adler,r.pending_buf,r.pending-s,s)),qi(e),s=r.pending,r.pending===r.pending_buf_size)){n=1;break}r.gzindex<r.gzhead.comment.length?n=r.gzhead.comment.charCodeAt(r.gzindex++)&255:n=0,fe(r,n)}while(n!==0);r.gzhead.hcrc&&r.pending>s&&(e.adler=(0,ji.default)(e.adler,r.pending_buf,r.pending-s,s)),n===0&&(r.status=Eo)}else r.status=Eo;if(r.status===Eo&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&qi(e),r.pending+2<=r.pending_buf_size&&(fe(r,e.adler&255),fe(r,e.adler>>8&255),e.adler=0,r.status=Br)):r.status=Br),r.pending!==0){if(qi(e),e.avail_out===0)return r.last_flush=-1,si}else if(e.avail_in===0&&e0(t)<=e0(i)&&t!==Zi)return Ji(e,Nh);if(r.status===Ws&&e.avail_in!==0)return Ji(e,Nh);if(e.avail_in!==0||r.lookahead!==0||t!==Ir&&r.status!==Ws){var h=r.strategy===So?HA(r,t):r.strategy===xA?QA(r,t):ts[r.level].func(r,t);if((h===Lr||h===is)&&(r.status=Ws),h===He||h===Lr)return e.avail_out===0&&(r.last_flush=-1),si;if(h===$s&&(t===mA?Ft._tr_align(r):t!==J_&&(Ft._tr_stored_block(r,0,0,!1),t===yA&&(Vi(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),qi(e),e.avail_out===0))return r.last_flush=-1,si}return t!==Zi?si:r.wrap<=0?Z_:(r.wrap===2?(fe(r,e.adler&255),fe(r,e.adler>>8&255),fe(r,e.adler>>16&255),fe(r,e.adler>>24&255),fe(r,e.total_in&255),fe(r,e.total_in>>8&255),fe(r,e.total_in>>16&255),fe(r,e.total_in>>24&255)):(zs(r,e.adler>>>16),zs(r,e.adler&65535)),qi(e),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?si:Z_)}function GA(e){var t;return!e||!e.state?Pt:(t=e.state.status,t!==Lo&&t!==Uh&&t!==Co&&t!==ko&&t!==Eo&&t!==Br&&t!==Ws?Ji(e,Pt):(e.state=null,t===Br?Ji(e,bA):si))}function jA(e,t){var i=t.length,r,s,n,o,a,h,l,c;if(!e||!e.state||(r=e.state,o=r.wrap,o===2||o===1&&r.status!==Lo||r.lookahead))return Pt;for(o===1&&(e.adler=(0,t0.default)(e.adler,t,i,0)),r.wrap=0,i>=r.w_size&&(o===0&&(Vi(r.head),r.strstart=0,r.block_start=0,r.insert=0),c=new dt.Buf8(r.w_size),dt.arraySet(c,t,i-r.w_size,r.w_size,0),t=c,i=r.w_size),a=e.avail_in,h=e.next_in,l=e.input,e.avail_in=i,e.next_in=0,e.input=t,Dr(r);r.lookahead>=ce;){s=r.strstart,n=r.lookahead-(ce-1);do r.ins_h=(r.ins_h<<r.hash_shift^r.window[s+ce-1])&r.hash_mask,r.prev[s&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=s,s++;while(--n);r.strstart=s,r.lookahead=ce-1,Dr(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=ce-1,r.match_available=0,e.next_in=h,e.input=l,e.avail_in=a,r.wrap=o,si}var c4=re.deflateInfo="pako deflate (from Nodeca project)"});var c0=ie(Do=>{"use strict";Object.defineProperty(Do,"__esModule",{value:!0});Do.default=void 0;var rs=l0(),qA=VA(kh());function VA(e){return e&&e.__esModule?e:{default:e}}function Gs(e){"@babel/helpers - typeof";return Gs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gs(e)}function YA(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h0(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ZA(r.key),r)}}function JA(e,t,i){return t&&h0(e.prototype,t),i&&h0(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function ZA(e){var t=ex(e,"string");return Gs(t)=="symbol"?t:t+""}function ex(e,t){if(Gs(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(Gs(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var d4=Do.default=function(){function e(){YA(this,e),this.strm=new qA.default,this.chunkSize=1024*10*10,this.outputBuffer=new Uint8Array(this.chunkSize),(0,rs.deflateInit)(this.strm,rs.Z_DEFAULT_COMPRESSION)}return JA(e,[{key:"deflate",value:function(i){this.strm.input=i,this.strm.avail_in=this.strm.input.length,this.strm.next_in=0,this.strm.output=this.outputBuffer,this.strm.avail_out=this.chunkSize,this.strm.next_out=0;var r=(0,rs.deflate)(this.strm,rs.Z_FULL_FLUSH),s=new Uint8Array(this.strm.output.buffer,0,this.strm.next_out);if(r<0)throw new Error("zlib deflate failed");if(this.strm.avail_in>0){var n=[s],o=s.length;do{if(this.strm.output=new Uint8Array(this.chunkSize),this.strm.next_out=0,this.strm.avail_out=this.chunkSize,r=(0,rs.deflate)(this.strm,rs.Z_FULL_FLUSH),r<0)throw new Error("zlib deflate failed");var a=new Uint8Array(this.strm.output.buffer,0,this.strm.next_out);o+=a.length,n.push(a)}while(this.strm.avail_in>0);for(var h=new Uint8Array(o),l=0,c=0;c<n.length;c++)h.set(n[c],l),l+=n[c].length;s=h}return this.strm.input=null,this.strm.avail_in=0,this.strm.next_in=0,s}}])}()});var ss=ie(Io=>{"use strict";Object.defineProperty(Io,"__esModule",{value:!0});Io.default=void 0;var _4=Io.default={XK_VoidSymbol:16777215,XK_BackSpace:65288,XK_Tab:65289,XK_Linefeed:65290,XK_Clear:65291,XK_Return:65293,XK_Pause:65299,XK_Scroll_Lock:65300,XK_Sys_Req:65301,XK_Escape:65307,XK_Delete:65535,XK_Multi_key:65312,XK_Codeinput:65335,XK_SingleCandidate:65340,XK_MultipleCandidate:65341,XK_PreviousCandidate:65342,XK_Kanji:65313,XK_Muhenkan:65314,XK_Henkan_Mode:65315,XK_Henkan:65315,XK_Romaji:65316,XK_Hiragana:65317,XK_Katakana:65318,XK_Hiragana_Katakana:65319,XK_Zenkaku:65320,XK_Hankaku:65321,XK_Zenkaku_Hankaku:65322,XK_Touroku:65323,XK_Massyo:65324,XK_Kana_Lock:65325,XK_Kana_Shift:65326,XK_Eisu_Shift:65327,XK_Eisu_toggle:65328,XK_Kanji_Bangou:65335,XK_Zen_Koho:65341,XK_Mae_Koho:65342,XK_Home:65360,XK_Left:65361,XK_Up:65362,XK_Right:65363,XK_Down:65364,XK_Prior:65365,XK_Page_Up:65365,XK_Next:65366,XK_Page_Down:65366,XK_End:65367,XK_Begin:65368,XK_Select:65376,XK_Print:65377,XK_Execute:65378,XK_Insert:65379,XK_Undo:65381,XK_Redo:65382,XK_Menu:65383,XK_Find:65384,XK_Cancel:65385,XK_Help:65386,XK_Break:65387,XK_Mode_switch:65406,XK_script_switch:65406,XK_Num_Lock:65407,XK_KP_Space:65408,XK_KP_Tab:65417,XK_KP_Enter:65421,XK_KP_F1:65425,XK_KP_F2:65426,XK_KP_F3:65427,XK_KP_F4:65428,XK_KP_Home:65429,XK_KP_Left:65430,XK_KP_Up:65431,XK_KP_Right:65432,XK_KP_Down:65433,XK_KP_Prior:65434,XK_KP_Page_Up:65434,XK_KP_Next:65435,XK_KP_Page_Down:65435,XK_KP_End:65436,XK_KP_Begin:65437,XK_KP_Insert:65438,XK_KP_Delete:65439,XK_KP_Equal:65469,XK_KP_Multiply:65450,XK_KP_Add:65451,XK_KP_Separator:65452,XK_KP_Subtract:65453,XK_KP_Decimal:65454,XK_KP_Divide:65455,XK_KP_0:65456,XK_KP_1:65457,XK_KP_2:65458,XK_KP_3:65459,XK_KP_4:65460,XK_KP_5:65461,XK_KP_6:65462,XK_KP_7:65463,XK_KP_8:65464,XK_KP_9:65465,XK_F1:65470,XK_F2:65471,XK_F3:65472,XK_F4:65473,XK_F5:65474,XK_F6:65475,XK_F7:65476,XK_F8:65477,XK_F9:65478,XK_F10:65479,XK_F11:65480,XK_L1:65480,XK_F12:65481,XK_L2:65481,XK_F13:65482,XK_L3:65482,XK_F14:65483,XK_L4:65483,XK_F15:65484,XK_L5:65484,XK_F16:65485,XK_L6:65485,XK_F17:65486,XK_L7:65486,XK_F18:65487,XK_L8:65487,XK_F19:65488,XK_L9:65488,XK_F20:65489,XK_L10:65489,XK_F21:65490,XK_R1:65490,XK_F22:65491,XK_R2:65491,XK_F23:65492,XK_R3:65492,XK_F24:65493,XK_R4:65493,XK_F25:65494,XK_R5:65494,XK_F26:65495,XK_R6:65495,XK_F27:65496,XK_R7:65496,XK_F28:65497,XK_R8:65497,XK_F29:65498,XK_R9:65498,XK_F30:65499,XK_R10:65499,XK_F31:65500,XK_R11:65500,XK_F32:65501,XK_R12:65501,XK_F33:65502,XK_R13:65502,XK_F34:65503,XK_R14:65503,XK_F35:65504,XK_R15:65504,XK_Shift_L:65505,XK_Shift_R:65506,XK_Control_L:65507,XK_Control_R:65508,XK_Caps_Lock:65509,XK_Shift_Lock:65510,XK_Meta_L:65511,XK_Meta_R:65512,XK_Alt_L:65513,XK_Alt_R:65514,XK_Super_L:65515,XK_Super_R:65516,XK_Hyper_L:65517,XK_Hyper_R:65518,XK_ISO_Level3_Shift:65027,XK_ISO_Next_Group:65032,XK_ISO_Prev_Group:65034,XK_ISO_First_Group:65036,XK_ISO_Last_Group:65038,XK_space:32,XK_exclam:33,XK_quotedbl:34,XK_numbersign:35,XK_dollar:36,XK_percent:37,XK_ampersand:38,XK_apostrophe:39,XK_quoteright:39,XK_parenleft:40,XK_parenright:41,XK_asterisk:42,XK_plus:43,XK_comma:44,XK_minus:45,XK_period:46,XK_slash:47,XK_0:48,XK_1:49,XK_2:50,XK_3:51,XK_4:52,XK_5:53,XK_6:54,XK_7:55,XK_8:56,XK_9:57,XK_colon:58,XK_semicolon:59,XK_less:60,XK_equal:61,XK_greater:62,XK_question:63,XK_at:64,XK_A:65,XK_B:66,XK_C:67,XK_D:68,XK_E:69,XK_F:70,XK_G:71,XK_H:72,XK_I:73,XK_J:74,XK_K:75,XK_L:76,XK_M:77,XK_N:78,XK_O:79,XK_P:80,XK_Q:81,XK_R:82,XK_S:83,XK_T:84,XK_U:85,XK_V:86,XK_W:87,XK_X:88,XK_Y:89,XK_Z:90,XK_bracketleft:91,XK_backslash:92,XK_bracketright:93,XK_asciicircum:94,XK_underscore:95,XK_grave:96,XK_quoteleft:96,XK_a:97,XK_b:98,XK_c:99,XK_d:100,XK_e:101,XK_f:102,XK_g:103,XK_h:104,XK_i:105,XK_j:106,XK_k:107,XK_l:108,XK_m:109,XK_n:110,XK_o:111,XK_p:112,XK_q:113,XK_r:114,XK_s:115,XK_t:116,XK_u:117,XK_v:118,XK_w:119,XK_x:120,XK_y:121,XK_z:122,XK_braceleft:123,XK_bar:124,XK_braceright:125,XK_asciitilde:126,XK_nobreakspace:160,XK_exclamdown:161,XK_cent:162,XK_sterling:163,XK_currency:164,XK_yen:165,XK_brokenbar:166,XK_section:167,XK_diaeresis:168,XK_copyright:169,XK_ordfeminine:170,XK_guillemotleft:171,XK_notsign:172,XK_hyphen:173,XK_registered:174,XK_macron:175,XK_degree:176,XK_plusminus:177,XK_twosuperior:178,XK_threesuperior:179,XK_acute:180,XK_mu:181,XK_paragraph:182,XK_periodcentered:183,XK_cedilla:184,XK_onesuperior:185,XK_masculine:186,XK_guillemotright:187,XK_onequarter:188,XK_onehalf:189,XK_threequarters:190,XK_questiondown:191,XK_Agrave:192,XK_Aacute:193,XK_Acircumflex:194,XK_Atilde:195,XK_Adiaeresis:196,XK_Aring:197,XK_AE:198,XK_Ccedilla:199,XK_Egrave:200,XK_Eacute:201,XK_Ecircumflex:202,XK_Ediaeresis:203,XK_Igrave:204,XK_Iacute:205,XK_Icircumflex:206,XK_Idiaeresis:207,XK_ETH:208,XK_Eth:208,XK_Ntilde:209,XK_Ograve:210,XK_Oacute:211,XK_Ocircumflex:212,XK_Otilde:213,XK_Odiaeresis:214,XK_multiply:215,XK_Oslash:216,XK_Ooblique:216,XK_Ugrave:217,XK_Uacute:218,XK_Ucircumflex:219,XK_Udiaeresis:220,XK_Yacute:221,XK_THORN:222,XK_Thorn:222,XK_ssharp:223,XK_agrave:224,XK_aacute:225,XK_acircumflex:226,XK_atilde:227,XK_adiaeresis:228,XK_aring:229,XK_ae:230,XK_ccedilla:231,XK_egrave:232,XK_eacute:233,XK_ecircumflex:234,XK_ediaeresis:235,XK_igrave:236,XK_iacute:237,XK_icircumflex:238,XK_idiaeresis:239,XK_eth:240,XK_ntilde:241,XK_ograve:242,XK_oacute:243,XK_ocircumflex:244,XK_otilde:245,XK_odiaeresis:246,XK_division:247,XK_oslash:248,XK_ooblique:248,XK_ugrave:249,XK_uacute:250,XK_ucircumflex:251,XK_udiaeresis:252,XK_yacute:253,XK_thorn:254,XK_ydiaeresis:255,XK_Hangul:65329,XK_Hangul_Hanja:65332,XK_Hangul_Jeonja:65336,XF86XK_ModeLock:269025025,XF86XK_MonBrightnessUp:269025026,XF86XK_MonBrightnessDown:269025027,XF86XK_KbdLightOnOff:269025028,XF86XK_KbdBrightnessUp:269025029,XF86XK_KbdBrightnessDown:269025030,XF86XK_Standby:269025040,XF86XK_AudioLowerVolume:269025041,XF86XK_AudioMute:269025042,XF86XK_AudioRaiseVolume:269025043,XF86XK_AudioPlay:269025044,XF86XK_AudioStop:269025045,XF86XK_AudioPrev:269025046,XF86XK_AudioNext:269025047,XF86XK_HomePage:269025048,XF86XK_Mail:269025049,XF86XK_Start:269025050,XF86XK_Search:269025051,XF86XK_AudioRecord:269025052,XF86XK_Calculator:269025053,XF86XK_Memo:269025054,XF86XK_ToDoList:269025055,XF86XK_Calendar:269025056,XF86XK_PowerDown:269025057,XF86XK_ContrastAdjust:269025058,XF86XK_RockerUp:269025059,XF86XK_RockerDown:269025060,XF86XK_RockerEnter:269025061,XF86XK_Back:269025062,XF86XK_Forward:269025063,XF86XK_Stop:269025064,XF86XK_Refresh:269025065,XF86XK_PowerOff:269025066,XF86XK_WakeUp:269025067,XF86XK_Eject:269025068,XF86XK_ScreenSaver:269025069,XF86XK_WWW:269025070,XF86XK_Sleep:269025071,XF86XK_Favorites:269025072,XF86XK_AudioPause:269025073,XF86XK_AudioMedia:269025074,XF86XK_MyComputer:269025075,XF86XK_VendorHome:269025076,XF86XK_LightBulb:269025077,XF86XK_Shop:269025078,XF86XK_History:269025079,XF86XK_OpenURL:269025080,XF86XK_AddFavorite:269025081,XF86XK_HotLinks:269025082,XF86XK_BrightnessAdjust:269025083,XF86XK_Finance:269025084,XF86XK_Community:269025085,XF86XK_AudioRewind:269025086,XF86XK_BackForward:269025087,XF86XK_Launch0:269025088,XF86XK_Launch1:269025089,XF86XK_Launch2:269025090,XF86XK_Launch3:269025091,XF86XK_Launch4:269025092,XF86XK_Launch5:269025093,XF86XK_Launch6:269025094,XF86XK_Launch7:269025095,XF86XK_Launch8:269025096,XF86XK_Launch9:269025097,XF86XK_LaunchA:269025098,XF86XK_LaunchB:269025099,XF86XK_LaunchC:269025100,XF86XK_LaunchD:269025101,XF86XK_LaunchE:269025102,XF86XK_LaunchF:269025103,XF86XK_ApplicationLeft:269025104,XF86XK_ApplicationRight:269025105,XF86XK_Book:269025106,XF86XK_CD:269025107,XF86XK_Calculater:269025108,XF86XK_Clear:269025109,XF86XK_Close:269025110,XF86XK_Copy:269025111,XF86XK_Cut:269025112,XF86XK_Display:269025113,XF86XK_DOS:269025114,XF86XK_Documents:269025115,XF86XK_Excel:269025116,XF86XK_Explorer:269025117,XF86XK_Game:269025118,XF86XK_Go:269025119,XF86XK_iTouch:269025120,XF86XK_LogOff:269025121,XF86XK_Market:269025122,XF86XK_Meeting:269025123,XF86XK_MenuKB:269025125,XF86XK_MenuPB:269025126,XF86XK_MySites:269025127,XF86XK_New:269025128,XF86XK_News:269025129,XF86XK_OfficeHome:269025130,XF86XK_Open:269025131,XF86XK_Option:269025132,XF86XK_Paste:269025133,XF86XK_Phone:269025134,XF86XK_Q:269025136,XF86XK_Reply:269025138,XF86XK_Reload:269025139,XF86XK_RotateWindows:269025140,XF86XK_RotationPB:269025141,XF86XK_RotationKB:269025142,XF86XK_Save:269025143,XF86XK_ScrollUp:269025144,XF86XK_ScrollDown:269025145,XF86XK_ScrollClick:269025146,XF86XK_Send:269025147,XF86XK_Spell:269025148,XF86XK_SplitScreen:269025149,XF86XK_Support:269025150,XF86XK_TaskPane:269025151,XF86XK_Terminal:269025152,XF86XK_Tools:269025153,XF86XK_Travel:269025154,XF86XK_UserPB:269025156,XF86XK_User1KB:269025157,XF86XK_User2KB:269025158,XF86XK_Video:269025159,XF86XK_WheelButton:269025160,XF86XK_Word:269025161,XF86XK_Xfer:269025162,XF86XK_ZoomIn:269025163,XF86XK_ZoomOut:269025164,XF86XK_Away:269025165,XF86XK_Messenger:269025166,XF86XK_WebCam:269025167,XF86XK_MailForward:269025168,XF86XK_Pictures:269025169,XF86XK_Music:269025170,XF86XK_Battery:269025171,XF86XK_Bluetooth:269025172,XF86XK_WLAN:269025173,XF86XK_UWB:269025174,XF86XK_AudioForward:269025175,XF86XK_AudioRepeat:269025176,XF86XK_AudioRandomPlay:269025177,XF86XK_Subtitle:269025178,XF86XK_AudioCycleTrack:269025179,XF86XK_CycleAngle:269025180,XF86XK_FrameBack:269025181,XF86XK_FrameForward:269025182,XF86XK_Time:269025183,XF86XK_Select:269025184,XF86XK_View:269025185,XF86XK_TopMenu:269025186,XF86XK_Red:269025187,XF86XK_Green:269025188,XF86XK_Yellow:269025189,XF86XK_Blue:269025190,XF86XK_Suspend:269025191,XF86XK_Hibernate:269025192,XF86XK_TouchpadToggle:269025193,XF86XK_TouchpadOn:269025200,XF86XK_TouchpadOff:269025201,XF86XK_AudioMicMute:269025202,XF86XK_Switch_VT_1:269024769,XF86XK_Switch_VT_2:269024770,XF86XK_Switch_VT_3:269024771,XF86XK_Switch_VT_4:269024772,XF86XK_Switch_VT_5:269024773,XF86XK_Switch_VT_6:269024774,XF86XK_Switch_VT_7:269024775,XF86XK_Switch_VT_8:269024776,XF86XK_Switch_VT_9:269024777,XF86XK_Switch_VT_10:269024778,XF86XK_Switch_VT_11:269024779,XF86XK_Switch_VT_12:269024780,XF86XK_Ungrab:269024800,XF86XK_ClearGrab:269024801,XF86XK_Next_VMode:269024802,XF86XK_Prev_VMode:269024803,XF86XK_LogWindowTree:269024804,XF86XK_LogGrabInfo:269024805}});var Wh=ie(Mo=>{"use strict";Object.defineProperty(Mo,"__esModule",{value:!0});Mo.default=void 0;var tx={256:960,257:992,258:451,259:483,260:417,261:433,262:454,263:486,264:710,265:742,266:709,267:741,268:456,269:488,270:463,271:495,272:464,273:496,274:938,275:954,278:972,279:1004,280:458,281:490,282:460,283:492,284:728,285:760,286:683,287:699,288:725,289:757,290:939,291:955,292:678,293:694,294:673,295:689,296:933,297:949,298:975,299:1007,302:967,303:999,304:681,305:697,308:684,309:700,310:979,311:1011,312:930,313:453,314:485,315:934,316:950,317:421,318:437,321:419,322:435,323:465,324:497,325:977,326:1009,327:466,328:498,330:957,331:959,332:978,333:1010,336:469,337:501,338:5052,339:5053,340:448,341:480,342:931,343:947,344:472,345:504,346:422,347:438,348:734,349:766,350:426,351:442,352:425,353:441,354:478,355:510,356:427,357:443,358:940,359:956,360:989,361:1021,362:990,363:1022,364:733,365:765,366:473,367:505,368:475,369:507,370:985,371:1017,376:5054,377:428,378:444,379:431,380:447,381:430,382:446,402:2294,466:16777681,711:439,728:418,729:511,731:434,733:445,901:1966,902:1953,904:1954,905:1955,906:1956,908:1959,910:1960,911:1963,912:1974,913:1985,914:1986,915:1987,916:1988,917:1989,918:1990,919:1991,920:1992,921:1993,922:1994,923:1995,924:1996,925:1997,926:1998,927:1999,928:2e3,929:2001,931:2002,932:2004,933:2005,934:2006,935:2007,936:2008,937:2009,938:1957,939:1961,940:1969,941:1970,942:1971,943:1972,944:1978,945:2017,946:2018,947:2019,948:2020,949:2021,950:2022,951:2023,952:2024,953:2025,954:2026,955:2027,956:2028,957:2029,958:2030,959:2031,960:2032,961:2033,962:2035,963:2034,964:2036,965:2037,966:2038,967:2039,968:2040,969:2041,970:1973,971:1977,972:1975,973:1976,974:1979,1025:1715,1026:1713,1027:1714,1028:1716,1029:1717,1030:1718,1031:1719,1032:1720,1033:1721,1034:1722,1035:1723,1036:1724,1038:1726,1039:1727,1040:1761,1041:1762,1042:1783,1043:1767,1044:1764,1045:1765,1046:1782,1047:1786,1048:1769,1049:1770,1050:1771,1051:1772,1052:1773,1053:1774,1054:1775,1055:1776,1056:1778,1057:1779,1058:1780,1059:1781,1060:1766,1061:1768,1062:1763,1063:1790,1064:1787,1065:1789,1066:1791,1067:1785,1068:1784,1069:1788,1070:1760,1071:1777,1072:1729,1073:1730,1074:1751,1075:1735,1076:1732,1077:1733,1078:1750,1079:1754,1080:1737,1081:1738,1082:1739,1083:1740,1084:1741,1085:1742,1086:1743,1087:1744,1088:1746,1089:1747,1090:1748,1091:1749,1092:1734,1093:1736,1094:1731,1095:1758,1096:1755,1097:1757,1098:1759,1099:1753,1100:1752,1101:1756,1102:1728,1103:1745,1105:1699,1106:1697,1107:1698,1108:1700,1109:1701,1110:1702,1111:1703,1112:1704,1113:1705,1114:1706,1115:1707,1116:1708,1118:1710,1119:1711,1168:1725,1169:1709,1488:3296,1489:3297,1490:3298,1491:3299,1492:3300,1493:3301,1494:3302,1495:3303,1496:3304,1497:3305,1498:3306,1499:3307,1500:3308,1501:3309,1502:3310,1503:3311,1504:3312,1505:3313,1506:3314,1507:3315,1508:3316,1509:3317,1510:3318,1511:3319,1512:3320,1513:3321,1514:3322,1548:1452,1563:1467,1567:1471,1569:1473,1570:1474,1571:1475,1572:1476,1573:1477,1574:1478,1575:1479,1576:1480,1577:1481,1578:1482,1579:1483,1580:1484,1581:1485,1582:1486,1583:1487,1584:1488,1585:1489,1586:1490,1587:1491,1588:1492,1589:1493,1590:1494,1591:1495,1592:1496,1593:1497,1594:1498,1600:1504,1601:1505,1602:1506,1603:1507,1604:1508,1605:1509,1606:1510,1607:1511,1608:1512,1609:1513,1610:1514,1611:1515,1612:1516,1613:1517,1614:1518,1615:1519,1616:1520,1617:1521,1618:1522,3585:3489,3586:3490,3587:3491,3588:3492,3589:3493,3590:3494,3591:3495,3592:3496,3593:3497,3594:3498,3595:3499,3596:3500,3597:3501,3598:3502,3599:3503,3600:3504,3601:3505,3602:3506,3603:3507,3604:3508,3605:3509,3606:3510,3607:3511,3608:3512,3609:3513,3610:3514,3611:3515,3612:3516,3613:3517,3614:3518,3615:3519,3616:3520,3617:3521,3618:3522,3619:3523,3620:3524,3621:3525,3622:3526,3623:3527,3624:3528,3625:3529,3626:3530,3627:3531,3628:3532,3629:3533,3630:3534,3631:3535,3632:3536,3633:3537,3634:3538,3635:3539,3636:3540,3637:3541,3638:3542,3639:3543,3640:3544,3641:3545,3642:3546,3647:3551,3648:3552,3649:3553,3650:3554,3651:3555,3652:3556,3653:3557,3654:3558,3655:3559,3656:3560,3657:3561,3658:3562,3659:3563,3660:3564,3661:3565,3664:3568,3665:3569,3666:3570,3667:3571,3668:3572,3669:3573,3670:3574,3671:3575,3672:3576,3673:3577,8194:2722,8195:2721,8196:2723,8197:2724,8199:2725,8200:2726,8201:2727,8202:2728,8210:2747,8211:2730,8212:2729,8213:1967,8215:3295,8216:2768,8217:2769,8218:2813,8220:2770,8221:2771,8222:2814,8224:2801,8225:2802,8226:2790,8229:2735,8230:2734,8240:2773,8242:2774,8243:2775,8248:2812,8254:1150,8361:3839,8364:8364,8453:2744,8470:1712,8471:2811,8478:2772,8482:2761,8531:2736,8532:2737,8533:2738,8534:2739,8535:2740,8536:2741,8537:2742,8538:2743,8539:2755,8540:2756,8541:2757,8542:2758,8592:2299,8593:2300,8594:2301,8595:2302,8658:2254,8660:2253,8706:2287,8711:2245,8728:3018,8730:2262,8733:2241,8734:2242,8743:2270,8744:2271,8745:2268,8746:2269,8747:2239,8756:2240,8764:2248,8771:2249,8773:16785992,8800:2237,8801:2255,8804:2236,8805:2238,8834:2266,8835:2267,8866:3068,8867:3036,8868:3010,8869:3022,8968:3027,8970:3012,8981:2810,8992:2212,8993:2213,9109:3020,9115:2219,9117:2220,9118:2221,9120:2222,9121:2215,9123:2216,9124:2217,9126:2218,9128:2223,9132:2224,9143:2209,9146:2543,9147:2544,9148:2546,9149:2547,9225:2530,9226:2533,9227:2537,9228:2531,9229:2532,9251:2732,9252:2536,9472:2211,9474:2214,9484:2210,9488:2539,9492:2541,9496:2538,9500:2548,9508:2549,9516:2551,9524:2550,9532:2542,9618:2529,9642:2791,9643:2785,9644:2779,9645:2786,9646:2783,9647:2767,9650:2792,9651:2787,9654:2781,9655:2765,9660:2793,9661:2788,9664:2780,9665:2764,9670:2528,9675:2766,9679:2782,9702:2784,9734:2789,9742:2809,9747:2762,9756:2794,9758:2795,9792:2808,9794:2807,9827:2796,9829:2798,9830:2797,9837:2806,9839:2805,10003:2803,10007:2804,10013:2777,10016:2800,10216:2748,10217:2750,12289:1188,12290:1185,12300:1186,12301:1187,12443:1246,12444:1247,12449:1191,12450:1201,12451:1192,12452:1202,12453:1193,12454:1203,12455:1194,12456:1204,12457:1195,12458:1205,12459:1206,12461:1207,12463:1208,12465:1209,12467:1210,12469:1211,12471:1212,12473:1213,12475:1214,12477:1215,12479:1216,12481:1217,12483:1199,12484:1218,12486:1219,12488:1220,12490:1221,12491:1222,12492:1223,12493:1224,12494:1225,12495:1226,12498:1227,12501:1228,12504:1229,12507:1230,12510:1231,12511:1232,12512:1233,12513:1234,12514:1235,12515:1196,12516:1236,12517:1197,12518:1237,12519:1198,12520:1238,12521:1239,12522:1240,12523:1241,12524:1242,12525:1243,12527:1244,12530:1190,12531:1245,12539:1189,12540:1200},p4=Mo.default={lookup:function(t){if(t>=32&&t<=255)return t;var i=tx[t];return i!==void 0?i:16777216|t}}});var u0=ie(To=>{"use strict";Object.defineProperty(To,"__esModule",{value:!0});To.default=void 0;var m4=To.default={8:"Backspace",9:"Tab",10:"NumpadClear",13:"Enter",16:"ShiftLeft",17:"ControlLeft",18:"AltLeft",19:"Pause",20:"CapsLock",21:"Lang1",25:"Lang2",27:"Escape",28:"Convert",29:"NonConvert",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",41:"Select",44:"PrintScreen",45:"Insert",46:"Delete",47:"Help",48:"Digit0",49:"Digit1",50:"Digit2",51:"Digit3",52:"Digit4",53:"Digit5",54:"Digit6",55:"Digit7",56:"Digit8",57:"Digit9",91:"MetaLeft",92:"MetaRight",93:"ContextMenu",95:"Sleep",96:"Numpad0",97:"Numpad1",98:"Numpad2",99:"Numpad3",100:"Numpad4",101:"Numpad5",102:"Numpad6",103:"Numpad7",104:"Numpad8",105:"Numpad9",106:"NumpadMultiply",107:"NumpadAdd",108:"NumpadDecimal",109:"NumpadSubtract",110:"NumpadDecimal",111:"NumpadDivide",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",124:"F13",125:"F14",126:"F15",127:"F16",128:"F17",129:"F18",130:"F19",131:"F20",132:"F21",133:"F22",134:"F23",135:"F24",144:"NumLock",145:"ScrollLock",166:"BrowserBack",167:"BrowserForward",168:"BrowserRefresh",169:"BrowserStop",170:"BrowserSearch",171:"BrowserFavorites",172:"BrowserHome",173:"AudioVolumeMute",174:"AudioVolumeDown",175:"AudioVolumeUp",176:"MediaTrackNext",177:"MediaTrackPrevious",178:"MediaStop",179:"MediaPlayPause",180:"LaunchMail",181:"MediaSelect",182:"LaunchApp1",183:"LaunchApp2",225:"AltRight"}});var d0=ie(Ro=>{"use strict";Object.defineProperty(Ro,"__esModule",{value:!0});Ro.default=void 0;var b4=Ro.default={Backspace:"Backspace",AltLeft:"Alt",AltRight:"Alt",CapsLock:"CapsLock",ContextMenu:"ContextMenu",ControlLeft:"Control",ControlRight:"Control",Enter:"Enter",MetaLeft:"Meta",MetaRight:"Meta",ShiftLeft:"Shift",ShiftRight:"Shift",Tab:"Tab",Delete:"Delete",End:"End",Help:"Help",Home:"Home",Insert:"Insert",PageDown:"PageDown",PageUp:"PageUp",ArrowDown:"ArrowDown",ArrowLeft:"ArrowLeft",ArrowRight:"ArrowRight",ArrowUp:"ArrowUp",NumLock:"NumLock",NumpadBackspace:"Backspace",NumpadClear:"Clear",Escape:"Escape",F1:"F1",F2:"F2",F3:"F3",F4:"F4",F5:"F5",F6:"F6",F7:"F7",F8:"F8",F9:"F9",F10:"F10",F11:"F11",F12:"F12",F13:"F13",F14:"F14",F15:"F15",F16:"F16",F17:"F17",F18:"F18",F19:"F19",F20:"F20",F21:"F21",F22:"F22",F23:"F23",F24:"F24",F25:"F25",F26:"F26",F27:"F27",F28:"F28",F29:"F29",F30:"F30",F31:"F31",F32:"F32",F33:"F33",F34:"F34",F35:"F35",PrintScreen:"PrintScreen",ScrollLock:"ScrollLock",Pause:"Pause",BrowserBack:"BrowserBack",BrowserFavorites:"BrowserFavorites",BrowserForward:"BrowserForward",BrowserHome:"BrowserHome",BrowserRefresh:"BrowserRefresh",BrowserSearch:"BrowserSearch",BrowserStop:"BrowserStop",Eject:"Eject",LaunchApp1:"LaunchMyComputer",LaunchApp2:"LaunchCalendar",LaunchMail:"LaunchMail",MediaPlayPause:"MediaPlay",MediaStop:"MediaStop",MediaTrackNext:"MediaTrackNext",MediaTrackPrevious:"MediaTrackPrevious",Power:"Power",Sleep:"Sleep",AudioVolumeDown:"AudioVolumeDown",AudioVolumeMute:"AudioVolumeMute",AudioVolumeUp:"AudioVolumeUp",WakeUp:"WakeUp"}});var f0=ie(Po=>{"use strict";Object.defineProperty(Po,"__esModule",{value:!0});Po.default=void 0;var M=ix(ss());function ix(e){return e&&e.__esModule?e:{default:e}}var Mr={};function Q(e,t){if(t===void 0)throw new Error('Undefined keysym for key "'+e+'"');if(e in Mr)throw new Error('Duplicate entry for key "'+e+'"');Mr[e]=[t,t,t,t]}function Fo(e,t,i){if(t===void 0)throw new Error('Undefined keysym for key "'+e+'"');if(i===void 0)throw new Error('Undefined keysym for key "'+e+'"');if(e in Mr)throw new Error('Duplicate entry for key "'+e+'"');Mr[e]=[t,t,i,t]}function _e(e,t,i){if(t===void 0)throw new Error('Undefined keysym for key "'+e+'"');if(i===void 0)throw new Error('Undefined keysym for key "'+e+'"');if(e in Mr)throw new Error('Duplicate entry for key "'+e+'"');Mr[e]=[t,t,t,i]}Fo("Alt",M.default.XK_Alt_L,M.default.XK_Alt_R);Q("AltGraph",M.default.XK_ISO_Level3_Shift);Q("CapsLock",M.default.XK_Caps_Lock);Fo("Control",M.default.XK_Control_L,M.default.XK_Control_R);Fo("Meta",M.default.XK_Super_L,M.default.XK_Super_R);Q("NumLock",M.default.XK_Num_Lock);Q("ScrollLock",M.default.XK_Scroll_Lock);Fo("Shift",M.default.XK_Shift_L,M.default.XK_Shift_R);_e("Enter",M.default.XK_Return,M.default.XK_KP_Enter);Q("Tab",M.default.XK_Tab);_e(" ",M.default.XK_space,M.default.XK_KP_Space);_e("ArrowDown",M.default.XK_Down,M.default.XK_KP_Down);_e("ArrowLeft",M.default.XK_Left,M.default.XK_KP_Left);_e("ArrowRight",M.default.XK_Right,M.default.XK_KP_Right);_e("ArrowUp",M.default.XK_Up,M.default.XK_KP_Up);_e("End",M.default.XK_End,M.default.XK_KP_End);_e("Home",M.default.XK_Home,M.default.XK_KP_Home);_e("PageDown",M.default.XK_Next,M.default.XK_KP_Next);_e("PageUp",M.default.XK_Prior,M.default.XK_KP_Prior);Q("Backspace",M.default.XK_BackSpace);_e("Clear",M.default.XK_Clear,M.default.XK_KP_Begin);Q("Copy",M.default.XF86XK_Copy);Q("Cut",M.default.XF86XK_Cut);_e("Delete",M.default.XK_Delete,M.default.XK_KP_Delete);_e("Insert",M.default.XK_Insert,M.default.XK_KP_Insert);Q("Paste",M.default.XF86XK_Paste);Q("Redo",M.default.XK_Redo);Q("Undo",M.default.XK_Undo);Q("Cancel",M.default.XK_Cancel);Q("ContextMenu",M.default.XK_Menu);Q("Escape",M.default.XK_Escape);Q("Execute",M.default.XK_Execute);Q("Find",M.default.XK_Find);Q("Help",M.default.XK_Help);Q("Pause",M.default.XK_Pause);Q("Select",M.default.XK_Select);Q("ZoomIn",M.default.XF86XK_ZoomIn);Q("ZoomOut",M.default.XF86XK_ZoomOut);Q("BrightnessDown",M.default.XF86XK_MonBrightnessDown);Q("BrightnessUp",M.default.XF86XK_MonBrightnessUp);Q("Eject",M.default.XF86XK_Eject);Q("LogOff",M.default.XF86XK_LogOff);Q("Power",M.default.XF86XK_PowerOff);Q("PowerOff",M.default.XF86XK_PowerDown);Q("PrintScreen",M.default.XK_Print);Q("Hibernate",M.default.XF86XK_Hibernate);Q("Standby",M.default.XF86XK_Standby);Q("WakeUp",M.default.XF86XK_WakeUp);Q("AllCandidates",M.default.XK_MultipleCandidate);Q("Alphanumeric",M.default.XK_Eisu_toggle);Q("CodeInput",M.default.XK_Codeinput);Q("Compose",M.default.XK_Multi_key);Q("Convert",M.default.XK_Henkan);Q("GroupFirst",M.default.XK_ISO_First_Group);Q("GroupLast",M.default.XK_ISO_Last_Group);Q("GroupNext",M.default.XK_ISO_Next_Group);Q("GroupPrevious",M.default.XK_ISO_Prev_Group);Q("NonConvert",M.default.XK_Muhenkan);Q("PreviousCandidate",M.default.XK_PreviousCandidate);Q("SingleCandidate",M.default.XK_SingleCandidate);Q("HangulMode",M.default.XK_Hangul);Q("HanjaMode",M.default.XK_Hangul_Hanja);Q("JunjaMode",M.default.XK_Hangul_Jeonja);Q("Eisu",M.default.XK_Eisu_toggle);Q("Hankaku",M.default.XK_Hankaku);Q("Hiragana",M.default.XK_Hiragana);Q("HiraganaKatakana",M.default.XK_Hiragana_Katakana);Q("KanaMode",M.default.XK_Kana_Shift);Q("KanjiMode",M.default.XK_Kanji);Q("Katakana",M.default.XK_Katakana);Q("Romaji",M.default.XK_Romaji);Q("Zenkaku",M.default.XK_Zenkaku);Q("ZenkakuHankaku",M.default.XK_Zenkaku_Hankaku);Q("F1",M.default.XK_F1);Q("F2",M.default.XK_F2);Q("F3",M.default.XK_F3);Q("F4",M.default.XK_F4);Q("F5",M.default.XK_F5);Q("F6",M.default.XK_F6);Q("F7",M.default.XK_F7);Q("F8",M.default.XK_F8);Q("F9",M.default.XK_F9);Q("F10",M.default.XK_F10);Q("F11",M.default.XK_F11);Q("F12",M.default.XK_F12);Q("F13",M.default.XK_F13);Q("F14",M.default.XK_F14);Q("F15",M.default.XK_F15);Q("F16",M.default.XK_F16);Q("F17",M.default.XK_F17);Q("F18",M.default.XK_F18);Q("F19",M.default.XK_F19);Q("F20",M.default.XK_F20);Q("F21",M.default.XK_F21);Q("F22",M.default.XK_F22);Q("F23",M.default.XK_F23);Q("F24",M.default.XK_F24);Q("F25",M.default.XK_F25);Q("F26",M.default.XK_F26);Q("F27",M.default.XK_F27);Q("F28",M.default.XK_F28);Q("F29",M.default.XK_F29);Q("F30",M.default.XK_F30);Q("F31",M.default.XK_F31);Q("F32",M.default.XK_F32);Q("F33",M.default.XK_F33);Q("F34",M.default.XK_F34);Q("F35",M.default.XK_F35);Q("Close",M.default.XF86XK_Close);Q("MailForward",M.default.XF86XK_MailForward);Q("MailReply",M.default.XF86XK_Reply);Q("MailSend",M.default.XF86XK_Send);Q("MediaFastForward",M.default.XF86XK_AudioForward);Q("MediaPause",M.default.XF86XK_AudioPause);Q("MediaPlay",M.default.XF86XK_AudioPlay);Q("MediaRecord",M.default.XF86XK_AudioRecord);Q("MediaRewind",M.default.XF86XK_AudioRewind);Q("MediaStop",M.default.XF86XK_AudioStop);Q("MediaTrackNext",M.default.XF86XK_AudioNext);Q("MediaTrackPrevious",M.default.XF86XK_AudioPrev);Q("New",M.default.XF86XK_New);Q("Open",M.default.XF86XK_Open);Q("Print",M.default.XK_Print);Q("Save",M.default.XF86XK_Save);Q("SpellCheck",M.default.XF86XK_Spell);Q("AudioVolumeDown",M.default.XF86XK_AudioLowerVolume);Q("AudioVolumeUp",M.default.XF86XK_AudioRaiseVolume);Q("AudioVolumeMute",M.default.XF86XK_AudioMute);Q("MicrophoneVolumeMute",M.default.XF86XK_AudioMicMute);Q("LaunchApplication1",M.default.XF86XK_MyComputer);Q("LaunchApplication2",M.default.XF86XK_Calculator);Q("LaunchCalendar",M.default.XF86XK_Calendar);Q("LaunchMail",M.default.XF86XK_Mail);Q("LaunchMediaPlayer",M.default.XF86XK_AudioMedia);Q("LaunchMusicPlayer",M.default.XF86XK_Music);Q("LaunchPhone",M.default.XF86XK_Phone);Q("LaunchScreenSaver",M.default.XF86XK_ScreenSaver);Q("LaunchSpreadsheet",M.default.XF86XK_Excel);Q("LaunchWebBrowser",M.default.XF86XK_WWW);Q("LaunchWebCam",M.default.XF86XK_WebCam);Q("LaunchWordProcessor",M.default.XF86XK_Word);Q("BrowserBack",M.default.XF86XK_Back);Q("BrowserFavorites",M.default.XF86XK_Favorites);Q("BrowserForward",M.default.XF86XK_Forward);Q("BrowserHome",M.default.XF86XK_HomePage);Q("BrowserRefresh",M.default.XF86XK_Refresh);Q("BrowserSearch",M.default.XF86XK_Search);Q("BrowserStop",M.default.XF86XK_Stop);Q("Dimmer",M.default.XF86XK_BrightnessAdjust);Q("MediaAudioTrack",M.default.XF86XK_AudioCycleTrack);Q("RandomToggle",M.default.XF86XK_AudioRandomPlay);Q("SplitScreenToggle",M.default.XF86XK_SplitScreen);Q("Subtitle",M.default.XF86XK_Subtitle);Q("VideoModeNext",M.default.XF86XK_Next_VMode);_e("=",M.default.XK_equal,M.default.XK_KP_Equal);_e("+",M.default.XK_plus,M.default.XK_KP_Add);_e("-",M.default.XK_minus,M.default.XK_KP_Subtract);_e("*",M.default.XK_asterisk,M.default.XK_KP_Multiply);_e("/",M.default.XK_slash,M.default.XK_KP_Divide);_e(".",M.default.XK_period,M.default.XK_KP_Decimal);_e(",",M.default.XK_comma,M.default.XK_KP_Separator);_e("0",M.default.XK_0,M.default.XK_KP_0);_e("1",M.default.XK_1,M.default.XK_KP_1);_e("2",M.default.XK_2,M.default.XK_KP_2);_e("3",M.default.XK_3,M.default.XK_KP_3);_e("4",M.default.XK_4,M.default.XK_KP_4);_e("5",M.default.XK_5,M.default.XK_KP_5);_e("6",M.default.XK_6,M.default.XK_KP_6);_e("7",M.default.XK_7,M.default.XK_KP_7);_e("8",M.default.XK_8,M.default.XK_KP_8);_e("9",M.default.XK_9,M.default.XK_KP_9);var A4=Po.default=Mr});var b0=ie(Ys=>{"use strict";function $h(e){"@babel/helpers - typeof";return $h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$h(e)}Object.defineProperty(Ys,"__esModule",{value:!0});Ys.getKey=y0;Ys.getKeycode=qs;Ys.getKeysym=nx;var js=Vs(ss()),rx=Vs(Wh()),_0=Vs(u0()),g0=Vs(d0()),p0=Vs(f0()),v0=sx(Ts());function m0(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(m0=function(s){return s?i:t})(e)}function sx(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||$h(e)!="object"&&typeof e!="function")return{default:e};var i=m0(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&{}.hasOwnProperty.call(e,n)){var o=s?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}function Vs(e){return e&&e.__esModule?e:{default:e}}function qs(e){if(e.code){switch(e.code){case"OSLeft":return"MetaLeft";case"OSRight":return"MetaRight"}return e.code}if(e.keyCode in _0.default){var t=_0.default[e.keyCode];if(v0.isMac()&&t==="ContextMenu"&&(t="MetaRight"),e.location===2)switch(t){case"ShiftLeft":return"ShiftRight";case"ControlLeft":return"ControlRight";case"AltLeft":return"AltRight"}if(e.location===3)switch(t){case"Delete":return"NumpadDecimal";case"Insert":return"Numpad0";case"End":return"Numpad1";case"ArrowDown":return"Numpad2";case"PageDown":return"Numpad3";case"ArrowLeft":return"Numpad4";case"ArrowRight":return"Numpad6";case"Home":return"Numpad7";case"ArrowUp":return"Numpad8";case"PageUp":return"Numpad9";case"Enter":return"NumpadEnter"}return t}return"Unidentified"}function y0(e){if(e.key!==void 0&&e.key!=="Unidentified"){switch(e.key){case"OS":return"Meta";case"LaunchMyComputer":return"LaunchApplication1";case"LaunchCalculator":return"LaunchApplication2"}switch(e.key){case"UIKeyInputUpArrow":return"ArrowUp";case"UIKeyInputDownArrow":return"ArrowDown";case"UIKeyInputLeftArrow":return"ArrowLeft";case"UIKeyInputRightArrow":return"ArrowRight";case"UIKeyInputEscape":return"Escape"}return e.key==="\0"&&e.code==="NumpadDecimal"?"Delete":e.key}var t=qs(e);return t in g0.default?g0.default[t]:e.charCode?String.fromCharCode(e.charCode):"Unidentified"}function nx(e){var t=y0(e);if(t==="Unidentified")return null;if(t in p0.default){var i=e.location;if(t==="Meta"&&i===0&&(i=2),t==="Clear"&&i===3){var r=qs(e);r==="NumLock"&&(i=0)}if((i===void 0||i>3)&&(i=0),t==="Meta"){var s=qs(e);if(s==="AltLeft")return js.default.XK_Meta_L;if(s==="AltRight")return js.default.XK_Meta_R}if(t==="Clear"){var n=qs(e);if(n==="NumLock")return js.default.XK_Num_Lock}if(v0.isWindows())switch(t){case"Zenkaku":case"Hankaku":return js.default.XK_Zenkaku_Hankaku;case"Romaji":case"KanaMode":return js.default.XK_Romaji}return p0.default[t][i]}if(t.length!==1)return null;var o=t.charCodeAt();return o?rx.default.lookup(o):null}});var S0=ie(Oo=>{"use strict";Object.defineProperty(Oo,"__esModule",{value:!0});Oo.default=void 0;var Gh=jh(wi()),ns=sh(),w0=jh(b0()),Te=ox(ss()),Ct=jh(Ts());function ox(e){return e&&e.__esModule?e:{default:e}}function x0(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(x0=function(s){return s?i:t})(e)}function jh(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||os(e)!="object"&&typeof e!="function")return{default:e};var i=x0(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&{}.hasOwnProperty.call(e,n)){var o=s?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}function os(e){"@babel/helpers - typeof";return os=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},os(e)}function ax(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function A0(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,hx(r.key),r)}}function lx(e,t,i){return t&&A0(e.prototype,t),i&&A0(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function hx(e){var t=cx(e,"string");return os(t)=="symbol"?t:t+""}function cx(e,t){if(os(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(os(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var C4=Oo.default=function(){function e(t){ax(this,e),this._target=t||null,this._keyDownList={},this._altGrArmed=!1,this._eventHandlers={keyup:this._handleKeyUp.bind(this),keydown:this._handleKeyDown.bind(this),blur:this._allKeysUp.bind(this)},this.onkeyevent=function(){}}return lx(e,[{key:"_sendKeyEvent",value:function(i,r,s){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(s)this._keyDownList[r]=i;else{if(!(r in this._keyDownList))return;delete this._keyDownList[r]}Gh.Debug("onkeyevent "+(s?"down":"up")+", keysym: "+i,", code: "+r+", numlock: "+n+", capslock: "+o),this.onkeyevent(i,r,s,n,o)}},{key:"_getKeyCode",value:function(i){var r=w0.getKeycode(i);if(r!=="Unidentified")return r;if(i.keyCode&&i.keyCode!==229)return"Platform"+i.keyCode;if(i.keyIdentifier){if(i.keyIdentifier.substr(0,2)!=="U+")return i.keyIdentifier;var s=parseInt(i.keyIdentifier.substr(2),16),n=String.fromCharCode(s).toUpperCase();return"Platform"+n.charCodeAt()}return"Unidentified"}},{key:"_handleKeyDown",value:function(i){var r=this._getKeyCode(i),s=w0.getKeysym(i),n=i.getModifierState("NumLock"),o=i.getModifierState("CapsLock");if((Ct.isMac()||Ct.isIOS())&&(n=null),this._altGrArmed&&(this._altGrArmed=!1,clearTimeout(this._altGrTimeout),r==="AltRight"&&i.timeStamp-this._altGrCtrlTime<50?s=Te.default.XK_ISO_Level3_Shift:this._sendKeyEvent(Te.default.XK_Control_L,"ControlLeft",!0,n,o)),r==="Unidentified"){s&&(this._sendKeyEvent(s,r,!0,n,o),this._sendKeyEvent(s,r,!1,n,o)),(0,ns.stopEvent)(i);return}if(Ct.isMac()||Ct.isIOS())switch(s){case Te.default.XK_Super_L:s=Te.default.XK_Alt_L;break;case Te.default.XK_Super_R:s=Te.default.XK_Super_L;break;case Te.default.XK_Alt_L:s=Te.default.XK_Mode_switch;break;case Te.default.XK_Alt_R:s=Te.default.XK_ISO_Level3_Shift;break}if(r in this._keyDownList&&(s=this._keyDownList[r]),(Ct.isMac()||Ct.isIOS())&&i.metaKey&&r!=="MetaLeft"&&r!=="MetaRight"){this._sendKeyEvent(s,r,!0,n,o),this._sendKeyEvent(s,r,!1,n,o),(0,ns.stopEvent)(i);return}if((Ct.isMac()||Ct.isIOS())&&r==="CapsLock"){this._sendKeyEvent(Te.default.XK_Caps_Lock,"CapsLock",!0,n,o),this._sendKeyEvent(Te.default.XK_Caps_Lock,"CapsLock",!1,n,o),(0,ns.stopEvent)(i);return}var a=[Te.default.XK_Zenkaku_Hankaku,Te.default.XK_Eisu_toggle,Te.default.XK_Katakana,Te.default.XK_Hiragana,Te.default.XK_Romaji];if(Ct.isWindows()&&a.includes(s)){this._sendKeyEvent(s,r,!0,n,o),this._sendKeyEvent(s,r,!1,n,o),(0,ns.stopEvent)(i);return}if((0,ns.stopEvent)(i),r==="ControlLeft"&&Ct.isWindows()&&!("ControlLeft"in this._keyDownList)){this._altGrArmed=!0,this._altGrTimeout=setTimeout(this._handleAltGrTimeout.bind(this),100),this._altGrCtrlTime=i.timeStamp;return}this._sendKeyEvent(s,r,!0,n,o)}},{key:"_handleKeyUp",value:function(i){(0,ns.stopEvent)(i);var r=this._getKeyCode(i);if(this._altGrArmed&&(this._altGrArmed=!1,clearTimeout(this._altGrTimeout),this._sendKeyEvent(Te.default.XK_Control_L,"ControlLeft",!0)),(Ct.isMac()||Ct.isIOS())&&r==="CapsLock"){this._sendKeyEvent(Te.default.XK_Caps_Lock,"CapsLock",!0),this._sendKeyEvent(Te.default.XK_Caps_Lock,"CapsLock",!1);return}this._sendKeyEvent(this._keyDownList[r],r,!1),Ct.isWindows()&&(r==="ShiftLeft"||r==="ShiftRight")&&("ShiftRight"in this._keyDownList&&this._sendKeyEvent(this._keyDownList.ShiftRight,"ShiftRight",!1),"ShiftLeft"in this._keyDownList&&this._sendKeyEvent(this._keyDownList.ShiftLeft,"ShiftLeft",!1))}},{key:"_handleAltGrTimeout",value:function(){this._altGrArmed=!1,clearTimeout(this._altGrTimeout),this._sendKeyEvent(Te.default.XK_Control_L,"ControlLeft",!0)}},{key:"_allKeysUp",value:function(){Gh.Debug(">> Keyboard.allKeysUp");for(var i in this._keyDownList)this._sendKeyEvent(this._keyDownList[i],i,!1);Gh.Debug("<< Keyboard.allKeysUp")}},{key:"grab",value:function(){this._target.addEventListener("keydown",this._eventHandlers.keydown),this._target.addEventListener("keyup",this._eventHandlers.keyup),window.addEventListener("blur",this._eventHandlers.blur)}},{key:"ungrab",value:function(){this._target.removeEventListener("keydown",this._eventHandlers.keydown),this._target.removeEventListener("keyup",this._eventHandlers.keyup),window.removeEventListener("blur",this._eventHandlers.blur),this._allKeysUp()}}])}()});var B0=ie(No=>{"use strict";Object.defineProperty(No,"__esModule",{value:!0});No.default=void 0;function rn(e){"@babel/helpers - typeof";return rn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rn(e)}function ux(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C0(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,fx(r.key),r)}}function dx(e,t,i){return t&&C0(e.prototype,t),i&&C0(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function fx(e){var t=_x(e,"string");return rn(t)=="symbol"?t:t+""}function _x(e,t){if(rn(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(rn(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var ni=0,Js=1,Zs=2,en=4,Ko=8,tn=16,er=32,tr=64,qh=127,k0=50,gx=90,E0=250,px=1e3,vx=1e3,mx=50,E4=No.default=function(){function e(){ux(this,e),this._target=null,this._state=qh,this._tracked=[],this._ignored=[],this._waitingRelease=!1,this._releaseStart=0,this._longpressTimeoutId=null,this._twoTouchTimeoutId=null,this._boundEventHandler=this._eventHandler.bind(this)}return dx(e,[{key:"attach",value:function(i){this.detach(),this._target=i,this._target.addEventListener("touchstart",this._boundEventHandler),this._target.addEventListener("touchmove",this._boundEventHandler),this._target.addEventListener("touchend",this._boundEventHandler),this._target.addEventListener("touchcancel",this._boundEventHandler)}},{key:"detach",value:function(){this._target&&(this._stopLongpressTimeout(),this._stopTwoTouchTimeout(),this._target.removeEventListener("touchstart",this._boundEventHandler),this._target.removeEventListener("touchmove",this._boundEventHandler),this._target.removeEventListener("touchend",this._boundEventHandler),this._target.removeEventListener("touchcancel",this._boundEventHandler),this._target=null)}},{key:"_eventHandler",value:function(i){var r;switch(i.stopPropagation(),i.preventDefault(),i.type){case"touchstart":r=this._touchStart;break;case"touchmove":r=this._touchMove;break;case"touchend":case"touchcancel":r=this._touchEnd;break}for(var s=0;s<i.changedTouches.length;s++){var n=i.changedTouches[s];r.call(this,n.identifier,n.clientX,n.clientY)}}},{key:"_touchStart",value:function(i,r,s){if(this._hasDetectedGesture()||this._state===ni){this._ignored.push(i);return}if(this._tracked.length>0&&Date.now()-this._tracked[0].started>E0){this._state=ni,this._ignored.push(i);return}if(this._waitingRelease){this._state=ni,this._ignored.push(i);return}switch(this._tracked.push({id:i,started:Date.now(),active:!0,firstX:r,firstY:s,lastX:r,lastY:s,angle:0}),this._tracked.length){case 1:this._startLongpressTimeout();break;case 2:this._state&=~(Js|Ko|tn),this._stopLongpressTimeout();break;case 3:this._state&=~(Zs|er|tr);break;default:this._state=ni}}},{key:"_touchMove",value:function(i,r,s){var n=this._tracked.find(function(u){return u.id===i});if(n!==void 0){n.lastX=r,n.lastY=s;var o=r-n.firstX,a=s-n.firstY;if((n.firstX!==n.lastX||n.firstY!==n.lastY)&&(n.angle=Math.atan2(a,o)*180/Math.PI),!this._hasDetectedGesture()){if(Math.hypot(o,a)<k0)return;if(this._state&=~(Js|Zs|en|tn),this._stopLongpressTimeout(),this._tracked.length!==1&&(this._state&=~Ko),this._tracked.length!==2&&(this._state&=~(er|tr)),this._tracked.length===2){var h=this._tracked.find(function(u){return u.id!==i}),l=Math.hypot(h.firstX-h.lastX,h.firstY-h.lastY);if(l>k0){var c=Math.abs(n.angle-h.angle);c=Math.abs((c+180)%360-180),c>gx?this._state&=~er:this._state&=~tr,this._isTwoTouchTimeoutRunning()&&this._stopTwoTouchTimeout()}else this._isTwoTouchTimeoutRunning()||this._startTwoTouchTimeout()}if(!this._hasDetectedGesture())return;this._pushEvent("gesturestart")}this._pushEvent("gesturemove")}}},{key:"_touchEnd",value:function(i,r,s){if(this._ignored.indexOf(i)!==-1){this._ignored.splice(this._ignored.indexOf(i),1),this._ignored.length===0&&this._tracked.length===0&&(this._state=qh,this._waitingRelease=!1);return}if(!this._hasDetectedGesture()&&this._isTwoTouchTimeoutRunning()&&(this._stopTwoTouchTimeout(),this._state=ni),!this._hasDetectedGesture()&&(this._state&=~(Ko|er|tr),this._state&=~tn,this._stopLongpressTimeout(),!this._waitingRelease))switch(this._releaseStart=Date.now(),this._waitingRelease=!0,this._tracked.length){case 1:this._state&=~(Zs|en);break;case 2:this._state&=~(Js|en);break}if(this._waitingRelease){Date.now()-this._releaseStart>E0&&(this._state=ni),this._tracked.some(function(a){return Date.now()-a.started>px})&&(this._state=ni);var n=this._tracked.find(function(a){return a.id===i});if(n.active=!1,this._hasDetectedGesture())this._pushEvent("gesturestart");else if(this._state!==ni)return}this._hasDetectedGesture()&&this._pushEvent("gestureend");for(var o=0;o<this._tracked.length;o++)this._tracked[o].active&&this._ignored.push(this._tracked[o].id);this._tracked=[],this._state=ni,this._ignored.indexOf(i)!==-1&&this._ignored.splice(this._ignored.indexOf(i),1),this._ignored.length===0&&(this._state=qh,this._waitingRelease=!1)}},{key:"_hasDetectedGesture",value:function(){return!(this._state===ni||this._state&this._state-1||this._state&(Js|Zs|en)&&this._tracked.some(function(i){return i.active}))}},{key:"_startLongpressTimeout",value:function(){var i=this;this._stopLongpressTimeout(),this._longpressTimeoutId=setTimeout(function(){return i._longpressTimeout()},vx)}},{key:"_stopLongpressTimeout",value:function(){clearTimeout(this._longpressTimeoutId),this._longpressTimeoutId=null}},{key:"_longpressTimeout",value:function(){if(this._hasDetectedGesture())throw new Error("A longpress gesture failed, conflict with a different gesture");this._state=tn,this._pushEvent("gesturestart")}},{key:"_startTwoTouchTimeout",value:function(){var i=this;this._stopTwoTouchTimeout(),this._twoTouchTimeoutId=setTimeout(function(){return i._twoTouchTimeout()},mx)}},{key:"_stopTwoTouchTimeout",value:function(){clearTimeout(this._twoTouchTimeoutId),this._twoTouchTimeoutId=null}},{key:"_isTwoTouchTimeoutRunning",value:function(){return this._twoTouchTimeoutId!==null}},{key:"_twoTouchTimeout",value:function(){if(this._tracked.length===0)throw new Error("A pinch or two drag gesture failed, no tracked touches");var i=this._getAverageMovement(),r=Math.abs(i.x),s=Math.abs(i.y),n=this._getAverageDistance(),o=Math.abs(Math.hypot(n.first.x,n.first.y)-Math.hypot(n.last.x,n.last.y));s<o&&r<o?this._state=tr:this._state=er,this._pushEvent("gesturestart"),this._pushEvent("gesturemove")}},{key:"_pushEvent",value:function(i){var r={type:this._stateToGesture(this._state)},s=this._getPosition(),n=s.last;switch(i==="gesturestart"&&(n=s.first),this._state){case er:case tr:n=s.first;break}if(r.clientX=n.x,r.clientY=n.y,this._state===tr){var o=this._getAverageDistance();i==="gesturestart"?(r.magnitudeX=o.first.x,r.magnitudeY=o.first.y):(r.magnitudeX=o.last.x,r.magnitudeY=o.last.y)}else if(this._state===er)if(i==="gesturestart")r.magnitudeX=0,r.magnitudeY=0;else{var a=this._getAverageMovement();r.magnitudeX=a.x,r.magnitudeY=a.y}var h=new CustomEvent(i,{detail:r});this._target.dispatchEvent(h)}},{key:"_stateToGesture",value:function(i){switch(i){case Js:return"onetap";case Zs:return"twotap";case en:return"threetap";case Ko:return"drag";case tn:return"longpress";case er:return"twodrag";case tr:return"pinch"}throw new Error("Unknown gesture state: "+i)}},{key:"_getPosition",value:function(){if(this._tracked.length===0)throw new Error("Failed to get gesture position, no tracked touches");for(var i=this._tracked.length,r=0,s=0,n=0,o=0,a=0;a<this._tracked.length;a++)r+=this._tracked[a].firstX,s+=this._tracked[a].firstY,n+=this._tracked[a].lastX,o+=this._tracked[a].lastY;return{first:{x:r/i,y:s/i},last:{x:n/i,y:o/i}}}},{key:"_getAverageMovement",value:function(){if(this._tracked.length===0)throw new Error("Failed to get gesture movement, no tracked touches");var i,r;i=r=0;for(var s=this._tracked.length,n=0;n<this._tracked.length;n++)i+=this._tracked[n].lastX-this._tracked[n].firstX,r+=this._tracked[n].lastY-this._tracked[n].firstY;return{x:i/s,y:r/s}}},{key:"_getAverageDistance",value:function(){if(this._tracked.length===0)throw new Error("Failed to get gesture distance, no tracked touches");var i=this._tracked[0],r=this._tracked[this._tracked.length-1],s=Math.abs(r.firstX-i.firstX),n=Math.abs(r.firstY-i.firstY),o=Math.abs(r.lastX-i.lastX),a=Math.abs(r.lastY-i.lastY);return{first:{x:s,y:n},last:{x:o,y:a}}}}])}()});var I0=ie(Qo=>{"use strict";Object.defineProperty(Qo,"__esModule",{value:!0});Qo.default=void 0;var L0=Ts();function nn(e){"@babel/helpers - typeof";return nn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nn(e)}function yx(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function D0(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,wx(r.key),r)}}function bx(e,t,i){return t&&D0(e.prototype,t),i&&D0(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function wx(e){var t=Ax(e,"string");return nn(t)=="symbol"?t:t+""}function Ax(e,t){if(nn(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(nn(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var sn=!L0.supportsCursorURIs||L0.isTouchDevice,L4=Qo.default=function(){function e(){yx(this,e),this._target=null,this._canvas=document.createElement("canvas"),sn&&(this._canvas.style.position="fixed",this._canvas.style.zIndex="65535",this._canvas.style.pointerEvents="none",this._canvas.style.userSelect="none",this._canvas.style.WebkitUserSelect="none",this._canvas.style.visibility="hidden"),this._position={x:0,y:0},this._hotSpot={x:0,y:0},this._eventHandlers={mouseover:this._handleMouseOver.bind(this),mouseleave:this._handleMouseLeave.bind(this),mousemove:this._handleMouseMove.bind(this),mouseup:this._handleMouseUp.bind(this)}}return bx(e,[{key:"attach",value:function(i){if(this._target&&this.detach(),this._target=i,sn){document.body.appendChild(this._canvas);var r={capture:!0,passive:!0};this._target.addEventListener("mouseover",this._eventHandlers.mouseover,r),this._target.addEventListener("mouseleave",this._eventHandlers.mouseleave,r),this._target.addEventListener("mousemove",this._eventHandlers.mousemove,r),this._target.addEventListener("mouseup",this._eventHandlers.mouseup,r)}this.clear()}},{key:"detach",value:function(){if(this._target){if(sn){var i={capture:!0,passive:!0};this._target.removeEventListener("mouseover",this._eventHandlers.mouseover,i),this._target.removeEventListener("mouseleave",this._eventHandlers.mouseleave,i),this._target.removeEventListener("mousemove",this._eventHandlers.mousemove,i),this._target.removeEventListener("mouseup",this._eventHandlers.mouseup,i),document.contains(this._canvas)&&document.body.removeChild(this._canvas)}this._target=null}}},{key:"change",value:function(i,r,s,n,o){if(n===0||o===0){this.clear();return}this._position.x=this._position.x+this._hotSpot.x-r,this._position.y=this._position.y+this._hotSpot.y-s,this._hotSpot.x=r,this._hotSpot.y=s;var a=this._canvas.getContext("2d");this._canvas.width=n,this._canvas.height=o;var h=new ImageData(new Uint8ClampedArray(i),n,o);if(a.clearRect(0,0,n,o),a.putImageData(h,0,0),sn)this._updatePosition();else{var l=this._canvas.toDataURL();this._target.style.cursor="url("+l+")"+r+" "+s+", default"}}},{key:"clear",value:function(){this._target.style.cursor="none",this._canvas.width=0,this._canvas.height=0,this._position.x=this._position.x+this._hotSpot.x,this._position.y=this._position.y+this._hotSpot.y,this._hotSpot.x=0,this._hotSpot.y=0}},{key:"move",value:function(i,r){if(sn){window.visualViewport?(this._position.x=i+window.visualViewport.offsetLeft,this._position.y=r+window.visualViewport.offsetTop):(this._position.x=i,this._position.y=r),this._updatePosition();var s=document.elementFromPoint(i,r);this._updateVisibility(s)}}},{key:"_handleMouseOver",value:function(i){this._handleMouseMove(i)}},{key:"_handleMouseLeave",value:function(i){this._updateVisibility(i.relatedTarget)}},{key:"_handleMouseMove",value:function(i){this._updateVisibility(i.target),this._position.x=i.clientX-this._hotSpot.x,this._position.y=i.clientY-this._hotSpot.y,this._updatePosition()}},{key:"_handleMouseUp",value:function(i){var r=this,s=document.elementFromPoint(i.clientX,i.clientY);this._updateVisibility(s),this._captureIsActive()&&window.setTimeout(function(){r._target&&(s=document.elementFromPoint(i.clientX,i.clientY),r._updateVisibility(s))},0)}},{key:"_showCursor",value:function(){this._canvas.style.visibility==="hidden"&&(this._canvas.style.visibility="")}},{key:"_hideCursor",value:function(){this._canvas.style.visibility!=="hidden"&&(this._canvas.style.visibility="hidden")}},{key:"_shouldShowCursor",value:function(i){return i?i===this._target?!0:!(!this._target.contains(i)||window.getComputedStyle(i).cursor!=="none"):!1}},{key:"_updateVisibility",value:function(i){this._captureIsActive()&&(i=document.captureElement),this._shouldShowCursor(i)?this._showCursor():this._hideCursor()}},{key:"_updatePosition",value:function(){this._canvas.style.left=this._position.x+"px",this._canvas.style.top=this._position.y+"px"}},{key:"_captureIsActive",value:function(){return document.captureElement&&document.documentElement.contains(document.captureElement)}}])}()});var P0=ie(Uo=>{"use strict";Object.defineProperty(Uo,"__esModule",{value:!0});Uo.default=void 0;var Si=xx(wi());function F0(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(F0=function(s){return s?i:t})(e)}function xx(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||as(e)!="object"&&typeof e!="function")return{default:e};var i=F0(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&{}.hasOwnProperty.call(e,n)){var o=s?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}function as(e){"@babel/helpers - typeof";return as=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},as(e)}function M0(e){return Ex(e)||kx(e)||Cx(e)||Sx()}function Sx(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Cx(e,t){if(e){if(typeof e=="string")return Yh(e,t);var i={}.toString.call(e).slice(8,-1);return i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set"?Array.from(e):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Yh(e,t):void 0}}function kx(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Ex(e){if(Array.isArray(e))return Yh(e)}function Yh(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,r=Array(t);i<t;i++)r[i]=e[i];return r}function Bx(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function T0(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Dx(r.key),r)}}function Lx(e,t,i){return t&&T0(e.prototype,t),i&&T0(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function Dx(e){var t=Ix(e,"string");return as(t)=="symbol"?t:t+""}function Ix(e,t){if(as(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(as(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Vh=40*1024*1024,Ho={CONNECTING:"connecting",OPEN:"open",CLOSING:"closing",CLOSED:"closed"},Xo={CONNECTING:[WebSocket.CONNECTING,Ho.CONNECTING],OPEN:[WebSocket.OPEN,Ho.OPEN],CLOSING:[WebSocket.CLOSING,Ho.CLOSING],CLOSED:[WebSocket.CLOSED,Ho.CLOSED]},R0=["send","close","binaryType","onerror","onmessage","onopen","protocol","readyState"],I4=Uo.default=function(){function e(){Bx(this,e),this._websocket=null,this._rQi=0,this._rQlen=0,this._rQbufferSize=1024*1024*4,this._rQ=null,this._sQbufferSize=1024*10,this._sQlen=0,this._sQ=null,this._eventHandlers={message:function(){},open:function(){},close:function(){},error:function(){}}}return Lx(e,[{key:"readyState",get:function(){var i;return this._websocket===null?"unused":(i=this._websocket.readyState,Xo.CONNECTING.includes(i)?"connecting":Xo.OPEN.includes(i)?"open":Xo.CLOSING.includes(i)?"closing":Xo.CLOSED.includes(i)?"closed":"unknown")}},{key:"rQpeek8",value:function(){return this._rQ[this._rQi]}},{key:"rQskipBytes",value:function(i){this._rQi+=i}},{key:"rQshift8",value:function(){return this._rQshift(1)}},{key:"rQshift16",value:function(){return this._rQshift(2)}},{key:"rQshift32",value:function(){return this._rQshift(4)}},{key:"_rQshift",value:function(i){for(var r=0,s=i-1;s>=0;s--)r+=this._rQ[this._rQi++]<<s*8;return r>>>0}},{key:"rQshiftStr",value:function(i){for(var r="",s=0;s<i;s+=4096){var n=this.rQshiftBytes(Math.min(4096,i-s),!1);r+=String.fromCharCode.apply(null,n)}return r}},{key:"rQshiftBytes",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return this._rQi+=i,r?this._rQ.slice(this._rQi-i,this._rQi):this._rQ.subarray(this._rQi-i,this._rQi)}},{key:"rQshiftTo",value:function(i,r){i.set(new Uint8Array(this._rQ.buffer,this._rQi,r)),this._rQi+=r}},{key:"rQpeekBytes",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return r?this._rQ.slice(this._rQi,this._rQi+i):this._rQ.subarray(this._rQi,this._rQi+i)}},{key:"rQwait",value:function(i,r,s){if(this._rQlen-this._rQi<r){if(s){if(this._rQi<s)throw new Error("rQwait cannot backup "+s+" bytes");this._rQi-=s}return!0}return!1}},{key:"sQpush8",value:function(i){this._sQensureSpace(1),this._sQ[this._sQlen++]=i}},{key:"sQpush16",value:function(i){this._sQensureSpace(2),this._sQ[this._sQlen++]=i>>8&255,this._sQ[this._sQlen++]=i>>0&255}},{key:"sQpush32",value:function(i){this._sQensureSpace(4),this._sQ[this._sQlen++]=i>>24&255,this._sQ[this._sQlen++]=i>>16&255,this._sQ[this._sQlen++]=i>>8&255,this._sQ[this._sQlen++]=i>>0&255}},{key:"sQpushString",value:function(i){var r=i.split("").map(function(s){return s.charCodeAt(0)});this.sQpushBytes(new Uint8Array(r))}},{key:"sQpushBytes",value:function(i){for(var r=0;r<i.length;){this._sQensureSpace(1);var s=this._sQbufferSize-this._sQlen;s>i.length-r&&(s=i.length-r),this._sQ.set(i.subarray(r,s),this._sQlen),this._sQlen+=s,r+=s}}},{key:"flush",value:function(){this._sQlen>0&&this.readyState==="open"&&(this._websocket.send(new Uint8Array(this._sQ.buffer,0,this._sQlen)),this._sQlen=0)}},{key:"_sQensureSpace",value:function(i){this._sQbufferSize-this._sQlen<i&&this.flush()}},{key:"off",value:function(i){this._eventHandlers[i]=function(){}}},{key:"on",value:function(i,r){this._eventHandlers[i]=r}},{key:"_allocateBuffers",value:function(){this._rQ=new Uint8Array(this._rQbufferSize),this._sQ=new Uint8Array(this._sQbufferSize)}},{key:"init",value:function(){this._allocateBuffers(),this._rQi=0,this._websocket=null}},{key:"open",value:function(i,r){this.attach(new WebSocket(i,r))}},{key:"attach",value:function(i){var r=this;this.init();for(var s=[].concat(M0(Object.keys(i)),M0(Object.getOwnPropertyNames(Object.getPrototypeOf(i)))),n=0;n<R0.length;n++){var o=R0[n];if(s.indexOf(o)<0)throw new Error("Raw channel missing property: "+o)}this._websocket=i,this._websocket.binaryType="arraybuffer",this._websocket.onmessage=this._recvMessage.bind(this),this._websocket.onopen=function(){Si.Debug(">> WebSock.onopen"),r._websocket.protocol&&Si.Info("Server choose sub-protocol: "+r._websocket.protocol),r._eventHandlers.open(),Si.Debug("<< WebSock.onopen")},this._websocket.onclose=function(a){Si.Debug(">> WebSock.onclose"),r._eventHandlers.close(a),Si.Debug("<< WebSock.onclose")},this._websocket.onerror=function(a){Si.Debug(">> WebSock.onerror: "+a),r._eventHandlers.error(a),Si.Debug("<< WebSock.onerror: "+a)}}},{key:"close",value:function(){this._websocket&&((this.readyState==="connecting"||this.readyState==="open")&&(Si.Info("Closing WebSocket connection"),this._websocket.close()),this._websocket.onmessage=function(){})}},{key:"_expandCompactRQ",value:function(i){var r=(this._rQlen-this._rQi+i)*8,s=this._rQbufferSize<r;if(s&&(this._rQbufferSize=Math.max(this._rQbufferSize*2,r)),this._rQbufferSize>Vh&&(this._rQbufferSize=Vh,this._rQbufferSize-(this._rQlen-this._rQi)<i))throw new Error("Receive Queue buffer exceeded "+Vh+" bytes, and the new message could not fit");if(s){var n=this._rQ.buffer;this._rQ=new Uint8Array(this._rQbufferSize),this._rQ.set(new Uint8Array(n,this._rQi,this._rQlen-this._rQi))}else this._rQ.copyWithin(0,this._rQi,this._rQlen);this._rQlen=this._rQlen-this._rQi,this._rQi=0}},{key:"_recvMessage",value:function(i){this._rQlen==this._rQi&&(this._rQlen=0,this._rQi=0);var r=new Uint8Array(i.data);r.length>this._rQbufferSize-this._rQlen&&this._expandCompactRQ(r.length),this._rQ.set(r,this._rQlen),this._rQlen+=r.length,this._rQlen-this._rQi>0?this._eventHandlers.message():Si.Debug("Ignoring empty message")}}])}()});var O0=ie(zo=>{"use strict";Object.defineProperty(zo,"__esModule",{value:!0});zo.default=void 0;var T4=zo.default={Again:57349,AltLeft:56,AltRight:57400,ArrowDown:57424,ArrowLeft:57419,ArrowRight:57421,ArrowUp:57416,AudioVolumeDown:57390,AudioVolumeMute:57376,AudioVolumeUp:57392,Backquote:41,Backslash:43,Backspace:14,BracketLeft:26,BracketRight:27,BrowserBack:57450,BrowserFavorites:57446,BrowserForward:57449,BrowserHome:57394,BrowserRefresh:57447,BrowserSearch:57445,BrowserStop:57448,CapsLock:58,Comma:51,ContextMenu:57437,ControlLeft:29,ControlRight:57373,Convert:121,Copy:57464,Cut:57404,Delete:57427,Digit0:11,Digit1:2,Digit2:3,Digit3:4,Digit4:5,Digit5:6,Digit6:7,Digit7:8,Digit8:9,Digit9:10,Eject:57469,End:57423,Enter:28,Equal:13,Escape:1,F1:59,F10:68,F11:87,F12:88,F13:93,F14:94,F15:95,F16:85,F17:57347,F18:57463,F19:57348,F2:60,F20:90,F21:116,F22:57465,F23:109,F24:111,F3:61,F4:62,F5:63,F6:64,F7:65,F8:66,F9:67,Find:57409,Help:57461,Hiragana:119,Home:57415,Insert:57426,IntlBackslash:86,IntlRo:115,IntlYen:125,KanaMode:112,Katakana:120,KeyA:30,KeyB:48,KeyC:46,KeyD:32,KeyE:18,KeyF:33,KeyG:34,KeyH:35,KeyI:23,KeyJ:36,KeyK:37,KeyL:38,KeyM:50,KeyN:49,KeyO:24,KeyP:25,KeyQ:16,KeyR:19,KeyS:31,KeyT:20,KeyU:22,KeyV:47,KeyW:17,KeyX:45,KeyY:21,KeyZ:44,Lang1:114,Lang2:113,Lang3:120,Lang4:119,Lang5:118,LaunchApp1:57451,LaunchApp2:57377,LaunchMail:57452,MediaPlayPause:57378,MediaSelect:57453,MediaStop:57380,MediaTrackNext:57369,MediaTrackPrevious:57360,MetaLeft:57435,MetaRight:57436,Minus:12,NonConvert:123,NumLock:69,Numpad0:82,Numpad1:79,Numpad2:80,Numpad3:81,Numpad4:75,Numpad5:76,Numpad6:77,Numpad7:71,Numpad8:72,Numpad9:73,NumpadAdd:78,NumpadComma:126,NumpadDecimal:83,NumpadDivide:57397,NumpadEnter:57372,NumpadEqual:89,NumpadMultiply:55,NumpadParenLeft:57462,NumpadParenRight:57467,NumpadSubtract:74,Open:100,PageDown:57425,PageUp:57417,Paste:101,Pause:57414,Period:52,Power:57438,PrintScreen:84,Props:57350,Quote:40,ScrollLock:70,Semicolon:39,ShiftLeft:42,ShiftRight:54,Slash:53,Sleep:57439,Space:57,Suspend:57381,Tab:15,Undo:57351,WakeUp:57443}});var K0=ie(on=>{"use strict";Object.defineProperty(on,"__esModule",{value:!0});on.encodingName=Mx;on.encodings=void 0;var ir=on.encodings={encodingRaw:0,encodingCopyRect:1,encodingRRE:2,encodingHextile:5,encodingTight:7,encodingZRLE:16,encodingTightPNG:-260,encodingJPEG:21,pseudoEncodingQualityLevel9:-23,pseudoEncodingQualityLevel0:-32,pseudoEncodingDesktopSize:-223,pseudoEncodingLastRect:-224,pseudoEncodingCursor:-239,pseudoEncodingQEMUExtendedKeyEvent:-258,pseudoEncodingQEMULedEvent:-261,pseudoEncodingDesktopName:-307,pseudoEncodingExtendedDesktopSize:-308,pseudoEncodingXvp:-309,pseudoEncodingFence:-312,pseudoEncodingContinuousUpdates:-313,pseudoEncodingCompressLevel9:-247,pseudoEncodingCompressLevel0:-256,pseudoEncodingVMwareCursor:1464686180,pseudoEncodingExtendedClipboard:3231835598};function Mx(e){switch(e){case ir.encodingRaw:return"Raw";case ir.encodingCopyRect:return"CopyRect";case ir.encodingRRE:return"RRE";case ir.encodingHextile:return"Hextile";case ir.encodingTight:return"Tight";case ir.encodingZRLE:return"ZRLE";case ir.encodingTightPNG:return"TightPNG";case ir.encodingJPEG:return"JPEG";default:return"[unknown encoding "+e+"]"}}});var U0=ie(ls=>{"use strict";Object.defineProperty(ls,"__esModule",{value:!0});ls.AESECBCipher=ls.AESEAXCipher=void 0;function Tr(e){"@babel/helpers - typeof";return Tr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Tr(e)}function me(){"use strict";me=function(){return t};var e,t={},i=Object.prototype,r=i.hasOwnProperty,s=Object.defineProperty||function(f,d,_){f[d]=_.value},n=typeof Symbol=="function"?Symbol:{},o=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",h=n.toStringTag||"@@toStringTag";function l(f,d,_){return Object.defineProperty(f,d,{value:_,enumerable:!0,configurable:!0,writable:!0}),f[d]}try{l({},"")}catch{l=function(_,y,A){return _[y]=A}}function c(f,d,_,y){var A=d&&d.prototype instanceof E?d:E,S=Object.create(A.prototype),F=new w(y||[]);return s(S,"_invoke",{value:V(f,_,F)}),S}function u(f,d,_){try{return{type:"normal",arg:f.call(d,_)}}catch(y){return{type:"throw",arg:y}}}t.wrap=c;var p="suspendedStart",g="suspendedYield",v="executing",m="completed",x={};function E(){}function R(){}function D(){}var b={};l(b,o,function(){return this});var L=Object.getPrototypeOf,I=L&&L(L(k([])));I&&I!==i&&r.call(I,o)&&(b=I);var T=D.prototype=E.prototype=Object.create(b);function q(f){["next","throw","return"].forEach(function(d){l(f,d,function(_){return this._invoke(d,_)})})}function $(f,d){function _(A,S,F,U){var W=u(f[A],f,S);if(W.type!=="throw"){var z=W.arg,J=z.value;return J&&Tr(J)=="object"&&r.call(J,"__await")?d.resolve(J.__await).then(function(ee){_("next",ee,F,U)},function(ee){_("throw",ee,F,U)}):d.resolve(J).then(function(ee){z.value=ee,F(z)},function(ee){return _("throw",ee,F,U)})}U(W.arg)}var y;s(this,"_invoke",{value:function(S,F){function U(){return new d(function(W,z){_(S,F,W,z)})}return y=y?y.then(U,U):U()}})}function V(f,d,_){var y=p;return function(A,S){if(y===v)throw Error("Generator is already running");if(y===m){if(A==="throw")throw S;return{value:e,done:!0}}for(_.method=A,_.arg=S;;){var F=_.delegate;if(F){var U=j(F,_);if(U){if(U===x)continue;return U}}if(_.method==="next")_.sent=_._sent=_.arg;else if(_.method==="throw"){if(y===p)throw y=m,_.arg;_.dispatchException(_.arg)}else _.method==="return"&&_.abrupt("return",_.arg);y=v;var W=u(f,d,_);if(W.type==="normal"){if(y=_.done?m:g,W.arg===x)continue;return{value:W.arg,done:_.done}}W.type==="throw"&&(y=m,_.method="throw",_.arg=W.arg)}}}function j(f,d){var _=d.method,y=f.iterator[_];if(y===e)return d.delegate=null,_==="throw"&&f.iterator.return&&(d.method="return",d.arg=e,j(f,d),d.method==="throw")||_!=="return"&&(d.method="throw",d.arg=new TypeError("The iterator does not provide a '"+_+"' method")),x;var A=u(y,f.iterator,d.arg);if(A.type==="throw")return d.method="throw",d.arg=A.arg,d.delegate=null,x;var S=A.arg;return S?S.done?(d[f.resultName]=S.value,d.next=f.nextLoc,d.method!=="return"&&(d.method="next",d.arg=e),d.delegate=null,x):S:(d.method="throw",d.arg=new TypeError("iterator result is not an object"),d.delegate=null,x)}function ne(f){var d={tryLoc:f[0]};1 in f&&(d.catchLoc=f[1]),2 in f&&(d.finallyLoc=f[2],d.afterLoc=f[3]),this.tryEntries.push(d)}function C(f){var d=f.completion||{};d.type="normal",delete d.arg,f.completion=d}function w(f){this.tryEntries=[{tryLoc:"root"}],f.forEach(ne,this),this.reset(!0)}function k(f){if(f||f===""){var d=f[o];if(d)return d.call(f);if(typeof f.next=="function")return f;if(!isNaN(f.length)){var _=-1,y=function A(){for(;++_<f.length;)if(r.call(f,_))return A.value=f[_],A.done=!1,A;return A.value=e,A.done=!0,A};return y.next=y}}throw new TypeError(Tr(f)+" is not iterable")}return R.prototype=D,s(T,"constructor",{value:D,configurable:!0}),s(D,"constructor",{value:R,configurable:!0}),R.displayName=l(D,h,"GeneratorFunction"),t.isGeneratorFunction=function(f){var d=typeof f=="function"&&f.constructor;return!!d&&(d===R||(d.displayName||d.name)==="GeneratorFunction")},t.mark=function(f){return Object.setPrototypeOf?Object.setPrototypeOf(f,D):(f.__proto__=D,l(f,h,"GeneratorFunction")),f.prototype=Object.create(T),f},t.awrap=function(f){return{__await:f}},q($.prototype),l($.prototype,a,function(){return this}),t.AsyncIterator=$,t.async=function(f,d,_,y,A){A===void 0&&(A=Promise);var S=new $(c(f,d,_,y),A);return t.isGeneratorFunction(d)?S:S.next().then(function(F){return F.done?F.value:S.next()})},q(T),l(T,h,"Generator"),l(T,o,function(){return this}),l(T,"toString",function(){return"[object Generator]"}),t.keys=function(f){var d=Object(f),_=[];for(var y in d)_.push(y);return _.reverse(),function A(){for(;_.length;){var S=_.pop();if(S in d)return A.value=S,A.done=!1,A}return A.done=!0,A}},t.values=k,w.prototype={constructor:w,reset:function(d){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!d)for(var _ in this)_.charAt(0)==="t"&&r.call(this,_)&&!isNaN(+_.slice(1))&&(this[_]=e)},stop:function(){this.done=!0;var d=this.tryEntries[0].completion;if(d.type==="throw")throw d.arg;return this.rval},dispatchException:function(d){if(this.done)throw d;var _=this;function y(z,J){return F.type="throw",F.arg=d,_.next=z,J&&(_.method="next",_.arg=e),!!J}for(var A=this.tryEntries.length-1;A>=0;--A){var S=this.tryEntries[A],F=S.completion;if(S.tryLoc==="root")return y("end");if(S.tryLoc<=this.prev){var U=r.call(S,"catchLoc"),W=r.call(S,"finallyLoc");if(U&&W){if(this.prev<S.catchLoc)return y(S.catchLoc,!0);if(this.prev<S.finallyLoc)return y(S.finallyLoc)}else if(U){if(this.prev<S.catchLoc)return y(S.catchLoc,!0)}else{if(!W)throw Error("try statement without catch or finally");if(this.prev<S.finallyLoc)return y(S.finallyLoc)}}}},abrupt:function(d,_){for(var y=this.tryEntries.length-1;y>=0;--y){var A=this.tryEntries[y];if(A.tryLoc<=this.prev&&r.call(A,"finallyLoc")&&this.prev<A.finallyLoc){var S=A;break}}S&&(d==="break"||d==="continue")&&S.tryLoc<=_&&_<=S.finallyLoc&&(S=null);var F=S?S.completion:{};return F.type=d,F.arg=_,S?(this.method="next",this.next=S.finallyLoc,x):this.complete(F)},complete:function(d,_){if(d.type==="throw")throw d.arg;return d.type==="break"||d.type==="continue"?this.next=d.arg:d.type==="return"?(this.rval=this.arg=d.arg,this.method="return",this.next="end"):d.type==="normal"&&_&&(this.next=_),x},finish:function(d){for(var _=this.tryEntries.length-1;_>=0;--_){var y=this.tryEntries[_];if(y.finallyLoc===d)return this.complete(y.completion,y.afterLoc),C(y),x}},catch:function(d){for(var _=this.tryEntries.length-1;_>=0;--_){var y=this.tryEntries[_];if(y.tryLoc===d){var A=y.completion;if(A.type==="throw"){var S=A.arg;C(y)}return S}}throw Error("illegal catch attempt")},delegateYield:function(d,_,y){return this.delegate={iterator:k(d),resultName:_,nextLoc:y},this.method==="next"&&(this.arg=e),x}},t}function N0(e,t,i,r,s,n,o){try{var a=e[n](o),h=a.value}catch(l){return void i(l)}a.done?t(h):Promise.resolve(h).then(r,s)}function Ot(e){return function(){var t=this,i=arguments;return new Promise(function(r,s){var n=e.apply(t,i);function o(h){N0(n,r,s,o,a,"next",h)}function a(h){N0(n,r,s,o,a,"throw",h)}o(void 0)})}}function H0(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Q0(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Tx(r.key),r)}}function X0(e,t,i){return t&&Q0(e.prototype,t),i&&Q0(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function Tx(e){var t=Rx(e,"string");return Tr(t)=="symbol"?t:t+""}function Rx(e,t){if(Tr(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(Tr(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var P4=ls.AESECBCipher=function(){function e(){H0(this,e),this._key=null}return X0(e,[{key:"algorithm",get:function(){return{name:"AES-ECB"}}},{key:"_importKey",value:function(){var t=Ot(me().mark(function r(s,n,o){return me().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,window.crypto.subtle.importKey("raw",s,{name:"AES-CBC"},n,o);case 2:this._key=h.sent;case 3:case"end":return h.stop()}},r,this)}));function i(r,s,n){return t.apply(this,arguments)}return i}()},{key:"encrypt",value:function(){var t=Ot(me().mark(function r(s,n){var o,a,h,l;return me().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(o=new Uint8Array(n),!(o.length%16!==0||this._key===null)){u.next=3;break}return u.abrupt("return",null);case 3:a=o.length/16,h=0;case 5:if(!(h<a)){u.next=15;break}return u.t0=Uint8Array,u.next=9,window.crypto.subtle.encrypt({name:"AES-CBC",iv:new Uint8Array(16)},this._key,o.slice(h*16,h*16+16));case 9:u.t1=u.sent,l=new u.t0(u.t1).slice(0,16),o.set(l,h*16);case 12:h++,u.next=5;break;case 15:return u.abrupt("return",o);case 16:case"end":return u.stop()}},r,this)}));function i(r,s){return t.apply(this,arguments)}return i}()}],[{key:"importKey",value:function(){var t=Ot(me().mark(function r(s,n,o,a){var h;return me().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return h=new e,c.next=3,h._importKey(s,o,a);case 3:return c.abrupt("return",h);case 4:case"end":return c.stop()}},r)}));function i(r,s,n,o){return t.apply(this,arguments)}return i}()}])}(),O4=ls.AESEAXCipher=function(){function e(){H0(this,e),this._rawKey=null,this._ctrKey=null,this._cbcKey=null,this._zeroBlock=new Uint8Array(16),this._prefixBlock0=this._zeroBlock,this._prefixBlock1=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1]),this._prefixBlock2=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2])}return X0(e,[{key:"algorithm",get:function(){return{name:"AES-EAX"}}},{key:"_encryptBlock",value:function(){var t=Ot(me().mark(function r(s){var n;return me().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,window.crypto.subtle.encrypt({name:"AES-CBC",iv:this._zeroBlock},this._cbcKey,s);case 2:return n=a.sent,a.abrupt("return",new Uint8Array(n).slice(0,16));case 4:case"end":return a.stop()}},r,this)}));function i(r){return t.apply(this,arguments)}return i}()},{key:"_initCMAC",value:function(){var t=Ot(me().mark(function r(){var s,n,o,a,h;return me().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this._encryptBlock(this._zeroBlock);case 2:for(s=c.sent,n=new Uint8Array(16),o=s[0]>>>6,a=0;a<15;a++)n[a]=s[a+1]>>6|s[a]<<2,s[a]=s[a+1]>>7|s[a]<<1;h=[0,135,14,137],n[14]^=o>>>1,n[15]=s[15]<<2^h[o],s[15]=s[15]<<1^h[o>>1],this._k1=s,this._k2=n;case 12:case"end":return c.stop()}},r,this)}));function i(){return t.apply(this,arguments)}return i}()},{key:"_encryptCTR",value:function(){var t=Ot(me().mark(function r(s,n){var o;return me().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,window.crypto.subtle.encrypt({name:"AES-CTR",counter:n,length:128},this._ctrKey,s);case 2:return o=h.sent,h.abrupt("return",new Uint8Array(o));case 4:case"end":return h.stop()}},r,this)}));function i(r,s){return t.apply(this,arguments)}return i}()},{key:"_decryptCTR",value:function(){var t=Ot(me().mark(function r(s,n){var o;return me().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,window.crypto.subtle.decrypt({name:"AES-CTR",counter:n,length:128},this._ctrKey,s);case 2:return o=h.sent,h.abrupt("return",new Uint8Array(o));case 4:case"end":return h.stop()}},r,this)}));function i(r,s){return t.apply(this,arguments)}return i}()},{key:"_computeCMAC",value:function(){var t=Ot(me().mark(function r(s,n){var o,a,h,l,c,u,p,g;return me().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(n.length===16){m.next=2;break}return m.abrupt("return",null);case 2:if(o=Math.floor(s.length/16),a=Math.ceil(s.length/16),h=s.length-o*16,l=new Uint8Array((a+1)*16),l.set(n),l.set(s,16),h===0)for(c=0;c<16;c++)l[o*16+c]^=this._k1[c];else for(l[(o+1)*16+h]=128,u=0;u<16;u++)l[(o+1)*16+u]^=this._k2[u];return m.next=11,window.crypto.subtle.encrypt({name:"AES-CBC",iv:this._zeroBlock},this._cbcKey,l);case 11:return p=m.sent,p=new Uint8Array(p),g=p.slice(p.length-32,p.length-16),m.abrupt("return",g);case 15:case"end":return m.stop()}},r,this)}));function i(r,s){return t.apply(this,arguments)}return i}()},{key:"_importKey",value:function(){var t=Ot(me().mark(function r(s){return me().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this._rawKey=s,o.next=3,window.crypto.subtle.importKey("raw",s,{name:"AES-CTR"},!1,["encrypt","decrypt"]);case 3:return this._ctrKey=o.sent,o.next=6,window.crypto.subtle.importKey("raw",s,{name:"AES-CBC"},!1,["encrypt"]);case 6:return this._cbcKey=o.sent,o.next=9,this._initCMAC();case 9:case"end":return o.stop()}},r,this)}));function i(r){return t.apply(this,arguments)}return i}()},{key:"encrypt",value:function(){var t=Ot(me().mark(function r(s,n){var o,a,h,l,c,u,p,g;return me().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return o=s.additionalData,a=s.iv,m.next=4,this._computeCMAC(a,this._prefixBlock0);case 4:return h=m.sent,m.next=7,this._encryptCTR(n,h);case 7:return l=m.sent,m.next=10,this._computeCMAC(o,this._prefixBlock1);case 10:return c=m.sent,m.next=13,this._computeCMAC(l,this._prefixBlock2);case 13:for(u=m.sent,p=0;p<16;p++)u[p]^=h[p]^c[p];return g=new Uint8Array(16+l.length),g.set(l),g.set(u,l.length),m.abrupt("return",g);case 19:case"end":return m.stop()}},r,this)}));function i(r,s){return t.apply(this,arguments)}return i}()},{key:"decrypt",value:function(){var t=Ot(me().mark(function r(s,n){var o,a,h,l,c,u,p,g,v,m;return me().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return o=n.slice(0,n.length-16),a=s.additionalData,h=s.iv,l=n.slice(n.length-16),E.next=6,this._computeCMAC(h,this._prefixBlock0);case 6:return c=E.sent,E.next=9,this._computeCMAC(a,this._prefixBlock1);case 9:return u=E.sent,E.next=12,this._computeCMAC(o,this._prefixBlock2);case 12:for(p=E.sent,g=0;g<16;g++)p[g]^=c[g]^u[g];if(p.length===l.length){E.next=16;break}return E.abrupt("return",null);case 16:v=0;case 17:if(!(v<l.length)){E.next=23;break}if(p[v]===l[v]){E.next=20;break}return E.abrupt("return",null);case 20:v++,E.next=17;break;case 23:return E.next=25,this._decryptCTR(o,c);case 25:return m=E.sent,E.abrupt("return",m);case 27:case"end":return E.stop()}},r,this)}));function i(r,s){return t.apply(this,arguments)}return i}()}],[{key:"importKey",value:function(){var t=Ot(me().mark(function r(s,n,o,a){var h;return me().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return h=new e,c.next=3,h._importKey(s);case 3:return c.abrupt("return",h);case 4:case"end":return c.stop()}},r)}));function i(r,s,n,o){return t.apply(this,arguments)}return i}()}])}()});var tg=ie(hs=>{"use strict";Object.defineProperty(hs,"__esModule",{value:!0});hs.DESECBCipher=hs.DESCBCCipher=void 0;function an(e){"@babel/helpers - typeof";return an=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},an(e)}function Jh(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function z0(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Fx(r.key),r)}}function Zh(e,t,i){return t&&z0(e.prototype,t),i&&z0(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function Fx(e){var t=Px(e,"string");return an(t)=="symbol"?t:t+""}function Px(e,t){if(an(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(an(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var W0=[13,16,10,23,0,4,2,27,14,5,20,9,22,18,11,3,25,7,15,6,26,19,12,1,40,51,30,36,46,54,29,39,50,44,32,47,43,48,38,55,33,52,45,41,49,35,28,31],Ox=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],B=0,P,O,H,K,N,X;P=65536;O=1<<24;H=P|O;K=4;N=1024;X=K|N;var $0=[H|N,B|B,P|B,H|X,H|K,P|X,B|K,P|B,B|N,H|N,H|X,B|N,O|X,H|K,O|B,B|K,B|X,O|N,O|N,P|N,P|N,H|B,H|B,O|X,P|K,O|K,O|K,P|K,B|B,B|X,P|X,O|B,P|B,H|X,B|K,H|B,H|N,O|B,O|B,B|N,H|K,P|B,P|N,O|K,B|N,B|K,O|X,P|X,H|X,P|K,H|B,O|X,O|K,B|X,P|X,H|N,B|X,O|N,O|N,B|B,P|K,P|N,B|B,H|K];P=1<<20;O=1<<31;H=P|O;K=32;N=32768;X=K|N;var G0=[H|X,O|N,B|N,P|X,P|B,B|K,H|K,O|X,O|K,H|X,H|N,O|B,O|N,P|B,B|K,H|K,P|N,P|K,O|X,B|B,O|B,B|N,P|X,H|B,P|K,O|K,B|B,P|N,B|X,H|N,H|B,B|X,B|B,P|X,H|K,P|B,O|X,H|B,H|N,B|N,H|B,O|N,B|K,H|X,P|X,B|K,B|N,O|B,B|X,H|N,P|B,O|K,P|K,O|X,O|K,P|K,P|N,B|B,O|N,B|X,O|B,H|K,H|X,P|N];P=1<<17;O=1<<27;H=P|O;K=8;N=512;X=K|N;var j0=[B|X,H|N,B|B,H|K,O|N,B|B,P|X,O|N,P|K,O|K,O|K,P|B,H|X,P|K,H|B,B|X,O|B,B|K,H|N,B|N,P|N,H|B,H|K,P|X,O|X,P|N,P|B,O|X,B|K,H|X,B|N,O|B,H|N,O|B,P|K,B|X,P|B,H|N,O|N,B|B,B|N,P|K,H|X,O|N,O|K,B|N,B|B,H|K,O|X,P|B,O|B,H|X,B|K,P|X,P|N,O|K,H|B,O|X,B|X,H|B,P|X,B|K,H|K,P|N];P=8192;O=1<<23;H=P|O;K=1;N=128;X=K|N;var q0=[H|K,P|X,P|X,B|N,H|N,O|X,O|K,P|K,B|B,H|B,H|B,H|X,B|X,B|B,O|N,O|K,B|K,P|B,O|B,H|K,B|N,O|B,P|K,P|N,O|X,B|K,P|N,O|N,P|B,H|N,H|X,B|X,O|N,O|K,H|B,H|X,B|X,B|B,B|B,H|B,P|N,O|N,O|X,B|K,H|K,P|X,P|X,B|N,H|X,B|X,B|K,P|B,O|K,P|K,H|N,O|X,P|K,P|N,O|B,H|K,B|N,O|B,P|B,H|N];P=1<<25;O=1<<30;H=P|O;K=256;N=1<<19;X=K|N;var V0=[B|K,P|X,P|N,H|K,B|N,B|K,O|B,P|N,O|X,B|N,P|K,O|X,H|K,H|N,B|X,O|B,P|B,O|N,O|N,B|B,O|K,H|X,H|X,P|K,H|N,O|K,B|B,H|B,P|X,P|B,H|B,B|X,B|N,H|K,B|K,P|B,O|B,P|N,H|K,O|X,P|K,O|B,H|N,P|X,O|X,B|K,P|B,H|N,H|X,B|X,H|B,H|X,P|N,B|B,O|N,H|B,B|X,P|K,O|K,B|N,B|B,O|N,P|X,O|K];P=1<<22;O=1<<29;H=P|O;K=16;N=16384;X=K|N;var Y0=[O|K,H|B,B|N,H|X,H|B,B|K,H|X,P|B,O|N,P|X,P|B,O|K,P|K,O|N,O|B,B|X,B|B,P|K,O|X,B|N,P|N,O|X,B|K,H|K,H|K,B|B,P|X,H|N,B|X,P|N,H|N,O|B,O|N,B|K,H|K,P|N,H|X,P|B,B|X,O|K,P|B,O|N,O|B,B|X,O|K,H|X,P|N,H|B,P|X,H|N,B|B,H|K,B|K,B|N,H|B,P|X,B|N,P|K,O|X,B|B,H|N,O|B,P|K,O|X];P=1<<21;O=1<<26;H=P|O;K=2;N=2048;X=K|N;var J0=[P|B,H|K,O|X,B|B,B|N,O|X,P|X,H|N,H|X,P|B,B|B,O|K,B|K,O|B,H|K,B|X,O|N,P|X,P|K,O|N,O|K,H|B,H|N,P|K,H|B,B|N,B|X,H|X,P|N,B|K,O|B,P|N,O|B,P|N,P|B,O|X,O|X,H|K,H|K,B|K,P|K,O|B,O|N,P|B,H|N,B|X,P|X,H|N,B|X,O|K,H|X,H|B,P|N,B|B,B|K,H|X,B|B,P|X,H|B,B|N,O|K,O|N,B|N,P|K];P=1<<18;O=1<<28;H=P|O;K=64;N=4096;X=K|N;var Z0=[O|X,B|N,P|B,H|X,O|B,O|X,B|K,O|B,P|K,H|B,H|X,P|N,H|N,P|X,B|N,B|K,H|B,O|K,O|N,B|X,P|N,P|K,H|K,H|N,B|X,B|B,B|B,H|K,O|K,O|N,P|X,P|B,P|X,P|B,H|N,B|N,B|K,H|K,B|N,P|X,O|N,B|K,O|K,H|B,H|K,O|B,P|B,O|X,B|B,H|X,P|K,O|K,H|B,O|N,O|X,B|B,H|X,P|N,P|N,B|X,B|X,P|K,O|B,H|N],eg=function(){function e(t){Jh(this,e),this.keys=[];for(var i=[],r=[],s=[],n=0,o=56;n<56;++n,o-=8){o+=o<-5?65:o<-3?31:o<-1?63:o===27?35:0;var a=o&7;i[n]=(t[o>>>3]&1<<a)!==0?1:0}for(var h=0;h<16;++h){var l=h<<1,c=l+1;s[l]=s[c]=0;for(var u=28;u<59;u+=28)for(var p=u-28;p<u;++p){var g=p+Ox[h];r[p]=g<u?i[g]:i[g-28]}for(var v=0;v<24;++v)r[W0[v]]!==0&&(s[l]|=1<<23-v),r[W0[v+24]]!==0&&(s[c]|=1<<23-v)}for(var m=0,x=0,E=0;m<16;++m){var R=s[x++],D=s[x++];this.keys[E]=(R&16515072)<<6,this.keys[E]|=(R&4032)<<10,this.keys[E]|=(D&16515072)>>>10,this.keys[E]|=(D&4032)>>>6,++E,this.keys[E]=(R&258048)<<12,this.keys[E]|=(R&63)<<16,this.keys[E]|=(D&258048)>>>4,this.keys[E]|=D&63,++E}}return Zh(e,[{key:"enc8",value:function(i){var r=i.slice(),s=0,n,o,a;n=r[s++]<<24|r[s++]<<16|r[s++]<<8|r[s++],o=r[s++]<<24|r[s++]<<16|r[s++]<<8|r[s++],a=(n>>>4^o)&252645135,o^=a,n^=a<<4,a=(n>>>16^o)&65535,o^=a,n^=a<<16,a=(o>>>2^n)&858993459,n^=a,o^=a<<2,a=(o>>>8^n)&16711935,n^=a,o^=a<<8,o=o<<1|o>>>31&1,a=(n^o)&2863311530,n^=a,o^=a,n=n<<1|n>>>31&1;for(var h=0,l=0;h<8;++h){a=o<<28|o>>>4,a^=this.keys[l++];var c=J0[a&63];c|=V0[a>>>8&63],c|=j0[a>>>16&63],c|=$0[a>>>24&63],a=o^this.keys[l++],c|=Z0[a&63],c|=Y0[a>>>8&63],c|=q0[a>>>16&63],c|=G0[a>>>24&63],n^=c,a=n<<28|n>>>4,a^=this.keys[l++],c=J0[a&63],c|=V0[a>>>8&63],c|=j0[a>>>16&63],c|=$0[a>>>24&63],a=n^this.keys[l++],c|=Z0[a&63],c|=Y0[a>>>8&63],c|=q0[a>>>16&63],c|=G0[a>>>24&63],o^=c}for(o=o<<31|o>>>1,a=(n^o)&2863311530,n^=a,o^=a,n=n<<31|n>>>1,a=(n>>>8^o)&16711935,o^=a,n^=a<<8,a=(n>>>2^o)&858993459,o^=a,n^=a<<2,a=(o>>>16^n)&65535,n^=a,o^=a<<16,a=(o>>>4^n)&252645135,n^=a,o^=a<<4,a=[o,n],s=0;s<8;s++)r[s]=(a[s>>>2]>>>8*(3-s%4))%256,r[s]<0&&(r[s]+=256);return r}}])}(),N4=hs.DESECBCipher=function(){function e(){Jh(this,e),this._cipher=null}return Zh(e,[{key:"algorithm",get:function(){return{name:"DES-ECB"}}},{key:"_importKey",value:function(i,r,s){this._cipher=new eg(i)}},{key:"encrypt",value:function(i,r){var s=new Uint8Array(r);if(s.length%8!==0||this._cipher===null)return null;for(var n=s.length/8,o=0;o<n;o++)s.set(this._cipher.enc8(s.slice(o*8,o*8+8)),o*8);return s}}],[{key:"importKey",value:function(i,r,s,n){var o=new e;return o._importKey(i),o}}])}(),Q4=hs.DESCBCCipher=function(){function e(){Jh(this,e),this._cipher=null}return Zh(e,[{key:"algorithm",get:function(){return{name:"DES-CBC"}}},{key:"_importKey",value:function(i){this._cipher=new eg(i)}},{key:"encrypt",value:function(i,r){var s=new Uint8Array(r),n=new Uint8Array(i.iv);if(s.length%8!==0||this._cipher===null)return null;for(var o=s.length/8,a=0;a<o;a++){for(var h=0;h<8;h++)n[h]^=r[a*8+h];n=this._cipher.enc8(n),s.set(n,a*8)}return s}}],[{key:"importKey",value:function(i,r,s,n){var o=new e;return o._importKey(i),o}}])}()});var ec=ie(ln=>{"use strict";Object.defineProperty(ln,"__esModule",{value:!0});ln.bigIntToU8Array=Nx;ln.modPow=Kx;ln.u8ArrayToBigInt=Qx;function Kx(e,t,i){var r=1n;for(e=e%i;t>0n;)(t&1n)===1n&&(r=r*e%i),t=t>>1n,e=e*e%i;return r}function Nx(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=e.toString(16);t===0&&(t=Math.ceil(i.length/2)),i=i.padStart(t*2,"0");for(var r=i.length/2,s=new Uint8Array(r),n=0;n<r;n++)s[n]=parseInt(i.slice(n*2,n*2+2),16);return s}function Qx(e){for(var t="0x",i=0;i<e.length;i++)t+=e[i].toString(16).padStart(2,"0");return BigInt(t)}});var sg=ie(Wo=>{"use strict";Object.defineProperty(Wo,"__esModule",{value:!0});Wo.RSACipher=void 0;var Hx=Xx(ah()),qt=ec();function Xx(e){return e&&e.__esModule?e:{default:e}}function Fr(e){"@babel/helpers - typeof";return Fr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fr(e)}function ft(){"use strict";ft=function(){return t};var e,t={},i=Object.prototype,r=i.hasOwnProperty,s=Object.defineProperty||function(f,d,_){f[d]=_.value},n=typeof Symbol=="function"?Symbol:{},o=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",h=n.toStringTag||"@@toStringTag";function l(f,d,_){return Object.defineProperty(f,d,{value:_,enumerable:!0,configurable:!0,writable:!0}),f[d]}try{l({},"")}catch{l=function(_,y,A){return _[y]=A}}function c(f,d,_,y){var A=d&&d.prototype instanceof E?d:E,S=Object.create(A.prototype),F=new w(y||[]);return s(S,"_invoke",{value:V(f,_,F)}),S}function u(f,d,_){try{return{type:"normal",arg:f.call(d,_)}}catch(y){return{type:"throw",arg:y}}}t.wrap=c;var p="suspendedStart",g="suspendedYield",v="executing",m="completed",x={};function E(){}function R(){}function D(){}var b={};l(b,o,function(){return this});var L=Object.getPrototypeOf,I=L&&L(L(k([])));I&&I!==i&&r.call(I,o)&&(b=I);var T=D.prototype=E.prototype=Object.create(b);function q(f){["next","throw","return"].forEach(function(d){l(f,d,function(_){return this._invoke(d,_)})})}function $(f,d){function _(A,S,F,U){var W=u(f[A],f,S);if(W.type!=="throw"){var z=W.arg,J=z.value;return J&&Fr(J)=="object"&&r.call(J,"__await")?d.resolve(J.__await).then(function(ee){_("next",ee,F,U)},function(ee){_("throw",ee,F,U)}):d.resolve(J).then(function(ee){z.value=ee,F(z)},function(ee){return _("throw",ee,F,U)})}U(W.arg)}var y;s(this,"_invoke",{value:function(S,F){function U(){return new d(function(W,z){_(S,F,W,z)})}return y=y?y.then(U,U):U()}})}function V(f,d,_){var y=p;return function(A,S){if(y===v)throw Error("Generator is already running");if(y===m){if(A==="throw")throw S;return{value:e,done:!0}}for(_.method=A,_.arg=S;;){var F=_.delegate;if(F){var U=j(F,_);if(U){if(U===x)continue;return U}}if(_.method==="next")_.sent=_._sent=_.arg;else if(_.method==="throw"){if(y===p)throw y=m,_.arg;_.dispatchException(_.arg)}else _.method==="return"&&_.abrupt("return",_.arg);y=v;var W=u(f,d,_);if(W.type==="normal"){if(y=_.done?m:g,W.arg===x)continue;return{value:W.arg,done:_.done}}W.type==="throw"&&(y=m,_.method="throw",_.arg=W.arg)}}}function j(f,d){var _=d.method,y=f.iterator[_];if(y===e)return d.delegate=null,_==="throw"&&f.iterator.return&&(d.method="return",d.arg=e,j(f,d),d.method==="throw")||_!=="return"&&(d.method="throw",d.arg=new TypeError("The iterator does not provide a '"+_+"' method")),x;var A=u(y,f.iterator,d.arg);if(A.type==="throw")return d.method="throw",d.arg=A.arg,d.delegate=null,x;var S=A.arg;return S?S.done?(d[f.resultName]=S.value,d.next=f.nextLoc,d.method!=="return"&&(d.method="next",d.arg=e),d.delegate=null,x):S:(d.method="throw",d.arg=new TypeError("iterator result is not an object"),d.delegate=null,x)}function ne(f){var d={tryLoc:f[0]};1 in f&&(d.catchLoc=f[1]),2 in f&&(d.finallyLoc=f[2],d.afterLoc=f[3]),this.tryEntries.push(d)}function C(f){var d=f.completion||{};d.type="normal",delete d.arg,f.completion=d}function w(f){this.tryEntries=[{tryLoc:"root"}],f.forEach(ne,this),this.reset(!0)}function k(f){if(f||f===""){var d=f[o];if(d)return d.call(f);if(typeof f.next=="function")return f;if(!isNaN(f.length)){var _=-1,y=function A(){for(;++_<f.length;)if(r.call(f,_))return A.value=f[_],A.done=!1,A;return A.value=e,A.done=!0,A};return y.next=y}}throw new TypeError(Fr(f)+" is not iterable")}return R.prototype=D,s(T,"constructor",{value:D,configurable:!0}),s(D,"constructor",{value:R,configurable:!0}),R.displayName=l(D,h,"GeneratorFunction"),t.isGeneratorFunction=function(f){var d=typeof f=="function"&&f.constructor;return!!d&&(d===R||(d.displayName||d.name)==="GeneratorFunction")},t.mark=function(f){return Object.setPrototypeOf?Object.setPrototypeOf(f,D):(f.__proto__=D,l(f,h,"GeneratorFunction")),f.prototype=Object.create(T),f},t.awrap=function(f){return{__await:f}},q($.prototype),l($.prototype,a,function(){return this}),t.AsyncIterator=$,t.async=function(f,d,_,y,A){A===void 0&&(A=Promise);var S=new $(c(f,d,_,y),A);return t.isGeneratorFunction(d)?S:S.next().then(function(F){return F.done?F.value:S.next()})},q(T),l(T,h,"Generator"),l(T,o,function(){return this}),l(T,"toString",function(){return"[object Generator]"}),t.keys=function(f){var d=Object(f),_=[];for(var y in d)_.push(y);return _.reverse(),function A(){for(;_.length;){var S=_.pop();if(S in d)return A.value=S,A.done=!1,A}return A.done=!0,A}},t.values=k,w.prototype={constructor:w,reset:function(d){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!d)for(var _ in this)_.charAt(0)==="t"&&r.call(this,_)&&!isNaN(+_.slice(1))&&(this[_]=e)},stop:function(){this.done=!0;var d=this.tryEntries[0].completion;if(d.type==="throw")throw d.arg;return this.rval},dispatchException:function(d){if(this.done)throw d;var _=this;function y(z,J){return F.type="throw",F.arg=d,_.next=z,J&&(_.method="next",_.arg=e),!!J}for(var A=this.tryEntries.length-1;A>=0;--A){var S=this.tryEntries[A],F=S.completion;if(S.tryLoc==="root")return y("end");if(S.tryLoc<=this.prev){var U=r.call(S,"catchLoc"),W=r.call(S,"finallyLoc");if(U&&W){if(this.prev<S.catchLoc)return y(S.catchLoc,!0);if(this.prev<S.finallyLoc)return y(S.finallyLoc)}else if(U){if(this.prev<S.catchLoc)return y(S.catchLoc,!0)}else{if(!W)throw Error("try statement without catch or finally");if(this.prev<S.finallyLoc)return y(S.finallyLoc)}}}},abrupt:function(d,_){for(var y=this.tryEntries.length-1;y>=0;--y){var A=this.tryEntries[y];if(A.tryLoc<=this.prev&&r.call(A,"finallyLoc")&&this.prev<A.finallyLoc){var S=A;break}}S&&(d==="break"||d==="continue")&&S.tryLoc<=_&&_<=S.finallyLoc&&(S=null);var F=S?S.completion:{};return F.type=d,F.arg=_,S?(this.method="next",this.next=S.finallyLoc,x):this.complete(F)},complete:function(d,_){if(d.type==="throw")throw d.arg;return d.type==="break"||d.type==="continue"?this.next=d.arg:d.type==="return"?(this.rval=this.arg=d.arg,this.method="return",this.next="end"):d.type==="normal"&&_&&(this.next=_),x},finish:function(d){for(var _=this.tryEntries.length-1;_>=0;--_){var y=this.tryEntries[_];if(y.finallyLoc===d)return this.complete(y.completion,y.afterLoc),C(y),x}},catch:function(d){for(var _=this.tryEntries.length-1;_>=0;--_){var y=this.tryEntries[_];if(y.tryLoc===d){var A=y.completion;if(A.type==="throw"){var S=A.arg;C(y)}return S}}throw Error("illegal catch attempt")},delegateYield:function(d,_,y){return this.delegate={iterator:k(d),resultName:_,nextLoc:y},this.method==="next"&&(this.arg=e),x}},t}function ig(e,t,i,r,s,n,o){try{var a=e[n](o),h=a.value}catch(l){return void i(l)}a.done?t(h):Promise.resolve(h).then(r,s)}function Rr(e){return function(){var t=this,i=arguments;return new Promise(function(r,s){var n=e.apply(t,i);function o(h){ig(n,r,s,o,a,"next",h)}function a(h){ig(n,r,s,o,a,"throw",h)}o(void 0)})}}function Ux(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function rg(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Wx(r.key),r)}}function zx(e,t,i){return t&&rg(e.prototype,t),i&&rg(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function Wx(e){var t=$x(e,"string");return Fr(t)=="symbol"?t:t+""}function $x(e,t){if(Fr(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(Fr(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var U4=Wo.RSACipher=function(){function e(){Ux(this,e),this._keyLength=0,this._keyBytes=0,this._n=null,this._e=null,this._d=null,this._nBigInt=null,this._eBigInt=null,this._dBigInt=null,this._extractable=!1}return zx(e,[{key:"algorithm",get:function(){return{name:"RSA-PKCS1-v1_5"}}},{key:"_base64urlDecode",value:function(i){return i=i.replace(/-/g,"+").replace(/_/g,"/"),i=i.padEnd(Math.ceil(i.length/4)*4,"="),Hx.default.decode(i)}},{key:"_padArray",value:function(i,r){var s=new Uint8Array(r);return s.set(i,r-i.length),s}},{key:"_generateKey",value:function(){var t=Rr(ft().mark(function r(s,n){var o,a;return ft().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this._keyLength=s.modulusLength,this._keyBytes=Math.ceil(this._keyLength/8),l.next=4,window.crypto.subtle.generateKey({name:"RSA-OAEP",modulusLength:s.modulusLength,publicExponent:s.publicExponent,hash:{name:"SHA-256"}},!0,["encrypt","decrypt"]);case 4:return o=l.sent,l.next=7,window.crypto.subtle.exportKey("jwk",o.privateKey);case 7:a=l.sent,this._n=this._padArray(this._base64urlDecode(a.n),this._keyBytes),this._nBigInt=(0,qt.u8ArrayToBigInt)(this._n),this._e=this._padArray(this._base64urlDecode(a.e),this._keyBytes),this._eBigInt=(0,qt.u8ArrayToBigInt)(this._e),this._d=this._padArray(this._base64urlDecode(a.d),this._keyBytes),this._dBigInt=(0,qt.u8ArrayToBigInt)(this._d),this._extractable=n;case 15:case"end":return l.stop()}},r,this)}));function i(r,s){return t.apply(this,arguments)}return i}()},{key:"_importKey",value:function(){var t=Rr(ft().mark(function r(s,n){var o,a;return ft().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(o=s.n,a=s.e,o.length===a.length){l.next=4;break}throw new Error("the sizes of modulus and public exponent do not match");case 4:this._keyBytes=o.length,this._keyLength=this._keyBytes*8,this._n=new Uint8Array(this._keyBytes),this._e=new Uint8Array(this._keyBytes),this._n.set(o),this._e.set(a),this._nBigInt=(0,qt.u8ArrayToBigInt)(this._n),this._eBigInt=(0,qt.u8ArrayToBigInt)(this._e),this._extractable=n;case 13:case"end":return l.stop()}},r,this)}));function i(r,s){return t.apply(this,arguments)}return i}()},{key:"encrypt",value:function(){var t=Rr(ft().mark(function r(s,n){var o,a,h,l,c;return ft().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(!(n.length>this._keyBytes-11)){p.next=2;break}return p.abrupt("return",null);case 2:for(o=new Uint8Array(this._keyBytes-n.length-3),window.crypto.getRandomValues(o),a=0;a<o.length;a++)o[a]=Math.floor(o[a]*254/255+1);return h=new Uint8Array(this._keyBytes),h[1]=2,h.set(o,2),h.set(n,o.length+3),l=(0,qt.u8ArrayToBigInt)(h),c=(0,qt.modPow)(l,this._eBigInt,this._nBigInt),p.abrupt("return",(0,qt.bigIntToU8Array)(c,this._keyBytes));case 12:case"end":return p.stop()}},r,this)}));function i(r,s){return t.apply(this,arguments)}return i}()},{key:"decrypt",value:function(){var t=Rr(ft().mark(function r(s,n){var o,a,h,l;return ft().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(n.length===this._keyBytes){u.next=2;break}return u.abrupt("return",null);case 2:if(o=(0,qt.u8ArrayToBigInt)(n),a=(0,qt.modPow)(o,this._dBigInt,this._nBigInt),h=(0,qt.bigIntToU8Array)(a,this._keyBytes),!(h[0]!==0||h[1]!==2)){u.next=7;break}return u.abrupt("return",null);case 7:l=2;case 8:if(!(l<h.length)){u.next=14;break}if(h[l]!==0){u.next=11;break}return u.abrupt("break",14);case 11:l++,u.next=8;break;case 14:if(l!==h.length){u.next=16;break}return u.abrupt("return",null);case 16:return u.abrupt("return",h.slice(l+1,h.length));case 17:case"end":return u.stop()}},r,this)}));function i(r,s){return t.apply(this,arguments)}return i}()},{key:"exportKey",value:function(){var t=Rr(ft().mark(function r(){return ft().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(this._extractable){n.next=2;break}throw new Error("key is not extractable");case 2:return n.abrupt("return",{n:this._n,e:this._e,d:this._d});case 3:case"end":return n.stop()}},r,this)}));function i(){return t.apply(this,arguments)}return i}()}],[{key:"generateKey",value:function(){var t=Rr(ft().mark(function r(s,n,o){var a;return ft().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return a=new e,l.next=3,a._generateKey(s,n);case 3:return l.abrupt("return",{privateKey:a});case 4:case"end":return l.stop()}},r)}));function i(r,s,n){return t.apply(this,arguments)}return i}()},{key:"importKey",value:function(){var t=Rr(ft().mark(function r(s,n,o,a){var h;return ft().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!(a.length!==1||a[0]!=="encrypt")){c.next=2;break}throw new Error("only support importing RSA public key");case 2:return h=new e,c.next=5,h._importKey(s,o);case 5:return c.abrupt("return",h);case 6:case"end":return c.stop()}},r)}));function i(r,s,n,o){return t.apply(this,arguments)}return i}()}])}()});var lg=ie($o=>{"use strict";Object.defineProperty($o,"__esModule",{value:!0});$o.DHCipher=void 0;var rr=ec();function hn(e){"@babel/helpers - typeof";return hn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hn(e)}function og(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ng(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Gx(r.key),r)}}function ag(e,t,i){return t&&ng(e.prototype,t),i&&ng(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function Gx(e){var t=jx(e,"string");return hn(t)=="symbol"?t:t+""}function jx(e,t){if(hn(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(hn(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var qx=function(){function e(t){og(this,e),this._key=t}return ag(e,[{key:"algorithm",get:function(){return{name:"DH"}}},{key:"exportKey",value:function(){return this._key}}])}(),W4=$o.DHCipher=function(){function e(){og(this,e),this._g=null,this._p=null,this._gBigInt=null,this._pBigInt=null,this._privateKey=null}return ag(e,[{key:"algorithm",get:function(){return{name:"DH"}}},{key:"_generateKey",value:function(i){var r=i.g,s=i.p;this._keyBytes=s.length,this._gBigInt=(0,rr.u8ArrayToBigInt)(r),this._pBigInt=(0,rr.u8ArrayToBigInt)(s),this._privateKey=window.crypto.getRandomValues(new Uint8Array(this._keyBytes)),this._privateKeyBigInt=(0,rr.u8ArrayToBigInt)(this._privateKey),this._publicKey=(0,rr.bigIntToU8Array)((0,rr.modPow)(this._gBigInt,this._privateKeyBigInt,this._pBigInt),this._keyBytes)}},{key:"deriveBits",value:function(i,r){var s=Math.ceil(r/8),n=new Uint8Array(i.public),o=s>this._keyBytes?s:this._keyBytes,a=(0,rr.modPow)((0,rr.u8ArrayToBigInt)(n),this._privateKeyBigInt,this._pBigInt);return(0,rr.bigIntToU8Array)(a,o).slice(0,o)}}],[{key:"generateKey",value:function(i,r){var s=new e;return s._generateKey(i),{privateKey:s,publicKey:new qx(s._publicKey)}}}])}()});var cg=ie(rc=>{"use strict";Object.defineProperty(rc,"__esModule",{value:!0});rc.MD5=Yx;function Go(e){"@babel/helpers - typeof";return Go=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Go(e)}function tc(){"use strict";tc=function(){return t};var e,t={},i=Object.prototype,r=i.hasOwnProperty,s=Object.defineProperty||function(f,d,_){f[d]=_.value},n=typeof Symbol=="function"?Symbol:{},o=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",h=n.toStringTag||"@@toStringTag";function l(f,d,_){return Object.defineProperty(f,d,{value:_,enumerable:!0,configurable:!0,writable:!0}),f[d]}try{l({},"")}catch{l=function(_,y,A){return _[y]=A}}function c(f,d,_,y){var A=d&&d.prototype instanceof E?d:E,S=Object.create(A.prototype),F=new w(y||[]);return s(S,"_invoke",{value:V(f,_,F)}),S}function u(f,d,_){try{return{type:"normal",arg:f.call(d,_)}}catch(y){return{type:"throw",arg:y}}}t.wrap=c;var p="suspendedStart",g="suspendedYield",v="executing",m="completed",x={};function E(){}function R(){}function D(){}var b={};l(b,o,function(){return this});var L=Object.getPrototypeOf,I=L&&L(L(k([])));I&&I!==i&&r.call(I,o)&&(b=I);var T=D.prototype=E.prototype=Object.create(b);function q(f){["next","throw","return"].forEach(function(d){l(f,d,function(_){return this._invoke(d,_)})})}function $(f,d){function _(A,S,F,U){var W=u(f[A],f,S);if(W.type!=="throw"){var z=W.arg,J=z.value;return J&&Go(J)=="object"&&r.call(J,"__await")?d.resolve(J.__await).then(function(ee){_("next",ee,F,U)},function(ee){_("throw",ee,F,U)}):d.resolve(J).then(function(ee){z.value=ee,F(z)},function(ee){return _("throw",ee,F,U)})}U(W.arg)}var y;s(this,"_invoke",{value:function(S,F){function U(){return new d(function(W,z){_(S,F,W,z)})}return y=y?y.then(U,U):U()}})}function V(f,d,_){var y=p;return function(A,S){if(y===v)throw Error("Generator is already running");if(y===m){if(A==="throw")throw S;return{value:e,done:!0}}for(_.method=A,_.arg=S;;){var F=_.delegate;if(F){var U=j(F,_);if(U){if(U===x)continue;return U}}if(_.method==="next")_.sent=_._sent=_.arg;else if(_.method==="throw"){if(y===p)throw y=m,_.arg;_.dispatchException(_.arg)}else _.method==="return"&&_.abrupt("return",_.arg);y=v;var W=u(f,d,_);if(W.type==="normal"){if(y=_.done?m:g,W.arg===x)continue;return{value:W.arg,done:_.done}}W.type==="throw"&&(y=m,_.method="throw",_.arg=W.arg)}}}function j(f,d){var _=d.method,y=f.iterator[_];if(y===e)return d.delegate=null,_==="throw"&&f.iterator.return&&(d.method="return",d.arg=e,j(f,d),d.method==="throw")||_!=="return"&&(d.method="throw",d.arg=new TypeError("The iterator does not provide a '"+_+"' method")),x;var A=u(y,f.iterator,d.arg);if(A.type==="throw")return d.method="throw",d.arg=A.arg,d.delegate=null,x;var S=A.arg;return S?S.done?(d[f.resultName]=S.value,d.next=f.nextLoc,d.method!=="return"&&(d.method="next",d.arg=e),d.delegate=null,x):S:(d.method="throw",d.arg=new TypeError("iterator result is not an object"),d.delegate=null,x)}function ne(f){var d={tryLoc:f[0]};1 in f&&(d.catchLoc=f[1]),2 in f&&(d.finallyLoc=f[2],d.afterLoc=f[3]),this.tryEntries.push(d)}function C(f){var d=f.completion||{};d.type="normal",delete d.arg,f.completion=d}function w(f){this.tryEntries=[{tryLoc:"root"}],f.forEach(ne,this),this.reset(!0)}function k(f){if(f||f===""){var d=f[o];if(d)return d.call(f);if(typeof f.next=="function")return f;if(!isNaN(f.length)){var _=-1,y=function A(){for(;++_<f.length;)if(r.call(f,_))return A.value=f[_],A.done=!1,A;return A.value=e,A.done=!0,A};return y.next=y}}throw new TypeError(Go(f)+" is not iterable")}return R.prototype=D,s(T,"constructor",{value:D,configurable:!0}),s(D,"constructor",{value:R,configurable:!0}),R.displayName=l(D,h,"GeneratorFunction"),t.isGeneratorFunction=function(f){var d=typeof f=="function"&&f.constructor;return!!d&&(d===R||(d.displayName||d.name)==="GeneratorFunction")},t.mark=function(f){return Object.setPrototypeOf?Object.setPrototypeOf(f,D):(f.__proto__=D,l(f,h,"GeneratorFunction")),f.prototype=Object.create(T),f},t.awrap=function(f){return{__await:f}},q($.prototype),l($.prototype,a,function(){return this}),t.AsyncIterator=$,t.async=function(f,d,_,y,A){A===void 0&&(A=Promise);var S=new $(c(f,d,_,y),A);return t.isGeneratorFunction(d)?S:S.next().then(function(F){return F.done?F.value:S.next()})},q(T),l(T,h,"Generator"),l(T,o,function(){return this}),l(T,"toString",function(){return"[object Generator]"}),t.keys=function(f){var d=Object(f),_=[];for(var y in d)_.push(y);return _.reverse(),function A(){for(;_.length;){var S=_.pop();if(S in d)return A.value=S,A.done=!1,A}return A.done=!0,A}},t.values=k,w.prototype={constructor:w,reset:function(d){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!d)for(var _ in this)_.charAt(0)==="t"&&r.call(this,_)&&!isNaN(+_.slice(1))&&(this[_]=e)},stop:function(){this.done=!0;var d=this.tryEntries[0].completion;if(d.type==="throw")throw d.arg;return this.rval},dispatchException:function(d){if(this.done)throw d;var _=this;function y(z,J){return F.type="throw",F.arg=d,_.next=z,J&&(_.method="next",_.arg=e),!!J}for(var A=this.tryEntries.length-1;A>=0;--A){var S=this.tryEntries[A],F=S.completion;if(S.tryLoc==="root")return y("end");if(S.tryLoc<=this.prev){var U=r.call(S,"catchLoc"),W=r.call(S,"finallyLoc");if(U&&W){if(this.prev<S.catchLoc)return y(S.catchLoc,!0);if(this.prev<S.finallyLoc)return y(S.finallyLoc)}else if(U){if(this.prev<S.catchLoc)return y(S.catchLoc,!0)}else{if(!W)throw Error("try statement without catch or finally");if(this.prev<S.finallyLoc)return y(S.finallyLoc)}}}},abrupt:function(d,_){for(var y=this.tryEntries.length-1;y>=0;--y){var A=this.tryEntries[y];if(A.tryLoc<=this.prev&&r.call(A,"finallyLoc")&&this.prev<A.finallyLoc){var S=A;break}}S&&(d==="break"||d==="continue")&&S.tryLoc<=_&&_<=S.finallyLoc&&(S=null);var F=S?S.completion:{};return F.type=d,F.arg=_,S?(this.method="next",this.next=S.finallyLoc,x):this.complete(F)},complete:function(d,_){if(d.type==="throw")throw d.arg;return d.type==="break"||d.type==="continue"?this.next=d.arg:d.type==="return"?(this.rval=this.arg=d.arg,this.method="return",this.next="end"):d.type==="normal"&&_&&(this.next=_),x},finish:function(d){for(var _=this.tryEntries.length-1;_>=0;--_){var y=this.tryEntries[_];if(y.finallyLoc===d)return this.complete(y.completion,y.afterLoc),C(y),x}},catch:function(d){for(var _=this.tryEntries.length-1;_>=0;--_){var y=this.tryEntries[_];if(y.tryLoc===d){var A=y.completion;if(A.type==="throw"){var S=A.arg;C(y)}return S}}throw Error("illegal catch attempt")},delegateYield:function(d,_,y){return this.delegate={iterator:k(d),resultName:_,nextLoc:y},this.method==="next"&&(this.arg=e),x}},t}function hg(e,t,i,r,s,n,o){try{var a=e[n](o),h=a.value}catch(l){return void i(l)}a.done?t(h):Promise.resolve(h).then(r,s)}function Vx(e){return function(){var t=this,i=arguments;return new Promise(function(r,s){var n=e.apply(t,i);function o(h){hg(n,r,s,o,a,"next",h)}function a(h){hg(n,r,s,o,a,"throw",h)}o(void 0)})}}function Yx(e){return ic.apply(this,arguments)}function ic(){return ic=Vx(tc().mark(function e(t){var i,r;return tc().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:for(i="",r=0;r<t.length;r++)i+=String.fromCharCode(t[r]);return n.abrupt("return",Jx(eS(tS(Zx(i),8*i.length))));case 3:case"end":return n.stop()}},e)})),ic.apply(this,arguments)}function Jx(e){for(var t=new Uint8Array(e.length),i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}function Zx(e){for(var t=Array(e.length>>2),i=0;i<t.length;i++)t[i]=0;for(var r=0;r<8*e.length;r+=8)t[r>>5]|=(255&e.charCodeAt(r/8))<<r%32;return t}function eS(e){for(var t="",i=0;i<32*e.length;i+=8)t+=String.fromCharCode(e[i>>5]>>>i%32&255);return t}function tS(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var i=1732584193,r=-271733879,s=-1732584194,n=271733878,o=0;o<e.length;o+=16){var a=i,h=r,l=s,c=n;r=ht(r=ht(r=ht(r=ht(r=lt(r=lt(r=lt(r=lt(r=at(r=at(r=at(r=at(r=ot(r=ot(r=ot(r=ot(r,s=ot(s,n=ot(n,i=ot(i,r,s,n,e[o+0],7,-680876936),r,s,e[o+1],12,-389564586),i,r,e[o+2],17,606105819),n,i,e[o+3],22,-1044525330),s=ot(s,n=ot(n,i=ot(i,r,s,n,e[o+4],7,-176418897),r,s,e[o+5],12,1200080426),i,r,e[o+6],17,-1473231341),n,i,e[o+7],22,-45705983),s=ot(s,n=ot(n,i=ot(i,r,s,n,e[o+8],7,1770035416),r,s,e[o+9],12,-1958414417),i,r,e[o+10],17,-42063),n,i,e[o+11],22,-1990404162),s=ot(s,n=ot(n,i=ot(i,r,s,n,e[o+12],7,1804603682),r,s,e[o+13],12,-40341101),i,r,e[o+14],17,-1502002290),n,i,e[o+15],22,1236535329),s=at(s,n=at(n,i=at(i,r,s,n,e[o+1],5,-165796510),r,s,e[o+6],9,-1069501632),i,r,e[o+11],14,643717713),n,i,e[o+0],20,-373897302),s=at(s,n=at(n,i=at(i,r,s,n,e[o+5],5,-701558691),r,s,e[o+10],9,38016083),i,r,e[o+15],14,-660478335),n,i,e[o+4],20,-405537848),s=at(s,n=at(n,i=at(i,r,s,n,e[o+9],5,568446438),r,s,e[o+14],9,-1019803690),i,r,e[o+3],14,-187363961),n,i,e[o+8],20,1163531501),s=at(s,n=at(n,i=at(i,r,s,n,e[o+13],5,-1444681467),r,s,e[o+2],9,-51403784),i,r,e[o+7],14,1735328473),n,i,e[o+12],20,-1926607734),s=lt(s,n=lt(n,i=lt(i,r,s,n,e[o+5],4,-378558),r,s,e[o+8],11,-2022574463),i,r,e[o+11],16,1839030562),n,i,e[o+14],23,-35309556),s=lt(s,n=lt(n,i=lt(i,r,s,n,e[o+1],4,-1530992060),r,s,e[o+4],11,1272893353),i,r,e[o+7],16,-155497632),n,i,e[o+10],23,-1094730640),s=lt(s,n=lt(n,i=lt(i,r,s,n,e[o+13],4,681279174),r,s,e[o+0],11,-358537222),i,r,e[o+3],16,-722521979),n,i,e[o+6],23,76029189),s=lt(s,n=lt(n,i=lt(i,r,s,n,e[o+9],4,-640364487),r,s,e[o+12],11,-421815835),i,r,e[o+15],16,530742520),n,i,e[o+2],23,-995338651),s=ht(s,n=ht(n,i=ht(i,r,s,n,e[o+0],6,-198630844),r,s,e[o+7],10,1126891415),i,r,e[o+14],15,-1416354905),n,i,e[o+5],21,-57434055),s=ht(s,n=ht(n,i=ht(i,r,s,n,e[o+12],6,1700485571),r,s,e[o+3],10,-1894986606),i,r,e[o+10],15,-1051523),n,i,e[o+1],21,-2054922799),s=ht(s,n=ht(n,i=ht(i,r,s,n,e[o+8],6,1873313359),r,s,e[o+15],10,-30611744),i,r,e[o+6],15,-1560198380),n,i,e[o+13],21,1309151649),s=ht(s,n=ht(n,i=ht(i,r,s,n,e[o+4],6,-145523070),r,s,e[o+11],10,-1120210379),i,r,e[o+2],15,718787259),n,i,e[o+9],21,-343485551),i=sr(i,a),r=sr(r,h),s=sr(s,l),n=sr(n,c)}return Array(i,r,s,n)}function jo(e,t,i,r,s,n){return sr(iS(sr(sr(t,e),sr(r,n)),s),i)}function ot(e,t,i,r,s,n,o){return jo(t&i|~t&r,e,t,s,n,o)}function at(e,t,i,r,s,n,o){return jo(t&r|i&~r,e,t,s,n,o)}function lt(e,t,i,r,s,n,o){return jo(t^i^r,e,t,s,n,o)}function ht(e,t,i,r,s,n,o){return jo(i^(t|~r),e,t,s,n,o)}function sr(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}function iS(e,t){return e<<t|e>>>32-t}});var sc=ie(qo=>{"use strict";Object.defineProperty(qo,"__esModule",{value:!0});qo.default=void 0;var ug=U0(),dg=tg(),rS=sg(),sS=lg(),nS=cg();function cn(e){"@babel/helpers - typeof";return cn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cn(e)}function oS(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function fg(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,lS(r.key),r)}}function aS(e,t,i){return t&&fg(e.prototype,t),i&&fg(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function lS(e){var t=hS(e,"string");return cn(t)=="symbol"?t:t+""}function hS(e,t){if(cn(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(cn(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var cS=function(){function e(){oS(this,e),this._algorithms={"AES-ECB":ug.AESECBCipher,"AES-EAX":ug.AESEAXCipher,"DES-ECB":dg.DESECBCipher,"DES-CBC":dg.DESCBCCipher,"RSA-PKCS1-v1_5":rS.RSACipher,DH:sS.DHCipher,MD5:nS.MD5}}return aS(e,[{key:"encrypt",value:function(i,r,s){if(r.algorithm.name!==i.name)throw new Error("algorithm does not match");if(typeof r.encrypt!="function")throw new Error("key does not support encryption");return r.encrypt(i,s)}},{key:"decrypt",value:function(i,r,s){if(r.algorithm.name!==i.name)throw new Error("algorithm does not match");if(typeof r.decrypt!="function")throw new Error("key does not support encryption");return r.decrypt(i,s)}},{key:"importKey",value:function(i,r,s,n,o){if(i!=="raw")throw new Error("key format is not supported");var a=this._algorithms[s.name];if(typeof a>"u"||typeof a.importKey!="function")throw new Error("algorithm is not supported");return a.importKey(r,s,n,o)}},{key:"generateKey",value:function(i,r,s){var n=this._algorithms[i.name];if(typeof n>"u"||typeof n.generateKey!="function")throw new Error("algorithm is not supported");return n.generateKey(i,r,s)}},{key:"exportKey",value:function(i,r){if(i!=="raw")throw new Error("key format is not supported");if(typeof r.exportKey!="function")throw new Error("key does not support exportKey");return r.exportKey()}},{key:"digest",value:function(i,r){var s=this._algorithms[i];if(typeof s!="function")throw new Error("algorithm is not supported");return s(r)}},{key:"deriveBits",value:function(i,r,s){if(r.algorithm.name!==i.name)throw new Error("algorithm does not match");if(typeof r.deriveBits!="function")throw new Error("key does not support deriveBits");return r.deriveBits(i,s)}}])}(),j4=qo.default=new cS});var Ag=ie(Jo=>{"use strict";Object.defineProperty(Jo,"__esModule",{value:!0});Jo.default=void 0;var _g=Yl(),uS=mg(nh()),nr=mg(sc());function mg(e){return e&&e.__esModule?e:{default:e}}function dS(e,t,i){return t=Yo(t),fS(e,yg()?Reflect.construct(t,i||[],Yo(e).constructor):t.apply(e,i))}function fS(e,t){if(t&&(or(t)=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _S(e)}function _S(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function yg(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(yg=function(){return!!e})()}function Yo(e){return Yo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Yo(e)}function gS(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&nc(e,t)}function nc(e,t){return nc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},nc(e,t)}function or(e){"@babel/helpers - typeof";return or=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},or(e)}function Ci(){"use strict";Ci=function(){return t};var e,t={},i=Object.prototype,r=i.hasOwnProperty,s=Object.defineProperty||function(f,d,_){f[d]=_.value},n=typeof Symbol=="function"?Symbol:{},o=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",h=n.toStringTag||"@@toStringTag";function l(f,d,_){return Object.defineProperty(f,d,{value:_,enumerable:!0,configurable:!0,writable:!0}),f[d]}try{l({},"")}catch{l=function(_,y,A){return _[y]=A}}function c(f,d,_,y){var A=d&&d.prototype instanceof E?d:E,S=Object.create(A.prototype),F=new w(y||[]);return s(S,"_invoke",{value:V(f,_,F)}),S}function u(f,d,_){try{return{type:"normal",arg:f.call(d,_)}}catch(y){return{type:"throw",arg:y}}}t.wrap=c;var p="suspendedStart",g="suspendedYield",v="executing",m="completed",x={};function E(){}function R(){}function D(){}var b={};l(b,o,function(){return this});var L=Object.getPrototypeOf,I=L&&L(L(k([])));I&&I!==i&&r.call(I,o)&&(b=I);var T=D.prototype=E.prototype=Object.create(b);function q(f){["next","throw","return"].forEach(function(d){l(f,d,function(_){return this._invoke(d,_)})})}function $(f,d){function _(A,S,F,U){var W=u(f[A],f,S);if(W.type!=="throw"){var z=W.arg,J=z.value;return J&&or(J)=="object"&&r.call(J,"__await")?d.resolve(J.__await).then(function(ee){_("next",ee,F,U)},function(ee){_("throw",ee,F,U)}):d.resolve(J).then(function(ee){z.value=ee,F(z)},function(ee){return _("throw",ee,F,U)})}U(W.arg)}var y;s(this,"_invoke",{value:function(S,F){function U(){return new d(function(W,z){_(S,F,W,z)})}return y=y?y.then(U,U):U()}})}function V(f,d,_){var y=p;return function(A,S){if(y===v)throw Error("Generator is already running");if(y===m){if(A==="throw")throw S;return{value:e,done:!0}}for(_.method=A,_.arg=S;;){var F=_.delegate;if(F){var U=j(F,_);if(U){if(U===x)continue;return U}}if(_.method==="next")_.sent=_._sent=_.arg;else if(_.method==="throw"){if(y===p)throw y=m,_.arg;_.dispatchException(_.arg)}else _.method==="return"&&_.abrupt("return",_.arg);y=v;var W=u(f,d,_);if(W.type==="normal"){if(y=_.done?m:g,W.arg===x)continue;return{value:W.arg,done:_.done}}W.type==="throw"&&(y=m,_.method="throw",_.arg=W.arg)}}}function j(f,d){var _=d.method,y=f.iterator[_];if(y===e)return d.delegate=null,_==="throw"&&f.iterator.return&&(d.method="return",d.arg=e,j(f,d),d.method==="throw")||_!=="return"&&(d.method="throw",d.arg=new TypeError("The iterator does not provide a '"+_+"' method")),x;var A=u(y,f.iterator,d.arg);if(A.type==="throw")return d.method="throw",d.arg=A.arg,d.delegate=null,x;var S=A.arg;return S?S.done?(d[f.resultName]=S.value,d.next=f.nextLoc,d.method!=="return"&&(d.method="next",d.arg=e),d.delegate=null,x):S:(d.method="throw",d.arg=new TypeError("iterator result is not an object"),d.delegate=null,x)}function ne(f){var d={tryLoc:f[0]};1 in f&&(d.catchLoc=f[1]),2 in f&&(d.finallyLoc=f[2],d.afterLoc=f[3]),this.tryEntries.push(d)}function C(f){var d=f.completion||{};d.type="normal",delete d.arg,f.completion=d}function w(f){this.tryEntries=[{tryLoc:"root"}],f.forEach(ne,this),this.reset(!0)}function k(f){if(f||f===""){var d=f[o];if(d)return d.call(f);if(typeof f.next=="function")return f;if(!isNaN(f.length)){var _=-1,y=function A(){for(;++_<f.length;)if(r.call(f,_))return A.value=f[_],A.done=!1,A;return A.value=e,A.done=!0,A};return y.next=y}}throw new TypeError(or(f)+" is not iterable")}return R.prototype=D,s(T,"constructor",{value:D,configurable:!0}),s(D,"constructor",{value:R,configurable:!0}),R.displayName=l(D,h,"GeneratorFunction"),t.isGeneratorFunction=function(f){var d=typeof f=="function"&&f.constructor;return!!d&&(d===R||(d.displayName||d.name)==="GeneratorFunction")},t.mark=function(f){return Object.setPrototypeOf?Object.setPrototypeOf(f,D):(f.__proto__=D,l(f,h,"GeneratorFunction")),f.prototype=Object.create(T),f},t.awrap=function(f){return{__await:f}},q($.prototype),l($.prototype,a,function(){return this}),t.AsyncIterator=$,t.async=function(f,d,_,y,A){A===void 0&&(A=Promise);var S=new $(c(f,d,_,y),A);return t.isGeneratorFunction(d)?S:S.next().then(function(F){return F.done?F.value:S.next()})},q(T),l(T,h,"Generator"),l(T,o,function(){return this}),l(T,"toString",function(){return"[object Generator]"}),t.keys=function(f){var d=Object(f),_=[];for(var y in d)_.push(y);return _.reverse(),function A(){for(;_.length;){var S=_.pop();if(S in d)return A.value=S,A.done=!1,A}return A.done=!0,A}},t.values=k,w.prototype={constructor:w,reset:function(d){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!d)for(var _ in this)_.charAt(0)==="t"&&r.call(this,_)&&!isNaN(+_.slice(1))&&(this[_]=e)},stop:function(){this.done=!0;var d=this.tryEntries[0].completion;if(d.type==="throw")throw d.arg;return this.rval},dispatchException:function(d){if(this.done)throw d;var _=this;function y(z,J){return F.type="throw",F.arg=d,_.next=z,J&&(_.method="next",_.arg=e),!!J}for(var A=this.tryEntries.length-1;A>=0;--A){var S=this.tryEntries[A],F=S.completion;if(S.tryLoc==="root")return y("end");if(S.tryLoc<=this.prev){var U=r.call(S,"catchLoc"),W=r.call(S,"finallyLoc");if(U&&W){if(this.prev<S.catchLoc)return y(S.catchLoc,!0);if(this.prev<S.finallyLoc)return y(S.finallyLoc)}else if(U){if(this.prev<S.catchLoc)return y(S.catchLoc,!0)}else{if(!W)throw Error("try statement without catch or finally");if(this.prev<S.finallyLoc)return y(S.finallyLoc)}}}},abrupt:function(d,_){for(var y=this.tryEntries.length-1;y>=0;--y){var A=this.tryEntries[y];if(A.tryLoc<=this.prev&&r.call(A,"finallyLoc")&&this.prev<A.finallyLoc){var S=A;break}}S&&(d==="break"||d==="continue")&&S.tryLoc<=_&&_<=S.finallyLoc&&(S=null);var F=S?S.completion:{};return F.type=d,F.arg=_,S?(this.method="next",this.next=S.finallyLoc,x):this.complete(F)},complete:function(d,_){if(d.type==="throw")throw d.arg;return d.type==="break"||d.type==="continue"?this.next=d.arg:d.type==="return"?(this.rval=this.arg=d.arg,this.method="return",this.next="end"):d.type==="normal"&&_&&(this.next=_),x},finish:function(d){for(var _=this.tryEntries.length-1;_>=0;--_){var y=this.tryEntries[_];if(y.finallyLoc===d)return this.complete(y.completion,y.afterLoc),C(y),x}},catch:function(d){for(var _=this.tryEntries.length-1;_>=0;--_){var y=this.tryEntries[_];if(y.tryLoc===d){var A=y.completion;if(A.type==="throw"){var S=A.arg;C(y)}return S}}throw Error("illegal catch attempt")},delegateYield:function(d,_,y){return this.delegate={iterator:k(d),resultName:_,nextLoc:y},this.method==="next"&&(this.arg=e),x}},t}function gg(e,t,i,r,s,n,o){try{var a=e[n](o),h=a.value}catch(l){return void i(l)}a.done?t(h):Promise.resolve(h).then(r,s)}function Vo(e){return function(){var t=this,i=arguments;return new Promise(function(r,s){var n=e.apply(t,i);function o(h){gg(n,r,s,o,a,"next",h)}function a(h){gg(n,r,s,o,a,"throw",h)}o(void 0)})}}function bg(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function pg(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,pS(r.key),r)}}function wg(e,t,i){return t&&pg(e.prototype,t),i&&pg(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function pS(e){var t=vS(e,"string");return or(t)=="symbol"?t:t+""}function vS(e,t){if(or(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(or(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var vg=function(){function e(){bg(this,e),this._cipher=null,this._counter=new Uint8Array(16)}return wg(e,[{key:"setKey",value:function(){var t=Vo(Ci().mark(function r(s){return Ci().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,nr.default.importKey("raw",s,{name:"AES-EAX"},!1,["encrypt, decrypt"]);case 2:this._cipher=o.sent;case 3:case"end":return o.stop()}},r,this)}));function i(r){return t.apply(this,arguments)}return i}()},{key:"makeMessage",value:function(){var t=Vo(Ci().mark(function r(s){var n,o,a,h;return Ci().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return n=new Uint8Array([(s.length&65280)>>>8,s.length&255]),c.next=3,nr.default.encrypt({name:"AES-EAX",iv:this._counter,additionalData:n},this._cipher,s);case 3:for(o=c.sent,a=0;a<16&&this._counter[a]++===255;a++);return h=new Uint8Array(s.length+2+16),h.set(n),h.set(o,2),c.abrupt("return",h);case 9:case"end":return c.stop()}},r,this)}));function i(r){return t.apply(this,arguments)}return i}()},{key:"receiveMessage",value:function(){var t=Vo(Ci().mark(function r(s,n){var o,a,h;return Ci().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=new Uint8Array([(s&65280)>>>8,s&255]),c.next=3,nr.default.decrypt({name:"AES-EAX",iv:this._counter,additionalData:o},this._cipher,n);case 3:for(a=c.sent,h=0;h<16&&this._counter[h]++===255;h++);return c.abrupt("return",a);case 6:case"end":return c.stop()}},r,this)}));function i(r,s){return t.apply(this,arguments)}return i}()}])}(),V4=Jo.default=function(e){function t(i,r){var s;return bg(this,t),s=dS(this,t),s._hasStarted=!1,s._checkSock=null,s._checkCredentials=null,s._approveServerResolve=null,s._sockReject=null,s._credentialsReject=null,s._approveServerReject=null,s._sock=i,s._getCredentials=r,s}return gS(t,e),wg(t,[{key:"_waitSockAsync",value:function(r){var s=this;return new Promise(function(n,o){var a=function(){return!s._sock.rQwait("RA2",r)};a()?n():(s._checkSock=function(){a()&&(n(),s._checkSock=null,s._sockReject=null)},s._sockReject=o)})}},{key:"_waitApproveKeyAsync",value:function(){var r=this;return new Promise(function(s,n){r._approveServerResolve=s,r._approveServerReject=n})}},{key:"_waitCredentialsAsync",value:function(r){var s=this,n=function(){return r===1&&s._getCredentials().username!==void 0&&s._getCredentials().password!==void 0?!0:r===2&&s._getCredentials().password!==void 0};return new Promise(function(o,a){n()?o():(s._checkCredentials=function(){n()&&(o(),s._checkCredentials=null,s._credentialsReject=null)},s._credentialsReject=a)})}},{key:"checkInternalEvents",value:function(){this._checkSock!==null&&this._checkSock(),this._checkCredentials!==null&&this._checkCredentials()}},{key:"approveServer",value:function(){this._approveServerResolve!==null&&(this._approveServerResolve(),this._approveServerResolve=null)}},{key:"disconnect",value:function(){this._sockReject!==null&&(this._sockReject(new Error("disconnect normally")),this._sockReject=null),this._credentialsReject!==null&&(this._credentialsReject(new Error("disconnect normally")),this._credentialsReject=null),this._approveServerReject!==null&&(this._approveServerReject(new Error("disconnect normally")),this._approveServerReject=null)}},{key:"negotiateRA2neAuthAsync",value:function(){var i=Vo(Ci().mark(function s(){var n,o,a,h,l,c,u,p,g,v,m,x,E,R,D,b,L,I,T,q,$,V,j,ne,C,w,k,f,d,_,y,A,S,F,U;return Ci().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return this._hasStarted=!0,z.next=3,this._waitSockAsync(4);case 3:if(n=this._sock.rQpeekBytes(4),o=this._sock.rQshift32(),!(o<1024)){z.next=9;break}throw new Error("RA2: server public key is too short: "+o);case 9:if(!(o>8192)){z.next=11;break}throw new Error("RA2: server public key is too long: "+o);case 11:return a=Math.ceil(o/8),z.next=14,this._waitSockAsync(a*2);case 14:return h=this._sock.rQshiftBytes(a),l=this._sock.rQshiftBytes(a),z.next=18,nr.default.importKey("raw",{n:h,e:l},{name:"RSA-PKCS1-v1_5"},!1,["encrypt"]);case 18:return c=z.sent,u=new Uint8Array(4+a*2),u.set(n),u.set(h,4),u.set(l,4+a),p=this._waitApproveKeyAsync(),this.dispatchEvent(new CustomEvent("serververification",{detail:{type:"RSA",publickey:u}})),z.next=27,p;case 27:return g=2048,v=Math.ceil(g/8),z.next=31,nr.default.generateKey({name:"RSA-PKCS1-v1_5",modulusLength:g,publicExponent:new Uint8Array([1,0,1])},!0,["encrypt"]);case 31:return m=z.sent.privateKey,z.next=34,nr.default.exportKey("raw",m);case 34:return x=z.sent,E=x.n,R=x.e,D=new Uint8Array(4+v*2),D[0]=(g&4278190080)>>>24,D[1]=(g&16711680)>>>16,D[2]=(g&65280)>>>8,D[3]=g&255,D.set(E,4),D.set(R,4+v),this._sock.sQpushBytes(D),this._sock.flush(),b=new Uint8Array(16),window.crypto.getRandomValues(b),z.next=50,nr.default.encrypt({name:"RSA-PKCS1-v1_5"},c,b);case 50:return L=z.sent,I=new Uint8Array(2+a),I[0]=(a&65280)>>>8,I[1]=a&255,I.set(L,2),this._sock.sQpushBytes(I),this._sock.flush(),z.next=59,this._waitSockAsync(2);case 59:if(this._sock.rQshift16()===v){z.next=61;break}throw new Error("RA2: wrong encrypted message length");case 61:return T=this._sock.rQshiftBytes(v),z.next=64,nr.default.decrypt({name:"RSA-PKCS1-v1_5"},m,T);case 64:if(q=z.sent,!(q===null||q.length!==16)){z.next=67;break}throw new Error("RA2: corrupted server encrypted random");case 67:return $=new Uint8Array(32),V=new Uint8Array(32),$.set(q),$.set(b,16),V.set(b),V.set(q,16),z.next=75,window.crypto.subtle.digest("SHA-1",$);case 75:return $=z.sent,$=new Uint8Array($).slice(0,16),z.next=79,window.crypto.subtle.digest("SHA-1",V);case 79:return V=z.sent,V=new Uint8Array(V).slice(0,16),j=new vg,z.next=84,j.setKey($);case 84:return ne=new vg,z.next=87,ne.setKey(V);case 87:return C=new Uint8Array(8+a*2+v*2),w=new Uint8Array(8+a*2+v*2),C.set(u),C.set(D,4+a*2),w.set(D),w.set(u,4+v*2),z.next=95,window.crypto.subtle.digest("SHA-1",C);case 95:return C=z.sent,z.next=98,window.crypto.subtle.digest("SHA-1",w);case 98:return w=z.sent,C=new Uint8Array(C),w=new Uint8Array(w),z.t0=this._sock,z.next=104,j.makeMessage(w);case 104:return z.t1=z.sent,z.t0.sQpushBytes.call(z.t0,z.t1),this._sock.flush(),z.next=109,this._waitSockAsync(38);case 109:if(this._sock.rQshift16()===20){z.next=111;break}throw new Error("RA2: wrong server hash");case 111:return z.next=113,ne.receiveMessage(20,this._sock.rQshiftBytes(36));case 113:if(k=z.sent,k!==null){z.next=116;break}throw new Error("RA2: failed to authenticate the message");case 116:f=0;case 117:if(!(f<20)){z.next=123;break}if(k[f]===C[f]){z.next=120;break}throw new Error("RA2: wrong server hash");case 120:f++,z.next=117;break;case 123:return z.next=125,this._waitSockAsync(19);case 125:if(this._sock.rQshift16()===1){z.next=127;break}throw new Error("RA2: wrong subtype");case 127:return z.next=129,ne.receiveMessage(1,this._sock.rQshiftBytes(17));case 129:if(d=z.sent,d!==null){z.next=132;break}throw new Error("RA2: failed to authenticate the message");case 132:if(d=d[0],_=this._waitCredentialsAsync(d),d!==1){z.next=138;break}(this._getCredentials().username===void 0||this._getCredentials().password===void 0)&&this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["username","password"]}})),z.next=143;break;case 138:if(d!==2){z.next=142;break}this._getCredentials().password===void 0&&this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["password"]}})),z.next=143;break;case 142:throw new Error("RA2: wrong subtype");case 143:return z.next=145,_;case 145:for(d===1?y=(0,_g.encodeUTF8)(this._getCredentials().username).slice(0,255):y="",A=(0,_g.encodeUTF8)(this._getCredentials().password).slice(0,255),S=new Uint8Array(y.length+A.length+2),S[0]=y.length,S[y.length+1]=A.length,F=0;F<y.length;F++)S[F+1]=y.charCodeAt(F);for(U=0;U<A.length;U++)S[y.length+2+U]=A.charCodeAt(U);return z.t2=this._sock,z.next=155,j.makeMessage(S);case 155:z.t3=z.sent,z.t2.sQpushBytes.call(z.t2,z.t3),this._sock.flush();case 158:case"end":return z.stop()}},s,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"hasStarted",get:function(){return this._hasStarted},set:function(r){this._hasStarted=r}}])}(uS.default)});var Sg=ie(Zo=>{"use strict";Object.defineProperty(Zo,"__esModule",{value:!0});Zo.default=void 0;function un(e){"@babel/helpers - typeof";return un=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},un(e)}function mS(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xg(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,bS(r.key),r)}}function yS(e,t,i){return t&&xg(e.prototype,t),i&&xg(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function bS(e){var t=wS(e,"string");return un(t)=="symbol"?t:t+""}function wS(e,t){if(un(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(un(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var J4=Zo.default=function(){function e(){mS(this,e),this._lines=0}return yS(e,[{key:"decodeRect",value:function(i,r,s,n,o,a,h){if(s===0||n===0)return!0;this._lines===0&&(this._lines=n);for(var l=h==8?1:4,c=s*l;this._lines>0;){if(o.rQwait("RAW",c))return!1;var u=r+(n-this._lines),p=o.rQshiftBytes(c,!1);if(h==8){for(var g=new Uint8Array(s*4),v=0;v<s;v++)g[v*4+0]=(p[v]>>0&3)*255/3,g[v*4+1]=(p[v]>>2&3)*255/3,g[v*4+2]=(p[v]>>4&3)*255/3,g[v*4+3]=255;p=g}for(var m=0;m<s;m++)p[m*4+3]=255;a.blitImage(i,u,s,1,p,0),this._lines--}return!0}}])}()});var kg=ie(ea=>{"use strict";Object.defineProperty(ea,"__esModule",{value:!0});ea.default=void 0;function dn(e){"@babel/helpers - typeof";return dn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dn(e)}function AS(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Cg(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,SS(r.key),r)}}function xS(e,t,i){return t&&Cg(e.prototype,t),i&&Cg(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function SS(e){var t=CS(e,"string");return dn(t)=="symbol"?t:t+""}function CS(e,t){if(dn(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(dn(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var eD=ea.default=function(){function e(){AS(this,e)}return xS(e,[{key:"decodeRect",value:function(i,r,s,n,o,a,h){if(o.rQwait("COPYRECT",4))return!1;var l=o.rQshift16(),c=o.rQshift16();return s===0||n===0||a.copyImage(l,c,i,r,s,n),!0}}])}()});var Bg=ie(ta=>{"use strict";Object.defineProperty(ta,"__esModule",{value:!0});ta.default=void 0;function fn(e){"@babel/helpers - typeof";return fn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fn(e)}function kS(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Eg(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,BS(r.key),r)}}function ES(e,t,i){return t&&Eg(e.prototype,t),i&&Eg(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function BS(e){var t=LS(e,"string");return fn(t)=="symbol"?t:t+""}function LS(e,t){if(fn(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(fn(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var iD=ta.default=function(){function e(){kS(this,e),this._subrects=0}return ES(e,[{key:"decodeRect",value:function(i,r,s,n,o,a,h){if(this._subrects===0){if(o.rQwait("RRE",8))return!1;this._subrects=o.rQshift32();var l=o.rQshiftBytes(4);a.fillRect(i,r,s,n,l)}for(;this._subrects>0;){if(o.rQwait("RRE",12))return!1;var c=o.rQshiftBytes(4),u=o.rQshift16(),p=o.rQshift16(),g=o.rQshift16(),v=o.rQshift16();a.fillRect(i+u,r+p,g,v,c),this._subrects--}return!0}}])}()});var Ig=ie(ia=>{"use strict";Object.defineProperty(ia,"__esModule",{value:!0});ia.default=void 0;var DS=IS(wi());function Dg(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(Dg=function(s){return s?i:t})(e)}function IS(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||cs(e)!="object"&&typeof e!="function")return{default:e};var i=Dg(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&{}.hasOwnProperty.call(e,n)){var o=s?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}function cs(e){"@babel/helpers - typeof";return cs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cs(e)}function MS(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Lg(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,RS(r.key),r)}}function TS(e,t,i){return t&&Lg(e.prototype,t),i&&Lg(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function RS(e){var t=FS(e,"string");return cs(t)=="symbol"?t:t+""}function FS(e,t){if(cs(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(cs(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var sD=ia.default=function(){function e(){MS(this,e),this._tiles=0,this._lastsubencoding=0,this._tileBuffer=new Uint8Array(16*16*4)}return TS(e,[{key:"decodeRect",value:function(i,r,s,n,o,a,h){for(this._tiles===0&&(this._tilesX=Math.ceil(s/16),this._tilesY=Math.ceil(n/16),this._totalTiles=this._tilesX*this._tilesY,this._tiles=this._totalTiles);this._tiles>0;){var l=1;if(o.rQwait("HEXTILE",l))return!1;var c=o.rQpeek8();if(c>30)throw new Error("Illegal hextile subencoding (subencoding: "+c+")");var u=this._totalTiles-this._tiles,p=u%this._tilesX,g=Math.floor(u/this._tilesX),v=i+p*16,m=r+g*16,x=Math.min(16,i+s-v),E=Math.min(16,r+n-m);if(c&1)l+=x*E*4;else if(c&2&&(l+=4),c&4&&(l+=4),c&8){if(l++,o.rQwait("HEXTILE",l))return!1;var R=o.rQpeekBytes(l).at(-1);c&16?l+=R*6:l+=R*2}if(o.rQwait("HEXTILE",l))return!1;if(o.rQshift8(),c===0)this._lastsubencoding&1?DS.Debug("     Ignoring blank after RAW"):a.fillRect(v,m,x,E,this._background);else if(c&1){for(var D=x*E,b=o.rQshiftBytes(D*4,!1),L=0;L<D;L++)b[L*4+3]=255;a.blitImage(v,m,x,E,b,0)}else{if(c&2&&(this._background=new Uint8Array(o.rQshiftBytes(4))),c&4&&(this._foreground=new Uint8Array(o.rQshiftBytes(4))),this._startTile(v,m,x,E,this._background),c&8)for(var I=o.rQshift8(),T=0;T<I;T++){var q=void 0;c&16?q=o.rQshiftBytes(4):q=this._foreground;var $=o.rQshift8(),V=$>>4,j=$&15,ne=o.rQshift8(),C=(ne>>4)+1,w=(ne&15)+1;this._subTile(V,j,C,w,q)}this._finishTile(a)}this._lastsubencoding=c,this._tiles--}return!0}},{key:"_startTile",value:function(i,r,s,n,o){this._tileX=i,this._tileY=r,this._tileW=s,this._tileH=n;for(var a=o[0],h=o[1],l=o[2],c=this._tileBuffer,u=0;u<s*n*4;u+=4)c[u]=a,c[u+1]=h,c[u+2]=l,c[u+3]=255}},{key:"_subTile",value:function(i,r,s,n,o){for(var a=o[0],h=o[1],l=o[2],c=i+s,u=r+n,p=this._tileBuffer,g=this._tileW,v=r;v<u;v++)for(var m=i;m<c;m++){var x=(m+v*g)*4;p[x]=a,p[x+1]=h,p[x+2]=l,p[x+3]=255}}},{key:"_finishTile",value:function(i){i.blitImage(this._tileX,this._tileY,this._tileW,this._tileH,this._tileBuffer,0)}}])}()});var oc=ie(ra=>{"use strict";Object.defineProperty(ra,"__esModule",{value:!0});ra.default=void 0;var PS=NS(wi()),OS=KS(bo());function KS(e){return e&&e.__esModule?e:{default:e}}function Tg(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(Tg=function(s){return s?i:t})(e)}function NS(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||us(e)!="object"&&typeof e!="function")return{default:e};var i=Tg(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&{}.hasOwnProperty.call(e,n)){var o=s?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}function us(e){"@babel/helpers - typeof";return us=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},us(e)}function QS(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Mg(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,XS(r.key),r)}}function HS(e,t,i){return t&&Mg(e.prototype,t),i&&Mg(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function XS(e){var t=US(e,"string");return us(t)=="symbol"?t:t+""}function US(e,t){if(us(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(us(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var oD=ra.default=function(){function e(){QS(this,e),this._ctl=null,this._filter=null,this._numColors=0,this._palette=new Uint8Array(1024),this._len=0,this._zlibs=[];for(var t=0;t<4;t++)this._zlibs[t]=new OS.default}return HS(e,[{key:"decodeRect",value:function(i,r,s,n,o,a,h){if(this._ctl===null){if(o.rQwait("TIGHT compression-control",1))return!1;this._ctl=o.rQshift8();for(var l=0;l<4;l++)this._ctl>>l&1&&(this._zlibs[l].reset(),PS.Info("Reset zlib stream "+l));this._ctl=this._ctl>>4}var c;if(this._ctl===8)c=this._fillRect(i,r,s,n,o,a,h);else if(this._ctl===9)c=this._jpegRect(i,r,s,n,o,a,h);else if(this._ctl===10)c=this._pngRect(i,r,s,n,o,a,h);else if((this._ctl&8)==0)c=this._basicRect(this._ctl,i,r,s,n,o,a,h);else throw new Error("Illegal tight compression received (ctl: "+this._ctl+")");return c&&(this._ctl=null),c}},{key:"_fillRect",value:function(i,r,s,n,o,a,h){if(o.rQwait("TIGHT",3))return!1;var l=o.rQshiftBytes(3);return a.fillRect(i,r,s,n,l,!1),!0}},{key:"_jpegRect",value:function(i,r,s,n,o,a,h){var l=this._readData(o);return l===null?!1:(a.imageRect(i,r,s,n,"image/jpeg",l),!0)}},{key:"_pngRect",value:function(i,r,s,n,o,a,h){throw new Error("PNG received in standard Tight rect")}},{key:"_basicRect",value:function(i,r,s,n,o,a,h,l){if(this._filter===null)if(i&4){if(a.rQwait("TIGHT",1))return!1;this._filter=a.rQshift8()}else this._filter=0;var c=i&3,u;switch(this._filter){case 0:u=this._copyFilter(c,r,s,n,o,a,h,l);break;case 1:u=this._paletteFilter(c,r,s,n,o,a,h,l);break;case 2:u=this._gradientFilter(c,r,s,n,o,a,h,l);break;default:throw new Error("Illegal tight filter received (ctl: "+this._filter+")")}return u&&(this._filter=null),u}},{key:"_copyFilter",value:function(i,r,s,n,o,a,h,l){var c=n*o*3,u;if(c===0)return!0;if(c<12){if(a.rQwait("TIGHT",c))return!1;u=a.rQshiftBytes(c)}else{if(u=this._readData(a),u===null)return!1;this._zlibs[i].setInput(u),u=this._zlibs[i].inflate(c),this._zlibs[i].setInput(null)}for(var p=new Uint8Array(n*o*4),g=0,v=0;g<n*o*4;g+=4,v+=3)p[g]=u[v],p[g+1]=u[v+1],p[g+2]=u[v+2],p[g+3]=255;return h.blitImage(r,s,n,o,p,0,!1),!0}},{key:"_paletteFilter",value:function(i,r,s,n,o,a,h,l){if(this._numColors===0){if(a.rQwait("TIGHT palette",1))return!1;var c=a.rQpeek8()+1,u=c*3;if(a.rQwait("TIGHT palette",1+u))return!1;this._numColors=c,a.rQskipBytes(1),a.rQshiftTo(this._palette,u)}var p=this._numColors<=2?1:8,g=Math.floor((n*p+7)/8),v=g*o,m;if(v===0)return!0;if(v<12){if(a.rQwait("TIGHT",v))return!1;m=a.rQshiftBytes(v)}else{if(m=this._readData(a),m===null)return!1;this._zlibs[i].setInput(m),m=this._zlibs[i].inflate(v),this._zlibs[i].setInput(null)}return this._numColors==2?this._monoRect(r,s,n,o,m,this._palette,h):this._paletteRect(r,s,n,o,m,this._palette,h),this._numColors=0,!0}},{key:"_monoRect",value:function(i,r,s,n,o,a,h){for(var l=this._getScratchBuffer(s*n*4),c=Math.floor((s+7)/8),u=Math.floor(s/8),p=0;p<n;p++){var g=void 0,v=void 0,m=void 0;for(m=0;m<u;m++)for(var x=7;x>=0;x--)g=(p*s+m*8+7-x)*4,v=(o[p*c+m]>>x&1)*3,l[g]=a[v],l[g+1]=a[v+1],l[g+2]=a[v+2],l[g+3]=255;for(var E=7;E>=8-s%8;E--)g=(p*s+m*8+7-E)*4,v=(o[p*c+m]>>E&1)*3,l[g]=a[v],l[g+1]=a[v+1],l[g+2]=a[v+2],l[g+3]=255}h.blitImage(i,r,s,n,l,0,!1)}},{key:"_paletteRect",value:function(i,r,s,n,o,a,h){for(var l=this._getScratchBuffer(s*n*4),c=s*n*4,u=0,p=0;u<c;u+=4,p++){var g=o[p]*3;l[u]=a[g],l[u+1]=a[g+1],l[u+2]=a[g+2],l[u+3]=255}h.blitImage(i,r,s,n,l,0,!1)}},{key:"_gradientFilter",value:function(i,r,s,n,o,a,h,l){var c=n*o*3,u;if(c===0)return!0;if(c<12){if(a.rQwait("TIGHT",c))return!1;u=a.rQshiftBytes(c)}else{if(u=this._readData(a),u===null)return!1;this._zlibs[i].setInput(u),u=this._zlibs[i].inflate(c),this._zlibs[i].setInput(null)}for(var p=new Uint8Array(4*n*o),g=0,v=0,m=new Uint8Array(3),x=0;x<n;x++){for(var E=0;E<3;E++){var R=m[E],D=u[v++]+R;p[g++]=D,m[E]=D}p[g++]=255}for(var b=0,L=new Uint8Array(3),I=new Uint8Array(3),T=1;T<o;T++){m.fill(0),I.fill(0);for(var q=0;q<n;q++){for(var $=0;$<3;$++){L[$]=p[b++];var V=m[$]+L[$]-I[$];V<0?V=0:V>255&&(V=255);var j=u[v++]+V;p[g++]=j,I[$]=L[$],m[$]=j}p[g++]=255,b++}}return h.blitImage(r,s,n,o,p,0,!1),!0}},{key:"_readData",value:function(i){if(this._len===0){if(i.rQwait("TIGHT",3))return null;var r;r=i.rQshift8(),this._len=r&127,r&128&&(r=i.rQshift8(),this._len|=(r&127)<<7,r&128&&(r=i.rQshift8(),this._len|=r<<14))}if(i.rQwait("TIGHT",this._len))return null;var s=i.rQshiftBytes(this._len,!1);return this._len=0,s}},{key:"_getScratchBuffer",value:function(i){return(!this._scratchBuffer||this._scratchBuffer.length<i)&&(this._scratchBuffer=new Uint8Array(i)),this._scratchBuffer}}])}()});var Pg=ie(na=>{"use strict";function ds(e){"@babel/helpers - typeof";return ds=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ds(e)}Object.defineProperty(na,"__esModule",{value:!0});na.default=void 0;var zS=WS(oc());function WS(e){return e&&e.__esModule?e:{default:e}}function $S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Rg(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,jS(r.key),r)}}function GS(e,t,i){return t&&Rg(e.prototype,t),i&&Rg(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function jS(e){var t=qS(e,"string");return ds(t)=="symbol"?t:t+""}function qS(e,t){if(ds(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(ds(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function VS(e,t,i){return t=sa(t),YS(e,Fg()?Reflect.construct(t,i||[],sa(e).constructor):t.apply(e,i))}function YS(e,t){if(t&&(ds(t)=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return JS(e)}function JS(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Fg(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Fg=function(){return!!e})()}function sa(e){return sa=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},sa(e)}function ZS(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ac(e,t)}function ac(e,t){return ac=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},ac(e,t)}var lD=na.default=function(e){function t(){return $S(this,t),VS(this,t,arguments)}return ZS(t,e),GS(t,[{key:"_pngRect",value:function(r,s,n,o,a,h,l){var c=this._readData(a);return c===null?!1:(h.imageRect(r,s,n,o,"image/png",c),!0)}},{key:"_basicRect",value:function(r,s,n,o,a,h,l,c){throw new Error("BasicCompression received in TightPNG rect")}}])}(zS.default)});var Kg=ie(la=>{"use strict";Object.defineProperty(la,"__esModule",{value:!0});la.default=void 0;var eC=tC(bo());function tC(e){return e&&e.__esModule?e:{default:e}}function _n(e){"@babel/helpers - typeof";return _n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_n(e)}function iC(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Og(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,sC(r.key),r)}}function rC(e,t,i){return t&&Og(e.prototype,t),i&&Og(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function sC(e){var t=nC(e,"string");return _n(t)=="symbol"?t:t+""}function nC(e,t){if(_n(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(_n(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var oa=64,aa=64,cD=la.default=function(){function e(){iC(this,e),this._length=0,this._inflator=new eC.default,this._pixelBuffer=new Uint8Array(oa*aa*4),this._tileBuffer=new Uint8Array(oa*aa*4)}return rC(e,[{key:"decodeRect",value:function(i,r,s,n,o,a,h){if(this._length===0){if(o.rQwait("ZLib data length",4))return!1;this._length=o.rQshift32()}if(o.rQwait("Zlib data",this._length))return!1;var l=o.rQshiftBytes(this._length,!1);this._inflator.setInput(l);for(var c=r;c<r+n;c+=aa)for(var u=Math.min(aa,r+n-c),p=i;p<i+s;p+=oa){var g=Math.min(oa,i+s-p),v=g*u,m=this._inflator.inflate(1)[0];if(m===0){var x=this._readPixels(v);a.blitImage(p,c,g,u,x,0,!1)}else if(m===1){var E=this._readPixels(1);a.fillRect(p,c,g,u,[E[0],E[1],E[2]])}else if(m>=2&&m<=16){var R=this._decodePaletteTile(m,v,g,u);a.blitImage(p,c,g,u,R,0,!1)}else if(m===128){var D=this._decodeRLETile(v);a.blitImage(p,c,g,u,D,0,!1)}else if(m>=130&&m<=255){var b=this._decodeRLEPaletteTile(m-128,v);a.blitImage(p,c,g,u,b,0,!1)}else throw new Error("Unknown subencoding: "+m)}return this._length=0,!0}},{key:"_getBitsPerPixelInPalette",value:function(i){if(i<=2)return 1;if(i<=4)return 2;if(i<=16)return 4}},{key:"_readPixels",value:function(i){for(var r=this._pixelBuffer,s=this._inflator.inflate(3*i),n=0,o=0;n<i*4;n+=4,o+=3)r[n]=s[o],r[n+1]=s[o+1],r[n+2]=s[o+2],r[n+3]=255;return r}},{key:"_decodePaletteTile",value:function(i,r,s,n){for(var o=this._tileBuffer,a=this._readPixels(i),h=this._getBitsPerPixelInPalette(i),l=(1<<h)-1,c=0,u=this._inflator.inflate(1)[0],p=0;p<n;p++){for(var g=8-h,v=0;v<s;v++){g<0&&(g=8-h,u=this._inflator.inflate(1)[0]);var m=u>>g&l;o[c]=a[m*4],o[c+1]=a[m*4+1],o[c+2]=a[m*4+2],o[c+3]=a[m*4+3],c+=4,g-=h}g<8-h&&p<n-1&&(u=this._inflator.inflate(1)[0])}return o}},{key:"_decodeRLETile",value:function(i){for(var r=this._tileBuffer,s=0;s<i;)for(var n=this._readPixels(1),o=this._readRLELength(),a=0;a<o;a++)r[s*4]=n[0],r[s*4+1]=n[1],r[s*4+2]=n[2],r[s*4+3]=n[3],s++;return r}},{key:"_decodeRLEPaletteTile",value:function(i,r){for(var s=this._tileBuffer,n=this._readPixels(i),o=0;o<r;){var a=this._inflator.inflate(1)[0],h=1;if(a>=128&&(a-=128,h=this._readRLELength()),a>i)throw new Error("Too big index in palette: "+a+", palette size: "+i);if(o+h>r)throw new Error("Too big rle length in palette mode: "+h+", allowed length is: "+(r-o));for(var l=0;l<h;l++)s[o*4]=n[a*4],s[o*4+1]=n[a*4+1],s[o*4+2]=n[a*4+2],s[o*4+3]=n[a*4+3],o++}return s}},{key:"_readRLELength",value:function(){var i=0,r=0;do r=this._inflator.inflate(1)[0],i+=r;while(r===255);return i+1}}])}()});var Xg=ie(ha=>{"use strict";Object.defineProperty(ha,"__esModule",{value:!0});ha.default=void 0;function gn(e){"@babel/helpers - typeof";return gn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gn(e)}function Ng(e){return lC(e)||aC(e)||Hg(e)||oC()}function oC(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function aC(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function lC(e){if(Array.isArray(e))return hc(e)}function lc(e,t){var i=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=Hg(e))||t&&e&&typeof e.length=="number"){i&&(e=i);var r=0,s=function(){};return{s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(l){throw l},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var n,o=!0,a=!1;return{s:function(){i=i.call(e)},n:function(){var l=i.next();return o=l.done,l},e:function(l){a=!0,n=l},f:function(){try{o||i.return==null||i.return()}finally{if(a)throw n}}}}function Hg(e,t){if(e){if(typeof e=="string")return hc(e,t);var i={}.toString.call(e).slice(8,-1);return i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set"?Array.from(e):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?hc(e,t):void 0}}function hc(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,r=Array(t);i<t;i++)r[i]=e[i];return r}function hC(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Qg(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,uC(r.key),r)}}function cC(e,t,i){return t&&Qg(e.prototype,t),i&&Qg(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function uC(e){var t=dC(e,"string");return gn(t)=="symbol"?t:t+""}function dC(e,t){if(gn(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(gn(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var dD=ha.default=function(){function e(){hC(this,e),this._cachedQuantTables=[],this._cachedHuffmanTables=[],this._segments=[]}return cC(e,[{key:"decodeRect",value:function(i,r,s,n,o,a,h){for(;;){var l=this._readSegment(o);if(l===null)return!1;if(this._segments.push(l),l[1]===217)break}var c=[],u=[],p=lc(this._segments),g;try{for(p.s();!(g=p.n()).done;){var v=g.value,m=v[1];m===196?c.push(v):m===219&&u.push(v)}}catch(j){p.e(j)}finally{p.f()}var x=this._segments.findIndex(function(j){return j[1]==192||j[1]==194});if(x==-1)throw new Error("Illegal JPEG image without SOF");if(u.length===0){var E;(E=this._segments).splice.apply(E,[x+1,0].concat(Ng(this._cachedQuantTables)))}if(c.length===0){var R;(R=this._segments).splice.apply(R,[x+1,0].concat(Ng(this._cachedHuffmanTables)))}var D=0,b=lc(this._segments),L;try{for(b.s();!(L=b.n()).done;){var I=L.value;D+=I.length}}catch(j){b.e(j)}finally{b.f()}var T=new Uint8Array(D);D=0;var q=lc(this._segments),$;try{for(q.s();!($=q.n()).done;){var V=$.value;T.set(V,D),D+=V.length}}catch(j){q.e(j)}finally{q.f()}return a.imageRect(i,r,s,n,"image/jpeg",T),c.length!==0&&(this._cachedHuffmanTables=c),u.length!==0&&(this._cachedQuantTables=u),this._segments=[],!0}},{key:"_readSegment",value:function(i){if(i.rQwait("JPEG",2))return null;var r=i.rQshift8();if(r!=255)throw new Error("Illegal JPEG marker received (byte: "+r+")");var s=i.rQshift8();if(s>=208&&s<=217||s==1)return new Uint8Array([r,s]);if(i.rQwait("JPEG",2,2))return null;var n=i.rQshift16();if(n<2)throw new Error("Illegal JPEG length received (length: "+n+")");if(i.rQwait("JPEG",n-2,4))return null;var o=0;if(s===218)for(o+=2;;){if(i.rQwait("JPEG",n-2+o,4))return null;var a=i.rQpeekBytes(n-2+o,!1);if(a.at(-2)===255&&a.at(-1)!==0&&!(a.at(-1)>=208&&a.at(-1)<=215)){o-=2;break}o++}var h=new Uint8Array(2+n+o);return h[0]=r,h[1]=s,h[2]=n>>8,h[3]=n,h.set(i.rQshiftBytes(n-2+o,!1),4),h}}])}()});var cp=ie(_a=>{"use strict";function ki(e){"@babel/helpers - typeof";return ki=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ki(e)}Object.defineProperty(_a,"__esModule",{value:!0});_a.default=void 0;var op=ql(),te=MC(wi()),oi=Yl(),Ug=Ts(),pn=Cf(),fC=sh(),_C=Pe(nh()),gC=Pe(Rf()),pC=Pe(bo()),vC=Pe(c0()),mC=Pe(S0()),yC=Pe(B0()),bC=Pe(I0()),wC=Pe(P0()),Kt=Pe(ss()),AC=Pe(O0()),le=K0(),xC=Pe(Ag()),bt=Pe(sc()),SC=Pe(Sg()),CC=Pe(kg()),kC=Pe(Bg()),EC=Pe(Ig()),BC=Pe(oc()),LC=Pe(Pg()),DC=Pe(Kg()),IC=Pe(Xg());function Pe(e){return e&&e.__esModule?e:{default:e}}function ap(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(ap=function(s){return s?i:t})(e)}function MC(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||ki(e)!="object"&&typeof e!="function")return{default:e};var i=ap(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&{}.hasOwnProperty.call(e,n)){var o=s?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}function dc(){"use strict";dc=function(){return t};var e,t={},i=Object.prototype,r=i.hasOwnProperty,s=Object.defineProperty||function(f,d,_){f[d]=_.value},n=typeof Symbol=="function"?Symbol:{},o=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",h=n.toStringTag||"@@toStringTag";function l(f,d,_){return Object.defineProperty(f,d,{value:_,enumerable:!0,configurable:!0,writable:!0}),f[d]}try{l({},"")}catch{l=function(_,y,A){return _[y]=A}}function c(f,d,_,y){var A=d&&d.prototype instanceof E?d:E,S=Object.create(A.prototype),F=new w(y||[]);return s(S,"_invoke",{value:V(f,_,F)}),S}function u(f,d,_){try{return{type:"normal",arg:f.call(d,_)}}catch(y){return{type:"throw",arg:y}}}t.wrap=c;var p="suspendedStart",g="suspendedYield",v="executing",m="completed",x={};function E(){}function R(){}function D(){}var b={};l(b,o,function(){return this});var L=Object.getPrototypeOf,I=L&&L(L(k([])));I&&I!==i&&r.call(I,o)&&(b=I);var T=D.prototype=E.prototype=Object.create(b);function q(f){["next","throw","return"].forEach(function(d){l(f,d,function(_){return this._invoke(d,_)})})}function $(f,d){function _(A,S,F,U){var W=u(f[A],f,S);if(W.type!=="throw"){var z=W.arg,J=z.value;return J&&ki(J)=="object"&&r.call(J,"__await")?d.resolve(J.__await).then(function(ee){_("next",ee,F,U)},function(ee){_("throw",ee,F,U)}):d.resolve(J).then(function(ee){z.value=ee,F(z)},function(ee){return _("throw",ee,F,U)})}U(W.arg)}var y;s(this,"_invoke",{value:function(S,F){function U(){return new d(function(W,z){_(S,F,W,z)})}return y=y?y.then(U,U):U()}})}function V(f,d,_){var y=p;return function(A,S){if(y===v)throw Error("Generator is already running");if(y===m){if(A==="throw")throw S;return{value:e,done:!0}}for(_.method=A,_.arg=S;;){var F=_.delegate;if(F){var U=j(F,_);if(U){if(U===x)continue;return U}}if(_.method==="next")_.sent=_._sent=_.arg;else if(_.method==="throw"){if(y===p)throw y=m,_.arg;_.dispatchException(_.arg)}else _.method==="return"&&_.abrupt("return",_.arg);y=v;var W=u(f,d,_);if(W.type==="normal"){if(y=_.done?m:g,W.arg===x)continue;return{value:W.arg,done:_.done}}W.type==="throw"&&(y=m,_.method="throw",_.arg=W.arg)}}}function j(f,d){var _=d.method,y=f.iterator[_];if(y===e)return d.delegate=null,_==="throw"&&f.iterator.return&&(d.method="return",d.arg=e,j(f,d),d.method==="throw")||_!=="return"&&(d.method="throw",d.arg=new TypeError("The iterator does not provide a '"+_+"' method")),x;var A=u(y,f.iterator,d.arg);if(A.type==="throw")return d.method="throw",d.arg=A.arg,d.delegate=null,x;var S=A.arg;return S?S.done?(d[f.resultName]=S.value,d.next=f.nextLoc,d.method!=="return"&&(d.method="next",d.arg=e),d.delegate=null,x):S:(d.method="throw",d.arg=new TypeError("iterator result is not an object"),d.delegate=null,x)}function ne(f){var d={tryLoc:f[0]};1 in f&&(d.catchLoc=f[1]),2 in f&&(d.finallyLoc=f[2],d.afterLoc=f[3]),this.tryEntries.push(d)}function C(f){var d=f.completion||{};d.type="normal",delete d.arg,f.completion=d}function w(f){this.tryEntries=[{tryLoc:"root"}],f.forEach(ne,this),this.reset(!0)}function k(f){if(f||f===""){var d=f[o];if(d)return d.call(f);if(typeof f.next=="function")return f;if(!isNaN(f.length)){var _=-1,y=function A(){for(;++_<f.length;)if(r.call(f,_))return A.value=f[_],A.done=!1,A;return A.value=e,A.done=!0,A};return y.next=y}}throw new TypeError(ki(f)+" is not iterable")}return R.prototype=D,s(T,"constructor",{value:D,configurable:!0}),s(D,"constructor",{value:R,configurable:!0}),R.displayName=l(D,h,"GeneratorFunction"),t.isGeneratorFunction=function(f){var d=typeof f=="function"&&f.constructor;return!!d&&(d===R||(d.displayName||d.name)==="GeneratorFunction")},t.mark=function(f){return Object.setPrototypeOf?Object.setPrototypeOf(f,D):(f.__proto__=D,l(f,h,"GeneratorFunction")),f.prototype=Object.create(T),f},t.awrap=function(f){return{__await:f}},q($.prototype),l($.prototype,a,function(){return this}),t.AsyncIterator=$,t.async=function(f,d,_,y,A){A===void 0&&(A=Promise);var S=new $(c(f,d,_,y),A);return t.isGeneratorFunction(d)?S:S.next().then(function(F){return F.done?F.value:S.next()})},q(T),l(T,h,"Generator"),l(T,o,function(){return this}),l(T,"toString",function(){return"[object Generator]"}),t.keys=function(f){var d=Object(f),_=[];for(var y in d)_.push(y);return _.reverse(),function A(){for(;_.length;){var S=_.pop();if(S in d)return A.value=S,A.done=!1,A}return A.done=!0,A}},t.values=k,w.prototype={constructor:w,reset:function(d){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!d)for(var _ in this)_.charAt(0)==="t"&&r.call(this,_)&&!isNaN(+_.slice(1))&&(this[_]=e)},stop:function(){this.done=!0;var d=this.tryEntries[0].completion;if(d.type==="throw")throw d.arg;return this.rval},dispatchException:function(d){if(this.done)throw d;var _=this;function y(z,J){return F.type="throw",F.arg=d,_.next=z,J&&(_.method="next",_.arg=e),!!J}for(var A=this.tryEntries.length-1;A>=0;--A){var S=this.tryEntries[A],F=S.completion;if(S.tryLoc==="root")return y("end");if(S.tryLoc<=this.prev){var U=r.call(S,"catchLoc"),W=r.call(S,"finallyLoc");if(U&&W){if(this.prev<S.catchLoc)return y(S.catchLoc,!0);if(this.prev<S.finallyLoc)return y(S.finallyLoc)}else if(U){if(this.prev<S.catchLoc)return y(S.catchLoc,!0)}else{if(!W)throw Error("try statement without catch or finally");if(this.prev<S.finallyLoc)return y(S.finallyLoc)}}}},abrupt:function(d,_){for(var y=this.tryEntries.length-1;y>=0;--y){var A=this.tryEntries[y];if(A.tryLoc<=this.prev&&r.call(A,"finallyLoc")&&this.prev<A.finallyLoc){var S=A;break}}S&&(d==="break"||d==="continue")&&S.tryLoc<=_&&_<=S.finallyLoc&&(S=null);var F=S?S.completion:{};return F.type=d,F.arg=_,S?(this.method="next",this.next=S.finallyLoc,x):this.complete(F)},complete:function(d,_){if(d.type==="throw")throw d.arg;return d.type==="break"||d.type==="continue"?this.next=d.arg:d.type==="return"?(this.rval=this.arg=d.arg,this.method="return",this.next="end"):d.type==="normal"&&_&&(this.next=_),x},finish:function(d){for(var _=this.tryEntries.length-1;_>=0;--_){var y=this.tryEntries[_];if(y.finallyLoc===d)return this.complete(y.completion,y.afterLoc),C(y),x}},catch:function(d){for(var _=this.tryEntries.length-1;_>=0;--_){var y=this.tryEntries[_];if(y.tryLoc===d){var A=y.completion;if(A.type==="throw"){var S=A.arg;C(y)}return S}}throw Error("illegal catch attempt")},delegateYield:function(d,_,y){return this.delegate={iterator:k(d),resultName:_,nextLoc:y},this.method==="next"&&(this.arg=e),x}},t}function zg(e,t,i,r,s,n,o){try{var a=e[n](o),h=a.value}catch(l){return void i(l)}a.done?t(h):Promise.resolve(h).then(r,s)}function TC(e){return function(){var t=this,i=arguments;return new Promise(function(r,s){var n=e.apply(t,i);function o(h){zg(n,r,s,o,a,"next",h)}function a(h){zg(n,r,s,o,a,"throw",h)}o(void 0)})}}function RC(e,t){return OC(e)||PC(e,t)||lp(e,t)||FC()}function FC(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function PC(e,t){var i=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(i!=null){var r,s,n,o,a=[],h=!0,l=!1;try{if(n=(i=i.call(e)).next,t===0){if(Object(i)!==i)return;h=!1}else for(;!(h=(r=n.call(i)).done)&&(a.push(r.value),a.length!==t);h=!0);}catch(c){l=!0,s=c}finally{try{if(!h&&i.return!=null&&(o=i.return(),Object(o)!==o))return}finally{if(l)throw s}}return a}}function OC(e){if(Array.isArray(e))return e}function cc(e,t){var i=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=lp(e))||t&&e&&typeof e.length=="number"){i&&(e=i);var r=0,s=function(){};return{s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(l){throw l},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var n,o=!0,a=!1;return{s:function(){i=i.call(e)},n:function(){var l=i.next();return o=l.done,l},e:function(l){a=!0,n=l},f:function(){try{o||i.return==null||i.return()}finally{if(a)throw n}}}}function lp(e,t){if(e){if(typeof e=="string")return Wg(e,t);var i={}.toString.call(e).slice(8,-1);return i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set"?Array.from(e):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Wg(e,t):void 0}}function Wg(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,r=Array(t);i<t;i++)r[i]=e[i];return r}function KC(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $g(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,QC(r.key),r)}}function NC(e,t,i){return t&&$g(e.prototype,t),i&&$g(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function QC(e){var t=HC(e,"string");return ki(t)=="symbol"?t:t+""}function HC(e,t){if(ki(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(ki(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function XC(e,t,i){return t=fa(t),UC(e,hp()?Reflect.construct(t,i||[],fa(e).constructor):t.apply(e,i))}function UC(e,t){if(t&&(ki(t)=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return zC(e)}function zC(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function hp(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(hp=function(){return!!e})()}function fa(e){return fa=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},fa(e)}function WC(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&fc(e,t)}function fc(e,t){return fc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},fc(e,t)}var $C=3,GC="rgb(40, 40, 40)",Gg=17,jg=50,qg=19,vn=75,ar=50,jC=1e3,qC=50,Vg=1,ca=2,Yg=6,Jg=16,uc=19,Zg=22,ep=30,tp=113,ip=129,rp=256,ai=1,sp=1<<24,ua=1<<25,np=1<<26,mn=1<<27,da=1<<28,li=_a.default=function(e){function t(i,r,s){var n;if(KC(this,t),!i)throw new Error("Must specify target");if(!r)throw new Error("Must specify URL, WebSocket or RTCDataChannel");window.isSecureContext||te.Error("noVNC requires a secure context (TLS). Expect crashes!"),n=XC(this,t),n._target=i,typeof r=="string"?n._url=r:(n._url=null,n._rawChannel=r),s=s||{},n._rfbCredentials=s.credentials||{},n._shared="shared"in s?!!s.shared:!0,n._repeaterID=s.repeaterID||"",n._wsProtocols=s.wsProtocols||[],n._rfbConnectionState="",n._rfbInitState="",n._rfbAuthScheme=-1,n._rfbCleanDisconnect=!0,n._rfbRSAAESAuthenticationState=null,n._rfbVersion=0,n._rfbMaxVersion=3.8,n._rfbTightVNC=!1,n._rfbVeNCryptState=0,n._rfbXvpVer=0,n._fbWidth=0,n._fbHeight=0,n._fbName="",n._capabilities={power:!1},n._supportsFence=!1,n._supportsContinuousUpdates=!1,n._enabledContinuousUpdates=!1,n._supportsSetDesktopSize=!1,n._screenID=0,n._screenFlags=0,n._qemuExtKeyEventSupported=!1,n._clipboardText=null,n._clipboardServerCapabilitiesActions={},n._clipboardServerCapabilitiesFormats={},n._sock=null,n._display=null,n._flushing=!1,n._keyboard=null,n._gestures=null,n._resizeObserver=null,n._disconnTimer=null,n._resizeTimeout=null,n._mouseMoveTimer=null,n._decoders={},n._FBU={rects:0,x:0,y:0,width:0,height:0,encoding:null},n._mousePos={},n._mouseButtonMask=0,n._mouseLastMoveTime=0,n._viewportDragging=!1,n._viewportDragPos={},n._viewportHasMoved=!1,n._accumulatedWheelDeltaX=0,n._accumulatedWheelDeltaY=0,n._gestureLastTapTime=null,n._gestureFirstDoubleTapEv=null,n._gestureLastMagnitudeX=0,n._gestureLastMagnitudeY=0,n._eventHandlers={focusCanvas:n._focusCanvas.bind(n),handleResize:n._handleResize.bind(n),handleMouse:n._handleMouse.bind(n),handleWheel:n._handleWheel.bind(n),handleGesture:n._handleGesture.bind(n),handleRSAAESCredentialsRequired:n._handleRSAAESCredentialsRequired.bind(n),handleRSAAESServerVerification:n._handleRSAAESServerVerification.bind(n)},te.Debug(">> RFB.constructor"),n._screen=document.createElement("div"),n._screen.style.display="flex",n._screen.style.width="100%",n._screen.style.height="100%",n._screen.style.overflow="auto",n._screen.style.background=GC,n._canvas=document.createElement("canvas"),n._canvas.style.margin="auto",n._canvas.style.outline="none",n._canvas.width=0,n._canvas.height=0,n._canvas.tabIndex=-1,n._screen.appendChild(n._canvas),n._cursor=new bC.default,n._cursorImage=t.cursors.none,n._decoders[le.encodings.encodingRaw]=new SC.default,n._decoders[le.encodings.encodingCopyRect]=new CC.default,n._decoders[le.encodings.encodingRRE]=new kC.default,n._decoders[le.encodings.encodingHextile]=new EC.default,n._decoders[le.encodings.encodingTight]=new BC.default,n._decoders[le.encodings.encodingTightPNG]=new LC.default,n._decoders[le.encodings.encodingZRLE]=new DC.default,n._decoders[le.encodings.encodingJPEG]=new IC.default;try{n._display=new gC.default(n._canvas)}catch(o){throw te.Error("Display exception: "+o),o}return n._keyboard=new mC.default(n._canvas),n._keyboard.onkeyevent=n._handleKeyEvent.bind(n),n._remoteCapsLock=null,n._remoteNumLock=null,n._gestures=new yC.default,n._sock=new wC.default,n._sock.on("open",n._socketOpen.bind(n)),n._sock.on("close",n._socketClose.bind(n)),n._sock.on("message",n._handleMessage.bind(n)),n._sock.on("error",n._socketError.bind(n)),n._expectedClientWidth=null,n._expectedClientHeight=null,n._resizeObserver=new ResizeObserver(n._eventHandlers.handleResize),n._updateConnectionState("connecting"),te.Debug("<< RFB.constructor"),n.dragViewport=!1,n.focusOnClick=!0,n._viewOnly=!1,n._clipViewport=!1,n._clippingViewport=!1,n._scaleViewport=!1,n._resizeSession=!1,n._showDotCursor=!1,s.showDotCursor!==void 0&&(te.Warn("Specifying showDotCursor as a RFB constructor argument is deprecated"),n._showDotCursor=s.showDotCursor),n._qualityLevel=6,n._compressionLevel=2,n}return WC(t,e),NC(t,[{key:"viewOnly",get:function(){return this._viewOnly},set:function(r){this._viewOnly=r,(this._rfbConnectionState==="connecting"||this._rfbConnectionState==="connected")&&(r?this._keyboard.ungrab():this._keyboard.grab())}},{key:"capabilities",get:function(){return this._capabilities}},{key:"clippingViewport",get:function(){return this._clippingViewport}},{key:"_setClippingViewport",value:function(r){r!==this._clippingViewport&&(this._clippingViewport=r,this.dispatchEvent(new CustomEvent("clippingviewport",{detail:this._clippingViewport})))}},{key:"touchButton",get:function(){return 0},set:function(r){te.Warn("Using old API!")}},{key:"clipViewport",get:function(){return this._clipViewport},set:function(r){this._clipViewport=r,this._updateClip()}},{key:"scaleViewport",get:function(){return this._scaleViewport},set:function(r){this._scaleViewport=r,r&&this._clipViewport&&this._updateClip(),this._updateScale(),!r&&this._clipViewport&&this._updateClip()}},{key:"resizeSession",get:function(){return this._resizeSession},set:function(r){this._resizeSession=r,r&&this._requestRemoteResize()}},{key:"showDotCursor",get:function(){return this._showDotCursor},set:function(r){this._showDotCursor=r,this._refreshCursor()}},{key:"background",get:function(){return this._screen.style.background},set:function(r){this._screen.style.background=r}},{key:"qualityLevel",get:function(){return this._qualityLevel},set:function(r){if(!Number.isInteger(r)||r<0||r>9){te.Error("qualityLevel must be an integer between 0 and 9");return}this._qualityLevel!==r&&(this._qualityLevel=r,this._rfbConnectionState==="connected"&&this._sendEncodings())}},{key:"compressionLevel",get:function(){return this._compressionLevel},set:function(r){if(!Number.isInteger(r)||r<0||r>9){te.Error("compressionLevel must be an integer between 0 and 9");return}this._compressionLevel!==r&&(this._compressionLevel=r,this._rfbConnectionState==="connected"&&this._sendEncodings())}},{key:"disconnect",value:function(){this._updateConnectionState("disconnecting"),this._sock.off("error"),this._sock.off("message"),this._sock.off("open"),this._rfbRSAAESAuthenticationState!==null&&this._rfbRSAAESAuthenticationState.disconnect()}},{key:"approveServer",value:function(){this._rfbRSAAESAuthenticationState!==null&&this._rfbRSAAESAuthenticationState.approveServer()}},{key:"sendCredentials",value:function(r){this._rfbCredentials=r,this._resumeAuthentication()}},{key:"sendCtrlAltDel",value:function(){this._rfbConnectionState!=="connected"||this._viewOnly||(te.Info("Sending Ctrl-Alt-Del"),this.sendKey(Kt.default.XK_Control_L,"ControlLeft",!0),this.sendKey(Kt.default.XK_Alt_L,"AltLeft",!0),this.sendKey(Kt.default.XK_Delete,"Delete",!0),this.sendKey(Kt.default.XK_Delete,"Delete",!1),this.sendKey(Kt.default.XK_Alt_L,"AltLeft",!1),this.sendKey(Kt.default.XK_Control_L,"ControlLeft",!1))}},{key:"machineShutdown",value:function(){this._xvpOp(1,2)}},{key:"machineReboot",value:function(){this._xvpOp(1,3)}},{key:"machineReset",value:function(){this._xvpOp(1,4)}},{key:"sendKey",value:function(r,s,n){if(!(this._rfbConnectionState!=="connected"||this._viewOnly)){if(n===void 0){this.sendKey(r,s,!0),this.sendKey(r,s,!1);return}var o=AC.default[s];if(this._qemuExtKeyEventSupported&&o)r=r||0,te.Info("Sending key ("+(n?"down":"up")+"): keysym "+r+", scancode "+o),t.messages.QEMUExtendedKeyEvent(this._sock,r,n,o);else{if(!r)return;te.Info("Sending keysym ("+(n?"down":"up")+"): "+r),t.messages.keyEvent(this._sock,r,n?1:0)}}}},{key:"focus",value:function(r){this._canvas.focus(r)}},{key:"blur",value:function(){this._canvas.blur()}},{key:"clipboardPasteFrom",value:function(r){if(!(this._rfbConnectionState!=="connected"||this._viewOnly))if(this._clipboardServerCapabilitiesFormats[ai]&&this._clipboardServerCapabilitiesActions[mn])this._clipboardText=r,t.messages.extendedClipboardNotify(this._sock,[ai]);else{var s,n,o;s=0;var a=cc(r),h;try{for(a.s();!(h=a.n()).done;){var l=h.value;s++}}catch(v){a.e(v)}finally{a.f()}o=new Uint8Array(s),n=0;var c=cc(r),u;try{for(c.s();!(u=c.n()).done;){var p=u.value,g=p.codePointAt(0);g>255&&(g=63),o[n++]=g}}catch(v){c.e(v)}finally{c.f()}t.messages.clientCutText(this._sock,o)}}},{key:"getImageData",value:function(){return this._display.getImageData()}},{key:"toDataURL",value:function(r,s){return this._display.toDataURL(r,s)}},{key:"toBlob",value:function(r,s,n){return this._display.toBlob(r,s,n)}},{key:"_connect",value:function(){if(te.Debug(">> RFB.connect"),this._url)te.Info("connecting to ".concat(this._url)),this._sock.open(this._url,this._wsProtocols);else{if(te.Info("attaching ".concat(this._rawChannel," to Websock")),this._sock.attach(this._rawChannel),this._sock.readyState==="closed")throw Error("Cannot use already closed WebSocket/RTCDataChannel");this._sock.readyState==="open"&&this._socketOpen()}this._target.appendChild(this._screen),this._gestures.attach(this._canvas),this._cursor.attach(this._canvas),this._refreshCursor(),this._resizeObserver.observe(this._screen),this._canvas.addEventListener("mousedown",this._eventHandlers.focusCanvas),this._canvas.addEventListener("touchstart",this._eventHandlers.focusCanvas),this._canvas.addEventListener("mousedown",this._eventHandlers.handleMouse),this._canvas.addEventListener("mouseup",this._eventHandlers.handleMouse),this._canvas.addEventListener("mousemove",this._eventHandlers.handleMouse),this._canvas.addEventListener("click",this._eventHandlers.handleMouse),this._canvas.addEventListener("contextmenu",this._eventHandlers.handleMouse),this._canvas.addEventListener("wheel",this._eventHandlers.handleWheel),this._canvas.addEventListener("gesturestart",this._eventHandlers.handleGesture),this._canvas.addEventListener("gesturemove",this._eventHandlers.handleGesture),this._canvas.addEventListener("gestureend",this._eventHandlers.handleGesture),te.Debug("<< RFB.connect")}},{key:"_disconnect",value:function(){te.Debug(">> RFB.disconnect"),this._cursor.detach(),this._canvas.removeEventListener("gesturestart",this._eventHandlers.handleGesture),this._canvas.removeEventListener("gesturemove",this._eventHandlers.handleGesture),this._canvas.removeEventListener("gestureend",this._eventHandlers.handleGesture),this._canvas.removeEventListener("wheel",this._eventHandlers.handleWheel),this._canvas.removeEventListener("mousedown",this._eventHandlers.handleMouse),this._canvas.removeEventListener("mouseup",this._eventHandlers.handleMouse),this._canvas.removeEventListener("mousemove",this._eventHandlers.handleMouse),this._canvas.removeEventListener("click",this._eventHandlers.handleMouse),this._canvas.removeEventListener("contextmenu",this._eventHandlers.handleMouse),this._canvas.removeEventListener("mousedown",this._eventHandlers.focusCanvas),this._canvas.removeEventListener("touchstart",this._eventHandlers.focusCanvas),this._resizeObserver.disconnect(),this._keyboard.ungrab(),this._gestures.detach(),this._sock.close();try{this._target.removeChild(this._screen)}catch(r){if(r.name!=="NotFoundError")throw r}clearTimeout(this._resizeTimeout),clearTimeout(this._mouseMoveTimer),te.Debug("<< RFB.disconnect")}},{key:"_socketOpen",value:function(){this._rfbConnectionState==="connecting"&&this._rfbInitState===""?(this._rfbInitState="ProtocolVersion",te.Debug("Starting VNC handshake")):this._fail("Unexpected server connection while "+this._rfbConnectionState)}},{key:"_socketClose",value:function(r){te.Debug("WebSocket on-close event");var s="";switch(r.code&&(s="(code: "+r.code,r.reason&&(s+=", reason: "+r.reason),s+=")"),this._rfbConnectionState){case"connecting":this._fail("Connection closed "+s);break;case"connected":this._updateConnectionState("disconnecting"),this._updateConnectionState("disconnected");break;case"disconnecting":this._updateConnectionState("disconnected");break;case"disconnected":this._fail("Unexpected server disconnect when already disconnected "+s);break;default:this._fail("Unexpected server disconnect before connecting "+s);break}this._sock.off("close"),this._rawChannel=null}},{key:"_socketError",value:function(r){te.Warn("WebSocket on-error event")}},{key:"_focusCanvas",value:function(r){this.focusOnClick&&this.focus({preventScroll:!0})}},{key:"_setDesktopName",value:function(r){this._fbName=r,this.dispatchEvent(new CustomEvent("desktopname",{detail:{name:this._fbName}}))}},{key:"_saveExpectedClientSize",value:function(){this._expectedClientWidth=this._screen.clientWidth,this._expectedClientHeight=this._screen.clientHeight}},{key:"_currentClientSize",value:function(){return[this._screen.clientWidth,this._screen.clientHeight]}},{key:"_clientHasExpectedSize",value:function(){var r=this._currentClientSize(),s=RC(r,2),n=s[0],o=s[1];return n==this._expectedClientWidth&&o==this._expectedClientHeight}},{key:"_handleResize",value:function(){var r=this;this._clientHasExpectedSize()||(window.requestAnimationFrame(function(){r._updateClip(),r._updateScale()}),this._resizeSession&&(clearTimeout(this._resizeTimeout),this._resizeTimeout=setTimeout(this._requestRemoteResize.bind(this),500)))}},{key:"_updateClip",value:function(){var r=this._display.clipViewport,s=this._clipViewport;if(this._scaleViewport&&(s=!1),r!==s&&(this._display.clipViewport=s),s){var n=this._screenSize();this._display.viewportChangeSize(n.w,n.h),this._fixScrollbars(),this._setClippingViewport(n.w<this._display.width||n.h<this._display.height)}else this._setClippingViewport(!1);r!==s&&this._saveExpectedClientSize()}},{key:"_updateScale",value:function(){if(!this._scaleViewport)this._display.scale=1;else{var r=this._screenSize();this._display.autoscale(r.w,r.h)}this._fixScrollbars()}},{key:"_requestRemoteResize",value:function(){if(clearTimeout(this._resizeTimeout),this._resizeTimeout=null,!(!this._resizeSession||this._viewOnly||!this._supportsSetDesktopSize)){var r=this._screenSize();t.messages.setDesktopSize(this._sock,Math.floor(r.w),Math.floor(r.h),this._screenID,this._screenFlags),te.Debug("Requested new desktop size: "+r.w+"x"+r.h)}}},{key:"_screenSize",value:function(){var r=this._screen.getBoundingClientRect();return{w:r.width,h:r.height}}},{key:"_fixScrollbars",value:function(){var r=this._screen.style.overflow;this._screen.style.overflow="hidden",this._screen.getBoundingClientRect(),this._screen.style.overflow=r}},{key:"_updateConnectionState",value:function(r){var s=this,n=this._rfbConnectionState;if(r===n){te.Debug("Already in state '"+r+"', ignoring");return}if(n==="disconnected"){te.Error("Tried changing state of a disconnected RFB object");return}switch(r){case"connected":if(n!=="connecting"){te.Error("Bad transition to connected state, previous connection state: "+n);return}break;case"disconnected":if(n!=="disconnecting"){te.Error("Bad transition to disconnected state, previous connection state: "+n);return}break;case"connecting":if(n!==""){te.Error("Bad transition to connecting state, previous connection state: "+n);return}break;case"disconnecting":if(n!=="connected"&&n!=="connecting"){te.Error("Bad transition to disconnecting state, previous connection state: "+n);return}break;default:te.Error("Unknown connection state: "+r);return}switch(this._rfbConnectionState=r,te.Debug("New state '"+r+"', was '"+n+"'."),this._disconnTimer&&r!=="disconnecting"&&(te.Debug("Clearing disconnect timer"),clearTimeout(this._disconnTimer),this._disconnTimer=null,this._sock.off("close")),r){case"connecting":this._connect();break;case"connected":this.dispatchEvent(new CustomEvent("connect",{detail:{}}));break;case"disconnecting":this._disconnect(),this._disconnTimer=setTimeout(function(){te.Error("Disconnection timed out."),s._updateConnectionState("disconnected")},$C*1e3);break;case"disconnected":this.dispatchEvent(new CustomEvent("disconnect",{detail:{clean:this._rfbCleanDisconnect}}));break}}},{key:"_fail",value:function(r){switch(this._rfbConnectionState){case"disconnecting":te.Error("Failed when disconnecting: "+r);break;case"connected":te.Error("Failed while connected: "+r);break;case"connecting":te.Error("Failed when connecting: "+r);break;default:te.Error("RFB failure: "+r);break}return this._rfbCleanDisconnect=!1,this._updateConnectionState("disconnecting"),this._updateConnectionState("disconnected"),!1}},{key:"_setCapability",value:function(r,s){this._capabilities[r]=s,this.dispatchEvent(new CustomEvent("capabilities",{detail:{capabilities:this._capabilities}}))}},{key:"_handleMessage",value:function(){if(this._sock.rQwait("message",1)){te.Warn("handleMessage called on an empty receive queue");return}switch(this._rfbConnectionState){case"disconnected":te.Error("Got data while disconnected");break;case"connected":for(;!(this._flushing||!this._normalMsg()||this._sock.rQwait("message",1)););break;case"connecting":for(;this._rfbConnectionState==="connecting"&&this._initMsg(););break;default:te.Error("Got data while in an invalid state");break}}},{key:"_handleKeyEvent",value:function(r,s,n,o,a){s=="CapsLock"&&n&&(this._remoteCapsLock=null),this._remoteCapsLock!==null&&a!==null&&this._remoteCapsLock!==a&&n&&(te.Debug("Fixing remote caps lock"),this.sendKey(Kt.default.XK_Caps_Lock,"CapsLock",!0),this.sendKey(Kt.default.XK_Caps_Lock,"CapsLock",!1),this._remoteCapsLock=null),s=="NumLock"&&n&&(this._remoteNumLock=null),this._remoteNumLock!==null&&o!==null&&this._remoteNumLock!==o&&n&&(te.Debug("Fixing remote num lock"),this.sendKey(Kt.default.XK_Num_Lock,"NumLock",!0),this.sendKey(Kt.default.XK_Num_Lock,"NumLock",!1),this._remoteNumLock=null),this.sendKey(r,s,n)}},{key:"_handleMouse",value:function(r){if(!(r.type==="click"&&r.target!==this._canvas)&&(r.stopPropagation(),r.preventDefault(),!(r.type==="click"||r.type==="contextmenu"))){var s=(0,pn.clientToElement)(r.clientX,r.clientY,this._canvas);switch(r.type){case"mousedown":(0,fC.setCapture)(this._canvas),this._handleMouseButton(s.x,s.y,!0,1<<r.button);break;case"mouseup":this._handleMouseButton(s.x,s.y,!1,1<<r.button);break;case"mousemove":this._handleMouseMove(s.x,s.y);break}}}},{key:"_handleMouseButton",value:function(r,s,n,o){if(this.dragViewport)if(n&&!this._viewportDragging){this._viewportDragging=!0,this._viewportDragPos={x:r,y:s},this._viewportHasMoved=!1;return}else{if(this._viewportDragging=!1,this._viewportHasMoved)return;this._sendMouse(r,s,o)}this._mouseMoveTimer!==null&&(clearTimeout(this._mouseMoveTimer),this._mouseMoveTimer=null,this._sendMouse(r,s,this._mouseButtonMask)),n?this._mouseButtonMask|=o:this._mouseButtonMask&=~o,this._sendMouse(r,s,this._mouseButtonMask)}},{key:"_handleMouseMove",value:function(r,s){var n=this;if(this._viewportDragging){var o=this._viewportDragPos.x-r,a=this._viewportDragPos.y-s;(this._viewportHasMoved||Math.abs(o)>Ug.dragThreshold||Math.abs(a)>Ug.dragThreshold)&&(this._viewportHasMoved=!0,this._viewportDragPos={x:r,y:s},this._display.viewportChangePos(o,a));return}if(this._mousePos={x:r,y:s},this._mouseMoveTimer==null){var h=Date.now()-this._mouseLastMoveTime;h>Gg?(this._sendMouse(r,s,this._mouseButtonMask),this._mouseLastMoveTime=Date.now()):this._mouseMoveTimer=setTimeout(function(){n._handleDelayedMouseMove()},Gg-h)}}},{key:"_handleDelayedMouseMove",value:function(){this._mouseMoveTimer=null,this._sendMouse(this._mousePos.x,this._mousePos.y,this._mouseButtonMask),this._mouseLastMoveTime=Date.now()}},{key:"_sendMouse",value:function(r,s,n){this._rfbConnectionState==="connected"&&(this._viewOnly||t.messages.pointerEvent(this._sock,this._display.absX(r),this._display.absY(s),n))}},{key:"_handleWheel",value:function(r){if(this._rfbConnectionState==="connected"&&!this._viewOnly){r.stopPropagation(),r.preventDefault();var s=(0,pn.clientToElement)(r.clientX,r.clientY,this._canvas),n=r.deltaX,o=r.deltaY;r.deltaMode!==0&&(n*=qg,o*=qg),this._accumulatedWheelDeltaX+=n,this._accumulatedWheelDeltaY+=o,Math.abs(this._accumulatedWheelDeltaX)>=jg&&(this._accumulatedWheelDeltaX<0?(this._handleMouseButton(s.x,s.y,!0,32),this._handleMouseButton(s.x,s.y,!1,32)):this._accumulatedWheelDeltaX>0&&(this._handleMouseButton(s.x,s.y,!0,64),this._handleMouseButton(s.x,s.y,!1,64)),this._accumulatedWheelDeltaX=0),Math.abs(this._accumulatedWheelDeltaY)>=jg&&(this._accumulatedWheelDeltaY<0?(this._handleMouseButton(s.x,s.y,!0,8),this._handleMouseButton(s.x,s.y,!1,8)):this._accumulatedWheelDeltaY>0&&(this._handleMouseButton(s.x,s.y,!0,16),this._handleMouseButton(s.x,s.y,!1,16)),this._accumulatedWheelDeltaY=0)}}},{key:"_fakeMouseMove",value:function(r,s,n){this._handleMouseMove(s,n),this._cursor.move(r.detail.clientX,r.detail.clientY)}},{key:"_handleTapEvent",value:function(r,s){var n=(0,pn.clientToElement)(r.detail.clientX,r.detail.clientY,this._canvas);if(this._gestureLastTapTime!==null&&Date.now()-this._gestureLastTapTime<jC&&this._gestureFirstDoubleTapEv.detail.type===r.detail.type){var o=this._gestureFirstDoubleTapEv.detail.clientX-r.detail.clientX,a=this._gestureFirstDoubleTapEv.detail.clientY-r.detail.clientY,h=Math.hypot(o,a);h<qC?n=(0,pn.clientToElement)(this._gestureFirstDoubleTapEv.detail.clientX,this._gestureFirstDoubleTapEv.detail.clientY,this._canvas):this._gestureFirstDoubleTapEv=r}else this._gestureFirstDoubleTapEv=r;this._gestureLastTapTime=Date.now(),this._fakeMouseMove(this._gestureFirstDoubleTapEv,n.x,n.y),this._handleMouseButton(n.x,n.y,!0,s),this._handleMouseButton(n.x,n.y,!1,s)}},{key:"_handleGesture",value:function(r){var s,n=(0,pn.clientToElement)(r.detail.clientX,r.detail.clientY,this._canvas);switch(r.type){case"gesturestart":switch(r.detail.type){case"onetap":this._handleTapEvent(r,1);break;case"twotap":this._handleTapEvent(r,4);break;case"threetap":this._handleTapEvent(r,2);break;case"drag":this._fakeMouseMove(r,n.x,n.y),this._handleMouseButton(n.x,n.y,!0,1);break;case"longpress":this._fakeMouseMove(r,n.x,n.y),this._handleMouseButton(n.x,n.y,!0,4);break;case"twodrag":this._gestureLastMagnitudeX=r.detail.magnitudeX,this._gestureLastMagnitudeY=r.detail.magnitudeY,this._fakeMouseMove(r,n.x,n.y);break;case"pinch":this._gestureLastMagnitudeX=Math.hypot(r.detail.magnitudeX,r.detail.magnitudeY),this._fakeMouseMove(r,n.x,n.y);break}break;case"gesturemove":switch(r.detail.type){case"onetap":case"twotap":case"threetap":break;case"drag":case"longpress":this._fakeMouseMove(r,n.x,n.y);break;case"twodrag":for(this._fakeMouseMove(r,n.x,n.y);r.detail.magnitudeY-this._gestureLastMagnitudeY>ar;)this._handleMouseButton(n.x,n.y,!0,8),this._handleMouseButton(n.x,n.y,!1,8),this._gestureLastMagnitudeY+=ar;for(;r.detail.magnitudeY-this._gestureLastMagnitudeY<-ar;)this._handleMouseButton(n.x,n.y,!0,16),this._handleMouseButton(n.x,n.y,!1,16),this._gestureLastMagnitudeY-=ar;for(;r.detail.magnitudeX-this._gestureLastMagnitudeX>ar;)this._handleMouseButton(n.x,n.y,!0,32),this._handleMouseButton(n.x,n.y,!1,32),this._gestureLastMagnitudeX+=ar;for(;r.detail.magnitudeX-this._gestureLastMagnitudeX<-ar;)this._handleMouseButton(n.x,n.y,!0,64),this._handleMouseButton(n.x,n.y,!1,64),this._gestureLastMagnitudeX-=ar;break;case"pinch":if(this._fakeMouseMove(r,n.x,n.y),s=Math.hypot(r.detail.magnitudeX,r.detail.magnitudeY),Math.abs(s-this._gestureLastMagnitudeX)>vn){for(this._handleKeyEvent(Kt.default.XK_Control_L,"ControlLeft",!0);s-this._gestureLastMagnitudeX>vn;)this._handleMouseButton(n.x,n.y,!0,8),this._handleMouseButton(n.x,n.y,!1,8),this._gestureLastMagnitudeX+=vn;for(;s-this._gestureLastMagnitudeX<-vn;)this._handleMouseButton(n.x,n.y,!0,16),this._handleMouseButton(n.x,n.y,!1,16),this._gestureLastMagnitudeX-=vn}this._handleKeyEvent(Kt.default.XK_Control_L,"ControlLeft",!1);break}break;case"gestureend":switch(r.detail.type){case"onetap":case"twotap":case"threetap":case"pinch":case"twodrag":break;case"drag":this._fakeMouseMove(r,n.x,n.y),this._handleMouseButton(n.x,n.y,!1,1);break;case"longpress":this._fakeMouseMove(r,n.x,n.y),this._handleMouseButton(n.x,n.y,!1,4);break}break}}},{key:"_negotiateProtocolVersion",value:function(){if(this._sock.rQwait("version",12))return!1;var r=this._sock.rQshiftStr(12).substr(4,7);te.Info("Server ProtocolVersion: "+r);var s=0;switch(r){case"000.000":s=1;break;case"003.003":case"003.006":this._rfbVersion=3.3;break;case"003.007":this._rfbVersion=3.7;break;case"003.008":case"003.889":case"004.000":case"004.001":case"005.000":this._rfbVersion=3.8;break;default:return this._fail("Invalid server version "+r)}if(s){for(var n="ID:"+this._repeaterID;n.length<250;)n+="\0";return this._sock.sQpushString(n),this._sock.flush(),!0}this._rfbVersion>this._rfbMaxVersion&&(this._rfbVersion=this._rfbMaxVersion);var o="00"+parseInt(this._rfbVersion,10)+".00"+this._rfbVersion*10%10;this._sock.sQpushString("RFB "+o+`
`),this._sock.flush(),te.Debug("Sent ProtocolVersion: "+o),this._rfbInitState="Security"}},{key:"_isSupportedSecurityType",value:function(r){var s=[Vg,ca,Yg,Jg,uc,Zg,ep,tp,rp];return s.includes(r)}},{key:"_negotiateSecurity",value:function(){if(this._rfbVersion>=3.7){var r=this._sock.rQshift8();if(this._sock.rQwait("security type",r,1))return!1;if(r===0)return this._rfbInitState="SecurityReason",this._securityContext="no security types",this._securityStatus=1,!0;var s=this._sock.rQshiftBytes(r);te.Debug("Server security types: "+s),this._rfbAuthScheme=-1;var n=cc(s),o;try{for(n.s();!(o=n.n()).done;){var a=o.value;if(this._isSupportedSecurityType(a)){this._rfbAuthScheme=a;break}}}catch(h){n.e(h)}finally{n.f()}if(this._rfbAuthScheme===-1)return this._fail("Unsupported security types (types: "+s+")");this._sock.sQpush8(this._rfbAuthScheme),this._sock.flush()}else{if(this._sock.rQwait("security scheme",4))return!1;if(this._rfbAuthScheme=this._sock.rQshift32(),this._rfbAuthScheme==0)return this._rfbInitState="SecurityReason",this._securityContext="authentication scheme",this._securityStatus=1,!0}return this._rfbInitState="Authentication",te.Debug("Authenticating using scheme: "+this._rfbAuthScheme),!0}},{key:"_handleSecurityReason",value:function(){if(this._sock.rQwait("reason length",4))return!1;var r=this._sock.rQshift32(),s="";if(r>0){if(this._sock.rQwait("reason",r,4))return!1;s=this._sock.rQshiftStr(r)}return s!==""?(this.dispatchEvent(new CustomEvent("securityfailure",{detail:{status:this._securityStatus,reason:s}})),this._fail("Security negotiation failed on "+this._securityContext+" (reason: "+s+")")):(this.dispatchEvent(new CustomEvent("securityfailure",{detail:{status:this._securityStatus}})),this._fail("Security negotiation failed on "+this._securityContext))}},{key:"_negotiateXvpAuth",value:function(){return this._rfbCredentials.username===void 0||this._rfbCredentials.password===void 0||this._rfbCredentials.target===void 0?(this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["username","password","target"]}})),!1):(this._sock.sQpush8(this._rfbCredentials.username.length),this._sock.sQpush8(this._rfbCredentials.target.length),this._sock.sQpushString(this._rfbCredentials.username),this._sock.sQpushString(this._rfbCredentials.target),this._sock.flush(),this._rfbAuthScheme=ca,this._negotiateAuthentication())}},{key:"_negotiateVeNCryptAuth",value:function(){if(this._rfbVeNCryptState==0){if(this._sock.rQwait("vencrypt version",2))return!1;var r=this._sock.rQshift8(),s=this._sock.rQshift8();if(!(r==0&&s==2))return this._fail("Unsupported VeNCrypt version "+r+"."+s);this._sock.sQpush8(0),this._sock.sQpush8(2),this._sock.flush(),this._rfbVeNCryptState=1}if(this._rfbVeNCryptState==1){if(this._sock.rQwait("vencrypt ack",1))return!1;var n=this._sock.rQshift8();if(n!=0)return this._fail("VeNCrypt failure "+n);this._rfbVeNCryptState=2}if(this._rfbVeNCryptState==2){if(this._sock.rQwait("vencrypt subtypes length",1))return!1;var o=this._sock.rQshift8();if(o<1)return this._fail("VeNCrypt subtypes empty");this._rfbVeNCryptSubtypesLength=o,this._rfbVeNCryptState=3}if(this._rfbVeNCryptState==3){if(this._sock.rQwait("vencrypt subtypes",4*this._rfbVeNCryptSubtypesLength))return!1;for(var a=[],h=0;h<this._rfbVeNCryptSubtypesLength;h++)a.push(this._sock.rQshift32());this._rfbAuthScheme=-1;for(var l=0,c=a;l<c.length;l++){var u=c[l];if(u!==uc&&this._isSupportedSecurityType(u)){this._rfbAuthScheme=u;break}}return this._rfbAuthScheme===-1?this._fail("Unsupported security types (types: "+a+")"):(this._sock.sQpush32(this._rfbAuthScheme),this._sock.flush(),this._rfbVeNCryptState=4,!0)}}},{key:"_negotiatePlainAuth",value:function(){if(this._rfbCredentials.username===void 0||this._rfbCredentials.password===void 0)return this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["username","password"]}})),!1;var r=(0,oi.encodeUTF8)(this._rfbCredentials.username),s=(0,oi.encodeUTF8)(this._rfbCredentials.password);return this._sock.sQpush32(r.length),this._sock.sQpush32(s.length),this._sock.sQpushString(r),this._sock.sQpushString(s),this._sock.flush(),this._rfbInitState="SecurityResult",!0}},{key:"_negotiateStdVNCAuth",value:function(){if(this._sock.rQwait("auth challenge",16))return!1;if(this._rfbCredentials.password===void 0)return this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["password"]}})),!1;var r=Array.prototype.slice.call(this._sock.rQshiftBytes(16)),s=t.genDES(this._rfbCredentials.password,r);return this._sock.sQpushBytes(s),this._sock.flush(),this._rfbInitState="SecurityResult",!0}},{key:"_negotiateARDAuth",value:function(){if(this._rfbCredentials.username===void 0||this._rfbCredentials.password===void 0)return this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["username","password"]}})),!1;if(this._rfbCredentials.ardPublicKey!=null&&this._rfbCredentials.ardCredentials!=null)return this._sock.sQpushBytes(this._rfbCredentials.ardCredentials),this._sock.sQpushBytes(this._rfbCredentials.ardPublicKey),this._sock.flush(),this._rfbCredentials.ardCredentials=null,this._rfbCredentials.ardPublicKey=null,this._rfbInitState="SecurityResult",!0;if(this._sock.rQwait("read ard",4))return!1;var r=this._sock.rQshiftBytes(2),s=this._sock.rQshift16();if(this._sock.rQwait("read ard keylength",s*2,4))return!1;var n=this._sock.rQshiftBytes(s),o=this._sock.rQshiftBytes(s),a=bt.default.generateKey({name:"DH",g:r,p:n},!1,["deriveBits"]);return this._negotiateARDAuthAsync(s,o,a),!1}},{key:"_negotiateARDAuthAsync",value:function(){var i=TC(dc().mark(function s(n,o,a){var h,l,c,u,p,g,v,m,x,E;return dc().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:for(h=bt.default.exportKey("raw",a.publicKey),l=bt.default.deriveBits({name:"DH",public:o},a.privateKey,n*8),c=(0,oi.encodeUTF8)(this._rfbCredentials.username).substring(0,63),u=(0,oi.encodeUTF8)(this._rfbCredentials.password).substring(0,63),p=window.crypto.getRandomValues(new Uint8Array(128)),g=0;g<c.length;g++)p[g]=c.charCodeAt(g);for(p[c.length]=0,v=0;v<u.length;v++)p[64+v]=u.charCodeAt(v);return p[64+u.length]=0,D.next=11,bt.default.digest("MD5",l);case 11:return m=D.sent,D.next=14,bt.default.importKey("raw",m,{name:"AES-ECB"},!1,["encrypt"]);case 14:return x=D.sent,D.next=17,bt.default.encrypt({name:"AES-ECB"},x,p);case 17:E=D.sent,this._rfbCredentials.ardCredentials=E,this._rfbCredentials.ardPublicKey=h,this._resumeAuthentication();case 21:case"end":return D.stop()}},s,this)}));function r(s,n,o){return i.apply(this,arguments)}return r}()},{key:"_negotiateTightUnixAuth",value:function(){return this._rfbCredentials.username===void 0||this._rfbCredentials.password===void 0?(this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["username","password"]}})),!1):(this._sock.sQpush32(this._rfbCredentials.username.length),this._sock.sQpush32(this._rfbCredentials.password.length),this._sock.sQpushString(this._rfbCredentials.username),this._sock.sQpushString(this._rfbCredentials.password),this._sock.flush(),this._rfbInitState="SecurityResult",!0)}},{key:"_negotiateTightTunnels",value:function(r){for(var s={0:{vendor:"TGHT",signature:"NOTUNNEL"}},n={},o=0;o<r;o++){var a=this._sock.rQshift32(),h=this._sock.rQshiftStr(4),l=this._sock.rQshiftStr(8);n[a]={vendor:h,signature:l}}return te.Debug("Server Tight tunnel types: "+n),n[1]&&n[1].vendor==="SICR"&&n[1].signature==="SCHANNEL"&&(te.Debug("Detected Siemens server. Assuming NOTUNNEL support."),n[0]={vendor:"TGHT",signature:"NOTUNNEL"}),n[0]?n[0].vendor!=s[0].vendor||n[0].signature!=s[0].signature?this._fail("Client's tunnel type had the incorrect vendor or signature"):(te.Debug("Selected tunnel type: "+s[0]),this._sock.sQpush32(0),this._sock.flush(),!1):this._fail("Server wanted tunnels, but doesn't support the notunnel type")}},{key:"_negotiateTightAuth",value:function(){if(!this._rfbTightVNC){if(this._sock.rQwait("num tunnels",4))return!1;var r=this._sock.rQshift32();if(r>0&&this._sock.rQwait("tunnel capabilities",16*r,4))return!1;if(this._rfbTightVNC=!0,r>0)return this._negotiateTightTunnels(r),!1}if(this._sock.rQwait("sub auth count",4))return!1;var s=this._sock.rQshift32();if(s===0)return this._rfbInitState="SecurityResult",!0;if(this._sock.rQwait("sub auth capabilities",16*s,4))return!1;for(var n={STDVNOAUTH__:1,STDVVNCAUTH_:2,TGHTULGNAUTH:129},o=[],a=0;a<s;a++){this._sock.rQshift32();var h=this._sock.rQshiftStr(12);o.push(h)}te.Debug("Server Tight authentication types: "+o);for(var l in n)if(o.indexOf(l)!=-1)switch(this._sock.sQpush32(n[l]),this._sock.flush(),te.Debug("Selected authentication type: "+l),l){case"STDVNOAUTH__":return this._rfbInitState="SecurityResult",!0;case"STDVVNCAUTH_":return this._rfbAuthScheme=ca,!0;case"TGHTULGNAUTH":return this._rfbAuthScheme=ip,!0;default:return this._fail("Unsupported tiny auth scheme (scheme: "+l+")")}return this._fail("No supported sub-auth types!")}},{key:"_handleRSAAESCredentialsRequired",value:function(r){this.dispatchEvent(r)}},{key:"_handleRSAAESServerVerification",value:function(r){this.dispatchEvent(r)}},{key:"_negotiateRA2neAuth",value:function(){var r=this;return this._rfbRSAAESAuthenticationState===null&&(this._rfbRSAAESAuthenticationState=new xC.default(this._sock,function(){return r._rfbCredentials}),this._rfbRSAAESAuthenticationState.addEventListener("serververification",this._eventHandlers.handleRSAAESServerVerification),this._rfbRSAAESAuthenticationState.addEventListener("credentialsrequired",this._eventHandlers.handleRSAAESCredentialsRequired)),this._rfbRSAAESAuthenticationState.checkInternalEvents(),this._rfbRSAAESAuthenticationState.hasStarted||this._rfbRSAAESAuthenticationState.negotiateRA2neAuthAsync().catch(function(s){s.message!=="disconnect normally"&&r._fail(s.message)}).then(function(){return r._rfbInitState="SecurityResult",!0}).finally(function(){r._rfbRSAAESAuthenticationState.removeEventListener("serververification",r._eventHandlers.handleRSAAESServerVerification),r._rfbRSAAESAuthenticationState.removeEventListener("credentialsrequired",r._eventHandlers.handleRSAAESCredentialsRequired),r._rfbRSAAESAuthenticationState=null}),!1}},{key:"_negotiateMSLogonIIAuth",value:function(){if(this._sock.rQwait("mslogonii dh param",24))return!1;if(this._rfbCredentials.username===void 0||this._rfbCredentials.password===void 0)return this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["username","password"]}})),!1;var r=this._sock.rQshiftBytes(8),s=this._sock.rQshiftBytes(8),n=this._sock.rQshiftBytes(8),o=bt.default.generateKey({name:"DH",g:r,p:s},!0,["deriveBits"]),a=bt.default.exportKey("raw",o.publicKey),h=bt.default.deriveBits({name:"DH",public:n},o.privateKey,64),l=bt.default.importKey("raw",h,{name:"DES-CBC"},!1,["encrypt"]),c=(0,oi.encodeUTF8)(this._rfbCredentials.username).substring(0,255),u=(0,oi.encodeUTF8)(this._rfbCredentials.password).substring(0,63),p=new Uint8Array(256),g=new Uint8Array(64);window.crypto.getRandomValues(p),window.crypto.getRandomValues(g);for(var v=0;v<c.length;v++)p[v]=c.charCodeAt(v);p[c.length]=0;for(var m=0;m<u.length;m++)g[m]=u.charCodeAt(m);return g[u.length]=0,p=bt.default.encrypt({name:"DES-CBC",iv:h},l,p),g=bt.default.encrypt({name:"DES-CBC",iv:h},l,g),this._sock.sQpushBytes(a),this._sock.sQpushBytes(p),this._sock.sQpushBytes(g),this._sock.flush(),this._rfbInitState="SecurityResult",!0}},{key:"_negotiateAuthentication",value:function(){switch(this._rfbAuthScheme){case Vg:return this._rfbVersion>=3.8?this._rfbInitState="SecurityResult":this._rfbInitState="ClientInitialisation",!0;case Zg:return this._negotiateXvpAuth();case ep:return this._negotiateARDAuth();case ca:return this._negotiateStdVNCAuth();case Jg:return this._negotiateTightAuth();case uc:return this._negotiateVeNCryptAuth();case rp:return this._negotiatePlainAuth();case ip:return this._negotiateTightUnixAuth();case Yg:return this._negotiateRA2neAuth();case tp:return this._negotiateMSLogonIIAuth();default:return this._fail("Unsupported auth scheme (scheme: "+this._rfbAuthScheme+")")}}},{key:"_handleSecurityResult",value:function(){if(this._sock.rQwait("VNC auth response ",4))return!1;var r=this._sock.rQshift32();return r===0?(this._rfbInitState="ClientInitialisation",te.Debug("Authentication OK"),!0):this._rfbVersion>=3.8?(this._rfbInitState="SecurityReason",this._securityContext="security result",this._securityStatus=r,!0):(this.dispatchEvent(new CustomEvent("securityfailure",{detail:{status:r}})),this._fail("Security handshake failed"))}},{key:"_negotiateServerInit",value:function(){if(this._sock.rQwait("server initialization",24))return!1;var r=this._sock.rQshift16(),s=this._sock.rQshift16(),n=this._sock.rQshift8(),o=this._sock.rQshift8(),a=this._sock.rQshift8(),h=this._sock.rQshift8(),l=this._sock.rQshift16(),c=this._sock.rQshift16(),u=this._sock.rQshift16(),p=this._sock.rQshift8(),g=this._sock.rQshift8(),v=this._sock.rQshift8();this._sock.rQskipBytes(3);var m=this._sock.rQshift32();if(this._sock.rQwait("server init name",m,24))return!1;var x=this._sock.rQshiftStr(m);if(x=(0,oi.decodeUTF8)(x,!0),this._rfbTightVNC){if(this._sock.rQwait("TightVNC extended server init header",8,24+m))return!1;var E=this._sock.rQshift16(),R=this._sock.rQshift16(),D=this._sock.rQshift16();this._sock.rQskipBytes(2);var b=(E+R+D)*16;if(this._sock.rQwait("TightVNC extended server init header",b,32+m))return!1;this._sock.rQskipBytes(16*E),this._sock.rQskipBytes(16*R),this._sock.rQskipBytes(16*D)}return te.Info("Screen: "+r+"x"+s+", bpp: "+n+", depth: "+o+", bigEndian: "+a+", trueColor: "+h+", redMax: "+l+", greenMax: "+c+", blueMax: "+u+", redShift: "+p+", greenShift: "+g+", blueShift: "+v),this._setDesktopName(x),this._resize(r,s),this._viewOnly||this._keyboard.grab(),this._fbDepth=24,this._fbName==="Intel(r) AMT KVM"&&(te.Warn("Intel AMT KVM only supports 8/16 bit depths. Using low color mode."),this._fbDepth=8),t.messages.pixelFormat(this._sock,this._fbDepth,!0),this._sendEncodings(),t.messages.fbUpdateRequest(this._sock,!1,0,0,this._fbWidth,this._fbHeight),this._updateConnectionState("connected"),!0}},{key:"_sendEncodings",value:function(){var r=[];r.push(le.encodings.encodingCopyRect),this._fbDepth==24&&(r.push(le.encodings.encodingTight),r.push(le.encodings.encodingTightPNG),r.push(le.encodings.encodingZRLE),r.push(le.encodings.encodingJPEG),r.push(le.encodings.encodingHextile),r.push(le.encodings.encodingRRE)),r.push(le.encodings.encodingRaw),r.push(le.encodings.pseudoEncodingQualityLevel0+this._qualityLevel),r.push(le.encodings.pseudoEncodingCompressLevel0+this._compressionLevel),r.push(le.encodings.pseudoEncodingDesktopSize),r.push(le.encodings.pseudoEncodingLastRect),r.push(le.encodings.pseudoEncodingQEMUExtendedKeyEvent),r.push(le.encodings.pseudoEncodingQEMULedEvent),r.push(le.encodings.pseudoEncodingExtendedDesktopSize),r.push(le.encodings.pseudoEncodingXvp),r.push(le.encodings.pseudoEncodingFence),r.push(le.encodings.pseudoEncodingContinuousUpdates),r.push(le.encodings.pseudoEncodingDesktopName),r.push(le.encodings.pseudoEncodingExtendedClipboard),this._fbDepth==24&&(r.push(le.encodings.pseudoEncodingVMwareCursor),r.push(le.encodings.pseudoEncodingCursor)),t.messages.clientEncodings(this._sock,r)}},{key:"_initMsg",value:function(){switch(this._rfbInitState){case"ProtocolVersion":return this._negotiateProtocolVersion();case"Security":return this._negotiateSecurity();case"Authentication":return this._negotiateAuthentication();case"SecurityResult":return this._handleSecurityResult();case"SecurityReason":return this._handleSecurityReason();case"ClientInitialisation":return this._sock.sQpush8(this._shared?1:0),this._sock.flush(),this._rfbInitState="ServerInitialisation",!0;case"ServerInitialisation":return this._negotiateServerInit();default:return this._fail("Unknown init state (state: "+this._rfbInitState+")")}}},{key:"_resumeAuthentication",value:function(){setTimeout(this._initMsg.bind(this),0)}},{key:"_handleSetColourMapMsg",value:function(){return te.Debug("SetColorMapEntries"),this._fail("Unexpected SetColorMapEntries message")}},{key:"_handleServerCutText",value:function(){if(te.Debug("ServerCutText"),this._sock.rQwait("ServerCutText header",7,1))return!1;this._sock.rQskipBytes(3);var r=this._sock.rQshift32();if(r=(0,op.toSigned32bit)(r),this._sock.rQwait("ServerCutText content",Math.abs(r),8))return!1;if(r>=0){var s=this._sock.rQshiftStr(r);if(this._viewOnly)return!0;this.dispatchEvent(new CustomEvent("clipboard",{detail:{text:s}}))}else{r=Math.abs(r);var n=this._sock.rQshift32(),o=n&65535,a=n&4278190080,h=!!(a&sp);if(h){this._clipboardServerCapabilitiesFormats={},this._clipboardServerCapabilitiesActions={};for(var l=0;l<=15;l++){var c=1<<l;o&c&&(this._clipboardServerCapabilitiesFormats[c]=!0,this._sock.rQshift32())}for(var u=24;u<=31;u++){var p=1<<u;this._clipboardServerCapabilitiesActions[p]=!!(a&p)}var g=[sp,ua,np,mn,da];t.messages.extendedClipboardCaps(this._sock,g,{extendedClipboardFormatText:0})}else if(a===ua){if(this._viewOnly)return!0;this._clipboardText!=null&&this._clipboardServerCapabilitiesActions[da]&&o&ai&&t.messages.extendedClipboardProvide(this._sock,[ai],[this._clipboardText])}else if(a===np){if(this._viewOnly)return!0;this._clipboardServerCapabilitiesActions[mn]&&(this._clipboardText!=null?t.messages.extendedClipboardNotify(this._sock,[ai]):t.messages.extendedClipboardNotify(this._sock,[]))}else if(a===mn){if(this._viewOnly)return!0;this._clipboardServerCapabilitiesActions[ua]&&o&ai&&t.messages.extendedClipboardRequest(this._sock,[ai])}else if(a===da){if(this._viewOnly||!(o&ai))return!0;this._clipboardText=null;var v=this._sock.rQshiftBytes(r-4),m=new pC.default,x=null;m.setInput(v);for(var E=0;E<=15;E++){var R=1<<E;if(o&R){var D=0,b=m.inflate(4);D|=b[0]<<24,D|=b[1]<<16,D|=b[2]<<8,D|=b[3];var L=m.inflate(D);R===ai&&(x=L)}}if(m.setInput(null),x!==null){for(var I="",T=0;T<x.length;T++)I+=String.fromCharCode(x[T]);x=I,x=(0,oi.decodeUTF8)(x),x.length>0&&x.charAt(x.length-1)==="\0"&&(x=x.slice(0,-1)),x=x.replaceAll(`\r
`,`
`),this.dispatchEvent(new CustomEvent("clipboard",{detail:{text:x}}))}}else return this._fail("Unexpected action in extended clipboard message: "+a)}return!0}},{key:"_handleServerFenceMsg",value:function(){if(this._sock.rQwait("ServerFence header",8,1))return!1;this._sock.rQskipBytes(3);var r=this._sock.rQshift32(),s=this._sock.rQshift8();if(this._sock.rQwait("ServerFence payload",s,9))return!1;s>64&&(te.Warn("Bad payload length ("+s+") in fence response"),s=64);var n=this._sock.rQshiftStr(s);return this._supportsFence=!0,r&1<<31?(r&=3,t.messages.clientFence(this._sock,r,n),!0):this._fail("Unexpected fence response")}},{key:"_handleXvpMsg",value:function(){if(this._sock.rQwait("XVP version and message",3,1))return!1;this._sock.rQskipBytes(1);var r=this._sock.rQshift8(),s=this._sock.rQshift8();switch(s){case 0:te.Error("XVP Operation Failed");break;case 1:this._rfbXvpVer=r,te.Info("XVP extensions enabled (version "+this._rfbXvpVer+")"),this._setCapability("power",!0);break;default:this._fail("Illegal server XVP message (msg: "+s+")");break}return!0}},{key:"_normalMsg",value:function(){var r;this._FBU.rects>0?r=0:r=this._sock.rQshift8();var s,n;switch(r){case 0:return n=this._framebufferUpdate(),n&&!this._enabledContinuousUpdates&&t.messages.fbUpdateRequest(this._sock,!0,0,0,this._fbWidth,this._fbHeight),n;case 1:return this._handleSetColourMapMsg();case 2:return te.Debug("Bell"),this.dispatchEvent(new CustomEvent("bell",{detail:{}})),!0;case 3:return this._handleServerCutText();case 150:return s=!this._supportsContinuousUpdates,this._supportsContinuousUpdates=!0,this._enabledContinuousUpdates=!1,s&&(this._enabledContinuousUpdates=!0,this._updateContinuousUpdates(),te.Info("Enabling continuous updates.")),!0;case 248:return this._handleServerFenceMsg();case 250:return this._handleXvpMsg();default:return this._fail("Unexpected server message (type "+r+")"),te.Debug("sock.rQpeekBytes(30): "+this._sock.rQpeekBytes(30)),!0}}},{key:"_framebufferUpdate",value:function(){var r=this;if(this._FBU.rects===0){if(this._sock.rQwait("FBU header",3,1))return!1;if(this._sock.rQskipBytes(1),this._FBU.rects=this._sock.rQshift16(),this._display.pending())return this._flushing=!0,this._display.flush().then(function(){r._flushing=!1,r._sock.rQwait("message",1)||r._handleMessage()}),!1}for(;this._FBU.rects>0;){if(this._FBU.encoding===null){if(this._sock.rQwait("rect header",12))return!1;this._FBU.x=this._sock.rQshift16(),this._FBU.y=this._sock.rQshift16(),this._FBU.width=this._sock.rQshift16(),this._FBU.height=this._sock.rQshift16(),this._FBU.encoding=this._sock.rQshift32(),this._FBU.encoding>>=0}if(!this._handleRect())return!1;this._FBU.rects--,this._FBU.encoding=null}return this._display.flip(),!0}},{key:"_handleRect",value:function(){switch(this._FBU.encoding){case le.encodings.pseudoEncodingLastRect:return this._FBU.rects=1,!0;case le.encodings.pseudoEncodingVMwareCursor:return this._handleVMwareCursor();case le.encodings.pseudoEncodingCursor:return this._handleCursor();case le.encodings.pseudoEncodingQEMUExtendedKeyEvent:return this._qemuExtKeyEventSupported=!0,!0;case le.encodings.pseudoEncodingDesktopName:return this._handleDesktopName();case le.encodings.pseudoEncodingDesktopSize:return this._resize(this._FBU.width,this._FBU.height),!0;case le.encodings.pseudoEncodingExtendedDesktopSize:return this._handleExtendedDesktopSize();case le.encodings.pseudoEncodingQEMULedEvent:return this._handleLedEvent();default:return this._handleDataRect()}}},{key:"_handleVMwareCursor",value:function(){var r=this._FBU.x,s=this._FBU.y,n=this._FBU.width,o=this._FBU.height;if(this._sock.rQwait("VMware cursor encoding",1))return!1;var a=this._sock.rQshift8();this._sock.rQshift8();var h,l=4;if(a==0){var c=-256;if(h=new Array(n*o*l),this._sock.rQwait("VMware cursor classic encoding",n*o*l*2,2))return!1;for(var u=new Array(n*o),p=0;p<n*o;p++)u[p]=this._sock.rQshift32();for(var g=new Array(n*o),v=0;v<n*o;v++)g[v]=this._sock.rQshift32();for(var m=0;m<n*o;m++)if(u[m]==0){var x=g[m],E=x>>8&255,R=x>>16&255,D=x>>24&255;h[m*l]=E,h[m*l+1]=R,h[m*l+2]=D,h[m*l+3]=255}else(u[m]&c)==c?g[m]==0?(h[m*l]=0,h[m*l+1]=0,h[m*l+2]=0,h[m*l+3]=0):((g[m]&c)==c,h[m*l]=0,h[m*l+1]=0,h[m*l+2]=0,h[m*l+3]=255):(h[m*l]=0,h[m*l+1]=0,h[m*l+2]=0,h[m*l+3]=255)}else if(a==1){if(this._sock.rQwait("VMware cursor alpha encoding",n*o*4,2))return!1;h=new Array(n*o*l);for(var b=0;b<n*o;b++){var L=this._sock.rQshift32();h[b*4]=L>>24&255,h[b*4+1]=L>>16&255,h[b*4+2]=L>>8&255,h[b*4+3]=L&255}}else return te.Warn("The given cursor type is not supported: "+a+" given."),!1;return this._updateCursor(h,r,s,n,o),!0}},{key:"_handleCursor",value:function(){var r=this._FBU.x,s=this._FBU.y,n=this._FBU.width,o=this._FBU.height,a=n*o*4,h=Math.ceil(n/8)*o,l=a+h;if(this._sock.rQwait("cursor encoding",l))return!1;for(var c=this._sock.rQshiftBytes(a),u=this._sock.rQshiftBytes(h),p=new Uint8Array(n*o*4),g=0,v=0;v<o;v++)for(var m=0;m<n;m++){var x=v*Math.ceil(n/8)+Math.floor(m/8),E=u[x]<<m%8&128?255:0;p[g]=c[g+2],p[g+1]=c[g+1],p[g+2]=c[g],p[g+3]=E,g+=4}return this._updateCursor(p,r,s,n,o),!0}},{key:"_handleDesktopName",value:function(){if(this._sock.rQwait("DesktopName",4))return!1;var r=this._sock.rQshift32();if(this._sock.rQwait("DesktopName",r,4))return!1;var s=this._sock.rQshiftStr(r);return s=(0,oi.decodeUTF8)(s,!0),this._setDesktopName(s),!0}},{key:"_handleLedEvent",value:function(){if(this._sock.rQwait("LED Status",1))return!1;var r=this._sock.rQshift8(),s=!!(r&2),n=!!(r&4);return this._remoteCapsLock=n,this._remoteNumLock=s,!0}},{key:"_handleExtendedDesktopSize",value:function(){if(this._sock.rQwait("ExtendedDesktopSize",4))return!1;var r=this._sock.rQpeek8(),s=4+r*16;if(this._sock.rQwait("ExtendedDesktopSize",s))return!1;var n=!this._supportsSetDesktopSize;this._supportsSetDesktopSize=!0,this._sock.rQskipBytes(1),this._sock.rQskipBytes(3);for(var o=0;o<r;o+=1)o===0?(this._screenID=this._sock.rQshift32(),this._sock.rQskipBytes(2),this._sock.rQskipBytes(2),this._sock.rQskipBytes(2),this._sock.rQskipBytes(2),this._screenFlags=this._sock.rQshift32()):this._sock.rQskipBytes(16);if(this._FBU.x===1&&this._FBU.y!==0){var a="";switch(this._FBU.y){case 1:a="Resize is administratively prohibited";break;case 2:a="Out of resources";break;case 3:a="Invalid screen layout";break;default:a="Unknown reason";break}te.Warn("Server did not accept the resize request: "+a)}else this._resize(this._FBU.width,this._FBU.height);return n&&this._requestRemoteResize(),!0}},{key:"_handleDataRect",value:function(){var r=this._decoders[this._FBU.encoding];if(!r)return this._fail("Unsupported encoding (encoding: "+this._FBU.encoding+")"),!1;try{return r.decodeRect(this._FBU.x,this._FBU.y,this._FBU.width,this._FBU.height,this._sock,this._display,this._fbDepth)}catch(s){return this._fail("Error decoding rect: "+s),!1}}},{key:"_updateContinuousUpdates",value:function(){this._enabledContinuousUpdates&&t.messages.enableContinuousUpdates(this._sock,!0,0,0,this._fbWidth,this._fbHeight)}},{key:"_resize",value:function(r,s){this._fbWidth=r,this._fbHeight=s,this._display.resize(this._fbWidth,this._fbHeight),this._updateClip(),this._updateScale(),this._updateContinuousUpdates(),this._saveExpectedClientSize()}},{key:"_xvpOp",value:function(r,s){this._rfbXvpVer<r||(te.Info("Sending XVP operation "+s+" (version "+r+")"),t.messages.xvpOp(this._sock,r,s))}},{key:"_updateCursor",value:function(r,s,n,o,a){this._cursorImage={rgbaPixels:r,hotx:s,hoty:n,w:o,h:a},this._refreshCursor()}},{key:"_shouldShowDotCursor",value:function(){if(!this._showDotCursor)return!1;for(var r=3;r<this._cursorImage.rgbaPixels.length;r+=4)if(this._cursorImage.rgbaPixels[r])return!1;return!0}},{key:"_refreshCursor",value:function(){if(!(this._rfbConnectionState!=="connecting"&&this._rfbConnectionState!=="connected")){var r=this._shouldShowDotCursor()?t.cursors.dot:this._cursorImage;this._cursor.change(r.rgbaPixels,r.hotx,r.hoty,r.w,r.h)}}}],[{key:"genDES",value:function(r,s){var n=r.split("").map(function(a){return a.charCodeAt(0)}),o=bt.default.importKey("raw",n,{name:"DES-ECB"},!1,["encrypt"]);return bt.default.encrypt({name:"DES-ECB"},o,s)}}])}(_C.default);li.messages={keyEvent:function(t,i,r){t.sQpush8(4),t.sQpush8(r),t.sQpush16(0),t.sQpush32(i),t.flush()},QEMUExtendedKeyEvent:function(t,i,r,s){function n(a){var h=s>>8,l=s&255;return h===224&&l<127?l|128:a}t.sQpush8(255),t.sQpush8(0),t.sQpush16(r),t.sQpush32(i);var o=n(s);t.sQpush32(o),t.flush()},pointerEvent:function(t,i,r,s){t.sQpush8(5),t.sQpush8(s),t.sQpush16(i),t.sQpush16(r),t.flush()},_buildExtendedClipboardFlags:function(t,i){for(var r=new Uint8Array(4),s=0,n=0,o=0;o<t.length;o++)n|=t[o];for(var a=0;a<i.length;a++)s|=i[a];return r[0]=n>>24,r[1]=0,r[2]=0,r[3]=s,r},extendedClipboardProvide:function(t,i,r){for(var s=new vC.default,n=[],o=0;o<i.length;o++){if(i[o]!=ai)throw new Error("Unsupported extended clipboard format for Provide message.");r[o]=r[o].replace(/\r\n|\r|\n/gm,`\r
`);var a=(0,oi.encodeUTF8)(r[o]+"\0");n.push(a.length>>24&255,a.length>>16&255,a.length>>8&255,a.length&255);for(var h=0;h<a.length;h++)n.push(a.charCodeAt(h))}var l=s.deflate(new Uint8Array(n)),c=new Uint8Array(4+l.length);c.set(li.messages._buildExtendedClipboardFlags([da],i)),c.set(l,4),li.messages.clientCutText(t,c,!0)},extendedClipboardNotify:function(t,i){var r=li.messages._buildExtendedClipboardFlags([mn],i);li.messages.clientCutText(t,r,!0)},extendedClipboardRequest:function(t,i){var r=li.messages._buildExtendedClipboardFlags([ua],i);li.messages.clientCutText(t,r,!0)},extendedClipboardCaps:function(t,i,r){var s=Object.keys(r),n=new Uint8Array(4+4*s.length);s.map(function(h){return parseInt(h)}),s.sort(function(h,l){return h-l}),n.set(li.messages._buildExtendedClipboardFlags(i,[]));for(var o=4,a=0;a<s.length;a++)n[o]=r[s[a]]>>24,n[o+1]=r[s[a]]>>16,n[o+2]=r[s[a]]>>8,n[o+3]=r[s[a]]>>0,o+=4,n[3]|=1<<s[a];li.messages.clientCutText(t,n,!0)},clientCutText:function(t,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;t.sQpush8(6),t.sQpush8(0),t.sQpush8(0),t.sQpush8(0);var s;r?s=(0,op.toUnsigned32bit)(-i.length):s=i.length,t.sQpush32(s),t.sQpushBytes(i),t.flush()},setDesktopSize:function(t,i,r,s,n){t.sQpush8(251),t.sQpush8(0),t.sQpush16(i),t.sQpush16(r),t.sQpush8(1),t.sQpush8(0),t.sQpush32(s),t.sQpush16(0),t.sQpush16(0),t.sQpush16(i),t.sQpush16(r),t.sQpush32(n),t.flush()},clientFence:function(t,i,r){t.sQpush8(248),t.sQpush8(0),t.sQpush8(0),t.sQpush8(0),t.sQpush32(i),t.sQpush8(r.length),t.sQpushString(r),t.flush()},enableContinuousUpdates:function(t,i,r,s,n,o){t.sQpush8(150),t.sQpush8(i),t.sQpush16(r),t.sQpush16(s),t.sQpush16(n),t.sQpush16(o),t.flush()},pixelFormat:function(t,i,r){var s;i>16?s=32:i>8?s=16:s=8;var n=Math.floor(i/3);t.sQpush8(0),t.sQpush8(0),t.sQpush8(0),t.sQpush8(0),t.sQpush8(s),t.sQpush8(i),t.sQpush8(0),t.sQpush8(r?1:0),t.sQpush16((1<<n)-1),t.sQpush16((1<<n)-1),t.sQpush16((1<<n)-1),t.sQpush8(n*0),t.sQpush8(n*1),t.sQpush8(n*2),t.sQpush8(0),t.sQpush8(0),t.sQpush8(0),t.flush()},clientEncodings:function(t,i){t.sQpush8(2),t.sQpush8(0),t.sQpush16(i.length);for(var r=0;r<i.length;r++)t.sQpush32(i[r]);t.flush()},fbUpdateRequest:function(t,i,r,s,n,o){typeof r>"u"&&(r=0),typeof s>"u"&&(s=0),t.sQpush8(3),t.sQpush8(i?1:0),t.sQpush16(r),t.sQpush16(s),t.sQpush16(n),t.sQpush16(o),t.flush()},xvpOp:function(t,i,r){t.sQpush8(250),t.sQpush8(0),t.sQpush8(i),t.sQpush8(r),t.flush()}};li.cursors={none:{rgbaPixels:new Uint8Array,w:0,h:0,hotx:0,hoty:0},dot:{rgbaPixels:new Uint8Array([255,255,255,255,0,0,0,255,255,255,255,255,0,0,0,255,0,0,0,0,0,0,0,255,255,255,255,255,0,0,0,255,255,255,255,255]),w:3,h:3,hotx:1,hoty:1}}});var bi={$schema:"https://acode.app/schema/plugin/v0.1.0.json",id:"bajrangcoder.acodex",name:"AcodeX - Terminal",main:"dist/main.js",version:"3.2.0",readme:"readme.md",icon:"icon.png",files:[],minVersionCode:290,license:"MIT",keywords:["terminal","acodex","termux"],changelogs:"ChangeLog.md",contributors:[],author:{name:"Raunak Raj",email:"bajrangcoders@gmail.com",url:"https://github.com/bajrangCoder/acode-plugin-acodex",github:"bajrangCoder"}};function zd(e){let i=window.getComputedStyle(e).backgroundColor.match(/\d+/g),r=Number.parseFloat(i[3])||1;return`rgba(${i[0]}, ${i[1]}, ${i[2]}, 0.5)`}function Wd(e){let t="";for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);(r>=32&&r<=126||r===13||r===8)&&(t+=e[i])}return t}function no(e){return e.startsWith("content://com.termux.documents/tree")?e.split("::")[1].substring(0,e.split("::")[1].lastIndexOf("/")).replace(/^\/data\/data\/com\.termux\/files\/home/,"$HOME"):e.startsWith("file:///storage/emulated/0/")?`/sdcard${e.substr(26).replace(/\.[^/.]+$/,"").split("/").slice(0,-1).join("/")}/`:e.startsWith("content://com.android.externalstorage.documents/tree/primary")?`/sdcard/${e.split("::primary:")[1].substring(0,e.split("::primary:")[1].lastIndexOf("/"))}`:!1}function $d(e,t){let i=e.replace("#",""),r=Number.parseInt(i.substring(0,2),16),s=Number.parseInt(i.substring(2,4),16),n=Number.parseInt(i.substring(4,6),16);return`rgba(${r}, ${s}, ${n}, ${t})`}var Ae={snazzy:{background:"#282A36",foreground:"#EFF0EB",cursor:"#EFF0EB",black:"#0C0D13",red:"#FF5C57",green:"#5AF78E",yellow:"#F3F99D",blue:"#57C7FF",magenta:"#FF6AC1",cyan:"#9AEDFE",white:"#EFF0EB",brightBlack:"#686868",brightRed:"#FF5C57",brightGreen:"#5AF78E",brightYellow:"#F3F99D",brightBlue:"#57C7FF",brightMagenta:"#FF6AC1",brightCyan:"#9AEDFE",brightWhite:"#EFF0EB"},xterm:{foreground:"#F8F8F8",background:"#2D2E2C",selectionBackground:"#5DA5D533",black:"#1E1E1D",brightBlack:"#262625",red:"#CE5C5C",brightRed:"#FF7272",green:"#5BCC5B",brightGreen:"#72FF72",yellow:"#CCCC5B",brightYellow:"#FFFF72",blue:"#5D5DD3",brightBlue:"#7279FF",magenta:"#BC5ED1",brightMagenta:"#E572FF",cyan:"#5DA5D5",brightCyan:"#72F0FF",white:"#F8F8F8",brightWhite:"#FFFFFF"},sapphire:{background:"#1c2431",foreground:"#cccccc",selectionBackground:"#399ef440",black:"#666666",blue:"#399ef4",brightBlack:"#666666",brightBlue:"#399ef4",brightCyan:"#21c5c7",brightGreen:"#4eb071",brightMagenta:"#b168df",brightRed:"#da6771",brightWhite:"#efefef",brightYellow:"#fff099",cyan:"#21c5c7",green:"#4eb071",magenta:"#b168df",red:"#da6771",white:"#efefef",yellow:"#fff099"},light:{background:"#ffffff",foreground:"#333333",cursor:"#333333",cursorAccent:"#ffffff",selectionBackground:"#add6ff",black:"#000000",blue:"#0451a5",brightBlack:"#666666",brightBlue:"#0451a5",brightCyan:"#0598bc",brightGreen:"#14ce14",brightMagenta:"#bc05bc",brightRed:"#cd3131",brightWhite:"#a5a5a5",brightYellow:"#b5ba00",cyan:"#0598bc",green:"#00bc00",magenta:"#bc05bc",red:"#cd3131",white:"#555555",yellow:"#949800"},custom:{background:"#1c2431",foreground:"#cccccc",cursor:"#ffffff",cursorAccent:"#fff",selectionBackground:"#399ef440",black:"#666666",blue:"#399ef4",brightBlack:"#666666",brightBlue:"#399ef4",brightCyan:"#21c5c7",brightGreen:"#4eb071",brightMagenta:"#b168df",brightRed:"#da6771",brightWhite:"#efefef",brightYellow:"#fff099",cyan:"#21c5c7",green:"#4eb071",magenta:"#b168df",red:"#da6771",white:"#efefef",yellow:"#fff099"},ayuDark:{background:"#090D13",foreground:"#FEFEFE",cursor:"#E96B72",black:"#00050D",red:"#E96B72",green:"#90B261",yellow:"#F8AE4E",blue:"#52BCF9",magenta:"#F9E893",cyan:"#8FE0C5",white:"#C6C6C6",brightBlack:"#676767",brightRed:"#EF7077",brightGreen:"#C1D84B",brightYellow:"#FEB353",brightBlue:"#58C1FE",brightMagenta:"#FEED98",brightCyan:"#94E5CA",brightWhite:"#FEFEFE"},catppuccin:{background:"#1e1e2e",foreground:"#cdd6f4",cursor:"#f5e0dc",cursorAccent:"#1e1e2e",selection:"#585b70",black:"#45475a",red:"#f38ba8",green:"#a6e3a1",yellow:"#f9e2af",blue:"#89b4fa",magenta:"#f5c2e7",cyan:"#94e2d5",white:"#bac2de",brightBlack:"#585b70",brightRed:"#f38ba8",brightGreen:"#a6e3a1",brightYellow:"#f9e2af",brightBlue:"#89b4fa",brightMagenta:"#f5c2e7",brightCyan:"#94e2d5",brightWhite:"#a6adc8"},wal:{background:"#181820",foreground:"#e5e7eb",cursor:"#6366f1",cursorAccent:"#181820",selection:"#374151",black:"#0f0f14",red:"#f87171",green:"#4ade80",yellow:"#fbbf24",blue:"#6366f1",magenta:"#a78bfa",cyan:"#22d3ee",white:"#e5e7eb",brightBlack:"#1f1f2a",brightRed:"#fca5a5",brightGreen:"#86efac",brightYellow:"#fcd34d",brightBlue:"#818cf8",brightMagenta:"#c4b5fd",brightCyan:"#67e8f9",brightWhite:"#f3f4f6"},oneDark:{background:"#1E2127",foreground:"#5C6370",cursor:"#5C6370",black:"#000000",red:"#E06C75",green:"#98C379",yellow:"#D19A66",blue:"#61AFEF",magenta:"#C678DD",cyan:"#56B6C2",white:"#ABB2BF",brightBlack:"#5C6370",brightRed:"#E06C75",brightGreen:"#98C379",brightYellow:"#D19A66",brightBlue:"#61AFEF",brightMagenta:"#C678DD",brightCyan:"#56B6C2",brightWhite:"#FFFEFE"},material:{background:"#1E282C",foreground:"#C3C7D1",cursor:"#657B83",black:"#073641",red:"#EB606B",green:"#C3E88D",yellow:"#F7EB95",blue:"#80CBC3",magenta:"#FF2490",cyan:"#AEDDFF",white:"#FFFFFF",brightBlack:"#002B36",brightRed:"#EB606B",brightGreen:"#C3E88D",brightYellow:"#F7EB95",brightBlue:"#7DC6BF",brightMagenta:"#6C71C3",brightCyan:"#34434D",brightWhite:"#FFFFFF"},nekonakoDjancoeg:{background:"#2a2c3a",foreground:"#eeeeee",cursor:"#fd6b85",black:"#2f343f",red:"#fd6b85",green:"#63e0be",yellow:"#fed270",blue:"#67d4f2",magenta:"#ff8167",cyan:"#63e0be",white:"#eeeeee",brightBlack:"#4f4f5b",brightRed:"#fd6b85",brightGreen:"#63e0be",brightYellow:"#fed270",brightBlue:"#67d4f2",brightMagenta:"#ff8167",brightCyan:"#63e0be",brightWhite:"#eeeeee"},dracula:{background:"#282a36",foreground:"#94A3A5",cursor:"#94A3A5",black:"#44475a",red:"#ff5555",green:"#50fa7b",yellow:"#ffb86c",blue:"#8be9fd",magenta:"#bd93f9",cyan:"#ff79c6",white:"#94A3A5",brightBlack:"#000000",brightRed:"#ff5555",brightGreen:"#50fa7b",brightYellow:"#ffb86c",brightBlue:"#8be9fd",brightMagenta:"#bd93f9",brightCyan:"#ff79c6",brightWhite:"#ffffff"},ayuMirage:{background:"#1F2430",foreground:"#E5E0CE",cursor:"#E96B72",black:"#00050D",red:"#E96B72",green:"#90B261",yellow:"#F8AE4E",blue:"#52BCF9",magenta:"#F9E893",cyan:"#8FE0C5",white:"#C6C6C6",brightBlack:"#676767",brightRed:"#EF7077",brightGreen:"#C1D84B",brightYellow:"#FEB353",brightBlue:"#58C1FE",brightMagenta:"#FEED98",brightCyan:"#94E5CA",brightWhite:"#FEFEFE"},siduckOneDark:{background:"#1e222a",foreground:"#c8ccd4",cursor:"#e06c75",black:"#1e222a",red:"#e06c75",green:"#98c379",yellow:"#e5c07b",blue:"#61afef",magenta:"#c678dd",cyan:"#56b6c2",white:"#D8DEE9",brightBlack:"#545862",brightRed:"#e06c75",brightGreen:"#98c379",brightYellow:"#e5c07b",brightBlue:"#61afef",brightMagenta:"#c678dd",brightCyan:"#56b6c2",brightWhite:"#c8ccd4"},elementary:{background:"#101010",foreground:"#f2f2f2",cursor:"#f2f2f2",black:"#303030",red:"#e1321a",green:"#6ab017",yellow:"#ffc005",blue:"#004f9e",magenta:"#ec0048",cyan:"#2aa7e7",white:"#f2f2f2",brightBlack:"#5d5d5d",brightRed:"#ff361e",brightGreen:"#7bc91f",brightYellow:"#ffd00a",brightBlue:"#0071ff",brightMagenta:"#ff1d62",brightCyan:"#4bb8fd",brightWhite:"#a020f0"},ayuLight:{background:"#FEFEFE",foreground:"#090D13",cursor:"#E96B72",black:"#00050D",red:"#E96B72",green:"#90B261",yellow:"#F8AE4E",blue:"#52BCF9",magenta:"#F9E893",cyan:"#8FE0C5",white:"#c6c6c694",brightBlack:"#676767",brightRed:"#EF7077",brightGreen:"#C1D84B",brightYellow:"#FEB353",brightBlue:"#58C1FE",brightMagenta:"#FEED98",brightCyan:"#94E5CA",brightWhite:"#dacaca"},everblush:{name:"Everblush",background:"#141b1e",foreground:"#dadada",cursor:"#3b4244",black:"#232a2d",red:"#e57474",green:"#8ccf7e",yellow:"#e5c76b",blue:"#67b0e8",magenta:"#c47fd5",cyan:"#6cbfbf",white:"#b3b9b8",brightBlack:"#2d3437",brightRed:"#ef7e7e",brightGreen:"#96d988",brightYellow:"#f4d67a",brightBlue:"#71baf2",brightMagenta:"#ce89df",brightCyan:"#67cbe7",brightWhite:"#bdc3c2"}};var tt=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof global<"u"&&global||{},ut={searchParams:"URLSearchParams"in tt,iterable:"Symbol"in tt&&"iterator"in Symbol,blob:"FileReader"in tt&&"Blob"in tt&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in tt,arrayBuffer:"ArrayBuffer"in tt};function lb(e){return e&&DataView.prototype.isPrototypeOf(e)}ut.arrayBuffer&&(Gd=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],qd=ArrayBuffer.isView||function(e){return e&&Gd.indexOf(Object.prototype.toString.call(e))>-1});var Gd,qd;function $r(e){if(typeof e!="string"&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||e==="")throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function Ml(e){return typeof e!="string"&&(e=String(e)),e}function Tl(e){var t={next:function(){var i=e.shift();return{done:i===void 0,value:i}}};return ut.iterable&&(t[Symbol.iterator]=function(){return t}),t}function Qe(e){this.map={},e instanceof Qe?e.forEach(function(t,i){this.append(i,t)},this):Array.isArray(e)?e.forEach(function(t){if(t.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+t.length);this.append(t[0],t[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}Qe.prototype.append=function(e,t){e=$r(e),t=Ml(t);var i=this.map[e];this.map[e]=i?i+", "+t:t};Qe.prototype.delete=function(e){delete this.map[$r(e)]};Qe.prototype.get=function(e){return e=$r(e),this.has(e)?this.map[e]:null};Qe.prototype.has=function(e){return this.map.hasOwnProperty($r(e))};Qe.prototype.set=function(e,t){this.map[$r(e)]=Ml(t)};Qe.prototype.forEach=function(e,t){for(var i in this.map)this.map.hasOwnProperty(i)&&e.call(t,this.map[i],i,this)};Qe.prototype.keys=function(){var e=[];return this.forEach(function(t,i){e.push(i)}),Tl(e)};Qe.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),Tl(e)};Qe.prototype.entries=function(){var e=[];return this.forEach(function(t,i){e.push([i,t])}),Tl(e)};ut.iterable&&(Qe.prototype[Symbol.iterator]=Qe.prototype.entries);function Il(e){if(!e._noBody){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}}function Vd(e){return new Promise(function(t,i){e.onload=function(){t(e.result)},e.onerror=function(){i(e.error)}})}function hb(e){var t=new FileReader,i=Vd(t);return t.readAsArrayBuffer(e),i}function cb(e){var t=new FileReader,i=Vd(t),r=/charset=([A-Za-z0-9_-]+)/.exec(e.type),s=r?r[1]:"utf-8";return t.readAsText(e,s),i}function ub(e){for(var t=new Uint8Array(e),i=new Array(t.length),r=0;r<t.length;r++)i[r]=String.fromCharCode(t[r]);return i.join("")}function jd(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function Yd(){return this.bodyUsed=!1,this._initBody=function(e){this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?typeof e=="string"?this._bodyText=e:ut.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:ut.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:ut.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():ut.arrayBuffer&&ut.blob&&lb(e)?(this._bodyArrayBuffer=jd(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):ut.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||qd(e))?this._bodyArrayBuffer=jd(e):this._bodyText=e=Object.prototype.toString.call(e):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof e=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):ut.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},ut.blob&&(this.blob=function(){var e=Il(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=Il(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(ut.blob)return this.blob().then(hb);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var e=Il(this);if(e)return e;if(this._bodyBlob)return cb(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(ub(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},ut.formData&&(this.formData=function(){return this.text().then(_b)}),this.json=function(){return this.text().then(JSON.parse)},this}var db=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function fb(e){var t=e.toUpperCase();return db.indexOf(t)>-1?t:e}function xr(e,t){if(!(this instanceof xr))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');t=t||{};var i=t.body;if(e instanceof xr){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new Qe(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,!i&&e._bodyInit!=null&&(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",(t.headers||!this.headers)&&(this.headers=new Qe(t.headers)),this.method=fb(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal||function(){if("AbortController"in tt){var n=new AbortController;return n.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&i)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(i),(this.method==="GET"||this.method==="HEAD")&&(t.cache==="no-store"||t.cache==="no-cache")){var r=/([?&])_=[^&]*/;if(r.test(this.url))this.url=this.url.replace(r,"$1_="+new Date().getTime());else{var s=/\?/;this.url+=(s.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}xr.prototype.clone=function(){return new xr(this,{body:this._bodyInit})};function _b(e){var t=new FormData;return e.trim().split("&").forEach(function(i){if(i){var r=i.split("="),s=r.shift().replace(/\+/g," "),n=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(s),decodeURIComponent(n))}}),t}function gb(e){var t=new Qe,i=e.replace(/\r?\n[\t ]+/g," ");return i.split("\r").map(function(r){return r.indexOf(`
`)===0?r.substr(1,r.length):r}).forEach(function(r){var s=r.split(":"),n=s.shift().trim();if(n){var o=s.join(":").trim();try{t.append(n,o)}catch(a){console.warn("Response "+a.message)}}}),t}Yd.call(xr.prototype);function Zt(e,t){if(!(this instanceof Zt))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(t||(t={}),this.type="default",this.status=t.status===void 0?200:t.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=t.statusText===void 0?"":""+t.statusText,this.headers=new Qe(t.headers),this.url=t.url||"",this._initBody(e)}Yd.call(Zt.prototype);Zt.prototype.clone=function(){return new Zt(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Qe(this.headers),url:this.url})};Zt.error=function(){var e=new Zt(null,{status:200,statusText:""});return e.ok=!1,e.status=0,e.type="error",e};var pb=[301,302,303,307,308];Zt.redirect=function(e,t){if(pb.indexOf(t)===-1)throw new RangeError("Invalid status code");return new Zt(null,{status:t,headers:{location:e}})};var Ar=tt.DOMException;try{new Ar}catch{Ar=function(t,i){this.message=t,this.name=i;var r=Error(t);this.stack=r.stack},Ar.prototype=Object.create(Error.prototype),Ar.prototype.constructor=Ar}function Jd(e,t){return new Promise(function(i,r){var s=new xr(e,t);if(s.signal&&s.signal.aborted)return r(new Ar("Aborted","AbortError"));var n=new XMLHttpRequest;function o(){n.abort()}n.onload=function(){var l={statusText:n.statusText,headers:gb(n.getAllResponseHeaders()||"")};s.url.indexOf("file://")===0&&(n.status<200||n.status>599)?l.status=200:l.status=n.status,l.url="responseURL"in n?n.responseURL:l.headers.get("X-Request-URL");var c="response"in n?n.response:n.responseText;setTimeout(function(){i(new Zt(c,l))},0)},n.onerror=function(){setTimeout(function(){r(new TypeError("Network request failed"))},0)},n.ontimeout=function(){setTimeout(function(){r(new TypeError("Network request timed out"))},0)},n.onabort=function(){setTimeout(function(){r(new Ar("Aborted","AbortError"))},0)};function a(l){try{return l===""&&tt.location.href?tt.location.href:l}catch{return l}}if(n.open(s.method,a(s.url),!0),s.credentials==="include"?n.withCredentials=!0:s.credentials==="omit"&&(n.withCredentials=!1),"responseType"in n&&(ut.blob?n.responseType="blob":ut.arrayBuffer&&(n.responseType="arraybuffer")),t&&typeof t.headers=="object"&&!(t.headers instanceof Qe||tt.Headers&&t.headers instanceof tt.Headers)){var h=[];Object.getOwnPropertyNames(t.headers).forEach(function(l){h.push($r(l)),n.setRequestHeader(l,Ml(t.headers[l]))}),s.headers.forEach(function(l,c){h.indexOf(c)===-1&&n.setRequestHeader(c,l)})}else s.headers.forEach(function(l,c){n.setRequestHeader(c,l)});s.signal&&(s.signal.addEventListener("abort",o),n.onreadystatechange=function(){n.readyState===4&&s.signal.removeEventListener("abort",o)}),n.send(typeof s._bodyInit>"u"?null:s._bodyInit)})}Jd.polyfill=!0;tt.fetch||(tt.fetch=Jd,tt.Headers=Qe,tt.Request=xr,tt.Response=Zt);var vb="0.5.13",ef="11434",tf=`http://127.0.0.1:${ef}`,mb=Object.defineProperty,yb=(e,t,i)=>t in e?mb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Rl=(e,t,i)=>(yb(e,typeof t!="symbol"?t+"":t,i),i),Pl=class e extends Error{constructor(t,i){super(t),this.error=t,this.status_code=i,this.name="ResponseError",Error.captureStackTrace&&Error.captureStackTrace(this,e)}},Ol=class{constructor(t,i,r){Rl(this,"abortController"),Rl(this,"itr"),Rl(this,"doneCallback"),this.abortController=t,this.itr=i,this.doneCallback=r}abort(){this.abortController.abort()}async*[Symbol.asyncIterator](){for await(let t of this.itr){if("error"in t)throw new Error(t.error);if(yield t,t.done||t.status==="success"){this.doneCallback();return}}throw new Error("Did not receive done or success response in stream.")}},Kl=async e=>{if(e.ok)return;let t=`Error ${e.status}: ${e.statusText}`,i=null;if(e.headers.get("content-type")?.includes("application/json"))try{i=await e.json(),t=i.error||t}catch{console.log("Failed to parse error response as JSON")}else try{console.log("Getting text from response"),t=await e.text()||t}catch{console.log("Failed to get text from error response")}throw new Pl(t,e.status)};function bb(){return typeof window<"u"&&window.navigator?`${window.navigator.platform.toLowerCase()} Browser/${navigator.userAgent};`:typeof process<"u"?`${process.arch} ${process.platform} Node.js/${process.version}`:""}var Nl=async(e,t,i={})=>{let r={"Content-Type":"application/json",Accept:"application/json","User-Agent":`ollama-js/${vb} (${bb()})`};i.headers||(i.headers={});let s=Object.fromEntries(Object.entries(i.headers).filter(([n])=>!Object.keys(r).some(o=>o.toLowerCase()===n.toLowerCase())));return i.headers={...r,...s},e(t,i)},Zd=async(e,t,i)=>{let r=await Nl(e,t,{headers:i?.headers});return await Kl(r),r},Gr=async(e,t,i,r)=>{let n=(a=>a!==null&&typeof a=="object"&&!Array.isArray(a))(i)?JSON.stringify(i):i,o=await Nl(e,t,{method:"POST",body:n,signal:r?.signal,headers:r?.headers});return await Kl(o),o},wb=async(e,t,i,r)=>{let s=await Nl(e,t,{method:"DELETE",body:JSON.stringify(i),headers:r?.headers});return await Kl(s),s},Ab=async function*(e){let t=new TextDecoder("utf-8"),i="",r=e.getReader();for(;;){let{done:s,value:n}=await r.read();if(s)break;i+=t.decode(n);let o=i.split(`
`);i=o.pop()??"";for(let a of o)try{yield JSON.parse(a)}catch{console.warn("invalid json: ",a)}}for(let s of i.split(`
`).filter(n=>n!==""))try{yield JSON.parse(s)}catch{console.warn("invalid json: ",s)}},xb=e=>{if(!e)return tf;let t=e.includes("://");e.startsWith(":")&&(e=`http://127.0.0.1${e}`,t=!0),t||(e=`http://${e}`);let i=new URL(e),r=i.port;r||(t?r=i.protocol==="https:"?"443":"80":r=ef);let s=`${i.protocol}//${i.hostname}:${r}${i.pathname}`;return s.endsWith("/")&&(s=s.slice(0,-1)),s},Sb=Object.defineProperty,Cb=(e,t,i)=>t in e?Sb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Fl=(e,t,i)=>(Cb(e,typeof t!="symbol"?t+"":t,i),i),Ql=class{constructor(t){Fl(this,"config"),Fl(this,"fetch"),Fl(this,"ongoingStreamedRequests",[]),this.config={host:"",headers:t?.headers},t?.proxy||(this.config.host=xb(t?.host??tf)),this.fetch=t?.fetch??fetch}abort(){for(let t of this.ongoingStreamedRequests)t.abort();this.ongoingStreamedRequests.length=0}async processStreamableRequest(t,i){i.stream=i.stream??!1;let r=`${this.config.host}/api/${t}`;if(i.stream){let n=new AbortController,o=await Gr(this.fetch,r,i,{signal:n.signal,headers:this.config.headers});if(!o.body)throw new Error("Missing body");let a=Ab(o.body),h=new Ol(n,a,()=>{let l=this.ongoingStreamedRequests.indexOf(h);l>-1&&this.ongoingStreamedRequests.splice(l,1)});return this.ongoingStreamedRequests.push(h),h}return await(await Gr(this.fetch,r,i,{headers:this.config.headers})).json()}async encodeImage(t){if(typeof t!="string"){let i=new Uint8Array(t),r="",s=i.byteLength;for(let n=0;n<s;n++)r+=String.fromCharCode(i[n]);return btoa(r)}return t}async generate(t){return t.images&&(t.images=await Promise.all(t.images.map(this.encodeImage.bind(this)))),this.processStreamableRequest("generate",t)}async chat(t){if(t.messages)for(let i of t.messages)i.images&&(i.images=await Promise.all(i.images.map(this.encodeImage.bind(this))));return this.processStreamableRequest("chat",t)}async create(t){return this.processStreamableRequest("create",{...t})}async pull(t){return this.processStreamableRequest("pull",{name:t.model,stream:t.stream,insecure:t.insecure})}async push(t){return this.processStreamableRequest("push",{name:t.model,stream:t.stream,insecure:t.insecure})}async delete(t){return await wb(this.fetch,`${this.config.host}/api/delete`,{name:t.model},{headers:this.config.headers}),{status:"success"}}async copy(t){return await Gr(this.fetch,`${this.config.host}/api/copy`,{...t},{headers:this.config.headers}),{status:"success"}}async list(){return await(await Zd(this.fetch,`${this.config.host}/api/tags`,{headers:this.config.headers})).json()}async show(t){return await(await Gr(this.fetch,`${this.config.host}/api/show`,{...t},{headers:this.config.headers})).json()}async embed(t){return await(await Gr(this.fetch,`${this.config.host}/api/embed`,{...t},{headers:this.config.headers})).json()}async embeddings(t){return await(await Gr(this.fetch,`${this.config.host}/api/embeddings`,{...t},{headers:this.config.headers})).json()}async ps(){return await(await Zd(this.fetch,`${this.config.host}/api/ps`,{headers:this.config.headers})).json()}},C8=new Ql;var Hl=class{constructor(t=null){if(this.apiKey=t,this.deepseekAPI="https://api.deepseek.com/v1/chat/completions",this.chatgptAPI="https://api.openai.com/v1/chat/completions",this.geminiAPI=`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-lite:generateContent?key=${this.apiKey}`,!t){let i=localStorage.getItem("Ollama-Host")||"http://localhost:11434";this.ollama=new Ql({host:i})}}getSystemPrompt(){return`You are a terminal command assistant designed to help users with command-line tasks. Only respond with the exact command(s) needed, with no explanations or markdown formatting. Examples:
    - 'Show current directory': pwd
    - 'List all files': ls -la
    - 'Create new folder docs': mkdir docs
    If a query is not related to terminal commands, do not respond. Multiple commands should be separated by semicolons. Keep responses minimal and focused only on valid terminal commands.`}async generateDeepseekResponse(t){let i={model:"deepseek-chat",messages:[{role:"system",content:this.getSystemPrompt()},{role:"user",content:t}]};return this._fetchAndProcessResponse(this.deepseekAPI,i,this.apiKey)}async generateChatgptResponse(t){let i={model:"gpt-3.5-turbo-0125",messages:[{role:"system",content:this.getSystemPrompt()},{role:"user",content:t}]};return this._fetchAndProcessResponse(this.chatgptAPI,i,this.apiKey)}async generateGeminiResponse(t){let r={contents:[{parts:[{text:`${this.getSystemPrompt()} My query: ${t}`}]}]};return this._fetchAndProcessResponse(this.geminiAPI,r,null)}async getListOfOllamaModels(){try{return(await this.ollama.list()).models.map(r=>r.model)}catch(t){return t}}async generateOllamaResponse(t,i){try{return await this.ollama.generate({model:t,system:this.getSystemPrompt(),prompt:i})}catch(r){return r}}async _fetchAndProcessResponse(t,i,r){try{let s={"Content-Type":"application/json"};r&&(s.Authorization=`Bearer ${r}`);let n=await fetch(t,{method:"POST",headers:s,body:JSON.stringify(i)}),o=await n.json();if(n.ok)return{response:o};throw new Error(o.detail?o.detail:o.error.message||"Failed to fetch response")}catch(s){return{error:s.message}}}},rf=Hl;var Ms=class{constructor(t,i,r={},s={}){this.terminal=t,this.terminalContainer=i,this.settings=r,this.options={tapHoldDuration:600,moveThreshold:8,handleSize:24,fingerOffset:40,hapticFeedback:!!r?.selectionHaptics,showContextMenu:!0,zoomThrottle:50,minFontSize:8,maxFontSize:48,onFontSizeChange:null,...s},this.options.minFontSize=Number(this.options.minFontSize)||8,this.options.maxFontSize=Number(this.options.maxFontSize)||48,this.options.minFontSize>this.options.maxFontSize&&([this.options.minFontSize,this.options.maxFontSize]=[this.options.maxFontSize,this.options.minFontSize]),typeof this.options.onFontSizeChange!="function"&&(this.options.onFontSizeChange=n=>{this.terminal.options.fontSize=n,this.terminal.refresh?.(0,this.terminal.rows-1)}),this.isSelecting=!1,this.isHandleDragging=!1,this.selectionStart=null,this.selectionEnd=null,this.currentSelection=null,this.dragHandle=null,this.touchStartTime=0,this.touchStartPos={x:0,y:0},this.initialTouchPos={x:0,y:0},this.tapHoldTimeout=null,this.isPinching=!1,this.pinchStartDistance=0,this.lastPinchDistance=0,this.initialFontSize=0,this.lastZoomTime=0,this.selectionOverlay=null,this.startHandle=null,this.endHandle=null,this.contextMenu=null,this.contextMenuShouldStayVisible=!1,this.cellDimensions={width:0,height:0},this.boundHandlers={},this.wasFocusedBeforeSelection=!1,this.selectionProtected=!1,this.protectionTimeout=null,this.selectionChangeDisposable=null,this.resizeDisposable=null,this.init()}init(){this.createSelectionOverlay(),this.createHandles(),this.attachEventListeners(),this.updateCellDimensions()}createSelectionOverlay(){this.selectionOverlay=document.createElement("div"),this.selectionOverlay.className="terminal-selection-overlay",this.selectionOverlay.style.pointerEvents="none",this.terminalContainer.appendChild(this.selectionOverlay)}createHandles(){this.startHandle=this.createHandle("start"),this.endHandle=this.createHandle("end"),this.selectionOverlay.appendChild(this.startHandle),this.selectionOverlay.appendChild(this.endHandle)}createHandle(t){let i=document.createElement("div");return i.className=`terminal-selection-handle terminal-selection-handle-${t}`,i.style.width=`${this.options.handleSize}px`,i.style.height=`${this.options.handleSize}px`,i.style.display="none",i.dataset.handleType=t,i}attachEventListeners(){this.boundHandlers.terminalTouchStart=this.onTerminalTouchStart.bind(this),this.boundHandlers.terminalTouchMove=this.onTerminalTouchMove.bind(this),this.boundHandlers.terminalTouchEnd=this.onTerminalTouchEnd.bind(this),this.boundHandlers.selectionChange=this.onSelectionChange.bind(this),this.boundHandlers.terminalAreaTouchStart=this.onTerminalAreaTouchStart.bind(this),this.boundHandlers.handleTouchStart=this.onHandleTouchStart.bind(this),this.boundHandlers.handleTouchMove=this.onHandleTouchMove.bind(this),this.boundHandlers.handleTouchEnd=this.onHandleTouchEnd.bind(this),this.boundHandlers.orientationChange=this.onOrientationChange.bind(this),this.boundHandlers.terminalScroll=this.onTerminalScroll.bind(this),this.boundHandlers.terminalResize=this.onTerminalResize.bind(this),this.boundHandlers.documentTouchStart=this.onDocumentTouchStart.bind(this),this.terminal.element.addEventListener("touchstart",this.boundHandlers.terminalTouchStart,{passive:!1}),this.terminal.element.addEventListener("touchmove",this.boundHandlers.terminalTouchMove,{passive:!1}),this.terminal.element.addEventListener("touchend",this.boundHandlers.terminalTouchEnd,{passive:!1}),this.terminal.element.addEventListener("touchstart",this.boundHandlers.terminalAreaTouchStart,{passive:!1}),this.terminal.element.addEventListener("scroll",this.boundHandlers.terminalScroll,{passive:!0}),this.startHandle.addEventListener("touchstart",this.boundHandlers.handleTouchStart,{passive:!1}),this.startHandle.addEventListener("touchmove",this.boundHandlers.handleTouchMove,{passive:!1}),this.startHandle.addEventListener("touchend",this.boundHandlers.handleTouchEnd,{passive:!1}),this.endHandle.addEventListener("touchstart",this.boundHandlers.handleTouchStart,{passive:!1}),this.endHandle.addEventListener("touchmove",this.boundHandlers.handleTouchMove,{passive:!1}),this.endHandle.addEventListener("touchend",this.boundHandlers.handleTouchEnd,{passive:!1}),this.selectionChangeDisposable=this.terminal.onSelectionChange?this.terminal.onSelectionChange(this.boundHandlers.selectionChange):null,this.resizeDisposable=this.terminal.onResize?this.terminal.onResize(this.boundHandlers.terminalResize):null,window.addEventListener("orientationchange",this.boundHandlers.orientationChange),window.addEventListener("resize",this.boundHandlers.orientationChange),document.addEventListener("touchstart",this.boundHandlers.documentTouchStart,{passive:!0})}onTerminalTouchStart(t){if(t.touches.length===2){t.preventDefault(),this.startPinchZoom(t);return}if(t.touches.length!==1)return;let i=t.touches[0];this.touchStartTime=Date.now(),this.touchStartPos={x:i.clientX,y:i.clientY},this.initialTouchPos={x:i.clientX,y:i.clientY},!this.isSelecting&&(this.isEdgeGesture(i)||(this.tapHoldTimeout&&clearTimeout(this.tapHoldTimeout),this.tapHoldTimeout=setTimeout(()=>{!this.isSelecting&&!this.isPinching&&this.startSelection(i)},this.options.tapHoldDuration)))}onTerminalTouchMove(t){if(t.touches.length===2){t.preventDefault(),this.handlePinchZoom(t);return}if(t.touches.length!==1||this.isPinching)return;let i=t.touches[0],r=Math.abs(i.clientX-this.touchStartPos.x),s=Math.abs(i.clientY-this.touchStartPos.y),n=i.clientX-this.touchStartPos.x;if(this.isEdgeGesture(this.initialTouchPos)&&Math.abs(n)>s&&r>this.options.moveThreshold){this.tapHoldTimeout&&(clearTimeout(this.tapHoldTimeout),this.tapHoldTimeout=null);return}(r>this.options.moveThreshold||s>this.options.moveThreshold)&&(this.tapHoldTimeout&&(clearTimeout(this.tapHoldTimeout),this.tapHoldTimeout=null),this.isSelecting&&!this.isHandleDragging&&(t.preventDefault(),this.extendSelection(i)))}onTerminalTouchEnd(){if(this.isPinching){this.endPinchZoom();return}this.tapHoldTimeout&&(clearTimeout(this.tapHoldTimeout),this.tapHoldTimeout=null),this.isSelecting&&!this.isHandleDragging?this.finalizeSelection():this.isSelecting||this.isTerminalFocused()&&this.terminal.focus()}onHandleTouchStart(t){if(t.preventDefault(),t.stopPropagation(),t.touches.length!==1)return;let i=t.target.dataset.handleType;if(i||(t.target===this.startHandle||this.startHandle.contains(t.target)?i="start":(t.target===this.endHandle||this.endHandle.contains(t.target))&&(i="end")),!i)return;this.isHandleDragging=!0,this.dragHandle=i;let r=t.touches[0];this.initialTouchPos={x:r.clientX,y:r.clientY};let s=i==="start"?this.startHandle:this.endHandle;s.style.cursor="grabbing",s.style.setProperty("--handle-scale","1.2")}onHandleTouchMove(t){if(!this.isHandleDragging||t.touches.length!==1)return;t.preventDefault(),t.stopPropagation();let i=t.touches[0],r=Math.abs(i.clientX-this.initialTouchPos.x),s=Math.abs(i.clientY-this.initialTouchPos.y);if(r<this.options.moveThreshold&&s<this.options.moveThreshold)return;let n={clientX:i.clientX,clientY:i.clientY-this.options.fingerOffset},o=this.touchToTerminalCoords(n);if(o){if(this.dragHandle==="start"){if(this.selectionStart=o,this.selectionEnd&&(o.row>this.selectionEnd.row||o.row===this.selectionEnd.row&&o.col>this.selectionEnd.col)){let a=this.selectionStart;this.selectionStart=this.selectionEnd,this.selectionEnd=a,this.dragHandle="end"}}else if(this.selectionEnd=o,this.selectionStart&&(o.row<this.selectionStart.row||o.row===this.selectionStart.row&&o.col<this.selectionStart.col)){let a=this.selectionEnd;this.selectionEnd=this.selectionStart,this.selectionStart=a,this.dragHandle="start"}this.updateSelection()}}onHandleTouchEnd(t){this.isHandleDragging&&(t.preventDefault(),t.stopPropagation(),this.isHandleDragging=!1,this.dragHandle=null,[this.startHandle,this.endHandle].forEach(i=>{i.style.cursor="grab",i.style.removeProperty("--handle-scale")}),this.finalizeSelection())}onSelectionChange(){if(!this.isSelecting)return;let t=this.terminal.getSelection?.();t&&t.length>0&&(this.currentSelection=t,this.updateHandlePositions())}onTerminalAreaTouchStart(t){if(!this.isSelecting||this.selectionProtected)return;if(this.contextMenu&&this.contextMenu.style.display==="flex"){let r=this.contextMenu.getBoundingClientRect(),s=t.touches[0];if(s.clientX>=r.left&&s.clientX<=r.right&&s.clientY>=r.top&&s.clientY<=r.bottom)return}!(this.startHandle.contains(t.target)||this.endHandle.contains(t.target))&&this.terminal.element.contains(t.target)&&this.clearSelection()}onDocumentTouchStart(t){this.isSelecting&&t.target&&(this.terminalContainer.contains(t.target)||this.forceClearSelection())}onOrientationChange(){setTimeout(()=>{this.updateCellDimensions(),this.isSelecting&&this.updateHandlePositions()},100)}onTerminalScroll(){this.isSelecting&&(this.updateHandlePositions(),this.contextMenu&&this.contextMenu.style.display==="flex"&&this.hideContextMenu())}onTerminalResize(t){setTimeout(()=>{if(this.updateCellDimensions(),!!this.isSelecting){if(this.selectionProtected){this.updateHandlePositions();return}if(this.selectionStart&&this.selectionEnd&&(this.selectionStart.row>=t.rows||this.selectionEnd.row>=t.rows)){this.clearSelection();return}this.updateHandlePositions(),this.contextMenu&&this.contextMenu.style.display==="flex"&&(this.hideContextMenu(),setTimeout(()=>{this.isSelecting&&this.options.showContextMenu&&this.showContextMenu()},100))}},50)}startSelection(t){let i=this.touchToTerminalCoords(t);if(!i)return;this.wasFocusedBeforeSelection=this.isTerminalFocused(),this.selectionProtected=!0,this.protectionTimeout&&clearTimeout(this.protectionTimeout),this.protectionTimeout=setTimeout(()=>{this.selectionProtected=!1},1e3),this.isSelecting=!0;let r=this.getWordBoundsAt(i);r?(this.selectionStart=r.start,this.selectionEnd=r.end):(this.selectionStart=i,this.selectionEnd=i),this.terminal.clearSelection?.(),this.updateSelection(),this.currentSelection=this.terminal.getSelection?.(),this.showHandles(),this.options.showContextMenu&&this.showContextMenu(),this.options.hapticFeedback&&navigator?.vibrate&&navigator.vibrate(50)}extendSelection(t){let i=this.touchToTerminalCoords(t);i&&(this.selectionEnd=i,this.updateSelection())}updateSelection(){if(!this.selectionStart||!this.selectionEnd)return;let t=this.selectionStart,i=this.selectionEnd,r=t.row,s=t.col,n=i.row,o=i.col;(r>n||r===n&&s>o)&&([r,s,n,o]=[n,o,r,s]);let a=this.calculateSelectionLength(r,s,n,o);this.terminal.clearSelection?.(),this.terminal.select?.(s,r,a),this.updateHandlePositions(),this.contextMenuShouldStayVisible&&this.options.showContextMenu&&this.showContextMenu()}calculateSelectionLength(t,i,r,s){if(t===r)return s-i+1;let n=this.terminal.cols,o=n-i;return o+=(r-t-1)*n,o+=s+1,o}finalizeSelection(){this.options.showContextMenu&&this.currentSelection&&this.showContextMenu()}showHandles(){this.startHandle.style.display="block",this.endHandle.style.display="block",this.updateHandlePositions()}hideHandles(){this.startHandle.style.display="none",this.endHandle.style.display="none"}updateHandlePositions(){if(!this.selectionStart||!this.selectionEnd)return;let t=this.selectionStart,i=this.selectionEnd;(this.selectionStart.row>this.selectionEnd.row||this.selectionStart.row===this.selectionEnd.row&&this.selectionStart.col>this.selectionEnd.col)&&(t=this.selectionEnd,i=this.selectionStart);let r=this.terminalCoordsToPixels(t),s=this.terminalCoordsToPixels(i);r?(this.startHandle.style.display="block",this.startHandle.style.left=`${r.x}px`,this.startHandle.style.top=`${r.y+this.cellDimensions.height+4}px`):this.startHandle.style.display="none",s?(this.endHandle.style.display="block",this.endHandle.style.left=`${s.x+this.cellDimensions.width}px`,this.endHandle.style.top=`${s.y+this.cellDimensions.height+4}px`):this.endHandle.style.display="none"}showContextMenu(){if(!this.options.showContextMenu)return;this.contextMenu||this.createContextMenu(),this.contextMenuShouldStayVisible=!0;let t=this.terminalCoordsToPixels(this.selectionStart),i=this.terminalCoordsToPixels(this.selectionEnd);if(!t&&!i)return;let r,s;t&&i?(r=(t.x+i.x)/2,s=Math.max(t.y,i.y)):t?(r=t.x,s=t.y):(r=i.x,s=i.y);let n=this.contextMenu.offsetWidth||200,o=this.contextMenu.offsetHeight||50,a=this.terminalContainer.getBoundingClientRect(),h=r-n/2,l=s+this.cellDimensions.height+40,c=10,u=a.width-n-10;h=Math.max(c,Math.min(h,u));let p=a.height-o-10;l>p&&(l=(t&&i?Math.min(t.y,i.y):s)-o-10),l=Math.max(10,Math.min(l,p)),this.contextMenu.style.left=`${h}px`,this.contextMenu.style.top=`${l}px`,this.contextMenu.style.display="flex"}createContextMenu(){this.contextMenu=document.createElement("div"),this.contextMenu.className="terminal-context-menu",[{label:this.getString("copy","Copy"),action:this.copySelection.bind(this)},{label:this.getString("paste","Paste"),action:this.pasteFromClipboard.bind(this)},{label:this.getString("more","More..."),action:this.showMoreOptions.bind(this)}].forEach(i=>{let r=document.createElement("button");r.textContent=i.label;let s=!1,n=o=>{o.preventDefault(),o.stopPropagation(),s||(s=!0,i.action())};r.addEventListener("touchstart",o=>{o.preventDefault(),o.stopPropagation(),s=!1}),r.addEventListener("touchend",n),r.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation(),s=!1}),r.addEventListener("mouseup",n),r.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation()}),this.contextMenu.appendChild(r)}),this.selectionOverlay.appendChild(this.contextMenu)}hideContextMenu(){this.contextMenu&&!this.contextMenuShouldStayVisible&&(this.contextMenu.style.display="none")}forceHideContextMenu(){this.contextMenu&&(this.contextMenu.style.display="none",this.contextMenuShouldStayVisible=!1)}copySelection(){let t=this.currentSelection||this.terminal.getSelection?.();t&&cordova?.plugins?.clipboard&&cordova.plugins.clipboard.copy(t),this.forceClearSelection()}pasteFromClipboard(){cordova?.plugins?.clipboard&&cordova.plugins.clipboard.paste(t=>{t&&this.terminal.paste?.(t),this.forceClearSelection()})}showMoreOptions(){window.toast?.("More options are not implemented yet."),this.forceClearSelection()}clearSelection(){if(this.selectionProtected)return;let t=this.wasFocusedBeforeSelection&&this.isSelecting;this.isSelecting=!1,this.isHandleDragging=!1,this.selectionStart=null,this.selectionEnd=null,this.currentSelection=null,this.dragHandle=null,this.terminal.clearSelection?.(),this.hideHandles(),this.forceHideContextMenu(),this.tapHoldTimeout&&(clearTimeout(this.tapHoldTimeout),this.tapHoldTimeout=null),this.protectionTimeout&&(clearTimeout(this.protectionTimeout),this.protectionTimeout=null),this.selectionProtected=!1,t&&!this.isTerminalFocused()&&setTimeout(()=>{this.isSelecting||this.terminal.focus?.()},150),this.wasFocusedBeforeSelection=!1}forceClearSelection(){let t=this.selectionProtected;this.selectionProtected=!1,this.clearSelection(),this.selectionProtected=t&&this.isSelecting}touchToTerminalCoords(t){let i=this.terminal.element.getBoundingClientRect(),r=t.clientX-i.left,s=t.clientY-i.top;if(r<0||s<0||r>i.width||s>i.height||((!this.cellDimensions.width||!this.cellDimensions.height)&&this.updateCellDimensions(),!this.cellDimensions.width||!this.cellDimensions.height))return null;let n=Math.floor(r/this.cellDimensions.width),o=Math.floor(s/this.cellDimensions.height)+this.terminal.buffer.active.viewportY;return{col:Math.max(0,Math.min(n,this.terminal.cols-1)),row:Math.max(0,o)}}terminalCoordsToPixels(t){if(!t)return null;(!this.cellDimensions.width||!this.cellDimensions.height)&&this.updateCellDimensions();let i=this.terminal.element.getBoundingClientRect(),r=this.terminalContainer.getBoundingClientRect(),s=t.col*this.cellDimensions.width+(i.left-r.left),n=(t.row-this.terminal.buffer.active.viewportY)*this.cellDimensions.height+(i.top-r.top);return t.row>=this.terminal.buffer.active.viewportY&&t.row<this.terminal.buffer.active.viewportY+this.terminal.rows?{x:s,y:n}:null}updateCellDimensions(){let t=this.terminal?._core?._renderService?.dimensions;if(t?.css?.cell){this.cellDimensions={width:t.css.cell.width,height:t.css.cell.height};return}let i=this.terminal.element.getBoundingClientRect(),r=this.terminal.cols||1,s=this.terminal.rows||1;this.cellDimensions={width:i.width/r,height:i.height/s}}isTerminalFocused(){try{return document.activeElement===this.terminal.element||this.terminal.element.contains(document.activeElement)||this.terminal._core?._hasFocus}catch{return!1}}getWordBoundsAt(t){try{let r=this.terminal.buffer.active.getLine(t.row);if(!r)return null;let s=r.translateToString(!1);if(!s||t.col>=s.length)return null;let n=s[t.col];if(!this.isWordCharacter(n))return null;let o=t.col;for(;o>0&&this.isWordCharacter(s[o-1]);)o--;let a=t.col;for(;a<s.length-1&&this.isWordCharacter(s[a+1]);)a++;return a>=o?{start:{row:t.row,col:o},end:{row:t.row,col:a}}:null}catch(i){return console.warn("Error finding word bounds:",i),null}}isWordCharacter(t){return t?/[a-zA-Z0-9_\-.]/.test(t):!1}startPinchZoom(t){if(t.touches.length!==2)return;this.isPinching=!0,this.initialFontSize=this.terminal.options.fontSize;let i=t.touches[0],r=t.touches[1];this.pinchStartDistance=this.getDistance(i,r),this.lastPinchDistance=this.pinchStartDistance,this.tapHoldTimeout&&(clearTimeout(this.tapHoldTimeout),this.tapHoldTimeout=null)}handlePinchZoom(t){if(!this.isPinching||t.touches.length!==2)return;let i=Date.now();if(i-this.lastZoomTime<this.options.zoomThrottle)return;this.lastZoomTime=i;let r=t.touches[0],s=t.touches[1],o=this.getDistance(r,s)/this.pinchStartDistance,a=Math.round(this.initialFontSize*o),h=this.options.minFontSize,l=this.options.maxFontSize,c=Math.max(h,Math.min(l,a));c!==this.terminal.options.fontSize&&typeof this.options.onFontSizeChange=="function"&&this.options.onFontSizeChange(c)}endPinchZoom(){this.isPinching=!1,this.pinchStartDistance=0,this.lastPinchDistance=0,this.initialFontSize=0}getDistance(t,i){let r=i.clientX-t.clientX,s=i.clientY-t.clientY;return Math.hypot(r,s)}isEdgeGesture(t){let r=window.innerWidth;return t.clientX<=30||t.clientX>=r-30}getString(t,i){try{if(typeof window<"u"&&window?.strings?.[t])return window.strings[t]}catch{}return i}updateHandles(){this.updateHandlePositions()}destroy(){if(this.forceClearSelection(),this.terminal.element.removeEventListener("touchstart",this.boundHandlers.terminalTouchStart),this.terminal.element.removeEventListener("touchmove",this.boundHandlers.terminalTouchMove),this.terminal.element.removeEventListener("touchend",this.boundHandlers.terminalTouchEnd),this.terminal.element.removeEventListener("touchstart",this.boundHandlers.terminalAreaTouchStart),this.terminal.element.removeEventListener("scroll",this.boundHandlers.terminalScroll),this.startHandle.removeEventListener("touchstart",this.boundHandlers.handleTouchStart),this.startHandle.removeEventListener("touchmove",this.boundHandlers.handleTouchMove),this.startHandle.removeEventListener("touchend",this.boundHandlers.handleTouchEnd),this.endHandle.removeEventListener("touchstart",this.boundHandlers.handleTouchStart),this.endHandle.removeEventListener("touchmove",this.boundHandlers.handleTouchMove),this.endHandle.removeEventListener("touchend",this.boundHandlers.handleTouchEnd),window.removeEventListener("orientationchange",this.boundHandlers.orientationChange),window.removeEventListener("resize",this.boundHandlers.orientationChange),document.removeEventListener("touchstart",this.boundHandlers.documentTouchStart),this.selectionChangeDisposable?.dispose)this.selectionChangeDisposable.dispose();else if(this.terminal.onSelectionChange)try{this.terminal.onSelectionChange(null)}catch(t){console.warn("Could not remove selection change listener",t)}this.resizeDisposable?.dispose&&this.resizeDisposable.dispose(),this.selectionOverlay?.parentNode&&this.selectionOverlay.parentNode.removeChild(this.selectionOverlay)}};var kb={terminal:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 17 10 11 4 5"/><line x1="12" x2="20" y1="19" y2="19"/></svg>',findNext:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>',findPrevious:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>',close:'<svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" height="1.5em" width="1.5em"><path fill="currentColor" d="M24 26.1 13.5 36.6q-.45.45-1.05.45-.6 0-1.05-.45-.45-.45-.45-1.05 0-.6.45-1.05L21.9 24 11.4 13.5q-.45-.45-.45-1.05 0-.6.45-1.05.45-.45 1.05-.45.6 0 1.05.45L24 21.9l10.5-10.5q.45-.45 1.05-.45.6 0 1.05.45.45.45.45 1.05 0 .6-.45 1.05L26.1 24l10.5 10.5q.45.45.45 1.05 0 .6-.45 1.05-.45.45-1.05.45-.6 0-1.05-.45Z"/></svg>',minimise:'<svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" height="1.5em" width="1.5em"><path fill="currentColor" d="M24 24.75q-.3 0-.55-.1-.25-.1-.5-.35l-9.9-9.9q-.45-.45-.45-1.05 0-.6.45-1.05.45-.45 1.05-.45.6 0 1.05.45L24 21.15l8.85-8.85q.45-.45 1.05-.45.6 0 1.05.45.45.45.45 1.05 0 .6-.45 1.05l-9.9 9.9q-.25.25-.5.35-.25.1-.55.1Zm0 12.65q-.3 0-.55-.1-.25-.1-.5-.35l-9.9-9.9q-.45-.45-.45-1.05 0-.6.45-1.05.45-.45 1.05-.45.6 0 1.05.45L24 33.8l8.85-8.85q.45-.45 1.05-.45.6 0 1.05.45.45.45.45 1.05 0 .6-.45 1.05l-9.9 9.9q-.25.25-.5.35-.25.1-.55.1Z"/></svg>',folder:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M1 3.5A1.5 1.5 0 0 1 2.5 2h2.764c.958 0 1.76.56 2.311 1.184C7.985 3.648 8.48 4 9 4h4.5A1.5 1.5 0 0 1 15 5.5v.64c.57.265.94.876.856 1.546l-.64 5.124A2.5 2.5 0 0 1 12.733 15H3.266a2.5 2.5 0 0 1-2.481-2.19l-.64-5.124A1.5 1.5 0 0 1 1 6.14V3.5zM2 6h12v-.5a.5.5 0 0 0-.5-.5H9c-.964 0-1.71-.629-2.174-1.154C6.374 3.334 5.82 3 5.264 3H2.5a.5.5 0 0 0-.5.5V6zm-.367 1a.5.5 0 0 0-.496.562l.64 5.124A1.5 1.5 0 0 0 3.266 14h9.468a1.5 1.5 0 0 0 1.489-1.314l.64-5.124A.5.5 0 0 0 14.367 7H1.633z"/></svg>',search:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m13 13.5 2-2.5-2-2.5"/><path d="m21 21-4.3-4.3"/><path d="M9 8.5 7 11l2 2.5"/><circle cx="11" cy="11" r="8"/></svg>',plus:'<svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" height="1.5em" width="1.5em"><path fill="currentColor" d="M24 38q-.65 0-1.075-.425-.425-.425-.425-1.075v-11h-11q-.65 0-1.075-.425Q10 24.65 10 24q0-.65.425-1.075.425-.425 1.075-.425h11v-11q0-.65.425-1.075Q23.35 10 24 10q.65 0 1.075.425.425.425.425 1.075v11h11q.65 0 1.075.425Q38 23.35 38 24q0 .65-.425 1.075-.425.425-1.075.425h-11v11q0 .65-.425 1.075Q24.65 38 24 38Z"/></svg>',imagePlay:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m11 16-5 5"/><path d="M11 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v6.5"/><path d="M15.765 22a.5.5 0 0 1-.765-.424V13.38a.5.5 0 0 1 .765-.424l5.878 3.674a1 1 0 0 1 0 1.696z"/><circle cx="9" cy="9" r="2"/></svg>'},ei=kb;acode.addIcon("deepseek","https://raw.githubusercontent.com/deepseek-ai/DeepSeek-Coder/main/pictures/home.png");acode.addIcon("chatgpt","https://upload.wikimedia.org/wikipedia/commons/0/04/ChatGPT_logo.svg");acode.addIcon("gemini","https://upload.wikimedia.org/wikipedia/commons/4/45/Gemini_language_model_logo.png");var sf=!1,nf=!1,of=!1,af=!0,lf=!0,hf=!0,Xl=["block","underline","bar"],Ul=["outline","block","bar","underline","none"],zl=11,cf="MesloLGS NF Regular",Wl=["normal","bold","100","200","300","400","500","600","700","800","900"],uf=1e3,df=1e3,$l=0,ff=35,_f=!0,Ce="catppuccin",Gl=["ayuDark","ayuLight","ayuMirage","catppuccin","dracula","elementary","everblush","light","material","nekonakoDjancoeg","oneDark","sapphire","siduckOneDark","snazzy","xterm","wal","custom"],gf="deepseek",jl=[["deepseek","Deepseek","deepseek",!0],["chatgpt","ChatGPT","chatgpt",!0],["gemini-pro","Gemini Flash Lite","gemini",!0],["local-llm","Local LLM(ollama)","icon phone_android",!0]];var jy=Dl(cp()),qy=Dl(ss()),Vy=Dl(Wh());var _v=Object.defineProperty,VC=Object.getOwnPropertyDescriptor,YC=(e,t)=>{for(var i in t)_v(e,i,{get:t[i],enumerable:!0})},De=(e,t,i,r)=>{for(var s=r>1?void 0:r?VC(t,i):t,n=e.length-1,o;n>=0;n--)(o=e[n])&&(s=(r?o(t,i,s):o(s))||s);return r&&s&&_v(t,i,s),s},Z=(e,t)=>(i,r)=>t(i,r,e),up="Terminal input",Dc={get:()=>up,set:e=>up=e},dp="Too much output to announce, navigate to rows manually to read",Ic={get:()=>dp,set:e=>dp=e};function JC(e){return e.replace(/\r?\n/g,"\r")}function ZC(e,t){return t?"\x1B[200~"+e+"\x1B[201~":e}function e2(e,t){e.clipboardData&&e.clipboardData.setData("text/plain",t.selectionText),e.preventDefault()}function t2(e,t,i,r){if(e.stopPropagation(),e.clipboardData){let s=e.clipboardData.getData("text/plain");gv(s,t,i,r)}}function gv(e,t,i,r){e=JC(e),e=ZC(e,i.decPrivateModes.bracketedPasteMode&&r.rawOptions.ignoreBracketedPasteMode!==!0),i.triggerDataEvent(e,!0),t.value=""}function pv(e,t,i){let r=i.getBoundingClientRect(),s=e.clientX-r.left-10,n=e.clientY-r.top-10;t.style.width="20px",t.style.height="20px",t.style.left=`${s}px`,t.style.top=`${n}px`,t.style.zIndex="1000",t.focus()}function fp(e,t,i,r,s){pv(e,t,i),s&&r.rightClickSelect(e),t.value=r.selectionText,t.select()}function dr(e){return e>65535?(e-=65536,String.fromCharCode((e>>10)+55296)+String.fromCharCode(e%1024+56320)):String.fromCharCode(e)}function Na(e,t=0,i=e.length){let r="";for(let s=t;s<i;++s){let n=e[s];n>65535?(n-=65536,r+=String.fromCharCode((n>>10)+55296)+String.fromCharCode(n%1024+56320)):r+=String.fromCharCode(n)}return r}var i2=class{constructor(){this._interim=0}clear(){this._interim=0}decode(e,t){let i=e.length;if(!i)return 0;let r=0,s=0;if(this._interim){let n=e.charCodeAt(s++);56320<=n&&n<=57343?t[r++]=(this._interim-55296)*1024+n-56320+65536:(t[r++]=this._interim,t[r++]=n),this._interim=0}for(let n=s;n<i;++n){let o=e.charCodeAt(n);if(55296<=o&&o<=56319){if(++n>=i)return this._interim=o,r;let a=e.charCodeAt(n);56320<=a&&a<=57343?t[r++]=(o-55296)*1024+a-56320+65536:(t[r++]=o,t[r++]=a);continue}o!==65279&&(t[r++]=o)}return r}},r2=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(e,t){let i=e.length;if(!i)return 0;let r=0,s,n,o,a,h=0,l=0;if(this.interim[0]){let p=!1,g=this.interim[0];g&=(g&224)===192?31:(g&240)===224?15:7;let v=0,m;for(;(m=this.interim[++v]&63)&&v<4;)g<<=6,g|=m;let x=(this.interim[0]&224)===192?2:(this.interim[0]&240)===224?3:4,E=x-v;for(;l<E;){if(l>=i)return 0;if(m=e[l++],(m&192)!==128){l--,p=!0;break}else this.interim[v++]=m,g<<=6,g|=m&63}p||(x===2?g<128?l--:t[r++]=g:x===3?g<2048||g>=55296&&g<=57343||g===65279||(t[r++]=g):g<65536||g>1114111||(t[r++]=g)),this.interim.fill(0)}let c=i-4,u=l;for(;u<i;){for(;u<c&&!((s=e[u])&128)&&!((n=e[u+1])&128)&&!((o=e[u+2])&128)&&!((a=e[u+3])&128);)t[r++]=s,t[r++]=n,t[r++]=o,t[r++]=a,u+=4;if(s=e[u++],s<128)t[r++]=s;else if((s&224)===192){if(u>=i)return this.interim[0]=s,r;if(n=e[u++],(n&192)!==128){u--;continue}if(h=(s&31)<<6|n&63,h<128){u--;continue}t[r++]=h}else if((s&240)===224){if(u>=i)return this.interim[0]=s,r;if(n=e[u++],(n&192)!==128){u--;continue}if(u>=i)return this.interim[0]=s,this.interim[1]=n,r;if(o=e[u++],(o&192)!==128){u--;continue}if(h=(s&15)<<12|(n&63)<<6|o&63,h<2048||h>=55296&&h<=57343||h===65279)continue;t[r++]=h}else if((s&248)===240){if(u>=i)return this.interim[0]=s,r;if(n=e[u++],(n&192)!==128){u--;continue}if(u>=i)return this.interim[0]=s,this.interim[1]=n,r;if(o=e[u++],(o&192)!==128){u--;continue}if(u>=i)return this.interim[0]=s,this.interim[1]=n,this.interim[2]=o,r;if(a=e[u++],(a&192)!==128){u--;continue}if(h=(s&7)<<18|(n&63)<<12|(o&63)<<6|a&63,h<65536||h>1114111)continue;t[r++]=h}}return r}},vv="",fr=" ",Kn=class mv{constructor(){this.fg=0,this.bg=0,this.extended=new Da}static toColorRGB(t){return[t>>>16&255,t>>>8&255,t&255]}static fromColorRGB(t){return(t[0]&255)<<16|(t[1]&255)<<8|t[2]&255}clone(){let t=new mv;return t.fg=this.fg,t.bg=this.bg,t.extended=this.extended.clone(),t}isInverse(){return this.fg&67108864}isBold(){return this.fg&134217728}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:this.fg&268435456}isBlink(){return this.fg&536870912}isInvisible(){return this.fg&1073741824}isItalic(){return this.bg&67108864}isDim(){return this.bg&134217728}isStrikethrough(){return this.fg&2147483648}isProtected(){return this.bg&536870912}isOverline(){return this.bg&1073741824}getFgColorMode(){return this.fg&50331648}getBgColorMode(){return this.bg&50331648}isFgRGB(){return(this.fg&50331648)===50331648}isBgRGB(){return(this.bg&50331648)===50331648}isFgPalette(){return(this.fg&50331648)===16777216||(this.fg&50331648)===33554432}isBgPalette(){return(this.bg&50331648)===16777216||(this.bg&50331648)===33554432}isFgDefault(){return(this.fg&50331648)===0}isBgDefault(){return(this.bg&50331648)===0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(this.fg&50331648){case 16777216:case 33554432:return this.fg&255;case 50331648:return this.fg&16777215;default:return-1}}getBgColor(){switch(this.bg&50331648){case 16777216:case 33554432:return this.bg&255;case 50331648:return this.bg&16777215;default:return-1}}hasExtendedAttrs(){return this.bg&268435456}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(this.bg&268435456&&~this.extended.underlineColor)switch(this.extended.underlineColor&50331648){case 16777216:case 33554432:return this.extended.underlineColor&255;case 50331648:return this.extended.underlineColor&16777215;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return this.bg&268435456&&~this.extended.underlineColor?this.extended.underlineColor&50331648:this.getFgColorMode()}isUnderlineColorRGB(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===50331648:this.isFgRGB()}isUnderlineColorPalette(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===16777216||(this.extended.underlineColor&50331648)===33554432:this.isFgPalette()}isUnderlineColorDefault(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===0:this.isFgDefault()}getUnderlineStyle(){return this.fg&268435456?this.bg&268435456?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}},Da=class yv{constructor(t=0,i=0){this._ext=0,this._urlId=0,this._ext=t,this._urlId=i}get ext(){return this._urlId?this._ext&-469762049|this.underlineStyle<<26:this._ext}set ext(t){this._ext=t}get underlineStyle(){return this._urlId?5:(this._ext&469762048)>>26}set underlineStyle(t){this._ext&=-469762049,this._ext|=t<<26&469762048}get underlineColor(){return this._ext&67108863}set underlineColor(t){this._ext&=-67108864,this._ext|=t&67108863}get urlId(){return this._urlId}set urlId(t){this._urlId=t}get underlineVariantOffset(){let t=(this._ext&3758096384)>>29;return t<0?t^4294967288:t}set underlineVariantOffset(t){this._ext&=536870911,this._ext|=t<<29&3758096384}clone(){return new yv(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}},Xt=class bv extends Kn{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new Da,this.combinedData=""}static fromCharData(t){let i=new bv;return i.setFromCharData(t),i}isCombined(){return this.content&2097152}getWidth(){return this.content>>22}getChars(){return this.content&2097152?this.combinedData:this.content&2097151?dr(this.content&2097151):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):this.content&2097151}setFromCharData(t){this.fg=t[0],this.bg=0;let i=!1;if(t[1].length>2)i=!0;else if(t[1].length===2){let r=t[1].charCodeAt(0);if(55296<=r&&r<=56319){let s=t[1].charCodeAt(1);56320<=s&&s<=57343?this.content=(r-55296)*1024+s-56320+65536|t[2]<<22:i=!0}else i=!0}else this.content=t[1].charCodeAt(0)|t[2]<<22;i&&(this.combinedData=t[1],this.content=2097152|t[2]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},_p="di$target",Mc="di$dependencies",_c=new Map;function s2(e){return e[Mc]||[]}function Ve(e){if(_c.has(e))return _c.get(e);let t=function(i,r,s){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");n2(t,i,s)};return t._id=e,_c.set(e,t),t}function n2(e,t,i){t[_p]===t?t[Mc].push({id:e,index:i}):(t[Mc]=[{id:e,index:i}],t[_p]=t)}var gt=Ve("BufferService"),wv=Ve("CoreMouseService"),Ur=Ve("CoreService"),o2=Ve("CharsetService"),_u=Ve("InstantiationService"),Av=Ve("LogService"),pt=Ve("OptionsService"),xv=Ve("OscLinkService"),a2=Ve("UnicodeService"),Nn=Ve("DecorationService"),Tc=class{constructor(e,t,i){this._bufferService=e,this._optionsService=t,this._oscLinkService=i}provideLinks(e,t){let i=this._bufferService.buffer.lines.get(e-1);if(!i){t(void 0);return}let r=[],s=this._optionsService.rawOptions.linkHandler,n=new Xt,o=i.getTrimmedLength(),a=-1,h=-1,l=!1;for(let c=0;c<o;c++)if(!(h===-1&&!i.hasContent(c))){if(i.loadCell(c,n),n.hasExtendedAttrs()&&n.extended.urlId)if(h===-1){h=c,a=n.extended.urlId;continue}else l=n.extended.urlId!==a;else h!==-1&&(l=!0);if(l||h!==-1&&c===o-1){let u=this._oscLinkService.getLinkData(a)?.uri;if(u){let p={start:{x:h+1,y:e},end:{x:c+(!l&&c===o-1?1:0),y:e}},g=!1;if(!s?.allowNonHttpProtocols)try{let v=new URL(u);["http:","https:"].includes(v.protocol)||(g=!0)}catch{g=!0}g||r.push({text:u,range:p,activate:(v,m)=>s?s.activate(v,m,p):l2(v,m),hover:(v,m)=>s?.hover?.(v,m,p),leave:(v,m)=>s?.leave?.(v,m,p)})}l=!1,n.hasExtendedAttrs()&&n.extended.urlId?(h=c,a=n.extended.urlId):(h=-1,a=-1)}}t(r)}};Tc=De([Z(0,gt),Z(1,pt),Z(2,xv)],Tc);function l2(e,t){if(confirm(`Do you want to navigate to ${t}?

WARNING: This link could potentially be dangerous`)){let i=window.open();if(i){try{i.opener=null}catch{}i.location.href=t}else console.warn("Opening link blocked as opener could not be cleared")}}var Qa=Ve("CharSizeService"),Ii=Ve("CoreBrowserService"),gu=Ve("MouseService"),Mi=Ve("RenderService"),h2=Ve("SelectionService"),Sv=Ve("CharacterJoinerService"),ps=Ve("ThemeService"),Cv=Ve("LinkProviderService"),c2=class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(e){setTimeout(()=>{throw e.stack?gp.isErrorNoTelemetry(e)?new gp(e.message+`

`+e.stack):new Error(e.message+`

`+e.stack):e},0)}}addListener(e){return this.listeners.push(e),()=>{this._removeListener(e)}}emit(e){this.listeners.forEach(t=>{t(e)})}_removeListener(e){this.listeners.splice(this.listeners.indexOf(e),1)}setUnexpectedErrorHandler(e){this.unexpectedErrorHandler=e}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(e){this.unexpectedErrorHandler(e),this.emit(e)}onUnexpectedExternalError(e){this.unexpectedErrorHandler(e)}},u2=new c2;function ba(e){d2(e)||u2.onUnexpectedError(e)}var Rc="Canceled";function d2(e){return e instanceof f2?!0:e instanceof Error&&e.name===Rc&&e.message===Rc}var f2=class extends Error{constructor(){super(Rc),this.name=this.message}};function _2(e){return e?new Error(`Illegal argument: ${e}`):new Error("Illegal argument")}var gp=class Fc extends Error{constructor(t){super(t),this.name="CodeExpectedError"}static fromError(t){if(t instanceof Fc)return t;let i=new Fc;return i.message=t.message,i.stack=t.stack,i}static isErrorNoTelemetry(t){return t.name==="CodeExpectedError"}},Pc=class kv extends Error{constructor(t){super(t||"An unexpected bug occurred."),Object.setPrototypeOf(this,kv.prototype)}};function g2(e,t,i=0,r=e.length){let s=i,n=r;for(;s<n;){let o=Math.floor((s+n)/2);t(e[o])?s=o+1:n=o}return s-1}var p2=class Ev{constructor(t){this._array=t,this._findLastMonotonousLastIdx=0}findLastMonotonous(t){if(Ev.assertInvariants){if(this._prevFindLastPredicate){for(let r of this._array)if(this._prevFindLastPredicate(r)&&!t(r))throw new Error("MonotonousArray: current predicate must be weaker than (or equal to) the previous predicate.")}this._prevFindLastPredicate=t}let i=g2(this._array,t,this._findLastMonotonousLastIdx);return this._findLastMonotonousLastIdx=i+1,i===-1?void 0:this._array[i]}};p2.assertInvariants=!1;function kt(e,t=0){return e[e.length-(1+t)]}var Bv;(e=>{function t(n){return n<0}e.isLessThan=t;function i(n){return n<=0}e.isLessThanOrEqual=i;function r(n){return n>0}e.isGreaterThan=r;function s(n){return n===0}e.isNeitherLessOrGreaterThan=s,e.greaterThan=1,e.lessThan=-1,e.neitherLessOrGreaterThan=0})(Bv||={});function v2(e,t){return(i,r)=>t(e(i),e(r))}var m2=(e,t)=>e-t,pp=class Oc{constructor(t){this.iterate=t}forEach(t){this.iterate(i=>(t(i),!0))}toArray(){let t=[];return this.iterate(i=>(t.push(i),!0)),t}filter(t){return new Oc(i=>this.iterate(r=>t(r)?i(r):!0))}map(t){return new Oc(i=>this.iterate(r=>i(t(r))))}some(t){let i=!1;return this.iterate(r=>(i=t(r),!i)),i}findFirst(t){let i;return this.iterate(r=>t(r)?(i=r,!1):!0),i}findLast(t){let i;return this.iterate(r=>(t(r)&&(i=r),!0)),i}findLastMaxBy(t){let i,r=!0;return this.iterate(s=>((r||Bv.isGreaterThan(t(s,i)))&&(r=!1,i=s),!0)),i}};pp.empty=new pp(e=>{});function y2(e,t){let i=Object.create(null);for(let r of e){let s=t(r),n=i[s];n||(n=i[s]=[]),n.push(r)}return i}var vp,mp,gD=class{constructor(e,t){this.toKey=t,this._map=new Map,this[vp]="SetWithKey";for(let i of e)this.add(i)}get size(){return this._map.size}add(e){let t=this.toKey(e);return this._map.set(t,e),this}delete(e){return this._map.delete(this.toKey(e))}has(e){return this._map.has(this.toKey(e))}*entries(){for(let e of this._map.values())yield[e,e]}keys(){return this.values()}*values(){for(let e of this._map.values())yield e}clear(){this._map.clear()}forEach(e,t){this._map.forEach(i=>e.call(t,i,i,this))}[(mp=Symbol.iterator,vp=Symbol.toStringTag,mp)](){return this.values()}},b2=class{constructor(){this.map=new Map}add(e,t){let i=this.map.get(e);i||(i=new Set,this.map.set(e,i)),i.add(t)}delete(e,t){let i=this.map.get(e);i&&(i.delete(t),i.size===0&&this.map.delete(e))}forEach(e,t){let i=this.map.get(e);i&&i.forEach(t)}get(e){return this.map.get(e)||new Set}};function w2(e,t){let i=this,r=!1,s;return function(){if(r)return s;if(r=!0,t)try{s=e.apply(i,arguments)}finally{t()}else s=e.apply(i,arguments);return s}}var Lv;(e=>{function t(b){return b&&typeof b=="object"&&typeof b[Symbol.iterator]=="function"}e.is=t;let i=Object.freeze([]);function r(){return i}e.empty=r;function*s(b){yield b}e.single=s;function n(b){return t(b)?b:s(b)}e.wrap=n;function o(b){return b||i}e.from=o;function*a(b){for(let L=b.length-1;L>=0;L--)yield b[L]}e.reverse=a;function h(b){return!b||b[Symbol.iterator]().next().done===!0}e.isEmpty=h;function l(b){return b[Symbol.iterator]().next().value}e.first=l;function c(b,L){let I=0;for(let T of b)if(L(T,I++))return!0;return!1}e.some=c;function u(b,L){for(let I of b)if(L(I))return I}e.find=u;function*p(b,L){for(let I of b)L(I)&&(yield I)}e.filter=p;function*g(b,L){let I=0;for(let T of b)yield L(T,I++)}e.map=g;function*v(b,L){let I=0;for(let T of b)yield*L(T,I++)}e.flatMap=v;function*m(...b){for(let L of b)yield*L}e.concat=m;function x(b,L,I){let T=I;for(let q of b)T=L(T,q);return T}e.reduce=x;function*E(b,L,I=b.length){for(L<0&&(L+=b.length),I<0?I+=b.length:I>b.length&&(I=b.length);L<I;L++)yield b[L]}e.slice=E;function R(b,L=Number.POSITIVE_INFINITY){let I=[];if(L===0)return[I,b];let T=b[Symbol.iterator]();for(let q=0;q<L;q++){let $=T.next();if($.done)return[I,e.empty()];I.push($.value)}return[I,{[Symbol.iterator](){return T}}]}e.consume=R;async function D(b){let L=[];for await(let I of b)L.push(I);return Promise.resolve(L)}e.asyncToArray=D})(Lv||={});var A2=!1,Qr=null,x2=class Dv{constructor(){this.livingDisposables=new Map}getDisposableData(t){let i=this.livingDisposables.get(t);return i||(i={parent:null,source:null,isSingleton:!1,value:t,idx:Dv.idx++},this.livingDisposables.set(t,i)),i}trackDisposable(t){let i=this.getDisposableData(t);i.source||(i.source=new Error().stack)}setParent(t,i){let r=this.getDisposableData(t);r.parent=i}markAsDisposed(t){this.livingDisposables.delete(t)}markAsSingleton(t){this.getDisposableData(t).isSingleton=!0}getRootParent(t,i){let r=i.get(t);if(r)return r;let s=t.parent?this.getRootParent(this.getDisposableData(t.parent),i):t;return i.set(t,s),s}getTrackedDisposables(){let t=new Map;return[...this.livingDisposables.entries()].filter(([,i])=>i.source!==null&&!this.getRootParent(i,t).isSingleton).flatMap(([i])=>i)}computeLeakingDisposables(t=10,i){let r;if(i)r=i;else{let h=new Map,l=[...this.livingDisposables.values()].filter(u=>u.source!==null&&!this.getRootParent(u,h).isSingleton);if(l.length===0)return;let c=new Set(l.map(u=>u.value));if(r=l.filter(u=>!(u.parent&&c.has(u.parent))),r.length===0)throw new Error("There are cyclic diposable chains!")}if(!r)return;function s(h){function l(u,p){for(;u.length>0&&p.some(g=>typeof g=="string"?g===u[0]:u[0].match(g));)u.shift()}let c=h.source.split(`
`).map(u=>u.trim().replace("at ","")).filter(u=>u!=="");return l(c,["Error",/^trackDisposable \(.*\)$/,/^DisposableTracker.trackDisposable \(.*\)$/]),c.reverse()}let n=new b2;for(let h of r){let l=s(h);for(let c=0;c<=l.length;c++)n.add(l.slice(0,c).join(`
`),h)}r.sort(v2(h=>h.idx,m2));let o="",a=0;for(let h of r.slice(0,t)){a++;let l=s(h),c=[];for(let u=0;u<l.length;u++){let p=l[u];p=`(shared with ${n.get(l.slice(0,u+1).join(`
`)).size}/${r.length} leaks) at ${p}`;let g=n.get(l.slice(0,u).join(`
`)),v=y2([...g].map(m=>s(m)[u]),m=>m);delete v[l[u]];for(let[m,x]of Object.entries(v))c.unshift(`    - stacktraces of ${x.length} other leaks continue with ${m}`);c.unshift(p)}o+=`


==================== Leaking disposable ${a}/${r.length}: ${h.value.constructor.name} ====================
${c.join(`
`)}
============================================================

`}return r.length>t&&(o+=`


... and ${r.length-t} more leaking disposables

`),{leaks:r,details:o}}};x2.idx=0;function S2(e){Qr=e}if(A2){let e="__is_disposable_tracked__";S2(new class{trackDisposable(t){let i=new Error("Potentially leaked disposable").stack;setTimeout(()=>{t[e]||console.log(i)},3e3)}setParent(t,i){if(t&&t!==oe.None)try{t[e]=!0}catch{}}markAsDisposed(t){if(t&&t!==oe.None)try{t[e]=!0}catch{}}markAsSingleton(t){}})}function Ha(e){return Qr?.trackDisposable(e),e}function Xa(e){Qr?.markAsDisposed(e)}function Rn(e,t){Qr?.setParent(e,t)}function C2(e,t){if(Qr)for(let i of e)Qr.setParent(i,t)}function yp(e){return Qr?.markAsSingleton(e),e}function Hr(e){if(Lv.is(e)){let t=[];for(let i of e)if(i)try{i.dispose()}catch(r){t.push(r)}if(t.length===1)throw t[0];if(t.length>1)throw new AggregateError(t,"Encountered errors while disposing of store");return Array.isArray(e)?[]:e}else if(e)return e.dispose(),e}function k2(...e){let t=be(()=>Hr(e));return C2(e,t),t}function be(e){let t=Ha({dispose:w2(()=>{Xa(t),e()})});return t}var Iv=class Mv{constructor(){this._toDispose=new Set,this._isDisposed=!1,Ha(this)}dispose(){this._isDisposed||(Xa(this),this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{Hr(this._toDispose)}finally{this._toDispose.clear()}}add(t){if(!t)return t;if(t===this)throw new Error("Cannot register a disposable on itself!");return Rn(t,this),this._isDisposed?Mv.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(t),t}delete(t){if(t){if(t===this)throw new Error("Cannot dispose a disposable on itself!");this._toDispose.delete(t),t.dispose()}}deleteAndLeak(t){t&&this._toDispose.has(t)&&(this._toDispose.delete(t),Rn(t,null))}};Iv.DISABLE_DISPOSED_WARNING=!1;var _r=Iv,oe=class{constructor(){this._store=new _r,Ha(this),Rn(this._store,this)}dispose(){Xa(this),this._store.dispose()}_register(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}};oe.None=Object.freeze({dispose(){}});var gs=class{constructor(){this._isDisposed=!1,Ha(this)}get value(){return this._isDisposed?void 0:this._value}set value(e){this._isDisposed||e===this._value||(this._value?.dispose(),e&&Rn(e,this),this._value=e)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,Xa(this),this._value?.dispose(),this._value=void 0}clearAndLeak(){let e=this._value;return this._value=void 0,e&&Rn(e,null),e}},Lt=typeof window=="object"?window:globalThis,Kc=class Nc{constructor(t){this.element=t,this.next=Nc.Undefined,this.prev=Nc.Undefined}};Kc.Undefined=new Kc(void 0);var ke=Kc,bp=class{constructor(){this._first=ke.Undefined,this._last=ke.Undefined,this._size=0}get size(){return this._size}isEmpty(){return this._first===ke.Undefined}clear(){let e=this._first;for(;e!==ke.Undefined;){let t=e.next;e.prev=ke.Undefined,e.next=ke.Undefined,e=t}this._first=ke.Undefined,this._last=ke.Undefined,this._size=0}unshift(e){return this._insert(e,!1)}push(e){return this._insert(e,!0)}_insert(e,t){let i=new ke(e);if(this._first===ke.Undefined)this._first=i,this._last=i;else if(t){let s=this._last;this._last=i,i.prev=s,s.next=i}else{let s=this._first;this._first=i,i.next=s,s.prev=i}this._size+=1;let r=!1;return()=>{r||(r=!0,this._remove(i))}}shift(){if(this._first!==ke.Undefined){let e=this._first.element;return this._remove(this._first),e}}pop(){if(this._last!==ke.Undefined){let e=this._last.element;return this._remove(this._last),e}}_remove(e){if(e.prev!==ke.Undefined&&e.next!==ke.Undefined){let t=e.prev;t.next=e.next,e.next.prev=t}else e.prev===ke.Undefined&&e.next===ke.Undefined?(this._first=ke.Undefined,this._last=ke.Undefined):e.next===ke.Undefined?(this._last=this._last.prev,this._last.next=ke.Undefined):e.prev===ke.Undefined&&(this._first=this._first.next,this._first.prev=ke.Undefined);this._size-=1}*[Symbol.iterator](){let e=this._first;for(;e!==ke.Undefined;)yield e.element,e=e.next}},E2=globalThis.performance&&typeof globalThis.performance.now=="function",B2=class Tv{static create(t){return new Tv(t)}constructor(t){this._now=E2&&t===!1?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}},L2=!1,wp=!1,D2=!1,rt;(e=>{e.None=()=>oe.None;function t(C){if(D2){let{onDidAddListener:w}=C,k=Xc.create(),f=0;C.onDidAddListener=()=>{++f===2&&(console.warn("snapshotted emitter LIKELY used public and SHOULD HAVE BEEN created with DisposableStore. snapshotted here"),k.print()),w?.()}}}function i(C,w){return p(C,()=>{},0,void 0,!0,void 0,w)}e.defer=i;function r(C){return(w,k=null,f)=>{let d=!1,_;return _=C(y=>{if(!d)return _?_.dispose():d=!0,w.call(k,y)},null,f),d&&_.dispose(),_}}e.once=r;function s(C,w,k){return c((f,d=null,_)=>C(y=>f.call(d,w(y)),null,_),k)}e.map=s;function n(C,w,k){return c((f,d=null,_)=>C(y=>{w(y),f.call(d,y)},null,_),k)}e.forEach=n;function o(C,w,k){return c((f,d=null,_)=>C(y=>w(y)&&f.call(d,y),null,_),k)}e.filter=o;function a(C){return C}e.signal=a;function h(...C){return(w,k=null,f)=>{let d=k2(...C.map(_=>_(y=>w.call(k,y))));return u(d,f)}}e.any=h;function l(C,w,k,f){let d=k;return s(C,_=>(d=w(d,_),d),f)}e.reduce=l;function c(C,w){let k,f={onWillAddFirstListener(){k=C(d.fire,d)},onDidRemoveLastListener(){k?.dispose()}};w||t(f);let d=new Y(f);return w?.add(d),d.event}function u(C,w){return w instanceof Array?w.push(C):w&&w.add(C),C}function p(C,w,k=100,f=!1,d=!1,_,y){let A,S,F,U=0,W,z={leakWarningThreshold:_,onWillAddFirstListener(){A=C(ee=>{U++,S=w(S,ee),f&&!F&&(J.fire(S),S=void 0),W=()=>{let ue=S;S=void 0,F=void 0,(!f||U>1)&&J.fire(ue),U=0},typeof k=="number"?(clearTimeout(F),F=setTimeout(W,k)):F===void 0&&(F=0,queueMicrotask(W))})},onWillRemoveListener(){d&&U>0&&W?.()},onDidRemoveLastListener(){W=void 0,A.dispose()}};y||t(z);let J=new Y(z);return y?.add(J),J.event}e.debounce=p;function g(C,w=0,k){return e.debounce(C,(f,d)=>f?(f.push(d),f):[d],w,void 0,!0,void 0,k)}e.accumulate=g;function v(C,w=(f,d)=>f===d,k){let f=!0,d;return o(C,_=>{let y=f||!w(_,d);return f=!1,d=_,y},k)}e.latch=v;function m(C,w,k){return[e.filter(C,w,k),e.filter(C,f=>!w(f),k)]}e.split=m;function x(C,w=!1,k=[],f){let d=k.slice(),_=C(S=>{d?d.push(S):A.fire(S)});f&&f.add(_);let y=()=>{d?.forEach(S=>A.fire(S)),d=null},A=new Y({onWillAddFirstListener(){_||(_=C(S=>A.fire(S)),f&&f.add(_))},onDidAddFirstListener(){d&&(w?setTimeout(y):y())},onDidRemoveLastListener(){_&&_.dispose(),_=null}});return f&&f.add(A),A.event}e.buffer=x;function E(C,w){return(k,f,d)=>{let _=w(new D);return C(function(y){let A=_.evaluate(y);A!==R&&k.call(f,A)},void 0,d)}}e.chain=E;let R=Symbol("HaltChainable");class D{constructor(){this.steps=[]}map(w){return this.steps.push(w),this}forEach(w){return this.steps.push(k=>(w(k),k)),this}filter(w){return this.steps.push(k=>w(k)?k:R),this}reduce(w,k){let f=k;return this.steps.push(d=>(f=w(f,d),f)),this}latch(w=(k,f)=>k===f){let k=!0,f;return this.steps.push(d=>{let _=k||!w(d,f);return k=!1,f=d,_?d:R}),this}evaluate(w){for(let k of this.steps)if(w=k(w),w===R)break;return w}}function b(C,w,k=f=>f){let f=(...A)=>y.fire(k(...A)),d=()=>C.on(w,f),_=()=>C.removeListener(w,f),y=new Y({onWillAddFirstListener:d,onDidRemoveLastListener:_});return y.event}e.fromNodeEventEmitter=b;function L(C,w,k=f=>f){let f=(...A)=>y.fire(k(...A)),d=()=>C.addEventListener(w,f),_=()=>C.removeEventListener(w,f),y=new Y({onWillAddFirstListener:d,onDidRemoveLastListener:_});return y.event}e.fromDOMEventEmitter=L;function I(C){return new Promise(w=>r(C)(w))}e.toPromise=I;function T(C){let w=new Y;return C.then(k=>{w.fire(k)},()=>{w.fire(void 0)}).finally(()=>{w.dispose()}),w.event}e.fromPromise=T;function q(C,w){return C(k=>w.fire(k))}e.forward=q;function $(C,w,k){return w(k),C(f=>w(f))}e.runAndSubscribe=$;class V{constructor(w,k){this._observable=w,this._counter=0,this._hasChanged=!1;let f={onWillAddFirstListener:()=>{w.addObserver(this)},onDidRemoveLastListener:()=>{w.removeObserver(this)}};k||t(f),this.emitter=new Y(f),k&&k.add(this.emitter)}beginUpdate(w){this._counter++}handlePossibleChange(w){}handleChange(w,k){this._hasChanged=!0}endUpdate(w){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}function j(C,w){return new V(C,w).emitter.event}e.fromObservable=j;function ne(C){return(w,k,f)=>{let d=0,_=!1,y={beginUpdate(){d++},endUpdate(){d--,d===0&&(C.reportChanges(),_&&(_=!1,w.call(k)))},handlePossibleChange(){},handleChange(){_=!0}};C.addObserver(y),C.reportChanges();let A={dispose(){C.removeObserver(y)}};return f instanceof _r?f.add(A):Array.isArray(f)&&f.push(A),A}}e.fromObservableLight=ne})(rt||={});var Qc=class Hc{constructor(t){this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name=`${t}_${Hc._idPool++}`,Hc.all.add(this)}start(t){this._stopWatch=new B2,this.listenerCount=t}stop(){if(this._stopWatch){let t=this._stopWatch.elapsed();this.durations.push(t),this.elapsedOverall+=t,this.invocationCount+=1,this._stopWatch=void 0}}};Qc.all=new Set,Qc._idPool=0;var I2=Qc,Ap=-1,Rv=class Fv{constructor(t,i,r=(Fv._idPool++).toString(16).padStart(3,"0")){this._errorHandler=t,this.threshold=i,this.name=r,this._warnCountdown=0}dispose(){this._stacks?.clear()}check(t,i){let r=this.threshold;if(r<=0||i<r)return;this._stacks||(this._stacks=new Map);let s=this._stacks.get(t.value)||0;if(this._stacks.set(t.value,s+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=r*.5;let[n,o]=this.getMostFrequentStack(),a=`[${this.name}] potential listener LEAK detected, having ${i} listeners already. MOST frequent listener (${o}):`;console.warn(a),console.warn(n);let h=new T2(a,n);this._errorHandler(h)}return()=>{let n=this._stacks.get(t.value)||0;this._stacks.set(t.value,n-1)}}getMostFrequentStack(){if(!this._stacks)return;let t,i=0;for(let[r,s]of this._stacks)(!t||i<s)&&(t=[r,s],i=s);return t}};Rv._idPool=1;var M2=Rv,Xc=class Pv{constructor(t){this.value=t}static create(){let t=new Error;return new Pv(t.stack??"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},T2=class extends Error{constructor(e,t){super(e),this.name="ListenerLeakError",this.stack=t}},R2=class extends Error{constructor(e,t){super(e),this.name="ListenerRefusalError",this.stack=t}},F2=0,wa=class{constructor(e){this.value=e,this.id=F2++}},P2=2,O2=(e,t)=>{if(e instanceof wa)t(e);else for(let i=0;i<e.length;i++){let r=e[i];r&&t(r)}},Aa;if(L2){let e=[];setInterval(()=>{e.length!==0&&(console.warn("[LEAKING LISTENERS] GC'ed these listeners that were NOT yet disposed:"),console.warn(e.join(`
`)),e.length=0)},3e3),Aa=new FinalizationRegistry(t=>{typeof t=="string"&&e.push(t)})}var Y=class{constructor(e){this._size=0,this._options=e,this._leakageMon=Ap>0||this._options?.leakWarningThreshold?new M2(e?.onListenerError??ba,this._options?.leakWarningThreshold??Ap):void 0,this._perfMon=this._options?._profName?new I2(this._options._profName):void 0,this._deliveryQueue=this._options?.deliveryQueue}dispose(){if(!this._disposed){if(this._disposed=!0,this._deliveryQueue?.current===this&&this._deliveryQueue.reset(),this._listeners){if(wp){let e=this._listeners;queueMicrotask(()=>{O2(e,t=>t.stack?.print())})}this._listeners=void 0,this._size=0}this._options?.onDidRemoveLastListener?.(),this._leakageMon?.dispose()}}get event(){return this._event??=(e,t,i)=>{if(this._leakageMon&&this._size>this._leakageMon.threshold**2){let a=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(a);let h=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],l=new R2(`${a}. HINT: Stack shows most frequent listener (${h[1]}-times)`,h[0]);return(this._options?.onListenerError||ba)(l),oe.None}if(this._disposed)return oe.None;t&&(e=e.bind(t));let r=new wa(e),s,n;this._leakageMon&&this._size>=Math.ceil(this._leakageMon.threshold*.2)&&(r.stack=Xc.create(),s=this._leakageMon.check(r.stack,this._size+1)),wp&&(r.stack=n??Xc.create()),this._listeners?this._listeners instanceof wa?(this._deliveryQueue??=new K2,this._listeners=[this._listeners,r]):this._listeners.push(r):(this._options?.onWillAddFirstListener?.(this),this._listeners=r,this._options?.onDidAddFirstListener?.(this)),this._size++;let o=be(()=>{Aa?.unregister(o),s?.(),this._removeListener(r)});if(i instanceof _r?i.add(o):Array.isArray(i)&&i.push(o),Aa){let a=new Error().stack.split(`
`).slice(2,3).join(`
`).trim(),h=/(file:|vscode-file:\/\/vscode-app)?(\/[^:]*:\d+:\d+)/.exec(a);Aa.register(o,h?.[2]??a,o)}return o},this._event}_removeListener(e){if(this._options?.onWillRemoveListener?.(this),!this._listeners)return;if(this._size===1){this._listeners=void 0,this._options?.onDidRemoveLastListener?.(this),this._size=0;return}let t=this._listeners,i=t.indexOf(e);if(i===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),new Error("Attempted to dispose unknown listener");this._size--,t[i]=void 0;let r=this._deliveryQueue.current===this;if(this._size*P2<=t.length){let s=0;for(let n=0;n<t.length;n++)t[n]?t[s++]=t[n]:r&&(this._deliveryQueue.end--,s<this._deliveryQueue.i&&this._deliveryQueue.i--);t.length=s}}_deliver(e,t){if(!e)return;let i=this._options?.onListenerError||ba;if(!i){e.value(t);return}try{e.value(t)}catch(r){i(r)}}_deliverQueue(e){let t=e.current._listeners;for(;e.i<e.end;)this._deliver(t[e.i++],e.value);e.reset()}fire(e){if(this._deliveryQueue?.current&&(this._deliverQueue(this._deliveryQueue),this._perfMon?.stop()),this._perfMon?.start(this._size),this._listeners)if(this._listeners instanceof wa)this._deliver(this._listeners,e);else{let t=this._deliveryQueue;t.enqueue(this,e,this._listeners.length),this._deliverQueue(t)}this._perfMon?.stop()}hasListeners(){return this._size>0}},K2=class{constructor(){this.i=-1,this.end=0}enqueue(e,t,i){this.i=0,this.end=i,this.current=e,this.value=t}reset(){this.i=this.end,this.current=void 0,this.value=void 0}},Uc=class{constructor(){this.mapWindowIdToZoomLevel=new Map,this._onDidChangeZoomLevel=new Y,this.onDidChangeZoomLevel=this._onDidChangeZoomLevel.event,this.mapWindowIdToZoomFactor=new Map,this._onDidChangeFullscreen=new Y,this.onDidChangeFullscreen=this._onDidChangeFullscreen.event,this.mapWindowIdToFullScreen=new Map}getZoomLevel(t){return this.mapWindowIdToZoomLevel.get(this.getWindowId(t))??0}setZoomLevel(t,i){if(this.getZoomLevel(i)===t)return;let r=this.getWindowId(i);this.mapWindowIdToZoomLevel.set(r,t),this._onDidChangeZoomLevel.fire(r)}getZoomFactor(t){return this.mapWindowIdToZoomFactor.get(this.getWindowId(t))??1}setZoomFactor(t,i){this.mapWindowIdToZoomFactor.set(this.getWindowId(i),t)}setFullscreen(t,i){if(this.isFullscreen(i)===t)return;let r=this.getWindowId(i);this.mapWindowIdToFullScreen.set(r,t),this._onDidChangeFullscreen.fire(r)}isFullscreen(t){return!!this.mapWindowIdToFullScreen.get(this.getWindowId(t))}getWindowId(t){return t.vscodeWindowId}};Uc.INSTANCE=new Uc;var pu=Uc;function N2(e,t,i){typeof t=="string"&&(t=e.matchMedia(t)),t.addEventListener("change",i)}var vD=pu.INSTANCE.onDidChangeZoomLevel;function Q2(e){return pu.INSTANCE.getZoomFactor(e)}var mD=pu.INSTANCE.onDidChangeFullscreen,vs=typeof navigator=="object"?navigator.userAgent:"",zc=vs.indexOf("Firefox")>=0,xa=vs.indexOf("AppleWebKit")>=0,vu=vs.indexOf("Chrome")>=0,Ov=!vu&&vs.indexOf("Safari")>=0,yD=vs.indexOf("Electron/")>=0,bD=vs.indexOf("Android")>=0,Sa=!1;if(typeof Lt.matchMedia=="function"){let e=Lt.matchMedia("(display-mode: standalone) or (display-mode: window-controls-overlay)"),t=Lt.matchMedia("(display-mode: fullscreen)");Sa=e.matches,N2(Lt,e,({matches:i})=>{Sa&&t.matches||(Sa=i)})}function H2(){return Sa}var _s="en",Ia=!1,Ma=!1,Mn=!1,X2=!1,Kv=!1,Nv=!1,U2=!1,z2=!1,W2=!1,$2=!1,ga,Ca=_s,xp=_s,G2,Bi,Di=globalThis,Bt;typeof Di.vscode<"u"&&typeof Di.vscode.process<"u"?Bt=Di.vscode.process:typeof process<"u"&&typeof process?.versions?.node=="string"&&(Bt=process);var Qv=typeof Bt?.versions?.electron=="string",j2=Qv&&Bt?.type==="renderer";if(typeof Bt=="object"){Ia=Bt.platform==="win32",Ma=Bt.platform==="darwin",Mn=Bt.platform==="linux",X2=Mn&&!!Bt.env.SNAP&&!!Bt.env.SNAP_REVISION,U2=Qv,W2=!!Bt.env.CI||!!Bt.env.BUILD_ARTIFACTSTAGINGDIRECTORY,ga=_s,Ca=_s;let e=Bt.env.VSCODE_NLS_CONFIG;if(e)try{let t=JSON.parse(e);ga=t.userLocale,xp=t.osLocale,Ca=t.resolvedLanguage||_s,G2=t.languagePack?.translationsConfigFile}catch{}Kv=!0}else typeof navigator=="object"&&!j2?(Bi=navigator.userAgent,Ia=Bi.indexOf("Windows")>=0,Ma=Bi.indexOf("Macintosh")>=0,z2=(Bi.indexOf("Macintosh")>=0||Bi.indexOf("iPad")>=0||Bi.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,Mn=Bi.indexOf("Linux")>=0,$2=Bi?.indexOf("Mobi")>=0,Nv=!0,Ca=globalThis._VSCODE_NLS_LANGUAGE||_s,ga=navigator.language.toLowerCase(),xp=ga):console.error("Unable to resolve platform.");var gc=0;Ma?gc=1:Ia?gc=3:Mn&&(gc=2);var Hv=Ia,di=Ma,q2=Mn,pc=Kv,V2=Nv&&typeof Di.importScripts=="function",wD=V2?Di.origin:void 0,fi=Bi,lr=Ca,Y2;(e=>{function t(){return lr}e.value=t;function i(){return lr.length===2?lr==="en":lr.length>=3?lr[0]==="e"&&lr[1]==="n"&&lr[2]==="-":!1}e.isDefaultVariant=i;function r(){return lr==="en"}e.isDefault=r})(Y2||={});var J2=typeof Di.postMessage=="function"&&!Di.importScripts,Z2=(()=>{if(J2){let e=[];Di.addEventListener("message",i=>{if(i.data&&i.data.vscodeScheduleAsyncWork)for(let r=0,s=e.length;r<s;r++){let n=e[r];if(n.id===i.data.vscodeScheduleAsyncWork){e.splice(r,1),n.callback();return}}});let t=0;return i=>{let r=++t;e.push({id:r,callback:i}),Di.postMessage({vscodeScheduleAsyncWork:r},"*")}}return e=>setTimeout(e)})(),e5=!!(fi&&fi.indexOf("Chrome")>=0),AD=!!(fi&&fi.indexOf("Firefox")>=0),xD=!!(!e5&&fi&&fi.indexOf("Safari")>=0),SD=!!(fi&&fi.indexOf("Edg/")>=0),CD=!!(fi&&fi.indexOf("Android")>=0),hr=typeof navigator=="object"?navigator:{},kD={clipboard:{writeText:pc||document.queryCommandSupported&&document.queryCommandSupported("copy")||!!(hr&&hr.clipboard&&hr.clipboard.writeText),readText:pc||!!(hr&&hr.clipboard&&hr.clipboard.readText)},keyboard:pc||H2()?0:hr.keyboard||Ov?1:2,touch:"ontouchstart"in Lt||hr.maxTouchPoints>0,pointerEvents:Lt.PointerEvent&&("ontouchstart"in Lt||navigator.maxTouchPoints>0)},mu=class{constructor(){this._keyCodeToStr=[],this._strToKeyCode=Object.create(null)}define(e,t){this._keyCodeToStr[e]=t,this._strToKeyCode[t.toLowerCase()]=e}keyCodeToStr(e){return this._keyCodeToStr[e]}strToKeyCode(e){return this._strToKeyCode[e.toLowerCase()]||0}},vc=new mu,Sp=new mu,Cp=new mu,t5=new Array(230),Xv;(e=>{function t(a){return vc.keyCodeToStr(a)}e.toString=t;function i(a){return vc.strToKeyCode(a)}e.fromString=i;function r(a){return Sp.keyCodeToStr(a)}e.toUserSettingsUS=r;function s(a){return Cp.keyCodeToStr(a)}e.toUserSettingsGeneral=s;function n(a){return Sp.strToKeyCode(a)||Cp.strToKeyCode(a)}e.fromUserSettings=n;function o(a){if(a>=98&&a<=113)return null;switch(a){case 16:return"Up";case 18:return"Down";case 15:return"Left";case 17:return"Right"}return vc.keyCodeToStr(a)}e.toElectronAccelerator=o})(Xv||={});var i5=class Uv{constructor(t,i,r,s,n){this.ctrlKey=t,this.shiftKey=i,this.altKey=r,this.metaKey=s,this.keyCode=n}equals(t){return t instanceof Uv&&this.ctrlKey===t.ctrlKey&&this.shiftKey===t.shiftKey&&this.altKey===t.altKey&&this.metaKey===t.metaKey&&this.keyCode===t.keyCode}getHashCode(){let t=this.ctrlKey?"1":"0",i=this.shiftKey?"1":"0",r=this.altKey?"1":"0",s=this.metaKey?"1":"0";return`K${t}${i}${r}${s}${this.keyCode}`}isModifierKey(){return this.keyCode===0||this.keyCode===5||this.keyCode===57||this.keyCode===6||this.keyCode===4}toKeybinding(){return new r5([this])}isDuplicateModifierCase(){return this.ctrlKey&&this.keyCode===5||this.shiftKey&&this.keyCode===4||this.altKey&&this.keyCode===6||this.metaKey&&this.keyCode===57}},r5=class{constructor(e){if(e.length===0)throw _2("chords");this.chords=e}getHashCode(){let e="";for(let t=0,i=this.chords.length;t<i;t++)t!==0&&(e+=";"),e+=this.chords[t].getHashCode();return e}equals(e){if(e===null||this.chords.length!==e.chords.length)return!1;for(let t=0;t<this.chords.length;t++)if(!this.chords[t].equals(e.chords[t]))return!1;return!0}};function s5(e){if(e.charCode){let i=String.fromCharCode(e.charCode).toUpperCase();return Xv.fromString(i)}let t=e.keyCode;if(t===3)return 7;if(zc)switch(t){case 59:return 85;case 60:if(q2)return 97;break;case 61:return 86;case 107:return 109;case 109:return 111;case 173:return 88;case 224:if(di)return 57;break}else if(xa&&(di&&t===93||!di&&t===92))return 57;return t5[t]||0}var n5=di?256:2048,o5=512,a5=1024,l5=di?2048:256,Wc=class{constructor(e){this._standardKeyboardEventBrand=!0;let t=e;this.browserEvent=t,this.target=t.target,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.altKey=t.altKey,this.metaKey=t.metaKey,this.altGraphKey=t.getModifierState?.("AltGraph"),this.keyCode=s5(t),this.code=t.code,this.ctrlKey=this.ctrlKey||this.keyCode===5,this.altKey=this.altKey||this.keyCode===6,this.shiftKey=this.shiftKey||this.keyCode===4,this.metaKey=this.metaKey||this.keyCode===57,this._asKeybinding=this._computeKeybinding(),this._asKeyCodeChord=this._computeKeyCodeChord()}preventDefault(){this.browserEvent&&this.browserEvent.preventDefault&&this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent&&this.browserEvent.stopPropagation&&this.browserEvent.stopPropagation()}toKeyCodeChord(){return this._asKeyCodeChord}equals(e){return this._asKeybinding===e}_computeKeybinding(){let e=0;this.keyCode!==5&&this.keyCode!==4&&this.keyCode!==6&&this.keyCode!==57&&(e=this.keyCode);let t=0;return this.ctrlKey&&(t|=n5),this.altKey&&(t|=o5),this.shiftKey&&(t|=a5),this.metaKey&&(t|=l5),t|=e,t}_computeKeyCodeChord(){let e=0;return this.keyCode!==5&&this.keyCode!==4&&this.keyCode!==6&&this.keyCode!==57&&(e=this.keyCode),new i5(this.ctrlKey,this.shiftKey,this.altKey,this.metaKey,e)}},kp=new WeakMap;function h5(e){if(!e.parent||e.parent===e)return null;try{let t=e.location,i=e.parent.location;if(t.origin!=="null"&&i.origin!=="null"&&t.origin!==i.origin)return null}catch{return null}return e.parent}var c5=class{static getSameOriginWindowChain(e){let t=kp.get(e);if(!t){t=[],kp.set(e,t);let i=e,r;do r=h5(i),r?t.push({window:new WeakRef(i),iframeElement:i.frameElement||null}):t.push({window:new WeakRef(i),iframeElement:null}),i=r;while(i)}return t.slice(0)}static getPositionOfChildWindowRelativeToAncestorWindow(e,t){if(!t||e===t)return{top:0,left:0};let i=0,r=0,s=this.getSameOriginWindowChain(e);for(let n of s){let o=n.window.deref();if(i+=o?.scrollY??0,r+=o?.scrollX??0,o===t||!n.iframeElement)break;let a=n.iframeElement.getBoundingClientRect();i+=a.top,r+=a.left}return{top:i,left:r}}},kn=class{constructor(e,t){this.timestamp=Date.now(),this.browserEvent=t,this.leftButton=t.button===0,this.middleButton=t.button===1,this.rightButton=t.button===2,this.buttons=t.buttons,this.target=t.target,this.detail=t.detail||1,t.type==="dblclick"&&(this.detail=2),this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.altKey=t.altKey,this.metaKey=t.metaKey,typeof t.pageX=="number"?(this.posx=t.pageX,this.posy=t.pageY):(this.posx=t.clientX+this.target.ownerDocument.body.scrollLeft+this.target.ownerDocument.documentElement.scrollLeft,this.posy=t.clientY+this.target.ownerDocument.body.scrollTop+this.target.ownerDocument.documentElement.scrollTop);let i=c5.getPositionOfChildWindowRelativeToAncestorWindow(e,t.view);this.posx-=i.left,this.posy-=i.top}preventDefault(){this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent.stopPropagation()}},Ep=class{constructor(e,t=0,i=0){this.browserEvent=e||null,this.target=e?e.target||e.targetNode||e.srcElement:null,this.deltaY=i,this.deltaX=t;let r=!1;if(vu){let s=navigator.userAgent.match(/Chrome\/(\d+)/);r=(s?parseInt(s[1]):123)<=122}if(e){let s=e,n=e,o=e.view?.devicePixelRatio||1;if(typeof s.wheelDeltaY<"u")r?this.deltaY=s.wheelDeltaY/(120*o):this.deltaY=s.wheelDeltaY/120;else if(typeof n.VERTICAL_AXIS<"u"&&n.axis===n.VERTICAL_AXIS)this.deltaY=-n.detail/3;else if(e.type==="wheel"){let a=e;a.deltaMode===a.DOM_DELTA_LINE?zc&&!di?this.deltaY=-e.deltaY/3:this.deltaY=-e.deltaY:this.deltaY=-e.deltaY/40}if(typeof s.wheelDeltaX<"u")Ov&&Hv?this.deltaX=-(s.wheelDeltaX/120):r?this.deltaX=s.wheelDeltaX/(120*o):this.deltaX=s.wheelDeltaX/120;else if(typeof n.HORIZONTAL_AXIS<"u"&&n.axis===n.HORIZONTAL_AXIS)this.deltaX=-e.detail/3;else if(e.type==="wheel"){let a=e;a.deltaMode===a.DOM_DELTA_LINE?zc&&!di?this.deltaX=-e.deltaX/3:this.deltaX=-e.deltaX:this.deltaX=-e.deltaX/40}this.deltaY===0&&this.deltaX===0&&e.wheelDelta&&(r?this.deltaY=e.wheelDelta/(120*o):this.deltaY=e.wheelDelta/120)}}preventDefault(){this.browserEvent?.preventDefault()}stopPropagation(){this.browserEvent?.stopPropagation()}},zv=Object.freeze(function(e,t){let i=setTimeout(e.bind(t),0);return{dispose(){clearTimeout(i)}}}),u5;(e=>{function t(i){return i===e.None||i===e.Cancelled||i instanceof d5?!0:!i||typeof i!="object"?!1:typeof i.isCancellationRequested=="boolean"&&typeof i.onCancellationRequested=="function"}e.isCancellationToken=t,e.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:rt.None}),e.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:zv})})(u5||={});var d5=class{constructor(){this._isCancelled=!1,this._emitter=null}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?zv:(this._emitter||(this._emitter=new Y),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}},ED=Symbol("MicrotaskDelay"),yu=class{constructor(e,t){this._isDisposed=!1,this._token=-1,typeof e=="function"&&typeof t=="number"&&this.setIfNotSet(e,t)}dispose(){this.cancel(),this._isDisposed=!0}cancel(){this._token!==-1&&(clearTimeout(this._token),this._token=-1)}cancelAndSet(e,t){if(this._isDisposed)throw new Pc("Calling 'cancelAndSet' on a disposed TimeoutTimer");this.cancel(),this._token=setTimeout(()=>{this._token=-1,e()},t)}setIfNotSet(e,t){if(this._isDisposed)throw new Pc("Calling 'setIfNotSet' on a disposed TimeoutTimer");this._token===-1&&(this._token=setTimeout(()=>{this._token=-1,e()},t))}},f5=class{constructor(){this.disposable=void 0,this.isDisposed=!1}cancel(){this.disposable?.dispose(),this.disposable=void 0}cancelAndSet(e,t,i=globalThis){if(this.isDisposed)throw new Pc("Calling 'cancelAndSet' on a disposed IntervalTimer");this.cancel();let r=i.setInterval(()=>{e()},t);this.disposable=be(()=>{i.clearInterval(r),this.disposable=void 0})}dispose(){this.cancel(),this.isDisposed=!0}},_5,mc;(function(){typeof globalThis.requestIdleCallback!="function"||typeof globalThis.cancelIdleCallback!="function"?mc=(e,t)=>{Z2(()=>{if(i)return;let r=Date.now()+15;t(Object.freeze({didTimeout:!0,timeRemaining(){return Math.max(0,r-Date.now())}}))});let i=!1;return{dispose(){i||(i=!0)}}}:mc=(e,t,i)=>{let r=e.requestIdleCallback(t,typeof i=="number"?{timeout:i}:void 0),s=!1;return{dispose(){s||(s=!0,e.cancelIdleCallback(r))}}},_5=e=>mc(globalThis,e)})();var g5;(e=>{async function t(r){let s,n=await Promise.all(r.map(o=>o.then(a=>a,a=>{s||(s=a)})));if(typeof s<"u")throw s;return n}e.settled=t;function i(r){return new Promise(async(s,n)=>{try{await r(s,n)}catch(o){n(o)}})}e.withAsyncBody=i})(g5||={});var Bp=class Qt{static fromArray(t){return new Qt(i=>{i.emitMany(t)})}static fromPromise(t){return new Qt(async i=>{i.emitMany(await t)})}static fromPromises(t){return new Qt(async i=>{await Promise.all(t.map(async r=>i.emitOne(await r)))})}static merge(t){return new Qt(async i=>{await Promise.all(t.map(async r=>{for await(let s of r)i.emitOne(s)}))})}constructor(t,i){this._state=0,this._results=[],this._error=null,this._onReturn=i,this._onStateChanged=new Y,queueMicrotask(async()=>{let r={emitOne:s=>this.emitOne(s),emitMany:s=>this.emitMany(s),reject:s=>this.reject(s)};try{await Promise.resolve(t(r)),this.resolve()}catch(s){this.reject(s)}finally{r.emitOne=void 0,r.emitMany=void 0,r.reject=void 0}})}[Symbol.asyncIterator](){let t=0;return{next:async()=>{do{if(this._state===2)throw this._error;if(t<this._results.length)return{done:!1,value:this._results[t++]};if(this._state===1)return{done:!0,value:void 0};await rt.toPromise(this._onStateChanged.event)}while(!0)},return:async()=>(this._onReturn?.(),{done:!0,value:void 0})}}static map(t,i){return new Qt(async r=>{for await(let s of t)r.emitOne(i(s))})}map(t){return Qt.map(this,t)}static filter(t,i){return new Qt(async r=>{for await(let s of t)i(s)&&r.emitOne(s)})}filter(t){return Qt.filter(this,t)}static coalesce(t){return Qt.filter(t,i=>!!i)}coalesce(){return Qt.coalesce(this)}static async toPromise(t){let i=[];for await(let r of t)i.push(r);return i}toPromise(){return Qt.toPromise(this)}emitOne(t){this._state===0&&(this._results.push(t),this._onStateChanged.fire())}emitMany(t){this._state===0&&(this._results=this._results.concat(t),this._onStateChanged.fire())}resolve(){this._state===0&&(this._state=1,this._onStateChanged.fire())}reject(t){this._state===0&&(this._state=2,this._error=t,this._onStateChanged.fire())}};Bp.EMPTY=Bp.fromArray([]);function p5(e){return 55296<=e&&e<=56319}function Lp(e){return 56320<=e&&e<=57343}function v5(e,t){return(e-55296<<10)+(t-56320)+65536}function m5(e){return bu(e,0)}function bu(e,t){switch(typeof e){case"object":return e===null?Li(349,t):Array.isArray(e)?b5(e,t):w5(e,t);case"string":return Wv(e,t);case"boolean":return y5(e,t);case"number":return Li(e,t);case"undefined":return Li(937,t);default:return Li(617,t)}}function Li(e,t){return(t<<5)-t+e|0}function y5(e,t){return Li(e?433:863,t)}function Wv(e,t){t=Li(149417,t);for(let i=0,r=e.length;i<r;i++)t=Li(e.charCodeAt(i),t);return t}function b5(e,t){return t=Li(104579,t),e.reduce((i,r)=>bu(r,i),t)}function w5(e,t){return t=Li(181387,t),Object.keys(e).sort().reduce((i,r)=>(i=Wv(r,i),bu(e[r],i)),t)}function yc(e,t,i=32){let r=i-t,s=~((1<<r)-1);return(e<<t|(s&e)>>>r)>>>0}function Dp(e,t=0,i=e.byteLength,r=0){for(let s=0;s<i;s++)e[t+s]=r}function A5(e,t,i="0"){for(;e.length<t;)e=i+e;return e}function yn(e,t=32){return e instanceof ArrayBuffer?Array.from(new Uint8Array(e)).map(i=>i.toString(16).padStart(2,"0")).join(""):A5((e>>>0).toString(16),t/4)}var x5=class $v{constructor(){this._h0=1732584193,this._h1=4023233417,this._h2=2562383102,this._h3=271733878,this._h4=3285377520,this._buff=new Uint8Array(67),this._buffDV=new DataView(this._buff.buffer),this._buffLen=0,this._totalLen=0,this._leftoverHighSurrogate=0,this._finished=!1}update(t){let i=t.length;if(i===0)return;let r=this._buff,s=this._buffLen,n=this._leftoverHighSurrogate,o,a;for(n!==0?(o=n,a=-1,n=0):(o=t.charCodeAt(0),a=0);;){let h=o;if(p5(o))if(a+1<i){let l=t.charCodeAt(a+1);Lp(l)?(a++,h=v5(o,l)):h=65533}else{n=o;break}else Lp(o)&&(h=65533);if(s=this._push(r,s,h),a++,a<i)o=t.charCodeAt(a);else break}this._buffLen=s,this._leftoverHighSurrogate=n}_push(t,i,r){return r<128?t[i++]=r:r<2048?(t[i++]=192|(r&1984)>>>6,t[i++]=128|(r&63)>>>0):r<65536?(t[i++]=224|(r&61440)>>>12,t[i++]=128|(r&4032)>>>6,t[i++]=128|(r&63)>>>0):(t[i++]=240|(r&1835008)>>>18,t[i++]=128|(r&258048)>>>12,t[i++]=128|(r&4032)>>>6,t[i++]=128|(r&63)>>>0),i>=64&&(this._step(),i-=64,this._totalLen+=64,t[0]=t[64],t[1]=t[65],t[2]=t[66]),i}digest(){return this._finished||(this._finished=!0,this._leftoverHighSurrogate&&(this._leftoverHighSurrogate=0,this._buffLen=this._push(this._buff,this._buffLen,65533)),this._totalLen+=this._buffLen,this._wrapUp()),yn(this._h0)+yn(this._h1)+yn(this._h2)+yn(this._h3)+yn(this._h4)}_wrapUp(){this._buff[this._buffLen++]=128,Dp(this._buff,this._buffLen),this._buffLen>56&&(this._step(),Dp(this._buff));let t=8*this._totalLen;this._buffDV.setUint32(56,Math.floor(t/4294967296),!1),this._buffDV.setUint32(60,t%4294967296,!1),this._step()}_step(){let t=$v._bigBlock32,i=this._buffDV;for(let u=0;u<64;u+=4)t.setUint32(u,i.getUint32(u,!1),!1);for(let u=64;u<320;u+=4)t.setUint32(u,yc(t.getUint32(u-12,!1)^t.getUint32(u-32,!1)^t.getUint32(u-56,!1)^t.getUint32(u-64,!1),1),!1);let r=this._h0,s=this._h1,n=this._h2,o=this._h3,a=this._h4,h,l,c;for(let u=0;u<80;u++)u<20?(h=s&n|~s&o,l=1518500249):u<40?(h=s^n^o,l=1859775393):u<60?(h=s&n|s&o|n&o,l=2400959708):(h=s^n^o,l=3395469782),c=yc(r,5)+h+a+l+t.getUint32(u*4,!1)&4294967295,a=o,o=n,n=yc(s,30),s=r,r=c;this._h0=this._h0+r&4294967295,this._h1=this._h1+s&4294967295,this._h2=this._h2+n&4294967295,this._h3=this._h3+o&4294967295,this._h4=this._h4+a&4294967295}};x5._bigBlock32=new DataView(new ArrayBuffer(320));var{registerWindow:BD,getWindow:Vt,getDocument:LD,getWindows:DD,getWindowsCount:ID,getWindowId:Ip,getWindowById:MD,hasWindow:TD,onDidRegisterWindow:S5,onWillUnregisterWindow:RD,onDidUnregisterWindow:FD}=function(){let e=new Map,t={window:Lt,disposables:new _r};e.set(Lt.vscodeWindowId,t);let i=new Y,r=new Y,s=new Y;function n(o,a){return(typeof o=="number"?e.get(o):void 0)??(a?t:void 0)}return{onDidRegisterWindow:i.event,onWillUnregisterWindow:s.event,onDidUnregisterWindow:r.event,registerWindow(o){if(e.has(o.vscodeWindowId))return oe.None;let a=new _r,h={window:o,disposables:a.add(new _r)};return e.set(o.vscodeWindowId,h),a.add(be(()=>{e.delete(o.vscodeWindowId),r.fire(o)})),a.add(se(o,$e.BEFORE_UNLOAD,()=>{s.fire(o)})),i.fire(h),a},getWindows(){return e.values()},getWindowsCount(){return e.size},getWindowId(o){return o.vscodeWindowId},hasWindow(o){return e.has(o)},getWindowById:n,getWindow(o){let a=o;if(a?.ownerDocument?.defaultView)return a.ownerDocument.defaultView.window;let h=o;return h?.view?h.view.window:Lt},getDocument(o){return Vt(o).document}}}(),C5=class{constructor(e,t,i,r){this._node=e,this._type=t,this._handler=i,this._options=r||!1,this._node.addEventListener(this._type,this._handler,this._options)}dispose(){this._handler&&(this._node.removeEventListener(this._type,this._handler,this._options),this._node=null,this._handler=null)}};function se(e,t,i,r){return new C5(e,t,i,r)}function k5(e,t){return function(i){return t(new kn(e,i))}}function E5(e){return function(t){return e(new Wc(t))}}var Mp=function(e,t,i,r){let s=i;return t==="click"||t==="mousedown"||t==="contextmenu"?s=k5(Vt(e),i):(t==="keydown"||t==="keypress"||t==="keyup")&&(s=E5(i)),se(e,t,s,r)},B5,Ta,L5=class extends f5{constructor(e){super(),this.defaultTarget=e&&Vt(e)}cancelAndSet(e,t,i){return super.cancelAndSet(e,t,i??this.defaultTarget)}},bc=class{constructor(e,t=0){this._runner=e,this.priority=t,this._canceled=!1}dispose(){this._canceled=!0}execute(){if(!this._canceled)try{this._runner()}catch(e){ba(e)}}static sort(e,t){return t.priority-e.priority}};(function(){let e=new Map,t=new Map,i=new Map,r=new Map,s=n=>{i.set(n,!1);let o=e.get(n)??[];for(t.set(n,o),e.set(n,[]),r.set(n,!0);o.length>0;)o.sort(bc.sort),o.shift().execute();r.set(n,!1)};Ta=(n,o,a=0)=>{let h=Ip(n),l=new bc(o,a),c=e.get(h);return c||(c=[],e.set(h,c)),c.push(l),i.get(h)||(i.set(h,!0),n.requestAnimationFrame(()=>s(h))),l},B5=(n,o,a)=>{let h=Ip(n);if(r.get(h)){let l=new bc(o,a),c=t.get(h);return c||(c=[],t.set(h,c)),c.push(l),l}else return Ta(n,o,a)}})();var Tp=class ka{constructor(t,i){this.width=t,this.height=i}with(t=this.width,i=this.height){return t!==this.width||i!==this.height?new ka(t,i):this}static is(t){return typeof t=="object"&&typeof t.height=="number"&&typeof t.width=="number"}static lift(t){return t instanceof ka?t:new ka(t.width,t.height)}static equals(t,i){return t===i?!0:!t||!i?!1:t.width===i.width&&t.height===i.height}};Tp.None=new Tp(0,0);function D5(e){let t=e.getBoundingClientRect(),i=Vt(e);return{left:t.left+i.scrollX,top:t.top+i.scrollY,width:t.width,height:t.height}}var PD=new class{constructor(){this.mutationObservers=new Map}observe(e,t,i){let r=this.mutationObservers.get(e);r||(r=new Map,this.mutationObservers.set(e,r));let s=m5(i),n=r.get(s);if(n)n.users+=1;else{let o=new Y,a=new MutationObserver(l=>o.fire(l));a.observe(e,i);let h=n={users:1,observer:a,onDidMutate:o.event};t.add(be(()=>{h.users-=1,h.users===0&&(o.dispose(),a.disconnect(),r?.delete(s),r?.size===0&&this.mutationObservers.delete(e))})),r.set(s,n)}return n.onDidMutate}},$e={CLICK:"click",AUXCLICK:"auxclick",DBLCLICK:"dblclick",MOUSE_UP:"mouseup",MOUSE_DOWN:"mousedown",MOUSE_OVER:"mouseover",MOUSE_MOVE:"mousemove",MOUSE_OUT:"mouseout",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_WHEEL:"wheel",POINTER_UP:"pointerup",POINTER_DOWN:"pointerdown",POINTER_MOVE:"pointermove",POINTER_LEAVE:"pointerleave",CONTEXT_MENU:"contextmenu",WHEEL:"wheel",KEY_DOWN:"keydown",KEY_PRESS:"keypress",KEY_UP:"keyup",LOAD:"load",BEFORE_UNLOAD:"beforeunload",UNLOAD:"unload",PAGE_SHOW:"pageshow",PAGE_HIDE:"pagehide",PASTE:"paste",ABORT:"abort",ERROR:"error",RESIZE:"resize",SCROLL:"scroll",FULLSCREEN_CHANGE:"fullscreenchange",WK_FULLSCREEN_CHANGE:"webkitfullscreenchange",SELECT:"select",CHANGE:"change",SUBMIT:"submit",RESET:"reset",FOCUS:"focus",FOCUS_IN:"focusin",FOCUS_OUT:"focusout",BLUR:"blur",INPUT:"input",STORAGE:"storage",DRAG_START:"dragstart",DRAG:"drag",DRAG_ENTER:"dragenter",DRAG_LEAVE:"dragleave",DRAG_OVER:"dragover",DROP:"drop",DRAG_END:"dragend",ANIMATION_START:xa?"webkitAnimationStart":"animationstart",ANIMATION_END:xa?"webkitAnimationEnd":"animationend",ANIMATION_ITERATION:xa?"webkitAnimationIteration":"animationiteration"},I5=/([\w\-]+)?(#([\w\-]+))?((\.([\w\-]+))*)/;function Gv(e,t,i,...r){let s=I5.exec(t);if(!s)throw new Error("Bad use of emmet");let n=s[1]||"div",o;return e!=="http://www.w3.org/1999/xhtml"?o=document.createElementNS(e,n):o=document.createElement(n),s[3]&&(o.id=s[3]),s[4]&&(o.className=s[4].replace(/\./g," ").trim()),i&&Object.entries(i).forEach(([a,h])=>{typeof h>"u"||(/^on\w+$/.test(a)?o[a]=h:a==="selected"?h&&o.setAttribute(a,"true"):o.setAttribute(a,h))}),o.append(...r),o}function M5(e,t,...i){return Gv("http://www.w3.org/1999/xhtml",e,t,...i)}M5.SVG=function(e,t,...i){return Gv("http://www.w3.org/2000/svg",e,t,...i)};var T5=class{constructor(e){this.domNode=e,this._maxWidth="",this._width="",this._height="",this._top="",this._left="",this._bottom="",this._right="",this._paddingTop="",this._paddingLeft="",this._paddingBottom="",this._paddingRight="",this._fontFamily="",this._fontWeight="",this._fontSize="",this._fontStyle="",this._fontFeatureSettings="",this._fontVariationSettings="",this._textDecoration="",this._lineHeight="",this._letterSpacing="",this._className="",this._display="",this._position="",this._visibility="",this._color="",this._backgroundColor="",this._layerHint=!1,this._contain="none",this._boxShadow=""}setMaxWidth(e){let t=wt(e);this._maxWidth!==t&&(this._maxWidth=t,this.domNode.style.maxWidth=this._maxWidth)}setWidth(e){let t=wt(e);this._width!==t&&(this._width=t,this.domNode.style.width=this._width)}setHeight(e){let t=wt(e);this._height!==t&&(this._height=t,this.domNode.style.height=this._height)}setTop(e){let t=wt(e);this._top!==t&&(this._top=t,this.domNode.style.top=this._top)}setLeft(e){let t=wt(e);this._left!==t&&(this._left=t,this.domNode.style.left=this._left)}setBottom(e){let t=wt(e);this._bottom!==t&&(this._bottom=t,this.domNode.style.bottom=this._bottom)}setRight(e){let t=wt(e);this._right!==t&&(this._right=t,this.domNode.style.right=this._right)}setPaddingTop(e){let t=wt(e);this._paddingTop!==t&&(this._paddingTop=t,this.domNode.style.paddingTop=this._paddingTop)}setPaddingLeft(e){let t=wt(e);this._paddingLeft!==t&&(this._paddingLeft=t,this.domNode.style.paddingLeft=this._paddingLeft)}setPaddingBottom(e){let t=wt(e);this._paddingBottom!==t&&(this._paddingBottom=t,this.domNode.style.paddingBottom=this._paddingBottom)}setPaddingRight(e){let t=wt(e);this._paddingRight!==t&&(this._paddingRight=t,this.domNode.style.paddingRight=this._paddingRight)}setFontFamily(e){this._fontFamily!==e&&(this._fontFamily=e,this.domNode.style.fontFamily=this._fontFamily)}setFontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.domNode.style.fontWeight=this._fontWeight)}setFontSize(e){let t=wt(e);this._fontSize!==t&&(this._fontSize=t,this.domNode.style.fontSize=this._fontSize)}setFontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.domNode.style.fontStyle=this._fontStyle)}setFontFeatureSettings(e){this._fontFeatureSettings!==e&&(this._fontFeatureSettings=e,this.domNode.style.fontFeatureSettings=this._fontFeatureSettings)}setFontVariationSettings(e){this._fontVariationSettings!==e&&(this._fontVariationSettings=e,this.domNode.style.fontVariationSettings=this._fontVariationSettings)}setTextDecoration(e){this._textDecoration!==e&&(this._textDecoration=e,this.domNode.style.textDecoration=this._textDecoration)}setLineHeight(e){let t=wt(e);this._lineHeight!==t&&(this._lineHeight=t,this.domNode.style.lineHeight=this._lineHeight)}setLetterSpacing(e){let t=wt(e);this._letterSpacing!==t&&(this._letterSpacing=t,this.domNode.style.letterSpacing=this._letterSpacing)}setClassName(e){this._className!==e&&(this._className=e,this.domNode.className=this._className)}toggleClassName(e,t){this.domNode.classList.toggle(e,t),this._className=this.domNode.className}setDisplay(e){this._display!==e&&(this._display=e,this.domNode.style.display=this._display)}setPosition(e){this._position!==e&&(this._position=e,this.domNode.style.position=this._position)}setVisibility(e){this._visibility!==e&&(this._visibility=e,this.domNode.style.visibility=this._visibility)}setColor(e){this._color!==e&&(this._color=e,this.domNode.style.color=this._color)}setBackgroundColor(e){this._backgroundColor!==e&&(this._backgroundColor=e,this.domNode.style.backgroundColor=this._backgroundColor)}setLayerHinting(e){this._layerHint!==e&&(this._layerHint=e,this.domNode.style.transform=this._layerHint?"translate3d(0px, 0px, 0px)":"")}setBoxShadow(e){this._boxShadow!==e&&(this._boxShadow=e,this.domNode.style.boxShadow=e)}setContain(e){this._contain!==e&&(this._contain=e,this.domNode.style.contain=this._contain)}setAttribute(e,t){this.domNode.setAttribute(e,t)}removeAttribute(e){this.domNode.removeAttribute(e)}appendChild(e){this.domNode.appendChild(e.domNode)}removeChild(e){this.domNode.removeChild(e.domNode)}};function wt(e){return typeof e=="number"?`${e}px`:e}function Tn(e){return new T5(e)}var jv=class{constructor(){this._hooks=new _r,this._pointerMoveCallback=null,this._onStopCallback=null}dispose(){this.stopMonitoring(!1),this._hooks.dispose()}stopMonitoring(e,t){if(!this.isMonitoring())return;this._hooks.clear(),this._pointerMoveCallback=null;let i=this._onStopCallback;this._onStopCallback=null,e&&i&&i(t)}isMonitoring(){return!!this._pointerMoveCallback}startMonitoring(e,t,i,r,s){this.isMonitoring()&&this.stopMonitoring(!1),this._pointerMoveCallback=r,this._onStopCallback=s;let n=e;try{e.setPointerCapture(t),this._hooks.add(be(()=>{try{e.releasePointerCapture(t)}catch{}}))}catch{n=Vt(e)}this._hooks.add(se(n,$e.POINTER_MOVE,o=>{if(o.buttons!==i){this.stopMonitoring(!0);return}o.preventDefault(),this._pointerMoveCallback(o)})),this._hooks.add(se(n,$e.POINTER_UP,o=>this.stopMonitoring(!0)))}};function R5(e,t,i){let r=null,s=null;if(typeof i.value=="function"?(r="value",s=i.value,s.length!==0&&console.warn("Memoize should only be used in functions with zero parameters")):typeof i.get=="function"&&(r="get",s=i.get),!s)throw new Error("not supported");let n=`$memoize$${t}`;i[r]=function(...o){return this.hasOwnProperty(n)||Object.defineProperty(this,n,{configurable:!1,enumerable:!1,writable:!1,value:s.apply(this,o)}),this[n]}}var ui;(e=>(e.Tap="-xterm-gesturetap",e.Change="-xterm-gesturechange",e.Start="-xterm-gesturestart",e.End="-xterm-gesturesend",e.Contextmenu="-xterm-gesturecontextmenu"))(ui||={});var En=class ct extends oe{constructor(){super(),this.dispatched=!1,this.targets=new bp,this.ignoreTargets=new bp,this.activeTouches={},this.handle=null,this._lastSetTapCountTime=0,this._register(rt.runAndSubscribe(S5,({window:t,disposables:i})=>{i.add(se(t.document,"touchstart",r=>this.onTouchStart(r),{passive:!1})),i.add(se(t.document,"touchend",r=>this.onTouchEnd(t,r))),i.add(se(t.document,"touchmove",r=>this.onTouchMove(r),{passive:!1}))},{window:Lt,disposables:this._store}))}static addTarget(t){if(!ct.isTouchDevice())return oe.None;ct.INSTANCE||(ct.INSTANCE=yp(new ct));let i=ct.INSTANCE.targets.push(t);return be(i)}static ignoreTarget(t){if(!ct.isTouchDevice())return oe.None;ct.INSTANCE||(ct.INSTANCE=yp(new ct));let i=ct.INSTANCE.ignoreTargets.push(t);return be(i)}static isTouchDevice(){return"ontouchstart"in Lt||navigator.maxTouchPoints>0}dispose(){this.handle&&(this.handle.dispose(),this.handle=null),super.dispose()}onTouchStart(t){let i=Date.now();this.handle&&(this.handle.dispose(),this.handle=null);for(let r=0,s=t.targetTouches.length;r<s;r++){let n=t.targetTouches.item(r);this.activeTouches[n.identifier]={id:n.identifier,initialTarget:n.target,initialTimeStamp:i,initialPageX:n.pageX,initialPageY:n.pageY,rollingTimestamps:[i],rollingPageX:[n.pageX],rollingPageY:[n.pageY]};let o=this.newGestureEvent(ui.Start,n.target);o.pageX=n.pageX,o.pageY=n.pageY,this.dispatchEvent(o)}this.dispatched&&(t.preventDefault(),t.stopPropagation(),this.dispatched=!1)}onTouchEnd(t,i){let r=Date.now(),s=Object.keys(this.activeTouches).length;for(let n=0,o=i.changedTouches.length;n<o;n++){let a=i.changedTouches.item(n);if(!this.activeTouches.hasOwnProperty(String(a.identifier))){console.warn("move of an UNKNOWN touch",a);continue}let h=this.activeTouches[a.identifier],l=Date.now()-h.initialTimeStamp;if(l<ct.HOLD_DELAY&&Math.abs(h.initialPageX-kt(h.rollingPageX))<30&&Math.abs(h.initialPageY-kt(h.rollingPageY))<30){let c=this.newGestureEvent(ui.Tap,h.initialTarget);c.pageX=kt(h.rollingPageX),c.pageY=kt(h.rollingPageY),this.dispatchEvent(c)}else if(l>=ct.HOLD_DELAY&&Math.abs(h.initialPageX-kt(h.rollingPageX))<30&&Math.abs(h.initialPageY-kt(h.rollingPageY))<30){let c=this.newGestureEvent(ui.Contextmenu,h.initialTarget);c.pageX=kt(h.rollingPageX),c.pageY=kt(h.rollingPageY),this.dispatchEvent(c)}else if(s===1){let c=kt(h.rollingPageX),u=kt(h.rollingPageY),p=kt(h.rollingTimestamps)-h.rollingTimestamps[0],g=c-h.rollingPageX[0],v=u-h.rollingPageY[0],m=[...this.targets].filter(x=>h.initialTarget instanceof Node&&x.contains(h.initialTarget));this.inertia(t,m,r,Math.abs(g)/p,g>0?1:-1,c,Math.abs(v)/p,v>0?1:-1,u)}this.dispatchEvent(this.newGestureEvent(ui.End,h.initialTarget)),delete this.activeTouches[a.identifier]}this.dispatched&&(i.preventDefault(),i.stopPropagation(),this.dispatched=!1)}newGestureEvent(t,i){let r=document.createEvent("CustomEvent");return r.initEvent(t,!1,!0),r.initialTarget=i,r.tapCount=0,r}dispatchEvent(t){if(t.type===ui.Tap){let i=new Date().getTime(),r=0;i-this._lastSetTapCountTime>ct.CLEAR_TAP_COUNT_TIME?r=1:r=2,this._lastSetTapCountTime=i,t.tapCount=r}else(t.type===ui.Change||t.type===ui.Contextmenu)&&(this._lastSetTapCountTime=0);if(t.initialTarget instanceof Node){for(let r of this.ignoreTargets)if(r.contains(t.initialTarget))return;let i=[];for(let r of this.targets)if(r.contains(t.initialTarget)){let s=0,n=t.initialTarget;for(;n&&n!==r;)s++,n=n.parentElement;i.push([s,r])}i.sort((r,s)=>r[0]-s[0]);for(let[r,s]of i)s.dispatchEvent(t),this.dispatched=!0}}inertia(t,i,r,s,n,o,a,h,l){this.handle=Ta(t,()=>{let c=Date.now(),u=c-r,p=0,g=0,v=!0;s+=ct.SCROLL_FRICTION*u,a+=ct.SCROLL_FRICTION*u,s>0&&(v=!1,p=n*s*u),a>0&&(v=!1,g=h*a*u);let m=this.newGestureEvent(ui.Change);m.translationX=p,m.translationY=g,i.forEach(x=>x.dispatchEvent(m)),v||this.inertia(t,i,c,s,n,o+p,a,h,l+g)})}onTouchMove(t){let i=Date.now();for(let r=0,s=t.changedTouches.length;r<s;r++){let n=t.changedTouches.item(r);if(!this.activeTouches.hasOwnProperty(String(n.identifier))){console.warn("end of an UNKNOWN touch",n);continue}let o=this.activeTouches[n.identifier],a=this.newGestureEvent(ui.Change,o.initialTarget);a.translationX=n.pageX-kt(o.rollingPageX),a.translationY=n.pageY-kt(o.rollingPageY),a.pageX=n.pageX,a.pageY=n.pageY,this.dispatchEvent(a),o.rollingPageX.length>3&&(o.rollingPageX.shift(),o.rollingPageY.shift(),o.rollingTimestamps.shift()),o.rollingPageX.push(n.pageX),o.rollingPageY.push(n.pageY),o.rollingTimestamps.push(i)}this.dispatched&&(t.preventDefault(),t.stopPropagation(),this.dispatched=!1)}};En.SCROLL_FRICTION=-.005,En.HOLD_DELAY=700,En.CLEAR_TAP_COUNT_TIME=400,De([R5],En,"isTouchDevice",1);var F5=En,wu=class extends oe{onclick(e,t){this._register(se(e,$e.CLICK,i=>t(new kn(Vt(e),i))))}onmousedown(e,t){this._register(se(e,$e.MOUSE_DOWN,i=>t(new kn(Vt(e),i))))}onmouseover(e,t){this._register(se(e,$e.MOUSE_OVER,i=>t(new kn(Vt(e),i))))}onmouseleave(e,t){this._register(se(e,$e.MOUSE_LEAVE,i=>t(new kn(Vt(e),i))))}onkeydown(e,t){this._register(se(e,$e.KEY_DOWN,i=>t(new Wc(i))))}onkeyup(e,t){this._register(se(e,$e.KEY_UP,i=>t(new Wc(i))))}oninput(e,t){this._register(se(e,$e.INPUT,t))}onblur(e,t){this._register(se(e,$e.BLUR,t))}onfocus(e,t){this._register(se(e,$e.FOCUS,t))}onchange(e,t){this._register(se(e,$e.CHANGE,t))}ignoreGesture(e){return F5.ignoreTarget(e)}},Rp=11,P5=class extends wu{constructor(e){super(),this._onActivate=e.onActivate,this.bgDomNode=document.createElement("div"),this.bgDomNode.className="arrow-background",this.bgDomNode.style.position="absolute",this.bgDomNode.style.width=e.bgWidth+"px",this.bgDomNode.style.height=e.bgHeight+"px",typeof e.top<"u"&&(this.bgDomNode.style.top="0px"),typeof e.left<"u"&&(this.bgDomNode.style.left="0px"),typeof e.bottom<"u"&&(this.bgDomNode.style.bottom="0px"),typeof e.right<"u"&&(this.bgDomNode.style.right="0px"),this.domNode=document.createElement("div"),this.domNode.className=e.className,this.domNode.style.position="absolute",this.domNode.style.width=Rp+"px",this.domNode.style.height=Rp+"px",typeof e.top<"u"&&(this.domNode.style.top=e.top+"px"),typeof e.left<"u"&&(this.domNode.style.left=e.left+"px"),typeof e.bottom<"u"&&(this.domNode.style.bottom=e.bottom+"px"),typeof e.right<"u"&&(this.domNode.style.right=e.right+"px"),this._pointerMoveMonitor=this._register(new jv),this._register(Mp(this.bgDomNode,$e.POINTER_DOWN,t=>this._arrowPointerDown(t))),this._register(Mp(this.domNode,$e.POINTER_DOWN,t=>this._arrowPointerDown(t))),this._pointerdownRepeatTimer=this._register(new L5),this._pointerdownScheduleRepeatTimer=this._register(new yu)}_arrowPointerDown(e){if(!e.target||!(e.target instanceof Element))return;let t=()=>{this._pointerdownRepeatTimer.cancelAndSet(()=>this._onActivate(),1e3/24,Vt(e))};this._onActivate(),this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancelAndSet(t,200),this._pointerMoveMonitor.startMonitoring(e.target,e.pointerId,e.buttons,i=>{},()=>{this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancel()}),e.preventDefault()}},O5=class $c{constructor(t,i,r,s,n,o,a){this._forceIntegerValues=t,this._scrollStateBrand=void 0,this._forceIntegerValues&&(i=i|0,r=r|0,s=s|0,n=n|0,o=o|0,a=a|0),this.rawScrollLeft=s,this.rawScrollTop=a,i<0&&(i=0),s+i>r&&(s=r-i),s<0&&(s=0),n<0&&(n=0),a+n>o&&(a=o-n),a<0&&(a=0),this.width=i,this.scrollWidth=r,this.scrollLeft=s,this.height=n,this.scrollHeight=o,this.scrollTop=a}equals(t){return this.rawScrollLeft===t.rawScrollLeft&&this.rawScrollTop===t.rawScrollTop&&this.width===t.width&&this.scrollWidth===t.scrollWidth&&this.scrollLeft===t.scrollLeft&&this.height===t.height&&this.scrollHeight===t.scrollHeight&&this.scrollTop===t.scrollTop}withScrollDimensions(t,i){return new $c(this._forceIntegerValues,typeof t.width<"u"?t.width:this.width,typeof t.scrollWidth<"u"?t.scrollWidth:this.scrollWidth,i?this.rawScrollLeft:this.scrollLeft,typeof t.height<"u"?t.height:this.height,typeof t.scrollHeight<"u"?t.scrollHeight:this.scrollHeight,i?this.rawScrollTop:this.scrollTop)}withScrollPosition(t){return new $c(this._forceIntegerValues,this.width,this.scrollWidth,typeof t.scrollLeft<"u"?t.scrollLeft:this.rawScrollLeft,this.height,this.scrollHeight,typeof t.scrollTop<"u"?t.scrollTop:this.rawScrollTop)}createScrollEvent(t,i){let r=this.width!==t.width,s=this.scrollWidth!==t.scrollWidth,n=this.scrollLeft!==t.scrollLeft,o=this.height!==t.height,a=this.scrollHeight!==t.scrollHeight,h=this.scrollTop!==t.scrollTop;return{inSmoothScrolling:i,oldWidth:t.width,oldScrollWidth:t.scrollWidth,oldScrollLeft:t.scrollLeft,width:this.width,scrollWidth:this.scrollWidth,scrollLeft:this.scrollLeft,oldHeight:t.height,oldScrollHeight:t.scrollHeight,oldScrollTop:t.scrollTop,height:this.height,scrollHeight:this.scrollHeight,scrollTop:this.scrollTop,widthChanged:r,scrollWidthChanged:s,scrollLeftChanged:n,heightChanged:o,scrollHeightChanged:a,scrollTopChanged:h}}},K5=class extends oe{constructor(e){super(),this._scrollableBrand=void 0,this._onScroll=this._register(new Y),this.onScroll=this._onScroll.event,this._smoothScrollDuration=e.smoothScrollDuration,this._scheduleAtNextAnimationFrame=e.scheduleAtNextAnimationFrame,this._state=new O5(e.forceIntegerValues,0,0,0,0,0,0),this._smoothScrolling=null}dispose(){this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),super.dispose()}setSmoothScrollDuration(e){this._smoothScrollDuration=e}validateScrollPosition(e){return this._state.withScrollPosition(e)}getScrollDimensions(){return this._state}setScrollDimensions(e,t){let i=this._state.withScrollDimensions(e,t);this._setState(i,!!this._smoothScrolling),this._smoothScrolling?.acceptScrollDimensions(this._state)}getFutureScrollPosition(){return this._smoothScrolling?this._smoothScrolling.to:this._state}getCurrentScrollPosition(){return this._state}setScrollPositionNow(e){let t=this._state.withScrollPosition(e);this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),this._setState(t,!1)}setScrollPositionSmooth(e,t){if(this._smoothScrollDuration===0)return this.setScrollPositionNow(e);if(this._smoothScrolling){e={scrollLeft:typeof e.scrollLeft>"u"?this._smoothScrolling.to.scrollLeft:e.scrollLeft,scrollTop:typeof e.scrollTop>"u"?this._smoothScrolling.to.scrollTop:e.scrollTop};let i=this._state.withScrollPosition(e);if(this._smoothScrolling.to.scrollLeft===i.scrollLeft&&this._smoothScrolling.to.scrollTop===i.scrollTop)return;let r;t?r=new Pp(this._smoothScrolling.from,i,this._smoothScrolling.startTime,this._smoothScrolling.duration):r=this._smoothScrolling.combine(this._state,i,this._smoothScrollDuration),this._smoothScrolling.dispose(),this._smoothScrolling=r}else{let i=this._state.withScrollPosition(e);this._smoothScrolling=Pp.start(this._state,i,this._smoothScrollDuration)}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}hasPendingScrollAnimation(){return!!this._smoothScrolling}_performSmoothScrolling(){if(!this._smoothScrolling)return;let e=this._smoothScrolling.tick(),t=this._state.withScrollPosition(e);if(this._setState(t,!0),!!this._smoothScrolling){if(e.isDone){this._smoothScrolling.dispose(),this._smoothScrolling=null;return}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}}_setState(e,t){let i=this._state;i.equals(e)||(this._state=e,this._onScroll.fire(this._state.createScrollEvent(i,t)))}},Fp=class{constructor(e,t,i){this.scrollLeft=e,this.scrollTop=t,this.isDone=i}};function wc(e,t){let i=t-e;return function(r){return e+i*H5(r)}}function N5(e,t,i){return function(r){return r<i?e(r/i):t((r-i)/(1-i))}}var Pp=class Gc{constructor(t,i,r,s){this.from=t,this.to=i,this.duration=s,this.startTime=r,this.animationFrameDisposable=null,this._initAnimations()}_initAnimations(){this.scrollLeft=this._initAnimation(this.from.scrollLeft,this.to.scrollLeft,this.to.width),this.scrollTop=this._initAnimation(this.from.scrollTop,this.to.scrollTop,this.to.height)}_initAnimation(t,i,r){if(Math.abs(t-i)>2.5*r){let s,n;return t<i?(s=t+.75*r,n=i-.75*r):(s=t-.75*r,n=i+.75*r),N5(wc(t,s),wc(n,i),.33)}return wc(t,i)}dispose(){this.animationFrameDisposable!==null&&(this.animationFrameDisposable.dispose(),this.animationFrameDisposable=null)}acceptScrollDimensions(t){this.to=t.withScrollPosition(this.to),this._initAnimations()}tick(){return this._tick(Date.now())}_tick(t){let i=(t-this.startTime)/this.duration;if(i<1){let r=this.scrollLeft(i),s=this.scrollTop(i);return new Fp(r,s,!1)}return new Fp(this.to.scrollLeft,this.to.scrollTop,!0)}combine(t,i,r){return Gc.start(t,i,r)}static start(t,i,r){r=r+10;let s=Date.now()-10;return new Gc(t,i,s,r)}};function Q5(e){return Math.pow(e,3)}function H5(e){return 1-Q5(1-e)}var X5=class extends oe{constructor(e,t,i){super(),this._visibility=e,this._visibleClassName=t,this._invisibleClassName=i,this._domNode=null,this._isVisible=!1,this._isNeeded=!1,this._rawShouldBeVisible=!1,this._shouldBeVisible=!1,this._revealTimer=this._register(new yu)}setVisibility(e){this._visibility!==e&&(this._visibility=e,this._updateShouldBeVisible())}setShouldBeVisible(e){this._rawShouldBeVisible=e,this._updateShouldBeVisible()}_applyVisibilitySetting(){return this._visibility===2?!1:this._visibility===3?!0:this._rawShouldBeVisible}_updateShouldBeVisible(){let e=this._applyVisibilitySetting();this._shouldBeVisible!==e&&(this._shouldBeVisible=e,this.ensureVisibility())}setIsNeeded(e){this._isNeeded!==e&&(this._isNeeded=e,this.ensureVisibility())}setDomNode(e){this._domNode=e,this._domNode.setClassName(this._invisibleClassName),this.setShouldBeVisible(!1)}ensureVisibility(){if(!this._isNeeded){this._hide(!1);return}this._shouldBeVisible?this._reveal():this._hide(!0)}_reveal(){this._isVisible||(this._isVisible=!0,this._revealTimer.setIfNotSet(()=>{this._domNode?.setClassName(this._visibleClassName)},0))}_hide(e){this._revealTimer.cancel(),this._isVisible&&(this._isVisible=!1,this._domNode?.setClassName(this._invisibleClassName+(e?" fade":"")))}},U5=140,qv=class extends wu{constructor(e){super(),this._lazyRender=e.lazyRender,this._host=e.host,this._scrollable=e.scrollable,this._scrollByPage=e.scrollByPage,this._scrollbarState=e.scrollbarState,this._visibilityController=this._register(new X5(e.visibility,"visible scrollbar "+e.extraScrollbarClassName,"invisible scrollbar "+e.extraScrollbarClassName)),this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._pointerMoveMonitor=this._register(new jv),this._shouldRender=!0,this.domNode=Tn(document.createElement("div")),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this._visibilityController.setDomNode(this.domNode),this.domNode.setPosition("absolute"),this._register(se(this.domNode.domNode,$e.POINTER_DOWN,t=>this._domNodePointerDown(t)))}_createArrow(e){let t=this._register(new P5(e));this.domNode.domNode.appendChild(t.bgDomNode),this.domNode.domNode.appendChild(t.domNode)}_createSlider(e,t,i,r){this.slider=Tn(document.createElement("div")),this.slider.setClassName("slider"),this.slider.setPosition("absolute"),this.slider.setTop(e),this.slider.setLeft(t),typeof i=="number"&&this.slider.setWidth(i),typeof r=="number"&&this.slider.setHeight(r),this.slider.setLayerHinting(!0),this.slider.setContain("strict"),this.domNode.domNode.appendChild(this.slider.domNode),this._register(se(this.slider.domNode,$e.POINTER_DOWN,s=>{s.button===0&&(s.preventDefault(),this._sliderPointerDown(s))})),this.onclick(this.slider.domNode,s=>{s.leftButton&&s.stopPropagation()})}_onElementSize(e){return this._scrollbarState.setVisibleSize(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}_onElementScrollSize(e){return this._scrollbarState.setScrollSize(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}_onElementScrollPosition(e){return this._scrollbarState.setScrollPosition(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}beginReveal(){this._visibilityController.setShouldBeVisible(!0)}beginHide(){this._visibilityController.setShouldBeVisible(!1)}render(){this._shouldRender&&(this._shouldRender=!1,this._renderDomNode(this._scrollbarState.getRectangleLargeSize(),this._scrollbarState.getRectangleSmallSize()),this._updateSlider(this._scrollbarState.getSliderSize(),this._scrollbarState.getArrowSize()+this._scrollbarState.getSliderPosition()))}_domNodePointerDown(e){e.target===this.domNode.domNode&&this._onPointerDown(e)}delegatePointerDown(e){let t=this.domNode.domNode.getClientRects()[0].top,i=t+this._scrollbarState.getSliderPosition(),r=t+this._scrollbarState.getSliderPosition()+this._scrollbarState.getSliderSize(),s=this._sliderPointerPosition(e);i<=s&&s<=r?e.button===0&&(e.preventDefault(),this._sliderPointerDown(e)):this._onPointerDown(e)}_onPointerDown(e){let t,i;if(e.target===this.domNode.domNode&&typeof e.offsetX=="number"&&typeof e.offsetY=="number")t=e.offsetX,i=e.offsetY;else{let s=D5(this.domNode.domNode);t=e.pageX-s.left,i=e.pageY-s.top}let r=this._pointerDownRelativePosition(t,i);this._setDesiredScrollPositionNow(this._scrollByPage?this._scrollbarState.getDesiredScrollPositionFromOffsetPaged(r):this._scrollbarState.getDesiredScrollPositionFromOffset(r)),e.button===0&&(e.preventDefault(),this._sliderPointerDown(e))}_sliderPointerDown(e){if(!e.target||!(e.target instanceof Element))return;let t=this._sliderPointerPosition(e),i=this._sliderOrthogonalPointerPosition(e),r=this._scrollbarState.clone();this.slider.toggleClassName("active",!0),this._pointerMoveMonitor.startMonitoring(e.target,e.pointerId,e.buttons,s=>{let n=this._sliderOrthogonalPointerPosition(s),o=Math.abs(n-i);if(Hv&&o>U5){this._setDesiredScrollPositionNow(r.getScrollPosition());return}let a=this._sliderPointerPosition(s)-t;this._setDesiredScrollPositionNow(r.getDesiredScrollPositionFromDelta(a))},()=>{this.slider.toggleClassName("active",!1),this._host.onDragEnd()}),this._host.onDragStart()}_setDesiredScrollPositionNow(e){let t={};this.writeScrollPosition(t,e),this._scrollable.setScrollPositionNow(t)}updateScrollbarSize(e){this._updateScrollbarSize(e),this._scrollbarState.setScrollbarSize(e),this._shouldRender=!0,this._lazyRender||this.render()}isNeeded(){return this._scrollbarState.isNeeded()}},Vv=class jc{constructor(t,i,r,s,n,o){this._scrollbarSize=Math.round(i),this._oppositeScrollbarSize=Math.round(r),this._arrowSize=Math.round(t),this._visibleSize=s,this._scrollSize=n,this._scrollPosition=o,this._computedAvailableSize=0,this._computedIsNeeded=!1,this._computedSliderSize=0,this._computedSliderRatio=0,this._computedSliderPosition=0,this._refreshComputedValues()}clone(){return new jc(this._arrowSize,this._scrollbarSize,this._oppositeScrollbarSize,this._visibleSize,this._scrollSize,this._scrollPosition)}setVisibleSize(t){let i=Math.round(t);return this._visibleSize!==i?(this._visibleSize=i,this._refreshComputedValues(),!0):!1}setScrollSize(t){let i=Math.round(t);return this._scrollSize!==i?(this._scrollSize=i,this._refreshComputedValues(),!0):!1}setScrollPosition(t){let i=Math.round(t);return this._scrollPosition!==i?(this._scrollPosition=i,this._refreshComputedValues(),!0):!1}setScrollbarSize(t){this._scrollbarSize=Math.round(t)}setOppositeScrollbarSize(t){this._oppositeScrollbarSize=Math.round(t)}static _computeValues(t,i,r,s,n){let o=Math.max(0,r-t),a=Math.max(0,o-2*i),h=s>0&&s>r;if(!h)return{computedAvailableSize:Math.round(o),computedIsNeeded:h,computedSliderSize:Math.round(a),computedSliderRatio:0,computedSliderPosition:0};let l=Math.round(Math.max(20,Math.floor(r*a/s))),c=(a-l)/(s-r),u=n*c;return{computedAvailableSize:Math.round(o),computedIsNeeded:h,computedSliderSize:Math.round(l),computedSliderRatio:c,computedSliderPosition:Math.round(u)}}_refreshComputedValues(){let t=jc._computeValues(this._oppositeScrollbarSize,this._arrowSize,this._visibleSize,this._scrollSize,this._scrollPosition);this._computedAvailableSize=t.computedAvailableSize,this._computedIsNeeded=t.computedIsNeeded,this._computedSliderSize=t.computedSliderSize,this._computedSliderRatio=t.computedSliderRatio,this._computedSliderPosition=t.computedSliderPosition}getArrowSize(){return this._arrowSize}getScrollPosition(){return this._scrollPosition}getRectangleLargeSize(){return this._computedAvailableSize}getRectangleSmallSize(){return this._scrollbarSize}isNeeded(){return this._computedIsNeeded}getSliderSize(){return this._computedSliderSize}getSliderPosition(){return this._computedSliderPosition}getDesiredScrollPositionFromOffset(t){if(!this._computedIsNeeded)return 0;let i=t-this._arrowSize-this._computedSliderSize/2;return Math.round(i/this._computedSliderRatio)}getDesiredScrollPositionFromOffsetPaged(t){if(!this._computedIsNeeded)return 0;let i=t-this._arrowSize,r=this._scrollPosition;return i<this._computedSliderPosition?r-=this._visibleSize:r+=this._visibleSize,r}getDesiredScrollPositionFromDelta(t){if(!this._computedIsNeeded)return 0;let i=this._computedSliderPosition+t;return Math.round(i/this._computedSliderRatio)}},z5=class extends qv{constructor(e,t,i){let r=e.getScrollDimensions(),s=e.getCurrentScrollPosition();if(super({lazyRender:t.lazyRender,host:i,scrollbarState:new Vv(t.horizontalHasArrows?t.arrowSize:0,t.horizontal===2?0:t.horizontalScrollbarSize,t.vertical===2?0:t.verticalScrollbarSize,r.width,r.scrollWidth,s.scrollLeft),visibility:t.horizontal,extraScrollbarClassName:"horizontal",scrollable:e,scrollByPage:t.scrollByPage}),t.horizontalHasArrows)throw new Error("horizontalHasArrows is not supported in xterm.js");this._createSlider(Math.floor((t.horizontalScrollbarSize-t.horizontalSliderSize)/2),0,void 0,t.horizontalSliderSize)}_updateSlider(e,t){this.slider.setWidth(e),this.slider.setLeft(t)}_renderDomNode(e,t){this.domNode.setWidth(e),this.domNode.setHeight(t),this.domNode.setLeft(0),this.domNode.setBottom(0)}onDidScroll(e){return this._shouldRender=this._onElementScrollSize(e.scrollWidth)||this._shouldRender,this._shouldRender=this._onElementScrollPosition(e.scrollLeft)||this._shouldRender,this._shouldRender=this._onElementSize(e.width)||this._shouldRender,this._shouldRender}_pointerDownRelativePosition(e,t){return e}_sliderPointerPosition(e){return e.pageX}_sliderOrthogonalPointerPosition(e){return e.pageY}_updateScrollbarSize(e){this.slider.setHeight(e)}writeScrollPosition(e,t){e.scrollLeft=t}updateOptions(e){this.updateScrollbarSize(e.horizontal===2?0:e.horizontalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(e.vertical===2?0:e.verticalScrollbarSize),this._visibilityController.setVisibility(e.horizontal),this._scrollByPage=e.scrollByPage}},W5=class extends qv{constructor(e,t,i){let r=e.getScrollDimensions(),s=e.getCurrentScrollPosition();if(super({lazyRender:t.lazyRender,host:i,scrollbarState:new Vv(t.verticalHasArrows?t.arrowSize:0,t.vertical===2?0:t.verticalScrollbarSize,0,r.height,r.scrollHeight,s.scrollTop),visibility:t.vertical,extraScrollbarClassName:"vertical",scrollable:e,scrollByPage:t.scrollByPage}),t.verticalHasArrows)throw new Error("horizontalHasArrows is not supported in xterm.js");this._createSlider(0,Math.floor((t.verticalScrollbarSize-t.verticalSliderSize)/2),t.verticalSliderSize,void 0)}_updateSlider(e,t){this.slider.setHeight(e),this.slider.setTop(t)}_renderDomNode(e,t){this.domNode.setWidth(t),this.domNode.setHeight(e),this.domNode.setRight(0),this.domNode.setTop(0)}onDidScroll(e){return this._shouldRender=this._onElementScrollSize(e.scrollHeight)||this._shouldRender,this._shouldRender=this._onElementScrollPosition(e.scrollTop)||this._shouldRender,this._shouldRender=this._onElementSize(e.height)||this._shouldRender,this._shouldRender}_pointerDownRelativePosition(e,t){return t}_sliderPointerPosition(e){return e.pageY}_sliderOrthogonalPointerPosition(e){return e.pageX}_updateScrollbarSize(e){this.slider.setWidth(e)}writeScrollPosition(e,t){e.scrollTop=t}updateOptions(e){this.updateScrollbarSize(e.vertical===2?0:e.verticalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(0),this._visibilityController.setVisibility(e.vertical),this._scrollByPage=e.scrollByPage}},$5=500,Op=50,Kp=!0,G5=class{constructor(e,t,i){this.timestamp=e,this.deltaX=t,this.deltaY=i,this.score=0}},qc=class{constructor(){this._capacity=5,this._memory=[],this._front=-1,this._rear=-1}isPhysicalMouseWheel(){if(this._front===-1&&this._rear===-1)return!1;let t=1,i=0,r=1,s=this._rear;do{let n=s===this._front?t:Math.pow(2,-r);if(t-=n,i+=this._memory[s].score*n,s===this._front)break;s=(this._capacity+s-1)%this._capacity,r++}while(!0);return i<=.5}acceptStandardWheelEvent(t){if(vu){let i=Vt(t.browserEvent),r=Q2(i);this.accept(Date.now(),t.deltaX*r,t.deltaY*r)}else this.accept(Date.now(),t.deltaX,t.deltaY)}accept(t,i,r){let s=null,n=new G5(t,i,r);this._front===-1&&this._rear===-1?(this._memory[0]=n,this._front=0,this._rear=0):(s=this._memory[this._rear],this._rear=(this._rear+1)%this._capacity,this._rear===this._front&&(this._front=(this._front+1)%this._capacity),this._memory[this._rear]=n),n.score=this._computeScore(n,s)}_computeScore(t,i){if(Math.abs(t.deltaX)>0&&Math.abs(t.deltaY)>0)return 1;let r=.5;if((!this._isAlmostInt(t.deltaX)||!this._isAlmostInt(t.deltaY))&&(r+=.25),i){let s=Math.abs(t.deltaX),n=Math.abs(t.deltaY),o=Math.abs(i.deltaX),a=Math.abs(i.deltaY),h=Math.max(Math.min(s,o),1),l=Math.max(Math.min(n,a),1),c=Math.max(s,o),u=Math.max(n,a);c%h===0&&u%l===0&&(r-=.5)}return Math.min(Math.max(r,0),1)}_isAlmostInt(t){return Math.abs(Math.round(t)-t)<.01}};qc.INSTANCE=new qc;var j5=qc,q5=class extends wu{constructor(e,t,i){super(),this._onScroll=this._register(new Y),this.onScroll=this._onScroll.event,this._onWillScroll=this._register(new Y),this.onWillScroll=this._onWillScroll.event,this._options=Y5(t),this._scrollable=i,this._register(this._scrollable.onScroll(s=>{this._onWillScroll.fire(s),this._onDidScroll(s),this._onScroll.fire(s)}));let r={onMouseWheel:s=>this._onMouseWheel(s),onDragStart:()=>this._onDragStart(),onDragEnd:()=>this._onDragEnd()};this._verticalScrollbar=this._register(new W5(this._scrollable,this._options,r)),this._horizontalScrollbar=this._register(new z5(this._scrollable,this._options,r)),this._domNode=document.createElement("div"),this._domNode.className="xterm-scrollable-element "+this._options.className,this._domNode.setAttribute("role","presentation"),this._domNode.style.position="relative",this._domNode.appendChild(e),this._domNode.appendChild(this._horizontalScrollbar.domNode.domNode),this._domNode.appendChild(this._verticalScrollbar.domNode.domNode),this._options.useShadows?(this._leftShadowDomNode=Tn(document.createElement("div")),this._leftShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._leftShadowDomNode.domNode),this._topShadowDomNode=Tn(document.createElement("div")),this._topShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._topShadowDomNode.domNode),this._topLeftShadowDomNode=Tn(document.createElement("div")),this._topLeftShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._topLeftShadowDomNode.domNode)):(this._leftShadowDomNode=null,this._topShadowDomNode=null,this._topLeftShadowDomNode=null),this._listenOnDomNode=this._options.listenOnDomNode||this._domNode,this._mouseWheelToDispose=[],this._setListeningToMouseWheel(this._options.handleMouseWheel),this.onmouseover(this._listenOnDomNode,s=>this._onMouseOver(s)),this.onmouseleave(this._listenOnDomNode,s=>this._onMouseLeave(s)),this._hideTimeout=this._register(new yu),this._isDragging=!1,this._mouseIsOver=!1,this._shouldRender=!0,this._revealOnScroll=!0}get options(){return this._options}dispose(){this._mouseWheelToDispose=Hr(this._mouseWheelToDispose),super.dispose()}getDomNode(){return this._domNode}getOverviewRulerLayoutInfo(){return{parent:this._domNode,insertBefore:this._verticalScrollbar.domNode.domNode}}delegateVerticalScrollbarPointerDown(e){this._verticalScrollbar.delegatePointerDown(e)}getScrollDimensions(){return this._scrollable.getScrollDimensions()}setScrollDimensions(e){this._scrollable.setScrollDimensions(e,!1)}updateClassName(e){this._options.className=e,di&&(this._options.className+=" mac"),this._domNode.className="xterm-scrollable-element "+this._options.className}updateOptions(e){typeof e.handleMouseWheel<"u"&&(this._options.handleMouseWheel=e.handleMouseWheel,this._setListeningToMouseWheel(this._options.handleMouseWheel)),typeof e.mouseWheelScrollSensitivity<"u"&&(this._options.mouseWheelScrollSensitivity=e.mouseWheelScrollSensitivity),typeof e.fastScrollSensitivity<"u"&&(this._options.fastScrollSensitivity=e.fastScrollSensitivity),typeof e.scrollPredominantAxis<"u"&&(this._options.scrollPredominantAxis=e.scrollPredominantAxis),typeof e.horizontal<"u"&&(this._options.horizontal=e.horizontal),typeof e.vertical<"u"&&(this._options.vertical=e.vertical),typeof e.horizontalScrollbarSize<"u"&&(this._options.horizontalScrollbarSize=e.horizontalScrollbarSize),typeof e.verticalScrollbarSize<"u"&&(this._options.verticalScrollbarSize=e.verticalScrollbarSize),typeof e.scrollByPage<"u"&&(this._options.scrollByPage=e.scrollByPage),this._horizontalScrollbar.updateOptions(this._options),this._verticalScrollbar.updateOptions(this._options),this._options.lazyRender||this._render()}setRevealOnScroll(e){this._revealOnScroll=e}delegateScrollFromMouseWheelEvent(e){this._onMouseWheel(new Ep(e))}_setListeningToMouseWheel(e){if(this._mouseWheelToDispose.length>0!==e&&(this._mouseWheelToDispose=Hr(this._mouseWheelToDispose),e)){let t=i=>{this._onMouseWheel(new Ep(i))};this._mouseWheelToDispose.push(se(this._listenOnDomNode,$e.MOUSE_WHEEL,t,{passive:!1}))}}_onMouseWheel(e){if(e.browserEvent?.defaultPrevented)return;let t=j5.INSTANCE;Kp&&t.acceptStandardWheelEvent(e);let i=!1;if(e.deltaY||e.deltaX){let s=e.deltaY*this._options.mouseWheelScrollSensitivity,n=e.deltaX*this._options.mouseWheelScrollSensitivity;this._options.scrollPredominantAxis&&(this._options.scrollYToX&&n+s===0?n=s=0:Math.abs(s)>=Math.abs(n)?n=0:s=0),this._options.flipAxes&&([s,n]=[n,s]);let o=!di&&e.browserEvent&&e.browserEvent.shiftKey;(this._options.scrollYToX||o)&&!n&&(n=s,s=0),e.browserEvent&&e.browserEvent.altKey&&(n=n*this._options.fastScrollSensitivity,s=s*this._options.fastScrollSensitivity);let a=this._scrollable.getFutureScrollPosition(),h={};if(s){let l=Op*s,c=a.scrollTop-(l<0?Math.floor(l):Math.ceil(l));this._verticalScrollbar.writeScrollPosition(h,c)}if(n){let l=Op*n,c=a.scrollLeft-(l<0?Math.floor(l):Math.ceil(l));this._horizontalScrollbar.writeScrollPosition(h,c)}h=this._scrollable.validateScrollPosition(h),(a.scrollLeft!==h.scrollLeft||a.scrollTop!==h.scrollTop)&&(Kp&&this._options.mouseWheelSmoothScroll&&t.isPhysicalMouseWheel()?this._scrollable.setScrollPositionSmooth(h):this._scrollable.setScrollPositionNow(h),i=!0)}let r=i;!r&&this._options.alwaysConsumeMouseWheel&&(r=!0),!r&&this._options.consumeMouseWheelIfScrollbarIsNeeded&&(this._verticalScrollbar.isNeeded()||this._horizontalScrollbar.isNeeded())&&(r=!0),r&&(e.preventDefault(),e.stopPropagation())}_onDidScroll(e){this._shouldRender=this._horizontalScrollbar.onDidScroll(e)||this._shouldRender,this._shouldRender=this._verticalScrollbar.onDidScroll(e)||this._shouldRender,this._options.useShadows&&(this._shouldRender=!0),this._revealOnScroll&&this._reveal(),this._options.lazyRender||this._render()}renderNow(){if(!this._options.lazyRender)throw new Error("Please use `lazyRender` together with `renderNow`!");this._render()}_render(){if(this._shouldRender&&(this._shouldRender=!1,this._horizontalScrollbar.render(),this._verticalScrollbar.render(),this._options.useShadows)){let e=this._scrollable.getCurrentScrollPosition(),t=e.scrollTop>0,i=e.scrollLeft>0,r=i?" left":"",s=t?" top":"",n=i||t?" top-left-corner":"";this._leftShadowDomNode.setClassName(`shadow${r}`),this._topShadowDomNode.setClassName(`shadow${s}`),this._topLeftShadowDomNode.setClassName(`shadow${n}${s}${r}`)}}_onDragStart(){this._isDragging=!0,this._reveal()}_onDragEnd(){this._isDragging=!1,this._hide()}_onMouseLeave(e){this._mouseIsOver=!1,this._hide()}_onMouseOver(e){this._mouseIsOver=!0,this._reveal()}_reveal(){this._verticalScrollbar.beginReveal(),this._horizontalScrollbar.beginReveal(),this._scheduleHide()}_hide(){!this._mouseIsOver&&!this._isDragging&&(this._verticalScrollbar.beginHide(),this._horizontalScrollbar.beginHide())}_scheduleHide(){!this._mouseIsOver&&!this._isDragging&&this._hideTimeout.cancelAndSet(()=>this._hide(),$5)}},V5=class extends q5{constructor(e,t,i){super(e,t,i)}setScrollPosition(e){e.reuseAnimation?this._scrollable.setScrollPositionSmooth(e,e.reuseAnimation):this._scrollable.setScrollPositionNow(e)}getScrollPosition(){return this._scrollable.getCurrentScrollPosition()}};function Y5(e){let t={lazyRender:typeof e.lazyRender<"u"?e.lazyRender:!1,className:typeof e.className<"u"?e.className:"",useShadows:typeof e.useShadows<"u"?e.useShadows:!0,handleMouseWheel:typeof e.handleMouseWheel<"u"?e.handleMouseWheel:!0,flipAxes:typeof e.flipAxes<"u"?e.flipAxes:!1,consumeMouseWheelIfScrollbarIsNeeded:typeof e.consumeMouseWheelIfScrollbarIsNeeded<"u"?e.consumeMouseWheelIfScrollbarIsNeeded:!1,alwaysConsumeMouseWheel:typeof e.alwaysConsumeMouseWheel<"u"?e.alwaysConsumeMouseWheel:!1,scrollYToX:typeof e.scrollYToX<"u"?e.scrollYToX:!1,mouseWheelScrollSensitivity:typeof e.mouseWheelScrollSensitivity<"u"?e.mouseWheelScrollSensitivity:1,fastScrollSensitivity:typeof e.fastScrollSensitivity<"u"?e.fastScrollSensitivity:5,scrollPredominantAxis:typeof e.scrollPredominantAxis<"u"?e.scrollPredominantAxis:!0,mouseWheelSmoothScroll:typeof e.mouseWheelSmoothScroll<"u"?e.mouseWheelSmoothScroll:!0,arrowSize:typeof e.arrowSize<"u"?e.arrowSize:11,listenOnDomNode:typeof e.listenOnDomNode<"u"?e.listenOnDomNode:null,horizontal:typeof e.horizontal<"u"?e.horizontal:1,horizontalScrollbarSize:typeof e.horizontalScrollbarSize<"u"?e.horizontalScrollbarSize:10,horizontalSliderSize:typeof e.horizontalSliderSize<"u"?e.horizontalSliderSize:0,horizontalHasArrows:typeof e.horizontalHasArrows<"u"?e.horizontalHasArrows:!1,vertical:typeof e.vertical<"u"?e.vertical:1,verticalScrollbarSize:typeof e.verticalScrollbarSize<"u"?e.verticalScrollbarSize:10,verticalHasArrows:typeof e.verticalHasArrows<"u"?e.verticalHasArrows:!1,verticalSliderSize:typeof e.verticalSliderSize<"u"?e.verticalSliderSize:0,scrollByPage:typeof e.scrollByPage<"u"?e.scrollByPage:!1};return t.horizontalSliderSize=typeof e.horizontalSliderSize<"u"?e.horizontalSliderSize:t.horizontalScrollbarSize,t.verticalSliderSize=typeof e.verticalSliderSize<"u"?e.verticalSliderSize:t.verticalScrollbarSize,di&&(t.className+=" mac"),t}var Vc=class extends oe{constructor(e,t,i,r,s,n,o,a){super(),this._bufferService=i,this._optionsService=o,this._renderService=a,this._onRequestScrollLines=this._register(new Y),this.onRequestScrollLines=this._onRequestScrollLines.event,this._isSyncing=!1,this._isHandlingScroll=!1,this._suppressOnScrollHandler=!1;let h=this._register(new K5({forceIntegerValues:!1,smoothScrollDuration:this._optionsService.rawOptions.smoothScrollDuration,scheduleAtNextAnimationFrame:l=>Ta(r.window,l)}));this._register(this._optionsService.onSpecificOptionChange("smoothScrollDuration",()=>{h.setSmoothScrollDuration(this._optionsService.rawOptions.smoothScrollDuration)})),this._scrollableElement=this._register(new V5(t,{vertical:1,horizontal:2,useShadows:!1,mouseWheelSmoothScroll:!0,...this._getChangeOptions()},h)),this._register(this._optionsService.onMultipleOptionChange(["scrollSensitivity","fastScrollSensitivity","overviewRuler"],()=>this._scrollableElement.updateOptions(this._getChangeOptions()))),this._register(s.onProtocolChange(l=>{this._scrollableElement.updateOptions({handleMouseWheel:!(l&16)})})),this._scrollableElement.setScrollDimensions({height:0,scrollHeight:0}),this._register(rt.runAndSubscribe(n.onChangeColors,()=>{this._scrollableElement.getDomNode().style.backgroundColor=n.colors.background.css})),e.appendChild(this._scrollableElement.getDomNode()),this._register(be(()=>this._scrollableElement.getDomNode().remove())),this._styleElement=r.mainDocument.createElement("style"),t.appendChild(this._styleElement),this._register(be(()=>this._styleElement.remove())),this._register(rt.runAndSubscribe(n.onChangeColors,()=>{this._styleElement.textContent=[".xterm .xterm-scrollable-element > .scrollbar > .slider {",`  background: ${n.colors.scrollbarSliderBackground.css};`,"}",".xterm .xterm-scrollable-element > .scrollbar > .slider:hover {",`  background: ${n.colors.scrollbarSliderHoverBackground.css};`,"}",".xterm .xterm-scrollable-element > .scrollbar > .slider.active {",`  background: ${n.colors.scrollbarSliderActiveBackground.css};`,"}"].join(`
`)})),this._register(this._bufferService.onResize(()=>this.queueSync())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._latestYDisp=void 0,this.queueSync()})),this._register(this._bufferService.onScroll(()=>this._sync())),this._register(this._scrollableElement.onScroll(l=>this._handleScroll(l)))}scrollLines(e){let t=this._scrollableElement.getScrollPosition();this._scrollableElement.setScrollPosition({reuseAnimation:!0,scrollTop:t.scrollTop+e*this._renderService.dimensions.css.cell.height})}scrollToLine(e,t){t&&(this._latestYDisp=e),this._scrollableElement.setScrollPosition({reuseAnimation:!t,scrollTop:e*this._renderService.dimensions.css.cell.height})}_getChangeOptions(){return{mouseWheelScrollSensitivity:this._optionsService.rawOptions.scrollSensitivity,fastScrollSensitivity:this._optionsService.rawOptions.fastScrollSensitivity,verticalScrollbarSize:this._optionsService.rawOptions.overviewRuler?.width||14}}queueSync(e){e!==void 0&&(this._latestYDisp=e),this._queuedAnimationFrame===void 0&&(this._queuedAnimationFrame=this._renderService.addRefreshCallback(()=>{this._queuedAnimationFrame=void 0,this._sync(this._latestYDisp)}))}_sync(e=this._bufferService.buffer.ydisp){!this._renderService||this._isSyncing||(this._isSyncing=!0,this._suppressOnScrollHandler=!0,this._scrollableElement.setScrollDimensions({height:this._renderService.dimensions.css.canvas.height,scrollHeight:this._renderService.dimensions.css.cell.height*this._bufferService.buffer.lines.length}),this._suppressOnScrollHandler=!1,e!==this._latestYDisp&&this._scrollableElement.setScrollPosition({scrollTop:e*this._renderService.dimensions.css.cell.height}),this._isSyncing=!1)}_handleScroll(e){if(!this._renderService||this._isHandlingScroll||this._suppressOnScrollHandler)return;this._isHandlingScroll=!0;let t=Math.round(e.scrollTop/this._renderService.dimensions.css.cell.height),i=t-this._bufferService.buffer.ydisp;i!==0&&(this._latestYDisp=t,this._onRequestScrollLines.fire(i)),this._isHandlingScroll=!1}};Vc=De([Z(2,gt),Z(3,Ii),Z(4,wv),Z(5,ps),Z(6,pt),Z(7,Mi)],Vc);var Yc=class extends oe{constructor(e,t,i,r,s){super(),this._screenElement=e,this._bufferService=t,this._coreBrowserService=i,this._decorationService=r,this._renderService=s,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this._register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this._register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this._register(this._coreBrowserService.onDprChange(()=>this._queueRefresh())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this._register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this._register(this._decorationService.onDecorationRemoved(n=>this._removeDecoration(n))),this._register(be(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(let e of this._decorationService.decorations)this._renderDecoration(e);this._dimensionsChanged=!1}_renderDecoration(e){this._refreshStyle(e),this._dimensionsChanged&&this._refreshXPosition(e)}_createElement(e){let t=this._coreBrowserService.mainDocument.createElement("div");t.classList.add("xterm-decoration"),t.classList.toggle("xterm-decoration-top-layer",e?.options?.layer==="top"),t.style.width=`${Math.round((e.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,t.style.height=`${(e.options.height||1)*this._renderService.dimensions.css.cell.height}px`,t.style.top=`${(e.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height}px`,t.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;let i=e.options.x??0;return i&&i>this._bufferService.cols&&(t.style.display="none"),this._refreshXPosition(e,t),t}_refreshStyle(e){let t=e.marker.line-this._bufferService.buffers.active.ydisp;if(t<0||t>=this._bufferService.rows)e.element&&(e.element.style.display="none",e.onRenderEmitter.fire(e.element));else{let i=this._decorationElements.get(e);i||(i=this._createElement(e),e.element=i,this._decorationElements.set(e,i),this._container.appendChild(i),e.onDispose(()=>{this._decorationElements.delete(e),i.remove()})),i.style.display=this._altBufferIsActive?"none":"block",this._altBufferIsActive||(i.style.width=`${Math.round((e.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,i.style.height=`${(e.options.height||1)*this._renderService.dimensions.css.cell.height}px`,i.style.top=`${t*this._renderService.dimensions.css.cell.height}px`,i.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`),e.onRenderEmitter.fire(i)}}_refreshXPosition(e,t=e.element){if(!t)return;let i=e.options.x??0;(e.options.anchor||"left")==="right"?t.style.right=i?`${i*this._renderService.dimensions.css.cell.width}px`:"":t.style.left=i?`${i*this._renderService.dimensions.css.cell.width}px`:""}_removeDecoration(e){this._decorationElements.get(e)?.remove(),this._decorationElements.delete(e),e.dispose()}};Yc=De([Z(1,gt),Z(2,Ii),Z(3,Nn),Z(4,Mi)],Yc);var J5=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(e){if(e.options.overviewRulerOptions){for(let t of this._zones)if(t.color===e.options.overviewRulerOptions.color&&t.position===e.options.overviewRulerOptions.position){if(this._lineIntersectsZone(t,e.marker.line))return;if(this._lineAdjacentToZone(t,e.marker.line,e.options.overviewRulerOptions.position)){this._addLineToZone(t,e.marker.line);return}}if(this._zonePoolIndex<this._zonePool.length){this._zonePool[this._zonePoolIndex].color=e.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=e.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=e.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=e.marker.line,this._zones.push(this._zonePool[this._zonePoolIndex++]);return}this._zones.push({color:e.options.overviewRulerOptions.color,position:e.options.overviewRulerOptions.position,startBufferLine:e.marker.line,endBufferLine:e.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(e){this._linePadding=e}_lineIntersectsZone(e,t){return t>=e.startBufferLine&&t<=e.endBufferLine}_lineAdjacentToZone(e,t,i){return t>=e.startBufferLine-this._linePadding[i||"full"]&&t<=e.endBufferLine+this._linePadding[i||"full"]}_addLineToZone(e,t){e.startBufferLine=Math.min(e.startBufferLine,t),e.endBufferLine=Math.max(e.endBufferLine,t)}},hi={full:0,left:0,center:0,right:0},cr={full:0,left:0,center:0,right:0},bn={full:0,left:0,center:0,right:0},Ra=class extends oe{constructor(e,t,i,r,s,n,o,a){super(),this._viewportElement=e,this._screenElement=t,this._bufferService=i,this._decorationService=r,this._renderService=s,this._optionsService=n,this._themeService=o,this._coreBrowserService=a,this._colorZoneStore=new J5,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),this._viewportElement.parentElement?.insertBefore(this._canvas,this._viewportElement),this._register(be(()=>this._canvas?.remove()));let h=this._canvas.getContext("2d");if(h)this._ctx=h;else throw new Error("Ctx cannot be null");this._register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this._register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0))),this._register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this._register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())})),this._register(this._renderService.onRender(()=>{(!this._containerHeight||this._containerHeight!==this._screenElement.clientHeight)&&(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this._register(this._coreBrowserService.onDprChange(()=>this._queueRefresh(!0))),this._register(this._optionsService.onSpecificOptionChange("overviewRuler",()=>this._queueRefresh(!0))),this._register(this._themeService.onChangeColors(()=>this._queueRefresh())),this._queueRefresh(!0)}get _width(){return this._optionsService.options.overviewRuler?.width||0}_refreshDrawConstants(){let e=Math.floor((this._canvas.width-1)/3),t=Math.ceil((this._canvas.width-1)/3);cr.full=this._canvas.width,cr.left=e,cr.center=t,cr.right=e,this._refreshDrawHeightConstants(),bn.full=1,bn.left=1,bn.center=1+cr.left,bn.right=1+cr.left+cr.center}_refreshDrawHeightConstants(){hi.full=Math.round(2*this._coreBrowserService.dpr);let e=this._canvas.height/this._bufferService.buffer.lines.length,t=Math.round(Math.max(Math.min(e,12),6)*this._coreBrowserService.dpr);hi.left=t,hi.center=t,hi.right=t}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*hi.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*hi.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*hi.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*hi.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(let t of this._decorationService.decorations)this._colorZoneStore.addDecoration(t);this._ctx.lineWidth=1,this._renderRulerOutline();let e=this._colorZoneStore.zones;for(let t of e)t.position!=="full"&&this._renderColorZone(t);for(let t of e)t.position==="full"&&this._renderColorZone(t);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderRulerOutline(){this._ctx.fillStyle=this._themeService.colors.overviewRulerBorder.css,this._ctx.fillRect(0,0,1,this._canvas.height),this._optionsService.rawOptions.overviewRuler.showTopBorder&&this._ctx.fillRect(1,0,this._canvas.width-1,1),this._optionsService.rawOptions.overviewRuler.showBottomBorder&&this._ctx.fillRect(1,this._canvas.height-1,this._canvas.width-1,this._canvas.height)}_renderColorZone(e){this._ctx.fillStyle=e.color,this._ctx.fillRect(bn[e.position||"full"],Math.round((this._canvas.height-1)*(e.startBufferLine/this._bufferService.buffers.active.lines.length)-hi[e.position||"full"]/2),cr[e.position||"full"],Math.round((this._canvas.height-1)*((e.endBufferLine-e.startBufferLine)/this._bufferService.buffers.active.lines.length)+hi[e.position||"full"]))}_queueRefresh(e,t){this._shouldUpdateDimensions=e||this._shouldUpdateDimensions,this._shouldUpdateAnchor=t||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};Ra=De([Z(2,gt),Z(3,Nn),Z(4,Mi),Z(5,pt),Z(6,ps),Z(7,Ii)],Ra);var G;(e=>(e.NUL="\0",e.SOH="",e.STX="",e.ETX="",e.EOT="",e.ENQ="",e.ACK="",e.BEL="\x07",e.BS="\b",e.HT="	",e.LF=`
`,e.VT="\v",e.FF="\f",e.CR="\r",e.SO="",e.SI="",e.DLE="",e.DC1="",e.DC2="",e.DC3="",e.DC4="",e.NAK="",e.SYN="",e.ETB="",e.CAN="",e.EM="",e.SUB="",e.ESC="\x1B",e.FS="",e.GS="",e.RS="",e.US="",e.SP=" ",e.DEL="\x7F"))(G||={});var Ea;(e=>(e.PAD="\x80",e.HOP="\x81",e.BPH="\x82",e.NBH="\x83",e.IND="\x84",e.NEL="\x85",e.SSA="\x86",e.ESA="\x87",e.HTS="\x88",e.HTJ="\x89",e.VTS="\x8A",e.PLD="\x8B",e.PLU="\x8C",e.RI="\x8D",e.SS2="\x8E",e.SS3="\x8F",e.DCS="\x90",e.PU1="\x91",e.PU2="\x92",e.STS="\x93",e.CCH="\x94",e.MW="\x95",e.SPA="\x96",e.EPA="\x97",e.SOS="\x98",e.SGCI="\x99",e.SCI="\x9A",e.CSI="\x9B",e.ST="\x9C",e.OSC="\x9D",e.PM="\x9E",e.APC="\x9F"))(Ea||={});var Yv;(e=>e.ST=`${G.ESC}\\`)(Yv||={});var Jc=class{constructor(e,t,i,r,s,n){this._textarea=e,this._compositionView=t,this._bufferService=i,this._optionsService=r,this._coreService=s,this._renderService=n,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}get isComposing(){return this._isComposing}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(e){this._compositionView.textContent=e.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown(e){if(this._isComposing||this._isSendingComposition){if(e.keyCode===20||e.keyCode===229||e.keyCode===16||e.keyCode===17||e.keyCode===18)return!1;this._finalizeComposition(!1)}return e.keyCode===229?(this._handleAnyTextareaChanges(),!1):!0}_finalizeComposition(e){if(this._compositionView.classList.remove("active"),this._isComposing=!1,e){let t={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){this._isSendingComposition=!1;let i;t.start+=this._dataAlreadySent.length,this._isComposing?i=this._textarea.value.substring(t.start,this._compositionPosition.start):i=this._textarea.value.substring(t.start),i.length>0&&this._coreService.triggerDataEvent(i,!0)}},0)}else{this._isSendingComposition=!1;let t=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(t,!0)}}_handleAnyTextareaChanges(){let e=this._textarea.value;setTimeout(()=>{if(!this._isComposing){let t=this._textarea.value,i=t.replace(e,"");this._dataAlreadySent=i,t.length>e.length?this._coreService.triggerDataEvent(i,!0):t.length<e.length?this._coreService.triggerDataEvent(`${G.DEL}`,!0):t.length===e.length&&t!==e&&this._coreService.triggerDataEvent(t,!0)}},0)}updateCompositionElements(e){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){let t=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),i=this._renderService.dimensions.css.cell.height,r=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,s=t*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=s+"px",this._compositionView.style.top=r+"px",this._compositionView.style.height=i+"px",this._compositionView.style.lineHeight=i+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";let n=this._compositionView.getBoundingClientRect();this._textarea.style.left=s+"px",this._textarea.style.top=r+"px",this._textarea.style.width=Math.max(n.width,1)+"px",this._textarea.style.height=Math.max(n.height,1)+"px",this._textarea.style.lineHeight=n.height+"px"}e||setTimeout(()=>this.updateCompositionElements(!0),0)}}};Jc=De([Z(2,gt),Z(3,pt),Z(4,Ur),Z(5,Mi)],Jc);var Ge=0,je=0,qe=0,Le=0,Np={css:"#00000000",rgba:0},Ke;(e=>{function t(s,n,o,a){return a!==void 0?`#${Pr(s)}${Pr(n)}${Pr(o)}${Pr(a)}`:`#${Pr(s)}${Pr(n)}${Pr(o)}`}e.toCss=t;function i(s,n,o,a=255){return(s<<24|n<<16|o<<8|a)>>>0}e.toRgba=i;function r(s,n,o,a){return{css:e.toCss(s,n,o,a),rgba:e.toRgba(s,n,o,a)}}e.toColor=r})(Ke||={});var ye;(e=>{function t(h,l){if(Le=(l.rgba&255)/255,Le===1)return{css:l.css,rgba:l.rgba};let c=l.rgba>>24&255,u=l.rgba>>16&255,p=l.rgba>>8&255,g=h.rgba>>24&255,v=h.rgba>>16&255,m=h.rgba>>8&255;Ge=g+Math.round((c-g)*Le),je=v+Math.round((u-v)*Le),qe=m+Math.round((p-m)*Le);let x=Ke.toCss(Ge,je,qe),E=Ke.toRgba(Ge,je,qe);return{css:x,rgba:E}}e.blend=t;function i(h){return(h.rgba&255)===255}e.isOpaque=i;function r(h,l,c){let u=Ba.ensureContrastRatio(h.rgba,l.rgba,c);if(u)return Ke.toColor(u>>24&255,u>>16&255,u>>8&255)}e.ensureContrastRatio=r;function s(h){let l=(h.rgba|255)>>>0;return[Ge,je,qe]=Ba.toChannels(l),{css:Ke.toCss(Ge,je,qe),rgba:l}}e.opaque=s;function n(h,l){return Le=Math.round(l*255),[Ge,je,qe]=Ba.toChannels(h.rgba),{css:Ke.toCss(Ge,je,qe,Le),rgba:Ke.toRgba(Ge,je,qe,Le)}}e.opacity=n;function o(h,l){return Le=h.rgba&255,n(h,Le*l/255)}e.multiplyOpacity=o;function a(h){return[h.rgba>>24&255,h.rgba>>16&255,h.rgba>>8&255]}e.toColorRGB=a})(ye||={});var Ee;(e=>{let t,i;try{let s=document.createElement("canvas");s.width=1,s.height=1;let n=s.getContext("2d",{willReadFrequently:!0});n&&(t=n,t.globalCompositeOperation="copy",i=t.createLinearGradient(0,0,1,1))}catch{}function r(s){if(s.match(/#[\da-f]{3,8}/i))switch(s.length){case 4:return Ge=parseInt(s.slice(1,2).repeat(2),16),je=parseInt(s.slice(2,3).repeat(2),16),qe=parseInt(s.slice(3,4).repeat(2),16),Ke.toColor(Ge,je,qe);case 5:return Ge=parseInt(s.slice(1,2).repeat(2),16),je=parseInt(s.slice(2,3).repeat(2),16),qe=parseInt(s.slice(3,4).repeat(2),16),Le=parseInt(s.slice(4,5).repeat(2),16),Ke.toColor(Ge,je,qe,Le);case 7:return{css:s,rgba:(parseInt(s.slice(1),16)<<8|255)>>>0};case 9:return{css:s,rgba:parseInt(s.slice(1),16)>>>0}}let n=s.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(n)return Ge=parseInt(n[1]),je=parseInt(n[2]),qe=parseInt(n[3]),Le=Math.round((n[5]===void 0?1:parseFloat(n[5]))*255),Ke.toColor(Ge,je,qe,Le);if(!t||!i)throw new Error("css.toColor: Unsupported css format");if(t.fillStyle=i,t.fillStyle=s,typeof t.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(t.fillRect(0,0,1,1),[Ge,je,qe,Le]=t.getImageData(0,0,1,1).data,Le!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:Ke.toRgba(Ge,je,qe,Le),css:s}}e.toColor=r})(Ee||={});var _t;(e=>{function t(r){return i(r>>16&255,r>>8&255,r&255)}e.relativeLuminance=t;function i(r,s,n){let o=r/255,a=s/255,h=n/255,l=o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4),c=a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4),u=h<=.03928?h/12.92:Math.pow((h+.055)/1.055,2.4);return l*.2126+c*.7152+u*.0722}e.relativeLuminance2=i})(_t||={});var Ba;(e=>{function t(o,a){if(Le=(a&255)/255,Le===1)return a;let h=a>>24&255,l=a>>16&255,c=a>>8&255,u=o>>24&255,p=o>>16&255,g=o>>8&255;return Ge=u+Math.round((h-u)*Le),je=p+Math.round((l-p)*Le),qe=g+Math.round((c-g)*Le),Ke.toRgba(Ge,je,qe)}e.blend=t;function i(o,a,h){let l=_t.relativeLuminance(o>>8),c=_t.relativeLuminance(a>>8);if(Ei(l,c)<h){if(c<l){let g=r(o,a,h),v=Ei(l,_t.relativeLuminance(g>>8));if(v<h){let m=s(o,a,h),x=Ei(l,_t.relativeLuminance(m>>8));return v>x?g:m}return g}let u=s(o,a,h),p=Ei(l,_t.relativeLuminance(u>>8));if(p<h){let g=r(o,a,h),v=Ei(l,_t.relativeLuminance(g>>8));return p>v?u:g}return u}}e.ensureContrastRatio=i;function r(o,a,h){let l=o>>24&255,c=o>>16&255,u=o>>8&255,p=a>>24&255,g=a>>16&255,v=a>>8&255,m=Ei(_t.relativeLuminance2(p,g,v),_t.relativeLuminance2(l,c,u));for(;m<h&&(p>0||g>0||v>0);)p-=Math.max(0,Math.ceil(p*.1)),g-=Math.max(0,Math.ceil(g*.1)),v-=Math.max(0,Math.ceil(v*.1)),m=Ei(_t.relativeLuminance2(p,g,v),_t.relativeLuminance2(l,c,u));return(p<<24|g<<16|v<<8|255)>>>0}e.reduceLuminance=r;function s(o,a,h){let l=o>>24&255,c=o>>16&255,u=o>>8&255,p=a>>24&255,g=a>>16&255,v=a>>8&255,m=Ei(_t.relativeLuminance2(p,g,v),_t.relativeLuminance2(l,c,u));for(;m<h&&(p<255||g<255||v<255);)p=Math.min(255,p+Math.ceil((255-p)*.1)),g=Math.min(255,g+Math.ceil((255-g)*.1)),v=Math.min(255,v+Math.ceil((255-v)*.1)),m=Ei(_t.relativeLuminance2(p,g,v),_t.relativeLuminance2(l,c,u));return(p<<24|g<<16|v<<8|255)>>>0}e.increaseLuminance=s;function n(o){return[o>>24&255,o>>16&255,o>>8&255,o&255]}e.toChannels=n})(Ba||={});function Pr(e){let t=e.toString(16);return t.length<2?"0"+t:t}function Ei(e,t){return e<t?(t+.05)/(e+.05):(e+.05)/(t+.05)}var Z5=class extends Kn{constructor(e,t,i){super(),this.content=0,this.combinedData="",this.fg=e.fg,this.bg=e.bg,this.combinedData=t,this._width=i}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(e){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},Fa=class{constructor(e){this._bufferService=e,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new Xt}register(e){let t={id:this._nextCharacterJoinerId++,handler:e};return this._characterJoiners.push(t),t.id}deregister(e){for(let t=0;t<this._characterJoiners.length;t++)if(this._characterJoiners[t].id===e)return this._characterJoiners.splice(t,1),!0;return!1}getJoinedCharacters(e){if(this._characterJoiners.length===0)return[];let t=this._bufferService.buffer.lines.get(e);if(!t||t.length===0)return[];let i=[],r=t.translateToString(!0),s=0,n=0,o=0,a=t.getFg(0),h=t.getBg(0);for(let l=0;l<t.getTrimmedLength();l++)if(t.loadCell(l,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==a||this._workCell.bg!==h){if(l-s>1){let c=this._getJoinedRanges(r,o,n,t,s);for(let u=0;u<c.length;u++)i.push(c[u])}s=l,o=n,a=this._workCell.fg,h=this._workCell.bg}n+=this._workCell.getChars().length||fr.length}if(this._bufferService.cols-s>1){let l=this._getJoinedRanges(r,o,n,t,s);for(let c=0;c<l.length;c++)i.push(l[c])}return i}_getJoinedRanges(e,t,i,r,s){let n=e.substring(t,i),o=[];try{o=this._characterJoiners[0].handler(n)}catch(a){console.error(a)}for(let a=1;a<this._characterJoiners.length;a++)try{let h=this._characterJoiners[a].handler(n);for(let l=0;l<h.length;l++)Fa._mergeRanges(o,h[l])}catch(h){console.error(h)}return this._stringRangesToCellRanges(o,r,s),o}_stringRangesToCellRanges(e,t,i){let r=0,s=!1,n=0,o=e[r];if(o){for(let a=i;a<this._bufferService.cols;a++){let h=t.getWidth(a),l=t.getString(a).length||fr.length;if(h!==0){if(!s&&o[0]<=n&&(o[0]=a,s=!0),o[1]<=n){if(o[1]=a,o=e[++r],!o)break;o[0]<=n?(o[0]=a,s=!0):s=!1}n+=l}}o&&(o[1]=this._bufferService.cols)}}static _mergeRanges(e,t){let i=!1;for(let r=0;r<e.length;r++){let s=e[r];if(i){if(t[1]<=s[0])return e[r-1][1]=t[1],e;if(t[1]<=s[1])return e[r-1][1]=Math.max(t[1],s[1]),e.splice(r,1),e;e.splice(r,1),r--}else{if(t[1]<=s[0])return e.splice(r,0,t),e;if(t[1]<=s[1])return s[0]=Math.min(t[0],s[0]),e;t[0]<s[1]&&(s[0]=Math.min(t[0],s[0]),i=!0);continue}}return i?e[e.length-1][1]=t[1]:e.push(t),e}};Fa=De([Z(0,gt)],Fa);function ek(e){return 57508<=e&&e<=57558}function tk(e){return 9472<=e&&e<=9631}function ik(e){return ek(e)||tk(e)}function rk(){return{css:{canvas:pa(),cell:pa()},device:{canvas:pa(),cell:pa(),char:{width:0,height:0,left:0,top:0}}}}function pa(){return{width:0,height:0}}var Zc=class{constructor(e,t,i,r,s,n,o){this._document=e,this._characterJoinerService=t,this._optionsService=i,this._coreBrowserService=r,this._coreService=s,this._decorationService=n,this._themeService=o,this._workCell=new Xt,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(e,t,i){this._selectionStart=e,this._selectionEnd=t,this._columnSelectMode=i}createRow(e,t,i,r,s,n,o,a,h,l,c){let u=[],p=this._characterJoinerService.getJoinedCharacters(t),g=this._themeService.colors,v=e.getNoBgTrimmedLength();i&&v<n+1&&(v=n+1);let m,x=0,E="",R=0,D=0,b=0,L=0,I=!1,T=0,q=!1,$=0,V=0,j=[],ne=l!==-1&&c!==-1;for(let C=0;C<v;C++){e.loadCell(C,this._workCell);let w=this._workCell.getWidth();if(w===0)continue;let k=!1,f=C>=V,d=C,_=this._workCell;if(p.length>0&&C===p[0][0]&&f){let de=p.shift(),$i=this._isCellInSelection(de[0],t);for(R=de[0]+1;R<de[1];R++)f&&=$i===this._isCellInSelection(R,t);f&&=!i||n<de[0]||n>=de[1],f?(k=!0,_=new Z5(this._workCell,e.translateToString(!0,de[0],de[1]),de[1]-de[0]),d=de[1]-1,w=_.getWidth()):V=de[1]}let y=this._isCellInSelection(C,t),A=i&&C===n,S=ne&&C>=l&&C<=c,F=!1;this._decorationService.forEachDecorationAtCell(C,t,void 0,de=>{F=!0});let U=_.getChars()||fr;if(U===" "&&(_.isUnderline()||_.isOverline())&&(U="\xA0"),$=w*a-h.get(U,_.isBold(),_.isItalic()),!m)m=this._document.createElement("span");else if(x&&(y&&q||!y&&!q&&_.bg===D)&&(y&&q&&g.selectionForeground||_.fg===b)&&_.extended.ext===L&&S===I&&$===T&&!A&&!k&&!F&&f){_.isInvisible()?E+=fr:E+=U,x++;continue}else x&&(m.textContent=E),m=this._document.createElement("span"),x=0,E="";if(D=_.bg,b=_.fg,L=_.extended.ext,I=S,T=$,q=y,k&&n>=C&&n<=d&&(n=C),!this._coreService.isCursorHidden&&A&&this._coreService.isCursorInitialized){if(j.push("xterm-cursor"),this._coreBrowserService.isFocused)o&&j.push("xterm-cursor-blink"),j.push(r==="bar"?"xterm-cursor-bar":r==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(s)switch(s){case"outline":j.push("xterm-cursor-outline");break;case"block":j.push("xterm-cursor-block");break;case"bar":j.push("xterm-cursor-bar");break;case"underline":j.push("xterm-cursor-underline");break;default:break}}if(_.isBold()&&j.push("xterm-bold"),_.isItalic()&&j.push("xterm-italic"),_.isDim()&&j.push("xterm-dim"),_.isInvisible()?E=fr:E=_.getChars()||fr,_.isUnderline()&&(j.push(`xterm-underline-${_.extended.underlineStyle}`),E===" "&&(E="\xA0"),!_.isUnderlineColorDefault()))if(_.isUnderlineColorRGB())m.style.textDecorationColor=`rgb(${Kn.toColorRGB(_.getUnderlineColor()).join(",")})`;else{let de=_.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&_.isBold()&&de<8&&(de+=8),m.style.textDecorationColor=g.ansi[de].css}_.isOverline()&&(j.push("xterm-overline"),E===" "&&(E="\xA0")),_.isStrikethrough()&&j.push("xterm-strikethrough"),S&&(m.style.textDecoration="underline");let W=_.getFgColor(),z=_.getFgColorMode(),J=_.getBgColor(),ee=_.getBgColorMode(),ue=!!_.isInverse();if(ue){let de=W;W=J,J=de;let $i=z;z=ee,ee=$i}let Be,Wi,Jt=!1;this._decorationService.forEachDecorationAtCell(C,t,void 0,de=>{de.options.layer!=="top"&&Jt||(de.backgroundColorRGB&&(ee=50331648,J=de.backgroundColorRGB.rgba>>8&16777215,Be=de.backgroundColorRGB),de.foregroundColorRGB&&(z=50331648,W=de.foregroundColorRGB.rgba>>8&16777215,Wi=de.foregroundColorRGB),Jt=de.options.layer==="top")}),!Jt&&y&&(Be=this._coreBrowserService.isFocused?g.selectionBackgroundOpaque:g.selectionInactiveBackgroundOpaque,J=Be.rgba>>8&16777215,ee=50331648,Jt=!0,g.selectionForeground&&(z=50331648,W=g.selectionForeground.rgba>>8&16777215,Wi=g.selectionForeground)),Jt&&j.push("xterm-decoration-top");let xt;switch(ee){case 16777216:case 33554432:xt=g.ansi[J],j.push(`xterm-bg-${J}`);break;case 50331648:xt=Ke.toColor(J>>16,J>>8&255,J&255),this._addStyle(m,`background-color:#${Qp((J>>>0).toString(16),"0",6)}`);break;case 0:default:ue?(xt=g.foreground,j.push("xterm-bg-257")):xt=g.background}switch(Be||_.isDim()&&(Be=ye.multiplyOpacity(xt,.5)),z){case 16777216:case 33554432:_.isBold()&&W<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(W+=8),this._applyMinimumContrast(m,xt,g.ansi[W],_,Be,void 0)||j.push(`xterm-fg-${W}`);break;case 50331648:let de=Ke.toColor(W>>16&255,W>>8&255,W&255);this._applyMinimumContrast(m,xt,de,_,Be,Wi)||this._addStyle(m,`color:#${Qp(W.toString(16),"0",6)}`);break;case 0:default:this._applyMinimumContrast(m,xt,g.foreground,_,Be,Wi)||ue&&j.push("xterm-fg-257")}j.length&&(m.className=j.join(" "),j.length=0),!A&&!k&&!F&&f?x++:m.textContent=E,$!==this.defaultSpacing&&(m.style.letterSpacing=`${$}px`),u.push(m),C=d}return m&&x&&(m.textContent=E),u}_applyMinimumContrast(e,t,i,r,s,n){if(this._optionsService.rawOptions.minimumContrastRatio===1||ik(r.getCode()))return!1;let o=this._getContrastCache(r),a;if(!s&&!n&&(a=o.getColor(t.rgba,i.rgba)),a===void 0){let h=this._optionsService.rawOptions.minimumContrastRatio/(r.isDim()?2:1);a=ye.ensureContrastRatio(s||t,n||i,h),o.setColor((s||t).rgba,(n||i).rgba,a??null)}return a?(this._addStyle(e,`color:${a.css}`),!0):!1}_getContrastCache(e){return e.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(e,t){e.setAttribute("style",`${e.getAttribute("style")||""}${t};`)}_isCellInSelection(e,t){let i=this._selectionStart,r=this._selectionEnd;return!i||!r?!1:this._columnSelectMode?i[0]<=r[0]?e>=i[0]&&t>=i[1]&&e<r[0]&&t<=r[1]:e<i[0]&&t>=i[1]&&e>=r[0]&&t<=r[1]:t>i[1]&&t<r[1]||i[1]===r[1]&&t===i[1]&&e>=i[0]&&e<r[0]||i[1]<r[1]&&t===r[1]&&e<r[0]||i[1]<r[1]&&t===i[1]&&e>=i[0]}};Zc=De([Z(1,Sv),Z(2,pt),Z(3,Ii),Z(4,Ur),Z(5,Nn),Z(6,ps)],Zc);function Qp(e,t,i){for(;e.length<i;)e=t+e;return e}var sk=class{constructor(e,t){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=e.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";let i=e.createElement("span");i.classList.add("xterm-char-measure-element");let r=e.createElement("span");r.classList.add("xterm-char-measure-element"),r.style.fontWeight="bold";let s=e.createElement("span");s.classList.add("xterm-char-measure-element"),s.style.fontStyle="italic";let n=e.createElement("span");n.classList.add("xterm-char-measure-element"),n.style.fontWeight="bold",n.style.fontStyle="italic",this._measureElements=[i,r,s,n],this._container.appendChild(i),this._container.appendChild(r),this._container.appendChild(s),this._container.appendChild(n),t.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(e,t,i,r){e===this._font&&t===this._fontSize&&i===this._weight&&r===this._weightBold||(this._font=e,this._fontSize=t,this._weight=i,this._weightBold=r,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${i}`,this._measureElements[1].style.fontWeight=`${r}`,this._measureElements[2].style.fontWeight=`${i}`,this._measureElements[3].style.fontWeight=`${r}`,this.clear())}get(e,t,i){let r=0;if(!t&&!i&&e.length===1&&(r=e.charCodeAt(0))<256){if(this._flat[r]!==-9999)return this._flat[r];let o=this._measure(e,0);return o>0&&(this._flat[r]=o),o}let s=e;t&&(s+="B"),i&&(s+="I");let n=this._holey.get(s);if(n===void 0){let o=0;t&&(o|=1),i&&(o|=2),n=this._measure(e,o),n>0&&this._holey.set(s,n)}return n}_measure(e,t){let i=this._measureElements[t];return i.textContent=e.repeat(32),i.offsetWidth/32}},nk=class{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(e,t,i,r=!1){if(this.selectionStart=t,this.selectionEnd=i,!t||!i||t[0]===i[0]&&t[1]===i[1]){this.clear();return}let s=e.buffers.active.ydisp,n=t[1]-s,o=i[1]-s,a=Math.max(n,0),h=Math.min(o,e.rows-1);if(a>=e.rows||h<0){this.clear();return}this.hasSelection=!0,this.columnSelectMode=r,this.viewportStartRow=n,this.viewportEndRow=o,this.viewportCappedStartRow=a,this.viewportCappedEndRow=h,this.startCol=t[0],this.endCol=i[0]}isCellSelected(e,t,i){return this.hasSelection?(i-=e.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?t>=this.startCol&&i>=this.viewportCappedStartRow&&t<this.endCol&&i<=this.viewportCappedEndRow:t<this.startCol&&i>=this.viewportCappedStartRow&&t>=this.endCol&&i<=this.viewportCappedEndRow:i>this.viewportStartRow&&i<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&i===this.viewportStartRow&&t>=this.startCol&&t<this.endCol||this.viewportStartRow<this.viewportEndRow&&i===this.viewportEndRow&&t<this.endCol||this.viewportStartRow<this.viewportEndRow&&i===this.viewportStartRow&&t>=this.startCol):!1}};function ok(){return new nk}var Ac="xterm-dom-renderer-owner-",Nt="xterm-rows",va="xterm-fg-",Hp="xterm-bg-",wn="xterm-focus",ma="xterm-selection",ak=1,eu=class extends oe{constructor(e,t,i,r,s,n,o,a,h,l,c,u,p,g){super(),this._terminal=e,this._document=t,this._element=i,this._screenElement=r,this._viewportElement=s,this._helperContainer=n,this._linkifier2=o,this._charSizeService=h,this._optionsService=l,this._bufferService=c,this._coreService=u,this._coreBrowserService=p,this._themeService=g,this._terminalClass=ak++,this._rowElements=[],this._selectionRenderModel=ok(),this.onRequestRedraw=this._register(new Y).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(Nt),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add(ma),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=rk(),this._updateDimensions(),this._register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this._register(this._themeService.onChangeColors(v=>this._injectCss(v))),this._injectCss(this._themeService.colors),this._rowFactory=a.createInstance(Zc,document),this._element.classList.add(Ac+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this._register(this._linkifier2.onShowLinkUnderline(v=>this._handleLinkHover(v))),this._register(this._linkifier2.onHideLinkUnderline(v=>this._handleLinkLeave(v))),this._register(be(()=>{this._element.classList.remove(Ac+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()})),this._widthCache=new sk(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){let e=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*e,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*e),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/e),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/e),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(let i of this._rowElements)i.style.width=`${this.dimensions.css.canvas.width}px`,i.style.height=`${this.dimensions.css.cell.height}px`,i.style.lineHeight=`${this.dimensions.css.cell.height}px`,i.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));let t=`${this._terminalSelector} .${Nt} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=t,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(e){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let t=`${this._terminalSelector} .${Nt} { pointer-events: none; color: ${e.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;t+=`${this._terminalSelector} .${Nt} .xterm-dim { color: ${ye.multiplyOpacity(e.foreground,.5).css};}`,t+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;let i=`blink_underline_${this._terminalClass}`,r=`blink_bar_${this._terminalClass}`,s=`blink_block_${this._terminalClass}`;t+=`@keyframes ${i} { 50% {  border-bottom-style: hidden; }}`,t+=`@keyframes ${r} { 50% {  box-shadow: none; }}`,t+=`@keyframes ${s} { 0% {  background-color: ${e.cursor.css};  color: ${e.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${e.cursor.css}; }}`,t+=`${this._terminalSelector} .${Nt}.${wn} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${i} 1s step-end infinite;}${this._terminalSelector} .${Nt}.${wn} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${r} 1s step-end infinite;}${this._terminalSelector} .${Nt}.${wn} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${s} 1s step-end infinite;}${this._terminalSelector} .${Nt} .xterm-cursor.xterm-cursor-block { background-color: ${e.cursor.css}; color: ${e.cursorAccent.css};}${this._terminalSelector} .${Nt} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${e.cursor.css} !important; color: ${e.cursorAccent.css} !important;}${this._terminalSelector} .${Nt} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${e.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${Nt} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${e.cursor.css} inset;}${this._terminalSelector} .${Nt} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${e.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,t+=`${this._terminalSelector} .${ma} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${ma} div { position: absolute; background-color: ${e.selectionBackgroundOpaque.css};}${this._terminalSelector} .${ma} div { position: absolute; background-color: ${e.selectionInactiveBackgroundOpaque.css};}`;for(let[n,o]of e.ansi.entries())t+=`${this._terminalSelector} .${va}${n} { color: ${o.css}; }${this._terminalSelector} .${va}${n}.xterm-dim { color: ${ye.multiplyOpacity(o,.5).css}; }${this._terminalSelector} .${Hp}${n} { background-color: ${o.css}; }`;t+=`${this._terminalSelector} .${va}257 { color: ${ye.opaque(e.background).css}; }${this._terminalSelector} .${va}257.xterm-dim { color: ${ye.multiplyOpacity(ye.opaque(e.background),.5).css}; }${this._terminalSelector} .${Hp}257 { background-color: ${e.foreground.css}; }`,this._themeStyleElement.textContent=t}_setDefaultSpacing(){let e=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${e}px`,this._rowFactory.defaultSpacing=e}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(e,t){for(let i=this._rowElements.length;i<=t;i++){let r=this._document.createElement("div");this._rowContainer.appendChild(r),this._rowElements.push(r)}for(;this._rowElements.length>t;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(e,t){this._refreshRowElements(e,t),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(wn),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(wn),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(e,t,i){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(e,t,i),this.renderRows(0,this._bufferService.rows-1),!e||!t||(this._selectionRenderModel.update(this._terminal,e,t,i),!this._selectionRenderModel.hasSelection))return;let r=this._selectionRenderModel.viewportStartRow,s=this._selectionRenderModel.viewportEndRow,n=this._selectionRenderModel.viewportCappedStartRow,o=this._selectionRenderModel.viewportCappedEndRow,a=this._document.createDocumentFragment();if(i){let h=e[0]>t[0];a.appendChild(this._createSelectionElement(n,h?t[0]:e[0],h?e[0]:t[0],o-n+1))}else{let h=r===n?e[0]:0,l=n===s?t[0]:this._bufferService.cols;a.appendChild(this._createSelectionElement(n,h,l));let c=o-n-1;if(a.appendChild(this._createSelectionElement(n+1,0,this._bufferService.cols,c)),n!==o){let u=s===o?t[0]:this._bufferService.cols;a.appendChild(this._createSelectionElement(o,0,u))}}this._selectionContainer.appendChild(a)}_createSelectionElement(e,t,i,r=1){let s=this._document.createElement("div"),n=t*this.dimensions.css.cell.width,o=this.dimensions.css.cell.width*(i-t);return n+o>this.dimensions.css.canvas.width&&(o=this.dimensions.css.canvas.width-n),s.style.height=`${r*this.dimensions.css.cell.height}px`,s.style.top=`${e*this.dimensions.css.cell.height}px`,s.style.left=`${n}px`,s.style.width=`${o}px`,s}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(let e of this._rowElements)e.replaceChildren()}renderRows(e,t){let i=this._bufferService.buffer,r=i.ybase+i.y,s=Math.min(i.x,this._bufferService.cols-1),n=this._coreService.decPrivateModes.cursorBlink??this._optionsService.rawOptions.cursorBlink,o=this._coreService.decPrivateModes.cursorStyle??this._optionsService.rawOptions.cursorStyle,a=this._optionsService.rawOptions.cursorInactiveStyle;for(let h=e;h<=t;h++){let l=h+i.ydisp,c=this._rowElements[h],u=i.lines.get(l);if(!c||!u)break;c.replaceChildren(...this._rowFactory.createRow(u,l,l===r,o,a,s,n,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${Ac}${this._terminalClass}`}_handleLinkHover(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!0)}_handleLinkLeave(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!1)}_setCellUnderline(e,t,i,r,s,n){i<0&&(e=0),r<0&&(t=0);let o=this._bufferService.rows-1;i=Math.max(Math.min(i,o),0),r=Math.max(Math.min(r,o),0),s=Math.min(s,this._bufferService.cols);let a=this._bufferService.buffer,h=a.ybase+a.y,l=Math.min(a.x,s-1),c=this._optionsService.rawOptions.cursorBlink,u=this._optionsService.rawOptions.cursorStyle,p=this._optionsService.rawOptions.cursorInactiveStyle;for(let g=i;g<=r;++g){let v=g+a.ydisp,m=this._rowElements[g],x=a.lines.get(v);if(!m||!x)break;m.replaceChildren(...this._rowFactory.createRow(x,v,v===h,u,p,l,c,this.dimensions.css.cell.width,this._widthCache,n?g===i?e:0:-1,n?(g===r?t:s)-1:-1))}}};eu=De([Z(7,_u),Z(8,Qa),Z(9,pt),Z(10,gt),Z(11,Ur),Z(12,Ii),Z(13,ps)],eu);var tu=class extends oe{constructor(e,t,i){super(),this._optionsService=i,this.width=0,this.height=0,this._onCharSizeChange=this._register(new Y),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this._register(new hk(this._optionsService))}catch{this._measureStrategy=this._register(new lk(e,t,this._optionsService))}this._register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}get hasValidSize(){return this.width>0&&this.height>0}measure(){let e=this._measureStrategy.measure();(e.width!==this.width||e.height!==this.height)&&(this.width=e.width,this.height=e.height,this._onCharSizeChange.fire())}};tu=De([Z(2,pt)],tu);var Jv=class extends oe{constructor(){super(...arguments),this._result={width:0,height:0}}_validateAndSet(e,t){e!==void 0&&e>0&&t!==void 0&&t>0&&(this._result.width=e,this._result.height=t)}},lk=class extends Jv{constructor(e,t,i){super(),this._document=e,this._parentElement=t,this._optionsService=i,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}},hk=class extends Jv{constructor(e){super(),this._optionsService=e,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");let t=this._ctx.measureText("W");if(!("width"in t&&"fontBoundingBoxAscent"in t&&"fontBoundingBoxDescent"in t))throw new Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;let e=this._ctx.measureText("W");return this._validateAndSet(e.width,e.fontBoundingBoxAscent+e.fontBoundingBoxDescent),this._result}},ck=class extends oe{constructor(e,t,i){super(),this._textarea=e,this._window=t,this.mainDocument=i,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=this._register(new uk(this._window)),this._onDprChange=this._register(new Y),this.onDprChange=this._onDprChange.event,this._onWindowChange=this._register(new Y),this.onWindowChange=this._onWindowChange.event,this._register(this.onWindowChange(r=>this._screenDprMonitor.setWindow(r))),this._register(rt.forward(this._screenDprMonitor.onDprChange,this._onDprChange)),this._register(se(this._textarea,"focus",()=>this._isFocused=!0)),this._register(se(this._textarea,"blur",()=>this._isFocused=!1))}get window(){return this._window}set window(e){this._window!==e&&(this._window=e,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}},uk=class extends oe{constructor(e){super(),this._parentWindow=e,this._windowResizeListener=this._register(new gs),this._onDprChange=this._register(new Y),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this._register(be(()=>this.clearListener()))}setWindow(e){this._parentWindow=e,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=se(this._parentWindow,"resize",()=>this._setDprAndFireIfDiffers())}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){this._outerListener&&(this._resolutionMediaMatchList?.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){!this._resolutionMediaMatchList||!this._outerListener||(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}},dk=class extends oe{constructor(){super(),this.linkProviders=[],this._register(be(()=>this.linkProviders.length=0))}registerLinkProvider(e){return this.linkProviders.push(e),{dispose:()=>{let t=this.linkProviders.indexOf(e);t!==-1&&this.linkProviders.splice(t,1)}}}};function Au(e,t,i){let r=i.getBoundingClientRect(),s=e.getComputedStyle(i),n=parseInt(s.getPropertyValue("padding-left")),o=parseInt(s.getPropertyValue("padding-top"));return[t.clientX-r.left-n,t.clientY-r.top-o]}function fk(e,t,i,r,s,n,o,a,h){if(!n)return;let l=Au(e,t,i);if(l)return l[0]=Math.ceil((l[0]+(h?o/2:0))/o),l[1]=Math.ceil(l[1]/a),l[0]=Math.min(Math.max(l[0],1),r+(h?1:0)),l[1]=Math.min(Math.max(l[1],1),s),l}var iu=class{constructor(e,t){this._renderService=e,this._charSizeService=t}getCoords(e,t,i,r,s){return fk(window,e,t,i,r,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,s)}getMouseReportCoords(e,t){let i=Au(window,e,t);if(this._charSizeService.hasValidSize)return i[0]=Math.min(Math.max(i[0],0),this._renderService.dimensions.css.canvas.width-1),i[1]=Math.min(Math.max(i[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(i[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(i[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(i[0]),y:Math.floor(i[1])}}};iu=De([Z(0,Mi),Z(1,Qa)],iu);var _k=class{constructor(e,t){this._renderCallback=e,this._coreBrowserService=t,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(e){return this._refreshCallbacks.push(e),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(e,t,i){this._rowCount=i,e=e!==void 0?e:0,t=t!==void 0?t:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,e):e,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,t):t,!this._animationFrame&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0){this._runRefreshCallbacks();return}let e=Math.max(this._rowStart,0),t=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(e,t),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(let e of this._refreshCallbacks)e(0);this._refreshCallbacks=[]}},Zv={};YC(Zv,{getSafariVersion:()=>pk,isChromeOS:()=>rm,isFirefox:()=>em,isIpad:()=>vk,isIphone:()=>mk,isLegacyEdge:()=>gk,isLinux:()=>xu,isMac:()=>Pa,isNode:()=>Ua,isSafari:()=>tm,isWindows:()=>im});var Ua=typeof process<"u"&&"title"in process,Qn=Ua?"node":navigator.userAgent,Hn=Ua?"node":navigator.platform,em=Qn.includes("Firefox"),gk=Qn.includes("Edge"),tm=/^((?!chrome|android).)*safari/i.test(Qn);function pk(){if(!tm)return 0;let e=Qn.match(/Version\/(\d+)/);return e===null||e.length<2?0:parseInt(e[1])}var Pa=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(Hn),vk=Hn==="iPad",mk=Hn==="iPhone",im=["Windows","Win16","Win32","WinCE"].includes(Hn),xu=Hn.indexOf("Linux")>=0,rm=/\bCrOS\b/.test(Qn),sm=class{constructor(){this._tasks=[],this._i=0}enqueue(e){this._tasks.push(e),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(e){this._idleCallback=void 0;let t=0,i=0,r=e.timeRemaining(),s=0;for(;this._i<this._tasks.length;){if(t=performance.now(),this._tasks[this._i]()||this._i++,t=Math.max(1,performance.now()-t),i=Math.max(t,i),s=e.timeRemaining(),i*1.5>s){r-t<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(r-t))}ms`),this._start();return}r=s}this.clear()}},yk=class extends sm{_requestCallback(e){return setTimeout(()=>e(this._createDeadline(16)))}_cancelCallback(e){clearTimeout(e)}_createDeadline(e){let t=performance.now()+e;return{timeRemaining:()=>Math.max(0,t-performance.now())}}},bk=class extends sm{_requestCallback(e){return requestIdleCallback(e)}_cancelCallback(e){cancelIdleCallback(e)}},Oa=!Ua&&"requestIdleCallback"in window?bk:yk,wk=class{constructor(){this._queue=new Oa}set(e){this._queue.clear(),this._queue.enqueue(e)}flush(){this._queue.flush()}},ru=class extends oe{constructor(e,t,i,r,s,n,o,a,h){super(),this._rowCount=e,this._optionsService=i,this._charSizeService=r,this._coreService=s,this._coreBrowserService=a,this._renderer=this._register(new gs),this._pausedResizeTask=new wk,this._observerDisposable=this._register(new gs),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this._register(new Y),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this._register(new Y),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this._register(new Y),this.onRender=this._onRender.event,this._onRefreshRequest=this._register(new Y),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new _k((l,c)=>this._renderRows(l,c),this._coreBrowserService),this._register(this._renderDebouncer),this._syncOutputHandler=new Ak(this._coreBrowserService,this._coreService,()=>this._fullRefresh()),this._register(be(()=>this._syncOutputHandler.dispose())),this._register(this._coreBrowserService.onDprChange(()=>this.handleDevicePixelRatioChange())),this._register(o.onResize(()=>this._fullRefresh())),this._register(o.buffers.onBufferActivate(()=>this._renderer.value?.clear())),this._register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this._register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this._register(n.onDecorationRegistered(()=>this._fullRefresh())),this._register(n.onDecorationRemoved(()=>this._fullRefresh())),this._register(this._optionsService.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],()=>{this.clear(),this.handleResize(o.cols,o.rows),this._fullRefresh()})),this._register(this._optionsService.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(o.buffer.y,o.buffer.y,!0))),this._register(h.onChangeColors(()=>this._fullRefresh())),this._registerIntersectionObserver(this._coreBrowserService.window,t),this._register(this._coreBrowserService.onWindowChange(l=>this._registerIntersectionObserver(l,t)))}get dimensions(){return this._renderer.value.dimensions}_registerIntersectionObserver(e,t){if("IntersectionObserver"in e){let i=new e.IntersectionObserver(r=>this._handleIntersectionChange(r[r.length-1]),{threshold:0});i.observe(t),this._observerDisposable.value=be(()=>i.disconnect())}}_handleIntersectionChange(e){this._isPaused=e.isIntersecting===void 0?e.intersectionRatio===0:!e.isIntersecting,!this._isPaused&&!this._charSizeService.hasValidSize&&this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(e,t,i=!1){if(this._isPaused){this._needsFullRefresh=!0;return}if(this._coreService.decPrivateModes.synchronizedOutput){this._syncOutputHandler.bufferRows(e,t);return}let r=this._syncOutputHandler.flush();r&&(e=Math.min(e,r.start),t=Math.max(t,r.end)),i||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(e,t,this._rowCount)}_renderRows(e,t){if(this._renderer.value){if(this._coreService.decPrivateModes.synchronizedOutput){this._syncOutputHandler.bufferRows(e,t);return}e=Math.min(e,this._rowCount-1),t=Math.min(t,this._rowCount-1),this._renderer.value.renderRows(e,t),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:e,end:t}),this._onRender.fire({start:e,end:t}),this._isNextRenderRedrawOnly=!0}}resize(e,t){this._rowCount=t,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(e){this._renderer.value=e,this._renderer.value&&(this._renderer.value.onRequestRedraw(t=>this.refreshRows(t.start,t.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback(e){return this._renderDebouncer.addRefreshCallback(e)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){this._renderer.value&&(this._renderer.value.clearTextureAtlas?.(),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(e,t){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(()=>this._renderer.value?.handleResize(e,t)):this._renderer.value.handleResize(e,t),this._fullRefresh())}handleCharSizeChanged(){this._renderer.value?.handleCharSizeChanged()}handleBlur(){this._renderer.value?.handleBlur()}handleFocus(){this._renderer.value?.handleFocus()}handleSelectionChanged(e,t,i){this._selectionState.start=e,this._selectionState.end=t,this._selectionState.columnSelectMode=i,this._renderer.value?.handleSelectionChanged(e,t,i)}handleCursorMove(){this._renderer.value?.handleCursorMove()}clear(){this._renderer.value?.clear()}};ru=De([Z(2,pt),Z(3,Qa),Z(4,Ur),Z(5,Nn),Z(6,gt),Z(7,Ii),Z(8,ps)],ru);var Ak=class{constructor(e,t,i){this._coreBrowserService=e,this._coreService=t,this._onTimeout=i,this._start=0,this._end=0,this._isBuffering=!1}bufferRows(e,t){this._isBuffering?(this._start=Math.min(this._start,e),this._end=Math.max(this._end,t)):(this._start=e,this._end=t,this._isBuffering=!0),this._timeout===void 0&&(this._timeout=this._coreBrowserService.window.setTimeout(()=>{this._timeout=void 0,this._coreService.decPrivateModes.synchronizedOutput=!1,this._onTimeout()},1e3))}flush(){if(this._timeout!==void 0&&(this._coreBrowserService.window.clearTimeout(this._timeout),this._timeout=void 0),!this._isBuffering)return;let e={start:this._start,end:this._end};return this._isBuffering=!1,e}dispose(){this._timeout!==void 0&&(this._coreBrowserService.window.clearTimeout(this._timeout),this._timeout=void 0)}};function xk(e,t,i,r){let s=i.buffer.x,n=i.buffer.y;if(!i.buffer.hasScrollback)return kk(s,n,e,t,i,r)+za(n,t,i,r)+Ek(s,n,e,t,i,r);let o;if(n===t)return o=s>e?"D":"C",Pn(Math.abs(s-e),Fn(o,r));o=n>t?"D":"C";let a=Math.abs(n-t),h=Ck(n>t?e:s,i)+(a-1)*i.cols+1+Sk(n>t?s:e,i);return Pn(h,Fn(o,r))}function Sk(e,t){return e-1}function Ck(e,t){return t.cols-e}function kk(e,t,i,r,s,n){return za(t,r,s,n).length===0?"":Pn(om(e,t,e,t-Xr(t,s),!1,s).length,Fn("D",n))}function za(e,t,i,r){let s=e-Xr(e,i),n=t-Xr(t,i),o=Math.abs(s-n)-Bk(e,t,i);return Pn(o,Fn(nm(e,t),r))}function Ek(e,t,i,r,s,n){let o;za(t,r,s,n).length>0?o=r-Xr(r,s):o=t;let a=r,h=Lk(e,t,i,r,s,n);return Pn(om(e,o,i,a,h==="C",s).length,Fn(h,n))}function Bk(e,t,i){let r=0,s=e-Xr(e,i),n=t-Xr(t,i);for(let o=0;o<Math.abs(s-n);o++){let a=nm(e,t)==="A"?-1:1;i.buffer.lines.get(s+a*o)?.isWrapped&&r++}return r}function Xr(e,t){let i=0,r=t.buffer.lines.get(e),s=r?.isWrapped;for(;s&&e>=0&&e<t.rows;)i++,r=t.buffer.lines.get(--e),s=r?.isWrapped;return i}function Lk(e,t,i,r,s,n){let o;return za(i,r,s,n).length>0?o=r-Xr(r,s):o=t,e<i&&o<=r||e>=i&&o<r?"C":"D"}function nm(e,t){return e>t?"A":"B"}function om(e,t,i,r,s,n){let o=e,a=t,h="";for(;(o!==i||a!==r)&&a>=0&&a<n.buffer.lines.length;)o+=s?1:-1,s&&o>n.cols-1?(h+=n.buffer.translateBufferLineToString(a,!1,e,o),o=0,e=0,a++):!s&&o<0&&(h+=n.buffer.translateBufferLineToString(a,!1,0,e+1),o=n.cols-1,e=o,a--);return h+n.buffer.translateBufferLineToString(a,!1,e,o)}function Fn(e,t){let i=t?"O":"[";return G.ESC+i+e}function Pn(e,t){e=Math.floor(e);let i="";for(let r=0;r<e;r++)i+=t;return i}var Dk=class{constructor(e){this._bufferService=e,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:!this.selectionEnd||!this.selectionStart?this.selectionStart:this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){let e=this.selectionStart[0]+this.selectionStartLength;return e>this._bufferService.cols?e%this._bufferService.cols===0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)-1]:[e%this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)]:[e,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){let e=this.selectionStart[0]+this.selectionStartLength;return e>this._bufferService.cols?[e%this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)]:[Math.max(e,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){let e=this.selectionStart,t=this.selectionEnd;return!e||!t?!1:e[1]>t[1]||e[1]===t[1]&&e[0]>t[0]}handleTrim(e){return this.selectionStart&&(this.selectionStart[1]-=e),this.selectionEnd&&(this.selectionEnd[1]-=e),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}};function Xp(e,t){if(e.start.y>e.end.y)throw new Error(`Buffer range end (${e.end.x}, ${e.end.y}) cannot be before start (${e.start.x}, ${e.start.y})`);return t*(e.end.y-e.start.y)+(e.end.x-e.start.x+1)}var xc=50,Ik=15,Mk=50,Tk=500,Rk="\xA0",Fk=new RegExp(Rk,"g"),su=class extends oe{constructor(e,t,i,r,s,n,o,a,h){super(),this._element=e,this._screenElement=t,this._linkifier=i,this._bufferService=r,this._coreService=s,this._mouseService=n,this._optionsService=o,this._renderService=a,this._coreBrowserService=h,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new Xt,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this._register(new Y),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this._register(new Y),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this._register(new Y),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this._register(new Y),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=l=>this._handleMouseMove(l),this._mouseUpListener=l=>this._handleMouseUp(l),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim(l=>this._handleTrim(l)),this._register(this._bufferService.buffers.onBufferActivate(l=>this._handleBufferActivate(l))),this.enable(),this._model=new Dk(this._bufferService),this._activeSelectionMode=0,this._register(be(()=>{this._removeMouseDownListeners()})),this._register(this._bufferService.onResize(l=>{l.rowsChanged&&this.clearSelection()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){let e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd;return!e||!t?!1:e[0]!==t[0]||e[1]!==t[1]}get selectionText(){let e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd;if(!e||!t)return"";let i=this._bufferService.buffer,r=[];if(this._activeSelectionMode===3){if(e[0]===t[0])return"";let s=e[0]<t[0]?e[0]:t[0],n=e[0]<t[0]?t[0]:e[0];for(let o=e[1];o<=t[1];o++){let a=i.translateBufferLineToString(o,!0,s,n);r.push(a)}}else{let s=e[1]===t[1]?t[0]:void 0;r.push(i.translateBufferLineToString(e[1],!0,e[0],s));for(let n=e[1]+1;n<=t[1]-1;n++){let o=i.lines.get(n),a=i.translateBufferLineToString(n,!0);o?.isWrapped?r[r.length-1]+=a:r.push(a)}if(e[1]!==t[1]){let n=i.lines.get(t[1]),o=i.translateBufferLineToString(t[1],!0,0,t[0]);n&&n.isWrapped?r[r.length-1]+=o:r.push(o)}}return r.map(s=>s.replace(Fk," ")).join(im?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(e){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),xu&&e&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(e){let t=this._getMouseBufferCoords(e),i=this._model.finalSelectionStart,r=this._model.finalSelectionEnd;return!i||!r||!t?!1:this._areCoordsInSelection(t,i,r)}isCellInSelection(e,t){let i=this._model.finalSelectionStart,r=this._model.finalSelectionEnd;return!i||!r?!1:this._areCoordsInSelection([e,t],i,r)}_areCoordsInSelection(e,t,i){return e[1]>t[1]&&e[1]<i[1]||t[1]===i[1]&&e[1]===t[1]&&e[0]>=t[0]&&e[0]<i[0]||t[1]<i[1]&&e[1]===i[1]&&e[0]<i[0]||t[1]<i[1]&&e[1]===t[1]&&e[0]>=t[0]}_selectWordAtCursor(e,t){let i=this._linkifier.currentLink?.link?.range;if(i)return this._model.selectionStart=[i.start.x-1,i.start.y-1],this._model.selectionStartLength=Xp(i,this._bufferService.cols),this._model.selectionEnd=void 0,!0;let r=this._getMouseBufferCoords(e);return r?(this._selectWordAt(r,t),this._model.selectionEnd=void 0,!0):!1}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(e,t){this._model.clearSelection(),e=Math.max(e,0),t=Math.min(t,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,e],this._model.selectionEnd=[this._bufferService.cols,t],this.refresh(),this._onSelectionChange.fire()}_handleTrim(e){this._model.handleTrim(e)&&this.refresh()}_getMouseBufferCoords(e){let t=this._mouseService.getCoords(e,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(t)return t[0]--,t[1]--,t[1]+=this._bufferService.buffer.ydisp,t}_getMouseEventScrollAmount(e){let t=Au(this._coreBrowserService.window,e,this._screenElement)[1],i=this._renderService.dimensions.css.canvas.height;return t>=0&&t<=i?0:(t>i&&(t-=i),t=Math.min(Math.max(t,-xc),xc),t/=xc,t/Math.abs(t)+Math.round(t*(Ik-1)))}shouldForceSelection(e){return Pa?e.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:e.shiftKey}handleMouseDown(e){if(this._mouseDownTimeStamp=e.timeStamp,!(e.button===2&&this.hasSelection)&&e.button===0){if(!this._enabled){if(!this.shouldForceSelection(e))return;e.stopPropagation()}e.preventDefault(),this._dragScrollAmount=0,this._enabled&&e.shiftKey?this._handleIncrementalClick(e):e.detail===1?this._handleSingleClick(e):e.detail===2?this._handleDoubleClick(e):e.detail===3&&this._handleTripleClick(e),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),Mk)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(e){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(e))}_handleSingleClick(e){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(e)?3:0,this._model.selectionStart=this._getMouseBufferCoords(e),!this._model.selectionStart)return;this._model.selectionEnd=void 0;let t=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);t&&t.length!==this._model.selectionStart[0]&&t.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(e){this._selectWordAtCursor(e,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(e){let t=this._getMouseBufferCoords(e);t&&(this._activeSelectionMode=2,this._selectLineAt(t[1]))}shouldColumnSelect(e){return e.altKey&&!(Pa&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(e){if(e.stopImmediatePropagation(),!this._model.selectionStart)return;let t=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(e),!this._model.selectionEnd){this.refresh(!0);return}this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(e),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));let i=this._bufferService.buffer;if(this._model.selectionEnd[1]<i.lines.length){let r=i.lines.get(this._model.selectionEnd[1]);r&&r.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}(!t||t[0]!==this._model.selectionEnd[0]||t[1]!==this._model.selectionEnd[1])&&this.refresh(!0)}_dragScroll(){if(!(!this._model.selectionEnd||!this._model.selectionStart)&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});let e=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(e.ydisp+this._bufferService.rows,e.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=e.ydisp),this.refresh()}}_handleMouseUp(e){let t=e.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&t<Tk&&e.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){let i=this._mouseService.getCoords(e,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(i&&i[0]!==void 0&&i[1]!==void 0){let r=xk(i[0]-1,i[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(r,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){let e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd,i=!!e&&!!t&&(e[0]!==t[0]||e[1]!==t[1]);if(!i){this._oldHasSelection&&this._fireOnSelectionChange(e,t,i);return}!e||!t||(!this._oldSelectionStart||!this._oldSelectionEnd||e[0]!==this._oldSelectionStart[0]||e[1]!==this._oldSelectionStart[1]||t[0]!==this._oldSelectionEnd[0]||t[1]!==this._oldSelectionEnd[1])&&this._fireOnSelectionChange(e,t,i)}_fireOnSelectionChange(e,t,i){this._oldSelectionStart=e,this._oldSelectionEnd=t,this._oldHasSelection=i,this._onSelectionChange.fire()}_handleBufferActivate(e){this.clearSelection(),this._trimListener.dispose(),this._trimListener=e.activeBuffer.lines.onTrim(t=>this._handleTrim(t))}_convertViewportColToCharacterIndex(e,t){let i=t;for(let r=0;t>=r;r++){let s=e.loadCell(r,this._workCell).getChars().length;this._workCell.getWidth()===0?i--:s>1&&t!==r&&(i+=s-1)}return i}setSelection(e,t,i){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[e,t],this._model.selectionStartLength=i,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(e){this._isClickInSelection(e)||(this._selectWordAtCursor(e,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(e,t,i=!0,r=!0){if(e[0]>=this._bufferService.cols)return;let s=this._bufferService.buffer,n=s.lines.get(e[1]);if(!n)return;let o=s.translateBufferLineToString(e[1],!1),a=this._convertViewportColToCharacterIndex(n,e[0]),h=a,l=e[0]-a,c=0,u=0,p=0,g=0;if(o.charAt(a)===" "){for(;a>0&&o.charAt(a-1)===" ";)a--;for(;h<o.length&&o.charAt(h+1)===" ";)h++}else{let x=e[0],E=e[0];n.getWidth(x)===0&&(c++,x--),n.getWidth(E)===2&&(u++,E++);let R=n.getString(E).length;for(R>1&&(g+=R-1,h+=R-1);x>0&&a>0&&!this._isCharWordSeparator(n.loadCell(x-1,this._workCell));){n.loadCell(x-1,this._workCell);let D=this._workCell.getChars().length;this._workCell.getWidth()===0?(c++,x--):D>1&&(p+=D-1,a-=D-1),a--,x--}for(;E<n.length&&h+1<o.length&&!this._isCharWordSeparator(n.loadCell(E+1,this._workCell));){n.loadCell(E+1,this._workCell);let D=this._workCell.getChars().length;this._workCell.getWidth()===2?(u++,E++):D>1&&(g+=D-1,h+=D-1),h++,E++}}h++;let v=a+l-c+p,m=Math.min(this._bufferService.cols,h-a+c+u-p-g);if(!(!t&&o.slice(a,h).trim()==="")){if(i&&v===0&&n.getCodePoint(0)!==32){let x=s.lines.get(e[1]-1);if(x&&n.isWrapped&&x.getCodePoint(this._bufferService.cols-1)!==32){let E=this._getWordAt([this._bufferService.cols-1,e[1]-1],!1,!0,!1);if(E){let R=this._bufferService.cols-E.start;v-=R,m+=R}}}if(r&&v+m===this._bufferService.cols&&n.getCodePoint(this._bufferService.cols-1)!==32){let x=s.lines.get(e[1]+1);if(x?.isWrapped&&x.getCodePoint(0)!==32){let E=this._getWordAt([0,e[1]+1],!1,!1,!0);E&&(m+=E.length)}}return{start:v,length:m}}}_selectWordAt(e,t){let i=this._getWordAt(e,t);if(i){for(;i.start<0;)i.start+=this._bufferService.cols,e[1]--;this._model.selectionStart=[i.start,e[1]],this._model.selectionStartLength=i.length}}_selectToWordAt(e){let t=this._getWordAt(e,!0);if(t){let i=e[1];for(;t.start<0;)t.start+=this._bufferService.cols,i--;if(!this._model.areSelectionValuesReversed())for(;t.start+t.length>this._bufferService.cols;)t.length-=this._bufferService.cols,i++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?t.start:t.start+t.length,i]}}_isCharWordSeparator(e){return e.getWidth()===0?!1:this._optionsService.rawOptions.wordSeparator.indexOf(e.getChars())>=0}_selectLineAt(e){let t=this._bufferService.buffer.getWrappedRangeForLine(e),i={start:{x:0,y:t.first},end:{x:this._bufferService.cols-1,y:t.last}};this._model.selectionStart=[0,t.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=Xp(i,this._bufferService.cols)}};su=De([Z(3,gt),Z(4,Ur),Z(5,gu),Z(6,pt),Z(7,Mi),Z(8,Ii)],su);var Up=class{constructor(){this._data={}}set(e,t,i){this._data[e]||(this._data[e]={}),this._data[e][t]=i}get(e,t){return this._data[e]?this._data[e][t]:void 0}clear(){this._data={}}},zp=class{constructor(){this._color=new Up,this._css=new Up}setCss(e,t,i){this._css.set(e,t,i)}getCss(e,t){return this._css.get(e,t)}setColor(e,t,i){this._color.set(e,t,i)}getColor(e,t){return this._color.get(e,t)}clear(){this._color.clear(),this._css.clear()}},Xe=Object.freeze((()=>{let e=[Ee.toColor("#2e3436"),Ee.toColor("#cc0000"),Ee.toColor("#4e9a06"),Ee.toColor("#c4a000"),Ee.toColor("#3465a4"),Ee.toColor("#75507b"),Ee.toColor("#06989a"),Ee.toColor("#d3d7cf"),Ee.toColor("#555753"),Ee.toColor("#ef2929"),Ee.toColor("#8ae234"),Ee.toColor("#fce94f"),Ee.toColor("#729fcf"),Ee.toColor("#ad7fa8"),Ee.toColor("#34e2e2"),Ee.toColor("#eeeeec")],t=[0,95,135,175,215,255];for(let i=0;i<216;i++){let r=t[i/36%6|0],s=t[i/6%6|0],n=t[i%6];e.push({css:Ke.toCss(r,s,n),rgba:Ke.toRgba(r,s,n)})}for(let i=0;i<24;i++){let r=8+i*10;e.push({css:Ke.toCss(r,r,r),rgba:Ke.toRgba(r,r,r)})}return e})()),Or=Ee.toColor("#ffffff"),Bn=Ee.toColor("#000000"),Wp=Ee.toColor("#ffffff"),$p=Bn,An={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117},Pk=Or,nu=class extends oe{constructor(e){super(),this._optionsService=e,this._contrastCache=new zp,this._halfContrastCache=new zp,this._onChangeColors=this._register(new Y),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:Or,background:Bn,cursor:Wp,cursorAccent:$p,selectionForeground:void 0,selectionBackgroundTransparent:An,selectionBackgroundOpaque:ye.blend(Bn,An),selectionInactiveBackgroundTransparent:An,selectionInactiveBackgroundOpaque:ye.blend(Bn,An),scrollbarSliderBackground:ye.opacity(Or,.2),scrollbarSliderHoverBackground:ye.opacity(Or,.4),scrollbarSliderActiveBackground:ye.opacity(Or,.5),overviewRulerBorder:Or,ansi:Xe.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this._register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this._register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}get colors(){return this._colors}_setTheme(e={}){let t=this._colors;if(t.foreground=ge(e.foreground,Or),t.background=ge(e.background,Bn),t.cursor=ye.blend(t.background,ge(e.cursor,Wp)),t.cursorAccent=ye.blend(t.background,ge(e.cursorAccent,$p)),t.selectionBackgroundTransparent=ge(e.selectionBackground,An),t.selectionBackgroundOpaque=ye.blend(t.background,t.selectionBackgroundTransparent),t.selectionInactiveBackgroundTransparent=ge(e.selectionInactiveBackground,t.selectionBackgroundTransparent),t.selectionInactiveBackgroundOpaque=ye.blend(t.background,t.selectionInactiveBackgroundTransparent),t.selectionForeground=e.selectionForeground?ge(e.selectionForeground,Np):void 0,t.selectionForeground===Np&&(t.selectionForeground=void 0),ye.isOpaque(t.selectionBackgroundTransparent)&&(t.selectionBackgroundTransparent=ye.opacity(t.selectionBackgroundTransparent,.3)),ye.isOpaque(t.selectionInactiveBackgroundTransparent)&&(t.selectionInactiveBackgroundTransparent=ye.opacity(t.selectionInactiveBackgroundTransparent,.3)),t.scrollbarSliderBackground=ge(e.scrollbarSliderBackground,ye.opacity(t.foreground,.2)),t.scrollbarSliderHoverBackground=ge(e.scrollbarSliderHoverBackground,ye.opacity(t.foreground,.4)),t.scrollbarSliderActiveBackground=ge(e.scrollbarSliderActiveBackground,ye.opacity(t.foreground,.5)),t.overviewRulerBorder=ge(e.overviewRulerBorder,Pk),t.ansi=Xe.slice(),t.ansi[0]=ge(e.black,Xe[0]),t.ansi[1]=ge(e.red,Xe[1]),t.ansi[2]=ge(e.green,Xe[2]),t.ansi[3]=ge(e.yellow,Xe[3]),t.ansi[4]=ge(e.blue,Xe[4]),t.ansi[5]=ge(e.magenta,Xe[5]),t.ansi[6]=ge(e.cyan,Xe[6]),t.ansi[7]=ge(e.white,Xe[7]),t.ansi[8]=ge(e.brightBlack,Xe[8]),t.ansi[9]=ge(e.brightRed,Xe[9]),t.ansi[10]=ge(e.brightGreen,Xe[10]),t.ansi[11]=ge(e.brightYellow,Xe[11]),t.ansi[12]=ge(e.brightBlue,Xe[12]),t.ansi[13]=ge(e.brightMagenta,Xe[13]),t.ansi[14]=ge(e.brightCyan,Xe[14]),t.ansi[15]=ge(e.brightWhite,Xe[15]),e.extendedAnsi){let i=Math.min(t.ansi.length-16,e.extendedAnsi.length);for(let r=0;r<i;r++)t.ansi[r+16]=ge(e.extendedAnsi[r],Xe[r+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(e){this._restoreColor(e),this._onChangeColors.fire(this.colors)}_restoreColor(e){if(e===void 0){for(let t=0;t<this._restoreColors.ansi.length;++t)this._colors.ansi[t]=this._restoreColors.ansi[t];return}switch(e){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[e]=this._restoreColors.ansi[e]}}modifyColors(e){e(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};nu=De([Z(0,pt)],nu);function ge(e,t){if(e!==void 0)try{return Ee.toColor(e)}catch{}return t}var Ok=class{constructor(...e){this._entries=new Map;for(let[t,i]of e)this.set(t,i)}set(e,t){let i=this._entries.get(e);return this._entries.set(e,t),i}forEach(e){for(let[t,i]of this._entries.entries())e(t,i)}has(e){return this._entries.has(e)}get(e){return this._entries.get(e)}},Kk=class{constructor(){this._services=new Ok,this._services.set(_u,this)}setService(e,t){this._services.set(e,t)}getService(e){return this._services.get(e)}createInstance(e,...t){let i=s2(e).sort((n,o)=>n.index-o.index),r=[];for(let n of i){let o=this._services.get(n.id);if(!o)throw new Error(`[createInstance] ${e.name} depends on UNKNOWN service ${n.id._id}.`);r.push(o)}let s=i.length>0?i[0].index:t.length;if(t.length!==s)throw new Error(`[createInstance] First service dependency of ${e.name} at position ${s+1} conflicts with ${t.length} static arguments`);return new e(...t,...r)}},Nk={trace:0,debug:1,info:2,warn:3,error:4,off:5},Qk="xterm.js: ",ou=class extends oe{constructor(e){super(),this._optionsService=e,this._logLevel=5,this._updateLogLevel(),this._register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),Hk=this}get logLevel(){return this._logLevel}_updateLogLevel(){this._logLevel=Nk[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(e){for(let t=0;t<e.length;t++)typeof e[t]=="function"&&(e[t]=e[t]())}_log(e,t,i){this._evalLazyOptionalParams(i),e.call(console,(this._optionsService.options.logger?"":Qk)+t,...i)}trace(e,...t){this._logLevel<=0&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,e,t)}debug(e,...t){this._logLevel<=1&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,e,t)}info(e,...t){this._logLevel<=2&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,e,t)}warn(e,...t){this._logLevel<=3&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,e,t)}error(e,...t){this._logLevel<=4&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,e,t)}};ou=De([Z(0,pt)],ou);var Hk,Gp=class extends oe{constructor(e){super(),this._maxLength=e,this.onDeleteEmitter=this._register(new Y),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this._register(new Y),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this._register(new Y),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(e){if(this._maxLength===e)return;let t=new Array(e);for(let i=0;i<Math.min(e,this.length);i++)t[i]=this._array[this._getCyclicIndex(i)];this._array=t,this._maxLength=e,this._startIndex=0}get length(){return this._length}set length(e){if(e>this._length)for(let t=this._length;t<e;t++)this._array[t]=void 0;this._length=e}get(e){return this._array[this._getCyclicIndex(e)]}set(e,t){this._array[this._getCyclicIndex(e)]=t}push(e){this._array[this._getCyclicIndex(this._length)]=e,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(e,t,...i){if(t){for(let r=e;r<this._length-t;r++)this._array[this._getCyclicIndex(r)]=this._array[this._getCyclicIndex(r+t)];this._length-=t,this.onDeleteEmitter.fire({index:e,amount:t})}for(let r=this._length-1;r>=e;r--)this._array[this._getCyclicIndex(r+i.length)]=this._array[this._getCyclicIndex(r)];for(let r=0;r<i.length;r++)this._array[this._getCyclicIndex(e+r)]=i[r];if(i.length&&this.onInsertEmitter.fire({index:e,amount:i.length}),this._length+i.length>this._maxLength){let r=this._length+i.length-this._maxLength;this._startIndex+=r,this._length=this._maxLength,this.onTrimEmitter.fire(r)}else this._length+=i.length}trimStart(e){e>this._length&&(e=this._length),this._startIndex+=e,this._length-=e,this.onTrimEmitter.fire(e)}shiftElements(e,t,i){if(!(t<=0)){if(e<0||e>=this._length)throw new Error("start argument out of range");if(e+i<0)throw new Error("Cannot shift elements in list beyond index 0");if(i>0){for(let s=t-1;s>=0;s--)this.set(e+s+i,this.get(e+s));let r=e+t+i-this._length;if(r>0)for(this._length+=r;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let r=0;r<t;r++)this.set(e+r+i,this.get(e+r))}}_getCyclicIndex(e){return(this._startIndex+e)%this._maxLength}},ae=3,Oe=Object.freeze(new Kn),ya=0,Sc=2,Ln=class am{constructor(t,i,r=!1){this.isWrapped=r,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(t*ae);let s=i||Xt.fromCharData([0,vv,1,0]);for(let n=0;n<t;++n)this.setCell(n,s);this.length=t}get(t){let i=this._data[t*ae+0],r=i&2097151;return[this._data[t*ae+1],i&2097152?this._combined[t]:r?dr(r):"",i>>22,i&2097152?this._combined[t].charCodeAt(this._combined[t].length-1):r]}set(t,i){this._data[t*ae+1]=i[0],i[1].length>1?(this._combined[t]=i[1],this._data[t*ae+0]=t|2097152|i[2]<<22):this._data[t*ae+0]=i[1].charCodeAt(0)|i[2]<<22}getWidth(t){return this._data[t*ae+0]>>22}hasWidth(t){return this._data[t*ae+0]&12582912}getFg(t){return this._data[t*ae+1]}getBg(t){return this._data[t*ae+2]}hasContent(t){return this._data[t*ae+0]&4194303}getCodePoint(t){let i=this._data[t*ae+0];return i&2097152?this._combined[t].charCodeAt(this._combined[t].length-1):i&2097151}isCombined(t){return this._data[t*ae+0]&2097152}getString(t){let i=this._data[t*ae+0];return i&2097152?this._combined[t]:i&2097151?dr(i&2097151):""}isProtected(t){return this._data[t*ae+2]&536870912}loadCell(t,i){return ya=t*ae,i.content=this._data[ya+0],i.fg=this._data[ya+1],i.bg=this._data[ya+2],i.content&2097152&&(i.combinedData=this._combined[t]),i.bg&268435456&&(i.extended=this._extendedAttrs[t]),i}setCell(t,i){i.content&2097152&&(this._combined[t]=i.combinedData),i.bg&268435456&&(this._extendedAttrs[t]=i.extended),this._data[t*ae+0]=i.content,this._data[t*ae+1]=i.fg,this._data[t*ae+2]=i.bg}setCellFromCodepoint(t,i,r,s){s.bg&268435456&&(this._extendedAttrs[t]=s.extended),this._data[t*ae+0]=i|r<<22,this._data[t*ae+1]=s.fg,this._data[t*ae+2]=s.bg}addCodepointToCell(t,i,r){let s=this._data[t*ae+0];s&2097152?this._combined[t]+=dr(i):s&2097151?(this._combined[t]=dr(s&2097151)+dr(i),s&=-2097152,s|=2097152):s=i|1<<22,r&&(s&=-12582913,s|=r<<22),this._data[t*ae+0]=s}insertCells(t,i,r){if(t%=this.length,t&&this.getWidth(t-1)===2&&this.setCellFromCodepoint(t-1,0,1,r),i<this.length-t){let s=new Xt;for(let n=this.length-t-i-1;n>=0;--n)this.setCell(t+i+n,this.loadCell(t+n,s));for(let n=0;n<i;++n)this.setCell(t+n,r)}else for(let s=t;s<this.length;++s)this.setCell(s,r);this.getWidth(this.length-1)===2&&this.setCellFromCodepoint(this.length-1,0,1,r)}deleteCells(t,i,r){if(t%=this.length,i<this.length-t){let s=new Xt;for(let n=0;n<this.length-t-i;++n)this.setCell(t+n,this.loadCell(t+i+n,s));for(let n=this.length-i;n<this.length;++n)this.setCell(n,r)}else for(let s=t;s<this.length;++s)this.setCell(s,r);t&&this.getWidth(t-1)===2&&this.setCellFromCodepoint(t-1,0,1,r),this.getWidth(t)===0&&!this.hasContent(t)&&this.setCellFromCodepoint(t,0,1,r)}replaceCells(t,i,r,s=!1){if(s){for(t&&this.getWidth(t-1)===2&&!this.isProtected(t-1)&&this.setCellFromCodepoint(t-1,0,1,r),i<this.length&&this.getWidth(i-1)===2&&!this.isProtected(i)&&this.setCellFromCodepoint(i,0,1,r);t<i&&t<this.length;)this.isProtected(t)||this.setCell(t,r),t++;return}for(t&&this.getWidth(t-1)===2&&this.setCellFromCodepoint(t-1,0,1,r),i<this.length&&this.getWidth(i-1)===2&&this.setCellFromCodepoint(i,0,1,r);t<i&&t<this.length;)this.setCell(t++,r)}resize(t,i){if(t===this.length)return this._data.length*4*Sc<this._data.buffer.byteLength;let r=t*ae;if(t>this.length){if(this._data.buffer.byteLength>=r*4)this._data=new Uint32Array(this._data.buffer,0,r);else{let s=new Uint32Array(r);s.set(this._data),this._data=s}for(let s=this.length;s<t;++s)this.setCell(s,i)}else{this._data=this._data.subarray(0,r);let s=Object.keys(this._combined);for(let o=0;o<s.length;o++){let a=parseInt(s[o],10);a>=t&&delete this._combined[a]}let n=Object.keys(this._extendedAttrs);for(let o=0;o<n.length;o++){let a=parseInt(n[o],10);a>=t&&delete this._extendedAttrs[a]}}return this.length=t,r*4*Sc<this._data.buffer.byteLength}cleanupMemory(){if(this._data.length*4*Sc<this._data.buffer.byteLength){let t=new Uint32Array(this._data.length);return t.set(this._data),this._data=t,1}return 0}fill(t,i=!1){if(i){for(let r=0;r<this.length;++r)this.isProtected(r)||this.setCell(r,t);return}this._combined={},this._extendedAttrs={};for(let r=0;r<this.length;++r)this.setCell(r,t)}copyFrom(t){this.length!==t.length?this._data=new Uint32Array(t._data):this._data.set(t._data),this.length=t.length,this._combined={};for(let i in t._combined)this._combined[i]=t._combined[i];this._extendedAttrs={};for(let i in t._extendedAttrs)this._extendedAttrs[i]=t._extendedAttrs[i];this.isWrapped=t.isWrapped}clone(){let t=new am(0);t._data=new Uint32Array(this._data),t.length=this.length;for(let i in this._combined)t._combined[i]=this._combined[i];for(let i in this._extendedAttrs)t._extendedAttrs[i]=this._extendedAttrs[i];return t.isWrapped=this.isWrapped,t}getTrimmedLength(){for(let t=this.length-1;t>=0;--t)if(this._data[t*ae+0]&4194303)return t+(this._data[t*ae+0]>>22);return 0}getNoBgTrimmedLength(){for(let t=this.length-1;t>=0;--t)if(this._data[t*ae+0]&4194303||this._data[t*ae+2]&50331648)return t+(this._data[t*ae+0]>>22);return 0}copyCellsFrom(t,i,r,s,n){let o=t._data;if(n)for(let h=s-1;h>=0;h--){for(let l=0;l<ae;l++)this._data[(r+h)*ae+l]=o[(i+h)*ae+l];o[(i+h)*ae+2]&268435456&&(this._extendedAttrs[r+h]=t._extendedAttrs[i+h])}else for(let h=0;h<s;h++){for(let l=0;l<ae;l++)this._data[(r+h)*ae+l]=o[(i+h)*ae+l];o[(i+h)*ae+2]&268435456&&(this._extendedAttrs[r+h]=t._extendedAttrs[i+h])}let a=Object.keys(t._combined);for(let h=0;h<a.length;h++){let l=parseInt(a[h],10);l>=i&&(this._combined[l-i+r]=t._combined[l])}}translateToString(t,i,r,s){i=i??0,r=r??this.length,t&&(r=Math.min(r,this.getTrimmedLength())),s&&(s.length=0);let n="";for(;i<r;){let o=this._data[i*ae+0],a=o&2097151,h=o&2097152?this._combined[i]:a?dr(a):fr;if(n+=h,s)for(let l=0;l<h.length;++l)s.push(i);i+=o>>22||1}return s&&s.push(i),n}};function Xk(e,t,i,r,s,n){let o=[];for(let a=0;a<e.length-1;a++){let h=a,l=e.get(++h);if(!l.isWrapped)continue;let c=[e.get(a)];for(;h<e.length&&l.isWrapped;)c.push(l),l=e.get(++h);if(!n&&r>=a&&r<h){a+=c.length-1;continue}let u=0,p=On(c,u,t),g=1,v=0;for(;g<c.length;){let x=On(c,g,t),E=x-v,R=i-p,D=Math.min(E,R);c[u].copyCellsFrom(c[g],v,p,D,!1),p+=D,p===i&&(u++,p=0),v+=D,v===x&&(g++,v=0),p===0&&u!==0&&c[u-1].getWidth(i-1)===2&&(c[u].copyCellsFrom(c[u-1],i-1,p++,1,!1),c[u-1].setCell(i-1,s))}c[u].replaceCells(p,i,s);let m=0;for(let x=c.length-1;x>0&&(x>u||c[x].getTrimmedLength()===0);x--)m++;m>0&&(o.push(a+c.length-m),o.push(m)),a+=c.length-1}return o}function Uk(e,t){let i=[],r=0,s=t[r],n=0;for(let o=0;o<e.length;o++)if(s===o){let a=t[++r];e.onDeleteEmitter.fire({index:o-n,amount:a}),o+=a-1,n+=a,s=t[++r]}else i.push(o);return{layout:i,countRemoved:n}}function zk(e,t){let i=[];for(let r=0;r<t.length;r++)i.push(e.get(t[r]));for(let r=0;r<i.length;r++)e.set(r,i[r]);e.length=t.length}function Wk(e,t,i){let r=[],s=e.map((h,l)=>On(e,l,t)).reduce((h,l)=>h+l),n=0,o=0,a=0;for(;a<s;){if(s-a<i){r.push(s-a);break}n+=i;let h=On(e,o,t);n>h&&(n-=h,o++);let l=e[o].getWidth(n-1)===2;l&&n--;let c=l?i-1:i;r.push(c),a+=c}return r}function On(e,t,i){if(t===e.length-1)return e[t].getTrimmedLength();let r=!e[t].hasContent(i-1)&&e[t].getWidth(i-1)===1,s=e[t+1].getWidth(0)===2;return r&&s?i-1:i}var lm=class hm{constructor(t){this.line=t,this.isDisposed=!1,this._disposables=[],this._id=hm._nextId++,this._onDispose=this.register(new Y),this.onDispose=this._onDispose.event}get id(){return this._id}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),Hr(this._disposables),this._disposables.length=0)}register(t){return this._disposables.push(t),t}};lm._nextId=1;var $k=lm,ze={},Kr=ze.B;ze[0]={"`":"\u25C6",a:"\u2592",b:"\u2409",c:"\u240C",d:"\u240D",e:"\u240A",f:"\xB0",g:"\xB1",h:"\u2424",i:"\u240B",j:"\u2518",k:"\u2510",l:"\u250C",m:"\u2514",n:"\u253C",o:"\u23BA",p:"\u23BB",q:"\u2500",r:"\u23BC",s:"\u23BD",t:"\u251C",u:"\u2524",v:"\u2534",w:"\u252C",x:"\u2502",y:"\u2264",z:"\u2265","{":"\u03C0","|":"\u2260","}":"\xA3","~":"\xB7"};ze.A={"#":"\xA3"};ze.B=void 0;ze[4]={"#":"\xA3","@":"\xBE","[":"ij","\\":"\xBD","]":"|","{":"\xA8","|":"f","}":"\xBC","~":"\xB4"};ze.C=ze[5]={"[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"};ze.R={"#":"\xA3","@":"\xE0","[":"\xB0","\\":"\xE7","]":"\xA7","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xA8"};ze.Q={"@":"\xE0","[":"\xE2","\\":"\xE7","]":"\xEA","^":"\xEE","`":"\xF4","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xFB"};ze.K={"@":"\xA7","[":"\xC4","\\":"\xD6","]":"\xDC","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xDF"};ze.Y={"#":"\xA3","@":"\xA7","[":"\xB0","\\":"\xE7","]":"\xE9","`":"\xF9","{":"\xE0","|":"\xF2","}":"\xE8","~":"\xEC"};ze.E=ze[6]={"@":"\xC4","[":"\xC6","\\":"\xD8","]":"\xC5","^":"\xDC","`":"\xE4","{":"\xE6","|":"\xF8","}":"\xE5","~":"\xFC"};ze.Z={"#":"\xA3","@":"\xA7","[":"\xA1","\\":"\xD1","]":"\xBF","{":"\xB0","|":"\xF1","}":"\xE7"};ze.H=ze[7]={"@":"\xC9","[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"};ze["="]={"#":"\xF9","@":"\xE0","[":"\xE9","\\":"\xE7","]":"\xEA","^":"\xEE",_:"\xE8","`":"\xF4","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xFB"};var jp=4294967295,qp=class{constructor(e,t,i){this._hasScrollback=e,this._optionsService=t,this._bufferService=i,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=Oe.clone(),this.savedCharset=Kr,this.markers=[],this._nullCell=Xt.fromCharData([0,vv,1,0]),this._whitespaceCell=Xt.fromCharData([0,fr,1,32]),this._isClearing=!1,this._memoryCleanupQueue=new Oa,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new Gp(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(e){return e?(this._nullCell.fg=e.fg,this._nullCell.bg=e.bg,this._nullCell.extended=e.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new Da),this._nullCell}getWhitespaceCell(e){return e?(this._whitespaceCell.fg=e.fg,this._whitespaceCell.bg=e.bg,this._whitespaceCell.extended=e.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new Da),this._whitespaceCell}getBlankLine(e,t){return new Ln(this._bufferService.cols,this.getNullCell(e),t)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){let e=this.ybase+this.y-this.ydisp;return e>=0&&e<this._rows}_getCorrectBufferLength(e){if(!this._hasScrollback)return e;let t=e+this._optionsService.rawOptions.scrollback;return t>jp?jp:t}fillViewportRows(e){if(this.lines.length===0){e===void 0&&(e=Oe);let t=this._rows;for(;t--;)this.lines.push(this.getBlankLine(e))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new Gp(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(e,t){let i=this.getNullCell(Oe),r=0,s=this._getCorrectBufferLength(t);if(s>this.lines.maxLength&&(this.lines.maxLength=s),this.lines.length>0){if(this._cols<e)for(let o=0;o<this.lines.length;o++)r+=+this.lines.get(o).resize(e,i);let n=0;if(this._rows<t)for(let o=this._rows;o<t;o++)this.lines.length<t+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new Ln(e,i)):this.ybase>0&&this.lines.length<=this.ybase+this.y+n+1?(this.ybase--,n++,this.ydisp>0&&this.ydisp--):this.lines.push(new Ln(e,i)));else for(let o=this._rows;o>t;o--)this.lines.length>t+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(s<this.lines.maxLength){let o=this.lines.length-s;o>0&&(this.lines.trimStart(o),this.ybase=Math.max(this.ybase-o,0),this.ydisp=Math.max(this.ydisp-o,0),this.savedY=Math.max(this.savedY-o,0)),this.lines.maxLength=s}this.x=Math.min(this.x,e-1),this.y=Math.min(this.y,t-1),n&&(this.y+=n),this.savedX=Math.min(this.savedX,e-1),this.scrollTop=0}if(this.scrollBottom=t-1,this._isReflowEnabled&&(this._reflow(e,t),this._cols>e))for(let n=0;n<this.lines.length;n++)r+=+this.lines.get(n).resize(e,i);this._cols=e,this._rows=t,this._memoryCleanupQueue.clear(),r>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let e=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,e=!1);let t=0;for(;this._memoryCleanupPosition<this.lines.length;)if(t+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),t>100)return!0;return e}get _isReflowEnabled(){let e=this._optionsService.rawOptions.windowsPty;return e&&e.buildNumber?this._hasScrollback&&e.backend==="conpty"&&e.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(e,t){this._cols!==e&&(e>this._cols?this._reflowLarger(e,t):this._reflowSmaller(e,t))}_reflowLarger(e,t){let i=this._optionsService.rawOptions.reflowCursorLine,r=Xk(this.lines,this._cols,e,this.ybase+this.y,this.getNullCell(Oe),i);if(r.length>0){let s=Uk(this.lines,r);zk(this.lines,s.layout),this._reflowLargerAdjustViewport(e,t,s.countRemoved)}}_reflowLargerAdjustViewport(e,t,i){let r=this.getNullCell(Oe),s=i;for(;s-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<t&&this.lines.push(new Ln(e,r))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-i,0)}_reflowSmaller(e,t){let i=this._optionsService.rawOptions.reflowCursorLine,r=this.getNullCell(Oe),s=[],n=0;for(let o=this.lines.length-1;o>=0;o--){let a=this.lines.get(o);if(!a||!a.isWrapped&&a.getTrimmedLength()<=e)continue;let h=[a];for(;a.isWrapped&&o>0;)a=this.lines.get(--o),h.unshift(a);if(!i){let D=this.ybase+this.y;if(D>=o&&D<o+h.length)continue}let l=h[h.length-1].getTrimmedLength(),c=Wk(h,this._cols,e),u=c.length-h.length,p;this.ybase===0&&this.y!==this.lines.length-1?p=Math.max(0,this.y-this.lines.maxLength+u):p=Math.max(0,this.lines.length-this.lines.maxLength+u);let g=[];for(let D=0;D<u;D++){let b=this.getBlankLine(Oe,!0);g.push(b)}g.length>0&&(s.push({start:o+h.length+n,newLines:g}),n+=g.length),h.push(...g);let v=c.length-1,m=c[v];m===0&&(v--,m=c[v]);let x=h.length-u-1,E=l;for(;x>=0;){let D=Math.min(E,m);if(h[v]===void 0)break;if(h[v].copyCellsFrom(h[x],E-D,m-D,D,!0),m-=D,m===0&&(v--,m=c[v]),E-=D,E===0){x--;let b=Math.max(x,0);E=On(h,b,this._cols)}}for(let D=0;D<h.length;D++)c[D]<e&&h[D].setCell(c[D],r);let R=u-p;for(;R-- >0;)this.ybase===0?this.y<t-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+n)-t&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+u,this.ybase+t-1)}if(s.length>0){let o=[],a=[];for(let m=0;m<this.lines.length;m++)a.push(this.lines.get(m));let h=this.lines.length,l=h-1,c=0,u=s[c];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+n);let p=0;for(let m=Math.min(this.lines.maxLength-1,h+n-1);m>=0;m--)if(u&&u.start>l+p){for(let x=u.newLines.length-1;x>=0;x--)this.lines.set(m--,u.newLines[x]);m++,o.push({index:l+1,amount:u.newLines.length}),p+=u.newLines.length,u=s[++c]}else this.lines.set(m,a[l--]);let g=0;for(let m=o.length-1;m>=0;m--)o[m].index+=g,this.lines.onInsertEmitter.fire(o[m]),g+=o[m].amount;let v=Math.max(0,h+n-this.lines.maxLength);v>0&&this.lines.onTrimEmitter.fire(v)}}translateBufferLineToString(e,t,i=0,r){let s=this.lines.get(e);return s?s.translateToString(t,i,r):""}getWrappedRangeForLine(e){let t=e,i=e;for(;t>0&&this.lines.get(t).isWrapped;)t--;for(;i+1<this.lines.length&&this.lines.get(i+1).isWrapped;)i++;return{first:t,last:i}}setupTabStops(e){for(e!=null?this.tabs[e]||(e=this.prevStop(e)):(this.tabs={},e=0);e<this._cols;e+=this._optionsService.rawOptions.tabStopWidth)this.tabs[e]=!0}prevStop(e){for(e==null&&(e=this.x);!this.tabs[--e]&&e>0;);return e>=this._cols?this._cols-1:e<0?0:e}nextStop(e){for(e==null&&(e=this.x);!this.tabs[++e]&&e<this._cols;);return e>=this._cols?this._cols-1:e<0?0:e}clearMarkers(e){this._isClearing=!0;for(let t=0;t<this.markers.length;t++)this.markers[t].line===e&&(this.markers[t].dispose(),this.markers.splice(t--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let e=0;e<this.markers.length;e++)this.markers[e].dispose();this.markers.length=0,this._isClearing=!1}addMarker(e){let t=new $k(e);return this.markers.push(t),t.register(this.lines.onTrim(i=>{t.line-=i,t.line<0&&t.dispose()})),t.register(this.lines.onInsert(i=>{t.line>=i.index&&(t.line+=i.amount)})),t.register(this.lines.onDelete(i=>{t.line>=i.index&&t.line<i.index+i.amount&&t.dispose(),t.line>i.index&&(t.line-=i.amount)})),t.register(t.onDispose(()=>this._removeMarker(t))),t}_removeMarker(e){this._isClearing||this.markers.splice(this.markers.indexOf(e),1)}},Gk=class extends oe{constructor(e,t){super(),this._optionsService=e,this._bufferService=t,this._onBufferActivate=this._register(new Y),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this._register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this._register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new qp(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new qp(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(e){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(e),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(e,t){this._normal.resize(e,t),this._alt.resize(e,t),this.setupTabStops(e)}setupTabStops(e){this._normal.setupTabStops(e),this._alt.setupTabStops(e)}},cm=2,um=1,au=class extends oe{constructor(e){super(),this.isUserScrolling=!1,this._onResize=this._register(new Y),this.onResize=this._onResize.event,this._onScroll=this._register(new Y),this.onScroll=this._onScroll.event,this.cols=Math.max(e.rawOptions.cols||0,cm),this.rows=Math.max(e.rawOptions.rows||0,um),this.buffers=this._register(new Gk(e,this)),this._register(this.buffers.onBufferActivate(t=>{this._onScroll.fire(t.activeBuffer.ydisp)}))}get buffer(){return this.buffers.active}resize(e,t){let i=this.cols!==e,r=this.rows!==t;this.cols=e,this.rows=t,this.buffers.resize(e,t),this._onResize.fire({cols:e,rows:t,colsChanged:i,rowsChanged:r})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(e,t=!1){let i=this.buffer,r;r=this._cachedBlankLine,(!r||r.length!==this.cols||r.getFg(0)!==e.fg||r.getBg(0)!==e.bg)&&(r=i.getBlankLine(e,t),this._cachedBlankLine=r),r.isWrapped=t;let s=i.ybase+i.scrollTop,n=i.ybase+i.scrollBottom;if(i.scrollTop===0){let o=i.lines.isFull;n===i.lines.length-1?o?i.lines.recycle().copyFrom(r):i.lines.push(r.clone()):i.lines.splice(n+1,0,r.clone()),o?this.isUserScrolling&&(i.ydisp=Math.max(i.ydisp-1,0)):(i.ybase++,this.isUserScrolling||i.ydisp++)}else{let o=n-s+1;i.lines.shiftElements(s+1,o-1,-1),i.lines.set(n,r.clone())}this.isUserScrolling||(i.ydisp=i.ybase),this._onScroll.fire(i.ydisp)}scrollLines(e,t){let i=this.buffer;if(e<0){if(i.ydisp===0)return;this.isUserScrolling=!0}else e+i.ydisp>=i.ybase&&(this.isUserScrolling=!1);let r=i.ydisp;i.ydisp=Math.max(Math.min(i.ydisp+e,i.ybase),0),r!==i.ydisp&&(t||this._onScroll.fire(i.ydisp))}};au=De([Z(0,pt)],au);var fs={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnEraseInDisplay:!1,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},reflowCursorLine:!1,rescaleOverlappingGlyphs:!1,rightClickSelectsWord:Pa,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRuler:{}},jk=["normal","bold","100","200","300","400","500","600","700","800","900"],qk=class extends oe{constructor(e){super(),this._onOptionChange=this._register(new Y),this.onOptionChange=this._onOptionChange.event;let t={...fs};for(let i in e)if(i in t)try{let r=e[i];t[i]=this._sanitizeAndValidateOption(i,r)}catch(r){console.error(r)}this.rawOptions=t,this.options={...t},this._setupOptions(),this._register(be(()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null}))}onSpecificOptionChange(e,t){return this.onOptionChange(i=>{i===e&&t(this.rawOptions[e])})}onMultipleOptionChange(e,t){return this.onOptionChange(i=>{e.indexOf(i)!==-1&&t()})}_setupOptions(){let e=i=>{if(!(i in fs))throw new Error(`No option with key "${i}"`);return this.rawOptions[i]},t=(i,r)=>{if(!(i in fs))throw new Error(`No option with key "${i}"`);r=this._sanitizeAndValidateOption(i,r),this.rawOptions[i]!==r&&(this.rawOptions[i]=r,this._onOptionChange.fire(i))};for(let i in this.rawOptions){let r={get:e.bind(this,i),set:t.bind(this,i)};Object.defineProperty(this.options,i,r)}}_sanitizeAndValidateOption(e,t){switch(e){case"cursorStyle":if(t||(t=fs[e]),!Vk(t))throw new Error(`"${t}" is not a valid value for ${e}`);break;case"wordSeparator":t||(t=fs[e]);break;case"fontWeight":case"fontWeightBold":if(typeof t=="number"&&1<=t&&t<=1e3)break;t=jk.includes(t)?t:fs[e];break;case"cursorWidth":t=Math.floor(t);case"lineHeight":case"tabStopWidth":if(t<1)throw new Error(`${e} cannot be less than 1, value: ${t}`);break;case"minimumContrastRatio":t=Math.max(1,Math.min(21,Math.round(t*10)/10));break;case"scrollback":if(t=Math.min(t,4294967295),t<0)throw new Error(`${e} cannot be less than 0, value: ${t}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(t<=0)throw new Error(`${e} cannot be less than or equal to 0, value: ${t}`);break;case"rows":case"cols":if(!t&&t!==0)throw new Error(`${e} must be numeric, value: ${t}`);break;case"windowsPty":t=t??{};break}return t}};function Vk(e){return e==="block"||e==="underline"||e==="bar"}function Dn(e,t=5){if(typeof e!="object")return e;let i=Array.isArray(e)?[]:{};for(let r in e)i[r]=t<=1?e[r]:e[r]&&Dn(e[r],t-1);return i}var Vp=Object.freeze({insertMode:!1}),Yp=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,cursorBlink:void 0,cursorStyle:void 0,origin:!1,reverseWraparound:!1,sendFocus:!1,synchronizedOutput:!1,wraparound:!0}),lu=class extends oe{constructor(e,t,i){super(),this._bufferService=e,this._logService=t,this._optionsService=i,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this._register(new Y),this.onData=this._onData.event,this._onUserInput=this._register(new Y),this.onUserInput=this._onUserInput.event,this._onBinary=this._register(new Y),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this._register(new Y),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=Dn(Vp),this.decPrivateModes=Dn(Yp)}reset(){this.modes=Dn(Vp),this.decPrivateModes=Dn(Yp)}triggerDataEvent(e,t=!1){if(this._optionsService.rawOptions.disableStdin)return;let i=this._bufferService.buffer;t&&this._optionsService.rawOptions.scrollOnUserInput&&i.ybase!==i.ydisp&&this._onRequestScrollToBottom.fire(),t&&this._onUserInput.fire(),this._logService.debug(`sending data "${e}"`),this._logService.trace("sending data (codes)",()=>e.split("").map(r=>r.charCodeAt(0))),this._onData.fire(e)}triggerBinaryEvent(e){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${e}"`),this._logService.trace("sending binary (codes)",()=>e.split("").map(t=>t.charCodeAt(0))),this._onBinary.fire(e))}};lu=De([Z(0,gt),Z(1,Av),Z(2,pt)],lu);var Jp={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:e=>e.button===4||e.action!==1?!1:(e.ctrl=!1,e.alt=!1,e.shift=!1,!0)},VT200:{events:19,restrict:e=>e.action!==32},DRAG:{events:23,restrict:e=>!(e.action===32&&e.button===3)},ANY:{events:31,restrict:e=>!0}};function Cc(e,t){let i=(e.ctrl?16:0)|(e.shift?4:0)|(e.alt?8:0);return e.button===4?(i|=64,i|=e.action):(i|=e.button&3,e.button&4&&(i|=64),e.button&8&&(i|=128),e.action===32?i|=32:e.action===0&&!t&&(i|=3)),i}var kc=String.fromCharCode,Zp={DEFAULT:e=>{let t=[Cc(e,!1)+32,e.col+32,e.row+32];return t[0]>255||t[1]>255||t[2]>255?"":`\x1B[M${kc(t[0])}${kc(t[1])}${kc(t[2])}`},SGR:e=>{let t=e.action===0&&e.button!==4?"m":"M";return`\x1B[<${Cc(e,!0)};${e.col};${e.row}${t}`},SGR_PIXELS:e=>{let t=e.action===0&&e.button!==4?"m":"M";return`\x1B[<${Cc(e,!0)};${e.x};${e.y}${t}`}},hu=class extends oe{constructor(e,t,i){super(),this._bufferService=e,this._coreService=t,this._optionsService=i,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._wheelPartialScroll=0,this._onProtocolChange=this._register(new Y),this.onProtocolChange=this._onProtocolChange.event;for(let r of Object.keys(Jp))this.addProtocol(r,Jp[r]);for(let r of Object.keys(Zp))this.addEncoding(r,Zp[r]);this.reset()}addProtocol(e,t){this._protocols[e]=t}addEncoding(e,t){this._encodings[e]=t}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(e){if(!this._protocols[e])throw new Error(`unknown protocol "${e}"`);this._activeProtocol=e,this._onProtocolChange.fire(this._protocols[e].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(e){if(!this._encodings[e])throw new Error(`unknown encoding "${e}"`);this._activeEncoding=e}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null,this._wheelPartialScroll=0}consumeWheelEvent(e,t,i){if(e.deltaY===0||e.shiftKey||t===void 0||i===void 0)return 0;let r=t/i,s=this._applyScrollModifier(e.deltaY,e);return e.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(s/=r+0,Math.abs(e.deltaY)<50&&(s*=.3),this._wheelPartialScroll+=s,s=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):e.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(s*=this._bufferService.rows),s}_applyScrollModifier(e,t){return t.altKey||t.ctrlKey||t.shiftKey?e*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:e*this._optionsService.rawOptions.scrollSensitivity}triggerMouseEvent(e){if(e.col<0||e.col>=this._bufferService.cols||e.row<0||e.row>=this._bufferService.rows||e.button===4&&e.action===32||e.button===3&&e.action!==32||e.button!==4&&(e.action===2||e.action===3)||(e.col++,e.row++,e.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,e,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(e))return!1;let t=this._encodings[this._activeEncoding](e);return t&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(t):this._coreService.triggerDataEvent(t,!0)),this._lastEvent=e,!0}explainEvents(e){return{down:!!(e&1),up:!!(e&2),drag:!!(e&4),move:!!(e&8),wheel:!!(e&16)}}_equalEvents(e,t,i){if(i){if(e.x!==t.x||e.y!==t.y)return!1}else if(e.col!==t.col||e.row!==t.row)return!1;return!(e.button!==t.button||e.action!==t.action||e.ctrl!==t.ctrl||e.alt!==t.alt||e.shift!==t.shift)}};hu=De([Z(0,gt),Z(1,Ur),Z(2,pt)],hu);var Ec=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],Yk=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],Ue;function Jk(e,t){let i=0,r=t.length-1,s;if(e<t[0][0]||e>t[r][1])return!1;for(;r>=i;)if(s=i+r>>1,e>t[s][1])i=s+1;else if(e<t[s][0])r=s-1;else return!0;return!1}var Zk=class{constructor(){if(this.version="6",!Ue){Ue=new Uint8Array(65536),Ue.fill(1),Ue[0]=0,Ue.fill(0,1,32),Ue.fill(0,127,160),Ue.fill(2,4352,4448),Ue[9001]=2,Ue[9002]=2,Ue.fill(2,11904,42192),Ue[12351]=1,Ue.fill(2,44032,55204),Ue.fill(2,63744,64256),Ue.fill(2,65040,65050),Ue.fill(2,65072,65136),Ue.fill(2,65280,65377),Ue.fill(2,65504,65511);for(let e=0;e<Ec.length;++e)Ue.fill(0,Ec[e][0],Ec[e][1]+1)}}wcwidth(e){return e<32?0:e<127?1:e<65536?Ue[e]:Jk(e,Yk)?0:e>=131072&&e<=196605||e>=196608&&e<=262141?2:1}charProperties(e,t){let i=this.wcwidth(e),r=i===0&&t!==0;if(r){let s=Nr.extractWidth(t);s===0?r=!1:s>i&&(i=s)}return Nr.createPropertyValue(0,i,r)}},Nr=class La{constructor(){this._providers=Object.create(null),this._active="",this._onChange=new Y,this.onChange=this._onChange.event;let t=new Zk;this.register(t),this._active=t.version,this._activeProvider=t}static extractShouldJoin(t){return(t&1)!==0}static extractWidth(t){return t>>1&3}static extractCharKind(t){return t>>3}static createPropertyValue(t,i,r=!1){return(t&16777215)<<3|(i&3)<<1|(r?1:0)}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(t){if(!this._providers[t])throw new Error(`unknown Unicode version "${t}"`);this._active=t,this._activeProvider=this._providers[t],this._onChange.fire(t)}register(t){this._providers[t.version]=t}wcwidth(t){return this._activeProvider.wcwidth(t)}getStringCellWidth(t){let i=0,r=0,s=t.length;for(let n=0;n<s;++n){let o=t.charCodeAt(n);if(55296<=o&&o<=56319){if(++n>=s)return i+this.wcwidth(o);let l=t.charCodeAt(n);56320<=l&&l<=57343?o=(o-55296)*1024+l-56320+65536:i+=this.wcwidth(l)}let a=this.charProperties(o,r),h=La.extractWidth(a);La.extractShouldJoin(a)&&(h-=La.extractWidth(r)),i+=h,r=a}return i}charProperties(t,i){return this._activeProvider.charProperties(t,i)}},eE=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(e){this.glevel=e,this.charset=this._charsets[e]}setgCharset(e,t){this._charsets[e]=t,this.glevel===e&&(this.charset=t)}};function ev(e){let t=e.buffer.lines.get(e.buffer.ybase+e.buffer.y-1)?.get(e.cols-1),i=e.buffer.lines.get(e.buffer.ybase+e.buffer.y);i&&t&&(i.isWrapped=t[3]!==0&&t[3]!==32)}var xn=2147483647,tE=256,dm=class cu{constructor(t=32,i=32){if(this.maxLength=t,this.maxSubParamsLength=i,i>tE)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(t),this.length=0,this._subParams=new Int32Array(i),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(t),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}static fromArray(t){let i=new cu;if(!t.length)return i;for(let r=Array.isArray(t[0])?1:0;r<t.length;++r){let s=t[r];if(Array.isArray(s))for(let n=0;n<s.length;++n)i.addSubParam(s[n]);else i.addParam(s)}return i}clone(){let t=new cu(this.maxLength,this.maxSubParamsLength);return t.params.set(this.params),t.length=this.length,t._subParams.set(this._subParams),t._subParamsLength=this._subParamsLength,t._subParamsIdx.set(this._subParamsIdx),t._rejectDigits=this._rejectDigits,t._rejectSubDigits=this._rejectSubDigits,t._digitIsSub=this._digitIsSub,t}toArray(){let t=[];for(let i=0;i<this.length;++i){t.push(this.params[i]);let r=this._subParamsIdx[i]>>8,s=this._subParamsIdx[i]&255;s-r>0&&t.push(Array.prototype.slice.call(this._subParams,r,s))}return t}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(t){if(this._digitIsSub=!1,this.length>=this.maxLength){this._rejectDigits=!0;return}if(t<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=t>xn?xn:t}addSubParam(t){if(this._digitIsSub=!0,!!this.length){if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength){this._rejectSubDigits=!0;return}if(t<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=t>xn?xn:t,this._subParamsIdx[this.length-1]++}}hasSubParams(t){return(this._subParamsIdx[t]&255)-(this._subParamsIdx[t]>>8)>0}getSubParams(t){let i=this._subParamsIdx[t]>>8,r=this._subParamsIdx[t]&255;return r-i>0?this._subParams.subarray(i,r):null}getSubParamsAll(){let t={};for(let i=0;i<this.length;++i){let r=this._subParamsIdx[i]>>8,s=this._subParamsIdx[i]&255;s-r>0&&(t[i]=this._subParams.slice(r,s))}return t}addDigit(t){let i;if(this._rejectDigits||!(i=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;let r=this._digitIsSub?this._subParams:this.params,s=r[i-1];r[i-1]=~s?Math.min(s*10+t,xn):t}},Sn=[],iE=class{constructor(){this._state=0,this._active=Sn,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(e,t){this._handlers[e]===void 0&&(this._handlers[e]=[]);let i=this._handlers[e];return i.push(t),{dispose:()=>{let r=i.indexOf(t);r!==-1&&i.splice(r,1)}}}clearHandler(e){this._handlers[e]&&delete this._handlers[e]}setHandlerFallback(e){this._handlerFb=e}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=Sn}reset(){if(this._state===2)for(let e=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;e>=0;--e)this._active[e].end(!1);this._stack.paused=!1,this._active=Sn,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||Sn,!this._active.length)this._handlerFb(this._id,"START");else for(let e=this._active.length-1;e>=0;e--)this._active[e].start()}_put(e,t,i){if(!this._active.length)this._handlerFb(this._id,"PUT",Na(e,t,i));else for(let r=this._active.length-1;r>=0;r--)this._active[r].put(e,t,i)}start(){this.reset(),this._state=1}put(e,t,i){if(this._state!==3){if(this._state===1)for(;t<i;){let r=e[t++];if(r===59){this._state=2,this._start();break}if(r<48||57<r){this._state=3;return}this._id===-1&&(this._id=0),this._id=this._id*10+r-48}this._state===2&&i-t>0&&this._put(e,t,i)}}end(e,t=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),!this._active.length)this._handlerFb(this._id,"END",e);else{let i=!1,r=this._active.length-1,s=!1;if(this._stack.paused&&(r=this._stack.loopPosition-1,i=t,s=this._stack.fallThrough,this._stack.paused=!1),!s&&i===!1){for(;r>=0&&(i=this._active[r].end(e),i!==!0);r--)if(i instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!1,i;r--}for(;r>=0;r--)if(i=this._active[r].end(!1),i instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!0,i}this._active=Sn,this._id=-1,this._state=0}}},Et=class{constructor(e){this._handler=e,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(e,t,i){this._hitLimit||(this._data+=Na(e,t,i),this._data.length>1e7&&(this._data="",this._hitLimit=!0))}end(e){let t=!1;if(this._hitLimit)t=!1;else if(e&&(t=this._handler(this._data),t instanceof Promise))return t.then(i=>(this._data="",this._hitLimit=!1,i));return this._data="",this._hitLimit=!1,t}},Cn=[],rE=class{constructor(){this._handlers=Object.create(null),this._active=Cn,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=Cn}registerHandler(e,t){this._handlers[e]===void 0&&(this._handlers[e]=[]);let i=this._handlers[e];return i.push(t),{dispose:()=>{let r=i.indexOf(t);r!==-1&&i.splice(r,1)}}}clearHandler(e){this._handlers[e]&&delete this._handlers[e]}setHandlerFallback(e){this._handlerFb=e}reset(){if(this._active.length)for(let e=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;e>=0;--e)this._active[e].unhook(!1);this._stack.paused=!1,this._active=Cn,this._ident=0}hook(e,t){if(this.reset(),this._ident=e,this._active=this._handlers[e]||Cn,!this._active.length)this._handlerFb(this._ident,"HOOK",t);else for(let i=this._active.length-1;i>=0;i--)this._active[i].hook(t)}put(e,t,i){if(!this._active.length)this._handlerFb(this._ident,"PUT",Na(e,t,i));else for(let r=this._active.length-1;r>=0;r--)this._active[r].put(e,t,i)}unhook(e,t=!0){if(!this._active.length)this._handlerFb(this._ident,"UNHOOK",e);else{let i=!1,r=this._active.length-1,s=!1;if(this._stack.paused&&(r=this._stack.loopPosition-1,i=t,s=this._stack.fallThrough,this._stack.paused=!1),!s&&i===!1){for(;r>=0&&(i=this._active[r].unhook(e),i!==!0);r--)if(i instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!1,i;r--}for(;r>=0;r--)if(i=this._active[r].unhook(!1),i instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!0,i}this._active=Cn,this._ident=0}},In=new dm;In.addParam(0);var tv=class{constructor(e){this._handler=e,this._data="",this._params=In,this._hitLimit=!1}hook(e){this._params=e.length>1||e.params[0]?e.clone():In,this._data="",this._hitLimit=!1}put(e,t,i){this._hitLimit||(this._data+=Na(e,t,i),this._data.length>1e7&&(this._data="",this._hitLimit=!0))}unhook(e){let t=!1;if(this._hitLimit)t=!1;else if(e&&(t=this._handler(this._data,this._params),t instanceof Promise))return t.then(i=>(this._params=In,this._data="",this._hitLimit=!1,i));return this._params=In,this._data="",this._hitLimit=!1,t}},sE=class{constructor(e){this.table=new Uint8Array(e)}setDefault(e,t){this.table.fill(e<<4|t)}add(e,t,i,r){this.table[t<<8|e]=i<<4|r}addMany(e,t,i,r){for(let s=0;s<e.length;s++)this.table[t<<8|e[s]]=i<<4|r}},Ht=160,nE=function(){let e=new sE(4095),t=Array.apply(null,Array(256)).map((a,h)=>h),i=(a,h)=>t.slice(a,h),r=i(32,127),s=i(0,24);s.push(25),s.push.apply(s,i(28,32));let n=i(0,14),o;e.setDefault(1,0),e.addMany(r,0,2,0);for(o in n)e.addMany([24,26,153,154],o,3,0),e.addMany(i(128,144),o,3,0),e.addMany(i(144,152),o,3,0),e.add(156,o,0,0),e.add(27,o,11,1),e.add(157,o,4,8),e.addMany([152,158,159],o,0,7),e.add(155,o,11,3),e.add(144,o,11,9);return e.addMany(s,0,3,0),e.addMany(s,1,3,1),e.add(127,1,0,1),e.addMany(s,8,0,8),e.addMany(s,3,3,3),e.add(127,3,0,3),e.addMany(s,4,3,4),e.add(127,4,0,4),e.addMany(s,6,3,6),e.addMany(s,5,3,5),e.add(127,5,0,5),e.addMany(s,2,3,2),e.add(127,2,0,2),e.add(93,1,4,8),e.addMany(r,8,5,8),e.add(127,8,5,8),e.addMany([156,27,24,26,7],8,6,0),e.addMany(i(28,32),8,0,8),e.addMany([88,94,95],1,0,7),e.addMany(r,7,0,7),e.addMany(s,7,0,7),e.add(156,7,0,0),e.add(127,7,0,7),e.add(91,1,11,3),e.addMany(i(64,127),3,7,0),e.addMany(i(48,60),3,8,4),e.addMany([60,61,62,63],3,9,4),e.addMany(i(48,60),4,8,4),e.addMany(i(64,127),4,7,0),e.addMany([60,61,62,63],4,0,6),e.addMany(i(32,64),6,0,6),e.add(127,6,0,6),e.addMany(i(64,127),6,0,0),e.addMany(i(32,48),3,9,5),e.addMany(i(32,48),5,9,5),e.addMany(i(48,64),5,0,6),e.addMany(i(64,127),5,7,0),e.addMany(i(32,48),4,9,5),e.addMany(i(32,48),1,9,2),e.addMany(i(32,48),2,9,2),e.addMany(i(48,127),2,10,0),e.addMany(i(48,80),1,10,0),e.addMany(i(81,88),1,10,0),e.addMany([89,90,92],1,10,0),e.addMany(i(96,127),1,10,0),e.add(80,1,11,9),e.addMany(s,9,0,9),e.add(127,9,0,9),e.addMany(i(28,32),9,0,9),e.addMany(i(32,48),9,9,12),e.addMany(i(48,60),9,8,10),e.addMany([60,61,62,63],9,9,10),e.addMany(s,11,0,11),e.addMany(i(32,128),11,0,11),e.addMany(i(28,32),11,0,11),e.addMany(s,10,0,10),e.add(127,10,0,10),e.addMany(i(28,32),10,0,10),e.addMany(i(48,60),10,8,10),e.addMany([60,61,62,63],10,0,11),e.addMany(i(32,48),10,9,12),e.addMany(s,12,0,12),e.add(127,12,0,12),e.addMany(i(28,32),12,0,12),e.addMany(i(32,48),12,9,12),e.addMany(i(48,64),12,0,11),e.addMany(i(64,127),12,12,13),e.addMany(i(64,127),10,12,13),e.addMany(i(64,127),9,12,13),e.addMany(s,13,13,13),e.addMany(r,13,13,13),e.add(127,13,0,13),e.addMany([27,156,24,26],13,14,0),e.add(Ht,0,2,0),e.add(Ht,8,5,8),e.add(Ht,6,0,6),e.add(Ht,11,0,11),e.add(Ht,13,13,13),e}(),oE=class extends oe{constructor(e=nE){super(),this._transitions=e,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new dm,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(t,i,r)=>{},this._executeHandlerFb=t=>{},this._csiHandlerFb=(t,i)=>{},this._escHandlerFb=t=>{},this._errorHandlerFb=t=>t,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this._register(be(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this._register(new iE),this._dcsParser=this._register(new rE),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(e,t=[64,126]){let i=0;if(e.prefix){if(e.prefix.length>1)throw new Error("only one byte as prefix supported");if(i=e.prefix.charCodeAt(0),i&&60>i||i>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(e.intermediates){if(e.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let s=0;s<e.intermediates.length;++s){let n=e.intermediates.charCodeAt(s);if(32>n||n>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");i<<=8,i|=n}}if(e.final.length!==1)throw new Error("final must be a single byte");let r=e.final.charCodeAt(0);if(t[0]>r||r>t[1])throw new Error(`final must be in range ${t[0]} .. ${t[1]}`);return i<<=8,i|=r,i}identToString(e){let t=[];for(;e;)t.push(String.fromCharCode(e&255)),e>>=8;return t.reverse().join("")}setPrintHandler(e){this._printHandler=e}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(e,t){let i=this._identifier(e,[48,126]);this._escHandlers[i]===void 0&&(this._escHandlers[i]=[]);let r=this._escHandlers[i];return r.push(t),{dispose:()=>{let s=r.indexOf(t);s!==-1&&r.splice(s,1)}}}clearEscHandler(e){this._escHandlers[this._identifier(e,[48,126])]&&delete this._escHandlers[this._identifier(e,[48,126])]}setEscHandlerFallback(e){this._escHandlerFb=e}setExecuteHandler(e,t){this._executeHandlers[e.charCodeAt(0)]=t}clearExecuteHandler(e){this._executeHandlers[e.charCodeAt(0)]&&delete this._executeHandlers[e.charCodeAt(0)]}setExecuteHandlerFallback(e){this._executeHandlerFb=e}registerCsiHandler(e,t){let i=this._identifier(e);this._csiHandlers[i]===void 0&&(this._csiHandlers[i]=[]);let r=this._csiHandlers[i];return r.push(t),{dispose:()=>{let s=r.indexOf(t);s!==-1&&r.splice(s,1)}}}clearCsiHandler(e){this._csiHandlers[this._identifier(e)]&&delete this._csiHandlers[this._identifier(e)]}setCsiHandlerFallback(e){this._csiHandlerFb=e}registerDcsHandler(e,t){return this._dcsParser.registerHandler(this._identifier(e),t)}clearDcsHandler(e){this._dcsParser.clearHandler(this._identifier(e))}setDcsHandlerFallback(e){this._dcsParser.setHandlerFallback(e)}registerOscHandler(e,t){return this._oscParser.registerHandler(e,t)}clearOscHandler(e){this._oscParser.clearHandler(e)}setOscHandlerFallback(e){this._oscParser.setHandlerFallback(e)}setErrorHandler(e){this._errorHandler=e}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(e,t,i,r,s){this._parseStack.state=e,this._parseStack.handlers=t,this._parseStack.handlerPos=i,this._parseStack.transition=r,this._parseStack.chunkPos=s}parse(e,t,i){let r=0,s=0,n=0,o;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,n=this._parseStack.chunkPos+1;else{if(i===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");let a=this._parseStack.handlers,h=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(i===!1&&h>-1){for(;h>=0&&(o=a[h](this._params),o!==!0);h--)if(o instanceof Promise)return this._parseStack.handlerPos=h,o}this._parseStack.handlers=[];break;case 4:if(i===!1&&h>-1){for(;h>=0&&(o=a[h](),o!==!0);h--)if(o instanceof Promise)return this._parseStack.handlerPos=h,o}this._parseStack.handlers=[];break;case 6:if(r=e[this._parseStack.chunkPos],o=this._dcsParser.unhook(r!==24&&r!==26,i),o)return o;r===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(r=e[this._parseStack.chunkPos],o=this._oscParser.end(r!==24&&r!==26,i),o)return o;r===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break}this._parseStack.state=0,n=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=this._parseStack.transition&15}for(let a=n;a<t;++a){switch(r=e[a],s=this._transitions.table[this.currentState<<8|(r<160?r:Ht)],s>>4){case 2:for(let p=a+1;;++p){if(p>=t||(r=e[p])<32||r>126&&r<Ht){this._printHandler(e,a,p),a=p-1;break}if(++p>=t||(r=e[p])<32||r>126&&r<Ht){this._printHandler(e,a,p),a=p-1;break}if(++p>=t||(r=e[p])<32||r>126&&r<Ht){this._printHandler(e,a,p),a=p-1;break}if(++p>=t||(r=e[p])<32||r>126&&r<Ht){this._printHandler(e,a,p),a=p-1;break}}break;case 3:this._executeHandlers[r]?this._executeHandlers[r]():this._executeHandlerFb(r),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:a,code:r,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:let h=this._csiHandlers[this._collect<<8|r],l=h?h.length-1:-1;for(;l>=0&&(o=h[l](this._params),o!==!0);l--)if(o instanceof Promise)return this._preserveStack(3,h,l,s,a),o;l<0&&this._csiHandlerFb(this._collect<<8|r,this._params),this.precedingJoinState=0;break;case 8:do switch(r){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(r-48)}while(++a<t&&(r=e[a])>47&&r<60);a--;break;case 9:this._collect<<=8,this._collect|=r;break;case 10:let c=this._escHandlers[this._collect<<8|r],u=c?c.length-1:-1;for(;u>=0&&(o=c[u](),o!==!0);u--)if(o instanceof Promise)return this._preserveStack(4,c,u,s,a),o;u<0&&this._escHandlerFb(this._collect<<8|r),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|r,this._params);break;case 13:for(let p=a+1;;++p)if(p>=t||(r=e[p])===24||r===26||r===27||r>127&&r<Ht){this._dcsParser.put(e,a,p),a=p-1;break}break;case 14:if(o=this._dcsParser.unhook(r!==24&&r!==26),o)return this._preserveStack(6,[],0,s,a),o;r===27&&(s|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let p=a+1;;p++)if(p>=t||(r=e[p])<32||r>127&&r<Ht){this._oscParser.put(e,a,p),a=p-1;break}break;case 6:if(o=this._oscParser.end(r!==24&&r!==26),o)return this._preserveStack(5,[],0,s,a),o;r===27&&(s|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break}this.currentState=s&15}}},aE=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,lE=/^[\da-f]+$/;function iv(e){if(!e)return;let t=e.toLowerCase();if(t.indexOf("rgb:")===0){t=t.slice(4);let i=aE.exec(t);if(i){let r=i[1]?15:i[4]?255:i[7]?4095:65535;return[Math.round(parseInt(i[1]||i[4]||i[7]||i[10],16)/r*255),Math.round(parseInt(i[2]||i[5]||i[8]||i[11],16)/r*255),Math.round(parseInt(i[3]||i[6]||i[9]||i[12],16)/r*255)]}}else if(t.indexOf("#")===0&&(t=t.slice(1),lE.exec(t)&&[3,6,9,12].includes(t.length))){let i=t.length/3,r=[0,0,0];for(let s=0;s<3;++s){let n=parseInt(t.slice(i*s,i*s+i),16);r[s]=i===1?n<<4:i===2?n:i===3?n>>4:n>>8}return r}}function Bc(e,t){let i=e.toString(16),r=i.length<2?"0"+i:i;switch(t){case 4:return i[0];case 8:return r;case 12:return(r+r).slice(0,3);default:return r+r}}function hE(e,t=16){let[i,r,s]=e;return`rgb:${Bc(i,t)}/${Bc(r,t)}/${Bc(s,t)}`}var cE={"(":0,")":1,"*":2,"+":3,"-":1,".":2},ur=131072,rv=10;function sv(e,t){if(e>24)return t.setWinLines||!1;switch(e){case 1:return!!t.restoreWin;case 2:return!!t.minimizeWin;case 3:return!!t.setWinPosition;case 4:return!!t.setWinSizePixels;case 5:return!!t.raiseWin;case 6:return!!t.lowerWin;case 7:return!!t.refreshWin;case 8:return!!t.setWinSizeChars;case 9:return!!t.maximizeWin;case 10:return!!t.fullscreenWin;case 11:return!!t.getWinState;case 13:return!!t.getWinPosition;case 14:return!!t.getWinSizePixels;case 15:return!!t.getScreenSizePixels;case 16:return!!t.getCellSizePixels;case 18:return!!t.getWinSizeChars;case 19:return!!t.getScreenSizeChars;case 20:return!!t.getIconTitle;case 21:return!!t.getWinTitle;case 22:return!!t.pushTitle;case 23:return!!t.popTitle;case 24:return!!t.setWinLines}return!1}var nv=5e3,ov=0,uE=class extends oe{constructor(e,t,i,r,s,n,o,a,h=new oE){super(),this._bufferService=e,this._charsetService=t,this._coreService=i,this._logService=r,this._optionsService=s,this._oscLinkService=n,this._coreMouseService=o,this._unicodeService=a,this._parser=h,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new i2,this._utf8Decoder=new r2,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=Oe.clone(),this._eraseAttrDataInternal=Oe.clone(),this._onRequestBell=this._register(new Y),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this._register(new Y),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this._register(new Y),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this._register(new Y),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this._register(new Y),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this._register(new Y),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this._register(new Y),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this._register(new Y),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this._register(new Y),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this._register(new Y),this.onLineFeed=this._onLineFeed.event,this._onScroll=this._register(new Y),this.onScroll=this._onScroll.event,this._onTitleChange=this._register(new Y),this.onTitleChange=this._onTitleChange.event,this._onColor=this._register(new Y),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this._register(this._parser),this._dirtyRowTracker=new uu(this._bufferService),this._activeBuffer=this._bufferService.buffer,this._register(this._bufferService.buffers.onBufferActivate(l=>this._activeBuffer=l.activeBuffer)),this._parser.setCsiHandlerFallback((l,c)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(l),params:c.toArray()})}),this._parser.setEscHandlerFallback(l=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(l)})}),this._parser.setExecuteHandlerFallback(l=>{this._logService.debug("Unknown EXECUTE code: ",{code:l})}),this._parser.setOscHandlerFallback((l,c,u)=>{this._logService.debug("Unknown OSC code: ",{identifier:l,action:c,data:u})}),this._parser.setDcsHandlerFallback((l,c,u)=>{c==="HOOK"&&(u=u.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(l),action:c,payload:u})}),this._parser.setPrintHandler((l,c,u)=>this.print(l,c,u)),this._parser.registerCsiHandler({final:"@"},l=>this.insertChars(l)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},l=>this.scrollLeft(l)),this._parser.registerCsiHandler({final:"A"},l=>this.cursorUp(l)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},l=>this.scrollRight(l)),this._parser.registerCsiHandler({final:"B"},l=>this.cursorDown(l)),this._parser.registerCsiHandler({final:"C"},l=>this.cursorForward(l)),this._parser.registerCsiHandler({final:"D"},l=>this.cursorBackward(l)),this._parser.registerCsiHandler({final:"E"},l=>this.cursorNextLine(l)),this._parser.registerCsiHandler({final:"F"},l=>this.cursorPrecedingLine(l)),this._parser.registerCsiHandler({final:"G"},l=>this.cursorCharAbsolute(l)),this._parser.registerCsiHandler({final:"H"},l=>this.cursorPosition(l)),this._parser.registerCsiHandler({final:"I"},l=>this.cursorForwardTab(l)),this._parser.registerCsiHandler({final:"J"},l=>this.eraseInDisplay(l,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},l=>this.eraseInDisplay(l,!0)),this._parser.registerCsiHandler({final:"K"},l=>this.eraseInLine(l,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},l=>this.eraseInLine(l,!0)),this._parser.registerCsiHandler({final:"L"},l=>this.insertLines(l)),this._parser.registerCsiHandler({final:"M"},l=>this.deleteLines(l)),this._parser.registerCsiHandler({final:"P"},l=>this.deleteChars(l)),this._parser.registerCsiHandler({final:"S"},l=>this.scrollUp(l)),this._parser.registerCsiHandler({final:"T"},l=>this.scrollDown(l)),this._parser.registerCsiHandler({final:"X"},l=>this.eraseChars(l)),this._parser.registerCsiHandler({final:"Z"},l=>this.cursorBackwardTab(l)),this._parser.registerCsiHandler({final:"`"},l=>this.charPosAbsolute(l)),this._parser.registerCsiHandler({final:"a"},l=>this.hPositionRelative(l)),this._parser.registerCsiHandler({final:"b"},l=>this.repeatPrecedingCharacter(l)),this._parser.registerCsiHandler({final:"c"},l=>this.sendDeviceAttributesPrimary(l)),this._parser.registerCsiHandler({prefix:">",final:"c"},l=>this.sendDeviceAttributesSecondary(l)),this._parser.registerCsiHandler({final:"d"},l=>this.linePosAbsolute(l)),this._parser.registerCsiHandler({final:"e"},l=>this.vPositionRelative(l)),this._parser.registerCsiHandler({final:"f"},l=>this.hVPosition(l)),this._parser.registerCsiHandler({final:"g"},l=>this.tabClear(l)),this._parser.registerCsiHandler({final:"h"},l=>this.setMode(l)),this._parser.registerCsiHandler({prefix:"?",final:"h"},l=>this.setModePrivate(l)),this._parser.registerCsiHandler({final:"l"},l=>this.resetMode(l)),this._parser.registerCsiHandler({prefix:"?",final:"l"},l=>this.resetModePrivate(l)),this._parser.registerCsiHandler({final:"m"},l=>this.charAttributes(l)),this._parser.registerCsiHandler({final:"n"},l=>this.deviceStatus(l)),this._parser.registerCsiHandler({prefix:"?",final:"n"},l=>this.deviceStatusPrivate(l)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},l=>this.softReset(l)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},l=>this.setCursorStyle(l)),this._parser.registerCsiHandler({final:"r"},l=>this.setScrollRegion(l)),this._parser.registerCsiHandler({final:"s"},l=>this.saveCursor(l)),this._parser.registerCsiHandler({final:"t"},l=>this.windowOptions(l)),this._parser.registerCsiHandler({final:"u"},l=>this.restoreCursor(l)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},l=>this.insertColumns(l)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},l=>this.deleteColumns(l)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},l=>this.selectProtected(l)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},l=>this.requestMode(l,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},l=>this.requestMode(l,!1)),this._parser.setExecuteHandler(G.BEL,()=>this.bell()),this._parser.setExecuteHandler(G.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(G.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(G.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(G.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(G.BS,()=>this.backspace()),this._parser.setExecuteHandler(G.HT,()=>this.tab()),this._parser.setExecuteHandler(G.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(G.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(Ea.IND,()=>this.index()),this._parser.setExecuteHandler(Ea.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(Ea.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new Et(l=>(this.setTitle(l),this.setIconName(l),!0))),this._parser.registerOscHandler(1,new Et(l=>this.setIconName(l))),this._parser.registerOscHandler(2,new Et(l=>this.setTitle(l))),this._parser.registerOscHandler(4,new Et(l=>this.setOrReportIndexedColor(l))),this._parser.registerOscHandler(8,new Et(l=>this.setHyperlink(l))),this._parser.registerOscHandler(10,new Et(l=>this.setOrReportFgColor(l))),this._parser.registerOscHandler(11,new Et(l=>this.setOrReportBgColor(l))),this._parser.registerOscHandler(12,new Et(l=>this.setOrReportCursorColor(l))),this._parser.registerOscHandler(104,new Et(l=>this.restoreIndexedColor(l))),this._parser.registerOscHandler(110,new Et(l=>this.restoreFgColor(l))),this._parser.registerOscHandler(111,new Et(l=>this.restoreBgColor(l))),this._parser.registerOscHandler(112,new Et(l=>this.restoreCursorColor(l))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(let l in ze)this._parser.registerEscHandler({intermediates:"(",final:l},()=>this.selectCharset("("+l)),this._parser.registerEscHandler({intermediates:")",final:l},()=>this.selectCharset(")"+l)),this._parser.registerEscHandler({intermediates:"*",final:l},()=>this.selectCharset("*"+l)),this._parser.registerEscHandler({intermediates:"+",final:l},()=>this.selectCharset("+"+l)),this._parser.registerEscHandler({intermediates:"-",final:l},()=>this.selectCharset("-"+l)),this._parser.registerEscHandler({intermediates:".",final:l},()=>this.selectCharset("."+l)),this._parser.registerEscHandler({intermediates:"/",final:l},()=>this.selectCharset("/"+l));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler(l=>(this._logService.error("Parsing error: ",l),l)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new tv((l,c)=>this.requestStatusString(l,c)))}getAttrData(){return this._curAttrData}_preserveStack(e,t,i,r){this._parseStack.paused=!0,this._parseStack.cursorStartX=e,this._parseStack.cursorStartY=t,this._parseStack.decodedLength=i,this._parseStack.position=r}_logSlowResolvingAsync(e){this._logService.logLevel<=3&&Promise.race([e,new Promise((t,i)=>setTimeout(()=>i("#SLOW_TIMEOUT"),nv))]).catch(t=>{if(t!=="#SLOW_TIMEOUT")throw t;console.warn(`async parser handler taking longer than ${nv} ms`)})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(e,t){let i,r=this._activeBuffer.x,s=this._activeBuffer.y,n=0,o=this._parseStack.paused;if(o){if(i=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,t))return this._logSlowResolvingAsync(i),i;r=this._parseStack.cursorStartX,s=this._parseStack.cursorStartY,this._parseStack.paused=!1,e.length>ur&&(n=this._parseStack.position+ur)}if(this._logService.logLevel<=1&&this._logService.debug(`parsing data ${typeof e=="string"?` "${e}"`:` "${Array.prototype.map.call(e,l=>String.fromCharCode(l)).join("")}"`}`),this._logService.logLevel===0&&this._logService.trace("parsing data (codes)",typeof e=="string"?e.split("").map(l=>l.charCodeAt(0)):e),this._parseBuffer.length<e.length&&this._parseBuffer.length<ur&&(this._parseBuffer=new Uint32Array(Math.min(e.length,ur))),o||this._dirtyRowTracker.clearRange(),e.length>ur)for(let l=n;l<e.length;l+=ur){let c=l+ur<e.length?l+ur:e.length,u=typeof e=="string"?this._stringDecoder.decode(e.substring(l,c),this._parseBuffer):this._utf8Decoder.decode(e.subarray(l,c),this._parseBuffer);if(i=this._parser.parse(this._parseBuffer,u))return this._preserveStack(r,s,u,l),this._logSlowResolvingAsync(i),i}else if(!o){let l=typeof e=="string"?this._stringDecoder.decode(e,this._parseBuffer):this._utf8Decoder.decode(e,this._parseBuffer);if(i=this._parser.parse(this._parseBuffer,l))return this._preserveStack(r,s,l,0),this._logSlowResolvingAsync(i),i}(this._activeBuffer.x!==r||this._activeBuffer.y!==s)&&this._onCursorMove.fire();let a=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),h=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);h<this._bufferService.rows&&this._onRequestRefreshRows.fire({start:Math.min(h,this._bufferService.rows-1),end:Math.min(a,this._bufferService.rows-1)})}print(e,t,i){let r,s,n=this._charsetService.charset,o=this._optionsService.rawOptions.screenReaderMode,a=this._bufferService.cols,h=this._coreService.decPrivateModes.wraparound,l=this._coreService.modes.insertMode,c=this._curAttrData,u=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&i-t>0&&u.getWidth(this._activeBuffer.x-1)===2&&u.setCellFromCodepoint(this._activeBuffer.x-1,0,1,c);let p=this._parser.precedingJoinState;for(let g=t;g<i;++g){if(r=e[g],r<127&&n){let E=n[String.fromCharCode(r)];E&&(r=E.charCodeAt(0))}let v=this._unicodeService.charProperties(r,p);s=Nr.extractWidth(v);let m=Nr.extractShouldJoin(v),x=m?Nr.extractWidth(p):0;if(p=v,o&&this._onA11yChar.fire(dr(r)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+s-x>a){if(h){let E=u,R=this._activeBuffer.x-x;for(this._activeBuffer.x=x,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),u=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),x>0&&u instanceof Ln&&u.copyCellsFrom(E,R,0,x,!1);R<a;)E.setCellFromCodepoint(R++,0,1,c)}else if(this._activeBuffer.x=a-1,s===2)continue}if(m&&this._activeBuffer.x){let E=u.getWidth(this._activeBuffer.x-1)?1:2;u.addCodepointToCell(this._activeBuffer.x-E,r,s);for(let R=s-x;--R>=0;)u.setCellFromCodepoint(this._activeBuffer.x++,0,0,c);continue}if(l&&(u.insertCells(this._activeBuffer.x,s-x,this._activeBuffer.getNullCell(c)),u.getWidth(a-1)===2&&u.setCellFromCodepoint(a-1,0,1,c)),u.setCellFromCodepoint(this._activeBuffer.x++,r,s,c),s>0)for(;--s;)u.setCellFromCodepoint(this._activeBuffer.x++,0,0,c)}this._parser.precedingJoinState=p,this._activeBuffer.x<a&&i-t>0&&u.getWidth(this._activeBuffer.x)===0&&!u.hasContent(this._activeBuffer.x)&&u.setCellFromCodepoint(this._activeBuffer.x,0,1,c),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(e,t){return e.final==="t"&&!e.prefix&&!e.intermediates?this._parser.registerCsiHandler(e,i=>sv(i.params[0],this._optionsService.rawOptions.windowOptions)?t(i):!0):this._parser.registerCsiHandler(e,t)}registerDcsHandler(e,t){return this._parser.registerDcsHandler(e,new tv(t))}registerEscHandler(e,t){return this._parser.registerEscHandler(e,t)}registerOscHandler(e,t){return this._parser.registerOscHandler(e,new Et(t))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)?.isWrapped){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;let e=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);e.hasWidth(this._activeBuffer.x)&&!e.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let e=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-e),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(e=this._bufferService.cols-1){this._activeBuffer.x=Math.min(e,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(e,t){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=e,this._activeBuffer.y=this._activeBuffer.scrollTop+t):(this._activeBuffer.x=e,this._activeBuffer.y=t),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(e,t){this._restrictCursor(),this._setCursor(this._activeBuffer.x+e,this._activeBuffer.y+t)}cursorUp(e){let t=this._activeBuffer.y-this._activeBuffer.scrollTop;return t>=0?this._moveCursor(0,-Math.min(t,e.params[0]||1)):this._moveCursor(0,-(e.params[0]||1)),!0}cursorDown(e){let t=this._activeBuffer.scrollBottom-this._activeBuffer.y;return t>=0?this._moveCursor(0,Math.min(t,e.params[0]||1)):this._moveCursor(0,e.params[0]||1),!0}cursorForward(e){return this._moveCursor(e.params[0]||1,0),!0}cursorBackward(e){return this._moveCursor(-(e.params[0]||1),0),!0}cursorNextLine(e){return this.cursorDown(e),this._activeBuffer.x=0,!0}cursorPrecedingLine(e){return this.cursorUp(e),this._activeBuffer.x=0,!0}cursorCharAbsolute(e){return this._setCursor((e.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(e){return this._setCursor(e.length>=2?(e.params[1]||1)-1:0,(e.params[0]||1)-1),!0}charPosAbsolute(e){return this._setCursor((e.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(e){return this._moveCursor(e.params[0]||1,0),!0}linePosAbsolute(e){return this._setCursor(this._activeBuffer.x,(e.params[0]||1)-1),!0}vPositionRelative(e){return this._moveCursor(0,e.params[0]||1),!0}hVPosition(e){return this.cursorPosition(e),!0}tabClear(e){let t=e.params[0];return t===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:t===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(e){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let t=e.params[0]||1;for(;t--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(e){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let t=e.params[0]||1;for(;t--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(e){let t=e.params[0];return t===1&&(this._curAttrData.bg|=536870912),(t===2||t===0)&&(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(e,t,i,r=!1,s=!1){let n=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);n.replaceCells(t,i,this._activeBuffer.getNullCell(this._eraseAttrData()),s),r&&(n.isWrapped=!1)}_resetBufferLine(e,t=!1){let i=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);i&&(i.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),t),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+e),i.isWrapped=!1)}eraseInDisplay(e,t=!1){this._restrictCursor(this._bufferService.cols);let i;switch(e.params[0]){case 0:for(i=this._activeBuffer.y,this._dirtyRowTracker.markDirty(i),this._eraseInBufferLine(i++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,t);i<this._bufferService.rows;i++)this._resetBufferLine(i,t);this._dirtyRowTracker.markDirty(i);break;case 1:for(i=this._activeBuffer.y,this._dirtyRowTracker.markDirty(i),this._eraseInBufferLine(i,0,this._activeBuffer.x+1,!0,t),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(i+1).isWrapped=!1);i--;)this._resetBufferLine(i,t);this._dirtyRowTracker.markDirty(0);break;case 2:if(this._optionsService.rawOptions.scrollOnEraseInDisplay){for(i=this._bufferService.rows,this._dirtyRowTracker.markRangeDirty(0,i-1);i--&&!this._activeBuffer.lines.get(this._activeBuffer.ybase+i)?.getTrimmedLength(););for(;i>=0;i--)this._bufferService.scroll(this._eraseAttrData())}else{for(i=this._bufferService.rows,this._dirtyRowTracker.markDirty(i-1);i--;)this._resetBufferLine(i,t);this._dirtyRowTracker.markDirty(0)}break;case 3:let r=this._activeBuffer.lines.length-this._bufferService.rows;r>0&&(this._activeBuffer.lines.trimStart(r),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-r,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-r,0),this._onScroll.fire(0));break}return!0}eraseInLine(e,t=!1){switch(this._restrictCursor(this._bufferService.cols),e.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,t);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,t);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,t);break}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(e){this._restrictCursor();let t=e.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let i=this._activeBuffer.ybase+this._activeBuffer.y,r=this._bufferService.rows-1-this._activeBuffer.scrollBottom,s=this._bufferService.rows-1+this._activeBuffer.ybase-r+1;for(;t--;)this._activeBuffer.lines.splice(s-1,1),this._activeBuffer.lines.splice(i,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(e){this._restrictCursor();let t=e.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let i=this._activeBuffer.ybase+this._activeBuffer.y,r;for(r=this._bufferService.rows-1-this._activeBuffer.scrollBottom,r=this._bufferService.rows-1+this._activeBuffer.ybase-r;t--;)this._activeBuffer.lines.splice(i,1),this._activeBuffer.lines.splice(r,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(e){this._restrictCursor();let t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.insertCells(this._activeBuffer.x,e.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(e){this._restrictCursor();let t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.deleteCells(this._activeBuffer.x,e.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(e){let t=e.params[0]||1;for(;t--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(e){let t=e.params[0]||1;for(;t--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(Oe));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let t=e.params[0]||1;for(let i=this._activeBuffer.scrollTop;i<=this._activeBuffer.scrollBottom;++i){let r=this._activeBuffer.lines.get(this._activeBuffer.ybase+i);r.deleteCells(0,t,this._activeBuffer.getNullCell(this._eraseAttrData())),r.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let t=e.params[0]||1;for(let i=this._activeBuffer.scrollTop;i<=this._activeBuffer.scrollBottom;++i){let r=this._activeBuffer.lines.get(this._activeBuffer.ybase+i);r.insertCells(0,t,this._activeBuffer.getNullCell(this._eraseAttrData())),r.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let t=e.params[0]||1;for(let i=this._activeBuffer.scrollTop;i<=this._activeBuffer.scrollBottom;++i){let r=this._activeBuffer.lines.get(this._activeBuffer.ybase+i);r.insertCells(this._activeBuffer.x,t,this._activeBuffer.getNullCell(this._eraseAttrData())),r.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let t=e.params[0]||1;for(let i=this._activeBuffer.scrollTop;i<=this._activeBuffer.scrollBottom;++i){let r=this._activeBuffer.lines.get(this._activeBuffer.ybase+i);r.deleteCells(this._activeBuffer.x,t,this._activeBuffer.getNullCell(this._eraseAttrData())),r.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(e){this._restrictCursor();let t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(e.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(e){let t=this._parser.precedingJoinState;if(!t)return!0;let i=e.params[0]||1,r=Nr.extractWidth(t),s=this._activeBuffer.x-r,n=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(s),o=new Uint32Array(n.length*i),a=0;for(let l=0;l<n.length;){let c=n.codePointAt(l)||0;o[a++]=c,l+=c>65535?2:1}let h=a;for(let l=1;l<i;++l)o.copyWithin(h,0,a),h+=a;return this.print(o,0,h),!0}sendDeviceAttributesPrimary(e){return e.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(G.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(G.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(e){return e.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(G.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(G.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(e.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(G.ESC+"[>83;40003;0c")),!0}_is(e){return(this._optionsService.rawOptions.termName+"").indexOf(e)===0}setMode(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0;break}return!0}setModePrivate(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,Kr),this._charsetService.setgCharset(1,Kr),this._charsetService.setgCharset(2,Kr),this._charsetService.setgCharset(3,Kr);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(void 0),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0;break;case 2026:this._coreService.decPrivateModes.synchronizedOutput=!0;break}return!0}resetMode(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1;break}return!0}resetModePrivate(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),e.params[t]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(void 0),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1;break;case 2026:this._coreService.decPrivateModes.synchronizedOutput=!1,this._onRequestRefreshRows.fire(void 0);break}return!0}requestMode(e,t){let i;(m=>(m[m.NOT_RECOGNIZED=0]="NOT_RECOGNIZED",m[m.SET=1]="SET",m[m.RESET=2]="RESET",m[m.PERMANENTLY_SET=3]="PERMANENTLY_SET",m[m.PERMANENTLY_RESET=4]="PERMANENTLY_RESET"))(i||={});let r=this._coreService.decPrivateModes,{activeProtocol:s,activeEncoding:n}=this._coreMouseService,o=this._coreService,{buffers:a,cols:h}=this._bufferService,{active:l,alt:c}=a,u=this._optionsService.rawOptions,p=(m,x)=>(o.triggerDataEvent(`${G.ESC}[${t?"":"?"}${m};${x}$y`),!0),g=m=>m?1:2,v=e.params[0];return t?v===2?p(v,4):v===4?p(v,g(o.modes.insertMode)):v===12?p(v,3):v===20?p(v,g(u.convertEol)):p(v,0):v===1?p(v,g(r.applicationCursorKeys)):v===3?p(v,u.windowOptions.setWinLines?h===80?2:h===132?1:0:0):v===6?p(v,g(r.origin)):v===7?p(v,g(r.wraparound)):v===8?p(v,3):v===9?p(v,g(s==="X10")):v===12?p(v,g(u.cursorBlink)):v===25?p(v,g(!o.isCursorHidden)):v===45?p(v,g(r.reverseWraparound)):v===66?p(v,g(r.applicationKeypad)):v===67?p(v,4):v===1e3?p(v,g(s==="VT200")):v===1002?p(v,g(s==="DRAG")):v===1003?p(v,g(s==="ANY")):v===1004?p(v,g(r.sendFocus)):v===1005?p(v,4):v===1006?p(v,g(n==="SGR")):v===1015?p(v,4):v===1016?p(v,g(n==="SGR_PIXELS")):v===1048?p(v,1):v===47||v===1047||v===1049?p(v,g(l===c)):v===2004?p(v,g(r.bracketedPasteMode)):v===2026?p(v,g(r.synchronizedOutput)):p(v,0)}_updateAttrColor(e,t,i,r,s){return t===2?(e|=50331648,e&=-16777216,e|=Kn.fromColorRGB([i,r,s])):t===5&&(e&=-50331904,e|=33554432|i&255),e}_extractColor(e,t,i){let r=[0,0,-1,0,0,0],s=0,n=0;do{if(r[n+s]=e.params[t+n],e.hasSubParams(t+n)){let o=e.getSubParams(t+n),a=0;do r[1]===5&&(s=1),r[n+a+1+s]=o[a];while(++a<o.length&&a+n+1+s<r.length);break}if(r[1]===5&&n+s>=2||r[1]===2&&n+s>=5)break;r[1]&&(s=1)}while(++n+t<e.length&&n+s<r.length);for(let o=2;o<r.length;++o)r[o]===-1&&(r[o]=0);switch(r[0]){case 38:i.fg=this._updateAttrColor(i.fg,r[1],r[3],r[4],r[5]);break;case 48:i.bg=this._updateAttrColor(i.bg,r[1],r[3],r[4],r[5]);break;case 58:i.extended=i.extended.clone(),i.extended.underlineColor=this._updateAttrColor(i.extended.underlineColor,r[1],r[3],r[4],r[5])}return n}_processUnderline(e,t){t.extended=t.extended.clone(),(!~e||e>5)&&(e=1),t.extended.underlineStyle=e,t.fg|=268435456,e===0&&(t.fg&=-268435457),t.updateExtended()}_processSGR0(e){e.fg=Oe.fg,e.bg=Oe.bg,e.extended=e.extended.clone(),e.extended.underlineStyle=0,e.extended.underlineColor&=-67108864,e.updateExtended()}charAttributes(e){if(e.length===1&&e.params[0]===0)return this._processSGR0(this._curAttrData),!0;let t=e.length,i,r=this._curAttrData;for(let s=0;s<t;s++)i=e.params[s],i>=30&&i<=37?(r.fg&=-50331904,r.fg|=16777216|i-30):i>=40&&i<=47?(r.bg&=-50331904,r.bg|=16777216|i-40):i>=90&&i<=97?(r.fg&=-50331904,r.fg|=16777216|i-90|8):i>=100&&i<=107?(r.bg&=-50331904,r.bg|=16777216|i-100|8):i===0?this._processSGR0(r):i===1?r.fg|=134217728:i===3?r.bg|=67108864:i===4?(r.fg|=268435456,this._processUnderline(e.hasSubParams(s)?e.getSubParams(s)[0]:1,r)):i===5?r.fg|=536870912:i===7?r.fg|=67108864:i===8?r.fg|=1073741824:i===9?r.fg|=2147483648:i===2?r.bg|=134217728:i===21?this._processUnderline(2,r):i===22?(r.fg&=-134217729,r.bg&=-134217729):i===23?r.bg&=-67108865:i===24?(r.fg&=-268435457,this._processUnderline(0,r)):i===25?r.fg&=-536870913:i===27?r.fg&=-67108865:i===28?r.fg&=-1073741825:i===29?r.fg&=2147483647:i===39?(r.fg&=-67108864,r.fg|=Oe.fg&16777215):i===49?(r.bg&=-67108864,r.bg|=Oe.bg&16777215):i===38||i===48||i===58?s+=this._extractColor(e,s,r):i===53?r.bg|=1073741824:i===55?r.bg&=-1073741825:i===59?(r.extended=r.extended.clone(),r.extended.underlineColor=-1,r.updateExtended()):i===100?(r.fg&=-67108864,r.fg|=Oe.fg&16777215,r.bg&=-67108864,r.bg|=Oe.bg&16777215):this._logService.debug("Unknown SGR attribute: %d.",i);return!0}deviceStatus(e){switch(e.params[0]){case 5:this._coreService.triggerDataEvent(`${G.ESC}[0n`);break;case 6:let t=this._activeBuffer.y+1,i=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${G.ESC}[${t};${i}R`);break}return!0}deviceStatusPrivate(e){switch(e.params[0]){case 6:let t=this._activeBuffer.y+1,i=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${G.ESC}[?${t};${i}R`);break;case 15:break;case 25:break;case 26:break;case 53:break}return!0}softReset(e){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=Oe.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(e){let t=e.length===0?1:e.params[0];if(t===0)this._coreService.decPrivateModes.cursorStyle=void 0,this._coreService.decPrivateModes.cursorBlink=void 0;else{switch(t){case 1:case 2:this._coreService.decPrivateModes.cursorStyle="block";break;case 3:case 4:this._coreService.decPrivateModes.cursorStyle="underline";break;case 5:case 6:this._coreService.decPrivateModes.cursorStyle="bar";break}let i=t%2===1;this._coreService.decPrivateModes.cursorBlink=i}return!0}setScrollRegion(e){let t=e.params[0]||1,i;return(e.length<2||(i=e.params[1])>this._bufferService.rows||i===0)&&(i=this._bufferService.rows),i>t&&(this._activeBuffer.scrollTop=t-1,this._activeBuffer.scrollBottom=i-1,this._setCursor(0,0)),!0}windowOptions(e){if(!sv(e.params[0],this._optionsService.rawOptions.windowOptions))return!0;let t=e.length>1?e.params[1]:0;switch(e.params[0]){case 14:t!==2&&this._onRequestWindowsOptionsReport.fire(0);break;case 16:this._onRequestWindowsOptionsReport.fire(1);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${G.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:(t===0||t===2)&&(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>rv&&this._windowTitleStack.shift()),(t===0||t===1)&&(this._iconNameStack.push(this._iconName),this._iconNameStack.length>rv&&this._iconNameStack.shift());break;case 23:(t===0||t===2)&&this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),(t===0||t===1)&&this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop());break}return!0}saveCursor(e){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(e){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(e){return this._windowTitle=e,this._onTitleChange.fire(e),!0}setIconName(e){return this._iconName=e,!0}setOrReportIndexedColor(e){let t=[],i=e.split(";");for(;i.length>1;){let r=i.shift(),s=i.shift();if(/^\d+$/.exec(r)){let n=parseInt(r);if(av(n))if(s==="?")t.push({type:0,index:n});else{let o=iv(s);o&&t.push({type:1,index:n,color:o})}}}return t.length&&this._onColor.fire(t),!0}setHyperlink(e){let t=e.indexOf(";");if(t===-1)return!0;let i=e.slice(0,t).trim(),r=e.slice(t+1);return r?this._createHyperlink(i,r):i.trim()?!1:this._finishHyperlink()}_createHyperlink(e,t){this._getCurrentLinkId()&&this._finishHyperlink();let i=e.split(":"),r,s=i.findIndex(n=>n.startsWith("id="));return s!==-1&&(r=i[s].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:r,uri:t}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(e,t){let i=e.split(";");for(let r=0;r<i.length&&!(t>=this._specialColors.length);++r,++t)if(i[r]==="?")this._onColor.fire([{type:0,index:this._specialColors[t]}]);else{let s=iv(i[r]);s&&this._onColor.fire([{type:1,index:this._specialColors[t],color:s}])}return!0}setOrReportFgColor(e){return this._setOrReportSpecialColor(e,0)}setOrReportBgColor(e){return this._setOrReportSpecialColor(e,1)}setOrReportCursorColor(e){return this._setOrReportSpecialColor(e,2)}restoreIndexedColor(e){if(!e)return this._onColor.fire([{type:2}]),!0;let t=[],i=e.split(";");for(let r=0;r<i.length;++r)if(/^\d+$/.exec(i[r])){let s=parseInt(i[r]);av(s)&&t.push({type:2,index:s})}return t.length&&this._onColor.fire(t),!0}restoreFgColor(e){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(e){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(e){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,Kr),!0}selectCharset(e){return e.length!==2?(this.selectDefaultCharset(),!0):(e[0]==="/"||this._charsetService.setgCharset(cE[e[0]],ze[e[1]]||Kr),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){let e=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,e,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=Oe.clone(),this._eraseAttrDataInternal=Oe.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=this._curAttrData.bg&67108863,this._eraseAttrDataInternal}setgLevel(e){return this._charsetService.setgLevel(e),!0}screenAlignmentPattern(){let e=new Xt;e.content=1<<22|69,e.fg=this._curAttrData.fg,e.bg=this._curAttrData.bg,this._setCursor(0,0);for(let t=0;t<this._bufferService.rows;++t){let i=this._activeBuffer.ybase+this._activeBuffer.y+t,r=this._activeBuffer.lines.get(i);r&&(r.fill(e),r.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(e,t){let i=o=>(this._coreService.triggerDataEvent(`${G.ESC}${o}${G.ESC}\\`),!0),r=this._bufferService.buffer,s=this._optionsService.rawOptions;return i(e==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:e==='"p'?'P1$r61;1"p':e==="r"?`P1$r${r.scrollTop+1};${r.scrollBottom+1}r`:e==="m"?"P1$r0m":e===" q"?`P1$r${{block:2,underline:4,bar:6}[s.cursorStyle]-(s.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(e,t){this._dirtyRowTracker.markRangeDirty(e,t)}},uu=class{constructor(e){this._bufferService=e,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(e){e<this.start?this.start=e:e>this.end&&(this.end=e)}markRangeDirty(e,t){e>t&&(ov=e,e=t,t=ov),e<this.start&&(this.start=e),t>this.end&&(this.end=t)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};uu=De([Z(0,gt)],uu);function av(e){return 0<=e&&e<256}var dE=5e7,lv=12,fE=50,_E=class extends oe{constructor(e){super(),this._action=e,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this._register(new Y),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(e,t){if(t!==void 0&&this._syncCalls>t){this._syncCalls=0;return}if(this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;this._isSyncWriting=!0;let i;for(;i=this._writeBuffer.shift();){this._action(i);let r=this._callbacks.shift();r&&r()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(e,t){if(this._pendingData>dE)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput){this._didUserInput=!1,this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(t),this._innerWrite();return}setTimeout(()=>this._innerWrite())}this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(t)}_innerWrite(e=0,t=!0){let i=e||performance.now();for(;this._writeBuffer.length>this._bufferOffset;){let r=this._writeBuffer[this._bufferOffset],s=this._action(r,t);if(s){let o=a=>performance.now()-i>=lv?setTimeout(()=>this._innerWrite(0,a)):this._innerWrite(i,a);s.catch(a=>(queueMicrotask(()=>{throw a}),Promise.resolve(!1))).then(o);return}let n=this._callbacks[this._bufferOffset];if(n&&n(),this._bufferOffset++,this._pendingData-=r.length,performance.now()-i>=lv)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>fE&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}},du=class{constructor(e){this._bufferService=e,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(e){let t=this._bufferService.buffer;if(e.id===void 0){let a=t.addMarker(t.ybase+t.y),h={data:e,id:this._nextId++,lines:[a]};return a.onDispose(()=>this._removeMarkerFromLink(h,a)),this._dataByLinkId.set(h.id,h),h.id}let i=e,r=this._getEntryIdKey(i),s=this._entriesWithId.get(r);if(s)return this.addLineToLink(s.id,t.ybase+t.y),s.id;let n=t.addMarker(t.ybase+t.y),o={id:this._nextId++,key:this._getEntryIdKey(i),data:i,lines:[n]};return n.onDispose(()=>this._removeMarkerFromLink(o,n)),this._entriesWithId.set(o.key,o),this._dataByLinkId.set(o.id,o),o.id}addLineToLink(e,t){let i=this._dataByLinkId.get(e);if(i&&i.lines.every(r=>r.line!==t)){let r=this._bufferService.buffer.addMarker(t);i.lines.push(r),r.onDispose(()=>this._removeMarkerFromLink(i,r))}}getLinkData(e){return this._dataByLinkId.get(e)?.data}_getEntryIdKey(e){return`${e.id};;${e.uri}`}_removeMarkerFromLink(e,t){let i=e.lines.indexOf(t);i!==-1&&(e.lines.splice(i,1),e.lines.length===0&&(e.data.id!==void 0&&this._entriesWithId.delete(e.key),this._dataByLinkId.delete(e.id)))}};du=De([Z(0,gt)],du);var hv=!1,gE=class extends oe{constructor(e){super(),this._windowsWrappingHeuristics=this._register(new gs),this._onBinary=this._register(new Y),this.onBinary=this._onBinary.event,this._onData=this._register(new Y),this.onData=this._onData.event,this._onLineFeed=this._register(new Y),this.onLineFeed=this._onLineFeed.event,this._onResize=this._register(new Y),this.onResize=this._onResize.event,this._onWriteParsed=this._register(new Y),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this._register(new Y),this._instantiationService=new Kk,this.optionsService=this._register(new qk(e)),this._instantiationService.setService(pt,this.optionsService),this._bufferService=this._register(this._instantiationService.createInstance(au)),this._instantiationService.setService(gt,this._bufferService),this._logService=this._register(this._instantiationService.createInstance(ou)),this._instantiationService.setService(Av,this._logService),this.coreService=this._register(this._instantiationService.createInstance(lu)),this._instantiationService.setService(Ur,this.coreService),this.coreMouseService=this._register(this._instantiationService.createInstance(hu)),this._instantiationService.setService(wv,this.coreMouseService),this.unicodeService=this._register(this._instantiationService.createInstance(Nr)),this._instantiationService.setService(a2,this.unicodeService),this._charsetService=this._instantiationService.createInstance(eE),this._instantiationService.setService(o2,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(du),this._instantiationService.setService(xv,this._oscLinkService),this._inputHandler=this._register(new uE(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this._register(rt.forward(this._inputHandler.onLineFeed,this._onLineFeed)),this._register(this._inputHandler),this._register(rt.forward(this._bufferService.onResize,this._onResize)),this._register(rt.forward(this.coreService.onData,this._onData)),this._register(rt.forward(this.coreService.onBinary,this._onBinary)),this._register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom(!0))),this._register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this._register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this._register(this._bufferService.onScroll(()=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this._register(new _E((t,i)=>this._inputHandler.parse(t,i))),this._register(rt.forward(this._writeBuffer.onWriteParsed,this._onWriteParsed))}get onScroll(){return this._onScrollApi||(this._onScrollApi=this._register(new Y),this._onScroll.event(e=>{this._onScrollApi?.fire(e.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(e){for(let t in e)this.optionsService.options[t]=e[t]}write(e,t){this._writeBuffer.write(e,t)}writeSync(e,t){this._logService.logLevel<=3&&!hv&&(this._logService.warn("writeSync is unreliable and will be removed soon."),hv=!0),this._writeBuffer.writeSync(e,t)}input(e,t=!0){this.coreService.triggerDataEvent(e,t)}resize(e,t){isNaN(e)||isNaN(t)||(e=Math.max(e,cm),t=Math.max(t,um),this._bufferService.resize(e,t))}scroll(e,t=!1){this._bufferService.scroll(e,t)}scrollLines(e,t){this._bufferService.scrollLines(e,t)}scrollPages(e){this.scrollLines(e*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(e){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(e){let t=e-this._bufferService.buffer.ydisp;t!==0&&this.scrollLines(t)}registerEscHandler(e,t){return this._inputHandler.registerEscHandler(e,t)}registerDcsHandler(e,t){return this._inputHandler.registerDcsHandler(e,t)}registerCsiHandler(e,t){return this._inputHandler.registerCsiHandler(e,t)}registerOscHandler(e,t){return this._inputHandler.registerOscHandler(e,t)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let e=!1,t=this.optionsService.rawOptions.windowsPty;t&&t.buildNumber!==void 0&&t.buildNumber!==void 0?e=t.backend==="conpty"&&t.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(e=!0),e?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){let e=[];e.push(this.onLineFeed(ev.bind(null,this._bufferService))),e.push(this.registerCsiHandler({final:"H"},()=>(ev(this._bufferService),!1))),this._windowsWrappingHeuristics.value=be(()=>{for(let t of e)t.dispose()})}}},pE={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};function vE(e,t,i,r){let s={type:0,cancel:!1,key:void 0},n=(e.shiftKey?1:0)|(e.altKey?2:0)|(e.ctrlKey?4:0)|(e.metaKey?8:0);switch(e.keyCode){case 0:e.key==="UIKeyInputUpArrow"?t?s.key=G.ESC+"OA":s.key=G.ESC+"[A":e.key==="UIKeyInputLeftArrow"?t?s.key=G.ESC+"OD":s.key=G.ESC+"[D":e.key==="UIKeyInputRightArrow"?t?s.key=G.ESC+"OC":s.key=G.ESC+"[C":e.key==="UIKeyInputDownArrow"&&(t?s.key=G.ESC+"OB":s.key=G.ESC+"[B");break;case 8:s.key=e.ctrlKey?"\b":G.DEL,e.altKey&&(s.key=G.ESC+s.key);break;case 9:if(e.shiftKey){s.key=G.ESC+"[Z";break}s.key=G.HT,s.cancel=!0;break;case 13:s.key=e.altKey?G.ESC+G.CR:G.CR,s.cancel=!0;break;case 27:s.key=G.ESC,e.altKey&&(s.key=G.ESC+G.ESC),s.cancel=!0;break;case 37:if(e.metaKey)break;n?s.key=G.ESC+"[1;"+(n+1)+"D":t?s.key=G.ESC+"OD":s.key=G.ESC+"[D";break;case 39:if(e.metaKey)break;n?s.key=G.ESC+"[1;"+(n+1)+"C":t?s.key=G.ESC+"OC":s.key=G.ESC+"[C";break;case 38:if(e.metaKey)break;n?s.key=G.ESC+"[1;"+(n+1)+"A":t?s.key=G.ESC+"OA":s.key=G.ESC+"[A";break;case 40:if(e.metaKey)break;n?s.key=G.ESC+"[1;"+(n+1)+"B":t?s.key=G.ESC+"OB":s.key=G.ESC+"[B";break;case 45:!e.shiftKey&&!e.ctrlKey&&(s.key=G.ESC+"[2~");break;case 46:n?s.key=G.ESC+"[3;"+(n+1)+"~":s.key=G.ESC+"[3~";break;case 36:n?s.key=G.ESC+"[1;"+(n+1)+"H":t?s.key=G.ESC+"OH":s.key=G.ESC+"[H";break;case 35:n?s.key=G.ESC+"[1;"+(n+1)+"F":t?s.key=G.ESC+"OF":s.key=G.ESC+"[F";break;case 33:e.shiftKey?s.type=2:e.ctrlKey?s.key=G.ESC+"[5;"+(n+1)+"~":s.key=G.ESC+"[5~";break;case 34:e.shiftKey?s.type=3:e.ctrlKey?s.key=G.ESC+"[6;"+(n+1)+"~":s.key=G.ESC+"[6~";break;case 112:n?s.key=G.ESC+"[1;"+(n+1)+"P":s.key=G.ESC+"OP";break;case 113:n?s.key=G.ESC+"[1;"+(n+1)+"Q":s.key=G.ESC+"OQ";break;case 114:n?s.key=G.ESC+"[1;"+(n+1)+"R":s.key=G.ESC+"OR";break;case 115:n?s.key=G.ESC+"[1;"+(n+1)+"S":s.key=G.ESC+"OS";break;case 116:n?s.key=G.ESC+"[15;"+(n+1)+"~":s.key=G.ESC+"[15~";break;case 117:n?s.key=G.ESC+"[17;"+(n+1)+"~":s.key=G.ESC+"[17~";break;case 118:n?s.key=G.ESC+"[18;"+(n+1)+"~":s.key=G.ESC+"[18~";break;case 119:n?s.key=G.ESC+"[19;"+(n+1)+"~":s.key=G.ESC+"[19~";break;case 120:n?s.key=G.ESC+"[20;"+(n+1)+"~":s.key=G.ESC+"[20~";break;case 121:n?s.key=G.ESC+"[21;"+(n+1)+"~":s.key=G.ESC+"[21~";break;case 122:n?s.key=G.ESC+"[23;"+(n+1)+"~":s.key=G.ESC+"[23~";break;case 123:n?s.key=G.ESC+"[24;"+(n+1)+"~":s.key=G.ESC+"[24~";break;default:if(e.ctrlKey&&!e.shiftKey&&!e.altKey&&!e.metaKey)e.keyCode>=65&&e.keyCode<=90?s.key=String.fromCharCode(e.keyCode-64):e.keyCode===32?s.key=G.NUL:e.keyCode>=51&&e.keyCode<=55?s.key=String.fromCharCode(e.keyCode-51+27):e.keyCode===56?s.key=G.DEL:e.keyCode===219?s.key=G.ESC:e.keyCode===220?s.key=G.FS:e.keyCode===221&&(s.key=G.GS);else if((!i||r)&&e.altKey&&!e.metaKey){let o=pE[e.keyCode]?.[e.shiftKey?1:0];if(o)s.key=G.ESC+o;else if(e.keyCode>=65&&e.keyCode<=90){let a=e.ctrlKey?e.keyCode-64:e.keyCode+32,h=String.fromCharCode(a);e.shiftKey&&(h=h.toUpperCase()),s.key=G.ESC+h}else if(e.keyCode===32)s.key=G.ESC+(e.ctrlKey?G.NUL:" ");else if(e.key==="Dead"&&e.code.startsWith("Key")){let a=e.code.slice(3,4);e.shiftKey||(a=a.toLowerCase()),s.key=G.ESC+a,s.cancel=!0}}else i&&!e.altKey&&!e.ctrlKey&&!e.shiftKey&&e.metaKey?e.keyCode===65&&(s.type=1):e.key&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&e.keyCode>=48&&e.key.length===1?s.key=e.key:e.key&&e.ctrlKey&&(e.key==="_"&&(s.key=G.US),e.key==="@"&&(s.key=G.NUL));break}return s}var Re=0,mE=class{constructor(e){this._getKey=e,this._array=[],this._insertedValues=[],this._flushInsertedTask=new Oa,this._isFlushingInserted=!1,this._deletedIndices=[],this._flushDeletedTask=new Oa,this._isFlushingDeleted=!1}clear(){this._array.length=0,this._insertedValues.length=0,this._flushInsertedTask.clear(),this._isFlushingInserted=!1,this._deletedIndices.length=0,this._flushDeletedTask.clear(),this._isFlushingDeleted=!1}insert(e){this._flushCleanupDeleted(),this._insertedValues.length===0&&this._flushInsertedTask.enqueue(()=>this._flushInserted()),this._insertedValues.push(e)}_flushInserted(){let e=this._insertedValues.sort((s,n)=>this._getKey(s)-this._getKey(n)),t=0,i=0,r=new Array(this._array.length+this._insertedValues.length);for(let s=0;s<r.length;s++)i>=this._array.length||this._getKey(e[t])<=this._getKey(this._array[i])?(r[s]=e[t],t++):r[s]=this._array[i++];this._array=r,this._insertedValues.length=0}_flushCleanupInserted(){!this._isFlushingInserted&&this._insertedValues.length>0&&this._flushInsertedTask.flush()}delete(e){if(this._flushCleanupInserted(),this._array.length===0)return!1;let t=this._getKey(e);if(t===void 0||(Re=this._search(t),Re===-1)||this._getKey(this._array[Re])!==t)return!1;do if(this._array[Re]===e)return this._deletedIndices.length===0&&this._flushDeletedTask.enqueue(()=>this._flushDeleted()),this._deletedIndices.push(Re),!0;while(++Re<this._array.length&&this._getKey(this._array[Re])===t);return!1}_flushDeleted(){this._isFlushingDeleted=!0;let e=this._deletedIndices.sort((s,n)=>s-n),t=0,i=new Array(this._array.length-e.length),r=0;for(let s=0;s<this._array.length;s++)e[t]===s?t++:i[r++]=this._array[s];this._array=i,this._deletedIndices.length=0,this._isFlushingDeleted=!1}_flushCleanupDeleted(){!this._isFlushingDeleted&&this._deletedIndices.length>0&&this._flushDeletedTask.flush()}*getKeyIterator(e){if(this._flushCleanupInserted(),this._flushCleanupDeleted(),this._array.length!==0&&(Re=this._search(e),!(Re<0||Re>=this._array.length)&&this._getKey(this._array[Re])===e))do yield this._array[Re];while(++Re<this._array.length&&this._getKey(this._array[Re])===e)}forEachByKey(e,t){if(this._flushCleanupInserted(),this._flushCleanupDeleted(),this._array.length!==0&&(Re=this._search(e),!(Re<0||Re>=this._array.length)&&this._getKey(this._array[Re])===e))do t(this._array[Re]);while(++Re<this._array.length&&this._getKey(this._array[Re])===e)}values(){return this._flushCleanupInserted(),this._flushCleanupDeleted(),[...this._array].values()}_search(e){let t=0,i=this._array.length-1;for(;i>=t;){let r=t+i>>1,s=this._getKey(this._array[r]);if(s>e)i=r-1;else if(s<e)t=r+1;else{for(;r>0&&this._getKey(this._array[r-1])===e;)r--;return r}}return t}},Lc=0,cv=0,yE=class extends oe{constructor(){super(),this._decorations=new mE(e=>e?.marker.line),this._onDecorationRegistered=this._register(new Y),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this._register(new Y),this.onDecorationRemoved=this._onDecorationRemoved.event,this._register(be(()=>this.reset()))}get decorations(){return this._decorations.values()}registerDecoration(e){if(e.marker.isDisposed)return;let t=new bE(e);if(t){let i=t.marker.onDispose(()=>t.dispose()),r=t.onDispose(()=>{r.dispose(),t&&(this._decorations.delete(t)&&this._onDecorationRemoved.fire(t),i.dispose())});this._decorations.insert(t),this._onDecorationRegistered.fire(t)}return t}reset(){for(let e of this._decorations.values())e.dispose();this._decorations.clear()}*getDecorationsAtCell(e,t,i){let r=0,s=0;for(let n of this._decorations.getKeyIterator(t))r=n.options.x??0,s=r+(n.options.width??1),e>=r&&e<s&&(!i||(n.options.layer??"bottom")===i)&&(yield n)}forEachDecorationAtCell(e,t,i,r){this._decorations.forEachByKey(t,s=>{Lc=s.options.x??0,cv=Lc+(s.options.width??1),e>=Lc&&e<cv&&(!i||(s.options.layer??"bottom")===i)&&r(s)})}},bE=class extends _r{constructor(e){super(),this.options=e,this.onRenderEmitter=this.add(new Y),this.onRender=this.onRenderEmitter.event,this._onDispose=this.add(new Y),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=e.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=Ee.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=Ee.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}dispose(){this._onDispose.fire(),super.dispose()}},wE=1e3,AE=class{constructor(e,t=wE){this._renderCallback=e,this._debounceThresholdMS=t,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(e,t,i){this._rowCount=i,e=e!==void 0?e:0,t=t!==void 0?t:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,e):e,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,t):t;let r=performance.now();if(r-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=r,this._innerRefresh();else if(!this._additionalRefreshRequested){let s=r-this._lastRefreshMs,n=this._debounceThresholdMS-s;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=performance.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},n)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;let e=Math.max(this._rowStart,0),t=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(e,t)}},uv=20,dv=!1,Ka=class extends oe{constructor(e,t,i,r){super(),this._terminal=e,this._coreBrowserService=i,this._renderService=r,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="";let s=this._coreBrowserService.mainDocument;this._accessibilityContainer=s.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=s.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let n=0;n<this._terminal.rows;n++)this._rowElements[n]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[n]);if(this._topBoundaryFocusListener=n=>this._handleBoundaryFocus(n,0),this._bottomBoundaryFocusListener=n=>this._handleBoundaryFocus(n,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=s.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this._register(new AE(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");dv?(this._accessibilityContainer.classList.add("debug"),this._rowContainer.classList.add("debug"),this._debugRootContainer=s.createElement("div"),this._debugRootContainer.classList.add("xterm"),this._debugRootContainer.appendChild(s.createTextNode("------start a11y------")),this._debugRootContainer.appendChild(this._accessibilityContainer),this._debugRootContainer.appendChild(s.createTextNode("------end a11y------")),this._terminal.element.insertAdjacentElement("afterend",this._debugRootContainer)):this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this._register(this._terminal.onResize(n=>this._handleResize(n.rows))),this._register(this._terminal.onRender(n=>this._refreshRows(n.start,n.end))),this._register(this._terminal.onScroll(()=>this._refreshRows())),this._register(this._terminal.onA11yChar(n=>this._handleChar(n))),this._register(this._terminal.onLineFeed(()=>this._handleChar(`
`))),this._register(this._terminal.onA11yTab(n=>this._handleTab(n))),this._register(this._terminal.onKey(n=>this._handleKey(n.key))),this._register(this._terminal.onBlur(()=>this._clearLiveRegion())),this._register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this._register(se(s,"selectionchange",()=>this._handleSelectionChange())),this._register(this._coreBrowserService.onDprChange(()=>this._refreshRowsDimensions())),this._refreshRowsDimensions(),this._refreshRows(),this._register(be(()=>{dv?this._debugRootContainer.remove():this._accessibilityContainer.remove(),this._rowElements.length=0}))}_handleTab(e){for(let t=0;t<e;t++)this._handleChar(" ")}_handleChar(e){this._liveRegionLineCount<uv+1&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==e&&(this._charsToAnnounce+=e):this._charsToAnnounce+=e,e===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===uv+1&&(this._liveRegion.textContent+=Ic.get())))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey(e){this._clearLiveRegion(),/\p{Control}/u.test(e)||this._charsToConsume.push(e)}_refreshRows(e,t){this._liveRegionDebouncer.refresh(e,t,this._terminal.rows)}_renderRows(e,t){let i=this._terminal.buffer,r=i.lines.length.toString();for(let s=e;s<=t;s++){let n=i.lines.get(i.ydisp+s),o=[],a=n?.translateToString(!0,void 0,void 0,o)||"",h=(i.ydisp+s+1).toString(),l=this._rowElements[s];l&&(a.length===0?(l.textContent="\xA0",this._rowColumns.set(l,[0,1])):(l.textContent=a,this._rowColumns.set(l,o)),l.setAttribute("aria-posinset",h),l.setAttribute("aria-setsize",r),this._alignRowWidth(l))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(e,t){let i=e.target,r=this._rowElements[t===0?1:this._rowElements.length-2],s=i.getAttribute("aria-posinset"),n=t===0?"1":`${this._terminal.buffer.lines.length}`;if(s===n||e.relatedTarget!==r)return;let o,a;if(t===0?(o=i,a=this._rowElements.pop(),this._rowContainer.removeChild(a)):(o=this._rowElements.shift(),a=i,this._rowContainer.removeChild(o)),o.removeEventListener("focus",this._topBoundaryFocusListener),a.removeEventListener("focus",this._bottomBoundaryFocusListener),t===0){let h=this._createAccessibilityTreeNode();this._rowElements.unshift(h),this._rowContainer.insertAdjacentElement("afterbegin",h)}else{let h=this._createAccessibilityTreeNode();this._rowElements.push(h),this._rowContainer.appendChild(h)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(t===0?-1:1),this._rowElements[t===0?1:this._rowElements.length-2].focus(),e.preventDefault(),e.stopImmediatePropagation()}_handleSelectionChange(){if(this._rowElements.length===0)return;let e=this._coreBrowserService.mainDocument.getSelection();if(!e)return;if(e.isCollapsed){this._rowContainer.contains(e.anchorNode)&&this._terminal.clearSelection();return}if(!e.anchorNode||!e.focusNode){console.error("anchorNode and/or focusNode are null");return}let t={node:e.anchorNode,offset:e.anchorOffset},i={node:e.focusNode,offset:e.focusOffset};if((t.node.compareDocumentPosition(i.node)&Node.DOCUMENT_POSITION_PRECEDING||t.node===i.node&&t.offset>i.offset)&&([t,i]=[i,t]),t.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(t={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(t.node))return;let r=this._rowElements.slice(-1)[0];if(i.node.compareDocumentPosition(r)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(i={node:r,offset:r.textContent?.length??0}),!this._rowContainer.contains(i.node))return;let s=({node:a,offset:h})=>{let l=a instanceof Text?a.parentNode:a,c=parseInt(l?.getAttribute("aria-posinset"),10)-1;if(isNaN(c))return console.warn("row is invalid. Race condition?"),null;let u=this._rowColumns.get(l);if(!u)return console.warn("columns is null. Race condition?"),null;let p=h<u.length?u[h]:u.slice(-1)[0]+1;return p>=this._terminal.cols&&(++c,p=0),{row:c,column:p}},n=s(t),o=s(i);if(!(!n||!o)){if(n.row>o.row||n.row===o.row&&n.column>=o.column)throw new Error("invalid range");this._terminal.select(n.column,n.row,(o.row-n.row)*this._terminal.cols-n.column+o.column)}}_handleResize(e){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let t=this._rowContainer.children.length;t<this._terminal.rows;t++)this._rowElements[t]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[t]);for(;this._rowElements.length>e;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){let e=this._coreBrowserService.mainDocument.createElement("div");return e.setAttribute("role","listitem"),e.tabIndex=-1,this._refreshRowDimensions(e),e}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){Object.assign(this._accessibilityContainer.style,{width:`${this._renderService.dimensions.css.canvas.width}px`,fontSize:`${this._terminal.options.fontSize}px`}),this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let e=0;e<this._terminal.rows;e++)this._refreshRowDimensions(this._rowElements[e]),this._alignRowWidth(this._rowElements[e])}}_refreshRowDimensions(e){e.style.height=`${this._renderService.dimensions.css.cell.height}px`}_alignRowWidth(e){e.style.transform="";let t=e.getBoundingClientRect().width,i=this._rowColumns.get(e)?.slice(-1)?.[0];if(!i)return;let r=i*this._renderService.dimensions.css.cell.width;e.style.transform=`scaleX(${r/t})`}};Ka=De([Z(1,_u),Z(2,Ii),Z(3,Mi)],Ka);var fu=class extends oe{constructor(e,t,i,r,s){super(),this._element=e,this._mouseService=t,this._renderService=i,this._bufferService=r,this._linkProviderService=s,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this._register(new Y),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this._register(new Y),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this._register(be(()=>{Hr(this._linkCacheDisposables),this._linkCacheDisposables.length=0,this._lastMouseEvent=void 0,this._activeProviderReplies?.clear()})),this._register(this._bufferService.onResize(()=>{this._clearCurrentLink(),this._wasResized=!0})),this._register(se(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this._register(se(this._element,"mousemove",this._handleMouseMove.bind(this))),this._register(se(this._element,"mousedown",this._handleMouseDown.bind(this))),this._register(se(this._element,"mouseup",this._handleMouseUp.bind(this)))}get currentLink(){return this._currentLink}_handleMouseMove(e){this._lastMouseEvent=e;let t=this._positionFromMouseEvent(e,this._element,this._mouseService);if(!t)return;this._isMouseOut=!1;let i=e.composedPath();for(let r=0;r<i.length;r++){let s=i[r];if(s.classList.contains("xterm"))break;if(s.classList.contains("xterm-hover"))return}(!this._lastBufferCell||t.x!==this._lastBufferCell.x||t.y!==this._lastBufferCell.y)&&(this._handleHover(t),this._lastBufferCell=t)}_handleHover(e){if(this._activeLine!==e.y||this._wasResized){this._clearCurrentLink(),this._askForLink(e,!1),this._wasResized=!1;return}this._currentLink&&this._linkAtPosition(this._currentLink.link,e)||(this._clearCurrentLink(),this._askForLink(e,!0))}_askForLink(e,t){(!this._activeProviderReplies||!t)&&(this._activeProviderReplies?.forEach(r=>{r?.forEach(s=>{s.link.dispose&&s.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=e.y);let i=!1;for(let[r,s]of this._linkProviderService.linkProviders.entries())t?this._activeProviderReplies?.get(r)&&(i=this._checkLinkProviderResult(r,e,i)):s.provideLinks(e.y,n=>{if(this._isMouseOut)return;let o=n?.map(a=>({link:a}));this._activeProviderReplies?.set(r,o),i=this._checkLinkProviderResult(r,e,i),this._activeProviderReplies?.size===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks(e.y,this._activeProviderReplies)})}_removeIntersectingLinks(e,t){let i=new Set;for(let r=0;r<t.size;r++){let s=t.get(r);if(s)for(let n=0;n<s.length;n++){let o=s[n],a=o.link.range.start.y<e?0:o.link.range.start.x,h=o.link.range.end.y>e?this._bufferService.cols:o.link.range.end.x;for(let l=a;l<=h;l++){if(i.has(l)){s.splice(n--,1);break}i.add(l)}}}}_checkLinkProviderResult(e,t,i){if(!this._activeProviderReplies)return i;let r=this._activeProviderReplies.get(e),s=!1;for(let n=0;n<e;n++)(!this._activeProviderReplies.has(n)||this._activeProviderReplies.get(n))&&(s=!0);if(!s&&r){let n=r.find(o=>this._linkAtPosition(o.link,t));n&&(i=!0,this._handleNewLink(n))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!i)for(let n=0;n<this._activeProviderReplies.size;n++){let o=this._activeProviderReplies.get(n)?.find(a=>this._linkAtPosition(a.link,t));if(o){i=!0,this._handleNewLink(o);break}}return i}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(e){if(!this._currentLink)return;let t=this._positionFromMouseEvent(e,this._element,this._mouseService);t&&this._mouseDownLink&&xE(this._mouseDownLink.link,this._currentLink.link)&&this._linkAtPosition(this._currentLink.link,t)&&this._currentLink.link.activate(e,this._currentLink.link.text)}_clearCurrentLink(e,t){!this._currentLink||!this._lastMouseEvent||(!e||!t||this._currentLink.link.range.start.y>=e&&this._currentLink.link.range.end.y<=t)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,Hr(this._linkCacheDisposables),this._linkCacheDisposables.length=0)}_handleNewLink(e){if(!this._lastMouseEvent)return;let t=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);t&&this._linkAtPosition(e.link,t)&&(this._currentLink=e,this._currentLink.state={decorations:{underline:e.link.decorations===void 0?!0:e.link.decorations.underline,pointerCursor:e.link.decorations===void 0?!0:e.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,e.link,this._lastMouseEvent),e.link.decorations={},Object.defineProperties(e.link.decorations,{pointerCursor:{get:()=>this._currentLink?.state?.decorations.pointerCursor,set:i=>{this._currentLink?.state&&this._currentLink.state.decorations.pointerCursor!==i&&(this._currentLink.state.decorations.pointerCursor=i,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",i))}},underline:{get:()=>this._currentLink?.state?.decorations.underline,set:i=>{this._currentLink?.state&&this._currentLink?.state?.decorations.underline!==i&&(this._currentLink.state.decorations.underline=i,this._currentLink.state.isHovered&&this._fireUnderlineEvent(e.link,i))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange(i=>{if(!this._currentLink)return;let r=i.start===0?0:i.start+1+this._bufferService.buffer.ydisp,s=this._bufferService.buffer.ydisp+1+i.end;if(this._currentLink.link.range.start.y>=r&&this._currentLink.link.range.end.y<=s&&(this._clearCurrentLink(r,s),this._lastMouseEvent)){let n=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);n&&this._askForLink(n,!1)}})))}_linkHover(e,t,i){this._currentLink?.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(t,!0),this._currentLink.state.decorations.pointerCursor&&e.classList.add("xterm-cursor-pointer")),t.hover&&t.hover(i,t.text)}_fireUnderlineEvent(e,t){let i=e.range,r=this._bufferService.buffer.ydisp,s=this._createLinkUnderlineEvent(i.start.x-1,i.start.y-r-1,i.end.x,i.end.y-r-1,void 0);(t?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(s)}_linkLeave(e,t,i){this._currentLink?.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(t,!1),this._currentLink.state.decorations.pointerCursor&&e.classList.remove("xterm-cursor-pointer")),t.leave&&t.leave(i,t.text)}_linkAtPosition(e,t){let i=e.range.start.y*this._bufferService.cols+e.range.start.x,r=e.range.end.y*this._bufferService.cols+e.range.end.x,s=t.y*this._bufferService.cols+t.x;return i<=s&&s<=r}_positionFromMouseEvent(e,t,i){let r=i.getCoords(e,t,this._bufferService.cols,this._bufferService.rows);if(r)return{x:r[0],y:r[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(e,t,i,r,s){return{x1:e,y1:t,x2:i,y2:r,cols:this._bufferService.cols,fg:s}}};fu=De([Z(1,gu),Z(2,Mi),Z(3,gt),Z(4,Cv)],fu);function xE(e,t){return e.text===t.text&&e.range.start.x===t.range.start.x&&e.range.start.y===t.range.start.y&&e.range.end.x===t.range.end.x&&e.range.end.y===t.range.end.y}var SE=class extends gE{constructor(e={}){super(e),this._linkifier=this._register(new gs),this.browser=Zv,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this._register(new gs),this._onCursorMove=this._register(new Y),this.onCursorMove=this._onCursorMove.event,this._onKey=this._register(new Y),this.onKey=this._onKey.event,this._onRender=this._register(new Y),this.onRender=this._onRender.event,this._onSelectionChange=this._register(new Y),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this._register(new Y),this.onTitleChange=this._onTitleChange.event,this._onBell=this._register(new Y),this.onBell=this._onBell.event,this._onFocus=this._register(new Y),this._onBlur=this._register(new Y),this._onA11yCharEmitter=this._register(new Y),this._onA11yTabEmitter=this._register(new Y),this._onWillOpen=this._register(new Y),this._setup(),this._decorationService=this._instantiationService.createInstance(yE),this._instantiationService.setService(Nn,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(dk),this._instantiationService.setService(Cv,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(Tc)),this._register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this._register(this._inputHandler.onRequestRefreshRows(t=>this.refresh(t?.start??0,t?.end??this.rows-1))),this._register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this._register(this._inputHandler.onRequestReset(()=>this.reset())),this._register(this._inputHandler.onRequestWindowsOptionsReport(t=>this._reportWindowsOptions(t))),this._register(this._inputHandler.onColor(t=>this._handleColorEvent(t))),this._register(rt.forward(this._inputHandler.onCursorMove,this._onCursorMove)),this._register(rt.forward(this._inputHandler.onTitleChange,this._onTitleChange)),this._register(rt.forward(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this._register(rt.forward(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this._register(this._bufferService.onResize(t=>this._afterResize(t.cols,t.rows))),this._register(be(()=>{this._customKeyEventHandler=void 0,this.element?.parentNode?.removeChild(this.element)}))}get linkifier(){return this._linkifier.value}get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}_handleColorEvent(e){if(this._themeService)for(let t of e){let i,r="";switch(t.index){case 256:i="foreground",r="10";break;case 257:i="background",r="11";break;case 258:i="cursor",r="12";break;default:i="ansi",r="4;"+t.index}switch(t.type){case 0:let s=ye.toColorRGB(i==="ansi"?this._themeService.colors.ansi[t.index]:this._themeService.colors[i]);this.coreService.triggerDataEvent(`${G.ESC}]${r};${hE(s)}${Yv.ST}`);break;case 1:if(i==="ansi")this._themeService.modifyColors(n=>n.ansi[t.index]=Ke.toColor(...t.color));else{let n=i;this._themeService.modifyColors(o=>o[n]=Ke.toColor(...t.color))}break;case 2:this._themeService.restoreColor(t.index);break}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(e){e?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(Ka,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(e){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(G.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){return this.textarea?.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(G.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;let e=this.buffer.ybase+this.buffer.y,t=this.buffer.lines.get(e);if(!t)return;let i=Math.min(this.buffer.x,this.cols-1),r=this._renderService.dimensions.css.cell.height,s=t.getWidth(i),n=this._renderService.dimensions.css.cell.width*s,o=this.buffer.y*this._renderService.dimensions.css.cell.height,a=i*this._renderService.dimensions.css.cell.width;this.textarea.style.left=a+"px",this.textarea.style.top=o+"px",this.textarea.style.width=n+"px",this.textarea.style.height=r+"px",this.textarea.style.lineHeight=r+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this._register(se(this.element,"copy",t=>{this.hasSelection()&&e2(t,this._selectionService)}));let e=t=>t2(t,this.textarea,this.coreService,this.optionsService);this._register(se(this.textarea,"paste",e)),this._register(se(this.element,"paste",e)),em?this._register(se(this.element,"mousedown",t=>{t.button===2&&fp(t,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this._register(se(this.element,"contextmenu",t=>{fp(t,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),xu&&this._register(se(this.element,"auxclick",t=>{t.button===1&&pv(t,this.textarea,this.screenElement)}))}_bindKeys(){this._register(se(this.textarea,"keyup",e=>this._keyUp(e),!0)),this._register(se(this.textarea,"keydown",e=>this._keyDown(e),!0)),this._register(se(this.textarea,"keypress",e=>this._keyPress(e),!0)),this._register(se(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this._register(se(this.textarea,"compositionupdate",e=>this._compositionHelper.compositionupdate(e))),this._register(se(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this._register(se(this.textarea,"input",e=>this._inputEvent(e),!0)),this._register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(e){if(!e)throw new Error("Terminal requires a parent element.");if(e.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this.element?.ownerDocument.defaultView&&this._coreBrowserService){this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView);return}this._document=e.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),e.appendChild(this.element);let t=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),t.appendChild(this._viewportElement),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._register(se(this.screenElement,"mousemove",s=>this.updateCursorStyle(s))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),t.appendChild(this.screenElement);let i=this.textarea=this._document.createElement("textarea");this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",Dc.get()),rm||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._register(this.optionsService.onSpecificOptionChange("disableStdin",()=>i.readOnly=this.optionsService.rawOptions.disableStdin)),this.textarea.readOnly=this.optionsService.rawOptions.disableStdin,this._coreBrowserService=this._register(this._instantiationService.createInstance(ck,this.textarea,e.ownerDocument.defaultView??window,this._document??typeof window<"u"?window.document:null)),this._instantiationService.setService(Ii,this._coreBrowserService),this._register(se(this.textarea,"focus",s=>this._handleTextAreaFocus(s))),this._register(se(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(tu,this._document,this._helperContainer),this._instantiationService.setService(Qa,this._charSizeService),this._themeService=this._instantiationService.createInstance(nu),this._instantiationService.setService(ps,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(Fa),this._instantiationService.setService(Sv,this._characterJoinerService),this._renderService=this._register(this._instantiationService.createInstance(ru,this.rows,this.screenElement)),this._instantiationService.setService(Mi,this._renderService),this._register(this._renderService.onRenderedViewportChange(s=>this._onRender.fire(s))),this.onResize(s=>this._renderService.resize(s.cols,s.rows)),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(Jc,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(iu),this._instantiationService.setService(gu,this._mouseService);let r=this._linkifier.value=this._register(this._instantiationService.createInstance(fu,this.screenElement));this.element.appendChild(t);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this._register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this._register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this._register(this.onBlur(()=>this._renderService.handleBlur())),this._register(this.onFocus(()=>this._renderService.handleFocus())),this._viewport=this._register(this._instantiationService.createInstance(Vc,this.element,this.screenElement)),this._register(this._viewport.onRequestScrollLines(s=>{super.scrollLines(s,!1),this.refresh(0,this.rows-1)})),this._selectionService=this._register(this._instantiationService.createInstance(su,this.element,this.screenElement,r)),this._instantiationService.setService(h2,this._selectionService),this._register(this._selectionService.onRequestScrollLines(s=>this.scrollLines(s.amount,s.suppressScrollEvent))),this._register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this._register(this._selectionService.onRequestRedraw(s=>this._renderService.handleSelectionChanged(s.start,s.end,s.columnSelectMode))),this._register(this._selectionService.onLinuxMouseSelection(s=>{this.textarea.value=s,this.textarea.focus(),this.textarea.select()})),this._register(rt.any(this._onScroll.event,this._inputHandler.onScroll)(()=>{this._selectionService.refresh(),this._viewport?.queueSync()})),this._register(this._instantiationService.createInstance(Yc,this.screenElement)),this._register(se(this.element,"mousedown",s=>this._selectionService.handleMouseDown(s))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(Ka,this)),this._register(this.optionsService.onSpecificOptionChange("screenReaderMode",s=>this._handleScreenReaderModeOptionChange(s))),this.options.overviewRuler.width&&(this._overviewRulerRenderer=this._register(this._instantiationService.createInstance(Ra,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRuler",s=>{!this._overviewRulerRenderer&&s&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this._register(this._instantiationService.createInstance(Ra,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(eu,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){let e=this,t=this.element;function i(n){let o=e._mouseService.getMouseReportCoords(n,e.screenElement);if(!o)return!1;let a,h;switch(n.overrideType||n.type){case"mousemove":h=32,n.buttons===void 0?(a=3,n.button!==void 0&&(a=n.button<3?n.button:3)):a=n.buttons&1?0:n.buttons&4?1:n.buttons&2?2:3;break;case"mouseup":h=0,a=n.button<3?n.button:3;break;case"mousedown":h=1,a=n.button<3?n.button:3;break;case"wheel":if(e._customWheelEventHandler&&e._customWheelEventHandler(n)===!1)return!1;let l=n.deltaY;if(l===0||e.coreMouseService.consumeWheelEvent(n,e._renderService?.dimensions?.device?.cell?.height,e._coreBrowserService?.dpr)===0)return!1;h=l<0?0:1,a=4;break;default:return!1}return h===void 0||a===void 0||a>4?!1:e.coreMouseService.triggerMouseEvent({col:o.col,row:o.row,x:o.x,y:o.y,button:a,action:h,ctrl:n.ctrlKey,alt:n.altKey,shift:n.shiftKey})}let r={mouseup:null,wheel:null,mousedrag:null,mousemove:null},s={mouseup:n=>(i(n),n.buttons||(this._document.removeEventListener("mouseup",r.mouseup),r.mousedrag&&this._document.removeEventListener("mousemove",r.mousedrag)),this.cancel(n)),wheel:n=>(i(n),this.cancel(n,!0)),mousedrag:n=>{n.buttons&&i(n)},mousemove:n=>{n.buttons||i(n)}};this._register(this.coreMouseService.onProtocolChange(n=>{n?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(n)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),n&8?r.mousemove||(t.addEventListener("mousemove",s.mousemove),r.mousemove=s.mousemove):(t.removeEventListener("mousemove",r.mousemove),r.mousemove=null),n&16?r.wheel||(t.addEventListener("wheel",s.wheel,{passive:!1}),r.wheel=s.wheel):(t.removeEventListener("wheel",r.wheel),r.wheel=null),n&2?r.mouseup||(r.mouseup=s.mouseup):(this._document.removeEventListener("mouseup",r.mouseup),r.mouseup=null),n&4?r.mousedrag||(r.mousedrag=s.mousedrag):(this._document.removeEventListener("mousemove",r.mousedrag),r.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this._register(se(t,"mousedown",n=>{if(n.preventDefault(),this.focus(),!(!this.coreMouseService.areMouseEventsActive||this._selectionService.shouldForceSelection(n)))return i(n),r.mouseup&&this._document.addEventListener("mouseup",r.mouseup),r.mousedrag&&this._document.addEventListener("mousemove",r.mousedrag),this.cancel(n)})),this._register(se(t,"wheel",n=>{if(!r.wheel){if(this._customWheelEventHandler&&this._customWheelEventHandler(n)===!1)return!1;if(!this.buffer.hasScrollback){if(n.deltaY===0)return!1;if(e.coreMouseService.consumeWheelEvent(n,e._renderService?.dimensions?.device?.cell?.height,e._coreBrowserService?.dpr)===0)return this.cancel(n,!0);let o=G.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(n.deltaY<0?"A":"B");return this.coreService.triggerDataEvent(o,!0),this.cancel(n,!0)}}},{passive:!1}))}refresh(e,t){this._renderService?.refreshRows(e,t)}updateCursorStyle(e){this._selectionService?.shouldColumnSelect(e)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(e,t){this._viewport?this._viewport.scrollLines(e):super.scrollLines(e,t),this.refresh(0,this.rows-1)}scrollPages(e){this.scrollLines(e*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(e){e&&this._viewport?this._viewport.scrollToLine(this.buffer.ybase,!0):this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(e){let t=e-this._bufferService.buffer.ydisp;t!==0&&this.scrollLines(t)}paste(e){gv(e,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(e){this._customKeyEventHandler=e}attachCustomWheelEventHandler(e){this._customWheelEventHandler=e}registerLinkProvider(e){return this._linkProviderService.registerLinkProvider(e)}registerCharacterJoiner(e){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");let t=this._characterJoinerService.register(e);return this.refresh(0,this.rows-1),t}deregisterCharacterJoiner(e){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(e)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(e){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+e)}registerDecoration(e){return this._decorationService.registerDecoration(e)}hasSelection(){return this._selectionService?this._selectionService.hasSelection:!1}select(e,t,i){this._selectionService.setSelection(e,t,i)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(!(!this._selectionService||!this._selectionService.hasSelection))return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){this._selectionService?.clearSelection()}selectAll(){this._selectionService?.selectAll()}selectLines(e,t){this._selectionService?.selectLines(e,t)}_keyDown(e){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(e)===!1)return!1;let t=this.browser.isMac&&this.options.macOptionIsMeta&&e.altKey;if(!t&&!this._compositionHelper.keydown(e))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(!0),!1;!t&&(e.key==="Dead"||e.key==="AltGraph")&&(this._unprocessedDeadKey=!0);let i=vE(e,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(e),i.type===3||i.type===2){let r=this.rows-1;return this.scrollLines(i.type===2?-r:r),this.cancel(e,!0)}if(i.type===1&&this.selectAll(),this._isThirdLevelShift(this.browser,e)||(i.cancel&&this.cancel(e,!0),!i.key)||e.key&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&e.key.length===1&&e.key.charCodeAt(0)>=65&&e.key.charCodeAt(0)<=90)return!0;if(this._unprocessedDeadKey)return this._unprocessedDeadKey=!1,!0;if((i.key===G.ETX||i.key===G.CR)&&(this.textarea.value=""),this._onKey.fire({key:i.key,domEvent:e}),this._showCursor(),this.coreService.triggerDataEvent(i.key,!0),!this.optionsService.rawOptions.screenReaderMode||e.altKey||e.ctrlKey)return this.cancel(e,!0);this._keyDownHandled=!0}_isThirdLevelShift(e,t){let i=e.isMac&&!this.options.macOptionIsMeta&&t.altKey&&!t.ctrlKey&&!t.metaKey||e.isWindows&&t.altKey&&t.ctrlKey&&!t.metaKey||e.isWindows&&t.getModifierState("AltGraph");return t.type==="keypress"?i:i&&(!t.keyCode||t.keyCode>47)}_keyUp(e){this._keyDownSeen=!1,!(this._customKeyEventHandler&&this._customKeyEventHandler(e)===!1)&&(CE(e)||this.focus(),this.updateCursorStyle(e),this._keyPressHandled=!1)}_keyPress(e){let t;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(e)===!1)return!1;if(this.cancel(e),e.charCode)t=e.charCode;else if(e.which===null||e.which===void 0)t=e.keyCode;else if(e.which!==0&&e.charCode!==0)t=e.which;else return!1;return!t||(e.altKey||e.ctrlKey||e.metaKey)&&!this._isThirdLevelShift(this.browser,e)?!1:(t=String.fromCharCode(t),this._onKey.fire({key:t,domEvent:e}),this._showCursor(),this.coreService.triggerDataEvent(t,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,!0)}_inputEvent(e){if(e.data&&e.inputType==="insertText"&&(!e.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;let t=e.data;return this.coreService.triggerDataEvent(t,!0),this.cancel(e),!0}return!1}resize(e,t){if(e===this.cols&&t===this.rows){this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure();return}super.resize(e,t)}_afterResize(e,t){this._charSizeService?.measure()}clear(){if(!(this.buffer.ybase===0&&this.buffer.y===0)){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let e=1;e<this.rows;e++)this.buffer.lines.push(this.buffer.getBlankLine(Oe));this._onScroll.fire({position:this.buffer.ydisp}),this.refresh(0,this.rows-1)}}reset(){this.options.rows=this.rows,this.options.cols=this.cols;let e=this._customKeyEventHandler;this._setup(),super.reset(),this._selectionService?.reset(),this._decorationService.reset(),this._customKeyEventHandler=e,this.refresh(0,this.rows-1)}clearTextureAtlas(){this._renderService?.clearTextureAtlas()}_reportFocus(){this.element?.classList.contains("focus")?this.coreService.triggerDataEvent(G.ESC+"[I"):this.coreService.triggerDataEvent(G.ESC+"[O")}_reportWindowsOptions(e){if(this._renderService)switch(e){case 0:let t=this._renderService.dimensions.css.canvas.width.toFixed(0),i=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${G.ESC}[4;${i};${t}t`);break;case 1:let r=this._renderService.dimensions.css.cell.width.toFixed(0),s=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${G.ESC}[6;${s};${r}t`);break}}cancel(e,t){if(!(!this.options.cancelEvents&&!t))return e.preventDefault(),e.stopPropagation(),!1}};function CE(e){return e.keyCode===16||e.keyCode===17||e.keyCode===18}var kE=class{constructor(){this._addons=[]}dispose(){for(let e=this._addons.length-1;e>=0;e--)this._addons[e].instance.dispose()}loadAddon(e,t){let i={instance:t,dispose:t.dispose,isDisposed:!1};this._addons.push(i),t.dispose=()=>this._wrappedAddonDispose(i),t.activate(e)}_wrappedAddonDispose(e){if(e.isDisposed)return;let t=-1;for(let i=0;i<this._addons.length;i++)if(this._addons[i]===e){t=i;break}if(t===-1)throw new Error("Could not dispose an addon that has not been loaded");e.isDisposed=!0,e.dispose.apply(e.instance),this._addons.splice(t,1)}},EE=class{constructor(e){this._line=e}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(e,t){if(!(e<0||e>=this._line.length))return t?(this._line.loadCell(e,t),t):this._line.loadCell(e,new Xt)}translateToString(e,t,i){return this._line.translateToString(e,t,i)}},fv=class{constructor(e,t){this._buffer=e,this.type=t}init(e){return this._buffer=e,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(e){let t=this._buffer.lines.get(e);if(t)return new EE(t)}getNullCell(){return new Xt}},BE=class extends oe{constructor(e){super(),this._core=e,this._onBufferChange=this._register(new Y),this.onBufferChange=this._onBufferChange.event,this._normal=new fv(this._core.buffers.normal,"normal"),this._alternate=new fv(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}},LE=class{constructor(e){this._core=e}registerCsiHandler(e,t){return this._core.registerCsiHandler(e,i=>t(i.toArray()))}addCsiHandler(e,t){return this.registerCsiHandler(e,t)}registerDcsHandler(e,t){return this._core.registerDcsHandler(e,(i,r)=>t(i,r.toArray()))}addDcsHandler(e,t){return this.registerDcsHandler(e,t)}registerEscHandler(e,t){return this._core.registerEscHandler(e,t)}addEscHandler(e,t){return this.registerEscHandler(e,t)}registerOscHandler(e,t){return this._core.registerOscHandler(e,t)}addOscHandler(e,t){return this.registerOscHandler(e,t)}},DE=class{constructor(e){this._core=e}register(e){this._core.unicodeService.register(e)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(e){this._core.unicodeService.activeVersion=e}},IE=["cols","rows"],ci=0,fm=class extends oe{constructor(e){super(),this._core=this._register(new SE(e)),this._addonManager=this._register(new kE),this._publicOptions={...this._core.options};let t=r=>this._core.options[r],i=(r,s)=>{this._checkReadonlyOptions(r),this._core.options[r]=s};for(let r in this._core.options){let s={get:t.bind(this,r),set:i.bind(this,r)};Object.defineProperty(this._publicOptions,r,s)}}_checkReadonlyOptions(e){if(IE.includes(e))throw new Error(`Option "${e}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new LE(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new DE(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this._register(new BE(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){let e=this._core.coreService.decPrivateModes,t="none";switch(this._core.coreMouseService.activeProtocol){case"X10":t="x10";break;case"VT200":t="vt200";break;case"DRAG":t="drag";break;case"ANY":t="any";break}return{applicationCursorKeysMode:e.applicationCursorKeys,applicationKeypadMode:e.applicationKeypad,bracketedPasteMode:e.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:t,originMode:e.origin,reverseWraparoundMode:e.reverseWraparound,sendFocusMode:e.sendFocus,synchronizedOutputMode:e.synchronizedOutput,wraparoundMode:e.wraparound}}get options(){return this._publicOptions}set options(e){for(let t in e)this._publicOptions[t]=e[t]}blur(){this._core.blur()}focus(){this._core.focus()}input(e,t=!0){this._core.input(e,t)}resize(e,t){this._verifyIntegers(e,t),this._core.resize(e,t)}open(e){this._core.open(e)}attachCustomKeyEventHandler(e){this._core.attachCustomKeyEventHandler(e)}attachCustomWheelEventHandler(e){this._core.attachCustomWheelEventHandler(e)}registerLinkProvider(e){return this._core.registerLinkProvider(e)}registerCharacterJoiner(e){return this._checkProposedApi(),this._core.registerCharacterJoiner(e)}deregisterCharacterJoiner(e){this._checkProposedApi(),this._core.deregisterCharacterJoiner(e)}registerMarker(e=0){return this._verifyIntegers(e),this._core.registerMarker(e)}registerDecoration(e){return this._checkProposedApi(),this._verifyPositiveIntegers(e.x??0,e.width??0,e.height??0),this._core.registerDecoration(e)}hasSelection(){return this._core.hasSelection()}select(e,t,i){this._verifyIntegers(e,t,i),this._core.select(e,t,i)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(e,t){this._verifyIntegers(e,t),this._core.selectLines(e,t)}dispose(){super.dispose()}scrollLines(e){this._verifyIntegers(e),this._core.scrollLines(e)}scrollPages(e){this._verifyIntegers(e),this._core.scrollPages(e)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(e){this._verifyIntegers(e),this._core.scrollToLine(e)}clear(){this._core.clear()}write(e,t){this._core.write(e,t)}writeln(e,t){this._core.write(e),this._core.write(`\r
`,t)}paste(e){this._core.paste(e)}refresh(e,t){this._verifyIntegers(e,t),this._core.refresh(e,t)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(e){this._addonManager.loadAddon(this,e)}static get strings(){return{get promptLabel(){return Dc.get()},set promptLabel(e){Dc.set(e)},get tooMuchOutput(){return Ic.get()},set tooMuchOutput(e){Ic.set(e)}}}_verifyIntegers(...e){for(ci of e)if(ci===1/0||isNaN(ci)||ci%1!==0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...e){for(ci of e)if(ci&&(ci===1/0||isNaN(ci)||ci%1!==0||ci<0))throw new Error("This API only accepts positive integers")}};var ME=2,TE=1,_m=class{activate(e){this._terminal=e}dispose(){}fit(){let e=this.proposeDimensions();if(!e||!this._terminal||isNaN(e.cols)||isNaN(e.rows))return;let t=this._terminal._core;(this._terminal.rows!==e.rows||this._terminal.cols!==e.cols)&&(t._renderService.clear(),this._terminal.resize(e.cols,e.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;let e=this._terminal._core._renderService.dimensions;if(e.css.cell.width===0||e.css.cell.height===0)return;let t=this._terminal.options.scrollback===0?0:this._terminal.options.overviewRuler?.width||14,i=window.getComputedStyle(this._terminal.element.parentElement),r=parseInt(i.getPropertyValue("height")),s=Math.max(0,parseInt(i.getPropertyValue("width"))),n=window.getComputedStyle(this._terminal.element),o={top:parseInt(n.getPropertyValue("padding-top")),bottom:parseInt(n.getPropertyValue("padding-bottom")),right:parseInt(n.getPropertyValue("padding-right")),left:parseInt(n.getPropertyValue("padding-left"))},a=o.top+o.bottom,h=o.right+o.left,l=r-a,c=s-h-t;return{cols:Math.max(ME,Math.floor(c/e.css.cell.width)),rows:Math.max(TE,Math.floor(l/e.css.cell.height))}}};var RE=Object.defineProperty,FE=Object.getOwnPropertyDescriptor,PE=(e,t,i,r)=>{for(var s=r>1?void 0:r?FE(t,i):t,n=e.length-1,o;n>=0;n--)(o=e[n])&&(s=(r?o(t,i,s):o(s))||s);return r&&s&&RE(t,i,s),s},OE=(e,t)=>(i,r)=>t(i,r,e),KE=class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(e){setTimeout(()=>{throw e.stack?gm.isErrorNoTelemetry(e)?new gm(e.message+`

`+e.stack):new Error(e.message+`

`+e.stack):e},0)}}addListener(e){return this.listeners.push(e),()=>{this._removeListener(e)}}emit(e){this.listeners.forEach(t=>{t(e)})}_removeListener(e){this.listeners.splice(this.listeners.indexOf(e),1)}setUnexpectedErrorHandler(e){this.unexpectedErrorHandler=e}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(e){this.unexpectedErrorHandler(e),this.emit(e)}onUnexpectedExternalError(e){this.unexpectedErrorHandler(e)}},NE=new KE;function qa(e){QE(e)||NE.onUnexpectedError(e)}var Ku="Canceled";function QE(e){return e instanceof HE?!0:e instanceof Error&&e.name===Ku&&e.message===Ku}var HE=class extends Error{constructor(){super(Ku),this.name=this.message}},gm=class Nu extends Error{constructor(t){super(t),this.name="CodeExpectedError"}static fromError(t){if(t instanceof Nu)return t;let i=new Nu;return i.message=t.message,i.stack=t.stack,i}static isErrorNoTelemetry(t){return t.name==="CodeExpectedError"}};function XE(e,t,i=0,r=e.length){let s=i,n=r;for(;s<n;){let o=Math.floor((s+n)/2);t(e[o])?s=o+1:n=o}return s-1}var UE=class Jm{constructor(t){this._array=t,this._findLastMonotonousLastIdx=0}findLastMonotonous(t){if(Jm.assertInvariants){if(this._prevFindLastPredicate){for(let r of this._array)if(this._prevFindLastPredicate(r)&&!t(r))throw new Error("MonotonousArray: current predicate must be weaker than (or equal to) the previous predicate.")}this._prevFindLastPredicate=t}let i=XE(this._array,t,this._findLastMonotonousLastIdx);return this._findLastMonotonousLastIdx=i+1,i===-1?void 0:this._array[i]}};UE.assertInvariants=!1;var Zm;(e=>{function t(n){return n<0}e.isLessThan=t;function i(n){return n<=0}e.isLessThanOrEqual=i;function r(n){return n>0}e.isGreaterThan=r;function s(n){return n===0}e.isNeitherLessOrGreaterThan=s,e.greaterThan=1,e.lessThan=-1,e.neitherLessOrGreaterThan=0})(Zm||={});function zE(e,t){return(i,r)=>t(e(i),e(r))}var WE=(e,t)=>e-t,pm=class Qu{constructor(t){this.iterate=t}forEach(t){this.iterate(i=>(t(i),!0))}toArray(){let t=[];return this.iterate(i=>(t.push(i),!0)),t}filter(t){return new Qu(i=>this.iterate(r=>t(r)?i(r):!0))}map(t){return new Qu(i=>this.iterate(r=>i(t(r))))}some(t){let i=!1;return this.iterate(r=>(i=t(r),!i)),i}findFirst(t){let i;return this.iterate(r=>t(r)?(i=r,!1):!0),i}findLast(t){let i;return this.iterate(r=>(t(r)&&(i=r),!0)),i}findLastMaxBy(t){let i,r=!0;return this.iterate(s=>((r||Zm.isGreaterThan(t(s,i)))&&(r=!1,i=s),!0)),i}};pm.empty=new pm(e=>{});function $E(e,t){let i=Object.create(null);for(let r of e){let s=t(r),n=i[s];n||(n=i[s]=[]),n.push(r)}return i}var vm,mm,UM=class{constructor(e,t){this.toKey=t,this._map=new Map,this[vm]="SetWithKey";for(let i of e)this.add(i)}get size(){return this._map.size}add(e){let t=this.toKey(e);return this._map.set(t,e),this}delete(e){return this._map.delete(this.toKey(e))}has(e){return this._map.has(this.toKey(e))}*entries(){for(let e of this._map.values())yield[e,e]}keys(){return this.values()}*values(){for(let e of this._map.values())yield e}clear(){this._map.clear()}forEach(e,t){this._map.forEach(i=>e.call(t,i,i,this))}[(mm=Symbol.iterator,vm=Symbol.toStringTag,mm)](){return this.values()}},GE=class{constructor(){this.map=new Map}add(e,t){let i=this.map.get(e);i||(i=new Set,this.map.set(e,i)),i.add(t)}delete(e,t){let i=this.map.get(e);i&&(i.delete(t),i.size===0&&this.map.delete(e))}forEach(e,t){let i=this.map.get(e);i&&i.forEach(t)}get(e){return this.map.get(e)||new Set}};function jE(e,t){let i=this,r=!1,s;return function(){if(r)return s;if(r=!0,t)try{s=e.apply(i,arguments)}finally{t()}else s=e.apply(i,arguments);return s}}var e1;(e=>{function t(b){return b&&typeof b=="object"&&typeof b[Symbol.iterator]=="function"}e.is=t;let i=Object.freeze([]);function r(){return i}e.empty=r;function*s(b){yield b}e.single=s;function n(b){return t(b)?b:s(b)}e.wrap=n;function o(b){return b||i}e.from=o;function*a(b){for(let L=b.length-1;L>=0;L--)yield b[L]}e.reverse=a;function h(b){return!b||b[Symbol.iterator]().next().done===!0}e.isEmpty=h;function l(b){return b[Symbol.iterator]().next().value}e.first=l;function c(b,L){let I=0;for(let T of b)if(L(T,I++))return!0;return!1}e.some=c;function u(b,L){for(let I of b)if(L(I))return I}e.find=u;function*p(b,L){for(let I of b)L(I)&&(yield I)}e.filter=p;function*g(b,L){let I=0;for(let T of b)yield L(T,I++)}e.map=g;function*v(b,L){let I=0;for(let T of b)yield*L(T,I++)}e.flatMap=v;function*m(...b){for(let L of b)yield*L}e.concat=m;function x(b,L,I){let T=I;for(let q of b)T=L(T,q);return T}e.reduce=x;function*E(b,L,I=b.length){for(L<0&&(L+=b.length),I<0?I+=b.length:I>b.length&&(I=b.length);L<I;L++)yield b[L]}e.slice=E;function R(b,L=Number.POSITIVE_INFINITY){let I=[];if(L===0)return[I,b];let T=b[Symbol.iterator]();for(let q=0;q<L;q++){let $=T.next();if($.done)return[I,e.empty()];I.push($.value)}return[I,{[Symbol.iterator](){return T}}]}e.consume=R;async function D(b){let L=[];for await(let I of b)L.push(I);return Promise.resolve(L)}e.asyncToArray=D})(e1||={});var qE=!1,xs=null,VE=class t1{constructor(){this.livingDisposables=new Map}getDisposableData(t){let i=this.livingDisposables.get(t);return i||(i={parent:null,source:null,isSingleton:!1,value:t,idx:t1.idx++},this.livingDisposables.set(t,i)),i}trackDisposable(t){let i=this.getDisposableData(t);i.source||(i.source=new Error().stack)}setParent(t,i){let r=this.getDisposableData(t);r.parent=i}markAsDisposed(t){this.livingDisposables.delete(t)}markAsSingleton(t){this.getDisposableData(t).isSingleton=!0}getRootParent(t,i){let r=i.get(t);if(r)return r;let s=t.parent?this.getRootParent(this.getDisposableData(t.parent),i):t;return i.set(t,s),s}getTrackedDisposables(){let t=new Map;return[...this.livingDisposables.entries()].filter(([,i])=>i.source!==null&&!this.getRootParent(i,t).isSingleton).flatMap(([i])=>i)}computeLeakingDisposables(t=10,i){let r;if(i)r=i;else{let h=new Map,l=[...this.livingDisposables.values()].filter(u=>u.source!==null&&!this.getRootParent(u,h).isSingleton);if(l.length===0)return;let c=new Set(l.map(u=>u.value));if(r=l.filter(u=>!(u.parent&&c.has(u.parent))),r.length===0)throw new Error("There are cyclic diposable chains!")}if(!r)return;function s(h){function l(u,p){for(;u.length>0&&p.some(g=>typeof g=="string"?g===u[0]:u[0].match(g));)u.shift()}let c=h.source.split(`
`).map(u=>u.trim().replace("at ","")).filter(u=>u!=="");return l(c,["Error",/^trackDisposable \(.*\)$/,/^DisposableTracker.trackDisposable \(.*\)$/]),c.reverse()}let n=new GE;for(let h of r){let l=s(h);for(let c=0;c<=l.length;c++)n.add(l.slice(0,c).join(`
`),h)}r.sort(zE(h=>h.idx,WE));let o="",a=0;for(let h of r.slice(0,t)){a++;let l=s(h),c=[];for(let u=0;u<l.length;u++){let p=l[u];p=`(shared with ${n.get(l.slice(0,u+1).join(`
`)).size}/${r.length} leaks) at ${p}`;let g=n.get(l.slice(0,u).join(`
`)),v=$E([...g].map(m=>s(m)[u]),m=>m);delete v[l[u]];for(let[m,x]of Object.entries(v))c.unshift(`    - stacktraces of ${x.length} other leaks continue with ${m}`);c.unshift(p)}o+=`


==================== Leaking disposable ${a}/${r.length}: ${h.value.constructor.name} ====================
${c.join(`
`)}
============================================================

`}return r.length>t&&(o+=`


... and ${r.length-t} more leaking disposables

`),{leaks:r,details:o}}};VE.idx=0;function YE(e){xs=e}if(qE){let e="__is_disposable_tracked__";YE(new class{trackDisposable(t){let i=new Error("Potentially leaked disposable").stack;setTimeout(()=>{t[e]||console.log(i)},3e3)}setParent(t,i){if(t&&t!==It.None)try{t[e]=!0}catch{}}markAsDisposed(t){if(t&&t!==It.None)try{t[e]=!0}catch{}}markAsSingleton(t){}})}function nl(e){return xs?.trackDisposable(e),e}function ol(e){xs?.markAsDisposed(e)}function jn(e,t){xs?.setParent(e,t)}function JE(e,t){if(xs)for(let i of e)xs.setParent(i,t)}function i1(e){if(e1.is(e)){let t=[];for(let i of e)if(i)try{i.dispose()}catch(r){t.push(r)}if(t.length===1)throw t[0];if(t.length>1)throw new AggregateError(t,"Encountered errors while disposing of store");return Array.isArray(e)?[]:e}else if(e)return e.dispose(),e}function r1(...e){let t=nt(()=>i1(e));return JE(e,t),t}function nt(e){let t=nl({dispose:jE(()=>{ol(t),e()})});return t}var s1=class n1{constructor(){this._toDispose=new Set,this._isDisposed=!1,nl(this)}dispose(){this._isDisposed||(ol(this),this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{i1(this._toDispose)}finally{this._toDispose.clear()}}add(t){if(!t)return t;if(t===this)throw new Error("Cannot register a disposable on itself!");return jn(t,this),this._isDisposed?n1.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(t),t}delete(t){if(t){if(t===this)throw new Error("Cannot dispose a disposable on itself!");this._toDispose.delete(t),t.dispose()}}deleteAndLeak(t){t&&this._toDispose.has(t)&&(this._toDispose.delete(t),jn(t,null))}};s1.DISABLE_DISPOSED_WARNING=!1;var As=s1,It=class{constructor(){this._store=new As,nl(this),jn(this._store,this)}dispose(){ol(this),this._store.dispose()}_register(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}};It.None=Object.freeze({dispose(){}});var Xn=class{constructor(){this._isDisposed=!1,nl(this)}get value(){return this._isDisposed?void 0:this._value}set value(e){this._isDisposed||e===this._value||(this._value?.dispose(),e&&jn(e,this),this._value=e)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,ol(this),this._value?.dispose(),this._value=void 0}clearAndLeak(){let e=this._value;return this._value=void 0,e&&jn(e,null),e}},qu=typeof process<"u"&&"title"in process,Vn=qu?"node":navigator.userAgent,Vu=qu?"node":navigator.platform,ZE=Vn.includes("Firefox"),e3=Vn.includes("Edge"),o1=/^((?!chrome|android).)*safari/i.test(Vn);function t3(){if(!o1)return 0;let e=Vn.match(/Version\/(\d+)/);return e===null||e.length<2?0:parseInt(e[1])}var zM=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(Vu),WM=["Windows","Win16","Win32","WinCE"].includes(Vu),$M=Vu.indexOf("Linux")>=0,GM=/\bCrOS\b/.test(Vn),i3="",Je=0,Ze=0,et=0,Me=0,Ut={css:"#00000000",rgba:0},mt;(e=>{function t(s,n,o,a){return a!==void 0?`#${zr(s)}${zr(n)}${zr(o)}${zr(a)}`:`#${zr(s)}${zr(n)}${zr(o)}`}e.toCss=t;function i(s,n,o,a=255){return(s<<24|n<<16|o<<8|a)>>>0}e.toRgba=i;function r(s,n,o,a){return{css:e.toCss(s,n,o,a),rgba:e.toRgba(s,n,o,a)}}e.toColor=r})(mt||={});var Gn;(e=>{function t(h,l){if(Me=(l.rgba&255)/255,Me===1)return{css:l.css,rgba:l.rgba};let c=l.rgba>>24&255,u=l.rgba>>16&255,p=l.rgba>>8&255,g=h.rgba>>24&255,v=h.rgba>>16&255,m=h.rgba>>8&255;Je=g+Math.round((c-g)*Me),Ze=v+Math.round((u-v)*Me),et=m+Math.round((p-m)*Me);let x=mt.toCss(Je,Ze,et),E=mt.toRgba(Je,Ze,et);return{css:x,rgba:E}}e.blend=t;function i(h){return(h.rgba&255)===255}e.isOpaque=i;function r(h,l,c){let u=Wr.ensureContrastRatio(h.rgba,l.rgba,c);if(u)return mt.toColor(u>>24&255,u>>16&255,u>>8&255)}e.ensureContrastRatio=r;function s(h){let l=(h.rgba|255)>>>0;return[Je,Ze,et]=Wr.toChannels(l),{css:mt.toCss(Je,Ze,et),rgba:l}}e.opaque=s;function n(h,l){return Me=Math.round(l*255),[Je,Ze,et]=Wr.toChannels(h.rgba),{css:mt.toCss(Je,Ze,et,Me),rgba:mt.toRgba(Je,Ze,et,Me)}}e.opacity=n;function o(h,l){return Me=h.rgba&255,n(h,Me*l/255)}e.multiplyOpacity=o;function a(h){return[h.rgba>>24&255,h.rgba>>16&255,h.rgba>>8&255]}e.toColorRGB=a})(Gn||={});var r3;(e=>{let t,i;try{let s=document.createElement("canvas");s.width=1,s.height=1;let n=s.getContext("2d",{willReadFrequently:!0});n&&(t=n,t.globalCompositeOperation="copy",i=t.createLinearGradient(0,0,1,1))}catch{}function r(s){if(s.match(/#[\da-f]{3,8}/i))switch(s.length){case 4:return Je=parseInt(s.slice(1,2).repeat(2),16),Ze=parseInt(s.slice(2,3).repeat(2),16),et=parseInt(s.slice(3,4).repeat(2),16),mt.toColor(Je,Ze,et);case 5:return Je=parseInt(s.slice(1,2).repeat(2),16),Ze=parseInt(s.slice(2,3).repeat(2),16),et=parseInt(s.slice(3,4).repeat(2),16),Me=parseInt(s.slice(4,5).repeat(2),16),mt.toColor(Je,Ze,et,Me);case 7:return{css:s,rgba:(parseInt(s.slice(1),16)<<8|255)>>>0};case 9:return{css:s,rgba:parseInt(s.slice(1),16)>>>0}}let n=s.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(n)return Je=parseInt(n[1]),Ze=parseInt(n[2]),et=parseInt(n[3]),Me=Math.round((n[5]===void 0?1:parseFloat(n[5]))*255),mt.toColor(Je,Ze,et,Me);if(!t||!i)throw new Error("css.toColor: Unsupported css format");if(t.fillStyle=i,t.fillStyle=s,typeof t.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(t.fillRect(0,0,1,1),[Je,Ze,et,Me]=t.getImageData(0,0,1,1).data,Me!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:mt.toRgba(Je,Ze,et,Me),css:s}}e.toColor=r})(r3||={});var vt;(e=>{function t(r){return i(r>>16&255,r>>8&255,r&255)}e.relativeLuminance=t;function i(r,s,n){let o=r/255,a=s/255,h=n/255,l=o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4),c=a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4),u=h<=.03928?h/12.92:Math.pow((h+.055)/1.055,2.4);return l*.2126+c*.7152+u*.0722}e.relativeLuminance2=i})(vt||={});var Wr;(e=>{function t(o,a){if(Me=(a&255)/255,Me===1)return a;let h=a>>24&255,l=a>>16&255,c=a>>8&255,u=o>>24&255,p=o>>16&255,g=o>>8&255;return Je=u+Math.round((h-u)*Me),Ze=p+Math.round((l-p)*Me),et=g+Math.round((c-g)*Me),mt.toRgba(Je,Ze,et)}e.blend=t;function i(o,a,h){let l=vt.relativeLuminance(o>>8),c=vt.relativeLuminance(a>>8);if(Ti(l,c)<h){if(c<l){let g=r(o,a,h),v=Ti(l,vt.relativeLuminance(g>>8));if(v<h){let m=s(o,a,h),x=Ti(l,vt.relativeLuminance(m>>8));return v>x?g:m}return g}let u=s(o,a,h),p=Ti(l,vt.relativeLuminance(u>>8));if(p<h){let g=r(o,a,h),v=Ti(l,vt.relativeLuminance(g>>8));return p>v?u:g}return u}}e.ensureContrastRatio=i;function r(o,a,h){let l=o>>24&255,c=o>>16&255,u=o>>8&255,p=a>>24&255,g=a>>16&255,v=a>>8&255,m=Ti(vt.relativeLuminance2(p,g,v),vt.relativeLuminance2(l,c,u));for(;m<h&&(p>0||g>0||v>0);)p-=Math.max(0,Math.ceil(p*.1)),g-=Math.max(0,Math.ceil(g*.1)),v-=Math.max(0,Math.ceil(v*.1)),m=Ti(vt.relativeLuminance2(p,g,v),vt.relativeLuminance2(l,c,u));return(p<<24|g<<16|v<<8|255)>>>0}e.reduceLuminance=r;function s(o,a,h){let l=o>>24&255,c=o>>16&255,u=o>>8&255,p=a>>24&255,g=a>>16&255,v=a>>8&255,m=Ti(vt.relativeLuminance2(p,g,v),vt.relativeLuminance2(l,c,u));for(;m<h&&(p<255||g<255||v<255);)p=Math.min(255,p+Math.ceil((255-p)*.1)),g=Math.min(255,g+Math.ceil((255-g)*.1)),v=Math.min(255,v+Math.ceil((255-v)*.1)),m=Ti(vt.relativeLuminance2(p,g,v),vt.relativeLuminance2(l,c,u));return(p<<24|g<<16|v<<8|255)>>>0}e.increaseLuminance=s;function n(o){return[o>>24&255,o>>16&255,o>>8&255,o&255]}e.toChannels=n})(Wr||={});function zr(e){let t=e.toString(16);return t.length<2?"0"+t:t}function Ti(e,t){return e<t?(t+.05)/(e+.05):(e+.05)/(t+.05)}function Ne(e){if(!e)throw new Error("value must not be falsy");return e}function Yu(e){return 57508<=e&&e<=57558}function s3(e){return 57520<=e&&e<=57527}function n3(e){return 57344<=e&&e<=63743}function o3(e){return 9472<=e&&e<=9631}function a3(e){return e>=128512&&e<=128591||e>=127744&&e<=128511||e>=128640&&e<=128767||e>=9728&&e<=9983||e>=9984&&e<=10175||e>=65024&&e<=65039||e>=129280&&e<=129535||e>=127462&&e<=127487}function l3(e,t,i,r){return t===1&&i>Math.ceil(r*1.5)&&e!==void 0&&e>255&&!a3(e)&&!Yu(e)&&!n3(e)}function a1(e){return Yu(e)||o3(e)}function h3(){return{css:{canvas:Wa(),cell:Wa()},device:{canvas:Wa(),cell:Wa(),char:{width:0,height:0,left:0,top:0}}}}function Wa(){return{width:0,height:0}}function c3(e,t,i=0){return(e-(Math.round(t)*2-i))%(Math.round(t)*2)}var st=0,Ye=0,_i=!1,Ri=!1,$a=!1,At,Su=0,u3=class{constructor(e,t,i,r,s,n){this._terminal=e,this._optionService=t,this._selectionRenderModel=i,this._decorationService=r,this._coreBrowserService=s,this._themeService=n,this.result={fg:0,bg:0,ext:0}}resolve(e,t,i,r){if(this.result.bg=e.bg,this.result.fg=e.fg,this.result.ext=e.bg&268435456?e.extended.ext:0,Ye=0,st=0,Ri=!1,_i=!1,$a=!1,At=this._themeService.colors,Su=0,e.getCode()!==0&&e.extended.underlineStyle===4){let s=Math.max(1,Math.floor(this._optionService.rawOptions.fontSize*this._coreBrowserService.dpr/15));Su=t*r%(Math.round(s)*2)}if(this._decorationService.forEachDecorationAtCell(t,i,"bottom",s=>{s.backgroundColorRGB&&(Ye=s.backgroundColorRGB.rgba>>8&16777215,Ri=!0),s.foregroundColorRGB&&(st=s.foregroundColorRGB.rgba>>8&16777215,_i=!0)}),$a=this._selectionRenderModel.isCellSelected(this._terminal,t,i),$a){if(this.result.fg&67108864||(this.result.bg&50331648)!==0){if(this.result.fg&67108864)switch(this.result.fg&50331648){case 16777216:case 33554432:Ye=this._themeService.colors.ansi[this.result.fg&255].rgba;break;case 50331648:Ye=(this.result.fg&16777215)<<8|255;break;case 0:default:Ye=this._themeService.colors.foreground.rgba}else switch(this.result.bg&50331648){case 16777216:case 33554432:Ye=this._themeService.colors.ansi[this.result.bg&255].rgba;break;case 50331648:Ye=(this.result.bg&16777215)<<8|255;break}Ye=Wr.blend(Ye,(this._coreBrowserService.isFocused?At.selectionBackgroundOpaque:At.selectionInactiveBackgroundOpaque).rgba&4294967040|128)>>8&16777215}else Ye=(this._coreBrowserService.isFocused?At.selectionBackgroundOpaque:At.selectionInactiveBackgroundOpaque).rgba>>8&16777215;if(Ri=!0,At.selectionForeground&&(st=At.selectionForeground.rgba>>8&16777215,_i=!0),a1(e.getCode())){if(this.result.fg&67108864&&(this.result.bg&50331648)===0)st=(this._coreBrowserService.isFocused?At.selectionBackgroundOpaque:At.selectionInactiveBackgroundOpaque).rgba>>8&16777215;else{if(this.result.fg&67108864)switch(this.result.bg&50331648){case 16777216:case 33554432:st=this._themeService.colors.ansi[this.result.bg&255].rgba;break;case 50331648:st=(this.result.bg&16777215)<<8|255;break}else switch(this.result.fg&50331648){case 16777216:case 33554432:st=this._themeService.colors.ansi[this.result.fg&255].rgba;break;case 50331648:st=(this.result.fg&16777215)<<8|255;break;case 0:default:st=this._themeService.colors.foreground.rgba}st=Wr.blend(st,(this._coreBrowserService.isFocused?At.selectionBackgroundOpaque:At.selectionInactiveBackgroundOpaque).rgba&4294967040|128)>>8&16777215}_i=!0}}this._decorationService.forEachDecorationAtCell(t,i,"top",s=>{s.backgroundColorRGB&&(Ye=s.backgroundColorRGB.rgba>>8&16777215,Ri=!0),s.foregroundColorRGB&&(st=s.foregroundColorRGB.rgba>>8&16777215,_i=!0)}),Ri&&($a?Ye=e.bg&-16777216&-134217729|Ye|50331648:Ye=e.bg&-16777216|Ye|50331648),_i&&(st=e.fg&-16777216&-67108865|st|50331648),this.result.fg&67108864&&(Ri&&!_i&&((this.result.bg&50331648)===0?st=this.result.fg&-134217728|At.background.rgba>>8&16777215&16777215|50331648:st=this.result.fg&-134217728|this.result.bg&67108863,_i=!0),!Ri&&_i&&((this.result.fg&50331648)===0?Ye=this.result.bg&-67108864|At.foreground.rgba>>8&16777215&16777215|50331648:Ye=this.result.bg&-67108864|this.result.fg&67108863,Ri=!0)),At=void 0,this.result.bg=Ri?Ye:this.result.bg,this.result.fg=_i?st:this.result.fg,this.result.ext&=536870911,this.result.ext|=Su<<29&3758096384}},d3=.5,l1=ZE||e3?"bottom":"ideographic",f3={"\u2580":[{x:0,y:0,w:8,h:4}],"\u2581":[{x:0,y:7,w:8,h:1}],"\u2582":[{x:0,y:6,w:8,h:2}],"\u2583":[{x:0,y:5,w:8,h:3}],"\u2584":[{x:0,y:4,w:8,h:4}],"\u2585":[{x:0,y:3,w:8,h:5}],"\u2586":[{x:0,y:2,w:8,h:6}],"\u2587":[{x:0,y:1,w:8,h:7}],"\u2588":[{x:0,y:0,w:8,h:8}],"\u2589":[{x:0,y:0,w:7,h:8}],"\u258A":[{x:0,y:0,w:6,h:8}],"\u258B":[{x:0,y:0,w:5,h:8}],"\u258C":[{x:0,y:0,w:4,h:8}],"\u258D":[{x:0,y:0,w:3,h:8}],"\u258E":[{x:0,y:0,w:2,h:8}],"\u258F":[{x:0,y:0,w:1,h:8}],"\u2590":[{x:4,y:0,w:4,h:8}],"\u2594":[{x:0,y:0,w:8,h:1}],"\u2595":[{x:7,y:0,w:1,h:8}],"\u2596":[{x:0,y:4,w:4,h:4}],"\u2597":[{x:4,y:4,w:4,h:4}],"\u2598":[{x:0,y:0,w:4,h:4}],"\u2599":[{x:0,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"\u259A":[{x:0,y:0,w:4,h:4},{x:4,y:4,w:4,h:4}],"\u259B":[{x:0,y:0,w:4,h:8},{x:4,y:0,w:4,h:4}],"\u259C":[{x:0,y:0,w:8,h:4},{x:4,y:0,w:4,h:8}],"\u259D":[{x:4,y:0,w:4,h:4}],"\u259E":[{x:4,y:0,w:4,h:4},{x:0,y:4,w:4,h:4}],"\u259F":[{x:4,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"\u{1FB70}":[{x:1,y:0,w:1,h:8}],"\u{1FB71}":[{x:2,y:0,w:1,h:8}],"\u{1FB72}":[{x:3,y:0,w:1,h:8}],"\u{1FB73}":[{x:4,y:0,w:1,h:8}],"\u{1FB74}":[{x:5,y:0,w:1,h:8}],"\u{1FB75}":[{x:6,y:0,w:1,h:8}],"\u{1FB76}":[{x:0,y:1,w:8,h:1}],"\u{1FB77}":[{x:0,y:2,w:8,h:1}],"\u{1FB78}":[{x:0,y:3,w:8,h:1}],"\u{1FB79}":[{x:0,y:4,w:8,h:1}],"\u{1FB7A}":[{x:0,y:5,w:8,h:1}],"\u{1FB7B}":[{x:0,y:6,w:8,h:1}],"\u{1FB7C}":[{x:0,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"\u{1FB7D}":[{x:0,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"\u{1FB7E}":[{x:7,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"\u{1FB7F}":[{x:7,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"\u{1FB80}":[{x:0,y:0,w:8,h:1},{x:0,y:7,w:8,h:1}],"\u{1FB81}":[{x:0,y:0,w:8,h:1},{x:0,y:2,w:8,h:1},{x:0,y:4,w:8,h:1},{x:0,y:7,w:8,h:1}],"\u{1FB82}":[{x:0,y:0,w:8,h:2}],"\u{1FB83}":[{x:0,y:0,w:8,h:3}],"\u{1FB84}":[{x:0,y:0,w:8,h:5}],"\u{1FB85}":[{x:0,y:0,w:8,h:6}],"\u{1FB86}":[{x:0,y:0,w:8,h:7}],"\u{1FB87}":[{x:6,y:0,w:2,h:8}],"\u{1FB88}":[{x:5,y:0,w:3,h:8}],"\u{1FB89}":[{x:3,y:0,w:5,h:8}],"\u{1FB8A}":[{x:2,y:0,w:6,h:8}],"\u{1FB8B}":[{x:1,y:0,w:7,h:8}],"\u{1FB95}":[{x:0,y:0,w:2,h:2},{x:4,y:0,w:2,h:2},{x:2,y:2,w:2,h:2},{x:6,y:2,w:2,h:2},{x:0,y:4,w:2,h:2},{x:4,y:4,w:2,h:2},{x:2,y:6,w:2,h:2},{x:6,y:6,w:2,h:2}],"\u{1FB96}":[{x:2,y:0,w:2,h:2},{x:6,y:0,w:2,h:2},{x:0,y:2,w:2,h:2},{x:4,y:2,w:2,h:2},{x:2,y:4,w:2,h:2},{x:6,y:4,w:2,h:2},{x:0,y:6,w:2,h:2},{x:4,y:6,w:2,h:2}],"\u{1FB97}":[{x:0,y:2,w:8,h:2},{x:0,y:6,w:8,h:2}]},_3={"\u2591":[[1,0,0,0],[0,0,0,0],[0,0,1,0],[0,0,0,0]],"\u2592":[[1,0],[0,0],[0,1],[0,0]],"\u2593":[[0,1],[1,1],[1,0],[1,1]]},g3={"\u2500":{1:"M0,.5 L1,.5"},"\u2501":{3:"M0,.5 L1,.5"},"\u2502":{1:"M.5,0 L.5,1"},"\u2503":{3:"M.5,0 L.5,1"},"\u250C":{1:"M0.5,1 L.5,.5 L1,.5"},"\u250F":{3:"M0.5,1 L.5,.5 L1,.5"},"\u2510":{1:"M0,.5 L.5,.5 L.5,1"},"\u2513":{3:"M0,.5 L.5,.5 L.5,1"},"\u2514":{1:"M.5,0 L.5,.5 L1,.5"},"\u2517":{3:"M.5,0 L.5,.5 L1,.5"},"\u2518":{1:"M.5,0 L.5,.5 L0,.5"},"\u251B":{3:"M.5,0 L.5,.5 L0,.5"},"\u251C":{1:"M.5,0 L.5,1 M.5,.5 L1,.5"},"\u2523":{3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"\u2524":{1:"M.5,0 L.5,1 M.5,.5 L0,.5"},"\u252B":{3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"\u252C":{1:"M0,.5 L1,.5 M.5,.5 L.5,1"},"\u2533":{3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"\u2534":{1:"M0,.5 L1,.5 M.5,.5 L.5,0"},"\u253B":{3:"M0,.5 L1,.5 M.5,.5 L.5,0"},"\u253C":{1:"M0,.5 L1,.5 M.5,0 L.5,1"},"\u254B":{3:"M0,.5 L1,.5 M.5,0 L.5,1"},"\u2574":{1:"M.5,.5 L0,.5"},"\u2578":{3:"M.5,.5 L0,.5"},"\u2575":{1:"M.5,.5 L.5,0"},"\u2579":{3:"M.5,.5 L.5,0"},"\u2576":{1:"M.5,.5 L1,.5"},"\u257A":{3:"M.5,.5 L1,.5"},"\u2577":{1:"M.5,.5 L.5,1"},"\u257B":{3:"M.5,.5 L.5,1"},"\u2550":{1:(e,t)=>`M0,${.5-t} L1,${.5-t} M0,${.5+t} L1,${.5+t}`},"\u2551":{1:(e,t)=>`M${.5-e},0 L${.5-e},1 M${.5+e},0 L${.5+e},1`},"\u2552":{1:(e,t)=>`M.5,1 L.5,${.5-t} L1,${.5-t} M.5,${.5+t} L1,${.5+t}`},"\u2553":{1:(e,t)=>`M${.5-e},1 L${.5-e},.5 L1,.5 M${.5+e},.5 L${.5+e},1`},"\u2554":{1:(e,t)=>`M1,${.5-t} L${.5-e},${.5-t} L${.5-e},1 M1,${.5+t} L${.5+e},${.5+t} L${.5+e},1`},"\u2555":{1:(e,t)=>`M0,${.5-t} L.5,${.5-t} L.5,1 M0,${.5+t} L.5,${.5+t}`},"\u2556":{1:(e,t)=>`M${.5+e},1 L${.5+e},.5 L0,.5 M${.5-e},.5 L${.5-e},1`},"\u2557":{1:(e,t)=>`M0,${.5+t} L${.5-e},${.5+t} L${.5-e},1 M0,${.5-t} L${.5+e},${.5-t} L${.5+e},1`},"\u2558":{1:(e,t)=>`M.5,0 L.5,${.5+t} L1,${.5+t} M.5,${.5-t} L1,${.5-t}`},"\u2559":{1:(e,t)=>`M1,.5 L${.5-e},.5 L${.5-e},0 M${.5+e},.5 L${.5+e},0`},"\u255A":{1:(e,t)=>`M1,${.5-t} L${.5+e},${.5-t} L${.5+e},0 M1,${.5+t} L${.5-e},${.5+t} L${.5-e},0`},"\u255B":{1:(e,t)=>`M0,${.5+t} L.5,${.5+t} L.5,0 M0,${.5-t} L.5,${.5-t}`},"\u255C":{1:(e,t)=>`M0,.5 L${.5+e},.5 L${.5+e},0 M${.5-e},.5 L${.5-e},0`},"\u255D":{1:(e,t)=>`M0,${.5-t} L${.5-e},${.5-t} L${.5-e},0 M0,${.5+t} L${.5+e},${.5+t} L${.5+e},0`},"\u255E":{1:(e,t)=>`M.5,0 L.5,1 M.5,${.5-t} L1,${.5-t} M.5,${.5+t} L1,${.5+t}`},"\u255F":{1:(e,t)=>`M${.5-e},0 L${.5-e},1 M${.5+e},0 L${.5+e},1 M${.5+e},.5 L1,.5`},"\u2560":{1:(e,t)=>`M${.5-e},0 L${.5-e},1 M1,${.5+t} L${.5+e},${.5+t} L${.5+e},1 M1,${.5-t} L${.5+e},${.5-t} L${.5+e},0`},"\u2561":{1:(e,t)=>`M.5,0 L.5,1 M0,${.5-t} L.5,${.5-t} M0,${.5+t} L.5,${.5+t}`},"\u2562":{1:(e,t)=>`M0,.5 L${.5-e},.5 M${.5-e},0 L${.5-e},1 M${.5+e},0 L${.5+e},1`},"\u2563":{1:(e,t)=>`M${.5+e},0 L${.5+e},1 M0,${.5+t} L${.5-e},${.5+t} L${.5-e},1 M0,${.5-t} L${.5-e},${.5-t} L${.5-e},0`},"\u2564":{1:(e,t)=>`M0,${.5-t} L1,${.5-t} M0,${.5+t} L1,${.5+t} M.5,${.5+t} L.5,1`},"\u2565":{1:(e,t)=>`M0,.5 L1,.5 M${.5-e},.5 L${.5-e},1 M${.5+e},.5 L${.5+e},1`},"\u2566":{1:(e,t)=>`M0,${.5-t} L1,${.5-t} M0,${.5+t} L${.5-e},${.5+t} L${.5-e},1 M1,${.5+t} L${.5+e},${.5+t} L${.5+e},1`},"\u2567":{1:(e,t)=>`M.5,0 L.5,${.5-t} M0,${.5-t} L1,${.5-t} M0,${.5+t} L1,${.5+t}`},"\u2568":{1:(e,t)=>`M0,.5 L1,.5 M${.5-e},.5 L${.5-e},0 M${.5+e},.5 L${.5+e},0`},"\u2569":{1:(e,t)=>`M0,${.5+t} L1,${.5+t} M0,${.5-t} L${.5-e},${.5-t} L${.5-e},0 M1,${.5-t} L${.5+e},${.5-t} L${.5+e},0`},"\u256A":{1:(e,t)=>`M.5,0 L.5,1 M0,${.5-t} L1,${.5-t} M0,${.5+t} L1,${.5+t}`},"\u256B":{1:(e,t)=>`M0,.5 L1,.5 M${.5-e},0 L${.5-e},1 M${.5+e},0 L${.5+e},1`},"\u256C":{1:(e,t)=>`M0,${.5+t} L${.5-e},${.5+t} L${.5-e},1 M1,${.5+t} L${.5+e},${.5+t} L${.5+e},1 M0,${.5-t} L${.5-e},${.5-t} L${.5-e},0 M1,${.5-t} L${.5+e},${.5-t} L${.5+e},0`},"\u2571":{1:"M1,0 L0,1"},"\u2572":{1:"M0,0 L1,1"},"\u2573":{1:"M1,0 L0,1 M0,0 L1,1"},"\u257C":{1:"M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"\u257D":{1:"M.5,.5 L.5,0",3:"M.5,.5 L.5,1"},"\u257E":{1:"M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u257F":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"\u250D":{1:"M.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"\u250E":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2511":{1:"M.5,.5 L.5,1",3:"M.5,.5 L0,.5"},"\u2512":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"\u2515":{1:"M.5,.5 L.5,0",3:"M.5,.5 L1,.5"},"\u2516":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"\u2519":{1:"M.5,.5 L.5,0",3:"M.5,.5 L0,.5"},"\u251A":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,0"},"\u251D":{1:"M.5,0 L.5,1",3:"M.5,.5 L1,.5"},"\u251E":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"\u251F":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2520":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1"},"\u2521":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"\u2522":{1:"M.5,.5 L.5,0",3:"M0.5,1 L.5,.5 L1,.5"},"\u2525":{1:"M.5,0 L.5,1",3:"M.5,.5 L0,.5"},"\u2526":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"\u2527":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"\u2528":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1"},"\u2529":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L0,.5"},"\u252A":{1:"M.5,.5 L.5,0",3:"M0,.5 L.5,.5 L.5,1"},"\u252D":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u252E":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"\u252F":{1:"M.5,.5 L.5,1",3:"M0,.5 L1,.5"},"\u2530":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2531":{1:"M.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"\u2532":{1:"M.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"\u2535":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u2536":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"\u2537":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5"},"\u2538":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,0"},"\u2539":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"\u253A":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,.5 L1,.5"},"\u253D":{1:"M.5,0 L.5,1 M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u253E":{1:"M.5,0 L.5,1 M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"\u253F":{1:"M.5,0 L.5,1",3:"M0,.5 L1,.5"},"\u2540":{1:"M0,.5 L1,.5 M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"\u2541":{1:"M.5,.5 L.5,0 M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2542":{1:"M0,.5 L1,.5",3:"M.5,0 L.5,1"},"\u2543":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"\u2544":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"\u2545":{1:"M.5,0 L.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"\u2546":{1:"M.5,0 L.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"\u2547":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0 M0,.5 L1,.5"},"\u2548":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"\u2549":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"\u254A":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"\u254C":{1:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"\u254D":{3:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"\u2504":{1:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"\u2505":{3:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"\u2508":{1:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"\u2509":{3:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"\u254E":{1:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"\u254F":{3:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"\u2506":{1:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"\u2507":{3:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"\u250A":{1:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"\u250B":{3:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"\u256D":{1:(e,t)=>`M.5,1 L.5,${.5+t/.15*.5} C.5,${.5+t/.15*.5},.5,.5,1,.5`},"\u256E":{1:(e,t)=>`M.5,1 L.5,${.5+t/.15*.5} C.5,${.5+t/.15*.5},.5,.5,0,.5`},"\u256F":{1:(e,t)=>`M.5,0 L.5,${.5-t/.15*.5} C.5,${.5-t/.15*.5},.5,.5,0,.5`},"\u2570":{1:(e,t)=>`M.5,0 L.5,${.5-t/.15*.5} C.5,${.5-t/.15*.5},.5,.5,1,.5`}},qn={"\uE0A0":{d:"M.3,1 L.03,1 L.03,.88 C.03,.82,.06,.78,.11,.73 C.15,.7,.2,.68,.28,.65 L.43,.6 C.49,.58,.53,.56,.56,.53 C.59,.5,.6,.47,.6,.43 L.6,.27 L.4,.27 L.69,.1 L.98,.27 L.78,.27 L.78,.46 C.78,.52,.76,.56,.72,.61 C.68,.66,.63,.67,.56,.7 L.48,.72 C.42,.74,.38,.76,.35,.78 C.32,.8,.31,.84,.31,.88 L.31,1 M.3,.5 L.03,.59 L.03,.09 L.3,.09 L.3,.655",type:0},"\uE0A1":{d:"M.7,.4 L.7,.47 L.2,.47 L.2,.03 L.355,.03 L.355,.4 L.705,.4 M.7,.5 L.86,.5 L.86,.95 L.69,.95 L.44,.66 L.46,.86 L.46,.95 L.3,.95 L.3,.49 L.46,.49 L.71,.78 L.69,.565 L.69,.5",type:0},"\uE0A2":{d:"M.25,.94 C.16,.94,.11,.92,.11,.87 L.11,.53 C.11,.48,.15,.455,.23,.45 L.23,.3 C.23,.25,.26,.22,.31,.19 C.36,.16,.43,.15,.51,.15 C.59,.15,.66,.16,.71,.19 C.77,.22,.79,.26,.79,.3 L.79,.45 C.87,.45,.91,.48,.91,.53 L.91,.87 C.91,.92,.86,.94,.77,.94 L.24,.94 M.53,.2 C.49,.2,.45,.21,.42,.23 C.39,.25,.38,.27,.38,.3 L.38,.45 L.68,.45 L.68,.3 C.68,.27,.67,.25,.64,.23 C.61,.21,.58,.2,.53,.2 M.58,.82 L.58,.66 C.63,.65,.65,.63,.65,.6 C.65,.58,.64,.57,.61,.56 C.58,.55,.56,.54,.52,.54 C.48,.54,.46,.55,.43,.56 C.4,.57,.39,.59,.39,.6 C.39,.63,.41,.64,.46,.66 L.46,.82 L.57,.82",type:0},"\uE0B0":{d:"M0,0 L1,.5 L0,1",type:0,rightPadding:2},"\uE0B1":{d:"M-1,-.5 L1,.5 L-1,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0B2":{d:"M1,0 L0,.5 L1,1",type:0,leftPadding:2},"\uE0B3":{d:"M2,-.5 L0,.5 L2,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0B4":{d:"M0,0 L0,1 C0.552,1,1,0.776,1,.5 C1,0.224,0.552,0,0,0",type:0,rightPadding:1},"\uE0B5":{d:"M.2,1 C.422,1,.8,.826,.78,.5 C.8,.174,0.422,0,.2,0",type:1,rightPadding:1},"\uE0B6":{d:"M1,0 L1,1 C0.448,1,0,0.776,0,.5 C0,0.224,0.448,0,1,0",type:0,leftPadding:1},"\uE0B7":{d:"M.8,1 C0.578,1,0.2,.826,.22,.5 C0.2,0.174,0.578,0,0.8,0",type:1,leftPadding:1},"\uE0B8":{d:"M-.5,-.5 L1.5,1.5 L-.5,1.5",type:0},"\uE0B9":{d:"M-.5,-.5 L1.5,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0BA":{d:"M1.5,-.5 L-.5,1.5 L1.5,1.5",type:0},"\uE0BC":{d:"M1.5,-.5 L-.5,1.5 L-.5,-.5",type:0},"\uE0BD":{d:"M1.5,-.5 L-.5,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0BE":{d:"M-.5,-.5 L1.5,1.5 L1.5,-.5",type:0}};qn["\uE0BB"]=qn["\uE0BD"];qn["\uE0BF"]=qn["\uE0B9"];function p3(e,t,i,r,s,n,o,a){let h=f3[t];if(h)return v3(e,h,i,r,s,n),!0;let l=_3[t];if(l)return m3(e,l,i,r,s,n),!0;let c=g3[t];if(c)return y3(e,c,i,r,s,n,a),!0;let u=qn[t];return u?(b3(e,u,i,r,s,n,o,a),!0):!1}function v3(e,t,i,r,s,n){for(let o=0;o<t.length;o++){let a=t[o],h=s/8,l=n/8;e.fillRect(i+a.x*h,r+a.y*l,a.w*h,a.h*l)}}var ym=new Map;function m3(e,t,i,r,s,n){let o=ym.get(t);o||(o=new Map,ym.set(t,o));let a=e.fillStyle;if(typeof a!="string")throw new Error(`Unexpected fillStyle type "${a}"`);let h=o.get(a);if(!h){let l=t[0].length,c=t.length,u=e.canvas.ownerDocument.createElement("canvas");u.width=l,u.height=c;let p=Ne(u.getContext("2d")),g=new ImageData(l,c),v,m,x,E;if(a.startsWith("#"))v=parseInt(a.slice(1,3),16),m=parseInt(a.slice(3,5),16),x=parseInt(a.slice(5,7),16),E=a.length>7&&parseInt(a.slice(7,9),16)||1;else if(a.startsWith("rgba"))[v,m,x,E]=a.substring(5,a.length-1).split(",").map(R=>parseFloat(R));else throw new Error(`Unexpected fillStyle color format "${a}" when drawing pattern glyph`);for(let R=0;R<c;R++)for(let D=0;D<l;D++)g.data[(R*l+D)*4]=v,g.data[(R*l+D)*4+1]=m,g.data[(R*l+D)*4+2]=x,g.data[(R*l+D)*4+3]=t[R][D]*(E*255);p.putImageData(g,0,0),h=Ne(e.createPattern(u,null)),o.set(a,h)}e.fillStyle=h,e.fillRect(i,r,s,n)}function y3(e,t,i,r,s,n,o){e.strokeStyle=e.fillStyle;for(let[a,h]of Object.entries(t)){e.beginPath(),e.lineWidth=o*Number.parseInt(a);let l;if(typeof h=="function"){let c=.15/n*s;l=h(.15,c)}else l=h;for(let c of l.split(" ")){let u=c[0],p=h1[u];if(!p){console.error(`Could not find drawing instructions for "${u}"`);continue}let g=c.substring(1).split(",");!g[0]||!g[1]||p(e,c1(g,s,n,i,r,!0,o))}e.stroke(),e.closePath()}}function b3(e,t,i,r,s,n,o,a){let h=new Path2D;h.rect(i,r,s,n),e.clip(h),e.beginPath();let l=o/12;e.lineWidth=a*l;for(let c of t.d.split(" ")){let u=c[0],p=h1[u];if(!p){console.error(`Could not find drawing instructions for "${u}"`);continue}let g=c.substring(1).split(",");!g[0]||!g[1]||p(e,c1(g,s,n,i,r,!1,a,(t.leftPadding??0)*(l/2),(t.rightPadding??0)*(l/2)))}t.type===1?(e.strokeStyle=e.fillStyle,e.stroke()):e.fill(),e.closePath()}function bm(e,t,i=0){return Math.max(Math.min(e,t),i)}var h1={C:(e,t)=>e.bezierCurveTo(t[0],t[1],t[2],t[3],t[4],t[5]),L:(e,t)=>e.lineTo(t[0],t[1]),M:(e,t)=>e.moveTo(t[0],t[1])};function c1(e,t,i,r,s,n,o,a=0,h=0){let l=e.map(c=>parseFloat(c)||parseInt(c));if(l.length<2)throw new Error("Too few arguments for instruction");for(let c=0;c<l.length;c+=2)l[c]*=t-a*o-h*o,n&&l[c]!==0&&(l[c]=bm(Math.round(l[c]+.5)-.5,t,0)),l[c]+=r+a*o;for(let c=1;c<l.length;c+=2)l[c]*=i,n&&l[c]!==0&&(l[c]=bm(Math.round(l[c]+.5)-.5,i,0)),l[c]+=s;return l}var wm=class{constructor(){this._data={}}set(e,t,i){this._data[e]||(this._data[e]={}),this._data[e][t]=i}get(e,t){return this._data[e]?this._data[e][t]:void 0}clear(){this._data={}}},Am=class{constructor(){this._data=new wm}set(e,t,i,r,s){this._data.get(e,t)||this._data.set(e,t,new wm),this._data.get(e,t).set(i,r,s)}get(e,t,i,r){return this._data.get(e,t)?.get(i,r)}clear(){this._data.clear()}},u1=class{constructor(){this._tasks=[],this._i=0}enqueue(e){this._tasks.push(e),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(e){this._idleCallback=void 0;let t=0,i=0,r=e.timeRemaining(),s=0;for(;this._i<this._tasks.length;){if(t=performance.now(),this._tasks[this._i]()||this._i++,t=Math.max(1,performance.now()-t),i=Math.max(t,i),s=e.timeRemaining(),i*1.5>s){r-t<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(r-t))}ms`),this._start();return}r=s}this.clear()}},w3=class extends u1{_requestCallback(e){return setTimeout(()=>e(this._createDeadline(16)))}_cancelCallback(e){clearTimeout(e)}_createDeadline(e){let t=performance.now()+e;return{timeRemaining:()=>Math.max(0,t-performance.now())}}},A3=class extends u1{_requestCallback(e){return requestIdleCallback(e)}_cancelCallback(e){cancelIdleCallback(e)}},x3=!qu&&"requestIdleCallback"in window?A3:w3,bs=class d1{constructor(){this.fg=0,this.bg=0,this.extended=new f1}static toColorRGB(t){return[t>>>16&255,t>>>8&255,t&255]}static fromColorRGB(t){return(t[0]&255)<<16|(t[1]&255)<<8|t[2]&255}clone(){let t=new d1;return t.fg=this.fg,t.bg=this.bg,t.extended=this.extended.clone(),t}isInverse(){return this.fg&67108864}isBold(){return this.fg&134217728}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:this.fg&268435456}isBlink(){return this.fg&536870912}isInvisible(){return this.fg&1073741824}isItalic(){return this.bg&67108864}isDim(){return this.bg&134217728}isStrikethrough(){return this.fg&2147483648}isProtected(){return this.bg&536870912}isOverline(){return this.bg&1073741824}getFgColorMode(){return this.fg&50331648}getBgColorMode(){return this.bg&50331648}isFgRGB(){return(this.fg&50331648)===50331648}isBgRGB(){return(this.bg&50331648)===50331648}isFgPalette(){return(this.fg&50331648)===16777216||(this.fg&50331648)===33554432}isBgPalette(){return(this.bg&50331648)===16777216||(this.bg&50331648)===33554432}isFgDefault(){return(this.fg&50331648)===0}isBgDefault(){return(this.bg&50331648)===0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(this.fg&50331648){case 16777216:case 33554432:return this.fg&255;case 50331648:return this.fg&16777215;default:return-1}}getBgColor(){switch(this.bg&50331648){case 16777216:case 33554432:return this.bg&255;case 50331648:return this.bg&16777215;default:return-1}}hasExtendedAttrs(){return this.bg&268435456}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(this.bg&268435456&&~this.extended.underlineColor)switch(this.extended.underlineColor&50331648){case 16777216:case 33554432:return this.extended.underlineColor&255;case 50331648:return this.extended.underlineColor&16777215;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return this.bg&268435456&&~this.extended.underlineColor?this.extended.underlineColor&50331648:this.getFgColorMode()}isUnderlineColorRGB(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===50331648:this.isFgRGB()}isUnderlineColorPalette(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===16777216||(this.extended.underlineColor&50331648)===33554432:this.isFgPalette()}isUnderlineColorDefault(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===0:this.isFgDefault()}getUnderlineStyle(){return this.fg&268435456?this.bg&268435456?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}},f1=class _1{constructor(t=0,i=0){this._ext=0,this._urlId=0,this._ext=t,this._urlId=i}get ext(){return this._urlId?this._ext&-469762049|this.underlineStyle<<26:this._ext}set ext(t){this._ext=t}get underlineStyle(){return this._urlId?5:(this._ext&469762048)>>26}set underlineStyle(t){this._ext&=-469762049,this._ext|=t<<26&469762048}get underlineColor(){return this._ext&67108863}set underlineColor(t){this._ext&=-67108864,this._ext|=t&67108863}get urlId(){return this._urlId}set urlId(t){this._urlId=t}get underlineVariantOffset(){let t=(this._ext&3758096384)>>29;return t<0?t^4294967288:t}set underlineVariantOffset(t){this._ext&=536870911,this._ext|=t<<29&3758096384}clone(){return new _1(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}},xm=class Hu{constructor(t){this.element=t,this.next=Hu.Undefined,this.prev=Hu.Undefined}};xm.Undefined=new xm(void 0);var S3=globalThis.performance&&typeof globalThis.performance.now=="function",C3=class g1{static create(t){return new g1(t)}constructor(t){this._now=S3&&t===!1?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}},k3=!1,Sm=!1,E3=!1,Ki;(e=>{e.None=()=>It.None;function t(C){if(E3){let{onDidAddListener:w}=C,k=zu.create(),f=0;C.onDidAddListener=()=>{++f===2&&(console.warn("snapshotted emitter LIKELY used public and SHOULD HAVE BEEN created with DisposableStore. snapshotted here"),k.print()),w?.()}}}function i(C,w){return p(C,()=>{},0,void 0,!0,void 0,w)}e.defer=i;function r(C){return(w,k=null,f)=>{let d=!1,_;return _=C(y=>{if(!d)return _?_.dispose():d=!0,w.call(k,y)},null,f),d&&_.dispose(),_}}e.once=r;function s(C,w,k){return c((f,d=null,_)=>C(y=>f.call(d,w(y)),null,_),k)}e.map=s;function n(C,w,k){return c((f,d=null,_)=>C(y=>{w(y),f.call(d,y)},null,_),k)}e.forEach=n;function o(C,w,k){return c((f,d=null,_)=>C(y=>w(y)&&f.call(d,y),null,_),k)}e.filter=o;function a(C){return C}e.signal=a;function h(...C){return(w,k=null,f)=>{let d=r1(...C.map(_=>_(y=>w.call(k,y))));return u(d,f)}}e.any=h;function l(C,w,k,f){let d=k;return s(C,_=>(d=w(d,_),d),f)}e.reduce=l;function c(C,w){let k,f={onWillAddFirstListener(){k=C(d.fire,d)},onDidRemoveLastListener(){k?.dispose()}};w||t(f);let d=new pe(f);return w?.add(d),d.event}function u(C,w){return w instanceof Array?w.push(C):w&&w.add(C),C}function p(C,w,k=100,f=!1,d=!1,_,y){let A,S,F,U=0,W,z={leakWarningThreshold:_,onWillAddFirstListener(){A=C(ee=>{U++,S=w(S,ee),f&&!F&&(J.fire(S),S=void 0),W=()=>{let ue=S;S=void 0,F=void 0,(!f||U>1)&&J.fire(ue),U=0},typeof k=="number"?(clearTimeout(F),F=setTimeout(W,k)):F===void 0&&(F=0,queueMicrotask(W))})},onWillRemoveListener(){d&&U>0&&W?.()},onDidRemoveLastListener(){W=void 0,A.dispose()}};y||t(z);let J=new pe(z);return y?.add(J),J.event}e.debounce=p;function g(C,w=0,k){return e.debounce(C,(f,d)=>f?(f.push(d),f):[d],w,void 0,!0,void 0,k)}e.accumulate=g;function v(C,w=(f,d)=>f===d,k){let f=!0,d;return o(C,_=>{let y=f||!w(_,d);return f=!1,d=_,y},k)}e.latch=v;function m(C,w,k){return[e.filter(C,w,k),e.filter(C,f=>!w(f),k)]}e.split=m;function x(C,w=!1,k=[],f){let d=k.slice(),_=C(S=>{d?d.push(S):A.fire(S)});f&&f.add(_);let y=()=>{d?.forEach(S=>A.fire(S)),d=null},A=new pe({onWillAddFirstListener(){_||(_=C(S=>A.fire(S)),f&&f.add(_))},onDidAddFirstListener(){d&&(w?setTimeout(y):y())},onDidRemoveLastListener(){_&&_.dispose(),_=null}});return f&&f.add(A),A.event}e.buffer=x;function E(C,w){return(k,f,d)=>{let _=w(new D);return C(function(y){let A=_.evaluate(y);A!==R&&k.call(f,A)},void 0,d)}}e.chain=E;let R=Symbol("HaltChainable");class D{constructor(){this.steps=[]}map(w){return this.steps.push(w),this}forEach(w){return this.steps.push(k=>(w(k),k)),this}filter(w){return this.steps.push(k=>w(k)?k:R),this}reduce(w,k){let f=k;return this.steps.push(d=>(f=w(f,d),f)),this}latch(w=(k,f)=>k===f){let k=!0,f;return this.steps.push(d=>{let _=k||!w(d,f);return k=!1,f=d,_?d:R}),this}evaluate(w){for(let k of this.steps)if(w=k(w),w===R)break;return w}}function b(C,w,k=f=>f){let f=(...A)=>y.fire(k(...A)),d=()=>C.on(w,f),_=()=>C.removeListener(w,f),y=new pe({onWillAddFirstListener:d,onDidRemoveLastListener:_});return y.event}e.fromNodeEventEmitter=b;function L(C,w,k=f=>f){let f=(...A)=>y.fire(k(...A)),d=()=>C.addEventListener(w,f),_=()=>C.removeEventListener(w,f),y=new pe({onWillAddFirstListener:d,onDidRemoveLastListener:_});return y.event}e.fromDOMEventEmitter=L;function I(C){return new Promise(w=>r(C)(w))}e.toPromise=I;function T(C){let w=new pe;return C.then(k=>{w.fire(k)},()=>{w.fire(void 0)}).finally(()=>{w.dispose()}),w.event}e.fromPromise=T;function q(C,w){return C(k=>w.fire(k))}e.forward=q;function $(C,w,k){return w(k),C(f=>w(f))}e.runAndSubscribe=$;class V{constructor(w,k){this._observable=w,this._counter=0,this._hasChanged=!1;let f={onWillAddFirstListener:()=>{w.addObserver(this)},onDidRemoveLastListener:()=>{w.removeObserver(this)}};k||t(f),this.emitter=new pe(f),k&&k.add(this.emitter)}beginUpdate(w){this._counter++}handlePossibleChange(w){}handleChange(w,k){this._hasChanged=!0}endUpdate(w){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}function j(C,w){return new V(C,w).emitter.event}e.fromObservable=j;function ne(C){return(w,k,f)=>{let d=0,_=!1,y={beginUpdate(){d++},endUpdate(){d--,d===0&&(C.reportChanges(),_&&(_=!1,w.call(k)))},handlePossibleChange(){},handleChange(){_=!0}};C.addObserver(y),C.reportChanges();let A={dispose(){C.removeObserver(y)}};return f instanceof As?f.add(A):Array.isArray(f)&&f.push(A),A}}e.fromObservableLight=ne})(Ki||={});var Xu=class Uu{constructor(t){this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name=`${t}_${Uu._idPool++}`,Uu.all.add(this)}start(t){this._stopWatch=new C3,this.listenerCount=t}stop(){if(this._stopWatch){let t=this._stopWatch.elapsed();this.durations.push(t),this.elapsedOverall+=t,this.invocationCount+=1,this._stopWatch=void 0}}};Xu.all=new Set,Xu._idPool=0;var B3=Xu,Cm=-1,p1=class v1{constructor(t,i,r=(v1._idPool++).toString(16).padStart(3,"0")){this._errorHandler=t,this.threshold=i,this.name=r,this._warnCountdown=0}dispose(){this._stacks?.clear()}check(t,i){let r=this.threshold;if(r<=0||i<r)return;this._stacks||(this._stacks=new Map);let s=this._stacks.get(t.value)||0;if(this._stacks.set(t.value,s+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=r*.5;let[n,o]=this.getMostFrequentStack(),a=`[${this.name}] potential listener LEAK detected, having ${i} listeners already. MOST frequent listener (${o}):`;console.warn(a),console.warn(n);let h=new D3(a,n);this._errorHandler(h)}return()=>{let n=this._stacks.get(t.value)||0;this._stacks.set(t.value,n-1)}}getMostFrequentStack(){if(!this._stacks)return;let t,i=0;for(let[r,s]of this._stacks)(!t||i<s)&&(t=[r,s],i=s);return t}};p1._idPool=1;var L3=p1,zu=class m1{constructor(t){this.value=t}static create(){let t=new Error;return new m1(t.stack??"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},D3=class extends Error{constructor(e,t){super(e),this.name="ListenerLeakError",this.stack=t}},I3=class extends Error{constructor(e,t){super(e),this.name="ListenerRefusalError",this.stack=t}},M3=0,Va=class{constructor(e){this.value=e,this.id=M3++}},T3=2,R3=(e,t)=>{if(e instanceof Va)t(e);else for(let i=0;i<e.length;i++){let r=e[i];r&&t(r)}},Ya;if(k3){let e=[];setInterval(()=>{e.length!==0&&(console.warn("[LEAKING LISTENERS] GC'ed these listeners that were NOT yet disposed:"),console.warn(e.join(`
`)),e.length=0)},3e3),Ya=new FinalizationRegistry(t=>{typeof t=="string"&&e.push(t)})}var pe=class{constructor(e){this._size=0,this._options=e,this._leakageMon=Cm>0||this._options?.leakWarningThreshold?new L3(e?.onListenerError??qa,this._options?.leakWarningThreshold??Cm):void 0,this._perfMon=this._options?._profName?new B3(this._options._profName):void 0,this._deliveryQueue=this._options?.deliveryQueue}dispose(){if(!this._disposed){if(this._disposed=!0,this._deliveryQueue?.current===this&&this._deliveryQueue.reset(),this._listeners){if(Sm){let e=this._listeners;queueMicrotask(()=>{R3(e,t=>t.stack?.print())})}this._listeners=void 0,this._size=0}this._options?.onDidRemoveLastListener?.(),this._leakageMon?.dispose()}}get event(){return this._event??=(e,t,i)=>{if(this._leakageMon&&this._size>this._leakageMon.threshold**2){let a=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(a);let h=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],l=new I3(`${a}. HINT: Stack shows most frequent listener (${h[1]}-times)`,h[0]);return(this._options?.onListenerError||qa)(l),It.None}if(this._disposed)return It.None;t&&(e=e.bind(t));let r=new Va(e),s,n;this._leakageMon&&this._size>=Math.ceil(this._leakageMon.threshold*.2)&&(r.stack=zu.create(),s=this._leakageMon.check(r.stack,this._size+1)),Sm&&(r.stack=n??zu.create()),this._listeners?this._listeners instanceof Va?(this._deliveryQueue??=new F3,this._listeners=[this._listeners,r]):this._listeners.push(r):(this._options?.onWillAddFirstListener?.(this),this._listeners=r,this._options?.onDidAddFirstListener?.(this)),this._size++;let o=nt(()=>{Ya?.unregister(o),s?.(),this._removeListener(r)});if(i instanceof As?i.add(o):Array.isArray(i)&&i.push(o),Ya){let a=new Error().stack.split(`
`).slice(2,3).join(`
`).trim(),h=/(file:|vscode-file:\/\/vscode-app)?(\/[^:]*:\d+:\d+)/.exec(a);Ya.register(o,h?.[2]??a,o)}return o},this._event}_removeListener(e){if(this._options?.onWillRemoveListener?.(this),!this._listeners)return;if(this._size===1){this._listeners=void 0,this._options?.onDidRemoveLastListener?.(this),this._size=0;return}let t=this._listeners,i=t.indexOf(e);if(i===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),new Error("Attempted to dispose unknown listener");this._size--,t[i]=void 0;let r=this._deliveryQueue.current===this;if(this._size*T3<=t.length){let s=0;for(let n=0;n<t.length;n++)t[n]?t[s++]=t[n]:r&&(this._deliveryQueue.end--,s<this._deliveryQueue.i&&this._deliveryQueue.i--);t.length=s}}_deliver(e,t){if(!e)return;let i=this._options?.onListenerError||qa;if(!i){e.value(t);return}try{e.value(t)}catch(r){i(r)}}_deliverQueue(e){let t=e.current._listeners;for(;e.i<e.end;)this._deliver(t[e.i++],e.value);e.reset()}fire(e){if(this._deliveryQueue?.current&&(this._deliverQueue(this._deliveryQueue),this._perfMon?.stop()),this._perfMon?.start(this._size),this._listeners)if(this._listeners instanceof Va)this._deliver(this._listeners,e);else{let t=this._deliveryQueue;t.enqueue(this,e,this._listeners.length),this._deliverQueue(t)}this._perfMon?.stop()}hasListeners(){return this._size>0}},F3=class{constructor(){this.i=-1,this.end=0}enqueue(e,t,i){this.i=0,this.end=i,this.current=e,this.value=t}reset(){this.i=this.end,this.current=void 0,this.value=void 0}},km={texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},offset:{x:0,y:0},size:{x:0,y:0},sizeClipSpace:{x:0,y:0}},Un=2,zn,vr=class ys{constructor(t,i,r){this._document=t,this._config=i,this._unicodeService=r,this._didWarmUp=!1,this._cacheMap=new Am,this._cacheMapCombined=new Am,this._pages=[],this._activePages=[],this._workBoundingBox={top:0,left:0,bottom:0,right:0},this._workAttributeData=new bs,this._textureSize=512,this._onAddTextureAtlasCanvas=new pe,this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=new pe,this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._requestClearModel=!1,this._createNewPage(),this._tmpCanvas=y1(t,this._config.deviceCellWidth*4+Un*2,this._config.deviceCellHeight+Un*2),this._tmpCtx=Ne(this._tmpCanvas.getContext("2d",{alpha:this._config.allowTransparency,willReadFrequently:!0}))}get pages(){return this._pages}dispose(){this._tmpCanvas.remove();for(let t of this.pages)t.canvas.remove();this._onAddTextureAtlasCanvas.dispose()}warmUp(){this._didWarmUp||(this._doWarmUp(),this._didWarmUp=!0)}_doWarmUp(){let t=new x3;for(let i=33;i<126;i++)t.enqueue(()=>{if(!this._cacheMap.get(i,0,0,0)){let r=this._drawToCache(i,0,0,0,!1,void 0);this._cacheMap.set(i,0,0,0,r)}})}beginFrame(){return this._requestClearModel}clearTexture(){if(!(this._pages[0].currentRow.x===0&&this._pages[0].currentRow.y===0)){for(let t of this._pages)t.clear();this._cacheMap.clear(),this._cacheMapCombined.clear(),this._didWarmUp=!1}}_createNewPage(){if(ys.maxAtlasPages&&this._pages.length>=Math.max(4,ys.maxAtlasPages)){let i=this._pages.filter(l=>l.canvas.width*2<=(ys.maxTextureSize||4096)).sort((l,c)=>c.canvas.width!==l.canvas.width?c.canvas.width-l.canvas.width:c.percentageUsed-l.percentageUsed),r=-1,s=0;for(let l=0;l<i.length;l++)if(i[l].canvas.width!==s)r=l,s=i[l].canvas.width;else if(l-r===3)break;let n=i.slice(r,r+4),o=n.map(l=>l.glyphs[0].texturePage).sort((l,c)=>l>c?1:-1),a=this.pages.length-n.length,h=this._mergePages(n,a);h.version++;for(let l=o.length-1;l>=0;l--)this._deletePage(o[l]);this.pages.push(h),this._requestClearModel=!0,this._onAddTextureAtlasCanvas.fire(h.canvas)}let t=new Cu(this._document,this._textureSize);return this._pages.push(t),this._activePages.push(t),this._onAddTextureAtlasCanvas.fire(t.canvas),t}_mergePages(t,i){let r=t[0].canvas.width*2,s=new Cu(this._document,r,t);for(let[n,o]of t.entries()){let a=n*o.canvas.width%r,h=Math.floor(n/2)*o.canvas.height;s.ctx.drawImage(o.canvas,a,h);for(let c of o.glyphs)c.texturePage=i,c.sizeClipSpace.x=c.size.x/r,c.sizeClipSpace.y=c.size.y/r,c.texturePosition.x+=a,c.texturePosition.y+=h,c.texturePositionClipSpace.x=c.texturePosition.x/r,c.texturePositionClipSpace.y=c.texturePosition.y/r;this._onRemoveTextureAtlasCanvas.fire(o.canvas);let l=this._activePages.indexOf(o);l!==-1&&this._activePages.splice(l,1)}return s}_deletePage(t){this._pages.splice(t,1);for(let i=t;i<this._pages.length;i++){let r=this._pages[i];for(let s of r.glyphs)s.texturePage--;r.version++}}getRasterizedGlyphCombinedChar(t,i,r,s,n,o){return this._getFromCacheMap(this._cacheMapCombined,t,i,r,s,n,o)}getRasterizedGlyph(t,i,r,s,n,o){return this._getFromCacheMap(this._cacheMap,t,i,r,s,n,o)}_getFromCacheMap(t,i,r,s,n,o,a){return zn=t.get(i,r,s,n),zn||(zn=this._drawToCache(i,r,s,n,o,a),t.set(i,r,s,n,zn)),zn}_getColorFromAnsiIndex(t){if(t>=this._config.colors.ansi.length)throw new Error("No color found for idx "+t);return this._config.colors.ansi[t]}_getBackgroundColor(t,i,r,s){if(this._config.allowTransparency)return Ut;let n;switch(t){case 16777216:case 33554432:n=this._getColorFromAnsiIndex(i);break;case 50331648:let o=bs.toColorRGB(i);n=mt.toColor(o[0],o[1],o[2]);break;case 0:default:r?n=Gn.opaque(this._config.colors.foreground):n=this._config.colors.background;break}return this._config.allowTransparency||(n=Gn.opaque(n)),n}_getForegroundColor(t,i,r,s,n,o,a,h,l,c){let u=this._getMinimumContrastColor(t,i,r,s,n,o,a,l,h,c);if(u)return u;let p;switch(n){case 16777216:case 33554432:this._config.drawBoldTextInBrightColors&&l&&o<8&&(o+=8),p=this._getColorFromAnsiIndex(o);break;case 50331648:let g=bs.toColorRGB(o);p=mt.toColor(g[0],g[1],g[2]);break;case 0:default:a?p=this._config.colors.background:p=this._config.colors.foreground}return this._config.allowTransparency&&(p=Gn.opaque(p)),h&&(p=Gn.multiplyOpacity(p,d3)),p}_resolveBackgroundRgba(t,i,r){switch(t){case 16777216:case 33554432:return this._getColorFromAnsiIndex(i).rgba;case 50331648:return i<<8;case 0:default:return r?this._config.colors.foreground.rgba:this._config.colors.background.rgba}}_resolveForegroundRgba(t,i,r,s){switch(t){case 16777216:case 33554432:return this._config.drawBoldTextInBrightColors&&s&&i<8&&(i+=8),this._getColorFromAnsiIndex(i).rgba;case 50331648:return i<<8;case 0:default:return r?this._config.colors.background.rgba:this._config.colors.foreground.rgba}}_getMinimumContrastColor(t,i,r,s,n,o,a,h,l,c){if(this._config.minimumContrastRatio===1||c)return;let u=this._getContrastCache(l),p=u.getColor(t,s);if(p!==void 0)return p||void 0;let g=this._resolveBackgroundRgba(i,r,a),v=this._resolveForegroundRgba(n,o,a,h),m=Wr.ensureContrastRatio(g,v,this._config.minimumContrastRatio/(l?2:1));if(!m){u.setColor(t,s,null);return}let x=mt.toColor(m>>24&255,m>>16&255,m>>8&255);return u.setColor(t,s,x),x}_getContrastCache(t){return t?this._config.colors.halfContrastCache:this._config.colors.contrastCache}_drawToCache(t,i,r,s,n,o){let a=typeof t=="number"?String.fromCharCode(t):t;o&&this._tmpCanvas.parentElement!==o&&(this._tmpCanvas.style.display="none",o.append(this._tmpCanvas));let h=Math.min(this._config.deviceCellWidth*Math.max(a.length,2)+Un*2,this._config.deviceMaxTextureSize);this._tmpCanvas.width<h&&(this._tmpCanvas.width=h);let l=Math.min(this._config.deviceCellHeight+Un*4,this._textureSize);if(this._tmpCanvas.height<l&&(this._tmpCanvas.height=l),this._tmpCtx.save(),this._workAttributeData.fg=r,this._workAttributeData.bg=i,this._workAttributeData.extended.ext=s,!!this._workAttributeData.isInvisible())return km;let c=!!this._workAttributeData.isBold(),u=!!this._workAttributeData.isInverse(),p=!!this._workAttributeData.isDim(),g=!!this._workAttributeData.isItalic(),v=!!this._workAttributeData.isUnderline(),m=!!this._workAttributeData.isStrikethrough(),x=!!this._workAttributeData.isOverline(),E=this._workAttributeData.getFgColor(),R=this._workAttributeData.getFgColorMode(),D=this._workAttributeData.getBgColor(),b=this._workAttributeData.getBgColorMode();if(u){let A=E;E=D,D=A;let S=R;R=b,b=S}let L=this._getBackgroundColor(b,D,u,p);this._tmpCtx.globalCompositeOperation="copy",this._tmpCtx.fillStyle=L.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.globalCompositeOperation="source-over";let I=c?this._config.fontWeightBold:this._config.fontWeight,T=g?"italic":"";this._tmpCtx.font=`${T} ${I} ${this._config.fontSize*this._config.devicePixelRatio}px ${this._config.fontFamily}`,this._tmpCtx.textBaseline=l1;let q=a.length===1&&Yu(a.charCodeAt(0)),$=a.length===1&&s3(a.charCodeAt(0)),V=this._getForegroundColor(i,b,D,r,R,E,u,p,c,a1(a.charCodeAt(0)));this._tmpCtx.fillStyle=V.css;let j=$?0:Un*2,ne=!1;this._config.customGlyphs!==!1&&(ne=p3(this._tmpCtx,a,j,j,this._config.deviceCellWidth,this._config.deviceCellHeight,this._config.fontSize,this._config.devicePixelRatio));let C=!q,w;if(typeof t=="number"?w=this._unicodeService.wcwidth(t):w=this._unicodeService.getStringCellWidth(t),v){this._tmpCtx.save();let A=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),S=A%2===1?.5:0;if(this._tmpCtx.lineWidth=A,this._workAttributeData.isUnderlineColorDefault())this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle;else if(this._workAttributeData.isUnderlineColorRGB())C=!1,this._tmpCtx.strokeStyle=`rgb(${bs.toColorRGB(this._workAttributeData.getUnderlineColor()).join(",")})`;else{C=!1;let ee=this._workAttributeData.getUnderlineColor();this._config.drawBoldTextInBrightColors&&this._workAttributeData.isBold()&&ee<8&&(ee+=8),this._tmpCtx.strokeStyle=this._getColorFromAnsiIndex(ee).css}this._tmpCtx.beginPath();let F=j,U=Math.ceil(j+this._config.deviceCharHeight)-S-(n?A*2:0),W=U+A,z=U+A*2,J=this._workAttributeData.getUnderlineVariantOffset();for(let ee=0;ee<w;ee++){this._tmpCtx.save();let ue=F+ee*this._config.deviceCellWidth,Be=F+(ee+1)*this._config.deviceCellWidth,Wi=ue+this._config.deviceCellWidth/2;switch(this._workAttributeData.extended.underlineStyle){case 2:this._tmpCtx.moveTo(ue,U),this._tmpCtx.lineTo(Be,U),this._tmpCtx.moveTo(ue,z),this._tmpCtx.lineTo(Be,z);break;case 3:let Jt=A<=1?z:Math.ceil(j+this._config.deviceCharHeight-A/2)-S,xt=A<=1?U:Math.ceil(j+this._config.deviceCharHeight+A/2)-S,de=new Path2D;de.rect(ue,U,this._config.deviceCellWidth,z-U),this._tmpCtx.clip(de),this._tmpCtx.moveTo(ue-this._config.deviceCellWidth/2,W),this._tmpCtx.bezierCurveTo(ue-this._config.deviceCellWidth/2,xt,ue,xt,ue,W),this._tmpCtx.bezierCurveTo(ue,Jt,Wi,Jt,Wi,W),this._tmpCtx.bezierCurveTo(Wi,xt,Be,xt,Be,W),this._tmpCtx.bezierCurveTo(Be,Jt,Be+this._config.deviceCellWidth/2,Jt,Be+this._config.deviceCellWidth/2,W);break;case 4:let $i=J===0?0:J>=A?A*2-J:A-J;J>=A||$i===0?(this._tmpCtx.setLineDash([Math.round(A),Math.round(A)]),this._tmpCtx.moveTo(ue+$i,U),this._tmpCtx.lineTo(Be,U)):(this._tmpCtx.setLineDash([Math.round(A),Math.round(A)]),this._tmpCtx.moveTo(ue,U),this._tmpCtx.lineTo(ue+$i,U),this._tmpCtx.moveTo(ue+$i+A,U),this._tmpCtx.lineTo(Be,U)),J=c3(Be-ue,A,J);break;case 5:let Yy=.6,Jy=.3,Ll=Be-ue,Hd=Math.floor(Yy*Ll),Xd=Math.floor(Jy*Ll),Zy=Ll-Hd-Xd;this._tmpCtx.setLineDash([Hd,Xd,Zy]),this._tmpCtx.moveTo(ue,U),this._tmpCtx.lineTo(Be,U);break;case 1:default:this._tmpCtx.moveTo(ue,U),this._tmpCtx.lineTo(Be,U);break}this._tmpCtx.stroke(),this._tmpCtx.restore()}if(this._tmpCtx.restore(),!ne&&this._config.fontSize>=12&&!this._config.allowTransparency&&a!==" "){this._tmpCtx.save(),this._tmpCtx.textBaseline="alphabetic";let ee=this._tmpCtx.measureText(a);if(this._tmpCtx.restore(),"actualBoundingBoxDescent"in ee&&ee.actualBoundingBoxDescent>0){this._tmpCtx.save();let ue=new Path2D;ue.rect(F,U-Math.ceil(A/2),this._config.deviceCellWidth*w,z-U+Math.ceil(A/2)),this._tmpCtx.clip(ue),this._tmpCtx.lineWidth=this._config.devicePixelRatio*3,this._tmpCtx.strokeStyle=L.css,this._tmpCtx.strokeText(a,j,j+this._config.deviceCharHeight),this._tmpCtx.restore()}}}if(x){let A=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),S=A%2===1?.5:0;this._tmpCtx.lineWidth=A,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(j,j+S),this._tmpCtx.lineTo(j+this._config.deviceCharWidth*w,j+S),this._tmpCtx.stroke()}if(ne||this._tmpCtx.fillText(a,j,j+this._config.deviceCharHeight),a==="_"&&!this._config.allowTransparency){let A=ku(this._tmpCtx.getImageData(j,j,this._config.deviceCellWidth,this._config.deviceCellHeight),L,V,C);if(A)for(let S=1;S<=5&&(this._tmpCtx.save(),this._tmpCtx.fillStyle=L.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.restore(),this._tmpCtx.fillText(a,j,j+this._config.deviceCharHeight-S),A=ku(this._tmpCtx.getImageData(j,j,this._config.deviceCellWidth,this._config.deviceCellHeight),L,V,C),!!A);S++);}if(m){let A=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/10)),S=this._tmpCtx.lineWidth%2===1?.5:0;this._tmpCtx.lineWidth=A,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(j,j+Math.floor(this._config.deviceCharHeight/2)-S),this._tmpCtx.lineTo(j+this._config.deviceCharWidth*w,j+Math.floor(this._config.deviceCharHeight/2)-S),this._tmpCtx.stroke()}this._tmpCtx.restore();let k=this._tmpCtx.getImageData(0,0,this._tmpCanvas.width,this._tmpCanvas.height),f;if(this._config.allowTransparency?f=P3(k):f=ku(k,L,V,C),f)return km;let d=this._findGlyphBoundingBox(k,this._workBoundingBox,h,$,ne,j),_,y;for(;;){if(this._activePages.length===0){let A=this._createNewPage();_=A,y=A.currentRow,y.height=d.size.y;break}_=this._activePages[this._activePages.length-1],y=_.currentRow;for(let A of this._activePages)d.size.y<=A.currentRow.height&&(_=A,y=A.currentRow);for(let A=this._activePages.length-1;A>=0;A--)for(let S of this._activePages[A].fixedRows)S.height<=y.height&&d.size.y<=S.height&&(_=this._activePages[A],y=S);if(d.size.x>this._textureSize){this._overflowSizePage||(this._overflowSizePage=new Cu(this._document,this._config.deviceMaxTextureSize),this.pages.push(this._overflowSizePage),this._requestClearModel=!0,this._onAddTextureAtlasCanvas.fire(this._overflowSizePage.canvas)),_=this._overflowSizePage,y=this._overflowSizePage.currentRow,y.x+d.size.x>=_.canvas.width&&(y.x=0,y.y+=y.height,y.height=0);break}if(y.y+d.size.y>=_.canvas.height||y.height>d.size.y+2){let A=!1;if(_.currentRow.y+_.currentRow.height+d.size.y>=_.canvas.height){let S;for(let F of this._activePages)if(F.currentRow.y+F.currentRow.height+d.size.y<F.canvas.height){S=F;break}if(S)_=S;else if(ys.maxAtlasPages&&this._pages.length>=ys.maxAtlasPages&&y.y+d.size.y<=_.canvas.height&&y.height>=d.size.y&&y.x+d.size.x<=_.canvas.width)A=!0;else{let F=this._createNewPage();_=F,y=F.currentRow,y.height=d.size.y,A=!0}}A||(_.currentRow.height>0&&_.fixedRows.push(_.currentRow),y={x:0,y:_.currentRow.y+_.currentRow.height,height:d.size.y},_.fixedRows.push(y),_.currentRow={x:0,y:y.y+y.height,height:0})}if(y.x+d.size.x<=_.canvas.width)break;y===_.currentRow?(y.x=0,y.y+=y.height,y.height=0):_.fixedRows.splice(_.fixedRows.indexOf(y),1)}return d.texturePage=this._pages.indexOf(_),d.texturePosition.x=y.x,d.texturePosition.y=y.y,d.texturePositionClipSpace.x=y.x/_.canvas.width,d.texturePositionClipSpace.y=y.y/_.canvas.height,d.sizeClipSpace.x/=_.canvas.width,d.sizeClipSpace.y/=_.canvas.height,y.height=Math.max(y.height,d.size.y),y.x+=d.size.x,_.ctx.putImageData(k,d.texturePosition.x-this._workBoundingBox.left,d.texturePosition.y-this._workBoundingBox.top,this._workBoundingBox.left,this._workBoundingBox.top,d.size.x,d.size.y),_.addGlyph(d),_.version++,d}_findGlyphBoundingBox(t,i,r,s,n,o){i.top=0;let a=s?this._config.deviceCellHeight:this._tmpCanvas.height,h=s?this._config.deviceCellWidth:r,l=!1;for(let c=0;c<a;c++){for(let u=0;u<h;u++){let p=c*this._tmpCanvas.width*4+u*4+3;if(t.data[p]!==0){i.top=c,l=!0;break}}if(l)break}i.left=0,l=!1;for(let c=0;c<o+h;c++){for(let u=0;u<a;u++){let p=u*this._tmpCanvas.width*4+c*4+3;if(t.data[p]!==0){i.left=c,l=!0;break}}if(l)break}i.right=h,l=!1;for(let c=o+h-1;c>=o;c--){for(let u=0;u<a;u++){let p=u*this._tmpCanvas.width*4+c*4+3;if(t.data[p]!==0){i.right=c,l=!0;break}}if(l)break}i.bottom=a,l=!1;for(let c=a-1;c>=0;c--){for(let u=0;u<h;u++){let p=c*this._tmpCanvas.width*4+u*4+3;if(t.data[p]!==0){i.bottom=c,l=!0;break}}if(l)break}return{texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},size:{x:i.right-i.left+1,y:i.bottom-i.top+1},sizeClipSpace:{x:i.right-i.left+1,y:i.bottom-i.top+1},offset:{x:-i.left+o+(s||n?Math.floor((this._config.deviceCellWidth-this._config.deviceCharWidth)/2):0),y:-i.top+o+(s||n?this._config.lineHeight===1?0:Math.round((this._config.deviceCellHeight-this._config.deviceCharHeight)/2):0)}}}},Cu=class{constructor(e,t,i){if(this._usedPixels=0,this._glyphs=[],this.version=0,this.currentRow={x:0,y:0,height:0},this.fixedRows=[],i)for(let r of i)this._glyphs.push(...r.glyphs),this._usedPixels+=r._usedPixels;this.canvas=y1(e,t,t),this.ctx=Ne(this.canvas.getContext("2d",{alpha:!0}))}get percentageUsed(){return this._usedPixels/(this.canvas.width*this.canvas.height)}get glyphs(){return this._glyphs}addGlyph(e){this._glyphs.push(e),this._usedPixels+=e.size.x*e.size.y}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.currentRow.x=0,this.currentRow.y=0,this.currentRow.height=0,this.fixedRows.length=0,this.version++}};function ku(e,t,i,r){let s=t.rgba>>>24,n=t.rgba>>>16&255,o=t.rgba>>>8&255,a=i.rgba>>>24,h=i.rgba>>>16&255,l=i.rgba>>>8&255,c=Math.floor((Math.abs(s-a)+Math.abs(n-h)+Math.abs(o-l))/12),u=!0;for(let p=0;p<e.data.length;p+=4)e.data[p]===s&&e.data[p+1]===n&&e.data[p+2]===o||r&&Math.abs(e.data[p]-s)+Math.abs(e.data[p+1]-n)+Math.abs(e.data[p+2]-o)<c?e.data[p+3]=0:u=!1;return u}function P3(e){for(let t=0;t<e.data.length;t+=4)if(e.data[t+3]>0)return!1;return!0}function y1(e,t,i){let r=e.createElement("canvas");return r.width=t,r.height=i,r}function O3(e,t,i,r,s,n,o,a){let h={foreground:n.foreground,background:n.background,cursor:Ut,cursorAccent:Ut,selectionForeground:Ut,selectionBackgroundTransparent:Ut,selectionBackgroundOpaque:Ut,selectionInactiveBackgroundTransparent:Ut,selectionInactiveBackgroundOpaque:Ut,overviewRulerBorder:Ut,scrollbarSliderBackground:Ut,scrollbarSliderHoverBackground:Ut,scrollbarSliderActiveBackground:Ut,ansi:n.ansi.slice(),contrastCache:n.contrastCache,halfContrastCache:n.halfContrastCache};return{customGlyphs:s.customGlyphs,devicePixelRatio:o,deviceMaxTextureSize:a,letterSpacing:s.letterSpacing,lineHeight:s.lineHeight,deviceCellWidth:e,deviceCellHeight:t,deviceCharWidth:i,deviceCharHeight:r,fontFamily:s.fontFamily,fontSize:s.fontSize,fontWeight:s.fontWeight,fontWeightBold:s.fontWeightBold,allowTransparency:s.allowTransparency,drawBoldTextInBrightColors:s.drawBoldTextInBrightColors,minimumContrastRatio:s.minimumContrastRatio,colors:h}}function Em(e,t){for(let i=0;i<e.colors.ansi.length;i++)if(e.colors.ansi[i].rgba!==t.colors.ansi[i].rgba)return!1;return e.devicePixelRatio===t.devicePixelRatio&&e.customGlyphs===t.customGlyphs&&e.lineHeight===t.lineHeight&&e.letterSpacing===t.letterSpacing&&e.fontFamily===t.fontFamily&&e.fontSize===t.fontSize&&e.fontWeight===t.fontWeight&&e.fontWeightBold===t.fontWeightBold&&e.allowTransparency===t.allowTransparency&&e.deviceCharWidth===t.deviceCharWidth&&e.deviceCharHeight===t.deviceCharHeight&&e.drawBoldTextInBrightColors===t.drawBoldTextInBrightColors&&e.minimumContrastRatio===t.minimumContrastRatio&&e.colors.foreground.rgba===t.colors.foreground.rgba&&e.colors.background.rgba===t.colors.background.rgba}function K3(e){return(e&50331648)===16777216||(e&50331648)===33554432}var Wt=[];function b1(e,t,i,r,s,n,o,a,h){let l=O3(r,s,n,o,t,i,a,h);for(let p=0;p<Wt.length;p++){let g=Wt[p],v=g.ownedBy.indexOf(e);if(v>=0){if(Em(g.config,l))return g.atlas;g.ownedBy.length===1?(g.atlas.dispose(),Wt.splice(p,1)):g.ownedBy.splice(v,1);break}}for(let p=0;p<Wt.length;p++){let g=Wt[p];if(Em(g.config,l))return g.ownedBy.push(e),g.atlas}let c=e._core,u={atlas:new vr(document,l,c.unicodeService),config:l,ownedBy:[e]};return Wt.push(u),u.atlas}function Bm(e){for(let t=0;t<Wt.length;t++){let i=Wt[t].ownedBy.indexOf(e);if(i!==-1){Wt[t].ownedBy.length===1?(Wt[t].atlas.dispose(),Wt.splice(t,1)):Wt[t].ownedBy.splice(i,1);break}}}var Ga=600,N3=class{constructor(e,t){this._renderCallback=e,this._coreBrowserService=t,this.isCursorVisible=!0,this._coreBrowserService.isFocused&&this._restartInterval()}get isPaused(){return!(this._blinkStartTimeout||this._blinkInterval)}dispose(){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}restartBlinkAnimation(){this.isPaused||(this._animationTimeRestarted=Date.now(),this.isCursorVisible=!0,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})))}_restartInterval(e=Ga){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout=this._coreBrowserService.window.setTimeout(()=>{if(this._animationTimeRestarted){let t=Ga-(Date.now()-this._animationTimeRestarted);if(this._animationTimeRestarted=void 0,t>0){this._restartInterval(t);return}}this.isCursorVisible=!1,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0}),this._blinkInterval=this._coreBrowserService.window.setInterval(()=>{if(this._animationTimeRestarted){let t=Ga-(Date.now()-this._animationTimeRestarted);this._animationTimeRestarted=void 0,this._restartInterval(t);return}this.isCursorVisible=!this.isCursorVisible,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})},Ga)},e)}pause(){this.isCursorVisible=!0,this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}resume(){this.pause(),this._animationTimeRestarted=void 0,this._restartInterval(),this.restartBlinkAnimation()}};function Lm(e,t,i){let r=new t.ResizeObserver(s=>{let n=s.find(h=>h.target===e);if(!n)return;if(!("devicePixelContentBoxSize"in n)){r?.disconnect(),r=void 0;return}let o=n.devicePixelContentBoxSize[0].inlineSize,a=n.devicePixelContentBoxSize[0].blockSize;o>0&&a>0&&i(o,a)});try{r.observe(e,{box:["device-pixel-content-box"]})}catch{r.disconnect(),r=void 0}return nt(()=>r?.disconnect())}function Q3(e){return e>65535?(e-=65536,String.fromCharCode((e>>10)+55296)+String.fromCharCode(e%1024+56320)):String.fromCharCode(e)}var Dm=class w1 extends bs{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new f1,this.combinedData=""}static fromCharData(t){let i=new w1;return i.setFromCharData(t),i}isCombined(){return this.content&2097152}getWidth(){return this.content>>22}getChars(){return this.content&2097152?this.combinedData:this.content&2097151?Q3(this.content&2097151):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):this.content&2097151}setFromCharData(t){this.fg=t[0],this.bg=0;let i=!1;if(t[1].length>2)i=!0;else if(t[1].length===2){let r=t[1].charCodeAt(0);if(55296<=r&&r<=56319){let s=t[1].charCodeAt(1);56320<=s&&s<=57343?this.content=(r-55296)*1024+s-56320+65536|t[2]<<22:i=!0}else i=!0}else this.content=t[1].charCodeAt(0)|t[2]<<22;i&&(this.combinedData=t[1],this.content=2097152|t[2]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},A1=new Float32Array([2,0,0,0,0,-2,0,0,0,0,1,0,-1,1,0,1]);function x1(e,t,i){let r=Ne(e.createProgram());if(e.attachShader(r,Ne(Im(e,e.VERTEX_SHADER,t))),e.attachShader(r,Ne(Im(e,e.FRAGMENT_SHADER,i))),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS))return r;console.error(e.getProgramInfoLog(r)),e.deleteProgram(r)}function Im(e,t,i){let r=Ne(e.createShader(t));if(e.shaderSource(r,i),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS))return r;console.error(e.getShaderInfoLog(r)),e.deleteShader(r)}function H3(e,t){let i=Math.min(e.length*2,t),r=new Float32Array(i);for(let s=0;s<e.length;s++)r[s]=e[s];return r}var X3=class{constructor(e){this.texture=e,this.version=-1}},U3=`#version 300 es
layout (location = 0) in vec2 a_unitquad;
layout (location = 1) in vec2 a_cellpos;
layout (location = 2) in vec2 a_offset;
layout (location = 3) in vec2 a_size;
layout (location = 4) in float a_texpage;
layout (location = 5) in vec2 a_texcoord;
layout (location = 6) in vec2 a_texsize;

uniform mat4 u_projection;
uniform vec2 u_resolution;

out vec2 v_texcoord;
flat out int v_texpage;

void main() {
  vec2 zeroToOne = (a_offset / u_resolution) + a_cellpos + (a_unitquad * a_size);
  gl_Position = u_projection * vec4(zeroToOne, 0.0, 1.0);
  v_texpage = int(a_texpage);
  v_texcoord = a_texcoord + a_unitquad * a_texsize;
}`;function z3(e){let t="";for(let i=1;i<e;i++)t+=` else if (v_texpage == ${i}) { outColor = texture(u_texture[${i}], v_texcoord); }`;return`#version 300 es
precision lowp float;

in vec2 v_texcoord;
flat in int v_texpage;

uniform sampler2D u_texture[${e}];

out vec4 outColor;

void main() {
  if (v_texpage == 0) {
    outColor = texture(u_texture[0], v_texcoord);
  } ${t}
}`}var mr=11,ms=mr*Float32Array.BYTES_PER_ELEMENT,W3=2,Ie=0,we,Eu=0,Wn=0,$3=class extends It{constructor(e,t,i,r){super(),this._terminal=e,this._gl=t,this._dimensions=i,this._optionsService=r,this._activeBuffer=0,this._vertices={count:0,attributes:new Float32Array(0),attributesBuffers:[new Float32Array(0),new Float32Array(0)]};let s=this._gl;vr.maxAtlasPages===void 0&&(vr.maxAtlasPages=Math.min(32,Ne(s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS))),vr.maxTextureSize=Ne(s.getParameter(s.MAX_TEXTURE_SIZE))),this._program=Ne(x1(s,U3,z3(vr.maxAtlasPages))),this._register(nt(()=>s.deleteProgram(this._program))),this._projectionLocation=Ne(s.getUniformLocation(this._program,"u_projection")),this._resolutionLocation=Ne(s.getUniformLocation(this._program,"u_resolution")),this._textureLocation=Ne(s.getUniformLocation(this._program,"u_texture")),this._vertexArrayObject=s.createVertexArray(),s.bindVertexArray(this._vertexArrayObject);let n=new Float32Array([0,0,1,0,0,1,1,1]),o=s.createBuffer();this._register(nt(()=>s.deleteBuffer(o))),s.bindBuffer(s.ARRAY_BUFFER,o),s.bufferData(s.ARRAY_BUFFER,n,s.STATIC_DRAW),s.enableVertexAttribArray(0),s.vertexAttribPointer(0,2,this._gl.FLOAT,!1,0,0);let a=new Uint8Array([0,1,2,3]),h=s.createBuffer();this._register(nt(()=>s.deleteBuffer(h))),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,h),s.bufferData(s.ELEMENT_ARRAY_BUFFER,a,s.STATIC_DRAW),this._attributesBuffer=Ne(s.createBuffer()),this._register(nt(()=>s.deleteBuffer(this._attributesBuffer))),s.bindBuffer(s.ARRAY_BUFFER,this._attributesBuffer),s.enableVertexAttribArray(2),s.vertexAttribPointer(2,2,s.FLOAT,!1,ms,0),s.vertexAttribDivisor(2,1),s.enableVertexAttribArray(3),s.vertexAttribPointer(3,2,s.FLOAT,!1,ms,2*Float32Array.BYTES_PER_ELEMENT),s.vertexAttribDivisor(3,1),s.enableVertexAttribArray(4),s.vertexAttribPointer(4,1,s.FLOAT,!1,ms,4*Float32Array.BYTES_PER_ELEMENT),s.vertexAttribDivisor(4,1),s.enableVertexAttribArray(5),s.vertexAttribPointer(5,2,s.FLOAT,!1,ms,5*Float32Array.BYTES_PER_ELEMENT),s.vertexAttribDivisor(5,1),s.enableVertexAttribArray(6),s.vertexAttribPointer(6,2,s.FLOAT,!1,ms,7*Float32Array.BYTES_PER_ELEMENT),s.vertexAttribDivisor(6,1),s.enableVertexAttribArray(1),s.vertexAttribPointer(1,2,s.FLOAT,!1,ms,9*Float32Array.BYTES_PER_ELEMENT),s.vertexAttribDivisor(1,1),s.useProgram(this._program);let l=new Int32Array(vr.maxAtlasPages);for(let c=0;c<vr.maxAtlasPages;c++)l[c]=c;s.uniform1iv(this._textureLocation,l),s.uniformMatrix4fv(this._projectionLocation,!1,A1),this._atlasTextures=[];for(let c=0;c<vr.maxAtlasPages;c++){let u=new X3(Ne(s.createTexture()));this._register(nt(()=>s.deleteTexture(u.texture))),s.activeTexture(s.TEXTURE0+c),s.bindTexture(s.TEXTURE_2D,u.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,new Uint8Array([255,0,0,255])),this._atlasTextures[c]=u}s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA),this.handleResize()}beginFrame(){return this._atlas?this._atlas.beginFrame():!0}updateCell(e,t,i,r,s,n,o,a,h){this._updateCell(this._vertices.attributes,e,t,i,r,s,n,o,a,h)}_updateCell(e,t,i,r,s,n,o,a,h,l){if(Ie=(i*this._terminal.cols+t)*mr,r===0||r===void 0){e.fill(0,Ie,Ie+mr-1-W3);return}this._atlas&&(a&&a.length>1?we=this._atlas.getRasterizedGlyphCombinedChar(a,s,n,o,!1,this._terminal.element):we=this._atlas.getRasterizedGlyph(r,s,n,o,!1,this._terminal.element),Eu=Math.floor((this._dimensions.device.cell.width-this._dimensions.device.char.width)/2),s!==l&&we.offset.x>Eu?(Wn=we.offset.x-Eu,e[Ie]=-(we.offset.x-Wn)+this._dimensions.device.char.left,e[Ie+1]=-we.offset.y+this._dimensions.device.char.top,e[Ie+2]=(we.size.x-Wn)/this._dimensions.device.canvas.width,e[Ie+3]=we.size.y/this._dimensions.device.canvas.height,e[Ie+4]=we.texturePage,e[Ie+5]=we.texturePositionClipSpace.x+Wn/this._atlas.pages[we.texturePage].canvas.width,e[Ie+6]=we.texturePositionClipSpace.y,e[Ie+7]=we.sizeClipSpace.x-Wn/this._atlas.pages[we.texturePage].canvas.width,e[Ie+8]=we.sizeClipSpace.y):(e[Ie]=-we.offset.x+this._dimensions.device.char.left,e[Ie+1]=-we.offset.y+this._dimensions.device.char.top,e[Ie+2]=we.size.x/this._dimensions.device.canvas.width,e[Ie+3]=we.size.y/this._dimensions.device.canvas.height,e[Ie+4]=we.texturePage,e[Ie+5]=we.texturePositionClipSpace.x,e[Ie+6]=we.texturePositionClipSpace.y,e[Ie+7]=we.sizeClipSpace.x,e[Ie+8]=we.sizeClipSpace.y),this._optionsService.rawOptions.rescaleOverlappingGlyphs&&l3(r,h,we.size.x,this._dimensions.device.cell.width)&&(e[Ie+2]=(this._dimensions.device.cell.width-1)/this._dimensions.device.canvas.width))}clear(){let e=this._terminal,t=e.cols*e.rows*mr;this._vertices.count!==t?this._vertices.attributes=new Float32Array(t):this._vertices.attributes.fill(0);let i=0;for(;i<this._vertices.attributesBuffers.length;i++)this._vertices.count!==t?this._vertices.attributesBuffers[i]=new Float32Array(t):this._vertices.attributesBuffers[i].fill(0);this._vertices.count=t,i=0;for(let r=0;r<e.rows;r++)for(let s=0;s<e.cols;s++)this._vertices.attributes[i+9]=s/e.cols,this._vertices.attributes[i+10]=r/e.rows,i+=mr}handleResize(){let e=this._gl;e.useProgram(this._program),e.viewport(0,0,e.canvas.width,e.canvas.height),e.uniform2f(this._resolutionLocation,e.canvas.width,e.canvas.height),this.clear()}render(e){if(!this._atlas)return;let t=this._gl;t.useProgram(this._program),t.bindVertexArray(this._vertexArrayObject),this._activeBuffer=(this._activeBuffer+1)%2;let i=this._vertices.attributesBuffers[this._activeBuffer],r=0;for(let s=0;s<e.lineLengths.length;s++){let n=s*this._terminal.cols*mr,o=this._vertices.attributes.subarray(n,n+e.lineLengths[s]*mr);i.set(o,r),r+=o.length}t.bindBuffer(t.ARRAY_BUFFER,this._attributesBuffer),t.bufferData(t.ARRAY_BUFFER,i.subarray(0,r),t.STREAM_DRAW);for(let s=0;s<this._atlas.pages.length;s++)this._atlas.pages[s].version!==this._atlasTextures[s].version&&this._bindAtlasPageTexture(t,this._atlas,s);t.drawElementsInstanced(t.TRIANGLE_STRIP,4,t.UNSIGNED_BYTE,0,r/mr)}setAtlas(e){this._atlas=e;for(let t of this._atlasTextures)t.version=-1}_bindAtlasPageTexture(e,t,i){e.activeTexture(e.TEXTURE0+i),e.bindTexture(e.TEXTURE_2D,this._atlasTextures[i].texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t.pages[i].canvas),e.generateMipmap(e.TEXTURE_2D),this._atlasTextures[i].version=t.pages[i].version}setDimensions(e){this._dimensions=e}},G3=class{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(e,t,i,r=!1){if(this.selectionStart=t,this.selectionEnd=i,!t||!i||t[0]===i[0]&&t[1]===i[1]){this.clear();return}let s=e.buffers.active.ydisp,n=t[1]-s,o=i[1]-s,a=Math.max(n,0),h=Math.min(o,e.rows-1);if(a>=e.rows||h<0){this.clear();return}this.hasSelection=!0,this.columnSelectMode=r,this.viewportStartRow=n,this.viewportEndRow=o,this.viewportCappedStartRow=a,this.viewportCappedEndRow=h,this.startCol=t[0],this.endCol=i[0]}isCellSelected(e,t,i){return this.hasSelection?(i-=e.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?t>=this.startCol&&i>=this.viewportCappedStartRow&&t<this.endCol&&i<=this.viewportCappedEndRow:t<this.startCol&&i>=this.viewportCappedStartRow&&t>=this.endCol&&i<=this.viewportCappedEndRow:i>this.viewportStartRow&&i<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&i===this.viewportStartRow&&t>=this.startCol&&t<this.endCol||this.viewportStartRow<this.viewportEndRow&&i===this.viewportEndRow&&t<this.endCol||this.viewportStartRow<this.viewportEndRow&&i===this.viewportStartRow&&t>=this.startCol):!1}};function j3(){return new G3}var sl=4,Ja=1,Za=2,Bu=3,q3=2147483648,V3=class{constructor(){this.cells=new Uint32Array(0),this.lineLengths=new Uint32Array(0),this.selection=j3()}resize(e,t){let i=e*t*sl;i!==this.cells.length&&(this.cells=new Uint32Array(i),this.lineLengths=new Uint32Array(t))}clear(){this.cells.fill(0,0),this.lineLengths.fill(0,0)}},Y3=`#version 300 es
layout (location = 0) in vec2 a_position;
layout (location = 1) in vec2 a_size;
layout (location = 2) in vec4 a_color;
layout (location = 3) in vec2 a_unitquad;

uniform mat4 u_projection;

out vec4 v_color;

void main() {
  vec2 zeroToOne = a_position + (a_unitquad * a_size);
  gl_Position = u_projection * vec4(zeroToOne, 0.0, 1.0);
  v_color = a_color;
}`,J3=`#version 300 es
precision lowp float;

in vec4 v_color;

out vec4 outColor;

void main() {
  outColor = v_color;
}`,Oi=8,Lu=Oi*Float32Array.BYTES_PER_ELEMENT,Z3=20*Oi,Mm=class{constructor(){this.attributes=new Float32Array(Z3),this.count=0}},Fi=0,Tm=0,Rm=0,Fm=0,Pm=0,Om=0,Km=0,e6=class extends It{constructor(e,t,i,r){super(),this._terminal=e,this._gl=t,this._dimensions=i,this._themeService=r,this._vertices=new Mm,this._verticesCursor=new Mm;let s=this._gl;this._program=Ne(x1(s,Y3,J3)),this._register(nt(()=>s.deleteProgram(this._program))),this._projectionLocation=Ne(s.getUniformLocation(this._program,"u_projection")),this._vertexArrayObject=s.createVertexArray(),s.bindVertexArray(this._vertexArrayObject);let n=new Float32Array([0,0,1,0,0,1,1,1]),o=s.createBuffer();this._register(nt(()=>s.deleteBuffer(o))),s.bindBuffer(s.ARRAY_BUFFER,o),s.bufferData(s.ARRAY_BUFFER,n,s.STATIC_DRAW),s.enableVertexAttribArray(3),s.vertexAttribPointer(3,2,this._gl.FLOAT,!1,0,0);let a=new Uint8Array([0,1,2,3]),h=s.createBuffer();this._register(nt(()=>s.deleteBuffer(h))),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,h),s.bufferData(s.ELEMENT_ARRAY_BUFFER,a,s.STATIC_DRAW),this._attributesBuffer=Ne(s.createBuffer()),this._register(nt(()=>s.deleteBuffer(this._attributesBuffer))),s.bindBuffer(s.ARRAY_BUFFER,this._attributesBuffer),s.enableVertexAttribArray(0),s.vertexAttribPointer(0,2,s.FLOAT,!1,Lu,0),s.vertexAttribDivisor(0,1),s.enableVertexAttribArray(1),s.vertexAttribPointer(1,2,s.FLOAT,!1,Lu,2*Float32Array.BYTES_PER_ELEMENT),s.vertexAttribDivisor(1,1),s.enableVertexAttribArray(2),s.vertexAttribPointer(2,4,s.FLOAT,!1,Lu,4*Float32Array.BYTES_PER_ELEMENT),s.vertexAttribDivisor(2,1),this._updateCachedColors(r.colors),this._register(this._themeService.onChangeColors(l=>{this._updateCachedColors(l),this._updateViewportRectangle()}))}renderBackgrounds(){this._renderVertices(this._vertices)}renderCursor(){this._renderVertices(this._verticesCursor)}_renderVertices(e){let t=this._gl;t.useProgram(this._program),t.bindVertexArray(this._vertexArrayObject),t.uniformMatrix4fv(this._projectionLocation,!1,A1),t.bindBuffer(t.ARRAY_BUFFER,this._attributesBuffer),t.bufferData(t.ARRAY_BUFFER,e.attributes,t.DYNAMIC_DRAW),t.drawElementsInstanced(this._gl.TRIANGLE_STRIP,4,t.UNSIGNED_BYTE,0,e.count)}handleResize(){this._updateViewportRectangle()}setDimensions(e){this._dimensions=e}_updateCachedColors(e){this._bgFloat=this._colorToFloat32Array(e.background),this._cursorFloat=this._colorToFloat32Array(e.cursor)}_updateViewportRectangle(){this._addRectangleFloat(this._vertices.attributes,0,0,0,this._terminal.cols*this._dimensions.device.cell.width,this._terminal.rows*this._dimensions.device.cell.height,this._bgFloat)}updateBackgrounds(e){let t=this._terminal,i=this._vertices,r=1,s,n,o,a,h,l,c,u,p,g,v;for(s=0;s<t.rows;s++){for(o=-1,a=0,h=0,l=!1,n=0;n<t.cols;n++)c=(s*t.cols+n)*sl,u=e.cells[c+Ja],p=e.cells[c+Za],g=!!(p&67108864),(u!==a||p!==h&&(l||g))&&((a!==0||l&&h!==0)&&(v=r++*Oi,this._updateRectangle(i,v,h,a,o,n,s)),o=n,a=u,h=p,l=g);(a!==0||l&&h!==0)&&(v=r++*Oi,this._updateRectangle(i,v,h,a,o,t.cols,s))}i.count=r}updateCursor(e){let t=this._verticesCursor,i=e.cursor;if(!i||i.style==="block"){t.count=0;return}let r,s=0;(i.style==="bar"||i.style==="outline")&&(r=s++*Oi,this._addRectangleFloat(t.attributes,r,i.x*this._dimensions.device.cell.width,i.y*this._dimensions.device.cell.height,i.style==="bar"?i.dpr*i.cursorWidth:i.dpr,this._dimensions.device.cell.height,this._cursorFloat)),(i.style==="underline"||i.style==="outline")&&(r=s++*Oi,this._addRectangleFloat(t.attributes,r,i.x*this._dimensions.device.cell.width,(i.y+1)*this._dimensions.device.cell.height-i.dpr,i.width*this._dimensions.device.cell.width,i.dpr,this._cursorFloat)),i.style==="outline"&&(r=s++*Oi,this._addRectangleFloat(t.attributes,r,i.x*this._dimensions.device.cell.width,i.y*this._dimensions.device.cell.height,i.width*this._dimensions.device.cell.width,i.dpr,this._cursorFloat),r=s++*Oi,this._addRectangleFloat(t.attributes,r,(i.x+i.width)*this._dimensions.device.cell.width-i.dpr,i.y*this._dimensions.device.cell.height,i.dpr,this._dimensions.device.cell.height,this._cursorFloat)),t.count=s}_updateRectangle(e,t,i,r,s,n,o){if(i&67108864)switch(i&50331648){case 16777216:case 33554432:Fi=this._themeService.colors.ansi[i&255].rgba;break;case 50331648:Fi=(i&16777215)<<8;break;case 0:default:Fi=this._themeService.colors.foreground.rgba}else switch(r&50331648){case 16777216:case 33554432:Fi=this._themeService.colors.ansi[r&255].rgba;break;case 50331648:Fi=(r&16777215)<<8;break;case 0:default:Fi=this._themeService.colors.background.rgba}e.attributes.length<t+4&&(e.attributes=H3(e.attributes,this._terminal.rows*this._terminal.cols*Oi)),Tm=s*this._dimensions.device.cell.width,Rm=o*this._dimensions.device.cell.height,Fm=(Fi>>24&255)/255,Pm=(Fi>>16&255)/255,Om=(Fi>>8&255)/255,Km=1,this._addRectangle(e.attributes,t,Tm,Rm,(n-s)*this._dimensions.device.cell.width,this._dimensions.device.cell.height,Fm,Pm,Om,Km)}_addRectangle(e,t,i,r,s,n,o,a,h,l){e[t]=i/this._dimensions.device.canvas.width,e[t+1]=r/this._dimensions.device.canvas.height,e[t+2]=s/this._dimensions.device.canvas.width,e[t+3]=n/this._dimensions.device.canvas.height,e[t+4]=o,e[t+5]=a,e[t+6]=h,e[t+7]=l}_addRectangleFloat(e,t,i,r,s,n,o){e[t]=i/this._dimensions.device.canvas.width,e[t+1]=r/this._dimensions.device.canvas.height,e[t+2]=s/this._dimensions.device.canvas.width,e[t+3]=n/this._dimensions.device.canvas.height,e[t+4]=o[0],e[t+5]=o[1],e[t+6]=o[2],e[t+7]=o[3]}_colorToFloat32Array(e){return new Float32Array([(e.rgba>>24&255)/255,(e.rgba>>16&255)/255,(e.rgba>>8&255)/255,(e.rgba&255)/255])}},t6=class extends It{constructor(e,t,i,r,s,n,o,a){super(),this._container=t,this._alpha=s,this._coreBrowserService=n,this._optionsService=o,this._themeService=a,this._deviceCharWidth=0,this._deviceCharHeight=0,this._deviceCellWidth=0,this._deviceCellHeight=0,this._deviceCharLeft=0,this._deviceCharTop=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add(`xterm-${i}-layer`),this._canvas.style.zIndex=r.toString(),this._initCanvas(),this._container.appendChild(this._canvas),this._register(this._themeService.onChangeColors(h=>{this._refreshCharAtlas(e,h),this.reset(e)})),this._register(nt(()=>{this._canvas.remove()}))}_initCanvas(){this._ctx=Ne(this._canvas.getContext("2d",{alpha:this._alpha})),this._alpha||this._clearAll()}handleBlur(e){}handleFocus(e){}handleCursorMove(e){}handleGridChanged(e,t,i){}handleSelectionChanged(e,t,i,r=!1){}_setTransparency(e,t){if(t===this._alpha)return;let i=this._canvas;this._alpha=t,this._canvas=this._canvas.cloneNode(),this._initCanvas(),this._container.replaceChild(this._canvas,i),this._refreshCharAtlas(e,this._themeService.colors),this.handleGridChanged(e,0,e.rows-1)}_refreshCharAtlas(e,t){this._deviceCharWidth<=0&&this._deviceCharHeight<=0||(this._charAtlas=b1(e,this._optionsService.rawOptions,t,this._deviceCellWidth,this._deviceCellHeight,this._deviceCharWidth,this._deviceCharHeight,this._coreBrowserService.dpr,2048),this._charAtlas.warmUp())}resize(e,t){this._deviceCellWidth=t.device.cell.width,this._deviceCellHeight=t.device.cell.height,this._deviceCharWidth=t.device.char.width,this._deviceCharHeight=t.device.char.height,this._deviceCharLeft=t.device.char.left,this._deviceCharTop=t.device.char.top,this._canvas.width=t.device.canvas.width,this._canvas.height=t.device.canvas.height,this._canvas.style.width=`${t.css.canvas.width}px`,this._canvas.style.height=`${t.css.canvas.height}px`,this._alpha||this._clearAll(),this._refreshCharAtlas(e,this._themeService.colors)}_fillBottomLineAtCells(e,t,i=1){this._ctx.fillRect(e*this._deviceCellWidth,(t+1)*this._deviceCellHeight-this._coreBrowserService.dpr-1,i*this._deviceCellWidth,this._coreBrowserService.dpr)}_clearAll(){this._alpha?this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height))}_clearCells(e,t,i,r){this._alpha?this._ctx.clearRect(e*this._deviceCellWidth,t*this._deviceCellHeight,i*this._deviceCellWidth,r*this._deviceCellHeight):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(e*this._deviceCellWidth,t*this._deviceCellHeight,i*this._deviceCellWidth,r*this._deviceCellHeight))}_fillCharTrueColor(e,t,i,r){this._ctx.font=this._getFont(e,!1,!1),this._ctx.textBaseline=l1,this._clipCell(i,r,t.getWidth()),this._ctx.fillText(t.getChars(),i*this._deviceCellWidth+this._deviceCharLeft,r*this._deviceCellHeight+this._deviceCharTop+this._deviceCharHeight)}_clipCell(e,t,i){this._ctx.beginPath(),this._ctx.rect(e*this._deviceCellWidth,t*this._deviceCellHeight,i*this._deviceCellWidth,this._deviceCellHeight),this._ctx.clip()}_getFont(e,t,i){let r=t?e.options.fontWeightBold:e.options.fontWeight;return`${i?"italic":""} ${r} ${e.options.fontSize*this._coreBrowserService.dpr}px ${e.options.fontFamily}`}},i6=class extends t6{constructor(e,t,i,r,s,n,o){super(i,e,"link",t,!0,s,n,o),this._register(r.onShowLinkUnderline(a=>this._handleShowLinkUnderline(a))),this._register(r.onHideLinkUnderline(a=>this._handleHideLinkUnderline(a)))}resize(e,t){super.resize(e,t),this._state=void 0}reset(e){this._clearCurrentLink()}_clearCurrentLink(){if(this._state){this._clearCells(this._state.x1,this._state.y1,this._state.cols-this._state.x1,1);let e=this._state.y2-this._state.y1-1;e>0&&this._clearCells(0,this._state.y1+1,this._state.cols,e),this._clearCells(0,this._state.y2,this._state.x2,1),this._state=void 0}}_handleShowLinkUnderline(e){if(e.fg===257?this._ctx.fillStyle=this._themeService.colors.background.css:e.fg!==void 0&&K3(e.fg)?this._ctx.fillStyle=this._themeService.colors.ansi[e.fg].css:this._ctx.fillStyle=this._themeService.colors.foreground.css,e.y1===e.y2)this._fillBottomLineAtCells(e.x1,e.y1,e.x2-e.x1);else{this._fillBottomLineAtCells(e.x1,e.y1,e.cols-e.x1);for(let t=e.y1+1;t<e.y2;t++)this._fillBottomLineAtCells(0,t,e.cols);this._fillBottomLineAtCells(0,e.y2,e.x2)}this._state=e}_handleHideLinkUnderline(e){this._clearCurrentLink()}},Yt=typeof window=="object"?window:globalThis,Wu=class{constructor(){this.mapWindowIdToZoomLevel=new Map,this._onDidChangeZoomLevel=new pe,this.onDidChangeZoomLevel=this._onDidChangeZoomLevel.event,this.mapWindowIdToZoomFactor=new Map,this._onDidChangeFullscreen=new pe,this.onDidChangeFullscreen=this._onDidChangeFullscreen.event,this.mapWindowIdToFullScreen=new Map}getZoomLevel(t){return this.mapWindowIdToZoomLevel.get(this.getWindowId(t))??0}setZoomLevel(t,i){if(this.getZoomLevel(i)===t)return;let r=this.getWindowId(i);this.mapWindowIdToZoomLevel.set(r,t),this._onDidChangeZoomLevel.fire(r)}getZoomFactor(t){return this.mapWindowIdToZoomFactor.get(this.getWindowId(t))??1}setZoomFactor(t,i){this.mapWindowIdToZoomFactor.set(this.getWindowId(i),t)}setFullscreen(t,i){if(this.isFullscreen(i)===t)return;let r=this.getWindowId(i);this.mapWindowIdToFullScreen.set(r,t),this._onDidChangeFullscreen.fire(r)}isFullscreen(t){return!!this.mapWindowIdToFullScreen.get(this.getWindowId(t))}getWindowId(t){return t.vscodeWindowId}};Wu.INSTANCE=new Wu;var S1=Wu;function r6(e,t,i){typeof t=="string"&&(t=e.matchMedia(t)),t.addEventListener("change",i)}var qM=S1.INSTANCE.onDidChangeZoomLevel,VM=S1.INSTANCE.onDidChangeFullscreen,Ss=typeof navigator=="object"?navigator.userAgent:"",YM=Ss.indexOf("Firefox")>=0,Du=Ss.indexOf("AppleWebKit")>=0,s6=Ss.indexOf("Chrome")>=0,n6=!s6&&Ss.indexOf("Safari")>=0,JM=Ss.indexOf("Electron/")>=0,ZM=Ss.indexOf("Android")>=0,el=!1;if(typeof Yt.matchMedia=="function"){let e=Yt.matchMedia("(display-mode: standalone) or (display-mode: window-controls-overlay)"),t=Yt.matchMedia("(display-mode: fullscreen)");el=e.matches,r6(Yt,e,({matches:i})=>{el&&t.matches||(el=i)})}function o6(){return el}var ws="en",$u=!1,Gu=!1,tl=!1,a6=!1,C1=!1,k1=!1,l6=!1,h6=!1,c6=!1,u6=!1,ja,il=ws,Nm=ws,d6,Pi,Qi=globalThis,Dt;typeof Qi.vscode<"u"&&typeof Qi.vscode.process<"u"?Dt=Qi.vscode.process:typeof process<"u"&&typeof process?.versions?.node=="string"&&(Dt=process);var E1=typeof Dt?.versions?.electron=="string",f6=E1&&Dt?.type==="renderer";if(typeof Dt=="object"){$u=Dt.platform==="win32",Gu=Dt.platform==="darwin",tl=Dt.platform==="linux",a6=tl&&!!Dt.env.SNAP&&!!Dt.env.SNAP_REVISION,l6=E1,c6=!!Dt.env.CI||!!Dt.env.BUILD_ARTIFACTSTAGINGDIRECTORY,ja=ws,il=ws;let e=Dt.env.VSCODE_NLS_CONFIG;if(e)try{let t=JSON.parse(e);ja=t.userLocale,Nm=t.osLocale,il=t.resolvedLanguage||ws,d6=t.languagePack?.translationsConfigFile}catch{}C1=!0}else typeof navigator=="object"&&!f6?(Pi=navigator.userAgent,$u=Pi.indexOf("Windows")>=0,Gu=Pi.indexOf("Macintosh")>=0,h6=(Pi.indexOf("Macintosh")>=0||Pi.indexOf("iPad")>=0||Pi.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,tl=Pi.indexOf("Linux")>=0,u6=Pi?.indexOf("Mobi")>=0,k1=!0,il=globalThis._VSCODE_NLS_LANGUAGE||ws,ja=navigator.language.toLowerCase(),Nm=ja):console.error("Unable to resolve platform.");var Iu=0;Gu?Iu=1:$u?Iu=3:tl&&(Iu=2);var Mu=C1,_6=k1&&typeof Qi.importScripts=="function",eT=_6?Qi.origin:void 0,gi=Pi,gr=il,g6;(e=>{function t(){return gr}e.value=t;function i(){return gr.length===2?gr==="en":gr.length>=3?gr[0]==="e"&&gr[1]==="n"&&gr[2]==="-":!1}e.isDefaultVariant=i;function r(){return gr==="en"}e.isDefault=r})(g6||={});var p6=typeof Qi.postMessage=="function"&&!Qi.importScripts,v6=(()=>{if(p6){let e=[];Qi.addEventListener("message",i=>{if(i.data&&i.data.vscodeScheduleAsyncWork)for(let r=0,s=e.length;r<s;r++){let n=e[r];if(n.id===i.data.vscodeScheduleAsyncWork){e.splice(r,1),n.callback();return}}});let t=0;return i=>{let r=++t;e.push({id:r,callback:i}),Qi.postMessage({vscodeScheduleAsyncWork:r},"*")}}return e=>setTimeout(e)})(),m6=!!(gi&&gi.indexOf("Chrome")>=0),tT=!!(gi&&gi.indexOf("Firefox")>=0),iT=!!(!m6&&gi&&gi.indexOf("Safari")>=0),rT=!!(gi&&gi.indexOf("Edg/")>=0),sT=!!(gi&&gi.indexOf("Android")>=0),pr=typeof navigator=="object"?navigator:{},nT={clipboard:{writeText:Mu||document.queryCommandSupported&&document.queryCommandSupported("copy")||!!(pr&&pr.clipboard&&pr.clipboard.writeText),readText:Mu||!!(pr&&pr.clipboard&&pr.clipboard.readText)},keyboard:Mu||o6()?0:pr.keyboard||n6?1:2,touch:"ontouchstart"in Yt||pr.maxTouchPoints>0,pointerEvents:Yt.PointerEvent&&("ontouchstart"in Yt||navigator.maxTouchPoints>0)},Ju=class{constructor(){this._keyCodeToStr=[],this._strToKeyCode=Object.create(null)}define(e,t){this._keyCodeToStr[e]=t,this._strToKeyCode[t.toLowerCase()]=e}keyCodeToStr(e){return this._keyCodeToStr[e]}strToKeyCode(e){return this._strToKeyCode[e.toLowerCase()]||0}},Tu=new Ju,Qm=new Ju,Hm=new Ju,oT=new Array(230),y6;(e=>{function t(a){return Tu.keyCodeToStr(a)}e.toString=t;function i(a){return Tu.strToKeyCode(a)}e.fromString=i;function r(a){return Qm.keyCodeToStr(a)}e.toUserSettingsUS=r;function s(a){return Hm.keyCodeToStr(a)}e.toUserSettingsGeneral=s;function n(a){return Qm.strToKeyCode(a)||Hm.strToKeyCode(a)}e.fromUserSettings=n;function o(a){if(a>=98&&a<=113)return null;switch(a){case 16:return"Up";case 18:return"Down";case 15:return"Left";case 17:return"Right"}return Tu.keyCodeToStr(a)}e.toElectronAccelerator=o})(y6||={});var B1=Object.freeze(function(e,t){let i=setTimeout(e.bind(t),0);return{dispose(){clearTimeout(i)}}}),b6;(e=>{function t(i){return i===e.None||i===e.Cancelled||i instanceof w6?!0:!i||typeof i!="object"?!1:typeof i.isCancellationRequested=="boolean"&&typeof i.onCancellationRequested=="function"}e.isCancellationToken=t,e.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:Ki.None}),e.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:B1})})(b6||={});var w6=class{constructor(){this._isCancelled=!1,this._emitter=null}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?B1:(this._emitter||(this._emitter=new pe),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}},aT=Symbol("MicrotaskDelay"),A6,Ru;(function(){typeof globalThis.requestIdleCallback!="function"||typeof globalThis.cancelIdleCallback!="function"?Ru=(e,t)=>{v6(()=>{if(i)return;let r=Date.now()+15;t(Object.freeze({didTimeout:!0,timeRemaining(){return Math.max(0,r-Date.now())}}))});let i=!1;return{dispose(){i||(i=!0)}}}:Ru=(e,t,i)=>{let r=e.requestIdleCallback(t,typeof i=="number"?{timeout:i}:void 0),s=!1;return{dispose(){s||(s=!0,e.cancelIdleCallback(r))}}},A6=e=>Ru(globalThis,e)})();var x6;(e=>{async function t(r){let s,n=await Promise.all(r.map(o=>o.then(a=>a,a=>{s||(s=a)})));if(typeof s<"u")throw s;return n}e.settled=t;function i(r){return new Promise(async(s,n)=>{try{await r(s,n)}catch(o){n(o)}})}e.withAsyncBody=i})(x6||={});var Xm=class zt{static fromArray(t){return new zt(i=>{i.emitMany(t)})}static fromPromise(t){return new zt(async i=>{i.emitMany(await t)})}static fromPromises(t){return new zt(async i=>{await Promise.all(t.map(async r=>i.emitOne(await r)))})}static merge(t){return new zt(async i=>{await Promise.all(t.map(async r=>{for await(let s of r)i.emitOne(s)}))})}constructor(t,i){this._state=0,this._results=[],this._error=null,this._onReturn=i,this._onStateChanged=new pe,queueMicrotask(async()=>{let r={emitOne:s=>this.emitOne(s),emitMany:s=>this.emitMany(s),reject:s=>this.reject(s)};try{await Promise.resolve(t(r)),this.resolve()}catch(s){this.reject(s)}finally{r.emitOne=void 0,r.emitMany=void 0,r.reject=void 0}})}[Symbol.asyncIterator](){let t=0;return{next:async()=>{do{if(this._state===2)throw this._error;if(t<this._results.length)return{done:!1,value:this._results[t++]};if(this._state===1)return{done:!0,value:void 0};await Ki.toPromise(this._onStateChanged.event)}while(!0)},return:async()=>(this._onReturn?.(),{done:!0,value:void 0})}}static map(t,i){return new zt(async r=>{for await(let s of t)r.emitOne(i(s))})}map(t){return zt.map(this,t)}static filter(t,i){return new zt(async r=>{for await(let s of t)i(s)&&r.emitOne(s)})}filter(t){return zt.filter(this,t)}static coalesce(t){return zt.filter(t,i=>!!i)}coalesce(){return zt.coalesce(this)}static async toPromise(t){let i=[];for await(let r of t)i.push(r);return i}toPromise(){return zt.toPromise(this)}emitOne(t){this._state===0&&(this._results.push(t),this._onStateChanged.fire())}emitMany(t){this._state===0&&(this._results=this._results.concat(t),this._onStateChanged.fire())}resolve(){this._state===0&&(this._state=1,this._onStateChanged.fire())}reject(t){this._state===0&&(this._state=2,this._error=t,this._onStateChanged.fire())}};Xm.EMPTY=Xm.fromArray([]);function S6(e){return 55296<=e&&e<=56319}function Um(e){return 56320<=e&&e<=57343}function C6(e,t){return(e-55296<<10)+(t-56320)+65536}function k6(e){return Zu(e,0)}function Zu(e,t){switch(typeof e){case"object":return e===null?Ni(349,t):Array.isArray(e)?B6(e,t):L6(e,t);case"string":return L1(e,t);case"boolean":return E6(e,t);case"number":return Ni(e,t);case"undefined":return Ni(937,t);default:return Ni(617,t)}}function Ni(e,t){return(t<<5)-t+e|0}function E6(e,t){return Ni(e?433:863,t)}function L1(e,t){t=Ni(149417,t);for(let i=0,r=e.length;i<r;i++)t=Ni(e.charCodeAt(i),t);return t}function B6(e,t){return t=Ni(104579,t),e.reduce((i,r)=>Zu(r,i),t)}function L6(e,t){return t=Ni(181387,t),Object.keys(e).sort().reduce((i,r)=>(i=L1(r,i),Zu(e[r],i)),t)}function Fu(e,t,i=32){let r=i-t,s=~((1<<r)-1);return(e<<t|(s&e)>>>r)>>>0}function zm(e,t=0,i=e.byteLength,r=0){for(let s=0;s<i;s++)e[t+s]=r}function D6(e,t,i="0"){for(;e.length<t;)e=i+e;return e}function $n(e,t=32){return e instanceof ArrayBuffer?Array.from(new Uint8Array(e)).map(i=>i.toString(16).padStart(2,"0")).join(""):D6((e>>>0).toString(16),t/4)}var I6=class D1{constructor(){this._h0=1732584193,this._h1=4023233417,this._h2=2562383102,this._h3=271733878,this._h4=3285377520,this._buff=new Uint8Array(67),this._buffDV=new DataView(this._buff.buffer),this._buffLen=0,this._totalLen=0,this._leftoverHighSurrogate=0,this._finished=!1}update(t){let i=t.length;if(i===0)return;let r=this._buff,s=this._buffLen,n=this._leftoverHighSurrogate,o,a;for(n!==0?(o=n,a=-1,n=0):(o=t.charCodeAt(0),a=0);;){let h=o;if(S6(o))if(a+1<i){let l=t.charCodeAt(a+1);Um(l)?(a++,h=C6(o,l)):h=65533}else{n=o;break}else Um(o)&&(h=65533);if(s=this._push(r,s,h),a++,a<i)o=t.charCodeAt(a);else break}this._buffLen=s,this._leftoverHighSurrogate=n}_push(t,i,r){return r<128?t[i++]=r:r<2048?(t[i++]=192|(r&1984)>>>6,t[i++]=128|(r&63)>>>0):r<65536?(t[i++]=224|(r&61440)>>>12,t[i++]=128|(r&4032)>>>6,t[i++]=128|(r&63)>>>0):(t[i++]=240|(r&1835008)>>>18,t[i++]=128|(r&258048)>>>12,t[i++]=128|(r&4032)>>>6,t[i++]=128|(r&63)>>>0),i>=64&&(this._step(),i-=64,this._totalLen+=64,t[0]=t[64],t[1]=t[65],t[2]=t[66]),i}digest(){return this._finished||(this._finished=!0,this._leftoverHighSurrogate&&(this._leftoverHighSurrogate=0,this._buffLen=this._push(this._buff,this._buffLen,65533)),this._totalLen+=this._buffLen,this._wrapUp()),$n(this._h0)+$n(this._h1)+$n(this._h2)+$n(this._h3)+$n(this._h4)}_wrapUp(){this._buff[this._buffLen++]=128,zm(this._buff,this._buffLen),this._buffLen>56&&(this._step(),zm(this._buff));let t=8*this._totalLen;this._buffDV.setUint32(56,Math.floor(t/4294967296),!1),this._buffDV.setUint32(60,t%4294967296,!1),this._step()}_step(){let t=D1._bigBlock32,i=this._buffDV;for(let u=0;u<64;u+=4)t.setUint32(u,i.getUint32(u,!1),!1);for(let u=64;u<320;u+=4)t.setUint32(u,Fu(t.getUint32(u-12,!1)^t.getUint32(u-32,!1)^t.getUint32(u-56,!1)^t.getUint32(u-64,!1),1),!1);let r=this._h0,s=this._h1,n=this._h2,o=this._h3,a=this._h4,h,l,c;for(let u=0;u<80;u++)u<20?(h=s&n|~s&o,l=1518500249):u<40?(h=s^n^o,l=1859775393):u<60?(h=s&n|s&o|n&o,l=2400959708):(h=s^n^o,l=3395469782),c=Fu(r,5)+h+a+l+t.getUint32(u*4,!1)&4294967295,a=o,o=n,n=Fu(s,30),s=r,r=c;this._h0=this._h0+r&4294967295,this._h1=this._h1+s&4294967295,this._h2=this._h2+n&4294967295,this._h3=this._h3+o&4294967295,this._h4=this._h4+a&4294967295}};I6._bigBlock32=new DataView(new ArrayBuffer(320));var{registerWindow:lT,getWindow:M6,getDocument:hT,getWindows:cT,getWindowsCount:uT,getWindowId:Wm,getWindowById:dT,hasWindow:fT,onDidRegisterWindow:_T,onWillUnregisterWindow:gT,onDidUnregisterWindow:pT}=function(){let e=new Map,t={window:Yt,disposables:new As};e.set(Yt.vscodeWindowId,t);let i=new pe,r=new pe,s=new pe;function n(o,a){return(typeof o=="number"?e.get(o):void 0)??(a?t:void 0)}return{onDidRegisterWindow:i.event,onWillUnregisterWindow:s.event,onDidUnregisterWindow:r.event,registerWindow(o){if(e.has(o.vscodeWindowId))return It.None;let a=new As,h={window:o,disposables:a.add(new As)};return e.set(o.vscodeWindowId,h),a.add(nt(()=>{e.delete(o.vscodeWindowId),r.fire(o)})),a.add(ju(o,F6.BEFORE_UNLOAD,()=>{s.fire(o)})),i.fire(h),a},getWindows(){return e.values()},getWindowsCount(){return e.size},getWindowId(o){return o.vscodeWindowId},hasWindow(o){return e.has(o)},getWindowById:n,getWindow(o){let a=o;if(a?.ownerDocument?.defaultView)return a.ownerDocument.defaultView.window;let h=o;return h?.view?h.view.window:Yt},getDocument(o){return M6(o).document}}}(),T6=class{constructor(e,t,i,r){this._node=e,this._type=t,this._handler=i,this._options=r||!1,this._node.addEventListener(this._type,this._handler,this._options)}dispose(){this._handler&&(this._node.removeEventListener(this._type,this._handler,this._options),this._node=null,this._handler=null)}};function ju(e,t,i,r){return new T6(e,t,i,r)}var R6,$m,Pu=class{constructor(e,t=0){this._runner=e,this.priority=t,this._canceled=!1}dispose(){this._canceled=!0}execute(){if(!this._canceled)try{this._runner()}catch(e){qa(e)}}static sort(e,t){return t.priority-e.priority}};(function(){let e=new Map,t=new Map,i=new Map,r=new Map,s=n=>{i.set(n,!1);let o=e.get(n)??[];for(t.set(n,o),e.set(n,[]),r.set(n,!0);o.length>0;)o.sort(Pu.sort),o.shift().execute();r.set(n,!1)};$m=(n,o,a=0)=>{let h=Wm(n),l=new Pu(o,a),c=e.get(h);return c||(c=[],e.set(h,c)),c.push(l),i.get(h)||(i.set(h,!0),n.requestAnimationFrame(()=>s(h))),l},R6=(n,o,a)=>{let h=Wm(n);if(r.get(h)){let l=new Pu(o,a),c=t.get(h);return c||(c=[],t.set(h,c)),c.push(l),l}else return $m(n,o,a)}})();var Gm=class rl{constructor(t,i){this.width=t,this.height=i}with(t=this.width,i=this.height){return t!==this.width||i!==this.height?new rl(t,i):this}static is(t){return typeof t=="object"&&typeof t.height=="number"&&typeof t.width=="number"}static lift(t){return t instanceof rl?t:new rl(t.width,t.height)}static equals(t,i){return t===i?!0:!t||!i?!1:t.width===i.width&&t.height===i.height}};Gm.None=new Gm(0,0);var vT=new class{constructor(){this.mutationObservers=new Map}observe(e,t,i){let r=this.mutationObservers.get(e);r||(r=new Map,this.mutationObservers.set(e,r));let s=k6(i),n=r.get(s);if(n)n.users+=1;else{let o=new pe,a=new MutationObserver(l=>o.fire(l));a.observe(e,i);let h=n={users:1,observer:a,onDidMutate:o.event};t.add(nt(()=>{h.users-=1,h.users===0&&(o.dispose(),a.disconnect(),r?.delete(s),r?.size===0&&this.mutationObservers.delete(e))})),r.set(s,n)}return n.onDidMutate}},F6={CLICK:"click",AUXCLICK:"auxclick",DBLCLICK:"dblclick",MOUSE_UP:"mouseup",MOUSE_DOWN:"mousedown",MOUSE_OVER:"mouseover",MOUSE_MOVE:"mousemove",MOUSE_OUT:"mouseout",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_WHEEL:"wheel",POINTER_UP:"pointerup",POINTER_DOWN:"pointerdown",POINTER_MOVE:"pointermove",POINTER_LEAVE:"pointerleave",CONTEXT_MENU:"contextmenu",WHEEL:"wheel",KEY_DOWN:"keydown",KEY_PRESS:"keypress",KEY_UP:"keyup",LOAD:"load",BEFORE_UNLOAD:"beforeunload",UNLOAD:"unload",PAGE_SHOW:"pageshow",PAGE_HIDE:"pagehide",PASTE:"paste",ABORT:"abort",ERROR:"error",RESIZE:"resize",SCROLL:"scroll",FULLSCREEN_CHANGE:"fullscreenchange",WK_FULLSCREEN_CHANGE:"webkitfullscreenchange",SELECT:"select",CHANGE:"change",SUBMIT:"submit",RESET:"reset",FOCUS:"focus",FOCUS_IN:"focusin",FOCUS_OUT:"focusout",BLUR:"blur",INPUT:"input",STORAGE:"storage",DRAG_START:"dragstart",DRAG:"drag",DRAG_ENTER:"dragenter",DRAG_LEAVE:"dragleave",DRAG_OVER:"dragover",DROP:"drop",DRAG_END:"dragend",ANIMATION_START:Du?"webkitAnimationStart":"animationstart",ANIMATION_END:Du?"webkitAnimationEnd":"animationend",ANIMATION_ITERATION:Du?"webkitAnimationIteration":"animationiteration"},P6=/([\w\-]+)?(#([\w\-]+))?((\.([\w\-]+))*)/;function I1(e,t,i,...r){let s=P6.exec(t);if(!s)throw new Error("Bad use of emmet");let n=s[1]||"div",o;return e!=="http://www.w3.org/1999/xhtml"?o=document.createElementNS(e,n):o=document.createElement(n),s[3]&&(o.id=s[3]),s[4]&&(o.className=s[4].replace(/\./g," ").trim()),i&&Object.entries(i).forEach(([a,h])=>{typeof h>"u"||(/^on\w+$/.test(a)?o[a]=h:a==="selected"?h&&o.setAttribute(a,"true"):o.setAttribute(a,h))}),o.append(...r),o}function O6(e,t,...i){return I1("http://www.w3.org/1999/xhtml",e,t,...i)}O6.SVG=function(e,t,...i){return I1("http://www.w3.org/2000/svg",e,t,...i)};var K6=class extends It{constructor(e,t,i,r,s,n,o,a,h){super(),this._terminal=e,this._characterJoinerService=t,this._charSizeService=i,this._coreBrowserService=r,this._coreService=s,this._decorationService=n,this._optionsService=o,this._themeService=a,this._cursorBlinkStateManager=new Xn,this._charAtlasDisposable=this._register(new Xn),this._observerDisposable=this._register(new Xn),this._model=new V3,this._workCell=new Dm,this._workCell2=new Dm,this._rectangleRenderer=this._register(new Xn),this._glyphRenderer=this._register(new Xn),this._onChangeTextureAtlas=this._register(new pe),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this._register(new pe),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=this._register(new pe),this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._onRequestRedraw=this._register(new pe),this.onRequestRedraw=this._onRequestRedraw.event,this._onContextLoss=this._register(new pe),this.onContextLoss=this._onContextLoss.event,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas");let l={antialias:!1,depth:!1,preserveDrawingBuffer:h};if(this._gl=this._canvas.getContext("webgl2",l),!this._gl)throw new Error("WebGL2 not supported "+this._gl);this._register(this._themeService.onChangeColors(()=>this._handleColorChange())),this._cellColorResolver=new u3(this._terminal,this._optionsService,this._model.selection,this._decorationService,this._coreBrowserService,this._themeService),this._core=this._terminal._core,this._renderLayers=[new i6(this._core.screenElement,2,this._terminal,this._core.linkifier,this._coreBrowserService,o,this._themeService)],this.dimensions=h3(),this._devicePixelRatio=this._coreBrowserService.dpr,this._updateDimensions(),this._updateCursorBlink(),this._register(o.onOptionChange(()=>this._handleOptionsChanged())),this._deviceMaxTextureSize=this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),this._register(ju(this._canvas,"webglcontextlost",c=>{console.log("webglcontextlost event received"),c.preventDefault(),this._contextRestorationTimeout=setTimeout(()=>{this._contextRestorationTimeout=void 0,console.warn("webgl context not restored; firing onContextLoss"),this._onContextLoss.fire(c)},3e3)})),this._register(ju(this._canvas,"webglcontextrestored",c=>{console.warn("webglcontextrestored event received"),clearTimeout(this._contextRestorationTimeout),this._contextRestorationTimeout=void 0,Bm(this._terminal),this._initializeWebGLState(),this._requestRedrawViewport()})),this._observerDisposable.value=Lm(this._canvas,this._coreBrowserService.window,(c,u)=>this._setCanvasDevicePixelDimensions(c,u)),this._register(this._coreBrowserService.onWindowChange(c=>{this._observerDisposable.value=Lm(this._canvas,c,(u,p)=>this._setCanvasDevicePixelDimensions(u,p))})),this._core.screenElement.appendChild(this._canvas),[this._rectangleRenderer.value,this._glyphRenderer.value]=this._initializeWebGLState(),this._isAttached=this._core.screenElement.isConnected,this._register(nt(()=>{for(let c of this._renderLayers)c.dispose();this._canvas.parentElement?.removeChild(this._canvas),Bm(this._terminal)}))}get textureAtlas(){return this._charAtlas?.pages[0].canvas}_handleColorChange(){this._refreshCharAtlas(),this._clearModel(!0)}handleDevicePixelRatioChange(){this._devicePixelRatio!==this._coreBrowserService.dpr&&(this._devicePixelRatio=this._coreBrowserService.dpr,this.handleResize(this._terminal.cols,this._terminal.rows))}handleResize(e,t){this._updateDimensions(),this._model.resize(this._terminal.cols,this._terminal.rows);for(let i of this._renderLayers)i.resize(this._terminal,this.dimensions);this._canvas.width=this.dimensions.device.canvas.width,this._canvas.height=this.dimensions.device.canvas.height,this._canvas.style.width=`${this.dimensions.css.canvas.width}px`,this._canvas.style.height=`${this.dimensions.css.canvas.height}px`,this._core.screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._core.screenElement.style.height=`${this.dimensions.css.canvas.height}px`,this._rectangleRenderer.value?.setDimensions(this.dimensions),this._rectangleRenderer.value?.handleResize(),this._glyphRenderer.value?.setDimensions(this.dimensions),this._glyphRenderer.value?.handleResize(),this._refreshCharAtlas(),this._clearModel(!1)}handleCharSizeChanged(){this.handleResize(this._terminal.cols,this._terminal.rows)}handleBlur(){for(let e of this._renderLayers)e.handleBlur(this._terminal);this._cursorBlinkStateManager.value?.pause(),this._requestRedrawViewport()}handleFocus(){for(let e of this._renderLayers)e.handleFocus(this._terminal);this._cursorBlinkStateManager.value?.resume(),this._requestRedrawViewport()}handleSelectionChanged(e,t,i){for(let r of this._renderLayers)r.handleSelectionChanged(this._terminal,e,t,i);this._model.selection.update(this._core,e,t,i),this._requestRedrawViewport()}handleCursorMove(){for(let e of this._renderLayers)e.handleCursorMove(this._terminal);this._cursorBlinkStateManager.value?.restartBlinkAnimation()}_handleOptionsChanged(){this._updateDimensions(),this._refreshCharAtlas(),this._updateCursorBlink()}_initializeWebGLState(){return this._rectangleRenderer.value=new e6(this._terminal,this._gl,this.dimensions,this._themeService),this._glyphRenderer.value=new $3(this._terminal,this._gl,this.dimensions,this._optionsService),this.handleCharSizeChanged(),[this._rectangleRenderer.value,this._glyphRenderer.value]}_refreshCharAtlas(){if(this.dimensions.device.char.width<=0&&this.dimensions.device.char.height<=0){this._isAttached=!1;return}let e=b1(this._terminal,this._optionsService.rawOptions,this._themeService.colors,this.dimensions.device.cell.width,this.dimensions.device.cell.height,this.dimensions.device.char.width,this.dimensions.device.char.height,this._coreBrowserService.dpr,this._deviceMaxTextureSize);this._charAtlas!==e&&(this._onChangeTextureAtlas.fire(e.pages[0].canvas),this._charAtlasDisposable.value=r1(Ki.forward(e.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas),Ki.forward(e.onRemoveTextureAtlasCanvas,this._onRemoveTextureAtlasCanvas))),this._charAtlas=e,this._charAtlas.warmUp(),this._glyphRenderer.value?.setAtlas(this._charAtlas)}_clearModel(e){this._model.clear(),e&&this._glyphRenderer.value?.clear()}clearTextureAtlas(){this._charAtlas?.clearTexture(),this._clearModel(!0),this._requestRedrawViewport()}clear(){this._clearModel(!0);for(let e of this._renderLayers)e.reset(this._terminal);this._cursorBlinkStateManager.value?.restartBlinkAnimation(),this._updateCursorBlink()}renderRows(e,t){if(!this._isAttached)if(this._core.screenElement?.isConnected&&this._charSizeService.width&&this._charSizeService.height)this._updateDimensions(),this._refreshCharAtlas(),this._isAttached=!0;else return;for(let i of this._renderLayers)i.handleGridChanged(this._terminal,e,t);!this._glyphRenderer.value||!this._rectangleRenderer.value||(this._glyphRenderer.value.beginFrame()?(this._clearModel(!0),this._updateModel(0,this._terminal.rows-1)):this._updateModel(e,t),this._rectangleRenderer.value.renderBackgrounds(),this._glyphRenderer.value.render(this._model),(!this._cursorBlinkStateManager.value||this._cursorBlinkStateManager.value.isCursorVisible)&&this._rectangleRenderer.value.renderCursor())}_updateCursorBlink(){this._coreService.decPrivateModes.cursorBlink??this._terminal.options.cursorBlink?this._cursorBlinkStateManager.value=new N3(()=>{this._requestRedrawCursor()},this._coreBrowserService):this._cursorBlinkStateManager.clear(),this._requestRedrawCursor()}_updateModel(e,t){let i=this._core,r=this._workCell,s,n,o,a,h,l,c=0,u=!0,p,g,v,m,x,E,R,D,b;e=jm(e,i.rows-1,0),t=jm(t,i.rows-1,0);let L=this._coreService.decPrivateModes.cursorStyle??i.options.cursorStyle??"block",I=this._terminal.buffer.active.baseY+this._terminal.buffer.active.cursorY,T=I-i.buffer.ydisp,q=Math.min(this._terminal.buffer.active.cursorX,i.cols-1),$=-1,V=this._coreService.isCursorInitialized&&!this._coreService.isCursorHidden&&(!this._cursorBlinkStateManager.value||this._cursorBlinkStateManager.value.isCursorVisible);this._model.cursor=void 0;let j=!1;for(n=e;n<=t;n++)for(o=n+i.buffer.ydisp,a=i.buffer.lines.get(o),this._model.lineLengths[n]=0,v=I===o,c=0,h=this._characterJoinerService.getJoinedCharacters(o),D=0;D<i.cols;D++){if(s=this._cellColorResolver.result.bg,a.loadCell(D,r),D===0&&(s=this._cellColorResolver.result.bg),l=!1,u=D>=c,p=D,h.length>0&&D===h[0][0]&&u){g=h.shift();let ne=this._model.selection.isCellSelected(this._terminal,g[0],o);for(R=g[0]+1;R<g[1];R++)u&&=ne===this._model.selection.isCellSelected(this._terminal,R,o);u&&=!v||q<g[0]||q>=g[1],u?(l=!0,r=new N6(r,a.translateToString(!0,g[0],g[1]),g[1]-g[0]),p=g[1]-1):c=g[1]}if(m=r.getChars(),x=r.getCode(),R=(n*i.cols+D)*sl,this._cellColorResolver.resolve(r,D,o,this.dimensions.device.cell.width),V&&o===I&&(D===q&&(this._model.cursor={x:q,y:T,width:r.getWidth(),style:this._coreBrowserService.isFocused?L:i.options.cursorInactiveStyle,cursorWidth:i.options.cursorWidth,dpr:this._devicePixelRatio},$=q+r.getWidth()-1),D>=q&&D<=$&&(this._coreBrowserService.isFocused&&L==="block"||this._coreBrowserService.isFocused===!1&&i.options.cursorInactiveStyle==="block")&&(this._cellColorResolver.result.fg=50331648|this._themeService.colors.cursorAccent.rgba>>8&16777215,this._cellColorResolver.result.bg=50331648|this._themeService.colors.cursor.rgba>>8&16777215)),x!==0&&(this._model.lineLengths[n]=D+1),!(this._model.cells[R]===x&&this._model.cells[R+Ja]===this._cellColorResolver.result.bg&&this._model.cells[R+Za]===this._cellColorResolver.result.fg&&this._model.cells[R+Bu]===this._cellColorResolver.result.ext)&&(j=!0,m.length>1&&(x|=q3),this._model.cells[R]=x,this._model.cells[R+Ja]=this._cellColorResolver.result.bg,this._model.cells[R+Za]=this._cellColorResolver.result.fg,this._model.cells[R+Bu]=this._cellColorResolver.result.ext,E=r.getWidth(),this._glyphRenderer.value.updateCell(D,n,x,this._cellColorResolver.result.bg,this._cellColorResolver.result.fg,this._cellColorResolver.result.ext,m,E,s),l)){for(r=this._workCell,D++;D<=p;D++)b=(n*i.cols+D)*sl,this._glyphRenderer.value.updateCell(D,n,0,0,0,0,i3,0,0),this._model.cells[b]=0,this._model.cells[b+Ja]=this._cellColorResolver.result.bg,this._model.cells[b+Za]=this._cellColorResolver.result.fg,this._model.cells[b+Bu]=this._cellColorResolver.result.ext;D--}}j&&this._rectangleRenderer.value.updateBackgrounds(this._model),this._rectangleRenderer.value.updateCursor(this._model)}_updateDimensions(){!this._charSizeService.width||!this._charSizeService.height||(this.dimensions.device.char.width=Math.floor(this._charSizeService.width*this._devicePixelRatio),this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*this._devicePixelRatio),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.top=this._optionsService.rawOptions.lineHeight===1?0:Math.round((this.dimensions.device.cell.height-this.dimensions.device.char.height)/2),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.char.left=Math.floor(this._optionsService.rawOptions.letterSpacing/2),this.dimensions.device.canvas.height=this._terminal.rows*this.dimensions.device.cell.height,this.dimensions.device.canvas.width=this._terminal.cols*this.dimensions.device.cell.width,this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/this._devicePixelRatio),this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/this._devicePixelRatio),this.dimensions.css.cell.height=this.dimensions.device.cell.height/this._devicePixelRatio,this.dimensions.css.cell.width=this.dimensions.device.cell.width/this._devicePixelRatio)}_setCanvasDevicePixelDimensions(e,t){this._canvas.width===e&&this._canvas.height===t||(this._canvas.width=e,this._canvas.height=t,this._requestRedrawViewport())}_requestRedrawViewport(){this._onRequestRedraw.fire({start:0,end:this._terminal.rows-1})}_requestRedrawCursor(){let e=this._terminal.buffer.active.cursorY;this._onRequestRedraw.fire({start:e,end:e})}},N6=class extends bs{constructor(e,t,i){super(),this.content=0,this.combinedData="",this.fg=e.fg,this.bg=e.bg,this.combinedData=t,this._width=i}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(e){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}};function jm(e,t,i=0){return Math.max(Math.min(e,t),i)}var qm="di$target",Vm="di$dependencies",Ou=new Map;function pi(e){if(Ou.has(e))return Ou.get(e);let t=function(i,r,s){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");Q6(t,i,s)};return t._id=e,Ou.set(e,t),t}function Q6(e,t,i){t[qm]===t?t[Vm].push({id:e,index:i}):(t[Vm]=[{id:e,index:i}],t[qm]=t)}var mT=pi("BufferService"),yT=pi("CoreMouseService"),bT=pi("CoreService"),wT=pi("CharsetService"),AT=pi("InstantiationService"),xT=pi("LogService"),H6=pi("OptionsService"),ST=pi("OscLinkService"),CT=pi("UnicodeService"),kT=pi("DecorationService"),X6={trace:0,debug:1,info:2,warn:3,error:4,off:5},U6="xterm.js: ",Ym=class extends It{constructor(e){super(),this._optionsService=e,this._logLevel=5,this._updateLogLevel(),this._register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),M1=this}get logLevel(){return this._logLevel}_updateLogLevel(){this._logLevel=X6[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(e){for(let t=0;t<e.length;t++)typeof e[t]=="function"&&(e[t]=e[t]())}_log(e,t,i){this._evalLazyOptionalParams(i),e.call(console,(this._optionsService.options.logger?"":U6)+t,...i)}trace(e,...t){this._logLevel<=0&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,e,t)}debug(e,...t){this._logLevel<=1&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,e,t)}info(e,...t){this._logLevel<=2&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,e,t)}warn(e,...t){this._logLevel<=3&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,e,t)}error(e,...t){this._logLevel<=4&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,e,t)}};Ym=PE([OE(0,H6)],Ym);var M1;function z6(e){M1=e}var T1=class extends It{constructor(e){if(o1&&t3()<16){let t={antialias:!1,depth:!1,preserveDrawingBuffer:!0};if(!document.createElement("canvas").getContext("webgl2",t))throw new Error("Webgl2 is only supported on Safari 16 and above")}super(),this._preserveDrawingBuffer=e,this._onChangeTextureAtlas=this._register(new pe),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this._register(new pe),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=this._register(new pe),this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._onContextLoss=this._register(new pe),this.onContextLoss=this._onContextLoss.event}activate(e){let t=e._core;if(!e.element){this._register(t.onWillOpen(()=>this.activate(e)));return}this._terminal=e;let i=t.coreService,r=t.optionsService,s=t,n=s._renderService,o=s._characterJoinerService,a=s._charSizeService,h=s._coreBrowserService,l=s._decorationService,c=s._logService,u=s._themeService;z6(c),this._renderer=this._register(new K6(e,o,a,h,i,l,r,u,this._preserveDrawingBuffer)),this._register(Ki.forward(this._renderer.onContextLoss,this._onContextLoss)),this._register(Ki.forward(this._renderer.onChangeTextureAtlas,this._onChangeTextureAtlas)),this._register(Ki.forward(this._renderer.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas)),this._register(Ki.forward(this._renderer.onRemoveTextureAtlasCanvas,this._onRemoveTextureAtlasCanvas)),n.setRenderer(this._renderer),this._register(nt(()=>{if(this._terminal._core._store._isDisposed)return;let p=this._terminal._core._renderService;p.setRenderer(this._terminal._core._createRenderer()),p.handleResize(e.cols,e.rows)}))}get textureAtlas(){return this._renderer?.textureAtlas}clearTextureAtlas(){this._renderer?.clearTextureAtlas()}};var W6=class{constructor(e,t,i,r={}){this._terminal=e,this._regex=t,this._handler=i,this._options=r}provideLinks(e,t){let i=G6.computeLink(e,this._regex,this._terminal,this._handler);t(this._addCallbacks(i))}_addCallbacks(e){return e.map(t=>(t.leave=this._options.leave,t.hover=(i,r)=>{if(this._options.hover){let{range:s}=t;this._options.hover(i,r,s)}},t))}};function $6(e){try{let t=new URL(e),i=t.password&&t.username?`${t.protocol}//${t.username}:${t.password}@${t.host}`:t.username?`${t.protocol}//${t.username}@${t.host}`:`${t.protocol}//${t.host}`;return e.toLocaleLowerCase().startsWith(i.toLocaleLowerCase())}catch{return!1}}var G6=class al{static computeLink(t,i,r,s){let n=new RegExp(i.source,(i.flags||"")+"g"),[o,a]=al._getWindowedLineStrings(t-1,r),h=o.join(""),l,c=[];for(;l=n.exec(h);){let u=l[0];if(!$6(u))continue;let[p,g]=al._mapStrIdx(r,a,0,l.index),[v,m]=al._mapStrIdx(r,p,g,u.length);if(p===-1||g===-1||v===-1||m===-1)continue;let x={start:{x:g+1,y:p+1},end:{x:m,y:v+1}};c.push({range:x,text:u,activate:s})}return c}static _getWindowedLineStrings(t,i){let r,s=t,n=t,o=0,a="",h=[];if(r=i.buffer.active.getLine(t)){let l=r.translateToString(!0);if(r.isWrapped&&l[0]!==" "){for(o=0;(r=i.buffer.active.getLine(--s))&&o<2048&&(a=r.translateToString(!0),o+=a.length,h.push(a),!(!r.isWrapped||a.indexOf(" ")!==-1)););h.reverse()}for(h.push(l),o=0;(r=i.buffer.active.getLine(++n))&&r.isWrapped&&o<2048&&(a=r.translateToString(!0),o+=a.length,h.push(a),a.indexOf(" ")===-1););}return[h,s]}static _mapStrIdx(t,i,r,s){let n=t.buffer.active,o=n.getNullCell(),a=r;for(;s;){let h=n.getLine(i);if(!h)return[-1,-1];for(let l=a;l<h.length;++l){h.getCell(l,o);let c=o.getChars();if(o.getWidth()&&(s-=c.length||1,l===h.length-1&&c==="")){let u=n.getLine(i+1);u&&u.isWrapped&&(u.getCell(0,o),o.getWidth()===2&&(s+=1))}if(s<0)return[i,l]}i++,a=0}return[i,a]}},j6=/(https?|HTTPS?):[/]{2}[^\s"'!*(){}|\\\^<>`]*[^\s"':,.!?{}|\\\^~\[\]`()<>]/;function q6(e,t){let i=window.open();if(i){try{i.opener=null}catch{}i.location.href=t}else console.warn("Opening link blocked as opener could not be cleared")}var R1=class{constructor(e=q6,t={}){this._handler=e,this._options=t}activate(e){this._terminal=e;let t=this._options,i=t.urlRegex||j6;this._linkProvider=this._terminal.registerLinkProvider(new W6(this._terminal,i,this._handler,t))}dispose(){this._linkProvider?.dispose()}};var ed=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],V6=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],We;function Y6(e,t){let i=0,r=t.length-1,s;if(e<t[0][0]||e>t[r][1])return!1;for(;r>=i;)if(s=i+r>>1,e>t[s][1])i=s+1;else if(e<t[s][0])r=s-1;else return!0;return!1}var J6=class{constructor(){if(this.version="6",!We){We=new Uint8Array(65536),We.fill(1),We[0]=0,We.fill(0,1,32),We.fill(0,127,160),We.fill(2,4352,4448),We[9001]=2,We[9002]=2,We.fill(2,11904,42192),We[12351]=1,We.fill(2,44032,55204),We.fill(2,63744,64256),We.fill(2,65040,65050),We.fill(2,65072,65136),We.fill(2,65280,65377),We.fill(2,65504,65511);for(let e=0;e<ed.length;++e)We.fill(0,ed[e][0],ed[e][1]+1)}}wcwidth(e){return e<32?0:e<127?1:e<65536?We[e]:Y6(e,V6)?0:e>=131072&&e<=196605||e>=196608&&e<=262141?2:1}charProperties(e,t){let i=this.wcwidth(e),r=i===0&&t!==0;if(r){let s=ul.extractWidth(t);s===0?r=!1:s>i&&(i=s)}return ul.createPropertyValue(0,i,r)}},Z6=class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(e){setTimeout(()=>{throw e.stack?F1.isErrorNoTelemetry(e)?new F1(e.message+`

`+e.stack):new Error(e.message+`

`+e.stack):e},0)}}addListener(e){return this.listeners.push(e),()=>{this._removeListener(e)}}emit(e){this.listeners.forEach(t=>{t(e)})}_removeListener(e){this.listeners.splice(this.listeners.indexOf(e),1)}setUnexpectedErrorHandler(e){this.unexpectedErrorHandler=e}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(e){this.unexpectedErrorHandler(e),this.emit(e)}onUnexpectedExternalError(e){this.unexpectedErrorHandler(e)}},eB=new Z6;function td(e){tB(e)||eB.onUnexpectedError(e)}var sd="Canceled";function tB(e){return e instanceof iB?!0:e instanceof Error&&e.name===sd&&e.message===sd}var iB=class extends Error{constructor(){super(sd),this.name=this.message}},F1=class nd extends Error{constructor(t){super(t),this.name="CodeExpectedError"}static fromError(t){if(t instanceof nd)return t;let i=new nd;return i.message=t.message,i.stack=t.stack,i}static isErrorNoTelemetry(t){return t.name==="CodeExpectedError"}};function rB(e,t){let i=this,r=!1,s;return function(){if(r)return s;if(r=!0,t)try{s=e.apply(i,arguments)}finally{t()}else s=e.apply(i,arguments);return s}}function sB(e,t,i=0,r=e.length){let s=i,n=r;for(;s<n;){let o=Math.floor((s+n)/2);t(e[o])?s=o+1:n=o}return s-1}var nB=class U1{constructor(t){this._array=t,this._findLastMonotonousLastIdx=0}findLastMonotonous(t){if(U1.assertInvariants){if(this._prevFindLastPredicate){for(let r of this._array)if(this._prevFindLastPredicate(r)&&!t(r))throw new Error("MonotonousArray: current predicate must be weaker than (or equal to) the previous predicate.")}this._prevFindLastPredicate=t}let i=sB(this._array,t,this._findLastMonotonousLastIdx);return this._findLastMonotonousLastIdx=i+1,i===-1?void 0:this._array[i]}};nB.assertInvariants=!1;var z1;(e=>{function t(n){return n<0}e.isLessThan=t;function i(n){return n<=0}e.isLessThanOrEqual=i;function r(n){return n>0}e.isGreaterThan=r;function s(n){return n===0}e.isNeitherLessOrGreaterThan=s,e.greaterThan=1,e.lessThan=-1,e.neitherLessOrGreaterThan=0})(z1||={});function oB(e,t){return(i,r)=>t(e(i),e(r))}var aB=(e,t)=>e-t,P1=class od{constructor(t){this.iterate=t}forEach(t){this.iterate(i=>(t(i),!0))}toArray(){let t=[];return this.iterate(i=>(t.push(i),!0)),t}filter(t){return new od(i=>this.iterate(r=>t(r)?i(r):!0))}map(t){return new od(i=>this.iterate(r=>i(t(r))))}some(t){let i=!1;return this.iterate(r=>(i=t(r),!i)),i}findFirst(t){let i;return this.iterate(r=>t(r)?(i=r,!1):!0),i}findLast(t){let i;return this.iterate(r=>(t(r)&&(i=r),!0)),i}findLastMaxBy(t){let i,r=!0;return this.iterate(s=>((r||z1.isGreaterThan(t(s,i)))&&(r=!1,i=s),!0)),i}};P1.empty=new P1(e=>{});function lB(e,t){let i=Object.create(null);for(let r of e){let s=t(r),n=i[s];n||(n=i[s]=[]),n.push(r)}return i}var O1,K1,_R=class{constructor(e,t){this.toKey=t,this._map=new Map,this[O1]="SetWithKey";for(let i of e)this.add(i)}get size(){return this._map.size}add(e){let t=this.toKey(e);return this._map.set(t,e),this}delete(e){return this._map.delete(this.toKey(e))}has(e){return this._map.has(this.toKey(e))}*entries(){for(let e of this._map.values())yield[e,e]}keys(){return this.values()}*values(){for(let e of this._map.values())yield e}clear(){this._map.clear()}forEach(e,t){this._map.forEach(i=>e.call(t,i,i,this))}[(K1=Symbol.iterator,O1=Symbol.toStringTag,K1)](){return this.values()}},hB=class{constructor(){this.map=new Map}add(e,t){let i=this.map.get(e);i||(i=new Set,this.map.set(e,i)),i.add(t)}delete(e,t){let i=this.map.get(e);i&&(i.delete(t),i.size===0&&this.map.delete(e))}forEach(e,t){let i=this.map.get(e);i&&i.forEach(t)}get(e){return this.map.get(e)||new Set}},W1;(e=>{function t(b){return b&&typeof b=="object"&&typeof b[Symbol.iterator]=="function"}e.is=t;let i=Object.freeze([]);function r(){return i}e.empty=r;function*s(b){yield b}e.single=s;function n(b){return t(b)?b:s(b)}e.wrap=n;function o(b){return b||i}e.from=o;function*a(b){for(let L=b.length-1;L>=0;L--)yield b[L]}e.reverse=a;function h(b){return!b||b[Symbol.iterator]().next().done===!0}e.isEmpty=h;function l(b){return b[Symbol.iterator]().next().value}e.first=l;function c(b,L){let I=0;for(let T of b)if(L(T,I++))return!0;return!1}e.some=c;function u(b,L){for(let I of b)if(L(I))return I}e.find=u;function*p(b,L){for(let I of b)L(I)&&(yield I)}e.filter=p;function*g(b,L){let I=0;for(let T of b)yield L(T,I++)}e.map=g;function*v(b,L){let I=0;for(let T of b)yield*L(T,I++)}e.flatMap=v;function*m(...b){for(let L of b)yield*L}e.concat=m;function x(b,L,I){let T=I;for(let q of b)T=L(T,q);return T}e.reduce=x;function*E(b,L,I=b.length){for(L<0&&(L+=b.length),I<0?I+=b.length:I>b.length&&(I=b.length);L<I;L++)yield b[L]}e.slice=E;function R(b,L=Number.POSITIVE_INFINITY){let I=[];if(L===0)return[I,b];let T=b[Symbol.iterator]();for(let q=0;q<L;q++){let $=T.next();if($.done)return[I,e.empty()];I.push($.value)}return[I,{[Symbol.iterator](){return T}}]}e.consume=R;async function D(b){let L=[];for await(let I of b)L.push(I);return Promise.resolve(L)}e.asyncToArray=D})(W1||={});var cB=!1,Cs=null,uB=class $1{constructor(){this.livingDisposables=new Map}getDisposableData(t){let i=this.livingDisposables.get(t);return i||(i={parent:null,source:null,isSingleton:!1,value:t,idx:$1.idx++},this.livingDisposables.set(t,i)),i}trackDisposable(t){let i=this.getDisposableData(t);i.source||(i.source=new Error().stack)}setParent(t,i){let r=this.getDisposableData(t);r.parent=i}markAsDisposed(t){this.livingDisposables.delete(t)}markAsSingleton(t){this.getDisposableData(t).isSingleton=!0}getRootParent(t,i){let r=i.get(t);if(r)return r;let s=t.parent?this.getRootParent(this.getDisposableData(t.parent),i):t;return i.set(t,s),s}getTrackedDisposables(){let t=new Map;return[...this.livingDisposables.entries()].filter(([,i])=>i.source!==null&&!this.getRootParent(i,t).isSingleton).flatMap(([i])=>i)}computeLeakingDisposables(t=10,i){let r;if(i)r=i;else{let h=new Map,l=[...this.livingDisposables.values()].filter(u=>u.source!==null&&!this.getRootParent(u,h).isSingleton);if(l.length===0)return;let c=new Set(l.map(u=>u.value));if(r=l.filter(u=>!(u.parent&&c.has(u.parent))),r.length===0)throw new Error("There are cyclic diposable chains!")}if(!r)return;function s(h){function l(u,p){for(;u.length>0&&p.some(g=>typeof g=="string"?g===u[0]:u[0].match(g));)u.shift()}let c=h.source.split(`
`).map(u=>u.trim().replace("at ","")).filter(u=>u!=="");return l(c,["Error",/^trackDisposable \(.*\)$/,/^DisposableTracker.trackDisposable \(.*\)$/]),c.reverse()}let n=new hB;for(let h of r){let l=s(h);for(let c=0;c<=l.length;c++)n.add(l.slice(0,c).join(`
`),h)}r.sort(oB(h=>h.idx,aB));let o="",a=0;for(let h of r.slice(0,t)){a++;let l=s(h),c=[];for(let u=0;u<l.length;u++){let p=l[u];p=`(shared with ${n.get(l.slice(0,u+1).join(`
`)).size}/${r.length} leaks) at ${p}`;let g=n.get(l.slice(0,u).join(`
`)),v=lB([...g].map(m=>s(m)[u]),m=>m);delete v[l[u]];for(let[m,x]of Object.entries(v))c.unshift(`    - stacktraces of ${x.length} other leaks continue with ${m}`);c.unshift(p)}o+=`


==================== Leaking disposable ${a}/${r.length}: ${h.value.constructor.name} ====================
${c.join(`
`)}
============================================================

`}return r.length>t&&(o+=`


... and ${r.length-t} more leaking disposables

`),{leaks:r,details:o}}};uB.idx=0;function dB(e){Cs=e}if(cB){let e="__is_disposable_tracked__";dB(new class{trackDisposable(t){let i=new Error("Potentially leaked disposable").stack;setTimeout(()=>{t[e]||console.log(i)},3e3)}setParent(t,i){if(t&&t!==ks.None)try{t[e]=!0}catch{}}markAsDisposed(t){if(t&&t!==ks.None)try{t[e]=!0}catch{}}markAsSingleton(t){}})}function dd(e){return Cs?.trackDisposable(e),e}function fd(e){Cs?.markAsDisposed(e)}function ad(e,t){Cs?.setParent(e,t)}function fB(e,t){if(Cs)for(let i of e)Cs.setParent(i,t)}function G1(e){if(W1.is(e)){let t=[];for(let i of e)if(i)try{i.dispose()}catch(r){t.push(r)}if(t.length===1)throw t[0];if(t.length>1)throw new AggregateError(t,"Encountered errors while disposing of store");return Array.isArray(e)?[]:e}else if(e)return e.dispose(),e}function _B(...e){let t=j1(()=>G1(e));return fB(e,t),t}function j1(e){let t=dd({dispose:rB(()=>{fd(t),e()})});return t}var q1=class V1{constructor(){this._toDispose=new Set,this._isDisposed=!1,dd(this)}dispose(){this._isDisposed||(fd(this),this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{G1(this._toDispose)}finally{this._toDispose.clear()}}add(t){if(!t)return t;if(t===this)throw new Error("Cannot register a disposable on itself!");return ad(t,this),this._isDisposed?V1.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(t),t}delete(t){if(t){if(t===this)throw new Error("Cannot dispose a disposable on itself!");this._toDispose.delete(t),t.dispose()}}deleteAndLeak(t){t&&this._toDispose.has(t)&&(this._toDispose.delete(t),ad(t,null))}};q1.DISABLE_DISPOSED_WARNING=!1;var _d=q1,ks=class{constructor(){this._store=new _d,dd(this),ad(this._store,this)}dispose(){fd(this),this._store.dispose()}_register(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}};ks.None=Object.freeze({dispose(){}});var N1=class ld{constructor(t){this.element=t,this.next=ld.Undefined,this.prev=ld.Undefined}};N1.Undefined=new N1(void 0);var gB=globalThis.performance&&typeof globalThis.performance.now=="function",pB=class Y1{static create(t){return new Y1(t)}constructor(t){this._now=gB&&t===!1?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}},vB=!1,Q1=!1,mB=!1,yB;(e=>{e.None=()=>ks.None;function t(C){if(mB){let{onDidAddListener:w}=C,k=ud.create(),f=0;C.onDidAddListener=()=>{++f===2&&(console.warn("snapshotted emitter LIKELY used public and SHOULD HAVE BEEN created with DisposableStore. snapshotted here"),k.print()),w?.()}}}function i(C,w){return p(C,()=>{},0,void 0,!0,void 0,w)}e.defer=i;function r(C){return(w,k=null,f)=>{let d=!1,_;return _=C(y=>{if(!d)return _?_.dispose():d=!0,w.call(k,y)},null,f),d&&_.dispose(),_}}e.once=r;function s(C,w,k){return c((f,d=null,_)=>C(y=>f.call(d,w(y)),null,_),k)}e.map=s;function n(C,w,k){return c((f,d=null,_)=>C(y=>{w(y),f.call(d,y)},null,_),k)}e.forEach=n;function o(C,w,k){return c((f,d=null,_)=>C(y=>w(y)&&f.call(d,y),null,_),k)}e.filter=o;function a(C){return C}e.signal=a;function h(...C){return(w,k=null,f)=>{let d=_B(...C.map(_=>_(y=>w.call(k,y))));return u(d,f)}}e.any=h;function l(C,w,k,f){let d=k;return s(C,_=>(d=w(d,_),d),f)}e.reduce=l;function c(C,w){let k,f={onWillAddFirstListener(){k=C(d.fire,d)},onDidRemoveLastListener(){k?.dispose()}};w||t(f);let d=new yr(f);return w?.add(d),d.event}function u(C,w){return w instanceof Array?w.push(C):w&&w.add(C),C}function p(C,w,k=100,f=!1,d=!1,_,y){let A,S,F,U=0,W,z={leakWarningThreshold:_,onWillAddFirstListener(){A=C(ee=>{U++,S=w(S,ee),f&&!F&&(J.fire(S),S=void 0),W=()=>{let ue=S;S=void 0,F=void 0,(!f||U>1)&&J.fire(ue),U=0},typeof k=="number"?(clearTimeout(F),F=setTimeout(W,k)):F===void 0&&(F=0,queueMicrotask(W))})},onWillRemoveListener(){d&&U>0&&W?.()},onDidRemoveLastListener(){W=void 0,A.dispose()}};y||t(z);let J=new yr(z);return y?.add(J),J.event}e.debounce=p;function g(C,w=0,k){return e.debounce(C,(f,d)=>f?(f.push(d),f):[d],w,void 0,!0,void 0,k)}e.accumulate=g;function v(C,w=(f,d)=>f===d,k){let f=!0,d;return o(C,_=>{let y=f||!w(_,d);return f=!1,d=_,y},k)}e.latch=v;function m(C,w,k){return[e.filter(C,w,k),e.filter(C,f=>!w(f),k)]}e.split=m;function x(C,w=!1,k=[],f){let d=k.slice(),_=C(S=>{d?d.push(S):A.fire(S)});f&&f.add(_);let y=()=>{d?.forEach(S=>A.fire(S)),d=null},A=new yr({onWillAddFirstListener(){_||(_=C(S=>A.fire(S)),f&&f.add(_))},onDidAddFirstListener(){d&&(w?setTimeout(y):y())},onDidRemoveLastListener(){_&&_.dispose(),_=null}});return f&&f.add(A),A.event}e.buffer=x;function E(C,w){return(k,f,d)=>{let _=w(new D);return C(function(y){let A=_.evaluate(y);A!==R&&k.call(f,A)},void 0,d)}}e.chain=E;let R=Symbol("HaltChainable");class D{constructor(){this.steps=[]}map(w){return this.steps.push(w),this}forEach(w){return this.steps.push(k=>(w(k),k)),this}filter(w){return this.steps.push(k=>w(k)?k:R),this}reduce(w,k){let f=k;return this.steps.push(d=>(f=w(f,d),f)),this}latch(w=(k,f)=>k===f){let k=!0,f;return this.steps.push(d=>{let _=k||!w(d,f);return k=!1,f=d,_?d:R}),this}evaluate(w){for(let k of this.steps)if(w=k(w),w===R)break;return w}}function b(C,w,k=f=>f){let f=(...A)=>y.fire(k(...A)),d=()=>C.on(w,f),_=()=>C.removeListener(w,f),y=new yr({onWillAddFirstListener:d,onDidRemoveLastListener:_});return y.event}e.fromNodeEventEmitter=b;function L(C,w,k=f=>f){let f=(...A)=>y.fire(k(...A)),d=()=>C.addEventListener(w,f),_=()=>C.removeEventListener(w,f),y=new yr({onWillAddFirstListener:d,onDidRemoveLastListener:_});return y.event}e.fromDOMEventEmitter=L;function I(C){return new Promise(w=>r(C)(w))}e.toPromise=I;function T(C){let w=new yr;return C.then(k=>{w.fire(k)},()=>{w.fire(void 0)}).finally(()=>{w.dispose()}),w.event}e.fromPromise=T;function q(C,w){return C(k=>w.fire(k))}e.forward=q;function $(C,w,k){return w(k),C(f=>w(f))}e.runAndSubscribe=$;class V{constructor(w,k){this._observable=w,this._counter=0,this._hasChanged=!1;let f={onWillAddFirstListener:()=>{w.addObserver(this)},onDidRemoveLastListener:()=>{w.removeObserver(this)}};k||t(f),this.emitter=new yr(f),k&&k.add(this.emitter)}beginUpdate(w){this._counter++}handlePossibleChange(w){}handleChange(w,k){this._hasChanged=!0}endUpdate(w){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}function j(C,w){return new V(C,w).emitter.event}e.fromObservable=j;function ne(C){return(w,k,f)=>{let d=0,_=!1,y={beginUpdate(){d++},endUpdate(){d--,d===0&&(C.reportChanges(),_&&(_=!1,w.call(k)))},handlePossibleChange(){},handleChange(){_=!0}};C.addObserver(y),C.reportChanges();let A={dispose(){C.removeObserver(y)}};return f instanceof _d?f.add(A):Array.isArray(f)&&f.push(A),A}}e.fromObservableLight=ne})(yB||={});var hd=class cd{constructor(t){this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name=`${t}_${cd._idPool++}`,cd.all.add(this)}start(t){this._stopWatch=new pB,this.listenerCount=t}stop(){if(this._stopWatch){let t=this._stopWatch.elapsed();this.durations.push(t),this.elapsedOverall+=t,this.invocationCount+=1,this._stopWatch=void 0}}};hd.all=new Set,hd._idPool=0;var bB=hd,H1=-1,J1=class Z1{constructor(t,i,r=(Z1._idPool++).toString(16).padStart(3,"0")){this._errorHandler=t,this.threshold=i,this.name=r,this._warnCountdown=0}dispose(){this._stacks?.clear()}check(t,i){let r=this.threshold;if(r<=0||i<r)return;this._stacks||(this._stacks=new Map);let s=this._stacks.get(t.value)||0;if(this._stacks.set(t.value,s+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=r*.5;let[n,o]=this.getMostFrequentStack(),a=`[${this.name}] potential listener LEAK detected, having ${i} listeners already. MOST frequent listener (${o}):`;console.warn(a),console.warn(n);let h=new AB(a,n);this._errorHandler(h)}return()=>{let n=this._stacks.get(t.value)||0;this._stacks.set(t.value,n-1)}}getMostFrequentStack(){if(!this._stacks)return;let t,i=0;for(let[r,s]of this._stacks)(!t||i<s)&&(t=[r,s],i=s);return t}};J1._idPool=1;var wB=J1,ud=class ey{constructor(t){this.value=t}static create(){let t=new Error;return new ey(t.stack??"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},AB=class extends Error{constructor(e,t){super(e),this.name="ListenerLeakError",this.stack=t}},xB=class extends Error{constructor(e,t){super(e),this.name="ListenerRefusalError",this.stack=t}},SB=0,ll=class{constructor(e){this.value=e,this.id=SB++}},CB=2,kB=(e,t)=>{if(e instanceof ll)t(e);else for(let i=0;i<e.length;i++){let r=e[i];r&&t(r)}},hl;if(vB){let e=[];setInterval(()=>{e.length!==0&&(console.warn("[LEAKING LISTENERS] GC'ed these listeners that were NOT yet disposed:"),console.warn(e.join(`
`)),e.length=0)},3e3),hl=new FinalizationRegistry(t=>{typeof t=="string"&&e.push(t)})}var yr=class{constructor(e){this._size=0,this._options=e,this._leakageMon=H1>0||this._options?.leakWarningThreshold?new wB(e?.onListenerError??td,this._options?.leakWarningThreshold??H1):void 0,this._perfMon=this._options?._profName?new bB(this._options._profName):void 0,this._deliveryQueue=this._options?.deliveryQueue}dispose(){if(!this._disposed){if(this._disposed=!0,this._deliveryQueue?.current===this&&this._deliveryQueue.reset(),this._listeners){if(Q1){let e=this._listeners;queueMicrotask(()=>{kB(e,t=>t.stack?.print())})}this._listeners=void 0,this._size=0}this._options?.onDidRemoveLastListener?.(),this._leakageMon?.dispose()}}get event(){return this._event??=(e,t,i)=>{if(this._leakageMon&&this._size>this._leakageMon.threshold**2){let a=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(a);let h=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],l=new xB(`${a}. HINT: Stack shows most frequent listener (${h[1]}-times)`,h[0]);return(this._options?.onListenerError||td)(l),ks.None}if(this._disposed)return ks.None;t&&(e=e.bind(t));let r=new ll(e),s,n;this._leakageMon&&this._size>=Math.ceil(this._leakageMon.threshold*.2)&&(r.stack=ud.create(),s=this._leakageMon.check(r.stack,this._size+1)),Q1&&(r.stack=n??ud.create()),this._listeners?this._listeners instanceof ll?(this._deliveryQueue??=new EB,this._listeners=[this._listeners,r]):this._listeners.push(r):(this._options?.onWillAddFirstListener?.(this),this._listeners=r,this._options?.onDidAddFirstListener?.(this)),this._size++;let o=j1(()=>{hl?.unregister(o),s?.(),this._removeListener(r)});if(i instanceof _d?i.add(o):Array.isArray(i)&&i.push(o),hl){let a=new Error().stack.split(`
`).slice(2,3).join(`
`).trim(),h=/(file:|vscode-file:\/\/vscode-app)?(\/[^:]*:\d+:\d+)/.exec(a);hl.register(o,h?.[2]??a,o)}return o},this._event}_removeListener(e){if(this._options?.onWillRemoveListener?.(this),!this._listeners)return;if(this._size===1){this._listeners=void 0,this._options?.onDidRemoveLastListener?.(this),this._size=0;return}let t=this._listeners,i=t.indexOf(e);if(i===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),new Error("Attempted to dispose unknown listener");this._size--,t[i]=void 0;let r=this._deliveryQueue.current===this;if(this._size*CB<=t.length){let s=0;for(let n=0;n<t.length;n++)t[n]?t[s++]=t[n]:r&&(this._deliveryQueue.end--,s<this._deliveryQueue.i&&this._deliveryQueue.i--);t.length=s}}_deliver(e,t){if(!e)return;let i=this._options?.onListenerError||td;if(!i){e.value(t);return}try{e.value(t)}catch(r){i(r)}}_deliverQueue(e){let t=e.current._listeners;for(;e.i<e.end;)this._deliver(t[e.i++],e.value);e.reset()}fire(e){if(this._deliveryQueue?.current&&(this._deliverQueue(this._deliveryQueue),this._perfMon?.stop()),this._perfMon?.start(this._size),this._listeners)if(this._listeners instanceof ll)this._deliver(this._listeners,e);else{let t=this._deliveryQueue;t.enqueue(this,e,this._listeners.length),this._deliverQueue(t)}this._perfMon?.stop()}hasListeners(){return this._size>0}},EB=class{constructor(){this.i=-1,this.end=0}enqueue(e,t,i){this.i=0,this.end=i,this.current=e,this.value=t}reset(){this.i=this.end,this.current=void 0,this.value=void 0}},ul=class cl{constructor(){this._providers=Object.create(null),this._active="",this._onChange=new yr,this.onChange=this._onChange.event;let t=new J6;this.register(t),this._active=t.version,this._activeProvider=t}static extractShouldJoin(t){return(t&1)!==0}static extractWidth(t){return t>>1&3}static extractCharKind(t){return t>>3}static createPropertyValue(t,i,r=!1){return(t&16777215)<<3|(i&3)<<1|(r?1:0)}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(t){if(!this._providers[t])throw new Error(`unknown Unicode version "${t}"`);this._active=t,this._activeProvider=this._providers[t],this._onChange.fire(t)}register(t){this._providers[t.version]=t}wcwidth(t){return this._activeProvider.wcwidth(t)}getStringCellWidth(t){let i=0,r=0,s=t.length;for(let n=0;n<s;++n){let o=t.charCodeAt(n);if(55296<=o&&o<=56319){if(++n>=s)return i+this.wcwidth(o);let l=t.charCodeAt(n);56320<=l&&l<=57343?o=(o-55296)*1024+l-56320+65536:i+=this.wcwidth(l)}let a=this.charProperties(o,r),h=cl.extractWidth(a);cl.extractShouldJoin(a)&&(h-=cl.extractWidth(r)),i+=h,r=a}return i}charProperties(t,i){return this._activeProvider.charProperties(t,i)}},id=[[768,879],[1155,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1541],[1552,1562],[1564,1564],[1611,1631],[1648,1648],[1750,1757],[1759,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2045,2045],[2070,2073],[2075,2083],[2085,2087],[2089,2093],[2137,2139],[2259,2306],[2362,2362],[2364,2364],[2369,2376],[2381,2381],[2385,2391],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2558,2558],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2641,2641],[2672,2673],[2677,2677],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2810,2815],[2817,2817],[2876,2876],[2879,2879],[2881,2884],[2893,2893],[2902,2902],[2914,2915],[2946,2946],[3008,3008],[3021,3021],[3072,3072],[3076,3076],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3170,3171],[3201,3201],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3328,3329],[3387,3388],[3393,3396],[3405,3405],[3426,3427],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3981,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4151],[4153,4154],[4157,4158],[4184,4185],[4190,4192],[4209,4212],[4226,4226],[4229,4230],[4237,4237],[4253,4253],[4448,4607],[4957,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6158],[6277,6278],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6683,6683],[6742,6742],[6744,6750],[6752,6752],[6754,6754],[6757,6764],[6771,6780],[6783,6783],[6832,6846],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7040,7041],[7074,7077],[7080,7081],[7083,7085],[7142,7142],[7144,7145],[7149,7149],[7151,7153],[7212,7219],[7222,7223],[7376,7378],[7380,7392],[7394,7400],[7405,7405],[7412,7412],[7416,7417],[7616,7673],[7675,7679],[8203,8207],[8234,8238],[8288,8292],[8294,8303],[8400,8432],[11503,11505],[11647,11647],[11744,11775],[12330,12333],[12441,12442],[42607,42610],[42612,42621],[42654,42655],[42736,42737],[43010,43010],[43014,43014],[43019,43019],[43045,43046],[43204,43205],[43232,43249],[43263,43263],[43302,43309],[43335,43345],[43392,43394],[43443,43443],[43446,43449],[43452,43453],[43493,43493],[43561,43566],[43569,43570],[43573,43574],[43587,43587],[43596,43596],[43644,43644],[43696,43696],[43698,43700],[43703,43704],[43710,43711],[43713,43713],[43756,43757],[43766,43766],[44005,44005],[44008,44008],[44013,44013],[64286,64286],[65024,65039],[65056,65071],[65279,65279],[65529,65531]],BB=[[66045,66045],[66272,66272],[66422,66426],[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[68325,68326],[68900,68903],[69446,69456],[69633,69633],[69688,69702],[69759,69761],[69811,69814],[69817,69818],[69821,69821],[69837,69837],[69888,69890],[69927,69931],[69933,69940],[70003,70003],[70016,70017],[70070,70078],[70089,70092],[70191,70193],[70196,70196],[70198,70199],[70206,70206],[70367,70367],[70371,70378],[70400,70401],[70459,70460],[70464,70464],[70502,70508],[70512,70516],[70712,70719],[70722,70724],[70726,70726],[70750,70750],[70835,70840],[70842,70842],[70847,70848],[70850,70851],[71090,71093],[71100,71101],[71103,71104],[71132,71133],[71219,71226],[71229,71229],[71231,71232],[71339,71339],[71341,71341],[71344,71349],[71351,71351],[71453,71455],[71458,71461],[71463,71467],[71727,71735],[71737,71738],[72148,72151],[72154,72155],[72160,72160],[72193,72202],[72243,72248],[72251,72254],[72263,72263],[72273,72278],[72281,72283],[72330,72342],[72344,72345],[72752,72758],[72760,72765],[72767,72767],[72850,72871],[72874,72880],[72882,72883],[72885,72886],[73009,73014],[73018,73018],[73020,73021],[73023,73029],[73031,73031],[73104,73105],[73109,73109],[73111,73111],[73459,73460],[78896,78904],[92912,92916],[92976,92982],[94031,94031],[94095,94098],[113821,113822],[113824,113827],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[121344,121398],[121403,121452],[121461,121461],[121476,121476],[121499,121503],[121505,121519],[122880,122886],[122888,122904],[122907,122913],[122915,122916],[122918,122922],[123184,123190],[123628,123631],[125136,125142],[125252,125258],[917505,917505],[917536,917631],[917760,917999]],rd=[[4352,4447],[8986,8987],[9001,9002],[9193,9196],[9200,9200],[9203,9203],[9725,9726],[9748,9749],[9800,9811],[9855,9855],[9875,9875],[9889,9889],[9898,9899],[9917,9918],[9924,9925],[9934,9934],[9940,9940],[9962,9962],[9970,9971],[9973,9973],[9978,9978],[9981,9981],[9989,9989],[9994,9995],[10024,10024],[10060,10060],[10062,10062],[10067,10069],[10071,10071],[10133,10135],[10160,10160],[10175,10175],[11035,11036],[11088,11088],[11093,11093],[11904,11929],[11931,12019],[12032,12245],[12272,12283],[12288,12329],[12334,12350],[12353,12438],[12443,12543],[12549,12591],[12593,12686],[12688,12730],[12736,12771],[12784,12830],[12832,12871],[12880,19903],[19968,42124],[42128,42182],[43360,43388],[44032,55203],[63744,64255],[65040,65049],[65072,65106],[65108,65126],[65128,65131],[65281,65376],[65504,65510]],LB=[[94176,94179],[94208,100343],[100352,101106],[110592,110878],[110928,110930],[110948,110951],[110960,111355],[126980,126980],[127183,127183],[127374,127374],[127377,127386],[127488,127490],[127504,127547],[127552,127560],[127568,127569],[127584,127589],[127744,127776],[127789,127797],[127799,127868],[127870,127891],[127904,127946],[127951,127955],[127968,127984],[127988,127988],[127992,128062],[128064,128064],[128066,128252],[128255,128317],[128331,128334],[128336,128359],[128378,128378],[128405,128406],[128420,128420],[128507,128591],[128640,128709],[128716,128716],[128720,128722],[128725,128725],[128747,128748],[128756,128762],[128992,129003],[129293,129393],[129395,129398],[129402,129442],[129445,129450],[129454,129482],[129485,129535],[129648,129651],[129656,129658],[129664,129666],[129680,129685],[131072,196605],[196608,262141]],Hi;function X1(e,t){let i=0,r=t.length-1,s;if(e<t[0][0]||e>t[r][1])return!1;for(;r>=i;)if(s=i+r>>1,e>t[s][1])i=s+1;else if(e<t[s][0])r=s-1;else return!0;return!1}var DB=class{constructor(){if(this.version="11",!Hi){Hi=new Uint8Array(65536),Hi.fill(1),Hi[0]=0,Hi.fill(0,1,32),Hi.fill(0,127,160);for(let e=0;e<id.length;++e)Hi.fill(0,id[e][0],id[e][1]+1);for(let e=0;e<rd.length;++e)Hi.fill(2,rd[e][0],rd[e][1]+1)}}wcwidth(e){return e<32?0:e<127?1:e<65536?Hi[e]:X1(e,BB)?0:X1(e,LB)?2:1}charProperties(e,t){let i=this.wcwidth(e),r=i===0&&t!==0;if(r){let s=ul.extractWidth(t);s===0?r=!1:s>i&&(i=s)}return ul.createPropertyValue(0,i,r)}},ty=class{activate(e){e.unicode.register(new DB)}dispose(){}};var iy=class{constructor(e,t){this._disposables=[],this._socket=e,this._socket.binaryType="arraybuffer",this._bidirectional=!(t&&t.bidirectional===!1)}activate(e){this._disposables.push(gd(this._socket,"message",t=>{let i=t.data;e.write(typeof i=="string"?i:new Uint8Array(i))})),this._bidirectional&&(this._disposables.push(e.onData(t=>this._sendData(t))),this._disposables.push(e.onBinary(t=>this._sendBinary(t)))),this._disposables.push(gd(this._socket,"close",()=>this.dispose())),this._disposables.push(gd(this._socket,"error",()=>this.dispose()))}dispose(){for(let e of this._disposables)e.dispose()}_sendData(e){this._checkOpenSocket()&&this._socket.send(e)}_sendBinary(e){if(!this._checkOpenSocket())return;let t=new Uint8Array(e.length);for(let i=0;i<e.length;++i)t[i]=e.charCodeAt(i)&255;this._socket.send(t)}_checkOpenSocket(){switch(this._socket.readyState){case WebSocket.OPEN:return!0;case WebSocket.CONNECTING:throw new Error("Attach addon was loaded before socket was open");case WebSocket.CLOSING:return console.warn("Attach addon socket is closing"),!1;case WebSocket.CLOSED:throw new Error("Attach addon socket is closed");default:throw new Error("Unexpected socket state")}}};function gd(e,t,i){return e.addEventListener(t,i),{dispose:()=>{i&&e.removeEventListener(t,i)}}}var IB=class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(e){setTimeout(()=>{throw e.stack?ry.isErrorNoTelemetry(e)?new ry(e.message+`

`+e.stack):new Error(e.message+`

`+e.stack):e},0)}}addListener(e){return this.listeners.push(e),()=>{this._removeListener(e)}}emit(e){this.listeners.forEach(t=>{t(e)})}_removeListener(e){this.listeners.splice(this.listeners.indexOf(e),1)}setUnexpectedErrorHandler(e){this.unexpectedErrorHandler=e}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(e){this.unexpectedErrorHandler(e),this.emit(e)}onUnexpectedExternalError(e){this.unexpectedErrorHandler(e)}},MB=new IB;function pd(e){TB(e)||MB.onUnexpectedError(e)}var yd="Canceled";function TB(e){return e instanceof RB?!0:e instanceof Error&&e.name===yd&&e.message===yd}var RB=class extends Error{constructor(){super(yd),this.name=this.message}},ry=class bd extends Error{constructor(t){super(t),this.name="CodeExpectedError"}static fromError(t){if(t instanceof bd)return t;let i=new bd;return i.message=t.message,i.stack=t.stack,i}static isErrorNoTelemetry(t){return t.name==="CodeExpectedError"}};function FB(e,t,i=0,r=e.length){let s=i,n=r;for(;s<n;){let o=Math.floor((s+n)/2);t(e[o])?s=o+1:n=o}return s-1}var PB=class dy{constructor(t){this._array=t,this._findLastMonotonousLastIdx=0}findLastMonotonous(t){if(dy.assertInvariants){if(this._prevFindLastPredicate){for(let r of this._array)if(this._prevFindLastPredicate(r)&&!t(r))throw new Error("MonotonousArray: current predicate must be weaker than (or equal to) the previous predicate.")}this._prevFindLastPredicate=t}let i=FB(this._array,t,this._findLastMonotonousLastIdx);return this._findLastMonotonousLastIdx=i+1,i===-1?void 0:this._array[i]}};PB.assertInvariants=!1;var fy;(e=>{function t(n){return n<0}e.isLessThan=t;function i(n){return n<=0}e.isLessThanOrEqual=i;function r(n){return n>0}e.isGreaterThan=r;function s(n){return n===0}e.isNeitherLessOrGreaterThan=s,e.greaterThan=1,e.lessThan=-1,e.neitherLessOrGreaterThan=0})(fy||={});function OB(e,t){return(i,r)=>t(e(i),e(r))}var KB=(e,t)=>e-t,sy=class wd{constructor(t){this.iterate=t}forEach(t){this.iterate(i=>(t(i),!0))}toArray(){let t=[];return this.iterate(i=>(t.push(i),!0)),t}filter(t){return new wd(i=>this.iterate(r=>t(r)?i(r):!0))}map(t){return new wd(i=>this.iterate(r=>i(t(r))))}some(t){let i=!1;return this.iterate(r=>(i=t(r),!i)),i}findFirst(t){let i;return this.iterate(r=>t(r)?(i=r,!1):!0),i}findLast(t){let i;return this.iterate(r=>(t(r)&&(i=r),!0)),i}findLastMaxBy(t){let i,r=!0;return this.iterate(s=>((r||fy.isGreaterThan(t(s,i)))&&(r=!1,i=s),!0)),i}};sy.empty=new sy(e=>{});function NB(e,t){let i=Object.create(null);for(let r of e){let s=t(r),n=i[s];n||(n=i[s]=[]),n.push(r)}return i}var ny,oy,MR=class{constructor(e,t){this.toKey=t,this._map=new Map,this[ny]="SetWithKey";for(let i of e)this.add(i)}get size(){return this._map.size}add(e){let t=this.toKey(e);return this._map.set(t,e),this}delete(e){return this._map.delete(this.toKey(e))}has(e){return this._map.has(this.toKey(e))}*entries(){for(let e of this._map.values())yield[e,e]}keys(){return this.values()}*values(){for(let e of this._map.values())yield e}clear(){this._map.clear()}forEach(e,t){this._map.forEach(i=>e.call(t,i,i,this))}[(oy=Symbol.iterator,ny=Symbol.toStringTag,oy)](){return this.values()}},QB=class{constructor(){this.map=new Map}add(e,t){let i=this.map.get(e);i||(i=new Set,this.map.set(e,i)),i.add(t)}delete(e,t){let i=this.map.get(e);i&&(i.delete(t),i.size===0&&this.map.delete(e))}forEach(e,t){let i=this.map.get(e);i&&i.forEach(t)}get(e){return this.map.get(e)||new Set}};function HB(e,t){let i=this,r=!1,s;return function(){if(r)return s;if(r=!0,t)try{s=e.apply(i,arguments)}finally{t()}else s=e.apply(i,arguments);return s}}var _y;(e=>{function t(b){return b&&typeof b=="object"&&typeof b[Symbol.iterator]=="function"}e.is=t;let i=Object.freeze([]);function r(){return i}e.empty=r;function*s(b){yield b}e.single=s;function n(b){return t(b)?b:s(b)}e.wrap=n;function o(b){return b||i}e.from=o;function*a(b){for(let L=b.length-1;L>=0;L--)yield b[L]}e.reverse=a;function h(b){return!b||b[Symbol.iterator]().next().done===!0}e.isEmpty=h;function l(b){return b[Symbol.iterator]().next().value}e.first=l;function c(b,L){let I=0;for(let T of b)if(L(T,I++))return!0;return!1}e.some=c;function u(b,L){for(let I of b)if(L(I))return I}e.find=u;function*p(b,L){for(let I of b)L(I)&&(yield I)}e.filter=p;function*g(b,L){let I=0;for(let T of b)yield L(T,I++)}e.map=g;function*v(b,L){let I=0;for(let T of b)yield*L(T,I++)}e.flatMap=v;function*m(...b){for(let L of b)yield*L}e.concat=m;function x(b,L,I){let T=I;for(let q of b)T=L(T,q);return T}e.reduce=x;function*E(b,L,I=b.length){for(L<0&&(L+=b.length),I<0?I+=b.length:I>b.length&&(I=b.length);L<I;L++)yield b[L]}e.slice=E;function R(b,L=Number.POSITIVE_INFINITY){let I=[];if(L===0)return[I,b];let T=b[Symbol.iterator]();for(let q=0;q<L;q++){let $=T.next();if($.done)return[I,e.empty()];I.push($.value)}return[I,{[Symbol.iterator](){return T}}]}e.consume=R;async function D(b){let L=[];for await(let I of b)L.push(I);return Promise.resolve(L)}e.asyncToArray=D})(_y||={});var XB=!1,Bs=null,UB=class gy{constructor(){this.livingDisposables=new Map}getDisposableData(t){let i=this.livingDisposables.get(t);return i||(i={parent:null,source:null,isSingleton:!1,value:t,idx:gy.idx++},this.livingDisposables.set(t,i)),i}trackDisposable(t){let i=this.getDisposableData(t);i.source||(i.source=new Error().stack)}setParent(t,i){let r=this.getDisposableData(t);r.parent=i}markAsDisposed(t){this.livingDisposables.delete(t)}markAsSingleton(t){this.getDisposableData(t).isSingleton=!0}getRootParent(t,i){let r=i.get(t);if(r)return r;let s=t.parent?this.getRootParent(this.getDisposableData(t.parent),i):t;return i.set(t,s),s}getTrackedDisposables(){let t=new Map;return[...this.livingDisposables.entries()].filter(([,i])=>i.source!==null&&!this.getRootParent(i,t).isSingleton).flatMap(([i])=>i)}computeLeakingDisposables(t=10,i){let r;if(i)r=i;else{let h=new Map,l=[...this.livingDisposables.values()].filter(u=>u.source!==null&&!this.getRootParent(u,h).isSingleton);if(l.length===0)return;let c=new Set(l.map(u=>u.value));if(r=l.filter(u=>!(u.parent&&c.has(u.parent))),r.length===0)throw new Error("There are cyclic diposable chains!")}if(!r)return;function s(h){function l(u,p){for(;u.length>0&&p.some(g=>typeof g=="string"?g===u[0]:u[0].match(g));)u.shift()}let c=h.source.split(`
`).map(u=>u.trim().replace("at ","")).filter(u=>u!=="");return l(c,["Error",/^trackDisposable \(.*\)$/,/^DisposableTracker.trackDisposable \(.*\)$/]),c.reverse()}let n=new QB;for(let h of r){let l=s(h);for(let c=0;c<=l.length;c++)n.add(l.slice(0,c).join(`
`),h)}r.sort(OB(h=>h.idx,KB));let o="",a=0;for(let h of r.slice(0,t)){a++;let l=s(h),c=[];for(let u=0;u<l.length;u++){let p=l[u];p=`(shared with ${n.get(l.slice(0,u+1).join(`
`)).size}/${r.length} leaks) at ${p}`;let g=n.get(l.slice(0,u).join(`
`)),v=NB([...g].map(m=>s(m)[u]),m=>m);delete v[l[u]];for(let[m,x]of Object.entries(v))c.unshift(`    - stacktraces of ${x.length} other leaks continue with ${m}`);c.unshift(p)}o+=`


==================== Leaking disposable ${a}/${r.length}: ${h.value.constructor.name} ====================
${c.join(`
`)}
============================================================

`}return r.length>t&&(o+=`


... and ${r.length-t} more leaking disposables

`),{leaks:r,details:o}}};UB.idx=0;function zB(e){Bs=e}if(XB){let e="__is_disposable_tracked__";zB(new class{trackDisposable(t){let i=new Error("Potentially leaked disposable").stack;setTimeout(()=>{t[e]||console.log(i)},3e3)}setParent(t,i){if(t&&t!==mi.None)try{t[e]=!0}catch{}}markAsDisposed(t){if(t&&t!==mi.None)try{t[e]=!0}catch{}}markAsSingleton(t){}})}function ml(e){return Bs?.trackDisposable(e),e}function yl(e){Bs?.markAsDisposed(e)}function Jn(e,t){Bs?.setParent(e,t)}function WB(e,t){if(Bs)for(let i of e)Bs.setParent(i,t)}function Yn(e){if(_y.is(e)){let t=[];for(let i of e)if(i)try{i.dispose()}catch(r){t.push(r)}if(t.length===1)throw t[0];if(t.length>1)throw new AggregateError(t,"Encountered errors while disposing of store");return Array.isArray(e)?[]:e}else if(e)return e.dispose(),e}function py(...e){let t=Ls(()=>Yn(e));return WB(e,t),t}function Ls(e){let t=ml({dispose:HB(()=>{yl(t),e()})});return t}var vy=class my{constructor(){this._toDispose=new Set,this._isDisposed=!1,ml(this)}dispose(){this._isDisposed||(yl(this),this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{Yn(this._toDispose)}finally{this._toDispose.clear()}}add(t){if(!t)return t;if(t===this)throw new Error("Cannot register a disposable on itself!");return Jn(t,this),this._isDisposed?my.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(t),t}delete(t){if(t){if(t===this)throw new Error("Cannot dispose a disposable on itself!");this._toDispose.delete(t),t.dispose()}}deleteAndLeak(t){t&&this._toDispose.has(t)&&(this._toDispose.delete(t),Jn(t,null))}};vy.DISABLE_DISPOSED_WARNING=!1;var Bd=vy,mi=class{constructor(){this._store=new Bd,ml(this),Jn(this._store,this)}dispose(){yl(this),this._store.dispose()}_register(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}};mi.None=Object.freeze({dispose(){}});var vl=class{constructor(){this._isDisposed=!1,ml(this)}get value(){return this._isDisposed?void 0:this._value}set value(e){this._isDisposed||e===this._value||(this._value?.dispose(),e&&Jn(e,this),this._value=e)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,yl(this),this._value?.dispose(),this._value=void 0}clearAndLeak(){let e=this._value;return this._value=void 0,e&&Jn(e,null),e}},ay=class Ad{constructor(t){this.element=t,this.next=Ad.Undefined,this.prev=Ad.Undefined}};ay.Undefined=new ay(void 0);var $B=globalThis.performance&&typeof globalThis.performance.now=="function",GB=class yy{static create(t){return new yy(t)}constructor(t){this._now=$B&&t===!1?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}},jB=!1,ly=!1,qB=!1,Ld;(e=>{e.None=()=>mi.None;function t(C){if(qB){let{onDidAddListener:w}=C,k=Cd.create(),f=0;C.onDidAddListener=()=>{++f===2&&(console.warn("snapshotted emitter LIKELY used public and SHOULD HAVE BEEN created with DisposableStore. snapshotted here"),k.print()),w?.()}}}function i(C,w){return p(C,()=>{},0,void 0,!0,void 0,w)}e.defer=i;function r(C){return(w,k=null,f)=>{let d=!1,_;return _=C(y=>{if(!d)return _?_.dispose():d=!0,w.call(k,y)},null,f),d&&_.dispose(),_}}e.once=r;function s(C,w,k){return c((f,d=null,_)=>C(y=>f.call(d,w(y)),null,_),k)}e.map=s;function n(C,w,k){return c((f,d=null,_)=>C(y=>{w(y),f.call(d,y)},null,_),k)}e.forEach=n;function o(C,w,k){return c((f,d=null,_)=>C(y=>w(y)&&f.call(d,y),null,_),k)}e.filter=o;function a(C){return C}e.signal=a;function h(...C){return(w,k=null,f)=>{let d=py(...C.map(_=>_(y=>w.call(k,y))));return u(d,f)}}e.any=h;function l(C,w,k,f){let d=k;return s(C,_=>(d=w(d,_),d),f)}e.reduce=l;function c(C,w){let k,f={onWillAddFirstListener(){k=C(d.fire,d)},onDidRemoveLastListener(){k?.dispose()}};w||t(f);let d=new vi(f);return w?.add(d),d.event}function u(C,w){return w instanceof Array?w.push(C):w&&w.add(C),C}function p(C,w,k=100,f=!1,d=!1,_,y){let A,S,F,U=0,W,z={leakWarningThreshold:_,onWillAddFirstListener(){A=C(ee=>{U++,S=w(S,ee),f&&!F&&(J.fire(S),S=void 0),W=()=>{let ue=S;S=void 0,F=void 0,(!f||U>1)&&J.fire(ue),U=0},typeof k=="number"?(clearTimeout(F),F=setTimeout(W,k)):F===void 0&&(F=0,queueMicrotask(W))})},onWillRemoveListener(){d&&U>0&&W?.()},onDidRemoveLastListener(){W=void 0,A.dispose()}};y||t(z);let J=new vi(z);return y?.add(J),J.event}e.debounce=p;function g(C,w=0,k){return e.debounce(C,(f,d)=>f?(f.push(d),f):[d],w,void 0,!0,void 0,k)}e.accumulate=g;function v(C,w=(f,d)=>f===d,k){let f=!0,d;return o(C,_=>{let y=f||!w(_,d);return f=!1,d=_,y},k)}e.latch=v;function m(C,w,k){return[e.filter(C,w,k),e.filter(C,f=>!w(f),k)]}e.split=m;function x(C,w=!1,k=[],f){let d=k.slice(),_=C(S=>{d?d.push(S):A.fire(S)});f&&f.add(_);let y=()=>{d?.forEach(S=>A.fire(S)),d=null},A=new vi({onWillAddFirstListener(){_||(_=C(S=>A.fire(S)),f&&f.add(_))},onDidAddFirstListener(){d&&(w?setTimeout(y):y())},onDidRemoveLastListener(){_&&_.dispose(),_=null}});return f&&f.add(A),A.event}e.buffer=x;function E(C,w){return(k,f,d)=>{let _=w(new D);return C(function(y){let A=_.evaluate(y);A!==R&&k.call(f,A)},void 0,d)}}e.chain=E;let R=Symbol("HaltChainable");class D{constructor(){this.steps=[]}map(w){return this.steps.push(w),this}forEach(w){return this.steps.push(k=>(w(k),k)),this}filter(w){return this.steps.push(k=>w(k)?k:R),this}reduce(w,k){let f=k;return this.steps.push(d=>(f=w(f,d),f)),this}latch(w=(k,f)=>k===f){let k=!0,f;return this.steps.push(d=>{let _=k||!w(d,f);return k=!1,f=d,_?d:R}),this}evaluate(w){for(let k of this.steps)if(w=k(w),w===R)break;return w}}function b(C,w,k=f=>f){let f=(...A)=>y.fire(k(...A)),d=()=>C.on(w,f),_=()=>C.removeListener(w,f),y=new vi({onWillAddFirstListener:d,onDidRemoveLastListener:_});return y.event}e.fromNodeEventEmitter=b;function L(C,w,k=f=>f){let f=(...A)=>y.fire(k(...A)),d=()=>C.addEventListener(w,f),_=()=>C.removeEventListener(w,f),y=new vi({onWillAddFirstListener:d,onDidRemoveLastListener:_});return y.event}e.fromDOMEventEmitter=L;function I(C){return new Promise(w=>r(C)(w))}e.toPromise=I;function T(C){let w=new vi;return C.then(k=>{w.fire(k)},()=>{w.fire(void 0)}).finally(()=>{w.dispose()}),w.event}e.fromPromise=T;function q(C,w){return C(k=>w.fire(k))}e.forward=q;function $(C,w,k){return w(k),C(f=>w(f))}e.runAndSubscribe=$;class V{constructor(w,k){this._observable=w,this._counter=0,this._hasChanged=!1;let f={onWillAddFirstListener:()=>{w.addObserver(this)},onDidRemoveLastListener:()=>{w.removeObserver(this)}};k||t(f),this.emitter=new vi(f),k&&k.add(this.emitter)}beginUpdate(w){this._counter++}handlePossibleChange(w){}handleChange(w,k){this._hasChanged=!0}endUpdate(w){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}function j(C,w){return new V(C,w).emitter.event}e.fromObservable=j;function ne(C){return(w,k,f)=>{let d=0,_=!1,y={beginUpdate(){d++},endUpdate(){d--,d===0&&(C.reportChanges(),_&&(_=!1,w.call(k)))},handlePossibleChange(){},handleChange(){_=!0}};C.addObserver(y),C.reportChanges();let A={dispose(){C.removeObserver(y)}};return f instanceof Bd?f.add(A):Array.isArray(f)&&f.push(A),A}}e.fromObservableLight=ne})(Ld||={});var xd=class Sd{constructor(t){this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name=`${t}_${Sd._idPool++}`,Sd.all.add(this)}start(t){this._stopWatch=new GB,this.listenerCount=t}stop(){if(this._stopWatch){let t=this._stopWatch.elapsed();this.durations.push(t),this.elapsedOverall+=t,this.invocationCount+=1,this._stopWatch=void 0}}};xd.all=new Set,xd._idPool=0;var VB=xd,hy=-1,by=class wy{constructor(t,i,r=(wy._idPool++).toString(16).padStart(3,"0")){this._errorHandler=t,this.threshold=i,this.name=r,this._warnCountdown=0}dispose(){this._stacks?.clear()}check(t,i){let r=this.threshold;if(r<=0||i<r)return;this._stacks||(this._stacks=new Map);let s=this._stacks.get(t.value)||0;if(this._stacks.set(t.value,s+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=r*.5;let[n,o]=this.getMostFrequentStack(),a=`[${this.name}] potential listener LEAK detected, having ${i} listeners already. MOST frequent listener (${o}):`;console.warn(a),console.warn(n);let h=new JB(a,n);this._errorHandler(h)}return()=>{let n=this._stacks.get(t.value)||0;this._stacks.set(t.value,n-1)}}getMostFrequentStack(){if(!this._stacks)return;let t,i=0;for(let[r,s]of this._stacks)(!t||i<s)&&(t=[r,s],i=s);return t}};by._idPool=1;var YB=by,Cd=class Ay{constructor(t){this.value=t}static create(){let t=new Error;return new Ay(t.stack??"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},JB=class extends Error{constructor(e,t){super(e),this.name="ListenerLeakError",this.stack=t}},ZB=class extends Error{constructor(e,t){super(e),this.name="ListenerRefusalError",this.stack=t}},eL=0,fl=class{constructor(e){this.value=e,this.id=eL++}},tL=2,iL=(e,t)=>{if(e instanceof fl)t(e);else for(let i=0;i<e.length;i++){let r=e[i];r&&t(r)}},_l;if(jB){let e=[];setInterval(()=>{e.length!==0&&(console.warn("[LEAKING LISTENERS] GC'ed these listeners that were NOT yet disposed:"),console.warn(e.join(`
`)),e.length=0)},3e3),_l=new FinalizationRegistry(t=>{typeof t=="string"&&e.push(t)})}var vi=class{constructor(e){this._size=0,this._options=e,this._leakageMon=hy>0||this._options?.leakWarningThreshold?new YB(e?.onListenerError??pd,this._options?.leakWarningThreshold??hy):void 0,this._perfMon=this._options?._profName?new VB(this._options._profName):void 0,this._deliveryQueue=this._options?.deliveryQueue}dispose(){if(!this._disposed){if(this._disposed=!0,this._deliveryQueue?.current===this&&this._deliveryQueue.reset(),this._listeners){if(ly){let e=this._listeners;queueMicrotask(()=>{iL(e,t=>t.stack?.print())})}this._listeners=void 0,this._size=0}this._options?.onDidRemoveLastListener?.(),this._leakageMon?.dispose()}}get event(){return this._event??=(e,t,i)=>{if(this._leakageMon&&this._size>this._leakageMon.threshold**2){let a=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(a);let h=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],l=new ZB(`${a}. HINT: Stack shows most frequent listener (${h[1]}-times)`,h[0]);return(this._options?.onListenerError||pd)(l),mi.None}if(this._disposed)return mi.None;t&&(e=e.bind(t));let r=new fl(e),s,n;this._leakageMon&&this._size>=Math.ceil(this._leakageMon.threshold*.2)&&(r.stack=Cd.create(),s=this._leakageMon.check(r.stack,this._size+1)),ly&&(r.stack=n??Cd.create()),this._listeners?this._listeners instanceof fl?(this._deliveryQueue??=new rL,this._listeners=[this._listeners,r]):this._listeners.push(r):(this._options?.onWillAddFirstListener?.(this),this._listeners=r,this._options?.onDidAddFirstListener?.(this)),this._size++;let o=Ls(()=>{_l?.unregister(o),s?.(),this._removeListener(r)});if(i instanceof Bd?i.add(o):Array.isArray(i)&&i.push(o),_l){let a=new Error().stack.split(`
`).slice(2,3).join(`
`).trim(),h=/(file:|vscode-file:\/\/vscode-app)?(\/[^:]*:\d+:\d+)/.exec(a);_l.register(o,h?.[2]??a,o)}return o},this._event}_removeListener(e){if(this._options?.onWillRemoveListener?.(this),!this._listeners)return;if(this._size===1){this._listeners=void 0,this._options?.onDidRemoveLastListener?.(this),this._size=0;return}let t=this._listeners,i=t.indexOf(e);if(i===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),new Error("Attempted to dispose unknown listener");this._size--,t[i]=void 0;let r=this._deliveryQueue.current===this;if(this._size*tL<=t.length){let s=0;for(let n=0;n<t.length;n++)t[n]?t[s++]=t[n]:r&&(this._deliveryQueue.end--,s<this._deliveryQueue.i&&this._deliveryQueue.i--);t.length=s}}_deliver(e,t){if(!e)return;let i=this._options?.onListenerError||pd;if(!i){e.value(t);return}try{e.value(t)}catch(r){i(r)}}_deliverQueue(e){let t=e.current._listeners;for(;e.i<e.end;)this._deliver(t[e.i++],e.value);e.reset()}fire(e){if(this._deliveryQueue?.current&&(this._deliverQueue(this._deliveryQueue),this._perfMon?.stop()),this._perfMon?.start(this._size),this._listeners)if(this._listeners instanceof fl)this._deliver(this._listeners,e);else{let t=this._deliveryQueue;t.enqueue(this,e,this._listeners.length),this._deliverQueue(t)}this._perfMon?.stop()}hasListeners(){return this._size>0}},rL=class{constructor(){this.i=-1,this.end=0}enqueue(e,t,i){this.i=0,this.end=i,this.current=e,this.value=t}reset(){this.i=this.end,this.current=void 0,this.value=void 0}},xy=Object.freeze(function(e,t){let i=setTimeout(e.bind(t),0);return{dispose(){clearTimeout(i)}}}),sL;(e=>{function t(i){return i===e.None||i===e.Cancelled||i instanceof nL?!0:!i||typeof i!="object"?!1:typeof i.isCancellationRequested=="boolean"&&typeof i.onCancellationRequested=="function"}e.isCancellationToken=t,e.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:Ld.None}),e.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:xy})})(sL||={});var nL=class{constructor(){this._isCancelled=!1,this._emitter=null}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?xy:(this._emitter||(this._emitter=new vi),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}},Es="en",kd=!1,Ed=!1,gl=!1,oL=!1,aL=!1,Sy=!1,lL=!1,hL=!1,cL=!1,uL=!1,dl,pl=Es,cy=Es,dL,Xi,Ui=globalThis,Mt;typeof Ui.vscode<"u"&&typeof Ui.vscode.process<"u"?Mt=Ui.vscode.process:typeof process<"u"&&typeof process?.versions?.node=="string"&&(Mt=process);var Cy=typeof Mt?.versions?.electron=="string",fL=Cy&&Mt?.type==="renderer";if(typeof Mt=="object"){kd=Mt.platform==="win32",Ed=Mt.platform==="darwin",gl=Mt.platform==="linux",oL=gl&&!!Mt.env.SNAP&&!!Mt.env.SNAP_REVISION,lL=Cy,cL=!!Mt.env.CI||!!Mt.env.BUILD_ARTIFACTSTAGINGDIRECTORY,dl=Es,pl=Es;let e=Mt.env.VSCODE_NLS_CONFIG;if(e)try{let t=JSON.parse(e);dl=t.userLocale,cy=t.osLocale,pl=t.resolvedLanguage||Es,dL=t.languagePack?.translationsConfigFile}catch{}aL=!0}else typeof navigator=="object"&&!fL?(Xi=navigator.userAgent,kd=Xi.indexOf("Windows")>=0,Ed=Xi.indexOf("Macintosh")>=0,hL=(Xi.indexOf("Macintosh")>=0||Xi.indexOf("iPad")>=0||Xi.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,gl=Xi.indexOf("Linux")>=0,uL=Xi?.indexOf("Mobi")>=0,Sy=!0,pl=globalThis._VSCODE_NLS_LANGUAGE||Es,dl=navigator.language.toLowerCase(),cy=dl):console.error("Unable to resolve platform.");var vd=0;Ed?vd=1:kd?vd=3:gl&&(vd=2);var _L=Sy&&typeof Ui.importScripts=="function",TR=_L?Ui.origin:void 0,yi=Xi,br=pl,gL;(e=>{function t(){return br}e.value=t;function i(){return br.length===2?br==="en":br.length>=3?br[0]==="e"&&br[1]==="n"&&br[2]==="-":!1}e.isDefaultVariant=i;function r(){return br==="en"}e.isDefault=r})(gL||={});var pL=typeof Ui.postMessage=="function"&&!Ui.importScripts,vL=(()=>{if(pL){let e=[];Ui.addEventListener("message",i=>{if(i.data&&i.data.vscodeScheduleAsyncWork)for(let r=0,s=e.length;r<s;r++){let n=e[r];if(n.id===i.data.vscodeScheduleAsyncWork){e.splice(r,1),n.callback();return}}});let t=0;return i=>{let r=++t;e.push({id:r,callback:i}),Ui.postMessage({vscodeScheduleAsyncWork:r},"*")}}return e=>setTimeout(e)})(),mL=!!(yi&&yi.indexOf("Chrome")>=0),RR=!!(yi&&yi.indexOf("Firefox")>=0),FR=!!(!mL&&yi&&yi.indexOf("Safari")>=0),PR=!!(yi&&yi.indexOf("Edg/")>=0),OR=!!(yi&&yi.indexOf("Android")>=0),KR=Symbol("MicrotaskDelay");function ky(e,t=0,i){let r=setTimeout(()=>{e(),i&&s.dispose()},t),s=Ls(()=>{clearTimeout(r),i?.deleteAndLeak(s)});return i?.add(s),s}var yL,md;(function(){typeof globalThis.requestIdleCallback!="function"||typeof globalThis.cancelIdleCallback!="function"?md=(e,t)=>{vL(()=>{if(i)return;let r=Date.now()+15;t(Object.freeze({didTimeout:!0,timeRemaining(){return Math.max(0,r-Date.now())}}))});let i=!1;return{dispose(){i||(i=!0)}}}:md=(e,t,i)=>{let r=e.requestIdleCallback(t,typeof i=="number"?{timeout:i}:void 0),s=!1;return{dispose(){s||(s=!0,e.cancelIdleCallback(r))}}},yL=e=>md(globalThis,e)})();var bL;(e=>{async function t(r){let s,n=await Promise.all(r.map(o=>o.then(a=>a,a=>{s||(s=a)})));if(typeof s<"u")throw s;return n}e.settled=t;function i(r){return new Promise(async(s,n)=>{try{await r(s,n)}catch(o){n(o)}})}e.withAsyncBody=i})(bL||={});var uy=class $t{static fromArray(t){return new $t(i=>{i.emitMany(t)})}static fromPromise(t){return new $t(async i=>{i.emitMany(await t)})}static fromPromises(t){return new $t(async i=>{await Promise.all(t.map(async r=>i.emitOne(await r)))})}static merge(t){return new $t(async i=>{await Promise.all(t.map(async r=>{for await(let s of r)i.emitOne(s)}))})}constructor(t,i){this._state=0,this._results=[],this._error=null,this._onReturn=i,this._onStateChanged=new vi,queueMicrotask(async()=>{let r={emitOne:s=>this.emitOne(s),emitMany:s=>this.emitMany(s),reject:s=>this.reject(s)};try{await Promise.resolve(t(r)),this.resolve()}catch(s){this.reject(s)}finally{r.emitOne=void 0,r.emitMany=void 0,r.reject=void 0}})}[Symbol.asyncIterator](){let t=0;return{next:async()=>{do{if(this._state===2)throw this._error;if(t<this._results.length)return{done:!1,value:this._results[t++]};if(this._state===1)return{done:!0,value:void 0};await Ld.toPromise(this._onStateChanged.event)}while(!0)},return:async()=>(this._onReturn?.(),{done:!0,value:void 0})}}static map(t,i){return new $t(async r=>{for await(let s of t)r.emitOne(i(s))})}map(t){return $t.map(this,t)}static filter(t,i){return new $t(async r=>{for await(let s of t)i(s)&&r.emitOne(s)})}filter(t){return $t.filter(this,t)}static coalesce(t){return $t.filter(t,i=>!!i)}coalesce(){return $t.coalesce(this)}static async toPromise(t){let i=[];for await(let r of t)i.push(r);return i}toPromise(){return $t.toPromise(this)}emitOne(t){this._state===0&&(this._results.push(t),this._onStateChanged.fire())}emitMany(t){this._state===0&&(this._results=this._results.concat(t),this._onStateChanged.fire())}resolve(){this._state===0&&(this._state=1,this._onStateChanged.fire())}reject(t){this._state===0&&(this._state=2,this._error=t,this._onStateChanged.fire())}};uy.EMPTY=uy.fromArray([]);var wL=class extends mi{constructor(e){super(),this._terminal=e,this._linesCacheTimeout=this._register(new vl),this._linesCacheDisposables=this._register(new vl),this._register(Ls(()=>this._destroyLinesCache()))}initLinesCache(){this._linesCache||(this._linesCache=new Array(this._terminal.buffer.active.length),this._linesCacheDisposables.value=py(this._terminal.onLineFeed(()=>this._destroyLinesCache()),this._terminal.onCursorMove(()=>this._destroyLinesCache()),this._terminal.onResize(()=>this._destroyLinesCache()))),this._linesCacheTimeout.value=ky(()=>this._destroyLinesCache(),15e3)}_destroyLinesCache(){this._linesCache=void 0,this._linesCacheDisposables.clear(),this._linesCacheTimeout.clear()}getLineFromCache(e){return this._linesCache?.[e]}setLineInCache(e,t){this._linesCache&&(this._linesCache[e]=t)}translateBufferLineToStringWithWrap(e,t){let i=[],r=[0],s=this._terminal.buffer.active.getLine(e);for(;s;){let n=this._terminal.buffer.active.getLine(e+1),o=n?n.isWrapped:!1,a=s.translateToString(!o&&t);if(o&&n){let h=s.getCell(s.length-1);h&&h.getCode()===0&&h.getWidth()===1&&n.getCell(0)?.getWidth()===2&&(a=a.slice(0,-1))}if(i.push(a),o)r.push(r[r.length-1]+a.length);else break;e++,s=n}return[i.join(""),r]}},AL=class{get cachedSearchTerm(){return this._cachedSearchTerm}set cachedSearchTerm(e){this._cachedSearchTerm=e}get lastSearchOptions(){return this._lastSearchOptions}set lastSearchOptions(e){this._lastSearchOptions=e}isValidSearchTerm(e){return!!(e&&e.length>0)}didOptionsChange(e){return this._lastSearchOptions?e?this._lastSearchOptions.caseSensitive!==e.caseSensitive||this._lastSearchOptions.regex!==e.regex||this._lastSearchOptions.wholeWord!==e.wholeWord:!1:!0}shouldUpdateHighlighting(e,t){return t?.decorations?this._cachedSearchTerm===void 0||e!==this._cachedSearchTerm||this.didOptionsChange(t):!1}clearCachedTerm(){this._cachedSearchTerm=void 0}reset(){this._cachedSearchTerm=void 0,this._lastSearchOptions=void 0}},xL=class{constructor(e,t){this._terminal=e,this._lineCache=t}find(e,t,i,r){if(!e||e.length===0){this._terminal.clearSelection();return}if(i>this._terminal.cols)throw new Error(`Invalid col: ${i} to search in terminal of ${this._terminal.cols} cols`);this._lineCache.initLinesCache();let s={startRow:t,startCol:i},n=this._findInLine(e,s,r);if(!n)for(let o=t+1;o<this._terminal.buffer.active.baseY+this._terminal.rows&&(s.startRow=o,s.startCol=0,n=this._findInLine(e,s,r),!n);o++);return n}findNextWithSelection(e,t,i){if(!e||e.length===0){this._terminal.clearSelection();return}let r=this._terminal.getSelectionPosition();this._terminal.clearSelection();let s=0,n=0;r&&(i===e?(s=r.end.x,n=r.end.y):(s=r.start.x,n=r.start.y)),this._lineCache.initLinesCache();let o={startRow:n,startCol:s},a=this._findInLine(e,o,t);if(!a)for(let h=n+1;h<this._terminal.buffer.active.baseY+this._terminal.rows&&(o.startRow=h,o.startCol=0,a=this._findInLine(e,o,t),!a);h++);if(!a&&n!==0)for(let h=0;h<n&&(o.startRow=h,o.startCol=0,a=this._findInLine(e,o,t),!a);h++);return!a&&r&&(o.startRow=r.start.y,o.startCol=0,a=this._findInLine(e,o,t)),a}findPreviousWithSelection(e,t,i){if(!e||e.length===0){this._terminal.clearSelection();return}let r=this._terminal.getSelectionPosition();this._terminal.clearSelection();let s=this._terminal.buffer.active.baseY+this._terminal.rows-1,n=this._terminal.cols,o=!0;this._lineCache.initLinesCache();let a={startRow:s,startCol:n},h;if(r&&(a.startRow=s=r.start.y,a.startCol=n=r.start.x,i!==e&&(h=this._findInLine(e,a,t,!1),h||(a.startRow=s=r.end.y,a.startCol=n=r.end.x))),h||(h=this._findInLine(e,a,t,o)),!h){a.startCol=Math.max(a.startCol,this._terminal.cols);for(let l=s-1;l>=0&&(a.startRow=l,h=this._findInLine(e,a,t,o),!h);l--);}if(!h&&s!==this._terminal.buffer.active.baseY+this._terminal.rows-1)for(let l=this._terminal.buffer.active.baseY+this._terminal.rows-1;l>=s&&(a.startRow=l,h=this._findInLine(e,a,t,o),!h);l--);return h}_isWholeWord(e,t,i){return(e===0||" ~!@#$%^&*()+`-=[]{}|\\;:\"',./<>?".includes(t[e-1]))&&(e+i.length===t.length||" ~!@#$%^&*()+`-=[]{}|\\;:\"',./<>?".includes(t[e+i.length]))}_findInLine(e,t,i={},r=!1){let s=t.startRow,n=t.startCol;if(this._terminal.buffer.active.getLine(s)?.isWrapped){if(r){t.startCol+=this._terminal.cols;return}return t.startRow--,t.startCol+=this._terminal.cols,this._findInLine(e,t,i)}let o=this._lineCache.getLineFromCache(s);o||(o=this._lineCache.translateBufferLineToStringWithWrap(s,!0),this._lineCache.setLineInCache(s,o));let[a,h]=o,l=this._bufferColsToStringOffset(s,n),c=e,u=a;i.regex||(c=i.caseSensitive?e:e.toLowerCase(),u=i.caseSensitive?a:a.toLowerCase());let p=-1;if(i.regex){let g=RegExp(c,i.caseSensitive?"g":"gi"),v;if(r)for(;v=g.exec(u.slice(0,l));)p=g.lastIndex-v[0].length,e=v[0],g.lastIndex-=e.length-1;else v=g.exec(u.slice(l)),v&&v[0].length>0&&(p=l+(g.lastIndex-v[0].length),e=v[0])}else r?l-c.length>=0&&(p=u.lastIndexOf(c,l-c.length)):p=u.indexOf(c,l);if(p>=0){if(i.wholeWord&&!this._isWholeWord(p,u,e))return;let g=0;for(;g<h.length-1&&p>=h[g+1];)g++;let v=g;for(;v<h.length-1&&p+e.length>=h[v+1];)v++;let m=p-h[g],x=p+e.length-h[v],E=this._stringLengthToBufferSize(s+g,m),R=this._stringLengthToBufferSize(s+v,x)-E+this._terminal.cols*(v-g);return{term:e,col:E,row:s+g,size:R}}}_stringLengthToBufferSize(e,t){let i=this._terminal.buffer.active.getLine(e);if(!i)return 0;for(let r=0;r<t;r++){let s=i.getCell(r);if(!s)break;let n=s.getChars();n.length>1&&(t-=n.length-1);let o=i.getCell(r+1);o&&o.getWidth()===0&&t++}return t}_bufferColsToStringOffset(e,t){let i=e,r=0,s=this._terminal.buffer.active.getLine(i);for(;t>0&&s;){for(let n=0;n<t&&n<this._terminal.cols;n++){let o=s.getCell(n);if(!o)break;o.getWidth()&&(r+=o.getCode()===0?1:o.getChars().length)}if(i++,s=this._terminal.buffer.active.getLine(i),s&&!s.isWrapped)break;t-=this._terminal.cols}return r}},SL=class extends mi{constructor(e){super(),this._terminal=e,this._highlightDecorations=[],this._highlightedLines=new Set,this._register(Ls(()=>this.clearHighlightDecorations()))}createHighlightDecorations(e,t){this.clearHighlightDecorations();for(let i of e){let r=this._createResultDecorations(i,t,!1);if(r)for(let s of r)this._storeDecoration(s,i)}}createActiveDecoration(e,t){let i=this._createResultDecorations(e,t,!0);if(i)return{decorations:i,match:e,dispose(){Yn(i)}}}clearHighlightDecorations(){Yn(this._highlightDecorations),this._highlightDecorations=[],this._highlightedLines.clear()}_storeDecoration(e,t){this._highlightedLines.add(e.marker.line),this._highlightDecorations.push({decoration:e,match:t,dispose(){e.dispose()}})}_applyStyles(e,t,i){e.classList.contains("xterm-find-result-decoration")||(e.classList.add("xterm-find-result-decoration"),t&&(e.style.outline=`1px solid ${t}`)),i&&e.classList.add("xterm-find-active-result-decoration")}_createResultDecorations(e,t,i){let r=[],s=e.col,n=e.size,o=-this._terminal.buffer.active.baseY-this._terminal.buffer.active.cursorY+e.row;for(;n>0;){let h=Math.min(this._terminal.cols-s,n);r.push([o,s,h]),s=0,n-=h,o++}let a=[];for(let h of r){let l=this._terminal.registerMarker(h[0]),c=this._terminal.registerDecoration({marker:l,x:h[1],width:h[2],backgroundColor:i?t.activeMatchBackground:t.matchBackground,overviewRulerOptions:this._highlightedLines.has(l.line)?void 0:{color:i?t.activeMatchColorOverviewRuler:t.matchOverviewRuler,position:"center"}});if(c){let u=[];u.push(l),u.push(c.onRender(p=>this._applyStyles(p,i?t.activeMatchBorder:t.matchBorder,!1))),u.push(c.onDispose(()=>Yn(u))),a.push(c)}}return a.length===0?void 0:a}},CL=class extends mi{constructor(){super(...arguments),this._searchResults=[],this._onDidChangeResults=this._register(new vi)}get onDidChangeResults(){return this._onDidChangeResults.event}get searchResults(){return this._searchResults}get selectedDecoration(){return this._selectedDecoration}set selectedDecoration(e){this._selectedDecoration=e}updateResults(e,t){this._searchResults=e.slice(0,t)}clearResults(){this._searchResults=[]}clearSelectedDecoration(){this._selectedDecoration&&(this._selectedDecoration.dispose(),this._selectedDecoration=void 0)}findResultIndex(e){for(let t=0;t<this._searchResults.length;t++){let i=this._searchResults[t];if(i.row===e.row&&i.col===e.col&&i.size===e.size)return t}return-1}fireResultsChanged(e){if(!e)return;let t=-1;this._selectedDecoration&&(t=this.findResultIndex(this._selectedDecoration.match)),this._onDidChangeResults.fire({resultIndex:t,resultCount:this._searchResults.length})}reset(){this.clearSelectedDecoration(),this.clearResults()}},Ey=class extends mi{constructor(e){super(),this._highlightTimeout=this._register(new vl),this._lineCache=this._register(new vl),this._state=new AL,this._resultTracker=this._register(new CL),this._highlightLimit=e?.highlightLimit??1e3}get onDidChangeResults(){return this._resultTracker.onDidChangeResults}activate(e){this._terminal=e,this._lineCache.value=new wL(e),this._engine=new xL(e,this._lineCache.value),this._decorationManager=new SL(e),this._register(this._terminal.onWriteParsed(()=>this._updateMatches())),this._register(this._terminal.onResize(()=>this._updateMatches())),this._register(Ls(()=>this.clearDecorations()))}_updateMatches(){this._highlightTimeout.clear(),this._state.cachedSearchTerm&&this._state.lastSearchOptions?.decorations&&(this._highlightTimeout.value=ky(()=>{let e=this._state.cachedSearchTerm;this._state.clearCachedTerm(),this.findPrevious(e,{...this._state.lastSearchOptions,incremental:!0},{noScroll:!0})},200))}clearDecorations(e){this._resultTracker.clearSelectedDecoration(),this._decorationManager?.clearHighlightDecorations(),this._resultTracker.clearResults(),e||this._state.clearCachedTerm()}clearActiveDecoration(){this._resultTracker.clearSelectedDecoration()}findNext(e,t,i){if(!this._terminal||!this._engine)throw new Error("Cannot use addon until it has been loaded");this._state.lastSearchOptions=t,this._state.shouldUpdateHighlighting(e,t)&&this._highlightAllMatches(e,t);let r=this._findNextAndSelect(e,t,i);return this._fireResults(t),this._state.cachedSearchTerm=e,r}_highlightAllMatches(e,t){if(!this._terminal||!this._engine||!this._decorationManager)throw new Error("Cannot use addon until it has been loaded");if(!this._state.isValidSearchTerm(e)){this.clearDecorations();return}this.clearDecorations(!0);let i=[],r,s=this._engine.find(e,0,0,t);for(;s&&(r?.row!==s.row||r?.col!==s.col)&&!(i.length>=this._highlightLimit);)r=s,i.push(r),s=this._engine.find(e,r.col+r.term.length>=this._terminal.cols?r.row+1:r.row,r.col+r.term.length>=this._terminal.cols?0:r.col+1,t);this._resultTracker.updateResults(i,this._highlightLimit),t.decorations&&this._decorationManager.createHighlightDecorations(i,t.decorations)}_findNextAndSelect(e,t,i){if(!this._terminal||!this._engine)return!1;if(!this._state.isValidSearchTerm(e))return this._terminal.clearSelection(),this.clearDecorations(),!1;let r=this._engine.findNextWithSelection(e,t,this._state.cachedSearchTerm);return this._selectResult(r,t?.decorations,i?.noScroll)}findPrevious(e,t,i){if(!this._terminal||!this._engine)throw new Error("Cannot use addon until it has been loaded");this._state.lastSearchOptions=t,this._state.shouldUpdateHighlighting(e,t)&&this._highlightAllMatches(e,t);let r=this._findPreviousAndSelect(e,t,i);return this._fireResults(t),this._state.cachedSearchTerm=e,r}_fireResults(e){this._resultTracker.fireResultsChanged(!!e?.decorations)}_findPreviousAndSelect(e,t,i){if(!this._terminal||!this._engine)return!1;if(!this._state.isValidSearchTerm(e))return this._terminal.clearSelection(),this.clearDecorations(),!1;let r=this._engine.findPreviousWithSelection(e,t,this._state.cachedSearchTerm);return this._selectResult(r,t?.decorations,i?.noScroll)}_selectResult(e,t,i){if(!this._terminal||!this._decorationManager)return!1;if(this._resultTracker.clearSelectedDecoration(),!e)return this._terminal.clearSelection(),!1;if(this._terminal.select(e.col,e.row,e.size),t){let r=this._decorationManager.createActiveDecoration(e,t);r&&(this._resultTracker.selectedDecoration=r)}if(!i&&(e.row>=this._terminal.buffer.active.viewportY+this._terminal.rows||e.row<this._terminal.buffer.active.viewportY)){let r=e.row-this._terminal.buffer.active.viewportY;r-=Math.floor(this._terminal.rows/2),this._terminal.scrollLines(r)}return!0}};var kL=Object.create,Ky=Object.defineProperty,EL=Object.getOwnPropertyDescriptor,BL=Object.getOwnPropertyNames,LL=Object.getPrototypeOf,DL=Object.prototype.hasOwnProperty,ro=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),IL=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of BL(t))!DL.call(e,s)&&s!==i&&Ky(e,s,{get:()=>t[s],enumerable:!(r=EL(t,s))||r.enumerable});return e},Sl=(e,t,i)=>(i=e!=null?kL(LL(e)):{},IL(t||!e||!e.__esModule?Ky(i,"default",{value:e,enumerable:!0}):i,e)),Kd=ro(e=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_FOREGROUND=e.DEFAULT_BACKGROUND=e.PALETTE_ANSI_256=e.PALETTE_VT340_GREY=e.PALETTE_VT340_COLOR=e.normalizeHLS=e.normalizeRGB=e.nearestColorIndex=e.fromRGBA8888=e.toRGBA8888=e.alpha=e.blue=e.green=e.red=e.BIG_ENDIAN=void 0,e.BIG_ENDIAN=new Uint8Array(new Uint32Array([4278190080]).buffer)[0]===255,e.BIG_ENDIAN&&console.warn("BE platform detected. This version of node-sixel works only on LE properly.");function t(g){return g&255}e.red=t;function i(g){return g>>>8&255}e.green=i;function r(g){return g>>>16&255}e.blue=r;function s(g){return g>>>24&255}e.alpha=s;function n(g,v,m,x=255){return((x&255)<<24|(m&255)<<16|(v&255)<<8|g&255)>>>0}e.toRGBA8888=n;function o(g){return[g&255,g>>8&255,g>>16&255,g>>>24]}e.fromRGBA8888=o;function a(g,v){let m=t(g),x=i(g),E=r(g),R=Number.MAX_SAFE_INTEGER,D=-1;for(let b=0;b<v.length;++b){let L=m-v[b][0],I=x-v[b][1],T=E-v[b][2],q=L*L+I*I+T*T;if(!q)return b;q<R&&(R=q,D=b)}return D}e.nearestColorIndex=a;function h(g,v,m){return Math.max(g,Math.min(m,v))}function l(g,v,m){return m<0&&(m+=1),m>1&&(m-=1),m*6<1?v+(g-v)*6*m:m*2<1?g:m*3<2?v+(g-v)*(4-m*6):v}function c(g,v,m){if(!m){let R=Math.round(v*255);return n(R,R,R)}let x=v<.5?v*(1+m):v+m-v*m,E=2*v-x;return n(h(0,255,Math.round(l(x,E,g+1/3)*255)),h(0,255,Math.round(l(x,E,g)*255)),h(0,255,Math.round(l(x,E,g-1/3)*255)))}function u(g,v,m){return(4278190080|Math.round(m/100*255)<<16|Math.round(v/100*255)<<8|Math.round(g/100*255))>>>0}e.normalizeRGB=u;function p(g,v,m){return c((g+240%360)/360,v/100,m/100)}e.normalizeHLS=p,e.PALETTE_VT340_COLOR=new Uint32Array([u(0,0,0),u(20,20,80),u(80,13,13),u(20,80,20),u(80,20,80),u(20,80,80),u(80,80,20),u(53,53,53),u(26,26,26),u(33,33,60),u(60,26,26),u(33,60,33),u(60,33,60),u(33,60,60),u(60,60,33),u(80,80,80)]),e.PALETTE_VT340_GREY=new Uint32Array([u(0,0,0),u(13,13,13),u(26,26,26),u(40,40,40),u(6,6,6),u(20,20,20),u(33,33,33),u(46,46,46),u(0,0,0),u(13,13,13),u(26,26,26),u(40,40,40),u(6,6,6),u(20,20,20),u(33,33,33),u(46,46,46)]),e.PALETTE_ANSI_256=(()=>{let g=[n(0,0,0),n(205,0,0),n(0,205,0),n(205,205,0),n(0,0,238),n(205,0,205),n(0,250,205),n(229,229,229),n(127,127,127),n(255,0,0),n(0,255,0),n(255,255,0),n(92,92,255),n(255,0,255),n(0,255,255),n(255,255,255)],v=[0,95,135,175,215,255];for(let m=0;m<6;++m)for(let x=0;x<6;++x)for(let E=0;E<6;++E)g.push(n(v[m],v[x],v[E]));for(let m=8;m<=238;m+=10)g.push(n(m,m,m));return new Uint32Array(g)})(),e.DEFAULT_BACKGROUND=n(0,0,0,255),e.DEFAULT_FOREGROUND=n(255,255,255,255)}),ML=ro(e=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.InWasm=void 0;function t(r){if(typeof Buffer<"u")return Buffer.from(r,"base64");let s=atob(r),n=new Uint8Array(s.length);for(let o=0;o<n.length;++o)n[o]=s.charCodeAt(o);return n}function i(r){if(r.d){let{t:s,s:n,d:o}=r,a,h,l=WebAssembly;return s===2?n?()=>a||(a=t(o)):()=>Promise.resolve(a||(a=t(o))):s===1?n?()=>h||(h=new l.Module(a||(a=t(o)))):()=>h?Promise.resolve(h):l.compile(a||(a=t(o))).then(c=>h=c):n?c=>new l.Instance(h||(h=new l.Module(a||(a=t(o)))),c):c=>h?l.instantiate(h,c):l.instantiate(a||(a=t(o)),c).then(u=>(h=u.module)&&u.instance)}if(typeof _wasmCtx>"u")throw new Error('must run "inwasm"');_wasmCtx.add(r)}e.InWasm=i}),TL=ro(e=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t=ML(),i=(0,t.InWasm)({s:1,t:0,d:"AGFzbQEAAAABBQFgAAF/Ag8BA2VudgZtZW1vcnkCAAEDAwIAAAcNAgNkZWMAAANlbmQAAQqxAwKuAQEFf0GIKCgCAEGgKGohAUGEKCgCACIAQYAoKAIAQQFrQXxxIgJIBEAgAkGgKGohAyAAQaAoaiEAA0AgAC0AA0ECdCgCgCAgAC0AAkECdCgCgBggAC0AAUECdCgCgBAgAC0AAEECdCgCgAhycnIiBEH///8HSwRAQQEPCyABIAQ2AgAgAUEDaiEBIABBBGoiACADSQ0ACwtBhCggAjYCAEGIKCABQaAoazYCAEEAC/4BAQZ/AkBBgCgoAgAiAUGEKCgCACIAa0EFTgRAQQEhAxAADQFBgCgoAgAhAUGEKCgCACEAC0EBIQMgASAAayIEQQJIDQAgAEGhKGotAABBAnQoAoAQIABBoChqLQAAQQJ0KAKACHIhAQJAIARBAkYEQEEBIQIMAQtBASECIAAtAKIoIgVBPUcEQEECIQIgBUECdCgCgBggAXIhAQsgBEEERw0AIAAtAKMoIgBBPUYNACACQQFqIQIgAEECdCgCgCAgAXIhAQsgAUH///8HSw0AQYgoKAIAQaAoaiABNgIAQYgoQYgoKAIAIAJqIgA2AgAgAEGQKCgCAEchAwsgAwsAdglwcm9kdWNlcnMBDHByb2Nlc3NlZC1ieQEFY2xhbmdWMTguMC4wIChodHRwczovL2dpdGh1Yi5jb20vbGx2bS9sbHZtLXByb2plY3QgZDFlNjg1ZGY0NWRjNTk0NGI0M2QyNTQ3ZDAxMzhjZDRhM2VlNGVmZSkALA90YXJnZXRfZmVhdHVyZXMCKw9tdXRhYmxlLWdsb2JhbHMrCHNpZ24tZXh0"}),r=new Uint8Array("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("").map(a=>a.charCodeAt(0))),s=new Uint32Array(1024);s.fill(4278190080);for(let a=0;a<r.length;++a)s[r[a]]=a<<2;for(let a=0;a<r.length;++a)s[256+r[a]]=a>>4|(a<<4&255)<<8;for(let a=0;a<r.length;++a)s[512+r[a]]=a>>2<<8|(a<<6&255)<<16;for(let a=0;a<r.length;++a)s[768+r[a]]=a<<16;var n=new Uint8Array(0),o=class{constructor(a){this.keepSize=a}get data8(){return this._inst?this._d.subarray(0,this._m32[1282]):n}release(){this._inst&&(this._mem.buffer.byteLength>this.keepSize?this._inst=this._m32=this._d=this._mem=null:(this._m32[1280]=0,this._m32[1281]=0,this._m32[1282]=0))}init(a){let h=this._m32,l=(Math.ceil(a/3)+1288)*4;this._inst?this._mem.buffer.byteLength<l&&(this._mem.grow(Math.ceil((l-this._mem.buffer.byteLength)/65536)),h=new Uint32Array(this._mem.buffer,0),this._d=new Uint8Array(this._mem.buffer,1288*4)):(this._mem=new WebAssembly.Memory({initial:Math.ceil(l/65536)}),this._inst=i({env:{memory:this._mem}}),h=new Uint32Array(this._mem.buffer,0),h.set(s,256),this._d=new Uint8Array(this._mem.buffer,1288*4)),h[1284]=a,h[1283]=Math.ceil(a/3)*4,h[1280]=0,h[1281]=0,h[1282]=0,this._m32=h}put(a,h,l){if(!this._inst)return 1;let c=this._m32;return l-h+c[1280]>c[1283]?1:(this._d.set(a.subarray(h,l),c[1280]),c[1280]+=l-h,c[1280]-c[1281]>=131072?this._inst.exports.dec():0)}end(){return this._inst?this._inst.exports.end():1}};e.default=o}),RL=ro(e=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LIMITS=void 0,e.LIMITS={CHUNK_SIZE:16384,PALETTE_SIZE:4096,MAX_WIDTH:16384,BYTES:"AGFzbQEAAAABJAdgAAF/YAJ/fwBgA39/fwF/YAF/AX9gAABgBH9/f38AYAF/AAIlAgNlbnYLaGFuZGxlX2JhbmQAAwNlbnYLbW9kZV9wYXJzZWQAAwMTEgQAAAAAAQQBAQUBAAACAgAGAwQFAXABBwcFBAEBBwcGCAF/AUGAihoLB9wBDgZtZW1vcnkCABFnZXRfc3RhdGVfYWRkcmVzcwADEWdldF9jaHVua19hZGRyZXNzAAQOZ2V0X3AwX2FkZHJlc3MABRNnZXRfcGFsZXR0ZV9hZGRyZXNzAAYEaW5pdAALBmRlY29kZQAMDWN1cnJlbnRfd2lkdGgADQ5jdXJyZW50X2hlaWdodAAOGV9faW5kaXJlY3RfZnVuY3Rpb25fdGFibGUBAAtfaW5pdGlhbGl6ZQACCXN0YWNrU2F2ZQARDHN0YWNrUmVzdG9yZQASCnN0YWNrQWxsb2MAEwkMAQBBAQsGCgcJDxACDAEBCq5UEgMAAQsFAEGgCAsGAEGQiQELBgBBsIkCCwUAQZAJC+okAQh/QeQIKAIAIQVB4AgoAgAhA0HoCCgCACEIIAFBkIkBaiIJQf8BOgAAIAAgAUgEQCAAQZCJAWohBgNAIAMhBCAGQQFqIQECQCAGLQAAQf8AcSIDQTBrQQlLBEAgASEGDAELQewIKAIAQQJ0QewIaiICKAIAIQADQCACIAMgAEEKbGpBMGsiADYCACABLQAAIQMgAUEBaiIGIQEgA0H/AHEiA0Ewa0EKSQ0ACwsCQAJAAkACQAJAAkACQAJ/AkACQCADQT9rIgBBP00EQCAERQ0BIARBIUYEQAJAQfAIKAIAIgFBASABGyIHIAhqIgFB1AgoAgAiA0gNACADQf//AEoNAANAIANBAnQiAkGgiQJqIgRBoAgpAwA3AwAgAkGoiQJqQaAIKQMANwMAIAJBsIkCakGgCCkDADcDACACQbiJAmpBoAgpAwA3AwAgAkHAiQJqQaAIKQMANwMAIAJByIkCakGgCCkDADcDACACQdCJAmpBoAgpAwA3AwAgAkHYiQJqQaAIKQMANwMAIAJB4IkCakGgCCkDADcDACACQeiJAmpBoAgpAwA3AwAgAkHwiQJqQaAIKQMANwMAIAJB+IkCakGgCCkDADcDACACQYCKAmpBoAgpAwA3AwAgAkGIigJqQaAIKQMANwMAIAJBkIoCakGgCCkDADcDACACQZiKAmpBoAgpAwA3AwAgAkGgigJqQaAIKQMANwMAIAJBqIoCakGgCCkDADcDACACQbCKAmpBoAgpAwA3AwAgAkG4igJqQaAIKQMANwMAIAJBwIoCakGgCCkDADcDACACQciKAmpBoAgpAwA3AwAgAkHQigJqQaAIKQMANwMAIAJB2IoCakGgCCkDADcDACACQeCKAmpBoAgpAwA3AwAgAkHoigJqQaAIKQMANwMAIAJB8IoCakGgCCkDADcDACACQfiKAmpBoAgpAwA3AwAgAkGAiwJqQaAIKQMANwMAIAJBiIsCakGgCCkDADcDACACQZCLAmpBoAgpAwA3AwAgAkGYiwJqQaAIKQMANwMAIAJBoIsCakGgCCkDADcDACACQaiLAmpBoAgpAwA3AwAgAkGwiwJqQaAIKQMANwMAIAJBuIsCakGgCCkDADcDACACQcCLAmpBoAgpAwA3AwAgAkHIiwJqQaAIKQMANwMAIAJB0IsCakGgCCkDADcDACACQdiLAmpBoAgpAwA3AwAgAkHgiwJqQaAIKQMANwMAIAJB6IsCakGgCCkDADcDACACQfCLAmpBoAgpAwA3AwAgAkH4iwJqQaAIKQMANwMAIAJBgIwCakGgCCkDADcDACACQYiMAmpBoAgpAwA3AwAgAkGQjAJqQaAIKQMANwMAIAJBmIwCakGgCCkDADcDACACQaCMAmpBoAgpAwA3AwAgAkGojAJqQaAIKQMANwMAIAJBsIwCakGgCCkDADcDACACQbiMAmpBoAgpAwA3AwAgAkHAjAJqQaAIKQMANwMAIAJByIwCakGgCCkDADcDACACQdCMAmpBoAgpAwA3AwAgAkHYjAJqQaAIKQMANwMAIAJB4IwCakGgCCkDADcDACACQeiMAmpBoAgpAwA3AwAgAkHwjAJqQaAIKQMANwMAIAJB+IwCakGgCCkDADcDACACQYCNAmpBoAgpAwA3AwAgAkGIjQJqQaAIKQMANwMAIAJBkI0CakGgCCkDADcDACACQZiNAmpBoAgpAwA3AwAgAkGwiQZqIARBgAT8CgAAQdQIKAIAQQJ0QcCJCmogBEGABPwKAABB1AgoAgBBAnRB0IkOaiAEQYAE/AoAAEHUCCgCAEECdEHgiRJqIARBgAT8CgAAQdQIKAIAQQJ0QfCJFmogBEGABPwKAABB1AhB1AgoAgAiAkGAAWoiAzYCACABIANIDQEgAkGA/wBIDQALCwJAIABFDQAgCEH//wBLDQBBgIABIAhrIAcgAUH//wBLGyECAkAgAEEBcUUNACACRQ0AIAhBAnRBoIkCaiEDIAIhBCACQQdxIgcEQANAIAMgBTYCACADQQRqIQMgBEEBayEEIAdBAWsiBw0ACwsgAkEBa0EHSQ0AA0AgAyAFNgIcIAMgBTYCGCADIAU2AhQgAyAFNgIQIAMgBTYCDCADIAU2AgggAyAFNgIEIAMgBTYCACADQSBqIQMgBEEIayIEDQALCwJAIABBAnFFDQAgAkUNACAIQQJ0QbCJBmohAyACIQQgAkEHcSIHBEADQCADIAU2AgAgA0EEaiEDIARBAWshBCAHQQFrIgcNAAsLIAJBAWtBB0kNAANAIAMgBTYCHCADIAU2AhggAyAFNgIUIAMgBTYCECADIAU2AgwgAyAFNgIIIAMgBTYCBCADIAU2AgAgA0EgaiEDIARBCGsiBA0ACwsCQCAAQQRxRQ0AIAJFDQAgCEECdEHAiQpqIQMgAiEEIAJBB3EiBwRAA0AgAyAFNgIAIANBBGohAyAEQQFrIQQgB0EBayIHDQALCyACQQFrQQdJDQADQCADIAU2AhwgAyAFNgIYIAMgBTYCFCADIAU2AhAgAyAFNgIMIAMgBTYCCCADIAU2AgQgAyAFNgIAIANBIGohAyAEQQhrIgQNAAsLAkAgAEEIcUUNACACRQ0AIAhBAnRB0IkOaiEDIAIhBCACQQdxIgcEQANAIAMgBTYCACADQQRqIQMgBEEBayEEIAdBAWsiBw0ACwsgAkEBa0EHSQ0AA0AgAyAFNgIcIAMgBTYCGCADIAU2AhQgAyAFNgIQIAMgBTYCDCADIAU2AgggAyAFNgIEIAMgBTYCACADQSBqIQMgBEEIayIEDQALCwJAIABBEHFFDQAgAkUNACAIQQJ0QeCJEmohAyACIQQgAkEHcSIHBEADQCADIAU2AgAgA0EEaiEDIARBAWshBCAHQQFrIgcNAAsLIAJBAWtBB0kNAANAIAMgBTYCHCADIAU2AhggAyAFNgIUIAMgBTYCECADIAU2AgwgAyAFNgIIIAMgBTYCBCADIAU2AgAgA0EgaiEDIARBCGsiBA0ACwsgAEEgcUUNACACRQ0AIAJBAWshByAIQQJ0QfCJFmohAyACQQdxIgQEQANAIAMgBTYCACADQQRqIQMgAkEBayECIARBAWsiBA0ACwsgB0EHSQ0AA0AgAyAFNgIcIAMgBTYCGCADIAU2AhQgAyAFNgIQIAMgBTYCDCADIAU2AgggAyAFNgIEIAMgBTYCACADQSBqIQMgAkEIayICDQALC0HcCEHcCCgCACAAcjYCACAGQQFqIgIgBi0AAEH/AHEiA0E/ayIAQT9LDQQaDAMLAkBB7AgoAgAiBEEBRgRAQfAIKAIAIgNBzAgoAgAiAUkNASADIAFwIQMMAQtB+AgoAgAhAkH0CCgCACEBAkACQCAEQQVHDQAgAUEBRw0AIAJB6QJODQQMAQsgAkHkAEoNA0H8CCgCAEHkAEoNA0GACSgCAEHkAEoNAwsCQCABRQ0AIAFBAkoNACACQfwIKAIAQYAJKAIAIAFBAnRBiAhqKAIAEQIAIQFB8AgoAgAiA0HMCCgCACICTwR/IAMgAnAFIAMLQQJ0QZAJaiABNgIAC0HwCCgCACIDQcwIKAIAIgFJDQAgAyABcCEDCyADQQJ0QZAJaigCACEFDAELIANB/QBxQSFHBEAgCCEBIAYhAgwECyAEQSNHDQQCQEHsCCgCACICQQFGBEBB8AgoAgAiAUHMCCgCACIASQ0BIAEgAHAhAQwBC0H4CCgCACEBQfQIKAIAIQACQAJAIAJBBUcNACAAQQFHDQAgAUHpAkgNAQwHCyABQeQASg0GQfwIKAIAQeQASg0GQYAJKAIAQeQASg0GCwJAIABFDQAgAEECSg0AIAFB/AgoAgBBgAkoAgAgAEECdEGICGooAgARAgAhAEHwCCgCACIBQcwIKAIAIgJPBH8gASACcAUgAQtBAnRBkAlqIAA2AgALQfAIKAIAIgFBzAgoAgAiAEkNACABIABwIQELIAFBAnRBkAlqKAIAIQUMBAsgCCEBIAYhAgtB1AgoAgAhBgNAAkAgASAGSA0AIAZB//8ASg0AIAZBAnQiBEGgiQJqIgZBoAgpAwA3AwAgBEGoiQJqQaAIKQMANwMAIARBsIkCakGgCCkDADcDACAEQbiJAmpBoAgpAwA3AwAgBEHAiQJqQaAIKQMANwMAIARByIkCakGgCCkDADcDACAEQdCJAmpBoAgpAwA3AwAgBEHYiQJqQaAIKQMANwMAIARB4IkCakGgCCkDADcDACAEQeiJAmpBoAgpAwA3AwAgBEHwiQJqQaAIKQMANwMAIARB+IkCakGgCCkDADcDACAEQYCKAmpBoAgpAwA3AwAgBEGIigJqQaAIKQMANwMAIARBkIoCakGgCCkDADcDACAEQZiKAmpBoAgpAwA3AwAgBEGgigJqQaAIKQMANwMAIARBqIoCakGgCCkDADcDACAEQbCKAmpBoAgpAwA3AwAgBEG4igJqQaAIKQMANwMAIARBwIoCakGgCCkDADcDACAEQciKAmpBoAgpAwA3AwAgBEHQigJqQaAIKQMANwMAIARB2IoCakGgCCkDADcDACAEQeCKAmpBoAgpAwA3AwAgBEHoigJqQaAIKQMANwMAIARB8IoCakGgCCkDADcDACAEQfiKAmpBoAgpAwA3AwAgBEGAiwJqQaAIKQMANwMAIARBiIsCakGgCCkDADcDACAEQZCLAmpBoAgpAwA3AwAgBEGYiwJqQaAIKQMANwMAIARBoIsCakGgCCkDADcDACAEQaiLAmpBoAgpAwA3AwAgBEGwiwJqQaAIKQMANwMAIARBuIsCakGgCCkDADcDACAEQcCLAmpBoAgpAwA3AwAgBEHIiwJqQaAIKQMANwMAIARB0IsCakGgCCkDADcDACAEQdiLAmpBoAgpAwA3AwAgBEHgiwJqQaAIKQMANwMAIARB6IsCakGgCCkDADcDACAEQfCLAmpBoAgpAwA3AwAgBEH4iwJqQaAIKQMANwMAIARBgIwCakGgCCkDADcDACAEQYiMAmpBoAgpAwA3AwAgBEGQjAJqQaAIKQMANwMAIARBmIwCakGgCCkDADcDACAEQaCMAmpBoAgpAwA3AwAgBEGojAJqQaAIKQMANwMAIARBsIwCakGgCCkDADcDACAEQbiMAmpBoAgpAwA3AwAgBEHAjAJqQaAIKQMANwMAIARByIwCakGgCCkDADcDACAEQdCMAmpBoAgpAwA3AwAgBEHYjAJqQaAIKQMANwMAIARB4IwCakGgCCkDADcDACAEQeiMAmpBoAgpAwA3AwAgBEHwjAJqQaAIKQMANwMAIARB+IwCakGgCCkDADcDACAEQYCNAmpBoAgpAwA3AwAgBEGIjQJqQaAIKQMANwMAIARBkI0CakGgCCkDADcDACAEQZiNAmpBoAgpAwA3AwAgBEGwiQZqIAZBgAT8CgAAQdQIKAIAQQJ0QcCJCmogBkGABPwKAABB1AgoAgBBAnRB0IkOaiAGQYAE/AoAAEHUCCgCAEECdEHgiRJqIAZBgAT8CgAAQdQIKAIAQQJ0QfCJFmogBkGABPwKAABB1AhB1AgoAgBBgAFqIgY2AgALIAFB//8ATQRAIABBAXEgAWxBAnRBoIkCaiAFNgIAIABBAXZBAXEgAWxBAnRBsIkGaiAFNgIAIABBAnZBAXEgAWxBAnRBwIkKaiAFNgIAIABBA3ZBAXEgAWxBAnRB0IkOaiAFNgIAIABBBHZBAXEgAWxBAnRB4IkSaiAFNgIAIABBBXYgAWxBAnRB8IkWaiAFNgIAQdQIKAIAIQYLIAFBAWohAUHcCEHcCCgCACAAcjYCACACLQAAIQAgAkEBaiIEIQIgAEH/AHEiA0E/ayIAQcAASQ0ACyAECyECQQAhBCACIQYgASEIIANB/QBxQSFGDQELIANBJGsOCgEDAwMDAwMDAwIDC0HsCEIBNwIADAQLQdgIIAFB2AgoAgAiACAAIAFIGyIAQYCAASAAQYCAAUgbNgIADAILQegIIAFB2AgoAgAiACAAIAFIGyIAQYCAASAAQYCAAUgbIgA2AgBB2AggADYCACAAQQRrEAAEQEHoCEEENgIAQdgIQQQ2AgBB0AhBATYCAA8LEAgMAQsCQCADQTtHDQBB7AgoAgAiAEEHSg0AQewIIABBAWo2AgAgAEECdEHwCGpBADYCAAsgAiEGIAQhAyABIQgMAQtBBCEIIAIhBiAEIQMLIAYgCUkNAAsLQeQIIAU2AgBB4AggAzYCAEHoCCAINgIAC9ELAgF+CH9B2AhCBDcDAEGojQJBoAgpAwAiADcDAEGgjQIgADcDAEGYjQIgADcDAEGQjQIgADcDAEGIjQIgADcDAEGAjQIgADcDAEH4jAIgADcDAEHwjAIgADcDAEHojAIgADcDAEHgjAIgADcDAEHYjAIgADcDAEHQjAIgADcDAEHIjAIgADcDAEHAjAIgADcDAEG4jAIgADcDAEGwjAIgADcDAEGojAIgADcDAEGgjAIgADcDAEGYjAIgADcDAEGQjAIgADcDAEGIjAIgADcDAEGAjAIgADcDAEH4iwIgADcDAEHwiwIgADcDAEHoiwIgADcDAEHgiwIgADcDAEHYiwIgADcDAEHQiwIgADcDAEHIiwIgADcDAEHAiwIgADcDAEG4iwIgADcDAEGwiwIgADcDAEGoiwIgADcDAEGgiwIgADcDAEGYiwIgADcDAEGQiwIgADcDAEGIiwIgADcDAEGAiwIgADcDAEH4igIgADcDAEHwigIgADcDAEHoigIgADcDAEHgigIgADcDAEHYigIgADcDAEHQigIgADcDAEHIigIgADcDAEHAigIgADcDAEG4igIgADcDAEGwigIgADcDAEGoigIgADcDAEGgigIgADcDAEGYigIgADcDAEGQigIgADcDAEGIigIgADcDAEGAigIgADcDAEH4iQIgADcDAEHwiQIgADcDAEHoiQIgADcDAEHgiQIgADcDAEHYiQIgADcDAEHQiQIgADcDAEHIiQIgADcDAEHAiQIgADcDAEG4iQIgADcDAEGwiQIgADcDAEGoCCgCACIEQf8AakGAAW0hCAJAIARBgQFIDQBBASEBIAhBAiAIQQJKG0EBayICQQFxIQMgBEGBAk4EQCACQX5xIQIDQCABQQl0IgdBEHJBoIkCakGwiQJBgAT8CgAAIAdBsI0CakGwiQJBgAT8CgAAIAFBAmohASACQQJrIgINAAsLIANFDQAgAUEJdEEQckGgiQJqQbCJAkGABPwKAAALAkAgBEEBSA0AIAhBASAIQQFKGyIDQQFxIQUCQCADQQFrIgdFBEBBACEBDAELIANB/v///wdxIQJBACEBA0AgAUEJdCIGQRByQbCJBmpBsIkCQYAE/AoAACAGQZAEckGwiQZqQbCJAkGABPwKAAAgAUECaiEBIAJBAmsiAg0ACwsgBQRAIAFBCXRBEHJBsIkGakGwiQJBgAT8CgAACyAEQQFIDQAgA0EBcSEFIAcEfyADQf7///8HcSECQQAhAQNAIAFBCXQiBkEQckHAiQpqQbCJAkGABPwKAAAgBkGQBHJBwIkKakGwiQJBgAT8CgAAIAFBAmohASACQQJrIgINAAsgAUEHdEEEcgVBBAshASAFBEAgAUECdEHAiQpqQbCJAkGABPwKAAALIARBAUgNACADQQFxIQUgBwR/IANB/v///wdxIQJBACEBA0AgAUEJdCIGQRByQdCJDmpBsIkCQYAE/AoAACAGQZAEckHQiQ5qQbCJAkGABPwKAAAgAUECaiEBIAJBAmsiAg0ACyABQQd0QQRyBUEECyEBIAUEQCABQQJ0QdCJDmpBsIkCQYAE/AoAAAsgBEEBSA0AIANBAXEhBSAHBH8gA0H+////B3EhAkEAIQEDQCABQQl0IgZBEHJB4IkSakGwiQJBgAT8CgAAIAZBkARyQeCJEmpBsIkCQYAE/AoAACABQQJqIQEgAkECayICDQALIAFBB3RBBHIFQQQLIQEgBQRAIAFBAnRB4IkSakGwiQJBgAT8CgAACyAEQQFIDQAgA0EBcSEEIAcEfyADQf7///8HcSECQQAhAQNAIAFBCXQiA0EQckHwiRZqQbCJAkGABPwKAAAgA0GQBHJB8IkWakGwiQJBgAT8CgAAIAFBAmohASACQQJrIgINAAsgAUEHdEEEcgVBBAshASAERQ0AIAFBAnRB8IkWakGwiQJBgAT8CgAAC0HUCCAIQQd0QQRyNgIAC58TAgh/AX5B5AgoAgAhA0HgCCgCACECQegIKAIAIQcgAUGQiQFqIglB/wE6AAAgACABSARAIABBkIkBaiEIA0AgAiEEIAhBAWohAQJAIAgtAABB/wBxIgJBMGtBCUsEQCABIQgMAQtB7AgoAgBBAnRB7AhqIgUoAgAhAANAIAUgAiAAQQpsakEwayIANgIAIAEtAAAhAiABQQFqIgghASACQf8AcSICQTBrQQpJDQALCwJAAkACQAJAAkACQAJ/AkAgAkE/ayIAQT9NBEAgBEUNASAEQSFGBEBB8AgoAgAiAUEBIAEbIgQgB2ohAQJAIABFDQAgB0H//wBLDQBBgIABIAdrIAQgAUH//wBLGyEFAkAgAEEBcUUNACAHQQJ0QaCJAmohAiAFIgRBB3EiBgRAA0AgAiADNgIAIAJBBGohAiAEQQFrIQQgBkEBayIGDQALCyAFQQFrQQdJDQADQCACIAM2AhwgAiADNgIYIAIgAzYCFCACIAM2AhAgAiADNgIMIAIgAzYCCCACIAM2AgQgAiADNgIAIAJBIGohAiAEQQhrIgQNAAsLAkAgAEECcUUNACAHQQJ0QbCJBmohAiAFIgRBB3EiBgRAA0AgAiADNgIAIAJBBGohAiAEQQFrIQQgBkEBayIGDQALCyAFQQFrQQdJDQADQCACIAM2AhwgAiADNgIYIAIgAzYCFCACIAM2AhAgAiADNgIMIAIgAzYCCCACIAM2AgQgAiADNgIAIAJBIGohAiAEQQhrIgQNAAsLAkAgAEEEcUUNACAHQQJ0QcCJCmohAiAFIgRBB3EiBgRAA0AgAiADNgIAIAJBBGohAiAEQQFrIQQgBkEBayIGDQALCyAFQQFrQQdJDQADQCACIAM2AhwgAiADNgIYIAIgAzYCFCACIAM2AhAgAiADNgIMIAIgAzYCCCACIAM2AgQgAiADNgIAIAJBIGohAiAEQQhrIgQNAAsLAkAgAEEIcUUNACAHQQJ0QdCJDmohAiAFIgRBB3EiBgRAA0AgAiADNgIAIAJBBGohAiAEQQFrIQQgBkEBayIGDQALCyAFQQFrQQdJDQADQCACIAM2AhwgAiADNgIYIAIgAzYCFCACIAM2AhAgAiADNgIMIAIgAzYCCCACIAM2AgQgAiADNgIAIAJBIGohAiAEQQhrIgQNAAsLAkAgAEEQcUUNACAHQQJ0QeCJEmohAiAFIgRBB3EiBgRAA0AgAiADNgIAIAJBBGohAiAEQQFrIQQgBkEBayIGDQALCyAFQQFrQQdJDQADQCACIAM2AhwgAiADNgIYIAIgAzYCFCACIAM2AhAgAiADNgIMIAIgAzYCCCACIAM2AgQgAiADNgIAIAJBIGohAiAEQQhrIgQNAAsLIABBIHFFDQAgBUEBayEEIAdBAnRB8IkWaiEAIAVBB3EiAgRAA0AgACADNgIAIABBBGohACAFQQFrIQUgAkEBayICDQALCyAEQQdJDQADQCAAIAM2AhwgACADNgIYIAAgAzYCFCAAIAM2AhAgACADNgIMIAAgAzYCCCAAIAM2AgQgACADNgIAIABBIGohACAFQQhrIgUNAAsLIAhBAWoiBSAILQAAQf8AcSICQT9rIgBBP00NAxoMBAsCQEHsCCgCACIFQQFGBEBB8AgoAgAiAUHMCCgCACIESQ0BIAEgBHAhAQwBC0H4CCgCACEEQfQIKAIAIQECQAJAIAVBBUcNACABQQFHDQAgBEHpAk4NBAwBCyAEQeQASg0DQfwIKAIAQeQASg0DQYAJKAIAQeQASg0DCwJAIAFFDQAgAUECSg0AIARB/AgoAgBBgAkoAgAgAUECdEGICGooAgARAgAhBEHwCCgCACIBQcwIKAIAIgVPBH8gASAFcAUgAQtBAnRBkAlqIAQ2AgALQfAIKAIAIgFBzAgoAgAiBEkNACABIARwIQELIAFBAnRBkAlqKAIAIQMMAQsgAkH9AHFBIUcEQCAHIQEgAiEADAQLIARBI0cNBAJAQewIKAIAIgRBAUYEQEHwCCgCACIBQcwIKAIAIgBJDQEgASAAcCEBDAELQfgIKAIAIQFB9AgoAgAhAAJAAkAgBEEFRw0AIABBAUcNACABQekCSA0BDAcLIAFB5ABKDQZB/AgoAgBB5ABKDQZBgAkoAgBB5ABKDQYLAkAgAEUNACAAQQJKDQAgAUH8CCgCAEGACSgCACAAQQJ0QYgIaigCABECACEAQfAIKAIAIgFBzAgoAgAiBE8EfyABIARwBSABC0ECdEGQCWogADYCAAtB8AgoAgAiAUHMCCgCACIASQ0AIAEgAHAhAQsgAUECdEGQCWooAgAhAwwECyAHIQEgCAshBQNAIAFB//8ATQRAIABBAXEgAWxBAnRBoIkCaiADNgIAIABBAXZBAXEgAWxBAnRBsIkGaiADNgIAIABBAnZBAXEgAWxBAnRBwIkKaiADNgIAIABBA3ZBAXEgAWxBAnRB0IkOaiADNgIAIABBBHZBAXEgAWxBAnRB4IkSaiADNgIAIABBBXYgAWxBAnRB8IkWaiADNgIACyABQQFqIQEgBS0AACEAIAVBAWoiBCEFIABB/wBxIgJBP2siAEHAAEkNAAsgBCEFC0EAIQQgBSEIIAEhByACIQAgAkH9AHFBIUYNAQtBBCEHIAQhAiAAQSRrDgoDAgICAgICAgIBAgtB7AhCATcCAAwCC0GoCCgCAEEEaxAABEBB0AhBATYCAA8LAkBBqAgoAgAiBkEFSA0AQaAIKQMAIQogBkEDa0EBdiIBQQdxIQJBACEAIAFBAWtBB08EQCABQfj///8HcSEFA0AgAEEDdCIBQbCJAmogCjcDACABQQhyQbCJAmogCjcDACABQRByQbCJAmogCjcDACABQRhyQbCJAmogCjcDACABQSByQbCJAmogCjcDACABQShyQbCJAmogCjcDACABQTByQbCJAmogCjcDACABQThyQbCJAmogCjcDACAAQQhqIQAgBUEIayIFDQALCyACRQ0AA0AgAEEDdEGwiQJqIAo3AwAgAEEBaiEAIAJBAWsiAg0ACwtBwIkGQbCJAiAGQQJ0IgD8CgAAQdCJCkGwiQIgAPwKAABB4IkOQbCJAiAA/AoAAEHwiRJBsIkCIAD8CgAAQYCKFkGwiQIgAPwKAAAgBCECDAELAkAgAEE7Rw0AQewIKAIAIgBBB0oNAEHsCCAAQQFqNgIAIABBAnRB8AhqQQA2AgALIAEhBwsgCCAJSQ0ACwtB5AggAzYCAEHgCCACNgIAQegIIAc2AgAL4gcCBX8BfgJAQdAIAn8CQAJAIAAgAU4NACABQZCJAWohBiAAQZCJAWohBQNAIAUtAAAiA0H/AHEhAgJAAkACQAJAAkACQAJAQeAIKAIAIgRBIkcEQCAEDQcgAkEiRgRAQewIQgE3AgBB4AhBIjYCAAwICyACQT9rQcAASQ0GIANBIWsiAkEMTQ0BDAULAkAgAkEwayIEQQlNBEBB7AgoAgBBAnRB7AhqIgIgBCACKAIAQQpsajYCAAwBC0HsCCgCACEEIAJBO0YEQCAEQQdKDQFB7AggBEEBajYCACAEQQJ0QfAIakEANgIADAELIARBBEYEQEHECEECNgIAQbAIQfAIKQMANwMAQbgIQfgIKAIAIgI2AgBBvAhB/AgoAgAiBDYCAEHICEECQQFBwAgoAgAiAxs2AgBBrAggBEEAIAMbNgIAQagIIAJBgIABIAJBgIABSBtBBGpBACADGzYCAEHgCEEANgIADAoLIAJBP2tBwABJDQQLIANBIWsiAkEMTQ0BDAILQQEgAnRBjSBxRQ0DDAQLQQEgAnRBjSBxDQELIANBoQFrIgJBDEsNA0EBIAJ0QY0gcUUNAwtBxAhCgYCAgBA3AgBBsAhB8AgoAgBBAEHsCCgCACICQQBKGzYCAEG0CEH0CCgCAEEAIAJBAUobNgIAQbgIQfgIKAIAQQAgAkECShs2AgBB4AhBADYCAEG8CEEANgIADAQLIANBoQFrIgJBDEsNAUEBIAJ0QY0gcUUNAQtBxAhCgYCAgBA3AgBBsAhCADcDAEG4CEIANwMADAMLIAVBAWoiBSAGSQ0ACwsCQEHICCgCAA4DAwEAAQsCQEGoCCgCACIFQQVIDQBBoAgpAwAhByAFQQNrQQF2IgNBB3EhBEEAIQIgA0EBa0EHTwRAIANB+P///wdxIQYDQCACQQN0IgNBsIkCaiAHNwMAIANBCHJBsIkCaiAHNwMAIANBEHJBsIkCaiAHNwMAIANBGHJBsIkCaiAHNwMAIANBIHJBsIkCaiAHNwMAIANBKHJBsIkCaiAHNwMAIANBMHJBsIkCaiAHNwMAIANBOHJBsIkCaiAHNwMAIAJBCGohAiAGQQhrIgYNAAsLIARFDQADQCACQQN0QbCJAmogBzcDACACQQFqIQIgBEEBayIEDQALC0HAiQZBsIkCIAVBAnQiA/wKAABB0IkKQbCJAiAD/AoAAEHgiQ5BsIkCIAP8CgAAQfCJEkGwiQIgA/wKAABBgIoWQbCJAiAD/AoAAEECDAELEAhByAgoAgALEAEiAjYCACACDQAgACABQcgIKAIAQQJ0QYAIaigCABEBAAsLdABB6AhBBDYCAEHkCCAANgIAQewIQgE3AgBBxAhCADcCAEHACCADNgIAQdwIQgA3AgBBqAhCADcDAEGwCEIANwMAQbgIQgA3AwBBzAggAkGAICACQYAgSRs2AgBBoAggAa1CgYCAgBB+NwMAQdAIQQA2AgALIwBB0AgoAgBFBEAgACABQcgIKAIAQQJ0QYAIaigCABEBAAsLWgECfwJAAkACQEHICCgCAEEBaw4CAAECC0HYCEHoCCgCACIAQdgIKAIAIgEgACABShsiAEGAgAEgAEGAgAFIGyIANgIAIABBBGsPC0GoCCgCAEEEayEACyAAC0IBAX8Cf0EGQdwIKAIAIgBBIHENABpBBSAAQRBxDQAaQQQgAEEIcQ0AGkEDIABBBHENABpBAiAAQQFxIABBAnEbCwu9BQEFfQJ/IAJFBEAgAUH/AWxBMmpB5ABtIgBBCHQgAHIgAEEQdHIMAQsgArJDAADIQpUhBiAAQfABarJDAAC0Q5UhBQJ9IAGyQwAAyEKVIgNDAAAAP10EQCADIAZDAACAP5KUDAELIAYgA0MAAIA/IAaTlJILIQcgAyADkiEGAkAgBUOrqqo+kiIEQwAAAABdBEAgBEMAAIA/kiEEDAELIARDAACAP15FDQAgBEMAAIC/kiEECyAGIAeTIQMgBUMAAAAAXSEAAn8CfSADIAcgA5NDAADAQJQgBJSSIARDq6oqPl0NABogByAEQwAAAD9dDQAaIAMgBEOrqio/XUUNABogAyAHIAOTIARDAADAwJRDAACAQJKUkgtDAAB/Q5RDAAAAP5IiBkMAAIBPXSAGQwAAAABgcQRAIAapDAELQQALIQECQCAABEAgBUMAAIA/kiEEDAELIAUiBEMAAIA/XkUNACAFQwAAgL+SIQQLIAVDq6qqvpIiBUMAAAAAXSECAn8CfSADIAcgA5NDAADAQJQgBJSSIARDq6oqPl0NABogByAEQwAAAD9dDQAaIAMgBEOrqio/XUUNABogAyAHIAOTIARDAADAwJRDAACAQJKUkgtDAAB/Q5RDAAAAP5IiBkMAAIBPXSAGQwAAAABgcQRAIAapDAELQQALIQACQCACBEAgBUMAAIA/kiEFDAELIAVDAACAP15FDQAgBUMAAIC/kiEFCwJAIAVDq6oqPl0EQCADIAcgA5NDAADAQJQgBZSSIQcMAQsgBUMAAAA/XQ0AIAVDq6oqP11FBEAgAyEHDAELIAMgByADkyAFQwAAwMCUQwAAgECSlJIhBwsgAEEIdAJ/IAdDAAB/Q5RDAAAAP5IiBkMAAIBPXSAGQwAAAABgcQRAIAapDAELQQALQRB0ciABcgtBgICAeHILNwAgAEH/AWxBMmpB5ABtIAFB/wFsQTJqQeQAbUEIdHIgAkH/AWxBMmpB5ABtQRB0ckGAgIB4cgsEACMACwYAIAAkAAsQACMAIABrQXBxIgAkACAACwsYAQBBgAgLEQEAAAACAAAAAwAAAAQAAAAF"}}),FL=ro(e=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.decodeAsync=e.decode=e.Decoder=e.DecoderAsync=void 0;var t=Kd(),i=RL();function r(g){if(typeof Buffer<"u")return Buffer.from(g,"base64");let v=atob(g),m=new Uint8Array(v.length);for(let x=0;x<m.length;++x)m[x]=v.charCodeAt(x);return m}var s=r(i.LIMITS.BYTES),n,o=new Uint32Array,a=class{constructor(){this.bandHandler=g=>1,this.modeHandler=g=>1}handle_band(g){return this.bandHandler(g)}mode_parsed(g){return this.modeHandler(g)}},h={memoryLimit:2048*65536,sixelColor:t.DEFAULT_FOREGROUND,fillColor:t.DEFAULT_BACKGROUND,palette:t.PALETTE_VT340_COLOR,paletteLimit:i.LIMITS.PALETTE_SIZE,truncate:!0};function l(g){let v=new a,m={env:{handle_band:v.handle_band.bind(v),mode_parsed:v.mode_parsed.bind(v)}};return WebAssembly.instantiate(n||s,m).then(x=>(n=n||x.module,new c(g,x.instance||x,v)))}e.DecoderAsync=l;var c=class{constructor(g,v,m){if(this._PIXEL_OFFSET=i.LIMITS.MAX_WIDTH+4,this._canvas=o,this._bandWidths=[],this._maxWidth=0,this._minWidth=i.LIMITS.MAX_WIDTH,this._lastOffset=0,this._currentHeight=0,this._opts=Object.assign({},h,g),this._opts.paletteLimit>i.LIMITS.PALETTE_SIZE)throw new Error(`DecoderOptions.paletteLimit must not exceed ${i.LIMITS.PALETTE_SIZE}`);if(v)m.bandHandler=this._handle_band.bind(this),m.modeHandler=this._initCanvas.bind(this);else{let x=n||(n=new WebAssembly.Module(s));v=new WebAssembly.Instance(x,{env:{handle_band:this._handle_band.bind(this),mode_parsed:this._initCanvas.bind(this)}})}this._instance=v,this._wasm=this._instance.exports,this._chunk=new Uint8Array(this._wasm.memory.buffer,this._wasm.get_chunk_address(),i.LIMITS.CHUNK_SIZE),this._states=new Uint32Array(this._wasm.memory.buffer,this._wasm.get_state_address(),12),this._palette=new Uint32Array(this._wasm.memory.buffer,this._wasm.get_palette_address(),i.LIMITS.PALETTE_SIZE),this._palette.set(this._opts.palette),this._pSrc=new Uint32Array(this._wasm.memory.buffer,this._wasm.get_p0_address()),this._wasm.init(t.DEFAULT_FOREGROUND,0,this._opts.paletteLimit,0)}get _fillColor(){return this._states[0]}get _truncate(){return this._states[8]}get _rasterWidth(){return this._states[6]}get _rasterHeight(){return this._states[7]}get _width(){return this._states[2]?this._states[2]-4:0}get _height(){return this._states[3]}get _level(){return this._states[9]}get _mode(){return this._states[10]}get _paletteLimit(){return this._states[11]}_initCanvas(g){if(g===2){let v=this.width*this.height;if(v>this._canvas.length){if(this._opts.memoryLimit&&v*4>this._opts.memoryLimit)throw this.release(),new Error("image exceeds memory limit");this._canvas=new Uint32Array(v)}this._maxWidth=this._width}else if(g===1)if(this._level===2){let v=Math.min(this._rasterWidth,i.LIMITS.MAX_WIDTH)*this._rasterHeight;if(v>this._canvas.length){if(this._opts.memoryLimit&&v*4>this._opts.memoryLimit)throw this.release(),new Error("image exceeds memory limit");this._canvas=new Uint32Array(v)}}else this._canvas.length<65536&&(this._canvas=new Uint32Array(65536));return 0}_realloc(g,v){let m=g+v;if(m>this._canvas.length){if(this._opts.memoryLimit&&m*4>this._opts.memoryLimit)throw this.release(),new Error("image exceeds memory limit");let x=new Uint32Array(Math.ceil(m/65536)*65536);x.set(this._canvas),this._canvas=x}}_handle_band(g){let v=this._PIXEL_OFFSET,m=this._lastOffset;if(this._mode===2){let x=this.height-this._currentHeight,E=0;for(;E<6&&x>0;)this._canvas.set(this._pSrc.subarray(v*E,v*E+g),m+g*E),E++,x--;this._lastOffset+=g*E,this._currentHeight+=E}else if(this._mode===1){this._realloc(m,g*6),this._maxWidth=Math.max(this._maxWidth,g),this._minWidth=Math.min(this._minWidth,g);for(let x=0;x<6;++x)this._canvas.set(this._pSrc.subarray(v*x,v*x+g),m+g*x);this._bandWidths.push(g),this._lastOffset+=g*6,this._currentHeight+=6}return 0}get width(){return this._mode!==1?this._width:Math.max(this._maxWidth,this._wasm.current_width())}get height(){return this._mode!==1?this._height:this._wasm.current_width()?this._bandWidths.length*6+this._wasm.current_height():this._bandWidths.length*6}get palette(){return this._palette.subarray(0,this._paletteLimit)}get memoryUsage(){return this._canvas.byteLength+this._wasm.memory.buffer.byteLength+8*this._bandWidths.length}get properties(){return{width:this.width,height:this.height,mode:this._mode,level:this._level,truncate:!!this._truncate,paletteLimit:this._paletteLimit,fillColor:this._fillColor,memUsage:this.memoryUsage,rasterAttributes:{numerator:this._states[4],denominator:this._states[5],width:this._rasterWidth,height:this._rasterHeight}}}init(g=this._opts.fillColor,v=this._opts.palette,m=this._opts.paletteLimit,x=this._opts.truncate){this._wasm.init(this._opts.sixelColor,g,m,x?1:0),v&&this._palette.set(v.subarray(0,i.LIMITS.PALETTE_SIZE)),this._bandWidths.length=0,this._maxWidth=0,this._minWidth=i.LIMITS.MAX_WIDTH,this._lastOffset=0,this._currentHeight=0}decode(g,v=0,m=g.length){let x=v;for(;x<m;){let E=Math.min(m-x,i.LIMITS.CHUNK_SIZE);this._chunk.set(g.subarray(x,x+=E)),this._wasm.decode(0,E)}}decodeString(g,v=0,m=g.length){let x=v;for(;x<m;){let E=Math.min(m-x,i.LIMITS.CHUNK_SIZE);for(let R=0,D=x;R<E;++R,++D)this._chunk[R]=g.charCodeAt(D);x+=E,this._wasm.decode(0,E)}}get data32(){if(this._mode===0||!this.width||!this.height)return o;let g=this._wasm.current_width();if(this._mode===2){let v=this.height-this._currentHeight;if(v>0){let m=this._PIXEL_OFFSET,x=this._lastOffset,E=0;for(;E<6&&v>0;)this._canvas.set(this._pSrc.subarray(m*E,m*E+g),x+g*E),E++,v--;v&&this._canvas.fill(this._fillColor,x+g*E)}return this._canvas.subarray(0,this.width*this.height)}if(this._mode===1){if(this._minWidth===this._maxWidth){let E=!1;if(g)if(g!==this._minWidth)E=!0;else{let R=this._PIXEL_OFFSET,D=this._lastOffset;this._realloc(D,g*6);for(let b=0;b<6;++b)this._canvas.set(this._pSrc.subarray(R*b,R*b+g),D+g*b)}if(!E)return this._canvas.subarray(0,this.width*this.height)}let v=new Uint32Array(this.width*this.height);v.fill(this._fillColor);let m=0,x=0;for(let E=0;E<this._bandWidths.length;++E){let R=this._bandWidths[E];for(let D=0;D<6;++D)v.set(this._canvas.subarray(x,x+=R),m),m+=this.width}if(g){let E=this._PIXEL_OFFSET,R=this._wasm.current_height();for(let D=0;D<R;++D)v.set(this._pSrc.subarray(E*D,E*D+g),m+this.width*D)}return v}return o}get data8(){return new Uint8ClampedArray(this.data32.buffer,0,this.width*this.height*4)}release(){this._canvas=o,this._bandWidths.length=0,this._maxWidth=0,this._minWidth=i.LIMITS.MAX_WIDTH,this._wasm.init(t.DEFAULT_FOREGROUND,0,this._opts.paletteLimit,0)}};e.Decoder=c;function u(g,v){let m=new c(v);return m.init(),typeof g=="string"?m.decodeString(g):m.decode(g),{width:m.width,height:m.height,data32:m.data32,data8:m.data8}}e.decode=u;async function p(g,v){let m=await l(v);return m.init(),typeof g=="string"?m.decodeString(g):m.decode(g),{width:m.width,height:m.height,data32:m.data32,data8:m.data8}}e.decodeAsync=p}),By=Sl(Kd()),PL=class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(e){setTimeout(()=>{throw e.stack?Ly.isErrorNoTelemetry(e)?new Ly(e.message+`

`+e.stack):new Error(e.message+`

`+e.stack):e},0)}}addListener(e){return this.listeners.push(e),()=>{this._removeListener(e)}}emit(e){this.listeners.forEach(t=>{t(e)})}_removeListener(e){this.listeners.splice(this.listeners.indexOf(e),1)}setUnexpectedErrorHandler(e){this.unexpectedErrorHandler=e}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(e){this.unexpectedErrorHandler(e),this.emit(e)}onUnexpectedExternalError(e){this.unexpectedErrorHandler(e)}},nF=new PL,Ly=class Rd extends Error{constructor(t){super(t),this.name="CodeExpectedError"}static fromError(t){if(t instanceof Rd)return t;let i=new Rd;return i.message=t.message,i.stack=t.stack,i}static isErrorNoTelemetry(t){return t.name==="CodeExpectedError"}};function OL(e,t,i=0,r=e.length){let s=i,n=r;for(;s<n;){let o=Math.floor((s+n)/2);t(e[o])?s=o+1:n=o}return s-1}var KL=class Ny{constructor(t){this._array=t,this._findLastMonotonousLastIdx=0}findLastMonotonous(t){if(Ny.assertInvariants){if(this._prevFindLastPredicate){for(let r of this._array)if(this._prevFindLastPredicate(r)&&!t(r))throw new Error("MonotonousArray: current predicate must be weaker than (or equal to) the previous predicate.")}this._prevFindLastPredicate=t}let i=OL(this._array,t,this._findLastMonotonousLastIdx);return this._findLastMonotonousLastIdx=i+1,i===-1?void 0:this._array[i]}};KL.assertInvariants=!1;var Qy;(e=>{function t(n){return n<0}e.isLessThan=t;function i(n){return n<=0}e.isLessThanOrEqual=i;function r(n){return n>0}e.isGreaterThan=r;function s(n){return n===0}e.isNeitherLessOrGreaterThan=s,e.greaterThan=1,e.lessThan=-1,e.neitherLessOrGreaterThan=0})(Qy||={});function NL(e,t){return(i,r)=>t(e(i),e(r))}var QL=(e,t)=>e-t,Dy=class Fd{constructor(t){this.iterate=t}forEach(t){this.iterate(i=>(t(i),!0))}toArray(){let t=[];return this.iterate(i=>(t.push(i),!0)),t}filter(t){return new Fd(i=>this.iterate(r=>t(r)?i(r):!0))}map(t){return new Fd(i=>this.iterate(r=>i(t(r))))}some(t){let i=!1;return this.iterate(r=>(i=t(r),!i)),i}findFirst(t){let i;return this.iterate(r=>t(r)?(i=r,!1):!0),i}findLast(t){let i;return this.iterate(r=>(t(r)&&(i=r),!0)),i}findLastMaxBy(t){let i,r=!0;return this.iterate(s=>((r||Qy.isGreaterThan(t(s,i)))&&(r=!1,i=s),!0)),i}};Dy.empty=new Dy(e=>{});function HL(e,t){let i=Object.create(null);for(let r of e){let s=t(r),n=i[s];n||(n=i[s]=[]),n.push(r)}return i}var Iy,My,oF=class{constructor(e,t){this.toKey=t,this._map=new Map,this[Iy]="SetWithKey";for(let i of e)this.add(i)}get size(){return this._map.size}add(e){let t=this.toKey(e);return this._map.set(t,e),this}delete(e){return this._map.delete(this.toKey(e))}has(e){return this._map.has(this.toKey(e))}*entries(){for(let e of this._map.values())yield[e,e]}keys(){return this.values()}*values(){for(let e of this._map.values())yield e}clear(){this._map.clear()}forEach(e,t){this._map.forEach(i=>e.call(t,i,i,this))}[(My=Symbol.iterator,Iy=Symbol.toStringTag,My)](){return this.values()}},XL=class{constructor(){this.map=new Map}add(e,t){let i=this.map.get(e);i||(i=new Set,this.map.set(e,i)),i.add(t)}delete(e,t){let i=this.map.get(e);i&&(i.delete(t),i.size===0&&this.map.delete(e))}forEach(e,t){let i=this.map.get(e);i&&i.forEach(t)}get(e){return this.map.get(e)||new Set}};function UL(e,t){let i=this,r=!1,s;return function(){if(r)return s;if(r=!0,t)try{s=e.apply(i,arguments)}finally{t()}else s=e.apply(i,arguments);return s}}var Hy;(e=>{function t(b){return b&&typeof b=="object"&&typeof b[Symbol.iterator]=="function"}e.is=t;let i=Object.freeze([]);function r(){return i}e.empty=r;function*s(b){yield b}e.single=s;function n(b){return t(b)?b:s(b)}e.wrap=n;function o(b){return b||i}e.from=o;function*a(b){for(let L=b.length-1;L>=0;L--)yield b[L]}e.reverse=a;function h(b){return!b||b[Symbol.iterator]().next().done===!0}e.isEmpty=h;function l(b){return b[Symbol.iterator]().next().value}e.first=l;function c(b,L){let I=0;for(let T of b)if(L(T,I++))return!0;return!1}e.some=c;function u(b,L){for(let I of b)if(L(I))return I}e.find=u;function*p(b,L){for(let I of b)L(I)&&(yield I)}e.filter=p;function*g(b,L){let I=0;for(let T of b)yield L(T,I++)}e.map=g;function*v(b,L){let I=0;for(let T of b)yield*L(T,I++)}e.flatMap=v;function*m(...b){for(let L of b)yield*L}e.concat=m;function x(b,L,I){let T=I;for(let q of b)T=L(T,q);return T}e.reduce=x;function*E(b,L,I=b.length){for(L<0&&(L+=b.length),I<0?I+=b.length:I>b.length&&(I=b.length);L<I;L++)yield b[L]}e.slice=E;function R(b,L=Number.POSITIVE_INFINITY){let I=[];if(L===0)return[I,b];let T=b[Symbol.iterator]();for(let q=0;q<L;q++){let $=T.next();if($.done)return[I,e.empty()];I.push($.value)}return[I,{[Symbol.iterator](){return T}}]}e.consume=R;async function D(b){let L=[];for await(let I of b)L.push(I);return Promise.resolve(L)}e.asyncToArray=D})(Hy||={});var zL=!1,Cl=null,WL=class Xy{constructor(){this.livingDisposables=new Map}getDisposableData(t){let i=this.livingDisposables.get(t);return i||(i={parent:null,source:null,isSingleton:!1,value:t,idx:Xy.idx++},this.livingDisposables.set(t,i)),i}trackDisposable(t){let i=this.getDisposableData(t);i.source||(i.source=new Error().stack)}setParent(t,i){let r=this.getDisposableData(t);r.parent=i}markAsDisposed(t){this.livingDisposables.delete(t)}markAsSingleton(t){this.getDisposableData(t).isSingleton=!0}getRootParent(t,i){let r=i.get(t);if(r)return r;let s=t.parent?this.getRootParent(this.getDisposableData(t.parent),i):t;return i.set(t,s),s}getTrackedDisposables(){let t=new Map;return[...this.livingDisposables.entries()].filter(([,i])=>i.source!==null&&!this.getRootParent(i,t).isSingleton).flatMap(([i])=>i)}computeLeakingDisposables(t=10,i){let r;if(i)r=i;else{let h=new Map,l=[...this.livingDisposables.values()].filter(u=>u.source!==null&&!this.getRootParent(u,h).isSingleton);if(l.length===0)return;let c=new Set(l.map(u=>u.value));if(r=l.filter(u=>!(u.parent&&c.has(u.parent))),r.length===0)throw new Error("There are cyclic diposable chains!")}if(!r)return;function s(h){function l(u,p){for(;u.length>0&&p.some(g=>typeof g=="string"?g===u[0]:u[0].match(g));)u.shift()}let c=h.source.split(`
`).map(u=>u.trim().replace("at ","")).filter(u=>u!=="");return l(c,["Error",/^trackDisposable \(.*\)$/,/^DisposableTracker.trackDisposable \(.*\)$/]),c.reverse()}let n=new XL;for(let h of r){let l=s(h);for(let c=0;c<=l.length;c++)n.add(l.slice(0,c).join(`
`),h)}r.sort(NL(h=>h.idx,QL));let o="",a=0;for(let h of r.slice(0,t)){a++;let l=s(h),c=[];for(let u=0;u<l.length;u++){let p=l[u];p=`(shared with ${n.get(l.slice(0,u+1).join(`
`)).size}/${r.length} leaks) at ${p}`;let g=n.get(l.slice(0,u).join(`
`)),v=HL([...g].map(m=>s(m)[u]),m=>m);delete v[l[u]];for(let[m,x]of Object.entries(v))c.unshift(`    - stacktraces of ${x.length} other leaks continue with ${m}`);c.unshift(p)}o+=`


==================== Leaking disposable ${a}/${r.length}: ${h.value.constructor.name} ====================
${c.join(`
`)}
============================================================

`}return r.length>t&&(o+=`


... and ${r.length-t} more leaking disposables

`),{leaks:r,details:o}}};WL.idx=0;function $L(e){Cl=e}if(zL){let e="__is_disposable_tracked__";$L(new class{trackDisposable(t){let i=new Error("Potentially leaked disposable").stack;setTimeout(()=>{t[e]||console.log(i)},3e3)}setParent(t,i){if(t&&t!==wl.None)try{t[e]=!0}catch{}}markAsDisposed(t){if(t&&t!==wl.None)try{t[e]=!0}catch{}}markAsSingleton(t){}})}function kl(e){return Cl?.trackDisposable(e),e}function El(e){Cl?.markAsDisposed(e)}function eo(e,t){Cl?.setParent(e,t)}function GL(e){if(Hy.is(e)){let t=[];for(let i of e)if(i)try{i.dispose()}catch(r){t.push(r)}if(t.length===1)throw t[0];if(t.length>1)throw new AggregateError(t,"Encountered errors while disposing of store");return Array.isArray(e)?[]:e}else if(e)return e.dispose(),e}function jL(e){let t=kl({dispose:UL(()=>{El(t),e()})});return t}var Uy=class zy{constructor(){this._toDispose=new Set,this._isDisposed=!1,kl(this)}dispose(){this._isDisposed||(El(this),this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{GL(this._toDispose)}finally{this._toDispose.clear()}}add(t){if(!t)return t;if(t===this)throw new Error("Cannot register a disposable on itself!");return eo(t,this),this._isDisposed?zy.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(t),t}delete(t){if(t){if(t===this)throw new Error("Cannot dispose a disposable on itself!");this._toDispose.delete(t),t.dispose()}}deleteAndLeak(t){t&&this._toDispose.has(t)&&(this._toDispose.delete(t),eo(t,null))}};Uy.DISABLE_DISPOSED_WARNING=!1;var qL=Uy,wl=class{constructor(){this._store=new qL,kl(this),eo(this._store,this)}dispose(){El(this),this._store.dispose()}_register(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}};wl.None=Object.freeze({dispose(){}});var VL=class{constructor(){this._isDisposed=!1,kl(this)}get value(){return this._isDisposed?void 0:this._value}set value(e){this._isDisposed||e===this._value||(this._value?.dispose(),e&&eo(e,this),this._value=e)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,El(this),this._value?.dispose(),this._value=void 0}clearAndLeak(){let e=this._value;return this._value=void 0,e&&eo(e,null),e}},YL=4096,Dd=24,Bl=class wr extends wl{constructor(t){super(),this._terminal=t,this._optionsRefresh=this._register(new VL),this._oldOpen=this._terminal._core.open,this._terminal._core.open=i=>{this._oldOpen?.call(this._terminal._core,i),this._open()},this._terminal._core.screenElement&&this._open(),this._optionsRefresh.value=this._terminal._core.optionsService.onOptionChange(i=>{i==="fontSize"&&(this.rescaleCanvas(),this._renderService?.refreshRows(0,this._terminal.rows))}),this._register(jL(()=>{this.removeLayerFromDom(),this._terminal._core&&this._oldOpen&&(this._terminal._core.open=this._oldOpen,this._oldOpen=void 0),this._renderService&&this._oldSetRenderer&&(this._renderService.setRenderer=this._oldSetRenderer,this._oldSetRenderer=void 0),this._renderService=void 0,this.canvas=void 0,this._ctx=void 0,this._placeholderBitmap?.close(),this._placeholderBitmap=void 0,this._placeholder=void 0}))}static createCanvas(t,i,r){let s=(t||document).createElement("canvas");return s.width=i|0,s.height=r|0,s}static createImageData(t,i,r,s){if(typeof ImageData!="function"){let n=t.createImageData(i,r);return s&&n.data.set(new Uint8ClampedArray(s,0,i*r*4)),n}return s?new ImageData(new Uint8ClampedArray(s,0,i*r*4),i,r):new ImageData(i,r)}static createImageBitmap(t){return typeof createImageBitmap!="function"?Promise.resolve(void 0):createImageBitmap(t)}showPlaceholder(t){t?!this._placeholder&&this.cellSize.height!==-1&&this._createPlaceHolder(Math.max(this.cellSize.height+1,Dd)):(this._placeholderBitmap?.close(),this._placeholderBitmap=void 0,this._placeholder=void 0),this._renderService?.refreshRows(0,this._terminal.rows)}get dimensions(){return this._renderService?.dimensions}get cellSize(){return{width:this.dimensions?.css.cell.width||-1,height:this.dimensions?.css.cell.height||-1}}clearLines(t,i){this._ctx?.clearRect(0,t*(this.dimensions?.css.cell.height||0),this.dimensions?.css.canvas.width||0,(++i-t)*(this.dimensions?.css.cell.height||0))}clearAll(){this._ctx?.clearRect(0,0,this.canvas?.width||0,this.canvas?.height||0)}draw(t,i,r,s,n=1){if(!this._ctx)return;let{width:o,height:a}=this.cellSize;if(o===-1||a===-1)return;this._rescaleImage(t,o,a);let h=t.actual,l=Math.ceil(h.width/o),c=i%l*o,u=Math.floor(i/l)*a,p=r*o,g=s*a,v=n*o+c>h.width?h.width-c:n*o,m=u+a>h.height?h.height-u:a;this._ctx.drawImage(h,Math.floor(c),Math.floor(u),Math.ceil(v),Math.ceil(m),Math.floor(p),Math.floor(g),Math.ceil(v),Math.ceil(m))}extractTile(t,i){let{width:r,height:s}=this.cellSize;if(r===-1||s===-1)return;this._rescaleImage(t,r,s);let n=t.actual,o=Math.ceil(n.width/r),a=i%o*r,h=Math.floor(i/o)*s,l=r+a>n.width?n.width-a:r,c=h+s>n.height?n.height-h:s,u=wr.createCanvas(this.document,l,c),p=u.getContext("2d");if(p)return p.drawImage(n,Math.floor(a),Math.floor(h),Math.floor(l),Math.floor(c),0,0,Math.floor(l),Math.floor(c)),u}drawPlaceholder(t,i,r=1){if(this._ctx){let{width:s,height:n}=this.cellSize;if(s===-1||n===-1||(this._placeholder?n>=this._placeholder.height&&this._createPlaceHolder(n+1):this._createPlaceHolder(Math.max(n+1,Dd)),!this._placeholder))return;this._ctx.drawImage(this._placeholderBitmap||this._placeholder,t*s,i*n%2?0:1,s*r,n,t*s,i*n,s*r,n)}}rescaleCanvas(){this.canvas&&(this.canvas.width!==this.dimensions.css.canvas.width||this.canvas.height!==this.dimensions.css.canvas.height)&&(this.canvas.width=this.dimensions.css.canvas.width||0,this.canvas.height=this.dimensions.css.canvas.height||0)}_rescaleImage(t,i,r){if(i===t.actualCellSize.width&&r===t.actualCellSize.height)return;let{width:s,height:n}=t.origCellSize;if(i===s&&r===n){t.actual=t.orig,t.actualCellSize.width=s,t.actualCellSize.height=n;return}let o=wr.createCanvas(this.document,Math.ceil(t.orig.width*i/s),Math.ceil(t.orig.height*r/n)),a=o.getContext("2d");a&&(a.drawImage(t.orig,0,0,o.width,o.height),t.actual=o,t.actualCellSize.width=i,t.actualCellSize.height=r)}_open(){this._renderService=this._terminal._core._renderService,this._oldSetRenderer=this._renderService.setRenderer.bind(this._renderService),this._renderService.setRenderer=t=>{this.removeLayerFromDom(),this._oldSetRenderer?.call(this._renderService,t)}}insertLayerToDom(){this.document&&this._terminal._core.screenElement?this.canvas||(this.canvas=wr.createCanvas(this.document,this.dimensions?.css.canvas.width||0,this.dimensions?.css.canvas.height||0),this.canvas.classList.add("xterm-image-layer"),this._terminal._core.screenElement.appendChild(this.canvas),this._ctx=this.canvas.getContext("2d",{alpha:!0,desynchronized:!0}),this.clearAll()):console.warn("image addon: cannot insert output canvas to DOM, missing document or screenElement")}removeLayerFromDom(){this.canvas&&(this._ctx=void 0,this.canvas.remove(),this.canvas=void 0)}_createPlaceHolder(t=Dd){this._placeholderBitmap?.close(),this._placeholderBitmap=void 0;let i=32,r=wr.createCanvas(this.document,i,t),s=r.getContext("2d",{alpha:!1});if(!s)return;let n=wr.createImageData(s,i,t),o=new Uint32Array(n.data.buffer),a=(0,By.toRGBA8888)(0,0,0),h=(0,By.toRGBA8888)(255,255,255);o.fill(a);for(let u=0;u<t;++u){let p=u%2,g=u*i;for(let v=0;v<i;v+=2)o[g+v+p]=h}s.putImageData(n,0,0);let l=screen.width+i-1&~(i-1)||YL;this._placeholder=wr.createCanvas(this.document,l,t);let c=this._placeholder.getContext("2d",{alpha:!1});if(!c){this._placeholder=void 0;return}for(let u=0;u<l;u+=i)c.drawImage(r,u,0);wr.createImageBitmap(this._placeholder).then(u=>this._placeholderBitmap=u)}get document(){return this._terminal._core._coreBrowserService?.window.document}},to={width:7,height:14},Pd=class Wy{constructor(t=0,i=0,r=-1,s=-1){this.imageId=r,this.tileId=s,this._ext=0,this._urlId=0,this._ext=t,this._urlId=i}get ext(){return this._urlId?this._ext&-469762049|this.underlineStyle<<26:this._ext}set ext(t){this._ext=t}get underlineStyle(){return this._urlId?5:(this._ext&469762048)>>26}set underlineStyle(t){this._ext&=-469762049,this._ext|=t<<26&469762048}get underlineColor(){return this._ext&67108863}set underlineColor(t){this._ext&=-67108864,this._ext|=t&67108863}get underlineVariantOffset(){let t=(this._ext&3758096384)>>29;return t<0?t^4294967288:t}set underlineVariantOffset(t){this._ext&=536870911,this._ext|=t<<29&3758096384}get urlId(){return this._urlId}set urlId(t){this._urlId=t}clone(){return new Wy(this._ext,this._urlId,this.imageId,this.tileId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0&&this.imageId===-1}},Zn=new Pd,JL=class{constructor(e,t,i){this._terminal=e,this._renderer=t,this._opts=i,this._images=new Map,this._lastId=0,this._lowestId=0,this._fullyCleared=!1,this._needsFullClear=!1,this._pixelLimit=25e5;try{this.setLimit(this._opts.storageLimit)}catch(r){console.error(r.message),console.warn(`storageLimit is set to ${this.getLimit()} MB`)}this._viewportMetrics={cols:this._terminal.cols,rows:this._terminal.rows}}dispose(){this.reset()}reset(){for(let e of this._images.values())e.marker?.dispose();this._images.clear(),this._renderer.clearAll()}getLimit(){return this._pixelLimit*4/1e6}setLimit(e){if(e<.5||e>1e3)throw RangeError("invalid storageLimit, should be at least 0.5 MB and not exceed 1G");this._pixelLimit=e/4*1e6>>>0,this._evictOldest(0)}getUsage(){return this._getStoredPixels()*4/1e6}_getStoredPixels(){let e=0;for(let t of this._images.values())t.orig&&(e+=t.orig.width*t.orig.height,t.actual&&t.actual!==t.orig&&(e+=t.actual.width*t.actual.height));return e}_delImg(e){let t=this._images.get(e);this._images.delete(e),t&&window.ImageBitmap&&t.orig instanceof ImageBitmap&&t.orig.close()}wipeAlternate(){let e=[];for(let[t,i]of this._images.entries())i.bufferType==="alternate"&&(i.marker?.dispose(),e.push(t));for(let t of e)this._delImg(t);this._needsFullClear=!0,this._fullyCleared=!1}advanceCursor(e){if(this._opts.sixelScrolling){let t=this._renderer.cellSize;(t.width===-1||t.height===-1)&&(t=to);let i=Math.ceil(e/t.height);for(let r=1;r<i;++r)this._terminal._core._inputHandler.lineFeed()}}addImage(e){this._evictOldest(e.width*e.height);let t=this._renderer.cellSize;(t.width===-1||t.height===-1)&&(t=to);let i=Math.ceil(e.width/t.width),r=Math.ceil(e.height/t.height),s=++this._lastId,n=this._terminal._core.buffer,o=this._terminal.cols,a=this._terminal.rows,h=n.x,l=n.y,c=h,u=0;this._opts.sixelScrolling||(n.x=0,n.y=0,c=0),this._terminal._core._inputHandler._dirtyRowTracker.markDirty(n.y);for(let m=0;m<r;++m){let x=n.lines.get(n.y+n.ybase);for(let E=0;E<i&&!(c+E>=o);++E)this._writeToCell(x,c+E,s,m*i+E),u++;if(this._opts.sixelScrolling)m<r-1&&this._terminal._core._inputHandler.lineFeed();else if(++n.y>=a)break;n.x=c}this._terminal._core._inputHandler._dirtyRowTracker.markDirty(n.y),this._opts.sixelScrolling?n.x=c:(n.x=h,n.y=l);let p=[];for(let[m,x]of this._images.entries())x.tileCount<1&&(x.marker?.dispose(),p.push(m));for(let m of p)this._delImg(m);let g=this._terminal.registerMarker(0);g?.onDispose(()=>{this._images.get(s)&&this._delImg(s)}),this._terminal.buffer.active.type==="alternate"&&this._evictOnAlternate();let v={orig:e,origCellSize:t,actual:e,actualCellSize:{...t},marker:g||void 0,tileCount:u,bufferType:this._terminal.buffer.active.type};this._images.set(s,v)}render(e){if(!this._renderer.canvas&&this._images.size&&(this._renderer.insertLayerToDom(),!this._renderer.canvas))return;if(this._renderer.rescaleCanvas(),!this._images.size){this._fullyCleared||(this._renderer.clearAll(),this._fullyCleared=!0,this._needsFullClear=!1),this._renderer.canvas&&this._renderer.removeLayerFromDom();return}this._needsFullClear&&(this._renderer.clearAll(),this._fullyCleared=!0,this._needsFullClear=!1);let{start:t,end:i}=e,r=this._terminal._core.buffer,s=this._terminal._core.cols;this._renderer.clearLines(t,i);for(let n=t;n<=i;++n){let o=r.lines.get(n+r.ydisp);if(!o)return;for(let a=0;a<s;++a)if(o.getBg(a)&268435456){let h=o._extendedAttrs[a]||Zn,l=h.imageId;if(l===void 0||l===-1)continue;let c=this._images.get(l);if(h.tileId!==-1){let u=h.tileId,p=a,g=1;for(;++a<s&&o.getBg(a)&268435456&&(h=o._extendedAttrs[a]||Zn)&&h.imageId===l&&h.tileId===u+g;)g++;a--,c?c.actual&&this._renderer.draw(c,u,p,n,g):this._opts.showPlaceholder&&this._renderer.drawPlaceholder(p,n,g),this._fullyCleared=!1}}}}viewportResize(e){if(!this._images.size){this._viewportMetrics=e;return}if(this._viewportMetrics.cols>=e.cols){this._viewportMetrics=e;return}let t=this._terminal._core.buffer,i=t.lines.length,r=this._viewportMetrics.cols-1;for(let s=0;s<i;++s){let n=t.lines.get(s);if(n.getBg(r)&268435456){let o=n._extendedAttrs[r]||Zn,a=o.imageId;if(a===void 0||a===-1)continue;let h=this._images.get(a);if(!h)continue;let l=Math.ceil((h.actual?.width||0)/h.actualCellSize.width);if(o.tileId%l+1>=l)continue;let c=!1;for(let g=r+1;g>e.cols;++g)if(n._data[g*3+0]&4194303){c=!0;break}if(c)continue;let u=Math.min(e.cols,l-o.tileId%l+r),p=o.tileId;for(let g=r+1;g<u;++g)this._writeToCell(n,g,a,++p),h.tileCount++}}this._viewportMetrics=e}getImageAtBufferCell(e,t){let i=this._terminal._core.buffer.lines.get(t);if(i&&i.getBg(e)&268435456){let r=i._extendedAttrs[e]||Zn;if(r.imageId&&r.imageId!==-1){let s=this._images.get(r.imageId)?.orig;if(window.ImageBitmap&&s instanceof ImageBitmap){let n=Bl.createCanvas(window.document,s.width,s.height);return n.getContext("2d")?.drawImage(s,0,0,s.width,s.height),n}return s}}}extractTileAtBufferCell(e,t){let i=this._terminal._core.buffer.lines.get(t);if(i&&i.getBg(e)&268435456){let r=i._extendedAttrs[e]||Zn;if(r.imageId&&r.imageId!==-1&&r.tileId!==-1){let s=this._images.get(r.imageId);if(s)return this._renderer.extractTile(s,r.tileId)}}}_evictOldest(e){let t=this._getStoredPixels(),i=t;for(;this._pixelLimit<i+e&&this._images.size;){let r=this._images.get(++this._lowestId);r&&r.orig&&(i-=r.orig.width*r.orig.height,r.actual&&r.orig!==r.actual&&(i-=r.actual.width*r.actual.height),r.marker?.dispose(),this._delImg(this._lowestId))}return t-i}_writeToCell(e,t,i,r){if(e._data[t*3+2]&268435456){let s=e._extendedAttrs[t];if(s){if(s.imageId!==void 0){let n=this._images.get(s.imageId);n&&n.tileCount--,s.imageId=i,s.tileId=r;return}e._extendedAttrs[t]=new Pd(s.ext,s.urlId,i,r);return}}e._data[t*3+2]|=268435456,e._extendedAttrs[t]=new Pd(0,0,i,r)}_evictOnAlternate(){for(let i of this._images.values())i.bufferType==="alternate"&&(i.tileCount=0);let e=this._terminal._core.buffer;for(let i=0;i<this._terminal.rows;++i){let r=e.lines.get(i);if(r){for(let s=0;s<this._terminal.cols;++s)if(r._data[s*3+2]&268435456){let n=r._extendedAttrs[s]?.imageId;if(n){let o=this._images.get(n);o&&o.tileCount++}}}}let t=[];for(let[i,r]of this._images.entries())r.bufferType==="alternate"&&!r.tileCount&&(r.marker?.dispose(),t.push(i));for(let i of t)this._delImg(i)}},ZL=Sl(TL());function Al(e){let t="";for(let i=0;i<e.length;++i)t+=String.fromCharCode(e[i]);return t}function Id(e){let t=0;for(let i=0;i<e.length;++i){if(e[i]<48||e[i]>57)throw new Error("illegal char");t=t*10+e[i]-48}return t}function Ty(e){let t=Al(e);if(!t.match(/^((auto)|(\d+?((px)|(%)){0,1}))$/))throw new Error("illegal size");return t}function e8(e){if(typeof Buffer<"u")return Buffer.from(Al(e),"base64").toString();let t=atob(Al(e)),i=new Uint8Array(t.length);for(let r=0;r<i.length;++r)i[r]=t.charCodeAt(r);return new TextDecoder().decode(i)}var Ry={inline:Id,size:Id,name:e8,width:Ty,height:Ty,preserveAspectRatio:Id},Fy=[70,105,108,101],Md=1024,t8=class{constructor(){this.state=0,this._buffer=new Uint32Array(Md),this._position=0,this._key="",this.fields={}}reset(){this._buffer.fill(0),this.state=0,this._position=0,this.fields={},this._key=""}parse(e,t,i){let r=this.state,s=this._position,n=this._buffer;if(r===1||r===4||r===0&&s>6)return-1;for(let o=t;o<i;++o){let a=e[o];switch(a){case 59:if(!this._storeValue(s))return this._a();r=2,s=0;break;case 61:if(r===0){for(let h=0;h<Fy.length;++h)if(n[h]!==Fy[h])return this._a();r=2,s=0}else if(r===2){if(!this._storeKey(s))return this._a();r=3,s=0}else if(r===3){if(s>=Md)return this._a();n[s++]=a}break;case 58:return r===3&&!this._storeValue(s)?this._a():(this.state=4,o+1);default:if(s>=Md)return this._a();n[s++]=a}}return this.state=r,this._position=s,-2}_a(){return this.state=1,-1}_storeKey(e){let t=Al(this._buffer.subarray(0,e));return t?(this._key=t,this.fields[t]=null,!0):!1}_storeValue(e){if(this._key){try{let t=this._buffer.slice(0,e);this.fields[this._key]=Ry[this._key]?Ry[this._key](t):t}catch{return!1}return!0}return!1}},xl={mime:"unsupported",width:0,height:0};function i8(e){if(e.length<24)return xl;let t=new Uint32Array(e.buffer,e.byteOffset,6);if(t[0]===1196314761&&t[1]===169478669&&t[3]===1380206665)return{mime:"image/png",width:e[16]<<24|e[17]<<16|e[18]<<8|e[19],height:e[20]<<24|e[21]<<16|e[22]<<8|e[23]};if(e[0]===255&&e[1]===216&&e[2]===255){let[i,r]=r8(e);return{mime:"image/jpeg",width:i,height:r}}return t[0]===944130375&&(e[4]===55||e[4]===57)&&e[5]===97?{mime:"image/gif",width:e[7]<<8|e[6],height:e[9]<<8|e[8]}:xl}function r8(e){let t=e.length,i=4,r=e[i]<<8|e[i+1];for(;;){if(i+=r,i>=t)return[0,0];if(e[i]!==255)return[0,0];if(e[i+1]===192||e[i+1]===194)return i+8<t?[e[i+7]<<8|e[i+8],e[i+5]<<8|e[i+6]]:[0,0];i+=2,r=e[i]<<8|e[i+1]}}var s8=4194304,Td={name:"Unnamed file",size:0,width:"auto",height:"auto",preserveAspectRatio:1,inline:0},n8=class{constructor(e,t,i,r){this._opts=e,this._renderer=t,this._storage=i,this._coreTerminal=r,this._aborted=!1,this._hp=new t8,this._header=Td,this._dec=new ZL.default(s8),this._metrics=xl}reset(){}start(){this._aborted=!1,this._header=Td,this._metrics=xl,this._hp.reset()}put(e,t,i){if(!this._aborted)if(this._hp.state===4)this._dec.put(e,t,i)&&(this._dec.release(),this._aborted=!0);else{let r=this._hp.parse(e,t,i);if(r===-1){this._aborted=!0;return}if(r>0){if(this._header=Object.assign({},Td,this._hp.fields),!this._header.inline||!this._header.size||this._header.size>this._opts.iipSizeLimit){this._aborted=!0;return}this._dec.init(this._header.size),this._dec.put(e,r,i)&&(this._dec.release(),this._aborted=!0)}}}end(e){if(this._aborted)return!0;let t=0,i=0,r=!0;if((r=e)&&(r=!this._dec.end())&&(this._metrics=i8(this._dec.data8),(r=this._metrics.mime!=="unsupported")&&(t=this._metrics.width,i=this._metrics.height,(r=t&&i&&t*i<this._opts.pixelLimit)&&([t,i]=this._resize(t,i).map(Math.floor),r=t&&i&&t*i<this._opts.pixelLimit))),!r)return this._dec.release(),!0;let s=new Blob([this._dec.data8],{type:this._metrics.mime});if(this._dec.release(),!window.createImageBitmap){let n=URL.createObjectURL(s),o=new Image;return new Promise(a=>{o.addEventListener("load",()=>{URL.revokeObjectURL(n);let h=Bl.createCanvas(window.document,t,i);h.getContext("2d")?.drawImage(o,0,0,t,i),this._storage.addImage(h),a(!0)}),o.src=n,setTimeout(()=>a(!0),1e3)})}return createImageBitmap(s,{resizeWidth:t,resizeHeight:i}).then(n=>(this._storage.addImage(n),!0))}_resize(e,t){let i=this._renderer.dimensions?.css.cell.width||to.width,r=this._renderer.dimensions?.css.cell.height||to.height,s=this._renderer.dimensions?.css.canvas.width||i*this._coreTerminal.cols,n=this._renderer.dimensions?.css.canvas.height||r*this._coreTerminal.rows,o=this._dim(this._header.width,s,i),a=this._dim(this._header.height,n,r);if(!o&&!a){let h=s/e,l=(n-r)/t,c=Math.min(h,l);return c<1?[e*c,t*c]:[e,t]}return o?this._header.preserveAspectRatio||!o||!a?[o,t*o/e]:[o,a]:[e*a/t,a]}_dim(e,t,i){return e==="auto"?0:e.endsWith("%")?parseInt(e.slice(0,-1))*t/100:e.endsWith("px")?parseInt(e.slice(0,-2)):parseInt(e)*i}},io=Sl(Kd()),o8=Sl(FL()),a8=4194304,Od=io.PALETTE_ANSI_256;Od.set(io.PALETTE_VT340_COLOR);var l8=class{constructor(e,t,i){this._opts=e,this._storage=t,this._coreTerminal=i,this._size=0,this._aborted=!1,(0,o8.DecoderAsync)({memoryLimit:this._opts.pixelLimit*4,palette:Od,paletteLimit:this._opts.sixelPaletteLimit}).then(r=>this._dec=r)}reset(){this._dec&&(this._dec.release(),this._dec._palette.fill(0),this._dec.init(0,Od,this._opts.sixelPaletteLimit))}hook(e){if(this._size=0,this._aborted=!1,this._dec){let t=e.params[1]===1?0:h8(this._coreTerminal._core._inputHandler._curAttrData,this._coreTerminal._core._themeService?.colors);this._dec.init(t,null,this._opts.sixelPaletteLimit)}}put(e,t,i){if(!(this._aborted||!this._dec)){if(this._size+=i-t,this._size>this._opts.sixelSizeLimit){console.warn("SIXEL: too much data, aborting"),this._aborted=!0,this._dec.release();return}try{this._dec.decode(e,t,i)}catch(r){console.warn(`SIXEL: error while decoding image - ${r}`),this._aborted=!0,this._dec.release()}}}unhook(e){if(this._aborted||!e||!this._dec)return!0;let t=this._dec.width,i=this._dec.height;if(!t||!i)return i&&this._storage.advanceCursor(i),!0;let r=Bl.createCanvas(void 0,t,i);return r.getContext("2d")?.putImageData(new ImageData(this._dec.data8,t,i),0,0),this._dec.memoryUsage>a8&&this._dec.release(),this._storage.addImage(r),!0}};function h8(e,t){let i=0;if(!t)return i;if(e.isInverse())if(e.isFgDefault())i=bl(t.foreground.rgba);else if(e.isFgRGB()){let r=e.constructor.toColorRGB(e.getFgColor());i=(0,io.toRGBA8888)(...r)}else i=bl(t.ansi[e.getFgColor()].rgba);else if(e.isBgDefault())i=bl(t.background.rgba);else if(e.isBgRGB()){let r=e.constructor.toColorRGB(e.getBgColor());i=(0,io.toRGBA8888)(...r)}else i=bl(t.ansi[e.getBgColor()].rgba);return i}function bl(e){return io.BIG_ENDIAN?e:(e&255)<<24|(e>>>8&255)<<16|(e>>>16&255)<<8|e>>>24&255}var Py={enableSizeReports:!0,pixelLimit:16777216,sixelSupport:!0,sixelScrolling:!0,sixelPaletteLimit:256,sixelSizeLimit:25e6,storageLimit:128,showPlaceholder:!0,iipSupport:!0,iipSizeLimit:2e7},Oy=4096,Nd=class{constructor(e){this._disposables=[],this._handlers=new Map,this._opts=Object.assign({},Py,e),this._defaultOpts=Object.assign({},Py,e)}dispose(){for(let e of this._disposables)e.dispose();this._disposables.length=0,this._handlers.clear()}_disposeLater(...e){for(let t of e)this._disposables.push(t)}activate(e){if(this._terminal=e,this._renderer=new Bl(e),this._storage=new JL(e,this._renderer,this._opts),this._opts.enableSizeReports){let t=e.options.windowOptions||{};t.getWinSizePixels=!0,t.getCellSizePixels=!0,t.getWinSizeChars=!0,e.options.windowOptions=t}if(this._disposeLater(this._renderer,this._storage,e.parser.registerCsiHandler({prefix:"?",final:"h"},t=>this._decset(t)),e.parser.registerCsiHandler({prefix:"?",final:"l"},t=>this._decrst(t)),e.parser.registerCsiHandler({final:"c"},t=>this._da1(t)),e.parser.registerCsiHandler({prefix:"?",final:"S"},t=>this._xtermGraphicsAttributes(t)),e.onRender(t=>this._storage?.render(t)),e.parser.registerCsiHandler({intermediates:"!",final:"p"},()=>this.reset()),e.parser.registerEscHandler({final:"c"},()=>this.reset()),e._core._inputHandler.onRequestReset(()=>this.reset()),e.buffer.onBufferChange(()=>this._storage?.wipeAlternate()),e.onResize(t=>this._storage?.viewportResize(t))),this._opts.sixelSupport){let t=new l8(this._opts,this._storage,e);this._handlers.set("sixel",t),this._disposeLater(e._core._inputHandler._parser.registerDcsHandler({final:"q"},t))}if(this._opts.iipSupport){let t=new n8(this._opts,this._renderer,this._storage,e);this._handlers.set("iip",t),this._disposeLater(e._core._inputHandler._parser.registerOscHandler(1337,t))}}reset(){this._opts.sixelScrolling=this._defaultOpts.sixelScrolling,this._opts.sixelPaletteLimit=this._defaultOpts.sixelPaletteLimit,this._storage?.reset();for(let e of this._handlers.values())e.reset();return!1}get storageLimit(){return this._storage?.getLimit()||-1}set storageLimit(e){this._storage?.setLimit(e),this._opts.storageLimit=e}get storageUsage(){return this._storage?this._storage.getUsage():-1}get showPlaceholder(){return this._opts.showPlaceholder}set showPlaceholder(e){this._opts.showPlaceholder=e,this._renderer?.showPlaceholder(e)}getImageAtBufferCell(e,t){return this._storage?.getImageAtBufferCell(e,t)}extractTileAtBufferCell(e,t){return this._storage?.extractTileAtBufferCell(e,t)}_report(e){this._terminal?._core.coreService.triggerDataEvent(e)}_decset(e){for(let t=0;t<e.length;++t)switch(e[t]){case 80:this._opts.sixelScrolling=!1;break}return!1}_decrst(e){for(let t=0;t<e.length;++t)switch(e[t]){case 80:this._opts.sixelScrolling=!0;break}return!1}_da1(e){return e[0]?!0:this._opts.sixelSupport?(this._report("\x1B[?62;4;9;22c"),!0):!1}_xtermGraphicsAttributes(e){if(e.length<2)return!0;if(e[0]===1)switch(e[1]){case 1:return this._report(`\x1B[?${e[0]};0;${this._opts.sixelPaletteLimit}S`),!0;case 2:this._opts.sixelPaletteLimit=this._defaultOpts.sixelPaletteLimit,this._report(`\x1B[?${e[0]};0;${this._opts.sixelPaletteLimit}S`);for(let t of this._handlers.values())t.reset();return!0;case 3:return e.length>2&&!(e[2]instanceof Array)&&e[2]<=Oy?(this._opts.sixelPaletteLimit=e[2],this._report(`\x1B[?${e[0]};0;${this._opts.sixelPaletteLimit}S`)):this._report(`\x1B[?${e[0]};2S`),!0;case 4:return this._report(`\x1B[?${e[0]};0;${Oy}S`),!0;default:return this._report(`\x1B[?${e[0]};2S`),!0}if(e[0]===2)switch(e[1]){case 1:let t=this._renderer?.dimensions?.css.canvas.width,i=this._renderer?.dimensions?.css.canvas.height;if(!t||!i){let s=to;t=(this._terminal?.cols||80)*s.width,i=(this._terminal?.rows||24)*s.height}if(t*i<this._opts.pixelLimit)this._report(`\x1B[?${e[0]};0;${t.toFixed(0)};${i.toFixed(0)}S`);else{let s=Math.floor(Math.sqrt(this._opts.pixelLimit));this._report(`\x1B[?${e[0]};0;${s};${s}S`)}return!0;case 4:let r=Math.floor(Math.sqrt(this._opts.pixelLimit));return this._report(`\x1B[?${e[0]};0;${r};${r}S`),!0;default:return this._report(`\x1B[?${e[0]};2S`),!0}return this._report(`\x1B[?${e[0]};1S`),!0}};var Ds=class{constructor(t={}){this._fallbackLigatures=t.fallbackLigatures||["<--","<---","<<-","<-","->","->>","-->","--->","<==","<===","<<=","<=","=>","=>>","==>","===>",">=",">>=","<->","<-->","<--->","<---->","<=>","<==>","<===>","<====>","<~~","<~","~>","~~>","::",":::","==","!=","===","!==",":=",":-",":+","<*","<*>","*>","<|","<|>","|>","+:","-:","=:",":>","++","+++","<!--","<!---","<***>"].sort((i,r)=>r.length-i.length),this._characterJoinerId=void 0,this._terminal=void 0}activate(t){this._terminal=t,this._characterJoinerId=t.registerCharacterJoiner(this._joinCharacters.bind(this)),t.element.style.fontFeatureSettings='"liga" on, "calt" on'}dispose(){this._characterJoinerId!==void 0&&(this._terminal?.deregisterCharacterJoiner(this._characterJoinerId),this._characterJoinerId=void 0),this._terminal?.element&&(this._terminal.element.style.fontFeatureSettings="")}_joinCharacters(t){return this._findLigatureRanges(t,this._fallbackLigatures)}_findLigatureRanges(t,i){let r=[];for(let s=0;s<t.length;s++)for(let n of i)if(t.startsWith(n,s)){r.push([s,s+n.length]),s+=n.length-1;break}return r}};var $y=acode.require("confirm"),Se=acode.require("settings"),c8=acode.require("fsOperation"),u8=acode.require("toInternalUrl"),Gy=acode.require("select"),zi=acode.require("loader"),d8=acode.require("dialogBox"),f8=acode.require("page"),_8=acode.require("actionStack"),Is=acode.require("fonts"),{clipboard:Qd}=cordova.plugins,Tt="https://cdn.jsdelivr.net/gh/bajrangCoder/acode-plugin-acodex@main/fonts/",g8=[{name:"Fira Code Bold Nerd Font",url:`${Tt}Fira Code Bold Nerd Font.ttf`,format:"truetype",weight:"bold",style:"normal"},{name:"Fira Code Medium Nerd Font",url:`${Tt}Fira Code Medium Nerd Font Complete Mono.ttf`,format:"truetype",weight:"normal",style:"normal"},{name:"JetBrains Mono Bold Nerd Font",url:`${Tt}JetBrains Mono Bold Nerd Font Complete.ttf`,format:"truetype",weight:"bold",style:"normal"},{name:"JetBrains Mono Medium Nerd Font",url:`${Tt}JetBrains Mono Medium Nerd Font Complete.ttf`,format:"truetype",weight:"normal",style:"normal"},{name:"VictorMonoNerdFont Bold",url:`${Tt}VictorMonoNerdFont-Bold.ttf`,format:"truetype",weight:"bold",style:"normal"},{name:"VictorMonoNerdFont BoldItalic",url:`${Tt}VictorMonoNerdFont-BoldItalic.ttf`,format:"truetype",weight:"bold",style:"italic"},{name:"VictorMonoNerdFont Medium",url:`${Tt}VictorMonoNerdFont-Medium.ttf`,format:"truetype",weight:"normal",style:"normal"},{name:"VictorMonoNerdFont Italic",url:`${Tt}VictorMonoNerdFont-Italic.ttf`,format:"truetype",weight:"normal",style:"italic"},{name:"SauceCodeProNerdFont Bold",url:`${Tt}SauceCodeProNerdFont-Bold.ttf`,format:"truetype",weight:"bold",style:"normal"},{name:"SauceCodeProNerdFont Medium",url:`${Tt}SauceCodeProNerdFont-Medium.ttf`,format:"truetype",weight:"normal",style:"normal"},{name:"MesloLGS NF Bold Italic",url:`${Tt}MesloLGS NF Bold Italic.ttf`,format:"truetype",weight:"bold",style:"italic"},{name:"MesloLGS NF Bold",url:`${Tt}MesloLGS NF Bold.ttf`,format:"truetype",weight:"bold",style:"normal"},{name:"MesloLGS NF Italic",url:`${Tt}MesloLGS NF Italic.ttf`,format:"truetype",weight:"normal",style:"italic"}];function p8(){typeof Is?.add=="function"&&g8.forEach(({name:e,url:t,format:i,weight:r,style:s})=>{if(Is?.has?.(e))return;let n=encodeURI(t),o=`@font-face {
  font-family: '${e}';
  src: url('${n}') format('${i}');
  font-weight: ${r};
  font-style: ${s};
}`;Is.add(e,o)})}var so=class{isDragging=!1;startY;startHeight;isFlotBtnDragging=!1;btnStartPosX;btnStartPosY;isTerminalMinimized=!1;isTerminalOpened=!1;previousTerminalHeight;pid;terminal=null;socket=null;$fitAddon=void 0;selectionManager=null;constructor(){Se.value[bi.id]?Object.prototype.hasOwnProperty.call(this.settings,"fontLigatures")||(delete Se.value[bi.id],Se.update(!1),this._saveSetting()):this._saveSetting(),typeof this.settings?.terminalPadding>"u"&&(this.settings.terminalPadding=$l,Se.update(!1))}async init(t,i,r){try{p8(),this.xtermCss=tag("link",{rel:"stylesheet",href:`${this.baseUrl}xterm.css`}),this.$style=tag("link",{rel:"stylesheet",href:`${this.baseUrl}main.css`}),this._loadCustomFontStyleSheet(),document.head.append(this.xtermCss,this.$style),editorManager.editor.commands.addCommand({name:"acodex:open_terminal",description:"Open Terminal",bindKey:{win:"Ctrl-K"},exec:()=>{this.isTerminalOpened&&this.isTerminalMinimized?this.maxmise():this.openTerminalPanel(270,this.settings.port)}}),editorManager.editor.commands.addCommand({name:"acodex:close_terminal",description:"Close Terminal",bindKey:{win:"Ctrl-J"},exec:this.closeTerminal.bind(this)}),editorManager.editor.commands.addCommand({name:"acodex:maximise_terminal",description:"Maximise Terminal",bindKey:{win:"Ctrl-Shift-T"},exec:()=>{this.isTerminalOpened&&this.isTerminalMinimized?this.maxmise():this.minimise()}}),this.$terminalContainer=tag("div",{className:"terminal-panel"}),this.$terminalHeader=tag("div",{className:"terminal-title-bar"});let s=tag("div",{className:"left-section"}),n=tag("div",{className:"session-info"}),o=tag("div",{className:"pointer-indicator",ariaHidden:!0});this.$terminalTitle=tag("h3",{textContent:"AcodeX 1",className:"session-name"}),n.append(o,this.$terminalTitle),s.append(n);let a=tag("div",{className:"btn-section"}),h=tag("button",{className:"action-button new-session",ariaLabel:"New Session"});h.innerHTML=ei.plus,this.$searchBtn=tag("button",{className:"action-button search-btn",ariaLabel:"Search"}),this.$searchBtn.innerHTML=ei.search,this.$cdBtn=tag("button",{className:"action-button folder-icon",ariaLabel:"Navigate to Folder"}),this.$cdBtn.innerHTML=ei.folder,this.$minimizeBtn=tag("button",{className:"action-button minimize",ariaLabel:"Minimize"}),this.$minimizeBtn.innerHTML=ei.minimise,this.$closeTermBtn=tag("button",{className:"action-button close",ariaLabel:"Close Terminal"}),this.$closeTermBtn.innerHTML=ei.close,this.$searchInputContainer=tag("div",{className:"search-input-container"}),this.$searchInputContainer.append(tag("button",{className:"action-button find-previous",ariaLabel:"Find Previous",innerHTML:ei.findPrevious,onclick:this._findPreviousMatchofSearch.bind(this)}),tag("input",{type:"text",placeholder:"Find...",ariaLabel:"Search input",oninput:l=>{this.$searchAddon?.findNext(l.target.value)}}),tag("button",{className:"action-button find-next",ariaLabel:"Find Next",innerHTML:ei.findNext,onclick:this._findNextMatchofSearch.bind(this)})),this.settings.enableGuiViewer&&this.setupGUIViewerPage(),a.append(h,this.settings.enableGuiViewer?this.createGUIViewerBtn():"",this.$searchBtn,this.$cdBtn,this.$minimizeBtn,this.$closeTermBtn,this.$searchInputContainer),this.$terminalHeader.append(s,a),this.$terminalContent=tag("div",{className:"terminal-content"}),this.$terminalContainer.append(this.$terminalHeader,this.$terminalContent),this.$showTermBtn=tag("button",{className:"show-terminal-btn",innerHTML:ei.terminal}),app.get("main")&&app.get("main").append(this.$terminalContainer,this.settings.showTerminalBtn?this.$showTermBtn:""),this.$showTermBtn?.classList.add("hide"),this.$terminalContainer?.classList.add("hide"),this.settings.showTerminalBtnSize&&this.settings.showTerminalBtn&&(this.$showTermBtn.style.height=`${this.settings.showTerminalBtnSize}px`,this.$showTermBtn.style.width=`${this.settings.showTerminalBtnSize}px`),this.$cacheFile=i,this.$terminalHeader.addEventListener("mousedown",this.startDragging.bind(this)),this.$terminalHeader.addEventListener("touchstart",this.startDragging.bind(this)),h.addEventListener("click",this.createSession.bind(this)),this.$searchBtn.addEventListener("click",()=>{let l=this.$searchInputContainer.querySelector("input");this.$searchInputContainer.classList.toggle("show"),this.$searchInputContainer.classList.contains("show")?(h.style.display="none",this.settings.enableGuiViewer&&(document.querySelector(".action-button.gui-viewer").style.display="none"),this.$cdBtn.style.display="none",this.$minimizeBtn.style.display="none",this.$closeTermBtn.style.display="none",l.addEventListener("click",()=>{l.focus()})):(this.$searchAddon?.clearDecorations(),this.$searchAddon?.clearActiveDecoration(),h.style.display="block",this.settings.enableGuiViewer&&(document.querySelector(".action-button.gui-viewer").style.display="block"),this.$cdBtn.style.display="block",this.$minimizeBtn.style.display="block",this.$closeTermBtn.style.display="block")}),this.$terminalTitle.addEventListener("click",async l=>{let c,u=await this.$cacheFile.readFile("utf8"),p=JSON.parse(u);Array.isArray(p)?c=p.map(m=>m.name):c=[];let g={hideOnSelect:!0,default:localStorage.getItem("AcodeX_Current_Session")},v=await Gy("AcodeX Sessions",c,g);v&&this.changeSession(v)}),this.$closeTermBtn.addEventListener("click",this.closeTerminal.bind(this)),this.$minimizeBtn.addEventListener("click",this.minimise.bind(this)),this.$cdBtn.addEventListener("click",this._cdToActiveDir.bind(this)),this.settings.showTerminalBtn&&(this.$showTermBtn.addEventListener("mousedown",this.startDraggingFloatingBtn.bind(this)),document.addEventListener("mousemove",this.dragFlotButton.bind(this)),document.addEventListener("mouseup",this.stopDraggingFlotBtn.bind(this)),this.$showTermBtn.addEventListener("touchstart",this.startDraggingFloatingBtn.bind(this)),document.addEventListener("touchmove",this.dragFlotButton.bind(this)),document.addEventListener("touchend",this.stopDraggingFlotBtn.bind(this)),this.$showTermBtn.addEventListener("click",this.maxmise.bind(this))),window.addEventListener("mousemove",this.drag.bind(this)),window.addEventListener("touchmove",this.drag.bind(this)),window.addEventListener("mouseup",this.stopDragging.bind(this)),window.addEventListener("touchend",this.stopDragging.bind(this)),window.addEventListener("resize",()=>{if(this.$terminalContainer){if(!this.$terminalContainer.classList.contains("hide")){let c=document.querySelector("#root header")?.offsetHeight,u=document.querySelector("#root ul")?.offsetHeight||0,p=c+u,g=document.querySelector("#quick-tools")?.offsetHeight||0,v=window.innerHeight-(p+g),m=Number.parseInt(this.$terminalContainer.style.height),x=Math.min(m,v);this.$terminalContainer.style.height=`${x}px`,localStorage.setItem("AcodeX_Terminal_Cont_Height",this.$terminalContainer.offsetHeight)}let l=this.$terminal?.getSelection();l&&l.length>0&&this.selectionManager.updateHandles()}if(this.$showTermBtn&&this.settings.showTerminalBtn&&!this.$showTermBtn.classList.contains("hide")){let l=document.querySelector("#root header")?.offsetHeight,c=document.querySelector("#root ul")?.offsetHeight||0,u=l+c,p=window.innerHeight-u-this.$showTermBtn.offsetHeight,g=Number.parseInt(this.$showTermBtn.style.bottom);this.$showTermBtn.style.bottom=`${Math.max(0,Math.min(p,g))}px`}}),localStorage.getItem("AcodeX_Is_Opened")==="true"&&localStorage.getItem("AcodeX_Current_Session")&&await this.openTerminalPanel(localStorage.getItem("AcodeX_Terminal_Cont_Height")||270,this.settings.port),acode.define("acodex",{execute:(l,c=!0)=>{try{if(!this.isTerminalOpened)return;this.socket?.send(c?`${l}\r`:l)}catch(u){throw Error(u)}},isMinimized:()=>this.isTerminalMinimized,isTerminalOpened:()=>this.isTerminalOpened,maximiseTerminal:()=>{this.isTerminalOpened&&this.isTerminalMinimized&&this.maxmise()},openTerminal:async(l=270,c=this.settings.port)=>{if(!this.isTerminalOpened){let u=await this.openTerminalPanel(l,c);return{onmessage:p=>{u&&(u.onmessage=g=>p(typeof g.data=="string"?g.data:new Uint8Array(g.data)))},write:(p,g=!0)=>{let v=g?`${p}\r`:p;u.send(v)}}}},createSession:async()=>{if(this.isTerminalOpened){let l=await this.createSession();return{onmessage:c=>{l&&(l.onmessage=u=>c(typeof u.data=="string"?u.data:new Uint8Array(u.data)))},write:(c,u=!0)=>{let p=u?`${c}\r`:c;l.send(p)}}}},changeSession:async l=>{if(this.isTerminalOpened){let c=await this.changeSession(l);return{onmessage:u=>{c&&(c.onmessage=p=>u(typeof p.data=="string"?p.data:new Uint8Array(p.data)))},write:(u,p=!0)=>{let g=p?`${u}\r`:u;c.send(g)}}}},closeTerminal:()=>{this.isTerminalOpened&&this.closeTerminal()},convertAcodeUriToTermReadable:l=>no(l),addTheme:(l,c)=>{Gl.push(l),Ae[l]=c},applyTheme:l=>{this.settings.theme=l,Se.update()}})}catch(s){console.log(s)}}createGUIViewerBtn(){let t=tag("button",{className:"action-button gui-viewer",ariaLabel:"Open GUI Viewer"});return t.innerHTML=ei.imagePlay,t.onclick=this.openViewerPage.bind(this),t}setupGUIViewerPage(){let t=tag("span",{className:"icon clearclose",dataset:{action:"close-btn"}});this.displayVar=tag("span",{textContent:"Display: ",dataset:{action:"copy-display-num"}}),this.displayVar.onclick=()=>{Qd.copy(`export DISPLAY=${this.displayVariable};`),acode.alert("AcodeX","Copied the display, just execute the copied command in your current terminal session.")},this.$page=f8("AcodeX GUI Viewer",{lead:t,tail:this.displayVar}),this.$page.id="acodex-gui-viewer",this.$page.show=()=>{_8.push({id:bi.id,action:this.$page.hide}),app.append(this.$page),this.$page.querySelector(".gui-viewer-canvas").appendChild(this._hiddenInput)},t.onclick=()=>{this.rfb.disconnect(),r.innerHTML="",this.$page.hide()},document.addEventListener("backbutton",()=>{document.contains(this.$page)&&(this.rfb.disconnect(),r.innerHTML="",this.$page.hide())},!1);let i=tag("span",{className:"icon keyboard_hide",dataset:{action:"show-keyboard"}});this.$page.header.append(i);let r=tag("div",{className:"gui-viewer-canvas"});this.$page.body.append(r),this._hiddenInput=tag("textarea",{autocapitalize:"off",autocomplete:"off",spellcheck:"false",tabindex:"-1"}),this._hiddenInput.style.position="absolute",this._hiddenInput.style.opacity="0",this._hiddenInput.style.height="0px",this._hiddenInput.style.width="0px",this._hiddenInput.style.zIndex="-1",this._hiddenInput.style.imeMode="disabled",this.$page.querySelector(".gui-viewer-canvas").appendChild(this._hiddenInput),i.onclick=()=>{this._hiddenInput.focus()};function s(n){let o=n.target.value,a=n.target.dataset.lastValue||"",h;try{h=Math.max(n.target.selectionStart,o.length)}catch{h=o.length}let l=a.length,c=h-l,u=c<0?-c:0;for(let p=0;p<Math.min(l,h);p++)if(o.charAt(p)!==a.charAt(p)){c=h-p,u=l-p;break}for(let p=0;p<u;p++)this.rfb.sendKey(qy.default.XK_BackSpace,"Backspace");for(let p=h-c;p<h;p++){let g=o.charCodeAt(p),v=Vy.default.lookup(g);v&&this.rfb.sendKey(v)}n.target.dataset.lastValue=o}this._hiddenInput.addEventListener("input",s.bind(this))}async openViewerPage(){zi.showTitleLoader();let t=/(?:bash|zsh|sh|.*):(?:\s*line \d+:)?\s*\w+:? command not found|not found/;try{if(this.rfb)zi?.removeTitleLoader(),this.$page.show();else{let i=await this.executeCommandOnPty("vncserver --help");if(t.test(i.output))zi?.removeTitleLoader(),acode.alert("AcodeX Error","vncserver not found, First go head and read readme of acodex regarding 'Gui Setup'. To setup it");else{let r=await this.executeCommandOnPty("vncserver -list");if(/:\d+\s+\t+\d+/.test(r.output))this.displayVariable=r.output.match(/:(\d+)/)[0],this.connectVncServer(this.displayVariable);else if(/TigerVNC server sessions:\s+X DISPLAY #\tPROCESS ID/.test(r.output)){let s=await this.executeCommandOnPty("vncserver"),n=/New 'localhost:(\d+)/,o=s.output.match(n);o?(this.displayVariable=`:${o[1]}`,this.connectVncServer(this.displayVariable)):(zi?.removeTitleLoader(),acode.alert("AcodeX Error","Failed to create new vnc server session, try creating it manually by executing: `vncserver` command"))}else throw new Error("Unexpected output from vncserver -list.")}}}catch(i){zi?.removeTitleLoader(),console.error("Error executing command:",i),acode.alert("AcodeX Error",i.message)}}async connectVncServer(t){try{let i=/(?:bash|zsh|sh|.*):(?:\s*line \d+:)?\s*\w+:? command not found|not found/,r=await this.executeCommandOnPty("websockify_rs");if(i.test(r.output)&&acode.alert("AcodeX Warning","websockify_rs not found, which acts as a proxy. Go ahead and install it(Check readme for guide)."),(await this.executeCommandOnPty("ps aux | grep websockify_rs | grep -v grep")).output===""){let n=5900+Number.parseInt(t.split(":")[1]),o=localStorage.getItem("AcodeX_Current_Session");await(await this.createSession()).send(`websockify_rs localhost:6778 localhost:${n}\r`),await this.changeSession(o),await this.waitForWebsockifyToStart()}this.bindNoVnc()}catch(i){zi?.removeTitleLoader(),console.error("Error in connecting to vnc server:",i),acode.alert("AcodeX Error",i.message)}}async waitForWebsockifyToStart(){let t=5,i=r=>new Promise(s=>setTimeout(s,r));for(;t>0;){if((await this.executeCommandOnPty("ps aux | grep websockify_rs | grep -v grep")).output!==""){console.log("AcodeX: Websockify_rs started successfully.");return}t--,console.log("AcodeX: Waiting for websockify_rs to start..."),await i(1e3)}throw new Error("AcodeX: Failed to start websockify_rs within the timeout period.")}async bindNoVnc(){try{this.rfb=new jy.default(this.$page.querySelector(".gui-viewer-canvas"),"ws://localhost:6778/"),this.rfb.scaleViewport=!0,this.rfb.clipViewport=!0;let i=getComputedStyle(document.documentElement).getPropertyValue("--secondary-color").trim();this.rfb.background=i||"",this.rfb.addEventListener("connect",()=>{this.$page.show(),zi?.removeTitleLoader(),this.displayVar.textContent=`Display: ${this.displayVariable.split(":")[1]}`}),this.rfb.addEventListener("disconnect",()=>{this.rfb=void 0,this.$page?.hide(),zi?.removeTitleLoader()}),this.rfb.addEventListener("credentialsrequired",async()=>{let r;if(localStorage.getItem("VNC_PASS"))r=localStorage.getItem("VNC_PASS");else{if(r=await acode.prompt("Enter vncserver password:","","text"),!r)return;localStorage.setItem("VNC_PASS",r)}this.rfb?.sendCredentials({password:r})}),this.rfb.addEventListener("securityfailure",r=>{acode.alert("AcodeX Error",`Security failure: ${r.detail.reason}`),console.error("Security failure:",r.detail),localStorage.removeItem("VNC_PASS")}),this.rfb.addEventListener("serververification",r=>{acode.alert("AcodeX Error",`Server verification failed: ${JSON.stringify(r.detail)}`),console.error("Server verification failed:",r)})}catch(t){zi?.removeTitleLoader(),console.error("Error novnc:",t),acode.alert("AcodeX Error",t.message)}}async executeCommandOnPty(t){let i=await fetch(`http://${this.settings.serverHost}:${this.settings.port}/execute-command`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({command:t})});if(!i.ok)throw new Error(`Request failed with status: ${i.status}`);return await i.json()}async openTerminalPanel(t,i){if(!i)return;document.querySelector(".terminal-panel")||app.get("main").append(this.$terminalContainer,this.$showTermBtn),this.settings.port=i,Se.update(!1),this.$terminalContainer.classList.remove("hide"),this.isTerminalOpened=!0,this.$terminalContainer.style.height=`${t}px`,this.$terminalContent.style.width="100%",this.$terminalContent.style.height=`calc(100% - ${this.$terminalContainer.offsetHeight}px)`,await Is.loadFont(this.settings.fontFamily),this.settings.transparency?(this.$terminalContainer.style.background="transparent",this.$terminalContainer.style.backdropFilter=`blur(${this.settings.blurValue})`,this.$terminalHeader.style.background=zd(this.$terminalHeader),this.$terminalHeader.style.backdropFilter=`blur(${this.settings.blurValue})`):(this.$terminalContainer.style.background="var(--popup-background-color)",this.$terminalHeader.style.background="var(--primary-color)");let r;return localStorage.getItem("AcodeX_Current_Session")?r=await this.changeSession(localStorage.getItem("AcodeX_Current_Session"),!0):(this.$terminalContent.innerHTML="",r=await this.createSession()),r}async createXtermTerminal(t){if(this.$terminal=this.terminalObj,this.$fitAddon=new _m,this.$webglAddon=new T1,this.$unicode11Addon=new ty,this.$webLinkAddon=new R1(async(i,r)=>{await $y("AcodeX Link",`Do you want to open ${r} in browser?`)&&system.openInBrowser(r)}),this.$searchAddon=new Ey,this.settings.imageRendering&&(this.$imageAddon=new Nd,this.$terminal.loadAddon(this.$imageAddon)),this.$terminal.loadAddon(this.$fitAddon),this.$terminal.loadAddon(this.$unicode11Addon),this.$terminal.loadAddon(this.$webLinkAddon),this.$terminal.loadAddon(this.$searchAddon),this.fitTerminal(),this.$webglAddon)try{this.$terminal.loadAddon(this.$webglAddon),this.$terminal.open(this.$terminalContent)}catch(i){window.toast(`error during loading webgl addon: ${i}`,4e3),this.$webglAddon.dispose(),this.$webglAddon=void 0}this.$terminal.element||this.$terminal.open(this.$terminalContent),this.$terminal.element&&this._setTerminalPadding(this.settings.terminalPadding),this.settings.fontLigatures&&(this.$ligatureAddon=new Ds,this.$terminal.loadAddon(this.$ligatureAddon)),this.$terminal.focus(),this._updateTerminalHeight()}async attachSocketToXterm(t,i){this.$terminal.onResize(async n=>{if(!i)return;let o=n.cols.toString(),a=n.rows.toString(),h=`http://${this.settings.serverHost}:${t}/terminals/${i}/resize`;await fetch(h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cols:o,rows:a})})}),this.socket=new WebSocket(`ws://${this.settings.serverHost}:${t}/terminals/${i}`),this.socket.onopen=()=>{this.$attachAddon=new iy(this.socket),this.$terminal.loadAddon(this.$attachAddon),this.$terminal.unicode.activeVersion="11",this._updateTerminalHeight(),localStorage.setItem("AcodeX_Is_Opened",this.isTerminalOpened),localStorage.setItem("AcodeX_Terminal_Cont_Height",this.$terminalContainer.offsetHeight),localStorage.getItem("AcodeX_Terminal_Is_Minimised")==="true"&&this.minimise(),this._updateTerminalHeight();let n=Number(this.settings.fontSize)||zl,o=Math.max(1,n-10),a=Math.max(n+16,32);this.selectionManager=new Ms(this.$terminal,this.$terminalContainer,this.settings,{minFontSize:o,maxFontSize:a,onFontSizeChange:h=>this.applyTerminalFontSize(h)})},this.socket.onclose=async n=>{try{let o=await fetch(`http://${this.settings.serverHost}:${t}/`);o.ok||console.warn("Server responded with an error:",o.status,o.statusText);return}catch{this.removeTerminal(),acode.alert("AcodeX Server","Disconnected from server because server gets closed \u{1F61E}!")}},this.socket.onerror=n=>{acode.alert("AcodeX Error",JSON.stringify(n))},this.$terminal.attachCustomKeyEventHandler(async n=>{if(n.type==="keydown"){let o=await this.$cacheFile.readFile("utf8"),a=o?JSON.parse(o):[];if(n.ctrlKey&&(n.key==="N"||n.key==="n"))return this.createSession(),!1;if(n.ctrlKey&&(n.key==="W"||n.key==="w"))return this.closeTerminal(),!1;if(n.ctrlKey&&n.shiftKey&&(n.key==="T"||n.key==="t"))return this.isTerminalMinimized||this.minimise(),!1;if(n.ctrlKey&&n.shiftKey&&(n.key==="V"||n.key==="v"))return Qd.paste(h=>{this.$terminal?.paste(h)}),!1;if(n.ctrlKey&&n.keyCode>=49&&n.keyCode<=53){let h=n.keyCode-49;if(a.length>h){let l=a[h];return this.changeSession(l.name),!1}}if(n.ctrlKey&&n.key==="ArrowLeft"){let h=a.findIndex(l=>l.name===localStorage.getItem("AcodeX_Current_Session"));if(h>0){let l=a[h-1];return this.changeSession(l.name),!1}}if(n.ctrlKey&&n.key==="ArrowRight"){let h=a.findIndex(l=>l.name===localStorage.getItem("AcodeX_Current_Session"));if(h<a.length-1){let l=a[h+1];return this.changeSession(l.name),!1}}if(n.ctrlKey&&n.key==="+"){let h=this.$terminal.options.fontSize+1;return this.applyTerminalFontSize(h),!1}if(n.ctrlKey&&n.key==="-"){let h=this.$terminal.options.fontSize-1;return h<1||this.applyTerminalFontSize(h),!1}if(n.ctrlKey&&n.shiftKey&&(n.key==="c"||n.key==="C")){if(!this.$terminal?.hasSelection())return;let h=this.$terminal?.getSelection();return h&&Qd.copy(h),window.toast("Copied \u2705",3e3),this.$terminal.focus(),!1}if(n.ctrlKey&&n.shiftKey&&(n.key==="i"||n.key==="I"))return this.$terminal?.clear(),this.socket?.send("clear\r"),!1;if(n.ctrlKey&&(n.key==="a"||n.key==="A"))return this.$terminal?.selectAll(),!1}});let r="",s=!0;this.$terminal.onData(n=>{if(n==="\x7F"){r.trim()===""?s=!0:(r=r.slice(0,-1),s=r.trim()==="");return}let o=Wd(n);r+=o,o.startsWith("#")&&s&&this.openAIPromptPopup(),n==="\r"&&(r.trim().toLowerCase()==="exit"&&(console.log("Exiting current session..."),this.terminalCloseHandler()),r="",s=!0),s=r.trim()===""})}async getOllamaModel(t){let i=localStorage.getItem("ACODEX_LOCAL_LLM_MODEL");if(i)return i;try{let r=await t.getListOfOllamaModels();if(!Array.isArray(r))throw new Error("Failed to fetch Ollama models");let s=await Gy("Select Local Model",r);return s?(localStorage.setItem("ACODEX_LOCAL_LLM_MODEL",s),s):null}catch(r){return console.error("Error getting Ollama models:",r),acode.alert("Error","Failed to fetch Ollama models"),null}}async openAIPromptPopup(){let t=new rf(this.settings.aiModel===jl[3][0]?null:this.settings.aiApiKey),i;if(this.settings.aiModel==="local-llm"&&(i=await this.getOllamaModel(t),!i))return;let r=d8("\u26A1 Ask  AcodeX Ai",`<textarea id="acodeXAiPromptBox" rows="2" placeholder="for eg: delete sample.txt file"></textarea>
			<div class="ai-loader-container">
        <div class="wave"></div>
        <div class="wave"></div>
        <div class="wave"></div>
        <div class="wave"></div>
        <div class="wave"></div>
			</div>`,"Start Magic \u2728");r.ok(async()=>{let s=document.querySelector("#acodeXAiPromptBox").value;if(!s){r.hide();return}document.querySelector(".ai-loader-container").style.display="flex",window.toast("Wait! To see the magic of AcodeX AI \u2728",2e3);try{let n="";switch(this.settings.aiModel){case"deepseek":{let{response:o,error:a}=await t.generateDeepseekResponse(s)}if(error){document.querySelector(".ai-loader-container").style.display="none",r.hide(),acode.alert("AcodeX AI Error",error.toString()),console.error("AcodeX AI Error:",error);return}n=response.choices[0].message.content;break;case"chatgpt":{let{response:o,error:a}=await t.generateChatgptResponse(s);if(a){document.querySelector(".ai-loader-container").style.display="none",r.hide(),acode.alert("AcodeX AI Error",a.toString()),console.error("AcodeX AI Error:",a);return}n=o.choices[0].message.content;break}case"gemini-pro":{let{response:o,error:a}=await t.generateGeminiResponse(s);if(a){document.querySelector(".ai-loader-container").style.display="none",r.hide(),acode.alert("AcodeX AI Error",a.toString()),console.error("AcodeX AI Error:",a);return}n=o.candidates[0].content.parts[0].text;break}case"local-llm":{n=(await t.generateOllamaResponse(i,s)).response;break}}if(!n){document.querySelector(".ai-loader-container").style.display="none",r.hide();return}this.socket?.send("\b"),this.socket?.send(n.trim()),document.querySelector(".ai-loader-container").style.display="none",r.hide()}catch(n){document.querySelector(".ai-loader-container").style.display="none",r?.hide(),console.error(n),acode.alert("AcodeX AI Error",JSON.stringify(n))}})}async createSession(){let t,i=await this.$cacheFile.readFile("utf8"),r=i?JSON.parse(i):[];if(r.length===0){if(await this.createXtermTerminal(this.settings.port),t=await this._generateProcessId(),!t)return;r=[{name:"AcodeX1",pid:t}]}else{this._hideTerminalSession();let o=`AcodeX${r.reduce((a,h)=>{let c=h.name.match(/^AcodeX(\d+)$/);if(c){let u=Number.parseInt(c[1],10);return Math.max(a,u)}return a},0)+1}`;if(await this.createXtermTerminal(this.settings.port),t=await this._generateProcessId(),!t)return;r.push({name:o,pid:t})}return await Promise.all([this.$cacheFile.writeFile(r),this.attachSocketToXterm(this.settings.port,t)]),this._updateTerminalHeight(),localStorage.setItem("AcodeX_Current_Session",r[r.length-1].name),this.$terminalTitle.textContent=r[r.length-1].name,window.toast(`Created Session: ${r[r.length-1].name}`,3e3),this.socket}_hideTerminalSession(){this.$attachAddon?.dispose(),this.$fitAddon?.dispose(),this.$unicode11Addon?.dispose(),this.$webLinkAddon?.dispose(),this.$searchAddon?.dispose(),this.$imageAddon?.dispose(),this.$ligatureAddon?.dispose(),this.$webglAddon?.dispose(),this.$terminal?.dispose(),this.socket?.close(),this.socket=null,this.$terminal=void 0,this.$attachAddon=void 0,this.$fitAddon=void 0,this.$unicode11Addon=void 0,this.$webLinkAddon=void 0,this.$searchAddon=void 0,this.$imageAddon=void 0,this.$ligatureAddon=void 0,this.$webglAddon=void 0,this.$terminalContent.innerHTML=""}async _generateProcessId(){try{let t=this.$terminal.cols.toString(),i=this.$terminal.rows.toString(),r=await fetch(`http://${this.settings.serverHost}:${this.settings.port}/terminals`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cols:t,rows:i})});if(!r.ok)throw new Error("Failed to create terminal");return await r.text()}catch{this.$terminalContainer.classList.contains("hide")||this.$terminalContainer.classList.add("hide"),this.$showTermBtn.classList.contains("hide")||this.$showTermBtn.classList.add("hide"),this.isTerminalMinimized=!1,this.isTerminalOpened=!1,localStorage.setItem("AcodeX_Terminal_Is_Minimised",this.isTerminalMinimized),localStorage.setItem("AcodeX_Is_Opened",this.isTerminalOpened),this.$terminalContainer.style.height=this.previousTerminalHeight,localStorage.setItem("AcodeX_Terminal_Cont_Height",this.$terminalContainer.offsetHeight),localStorage.removeItem("AcodeX_Current_Session"),window.toast("Start the acodex server in termux first!",4e3)}}async changeSession(t,i=!1){if(i){await this.createXtermTerminal(this.settings.port);let s=await this._getPidBySessionName(t);if(!s){this.$terminalContainer.classList.contains("hide")||this.$terminalContainer.classList.add("hide"),this.$showTermBtn.classList.contains("hide")||this.$showTermBtn.classList.add("hide"),this.isTerminalMinimized=!1,this.isTerminalOpened=!1,localStorage.setItem("AcodeX_Terminal_Is_Minimised",this.isTerminalMinimized),localStorage.setItem("AcodeX_Is_Opened",this.isTerminalOpened),this.$terminalContainer.style.height=this.previousTerminalHeight,localStorage.setItem("AcodeX_Terminal_Cont_Height",this.$terminalContainer.offsetHeight),localStorage.removeItem("AcodeX_Current_Session"),window.toast("Oops! Something went wrong in the Core \u{1F614}",4e3);return}return await this.attachSocketToXterm(this.settings.port,s),localStorage.setItem("AcodeX_Current_Session",t),this.$terminalTitle.textContent=t,this.socket}if(t===localStorage.getItem("AcodeX_Current_Session"))return;let r=await this._getPidBySessionName(t);if(r)return this._hideTerminalSession(),await this.createXtermTerminal(this.settings.port),await this.attachSocketToXterm(this.settings.port,r),localStorage.setItem("AcodeX_Current_Session",t),this.$terminalTitle.textContent=t,this.socket}async _getPidBySessionName(t){let i=await this.$cacheFile.readFile("utf8"),r=i?JSON.parse(i):[];if(Array.isArray(r)){let s=r.find(n=>n.name===t);return s?s.pid:(console.log(`Error: Session '${t}' not found in JSON file.`),null)}return console.log("Error: Sessions data is not an array in JSON file."),null}_saveSetting(){Se.value[bi.id]={port:8767,serverHost:"localhost",aiApiKey:"",aiModel:gf,transparency:of,selectionHaptics:af,fontLigatures:lf,enableGuiViewer:sf,imageRendering:nf,showTerminalBtnSize:ff,showTerminalBtn:_f,blurValue:"4px",cursorBlink:hf,cursorStyle:Xl[0],cursorInactiveStyle:Ul[0],fontSize:zl,fontFamily:cf,letterSpacing:0,terminalPadding:$l,fontWeight:Wl[0],customFontStyleSheet:"",scrollBack:uf,scrollSensitivity:df,theme:Ce,background:Ae[Ce].background,foreground:Ae[Ce].foreground,cursor:Ae[Ce].cursor||"",cursorAccent:Ae[Ce].cursorAccent||"",selectionBackground:Ae[Ce].selectionBackground,black:Ae[Ce].black,blue:Ae[Ce].blue,brightBlack:Ae[Ce].brightBlack,brightBlue:Ae[Ce].brightBlue,brightCyan:Ae[Ce].brightCyan,brightGreen:Ae[Ce].brightGreen,brightMagenta:Ae[Ce].brightMagenta,brightRed:Ae[Ce].brightWhite,brightWhite:Ae[Ce].brightWhite,brightYellow:Ae[Ce].brightYellow,cyan:Ae[Ce].cyan,green:Ae[Ce].green,magenta:Ae[Ce].magenta,red:Ae[Ce].red,white:Ae[Ce].white,yellow:Ae[Ce].yellow},Se.update(!1)}_loadCustomFontStyleSheet(){if(this.settings.customFontStyleSheet!=="")if(document.querySelector("#customFontAcodeXStyleSheet"))document.querySelector("#customFontAcodeXStyleSheet").href=this.settings.customFontStyleSheet;else{let t=tag("link",{href:this.settings.customFontStyleSheet,rel:"stylesheet",id:"customFontAcodeXStyleSheet"});document.head.append(t)}}_setTerminalPadding(t){if(!this.$terminal?.element)return;let i=Number(t),s=`${Number.isNaN(i)?0:Math.max(0,i)}px`,n=this.$terminal.element;n.style.boxSizing="border-box",n.style.padding=s,this.$fitAddon&&this.fitTerminal()}_updateTerminalHeight(){let t=this.$terminalHeader.offsetHeight;this.$terminalContent.style.height=`calc(100vh - ${t+1}px)`,localStorage.setItem("AcodeX_Terminal_Cont_Height",this.$terminalContainer.offsetHeight),this.fitTerminal()}fitTerminal(){let t=this.$fitAddon.proposeDimensions();t&&this.$terminal.resize(t.cols+2,t.rows+1)}applyTerminalFontSize(t){if(!this.$terminal)return;let i=Number(t);if(Number.isNaN(i))return;let s=Math.max(1,i);this.$terminal.options.fontSize!==s&&(this.$terminal.options.fontSize=s,typeof this.$terminal.refresh=="function"&&this.$terminal.refresh(0,this.$terminal.rows-1),this.settings.fontSize=s,Se.update(!1))}async _getLastSessionName(){try{let t=await this.$cacheFile.readFile("utf8"),i=t?JSON.parse(t):[];return Array.isArray(i)&&i.length>0?i[i.length-1].name:(console.error("Error: No sessions found in JSON file or sessions data is not an array."),null)}catch(t){return console.error("Error reading or parsing JSON file:",t),null}}async removeTerminal(){this.$terminalContainer.classList.contains("hide")||(this.$terminalContainer.style.opacity=1),this.$terminalContainer.classList.add("hide"),this.$showTermBtn.classList.contains("hide")||this.$showTermBtn.classList.add("hide"),this.isTerminalMinimized=!1,this.isTerminalOpened=!1,localStorage.setItem("AcodeX_Terminal_Is_Minimised",this.isTerminalMinimized),localStorage.setItem("AcodeX_Is_Opened",this.isTerminalOpened),this.$terminalContainer.style.height=this.previousTerminalHeight,localStorage.setItem("AcodeX_Terminal_Cont_Height",this.$terminalContainer.offsetHeight),localStorage.removeItem("AcodeX_Current_Session"),await this.$cacheFile.writeFile("")}async terminalCloseHandler(){let t=await this.$cacheFile.readFile("utf8"),i=t?JSON.parse(t):[];if(i=i.filter(r=>r.name!==localStorage.getItem("AcodeX_Current_Session")),await this.$cacheFile.writeFile(i),i.length>0){let r=await this._getLastSessionName();this.changeSession(r)}else this._hideTerminalSession(),this.$terminalContainer.classList.contains("hide")||this.$terminalContainer.classList.add("hide"),this.$showTermBtn.classList.contains("hide")||this.$showTermBtn.classList.add("hide"),this.isTerminalMinimized=!1,this.isTerminalOpened=!1,this.rfb?.disconnect(),this.rfb=void 0,localStorage.removeItem("AcodeX_Current_Session"),localStorage.setItem("AcodeX_Terminal_Is_Minimised",this.isTerminalMinimized),localStorage.setItem("AcodeX_Is_Opened",this.isTerminalOpened),this.$terminalContainer.style.height=this.previousTerminalHeight,localStorage.setItem("AcodeX_Terminal_Cont_Height",this.$terminalContainer.offsetHeight);this.cleanupSelectionManager()}async closeTerminal(){if(await $y("Warning","Are you sure ?")&&this.$terminal!=null&&localStorage.getItem("AcodeX_Current_Session")){let i=await this._getPidBySessionName(localStorage.getItem("AcodeX_Current_Session"));if(!i)return;fetch(`http://${this.settings.serverHost}:${this.settings.port}/terminals/${i}/terminate`,{method:"POST"}).then(async r=>{r.ok?this.terminalCloseHandler():(acode.alert("AcodeX Error",`Failed to close terminal ${this.pid}. Trying to force close it...`),this.removeTerminal())}).catch(async r=>{this.removeTerminal(),acode.alert("AcodeX Server","Disconnected from server because server gets closed \u{1F61E}!"),console.error(`Error while closing terminal ${this.pid}: ${r}`)})}}startDraggingFloatingBtn(t){try{this.isFlotBtnDragging=!0,this.$showTermBtn.style.border="2px solid #fff",t.type==="touchstart"?(this.btnStartPosX=t.touches[0].clientX,this.btnStartPosY=t.touches[0].clientY):(this.btnStartPosX=t.clientX,this.btnStartPosY=t.clientY)}catch(i){window.alert(i)}}dragFlotButton(t){try{if(!this.isFlotBtnDragging)return;t.preventDefault();let i,r;t.type==="touchmove"?(i=t.touches[0].clientX,r=t.touches[0].clientY):(i=t.clientX,r=t.clientY);let s=this.btnStartPosX-i,n=this.btnStartPosY-r;this.btnStartPosX=i,this.btnStartPosY=r;let o=window.innerHeight-(this.$showTermBtn.offsetTop+this.$showTermBtn.offsetHeight)+n,a=this.$showTermBtn.offsetLeft-s,h=document.querySelector("#root header")?.offsetHeight,l=document.querySelector("#root ul")?.offsetHeight||0,c=h+l,u=window.innerWidth-this.$showTermBtn.offsetWidth,p=window.innerHeight-c-this.$showTermBtn.offsetHeight;this.$showTermBtn.style.bottom=`${Math.max(0,Math.min(p,o))}px`,this.$showTermBtn.style.left=`${Math.max(0,Math.min(u,a))}px`}catch(i){window.alert(i)}}stopDraggingFlotBtn(){try{this.isFlotBtnDragging=!1,this.$showTermBtn.style.border="none"}catch(t){window.alert(t)}}startDragging(t){t.type==="touchstart"?this.startY=t.touches[0].clientY:(t.preventDefault(),this.startY=t.clientY),this.startHeight=this.$terminalContainer.clientHeight,this.isDragging=!0,this.$terminalContainer.style.borderTop="1px solid var(--link-text-color)"}drag(t){if(!this.isDragging)return;t.preventDefault();let i;t.type==="touchmove"?i=t.touches[0].clientY:i=t.clientY;let r=i-this.startY,s=this.startHeight-r,n=document.querySelector("#root header")?.offsetHeight,o=document.querySelector("#root ul")?.offsetHeight||0,a=n+o,h=document.querySelector("#quick-tools")?.offsetHeight||0,l=window.innerHeight-(a+h);s=Math.max(100,Math.min(s,l)),this.$terminalContainer.style.height=`${s}px`,localStorage.setItem("AcodeX_Terminal_Cont_Height",s),this._updateTerminalHeight();let u=this.$terminal?.getSelection();u&&u.length>0&&this.selectionManager.updateHandles()}stopDragging(t){this.isDragging=!1,this.$terminalContainer.style.borderTop="1px solid var(--popup-border-color)"}minimise(){try{this.isTerminalMinimized||(this.previousTerminalHeight=window.getComputedStyle(this.$terminalContainer).height,localStorage.setItem("AcodeX_Terminal_Cont_Height",this.$terminalContainer.offsetHeight),this.$terminalContainer.style.height="0px",this.$terminalContainer.classList.add("hide"),this.isTerminalMinimized=!0,localStorage.setItem("AcodeX_Terminal_Is_Minimised",this.isTerminalMinimized),this.settings.showTerminalBtn&&this.$showTermBtn.classList.remove("hide"))}catch(t){window.alert(t)}}maxmise(){if(this.isTerminalMinimized){Number.parseInt(localStorage.getItem("AcodeX_Terminal_Cont_Height"))<=50?this.$terminalContainer.style.height="50px":this.$terminalContainer.style.height=`${localStorage.getItem("AcodeX_Terminal_Cont_Height")}px`,this.$terminalContainer.classList.remove("hide"),this.$terminalContent.style.height=`calc(100% - ${this.$terminalContainer.offsetHeight}px)`,this.fitTerminal(),localStorage.setItem("AcodeX_Terminal_Cont_Height",this.$terminalContainer.offsetHeight),this.settings.showTerminalBtn&&this.$showTermBtn.classList.add("hide"),this.isTerminalMinimized=!1,localStorage.setItem("AcodeX_Terminal_Is_Minimised",this.isTerminalMinimized),this._updateTerminalHeight();let t=this.$terminal?.getSelection();t&&t.length>0&&this.selectionManager.updateHandles()}}_findPreviousMatchofSearch(){let t=document.querySelector(".search-input-container input").value;this.$searchAddon?.findPrevious(t)}_findNextMatchofSearch(){let t=document.querySelector(".search-input-container input").value;this.$searchAddon?.findNext(t)}async _cdToActiveDir(){let{activeFile:t}=editorManager;if(t.uri){let i=no(t.uri);if(!i){navigator.vibrate(300),window.toast("unsupported path type.",3e3);return}this.socket.send(`cd "${i}"\r`)}}cleanupSelectionManager(){this.selectionManager&&(this.selectionManager.destroy(),this.selectionManager=null)}async destroy(){this.$style.remove(),this.xtermCss.remove(),this.$fontStyleSheet.remove(),await c8(`${window.DATA_STORAGE}acodex_fonts`).delete(),editorManager.editor.commands.removeCommand("terminal:open_terminal"),editorManager.editor.commands.removeCommand("terminal:close_terminal"),this.cleanupSelectionManager(),this.$terminalContainer.remove(),this.$showTermBtn.remove(),document.removeEventListener("mousemove",this.dragFlotButton.bind(this)),document.removeEventListener("mouseup",this.stopDraggingFlotBtn.bind(this)),document.removeEventListener("touchmove",this.dragFlotButton.bind(this)),document.removeEventListener("touchend",this.stopDraggingFlotBtn.bind(this)),window.removeEventListener("mousemove",this.drag),window.removeEventListener("touchmove",this.drag),window.removeEventListener("mouseup",this.stopDragging),window.removeEventListener("touchend",this.stopDragging),localStorage.removeItem("AcodeX_Terminal_Is_Minimised"),localStorage.removeItem("AcodeX_Current_Session"),localStorage.removeItem("AcodeX_Terminal_Cont_Height"),localStorage.removeItem("AcodeX_Is_Opened"),localStorage.getItem("ACODEX_LOCAL_LLM_MODEL")&&localStorage.removeItem("ACODEX_LOCAL_LLM_MODEL")}async setCustomFontFile(){let{url:t}=await acode.fileBrowser("file","select custom font stylesheet");if(!t)return;let i=no(t);if(i.startsWith("/sdcard"))i=i.replace("/sdcard","file:///storage/emulated/0");else if(i.startsWith("$HOME"))return;let r=t.split("/"),s=r[r.length-1];i=`${i}/${s}`;let n=await u8(i);this.settings.customFontStyleSheet=n,Se.update()}async applyTheme(t){let i=Ae[t];this.settings.theme=t,this.settings.background=i.background,this.settings.foreground=i.foreground,this.settings.cursor=i.cursor||"#fff",this.settings.cursorAccent=i.cursorAccent||"#fff",this.settings.selectionBackground=i.selectionBackground,this.settings.black=i.black,this.settings.blue=i.blue,this.settings.brightBlack=i.brightBlack,this.settings.brightBlue=i.brightBlue,this.settings.brightCyan=i.brightCyan,this.settings.brightGreen=i.brightGreen,this.settings.brightMagenta=i.brightMagenta,this.settings.brightRed=i.brightRed,this.settings.brightWhite=i.brightWhite,this.settings.brightYellow=i.brightYellow,this.settings.cyan=i.cyan,this.settings.green=i.green,this.settings.magenta=i.magenta,this.settings.red=i.red,this.settings.white=i.white,this.settings.yellow=i.yellow,Se.update()}get terminalThemeObj(){return{background:this.settings.transparency?$d(this.settings.background,.5):this.settings.background,foreground:this.settings.foreground,selectionBackground:this.settings.selectionBackground,cursor:this.settings.cursor,cursorAccent:this.settings.cursorAccent,black:this.settings.black,blue:this.settings.blue,brightBlack:this.settings.brightBlack,brightBlue:this.settings.brightBlue,brightCyan:this.settings.brightCyan,brightGreen:this.settings.brightGreen,brightMagenta:this.settings.brightMagenta,brightRed:this.settings.brightRed,brightWhite:this.settings.brightWhite,brightYellow:this.settings.brightYellow,cyan:this.settings.cyan,green:this.settings.green,magenta:this.settings.magenta,red:this.settings.red,white:this.settings.white,yellow:this.settings.yellow}}get terminalObj(){return new fm({allowTransparency:this.settings.transparency,allowProposedApi:!0,scrollOnUserInput:!0,cursorBlink:this.settings.cursorBlink,cursorStyle:this.settings.cursorStyle,cursorInactiveStyle:this.settings.cursorInactiveStyle,scrollBack:this.settings.scrollBack,scrollSensitivity:this.settings.scrollSensitivity,fontSize:this.settings.fontSize,fontFamily:`${this.settings.fontFamily}, Fira Code, monospace`,fontWeight:this.settings.fontWeight,letterSpacing:this.settings.letterSpacing,theme:this.terminalThemeObj})}async clearCache(){await this.$cacheFile.writeFile(""),window.toast("Cache cleared \u{1F525}",3e3)}get settingsObj(){return this.settings.theme==="custom"?{list:this.settingsList.concat(this.settingsListWithThemeColor),cb:(t,i)=>this.settingsSaveCallback(t,i)}:{list:this.settingsList,cb:(t,i)=>this.settingsSaveCallback(t,i)}}get settingsList(){return[{key:"port",text:"Server Port",value:this.settings.port,info:"Port which is displayed on termux when starting the server",prompt:"Server Port",promptType:"number",promptOption:[{required:!0}]},{key:"letterSpacing",text:"Letter Spacing",value:this.settings.letterSpacing,info:"The spacing in whole pixels between characters.",prompt:"Letter spacing",promptType:"number",promptOption:[{required:!0}]},{key:"terminalPadding",text:"Terminal Padding",value:this.settings.terminalPadding,info:"Padding around the terminal content in pixels.",prompt:"Terminal Padding",promptType:"number",promptOption:[{match:/^[0-9]+$/,required:!0}]},{key:"serverHost",text:"Server Host Name",value:this.settings.serverHost,info:"Hostname which is displayed on termux when starting the server",prompt:"Server Host Name",promptType:"text",promptOption:[{required:!0}]},{key:"aiApiKey",text:"AI API Key",value:this.settings.aiApiKey,info:"API key of your selected model, if your selected model doesn't need any api key then leave it empty. For how to get api key : check the readme of plugin",prompt:"AI API Key",promptType:"text",promptOption:[{required:!0}]},{key:"aiModel",text:"AI Model",value:this.settings.aiModel,info:"ai model to generate terminal suggestions and commands",select:jl},{key:"fontWeight",text:"Font Weight",value:this.settings.fontWeight,info:"The font weight used to render non-bold text.",select:Wl},{key:"showTerminalBtnSize",text:"Show Terminal button size",value:this.settings.showTerminalBtnSize,info:"Size of terminal show button (in px)",prompt:"Show Terminal button size",promptType:"number",promptOption:[{required:!0}]},{key:"blurValue",text:"Blur Value(in px)",value:this.settings.blurValue,info:"Blur value for terminal in transparent mode",prompt:"Blur Value",promptType:"text",promptOption:[{required:!0}]},{key:"clearCache",text:"Clear Cache",info:"Helps in clearing cache which contains session details in case of any problems or bug"},{key:"transparency",text:"Allow Transparent Terminal",info:"Makes terminal transparent but it will also led to slightly performance decrement",checkbox:!!this.settings.transparency},{key:"imageRendering",text:"Image Rendering",info:"Enables image rendering inside the terminal but it can reduce performance",checkbox:!!this.settings.imageRendering},{key:"enableGuiViewer",text:"GUI Viewer",info:"Enables gui viewer, to view the output of graphical apps",checkbox:!!this.settings.enableGuiViewer},{key:"selectionHaptics",text:"Selection Haptics",info:"Enable/Disable vibration on selection",checkbox:!!this.settings.selectionHaptics},{key:"fontLigatures",text:"Font Ligatures",info:"Enable/Disable font ligatures in terminal",checkbox:!!this.settings.fontLigatures},{key:"showTerminalBtn",text:"Terminal Maximise Button",info:"Hide/Unhide terminal maximise button",checkbox:!!this.settings.showTerminalBtn},{index:7,key:"customFontStyleSheet",text:"Custom Font Stylesheet file",info:"Select css file in which you have to define about your custom font.",value:this.settings.customFontStyleSheet},{index:0,key:"cursorBlink",text:"Cursor Blink",info:"Whether the cursor blinks.",checkbox:!!this.settings.cursorBlink},{index:1,key:"cursorStyle",text:"Cursor Style",value:this.settings.cursorStyle,info:"The style of the cursor.",select:Xl},{key:"cursorInactiveStyle",text:"Cursor Inactive Style",value:this.settings.cursorInactiveStyle,info:"The style of the cursor when the terminal is not focused.",select:Ul},{index:2,key:"fontSize",text:"Font Size",value:this.settings.fontSize,info:"The font size used to render text.",prompt:"Font Size",promptType:"text",promptOption:[{match:/^[0-9]+$/,required:!0}]},{index:3,key:"fontFamily",text:"Font Family",value:this.settings.fontFamily,info:"The font family used to render text.",get select(){return Is.getNames()}},{index:4,key:"scrollBack",text:"Scroll Back",value:this.settings.scrollBack,info:"The amount of scrollback in the terminal. Scrollback is the amount of rows that are retained when lines are scrolled beyond the initial viewport.",prompt:"Scroll Back",promptType:"number",promptOption:[{match:/^[0-9]+$/,required:!0}]},{index:5,key:"scrollSensitivity",text:"Scroll Sensitivity",value:this.settings.scrollSensitivity,info:"The scrolling speed multiplier used for adjusting normal scrolling speed.",prompt:"Scroll Sensitivity",promptType:"number",promptOption:[{match:/^[0-9]+$/,required:!0}]},{index:6,key:"theme",text:"Theme",value:this.settings.theme,info:"Theme of terminal.",select:Gl}]}get settingsListWithThemeColor(){return[{index:8,key:"background",text:"Background Color",value:this.settings.background,color:this.settings.background},{index:9,key:"foreground",text:"Foreground Color",value:this.settings.foreground,color:this.settings.foreground},{index:10,key:"selectionBackground",text:"Selection Background Color",value:this.settings.selectionBackground,color:this.settings.selectionBackground},{index:11,key:"cursor",text:"Cursor Color",value:this.settings.cursor,color:this.settings.cursor},{index:12,key:"cursorAccent",text:"Cursor Accent Color",value:this.settings.cursorAccent,color:this.settings.cursorAccent},{index:13,key:"black",text:"Black Color",value:this.settings.black,color:this.settings.black},{index:14,key:"blue",text:"Blue Color",value:this.settings.blue,color:this.settings.blue},{index:15,key:"brightBlack",text:"Bright Black Color",value:this.settings.brightBlack,color:this.settings.brightBlack},{index:16,key:"brightBlue",text:"Bright Blue Color",value:this.settings.brightBlue,color:this.settings.brightBlue},{index:17,key:"brightCyan",text:"Bright Cyan Color",value:this.settings.brightCyan,color:this.settings.brightCyan},{index:18,key:"brightGreen",text:"Bright Green Color",value:this.settings.brightGreen,color:this.settings.brightGreen},{index:19,key:"brightMagenta",text:"Bright Magenta Color",value:this.settings.brightMagenta,color:this.settings.brightMagenta},{index:20,key:"brightRed",text:"Bright Red Color",value:this.settings.brightRed,color:this.settings.brightRed},{index:21,key:"brightWhite",text:"Bright White Color",value:this.settings.brightWhite,color:this.settings.brightWhite},{index:22,key:"brightYellow",text:"Bright Yellow Color",value:this.settings.brightYellow,color:this.settings.brightYellow},{index:23,key:"cyan",text:"Cyan Color",value:this.settings.cyan,color:this.settings.cyan},{index:24,key:"green",text:"Green Color",value:this.settings.green,color:this.settings.green},{index:25,key:"magenta",text:"Magenta Color",value:this.settings.magenta,color:this.settings.magenta},{index:26,key:"red",text:"Red Color",value:this.settings.red,color:this.settings.red},{index:27,key:"white",text:"White Color",value:this.settings.white,color:this.settings.white},{index:28,key:"yellow",text:"Yellow Color",value:this.settings.yellow,color:this.settings.yellow}]}async settingsSaveCallback(t,i){switch(t){case"customFontStyleSheet":this.setCustomFontFile();break;case"theme":this.applyTheme(i),i==="custom"&&acode.alert("AcodeX Warning","Restart the app please"),this.$terminal&&(this.$terminal.options.theme=this.terminalThemeObj);break;case"clearCache":this.clearCache();break;case"showTerminalBtnSize":this.$showTermBtn&&(this.$showTermBtn.style.height=`${i}px`,this.$showTermBtn.style.width=`${i}px`);break;case"fontSize":this.applyTerminalFontSize(i);break;case"fontFamily":try{await Is.loadFont(i)}catch(r){console.warn(`Failed to load font ${i}:`,r)}this.$terminal&&(this.$terminal.options.fontFamily=i,this.$terminal.refresh(0,this.$terminal.rows-1)),this.settings[t]=i,Se.update();break;case"fontWeight":this.$terminal&&(this.$terminal.options.fontWeight=i),this.settings[t]=i,Se.update();break;case"letterSpacing":this.$terminal&&(this.$terminal.options.letterSpacing=i),this.settings[t]=i,Se.update();break;case"terminalPadding":{let r=Number(i);if(Number.isNaN(r))break;let s=Math.max(0,r);this.settings[t]=s,this.$terminal?.element&&this._setTerminalPadding(s),Se.update();break}case"cursorBlink":this.$terminal&&(this.$terminal.options.cursorBlink=i),this.settings[t]=i,Se.update();break;case"cursorStyle":this.$terminal&&(this.$terminal.options.cursorStyle=i),this.settings[t]=i,Se.update();break;case"cursorInactiveStyle":this.$terminal&&(this.$terminal.options.cursorInactiveStyle=i),this.settings[t]=i,Se.update();break;case"imageRendering":this.$terminal&&(i?(this.$imageAddon=new Nd,this.$terminal.loadAddon(this.$imageAddon)):this.$imageAddon?.dispose()),this.settings[t]=i,Se.update();break;case"fontLigatures":this.$terminal&&(i?(this.$ligatureAddon=new Ds,this.$terminal.loadAddon(this.$ligatureAddon)):this.$ligatureAddon?.dispose()),this.settings[t]=i,Se.update();break;case"enableGuiViewer":this.settings[t]=i,Se.update(),acode.alert("AcodeX Warning","Make sure to restart to see this setting in effect");break;case"showTerminalBtn":this.$showTermBtn?i?acode.alert("AcodeX Warning","Restart App to see this change"):this.$showTermBtn.remove():acode.alert("AcodeX Warning","Restart App to see this change"),this.settings[t]=i,Se.update();break;default:this.settings[t]=i,t==="selectionHaptics"&&this.selectionManager&&(this.selectionManager.options.hapticFeedback=!!i),Se.update()}}get settings(){return Se.value[bi.id]}};if(window.acode){let e=new so;acode.setPluginInit(bi.id,async(t,i,{cacheFileUrl:r,cacheFile:s})=>{let n=t.endsWith("/")?t:`${t}/`;e.baseUrl=n,await e.init(i,s,r)},e.settingsObj),acode.setPluginUnmount(bi.id,()=>{e.destroy()})}})();
/*! Bundled license information:

@novnc/novnc/lib/crypto/aes.js:
  (*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE *)

@novnc/novnc/lib/crypto/rsa.js:
  (*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE *)

@novnc/novnc/lib/crypto/md5.js:
  (*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE *)

@novnc/novnc/lib/ra2.js:
  (*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE *)

@novnc/novnc/lib/rfb.js:
  (*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE *)

@xterm/xterm/lib/xterm.mjs:
  (**
   * Copyright (c) 2014-2024 The xterm.js authors. All rights reserved.
   * @license MIT
   *
   * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)
   * @license MIT
   *
   * Originally forked from (with the author's permission):
   *   Fabrice Bellard's javascript vt100 for jslinux:
   *   http://bellard.org/jslinux/
   *   Copyright (c) 2011 Fabrice Bellard
   *)

@xterm/addon-fit/lib/addon-fit.mjs:
  (**
   * Copyright (c) 2014-2024 The xterm.js authors. All rights reserved.
   * @license MIT
   *
   * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)
   * @license MIT
   *
   * Originally forked from (with the author's permission):
   *   Fabrice Bellard's javascript vt100 for jslinux:
   *   http://bellard.org/jslinux/
   *   Copyright (c) 2011 Fabrice Bellard
   *)

@xterm/addon-webgl/lib/addon-webgl.mjs:
  (**
   * Copyright (c) 2014-2024 The xterm.js authors. All rights reserved.
   * @license MIT
   *
   * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)
   * @license MIT
   *
   * Originally forked from (with the author's permission):
   *   Fabrice Bellard's javascript vt100 for jslinux:
   *   http://bellard.org/jslinux/
   *   Copyright (c) 2011 Fabrice Bellard
   *)

@xterm/addon-web-links/lib/addon-web-links.mjs:
  (**
   * Copyright (c) 2014-2024 The xterm.js authors. All rights reserved.
   * @license MIT
   *
   * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)
   * @license MIT
   *
   * Originally forked from (with the author's permission):
   *   Fabrice Bellard's javascript vt100 for jslinux:
   *   http://bellard.org/jslinux/
   *   Copyright (c) 2011 Fabrice Bellard
   *)

@xterm/addon-unicode11/lib/addon-unicode11.mjs:
  (**
   * Copyright (c) 2014-2024 The xterm.js authors. All rights reserved.
   * @license MIT
   *
   * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)
   * @license MIT
   *
   * Originally forked from (with the author's permission):
   *   Fabrice Bellard's javascript vt100 for jslinux:
   *   http://bellard.org/jslinux/
   *   Copyright (c) 2011 Fabrice Bellard
   *)

@xterm/addon-attach/lib/addon-attach.mjs:
  (**
   * Copyright (c) 2014-2024 The xterm.js authors. All rights reserved.
   * @license MIT
   *
   * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)
   * @license MIT
   *
   * Originally forked from (with the author's permission):
   *   Fabrice Bellard's javascript vt100 for jslinux:
   *   http://bellard.org/jslinux/
   *   Copyright (c) 2011 Fabrice Bellard
   *)

@xterm/addon-search/lib/addon-search.mjs:
  (**
   * Copyright (c) 2014-2024 The xterm.js authors. All rights reserved.
   * @license MIT
   *
   * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)
   * @license MIT
   *
   * Originally forked from (with the author's permission):
   *   Fabrice Bellard's javascript vt100 for jslinux:
   *   http://bellard.org/jslinux/
   *   Copyright (c) 2011 Fabrice Bellard
   *)

@xterm/addon-image/lib/addon-image.mjs:
  (**
   * Copyright (c) 2014-2024 The xterm.js authors. All rights reserved.
   * @license MIT
   *
   * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)
   * @license MIT
   *
   * Originally forked from (with the author's permission):
   *   Fabrice Bellard's javascript vt100 for jslinux:
   *   http://bellard.org/jslinux/
   *   Copyright (c) 2011 Fabrice Bellard
   *)
*/
